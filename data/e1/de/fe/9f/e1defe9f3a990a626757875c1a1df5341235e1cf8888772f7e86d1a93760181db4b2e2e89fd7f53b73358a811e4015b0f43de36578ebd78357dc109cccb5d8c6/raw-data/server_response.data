<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>BIP 0050 - Bitcoin Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"BIP_0050","wgTitle":"BIP 0050","wgCurRevisionId":66819,"wgRevisionId":66819,"wgArticleId":3921,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["BIP"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"BIP_0050","wgRelevantArticleId":3921,"wgRequestId":"92f2f496871bed37c8447970","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"preview":true,"publish":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0ft0puh",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector" />
<script async="" src="/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector" />
<meta name="generator" content="MediaWiki 1.30.0" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Bitcoin Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://en.bitcoin.it/w/api.php?action=rsd" />
<link rel="license" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Bitcoin Wiki Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-BIP_0050 rootpage-BIP_0050 skin-vector action-view"> <div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">BIP 0050</h1>
<div id="bodyContent" class="mw-body-content">
<div id="siteSub" class="noprint">From Bitcoin Wiki</div>
<div id="contentSub"></div>
<div id="jump-to-nav" class="mw-jump">
Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a>
</div>
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><table class="mbox"><tr>
<td class="mbox-empty-cell"></td>
<td class="mbox-text">
<p><span style="font-size: 100%; font-weight: bold;">This page describes a BIP (Bitcoin Improvement Proposal).</span><br /><span style="font-size: 95%;">Please see <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki">BIP 2</a> for more information about BIPs and creating them. Please do not just create a wiki page.</span><br />
</p>
</td>
</tr>
</table>
<table class="mbox"><tr>
<td class="mbox-empty-cell"></td>
<td class="mbox-text">
<p><span style="font-size: 95%;"><big><b>Please do not modify this page. This is a mirror of the BIP from the source Git repository <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bips/blob/master/bip-0050.mediawiki">here</a>.</b></big></span><br />
</p>
</td>
</tr>
</table>
<pre>
  BIP: 50
  Title: March 2013 Chain Fork Post-Mortem
  Author: Gavin Andresen &lt;gavinandresen@gmail.com&gt;
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0050
  Status: Final
  Type: Informational
  Created: 2013-03-20
  License: PD
</pre>
<div id="toc" class="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#What_went_wrong"><span class="tocnumber">1</span> <span class="toctext">What went wrong</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#What_went_right"><span class="tocnumber">2</span> <span class="toctext">What went right</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Root_cause"><span class="tocnumber">3</span> <span class="toctext">Root cause</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Action_items"><span class="tocnumber">4</span> <span class="toctext">Action items</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Immediately"><span class="tocnumber">4.1</span> <span class="toctext">Immediately</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Alert_system"><span class="tocnumber">4.2</span> <span class="toctext">Alert system</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Safe_mode"><span class="tocnumber">4.3</span> <span class="toctext">Safe mode</span></a></li>
<li class="toclevel-2 tocsection-8"><a href="#Testing"><span class="tocnumber">4.4</span> <span class="toctext">Testing</span></a></li>
<li class="toclevel-2 tocsection-9"><a href="#Double_spending"><span class="tocnumber">4.5</span> <span class="toctext">Double spending</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Resolution"><span class="tocnumber">4.6</span> <span class="toctext">Resolution</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Copyright"><span class="tocnumber">5</span> <span class="toctext">Copyright</span></a></li>
</ul>
</div>
<h2><span class="mw-headline" id="What_went_wrong">What went wrong</span></h2>
<p>A block that had a larger number of total transaction inputs than previously seen was mined and broadcasted. Bitcoin 0.8 nodes were able to handle this, but some pre-0.8 Bitcoin nodes rejected it, causing an unexpected fork of the blockchain. The pre-0.8-incompatible chain (from here on, the 0.8 chain) at that point had around 60% of the mining hash power ensuring the split did not automatically resolve (as would have occurred if the pre-0.8 chain outpaced the 0.8 chain in total work, forcing 0.8 nodes to reorganise to the pre-0.8 chain).
</p><p>In order to restore a canonical chain as soon as possible, BTCGuild and Slush downgraded their Bitcoin 0.8 nodes to 0.7 so their pools would also reject the larger block. This placed majority hashpower on the chain without the larger block, thus eventually causing the 0.8 nodes to reorganise to the pre-0.8 chain.
</p><p>During this time there was at least <a rel="nofollow" class="external text" href="https://bitcointalk.org/index.php?topic=152348.0">one large double spend</a>. However, it was done by someone experimenting to see if it was possible and was not intended to be malicious.
</p>
<h2><span class="mw-headline" id="What_went_right">What went right</span></h2>
<ul><li> The split was detected very quickly.</li>
<li> The right people were online and available in IRC or could be contacted directly.</li>
<li> Marek Palatinus (Slush) and Michael Marsee (Eleuthria of BTCGuild) quickly downgraded their nodes to restore a pre-0.8 chain as canonical, despite the fact that this caused them to sacrifice significant amounts of money.</li>
<li> Deposits to the major exchanges and payments via BitPay were also suspended (and then un-suspended) very quickly.</li>
<li> Fortunately, the only attack on a merchant was done by someone who was not intending to actually steal money.</li></ul>
<h2><span class="mw-headline" id="Root_cause">Root cause</span></h2>
<p>Bitcoin versions prior to 0.8 configure an insufficient number of Berkeley DB locks to process large but otherwise valid blocks. Berkeley DB locks have to be manually configured by API users depending on anticipated load. The manual says this:
</p>
<dl><dd>The recommended algorithm for selecting the maximum number of locks, lockers, and lock objects is to run the application under stressful conditions and then review the lock system's statistics to determine the maximum number of locks, lockers, and lock objects that were used. Then, double these values for safety.</dd></dl>
<p>With the insufficiently high BDB lock configuration, it implicitly had become a network consensus rule determining block validity (albeit an inconsistent and unsafe rule, since the lock usage could vary from node to node).
</p><p>Because max-sized blocks had been successfully processed on the testnet, it did not occur to anyone that there could be blocks that were smaller but require more locks than were available. Prior to 0.7 unmodified mining nodes self-imposed a maximum block size of 500,000 bytes, which further prevented this case from being triggered. 0.7 made the target size configurable and miners had been encouraged to increase this target in the week prior to the incident.
</p><p>Bitcoin 0.8 did not use Berkeley DB. It switched to LevelDB instead, which did not implement the same locking limits as BDB. Therefore it was able to process the forking block successfully.
</p><p>Note that BDB locks are also required during processing of re-organizations. Versions prior to 0.8 may be unable to process some valid re-orgs.
</p><p>This would be an issue even if the entire network was running version 0.7.2. It is theoretically possible for one 0.7.2 node to create a block that others are unable to validate, or for 0.7.2 nodes to create block re-orgs that peers cannot validate, because the contents of each node's blkindex.dat database is not identical, and the number of locks required depends on the exact arrangement of the blkindex.dat on disk (locks are acquired per-page).
</p>
<h2><span class="mw-headline" id="Action_items">Action items</span></h2>
<h3><span class="mw-headline" id="Immediately">Immediately</span></h3>
<p><b>Done</b>: Release a version 0.8.1, forked directly from 0.8.0, that, for the next two months has the following new rules:
</p>
<ol><li> Reject blocks that would probably cause more than 10,000 locks to be taken.</li>
<li> Limit the maximum block-size created to 500,000 bytes</li>
<li> Release a patch for older versions that implements the same rules, but also increases the maximum number of locks to 537,000</li>
<li> Create a web page on bitcoin.org that will urge users to upgrade to 0.8.1, but will tell them how to set DB_CONFIG to 537,000 locks if they absolutely cannot.</li>
<li> Over the next 2 months, send a series of alerts to users of older versions, pointing to the web page.</li></ol>
<h3><span class="mw-headline" id="Alert_system">Alert system</span></h3>
<p><b>Done</b>: Review who has access to the alert system keys, make sure they all have contact information for each other, and get good timezone overlap by people with access to the keys.
</p><p><b>Done</b>: Implement a new bitcoind feature so services can get timely notification of alerts: -alertnotify=&lt;command&gt; Run command when an AppliesToMe() alert is received.
</p><p><b>Done</b>: Pre-generate 52 test alerts, and set a time every week when they are broadcast on -testnet (so -alertnotify scripts can be tested in as-close-to-real-world conditions as possible).
</p><p>Idea from Michael Gronager: encourage merchants/exchanges (and maybe pools) to run new code behind a bitcoind running the network-majority version.
</p>
<h3><span class="mw-headline" id="Safe_mode">Safe mode</span></h3>
<p><b>Done</b>: Perhaps trigger an alert if there is a long enough side chain detected, even if it is not the main chain. Pools could use this to automatically suspend payouts if a long side-chain suddenly appeared out of nowhere (it’s hard for an attacker to mine such a thing).
</p>
<h3><span class="mw-headline" id="Testing">Testing</span></h3>
<p>Start running bots on the testnet that grab some coins from a testnet faucet, generate large numbers of random transactions that split/recombine them and then send them back to the faucet. Randomized online testing on the testnet might have revealed the pathological block type earlier.
</p>
<h3><span class="mw-headline" id="Double_spending">Double spending</span></h3>
<p>A double spend attack was successful, despite that both sides of the chain heard about the transactions in the same order. The reason is most likely that the memory pools were cleared when the mining pool nodes were downgraded. A solution is for nodes to sync their mempools to each other at startup, however, this requires a memory pool expiry policy to be implemented as currently node restarts are the only way for unconfirmed transactions to be evicted from the system.
</p>
<h3><span class="mw-headline" id="Resolution">Resolution</span></h3>
<p>On 16 August, 2013 block 252,451 (0x0000000000000024b58eeb1134432f00497a6a860412996e7a260f47126eed07) was accepted by the main network, forking unpatched nodes off the network.
</p>
<h2><span class="mw-headline" id="Copyright">Copyright</span></h2>
<p>This document is placed in the public domain.
</p>


</div>

</div> <div class="printfooter">
Retrieved from "<a dir="ltr" href="https://en.bitcoin.it/w/index.php?title=BIP_0050&amp;oldid=66819">https://en.bitcoin.it/w/index.php?title=BIP_0050&amp;oldid=66819</a>" </div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:BIP" title="Category:BIP">BIP</a></li></ul></div></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-createaccount"><a href="/w/index.php?title=Special:CreateAccount&amp;returnto=BIP+0050" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=BIP+0050" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li id="ca-nstab-main" class="selected"><span><a href="/wiki/BIP_0050" title="View the content page [c]" accesskey="c">Page</a></span></li>
<li id="ca-talk" class="new"><span><a href="/w/index.php?title=Talk:BIP_0050&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
<h3 id="p-views-label">Views</h3>
<ul>
<li id="ca-view" class="selected"><span><a href="/wiki/BIP_0050">Read</a></span></li>
<li id="ca-viewsource"><span><a href="/w/index.php?title=BIP_0050&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
<li id="ca-history" class="collapsible"><span><a href="/w/index.php?title=BIP_0050&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/w/index.php" id="searchform">
<div id="simpleSearch">
<input type="search" name="search" placeholder="Search Bitcoin Wiki" title="Search Bitcoin Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton" /> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="/wiki/Main_Page" title="Visit the main page"></a></div>
<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
<h3 id='p-navigation-label'>Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-Bitcoin-FAQ"><a href="/wiki/Help:FAQ">Bitcoin FAQ</a></li><li id="n-Editing-help"><a href="/wiki/Bitcoin_Wiki:Help">Editing help</a></li><li id="n-Forums"><a href="/wiki/Forums">Forums</a></li><li id="n-Chatrooms"><a href="/wiki/IRC_channels">Chatrooms</a></li><li id="n-Recent-changes"><a href="/wiki/Special:RecentChanges">Recent changes</a></li><li id="n-Page-index"><a href="/wiki/Special:AllPages">Page index</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
<h3 id='p-tb-label'>Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/BIP_0050" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/BIP_0050" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="/w/index.php?title=BIP_0050&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/w/index.php?title=BIP_0050&amp;oldid=66819" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/w/index.php?title=BIP_0050&amp;action=info" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-Sister_projects' aria-labelledby='p-Sister_projects-label'>
<h3 id='p-Sister_projects-label'>Sister projects</h3>
<div class="body">
<ul>
<li id="n-Essays"><a href="/wiki/Bitcoin_Wiki:Essay_main_page">Essays</a></li><li id="n-Source"><a href="/wiki/Bitcoin_Wiki:Source_main_page">Source</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 24 September 2019, at 17:59.</li>
<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="/wiki/Bitcoin_Wiki:Privacy_policy" title="Bitcoin Wiki:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="/wiki/Bitcoin_Wiki:About" title="Bitcoin Wiki:About">About Bitcoin Wiki</a></li>
<li id="footer-places-disclaimer"><a href="/wiki/Bitcoin_Wiki:General_disclaimer" title="Bitcoin Wiki:General disclaimer">Disclaimers</a></li>
</ul>
<ul id="footer-icons" class="noprint">
<li id="footer-poweredbyico">
<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/w/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /w/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.012","walltime":"0.012","ppvisitednodes":{"value":125,"limit":1000000},"ppgeneratednodes":{"value":420,"limit":1000000},"postexpandincludesize":{"value":1901,"limit":2097152},"templateargumentsize":{"value":832,"limit":2097152},"expansiondepth":{"value":5,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    5.672      1 -total"," 60.12%    3.410      1 Template:Bip"," 50.63%    2.872      2 Template:Ambox/message"," 37.82%    2.145      1 Template:BipMoved"]},"cachereport":{"timestamp":"20211030233309","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":44});});</script>
</body>
</html>
