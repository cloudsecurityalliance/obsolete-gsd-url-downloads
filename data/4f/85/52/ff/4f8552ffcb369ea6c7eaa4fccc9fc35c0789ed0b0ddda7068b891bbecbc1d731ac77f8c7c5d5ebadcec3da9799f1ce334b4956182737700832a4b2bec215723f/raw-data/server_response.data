<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1396399 - (CVE-2018-5116) An extension can XSS any domain with only the ActiveTab permission using frames">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1396399">
<meta property="og:description"
      content="RESOLVED (andrew.swan) in WebExtensions - Compatibility. Last updated 2020-09-23.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="P2">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1396399 - (CVE-2018-5116) An extension can XSS any domain with only the ActiveTab permission using frames</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1396399&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1396399">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1396399">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/yui.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/global.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/util.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"tracking\":{\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox95\":\"---\",\"cf_tracking_firefox58\":\"+\",\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_status_firefox_esr52\":\"wontfix\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_tracking_firefox95\":\"---\",\"cf_status_firefox58\":\"fixed\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_status_firefox59\":\"fixed\",\"cf_tracking_firefox57\":\"-\",\"cf_status_firefox57\":\"wontfix\"},\"project\":{\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_root_cause\":\"---\"},\"blocking\":{\"cf_blocking_webextensions\":\"---\"}},\"types\":[\"blocking\",\"tracking\"],\"comments\":{\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox57\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox58\":{\"?\":\"[Tracking Requested - why for this release]:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1396399;
  BUGZILLA.bug_title = '1396399 - (CVE-2018-5116) An extension can XSS any domain with only the ActiveTab permission using frames';
  BUGZILLA.bug_summary = 'An extension can XSS any domain with only the ActiveTab permission using frames';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1396399';
  BUGZILLA.bug_keywords = 'csectype-priv-escalation, sec-moderate',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/field.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/comments.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1396399">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1396399"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1396399 - (CVE-2018-5116) An extension can XSS any domain with only the ActiveTab permission using frames">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="XYs4ZS9ulQS1g7hnJ9pnRLA2MwC5w0RJm8o2PNZocAa6m82IPqrXGYce4LnfSaDQViuMSrgVvgDb1lN0AOfAtP1MWfH1NJgjMRgUMzzWRh7HYL9A6x23QEKJQJ9dxkcDU2hU2Jgii15GJy6l5J0cvsjtcUwCtfHzuyx2k27VgybrRQWT3t4h6MTyL5FpPLbsT6ieECEm1WcmkXUxhZZLEh4tj18701rgYw2j7Tj38fP7z2LrJEA6vptZMHs5fwN8">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1396399" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623222-HW56CqMb5TJGgfwcR4vcSLPZQDAGiFX1TWTzqFA9MVo">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1396399" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1396399" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1396399">Bug 1396399</a>
          <span class="edit-hide">(CVE-2018-5116)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-09-03 08:39 PDT" data-time="1504453161">4 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2018-01-11 05:07 PST" data-time="1515676067">4 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">An extension can XSS any domain with only the Active<wbr>Tab permission using frames</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            An extension can XSS any domain with only the ActiveTab permission using frames

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (WebExtensions :: Compatibility, defect, P2)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=WebExtensions" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">WebExtensions
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">WebExtensions</div>
            <div class="description">File feature requests and bugs related to the WebExtension add-on API.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=WebExtensions&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=WebExtensions"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="WebExtensions"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=WebExtensions&component=Compatibility#Compatibility" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">Compatibility
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">WebExtensions :: Compatibility</div>
            <div class="description">Compatibility with other browsers, including advocacy for add-ons we'd like
to support.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=WebExtensions&amp;component=Compatibility&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=WebExtensions&amp;component=Compatibility&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=WebExtensions&amp;component=Compatibility"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="WebExtensions" data-component="Compatibility"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-version"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            55 Branch

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">P2
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (firefox-esr52 wontfix, firefox57- wontfix, firefox58+ fixed, firefox59 fixed)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla59

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox57</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=-">-</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox58</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox59</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="wontfix"
          id="v3142_cf_status_firefox_esr52" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox57</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox57-dirty">
  <select id="cf_tracking_firefox57" name="cf_tracking_firefox57">
        <option value="-"
          id="v3289_cf_tracking_firefox57" selected
        >-
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox57-dirty">
  <select id="cf_status_firefox57" name="cf_status_firefox57">
        <option value="wontfix"
          id="v3297_cf_status_firefox57" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox58</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox58-dirty">
  <select id="cf_tracking_firefox58" name="cf_tracking_firefox58">
        <option value="+"
          id="v3453_cf_tracking_firefox58" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox58-dirty">
  <select id="cf_status_firefox58" name="cf_status_firefox58">
        <option value="fixed"
          id="v3446_cf_status_firefox58" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox59</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox59-dirty">
  <select id="cf_status_firefox59" name="cf_status_firefox59">
        <option value="fixed"
          id="v3510_cf_status_firefox59" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

      <div class="field edit-show" style="display:none"
>
    <div class="name">Blocking Flags:
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">webextensions</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_blocking_webextensions-dirty">
  <select id="cf_blocking_webextensions" name="cf_blocking_webextensions">
        <option value="---"
          id="v2817_cf_blocking_webextensions" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: ronen.zilberman, Assigned: aswan)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_561655" ><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=561655" > <span class="fna">aswan</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_255243" ><img src="https://secure.gravatar.com/avatar/02588af8894bf993b88e868d0d0a24de?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=255243" > <span class="fna">ronen.zilberman</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_372685" ><img src="https://secure.gravatar.com/avatar/b2fec98200b3938bef69471c7005458c?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=372685" > <span class="fna">mixedpuppy</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="17">17 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - activeTab permission allows executing scripts on pages it shouldn't"
   href="/show_bug.cgi?id=1431371">CVE-2018-5135</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1396399&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1396399">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-see_also" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
        ---
        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: csectype-priv-escalation, sec-moderate, Whiteboard: [adv-main58+][post-critsmash-triage])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2018-5116

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=csectype-priv-escalation&amp;resolution=---">csectype-priv-escalation</a>, 
          <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[adv-main58+][post-critsmash-triage]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a11345693_1689"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1504488241"
      >sec-bounty</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag-1640407">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1640407-dirty">
      <select id="flag-1640407" name="flag-1640407"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
            <option value="+" selected>+</option>
      </select>
    </td>


  </tr>
          </tbody>
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">aswan</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a12209731_561655"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1516662892"
      >in-testsuite</a>
    </td>

    <td class="flag-value">?
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">aswan</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag-1706803">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1706803-dirty">
      <select id="flag-1706803" name="flag-1706803"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" selected>?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (5 files, 14 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8904038">poc.zip</a>
        </div>
        <div>
            <a href="#c0" class="attach-time activity-ref"><span class="rel-time" title="2017-09-03 08:39 PDT" data-time="1504453161">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_255243" ><a class="email " href="/user_profile?user_id=255243" > <span class="fna">Ronen Zilberman</span></a>
</div></span>
        </div>
        <div class="attach-info">1.03 KB,
          application/zip        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8904038&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8905692">PoC modified to work in both chrome and firefox</a>
        </div>
        <div>
            <a href="#c8" class="attach-time activity-ref"><span class="rel-time" title="2017-09-07 15:14 PDT" data-time="1504822444">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_434339" ><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div></span>
        </div>
        <div class="attach-info">1.80 KB,
          application/zip        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8905692&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8925147">wip</a>
        </div>
        <div>
            <a href="#c21" class="attach-time activity-ref"><span class="rel-time" title="2017-11-03 14:04 PDT" data-time="1509743047">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">17.55 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8925147&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8925147&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8925147">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8925431">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c24" class="attach-time activity-ref"><span class="rel-time" title="2017-11-05 23:24 PST" data-time="1509953057">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.57 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_106098" ><span class="fn">kmag</span>
</div>:
              <a href="#c25"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1509953057"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8925431&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8925431&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8925431">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8926757">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c28" class="attach-time activity-ref"><span class="rel-time" title="2017-11-08 23:25 PST" data-time="1510212347">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.67 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_106098" ><span class="fn">kmag</span>
</div>:
              <a href="#c31"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510271781"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8926757&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8926757&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926757">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8926758">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c29" class="attach-time activity-ref"><span class="rel-time" title="2017-11-08 23:26 PST" data-time="1510212361">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">12.84 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8926758&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8926758&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926758">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8926760">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c30" class="attach-time activity-ref"><span class="rel-time" title="2017-11-08 23:28 PST" data-time="1510212536">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">12.74 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_106098" ><span class="fn">kmag</span>
</div>:
              <a href="#c32"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510212536"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8926760&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8926760&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926760">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8927170">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c33" class="attach-time activity-ref"><span class="rel-time" title="2017-11-09 21:06 PST" data-time="1510290385">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.10 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_561655" ><span class="fn">aswan</span>
</div>:
              <a href="#c35"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510290471"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c41"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510290985"
            >
              review-</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_280903" ><span class="fn">abillings</span>
</div>:
              <a href="#a6169030_280903"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510290985"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8927170&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8927170&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8927170">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8927171">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c34" class="attach-time activity-ref"><span class="rel-time" title="2017-11-09 21:06 PST" data-time="1510290399">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">12.41 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_561655" ><span class="fn">aswan</span>
</div>:
              <a href="#c36"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1510290503"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8927171&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8927171&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8927171">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8929679">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c54" class="attach-time activity-ref"><span class="rel-time" title="2017-11-17 19:41 PST" data-time="1510976460">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.27 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8929679&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8929679&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8929679">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8933408">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c64" class="attach-time activity-ref"><span class="rel-time" title="2017-11-30 10:42 PST" data-time="1512067336">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">14.46 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c65"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1512067336"
            >
              feedback-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8933408&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8933408&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8933408">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8933464">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c66" class="attach-time activity-ref"><span class="rel-time" title="2017-11-30 13:51 PST" data-time="1512078702">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.79 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8933464&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8933464&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8933464">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8934269">wip</a>
        </div>
        <div>
            <a href="#c68" class="attach-time activity-ref"><span class="rel-time" title="2017-12-04 11:54 PST" data-time="1512417264">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">45.59 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c69"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1512417264"
            >
              feedback-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8934269&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8934269&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8934269">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8939412">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c72" class="attach-time activity-ref"><span class="rel-time" title="2018-01-02 13:15 PST" data-time="1514927705">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">37.15 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c74"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1514927705"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8939412&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8939412&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8939412">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8939413">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c73" class="attach-time activity-ref"><span class="rel-time" title="2018-01-02 13:15 PST" data-time="1514927723">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">19.98 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c75"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1514927723"
            >
              review-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8939413&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8939413&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8939413">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8941328">Clarify rules for applying activeTab permission to content scripts</a>
        </div>
        <div>
            <a href="#c77" class="attach-time activity-ref"><span class="rel-time" title="2018-01-09 20:55 PST" data-time="1515560141">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">37.35 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_561655" ><span class="fn">aswan</span>
</div>:
              <a href="#c79"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1515560396"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_506302" ><span class="fn">gchang</span>
</div>:
              <a href="#c91"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1515632304"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_280903" ><span class="fn">abillings</span>
</div>:
              <a href="#c86"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1515560396"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8941328&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8941328&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8941328">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8941329">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c78" class="attach-time activity-ref"><span class="rel-time" title="2018-01-09 20:56 PST" data-time="1515560211">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">22.25 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c96"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1515560211"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8941329&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8941329&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8941329">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8944564">Test for content scripts and activeTab permission</a>
        </div>
        <div>
            <a href="#c98" class="attach-time activity-ref"><span class="rel-time" title="2018-01-22 15:14 PST" data-time="1516662853">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_561655" ><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div></span>
        </div>
        <div class="attach-info">22.57 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_561655" ><span class="fn">aswan</span>
</div>:
              <a href="#c99"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1516662937"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8944564&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8944564&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8944564">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=9175926">Bug 1396399: Test for content scripts and activeTab permission.</a>
        </div>
        <div>
            <a href="#c100" class="attach-time activity-ref"><span class="rel-time" title="2020-09-15 16:54 PDT" data-time="1600214062">1 year ago</span></a>
          <span class="attach-author"><div class="vcard vcard_106098" ><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div></span>
        </div>
        <div class="attach-info">47 bytes,
          text/x-phabricator-request        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=9175926&amp;action=edit">Details</a>&#x0020; |
  <a href="/attachment.cgi?id=9175926">Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="8vwY20RcAO1Vo3PDvRYK5Nbuk7mgtso3sHHDCwjMRKNyoemE">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12623727" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_255243" ><img src="https://secure.gravatar.com/avatar/02588af8894bf993b88e868d0d0a24de?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_255243" ><a class="email " href="/user_profile?user_id=255243" > <span class="fna">Ronen Zilberman</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 08:39 PDT" data-time="1504453161">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8904038"
         class="attachment"
         data-id="8904038" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="poc.zip">
      <meta itemprop="contentSize" content="1057">
      <meta itemprop="encodingFormat" content="application/zip">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8904038" itemprop="contentUrl">
        <span id="att-8904038-description" itemprop="description">poc.zip</span></a>
        — <a href="attachment.cgi?id=8904038&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-0" data-comment-id="12623727">User Agent: Mozilla/5.0 (Windows NT 6.1; WOW64; rv:55.0) Gecko/20100101 Firefox/55.0
Build ID: 20170824053622

Steps to reproduce:

The ActiveTab permission allows an extension to only access the current tab (after the user interacted with the extension). This is to allow &quot;extensions to fulfill a common use case, without having to give them very powerful permissions&quot; like &lt;all_urls&gt; (quote from the documentation).

However, it was found that this permission also allows access to frames within the tab that can be of a different domain. This allows a malicious extension, that requested only a very strict permission set, to still interact with any domain:
1. The extension injects code into the tab that creates a hidden iframe to an arbitrary domain.
2. The extension then injects code into that frame creating an XSS situation. This obviously allows for many kinds of nefarious actions such as theft of information, request forgery etc.


--------------------------------------------------------------------------
To recreate:
1. Inject code that creates a hidden iframe
2. Wait for the frame to load
3. inject any script into that frame

I provide a POC extension that shows a browser action (button). When clicked, a hidden iframe to &quot;<a rel="nofollow" href="https://example.com">https://example.com</a>&quot; is created in the current tab and the cookies for that URL are console.log()ed. 
The extension only requests activeTab yet this works regardless of the URL of the active tab.


Actual results:

The malicious code runs in all the frames in the current tab, including the iframe that was just created.


Expected results:

The activeTab should allow access to the parent frame only, and not to any inner frames. This is the behaviour in the Chrome browser.</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12624461" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" ><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" ><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 18:13 PDT" data-time="1504487613">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="12624461">So what you are saying is that you expect 'activeTab' to only grant a permission to the origin of the top level frame? What happens if the page actually contains cross-domain iframes? The add-on can not interact with them? That's not very intuitive to me, but its interesting if that is the way chrome has implemented it.  Our model might have been a deliberate design decision, I dont know.

(NB We haven't documented this behavior either way; I know this as I am currently writing the security model documentation at the moment for Firefox's implementation of browser extensions).

Kris, Andrew - what do you think about this? Firstly is this something we would like to change? On one hand I think it makes the security model more consistent (i.e. you explicitly need the host permission to in order to executeScript in a frame) but the flipside is that might break extensions which rely on the currently behavior (and it might also result in all extensions requesting the &lt;all_urls&gt; permission. I tend to agree with the reporter here though - while activeTab isn't quite as permissive as &lt;all_urls&gt; 

If we are going to change this, then I assume we would also need to change the behavior of the tabs and activeTab APIs, to grant a permission to the current frame. (and then I wonder, would that be scoped to the actual page or the origin, ie can you inject script into same origin iframes with different URLs. Origin would probably make the most sense). 

If we DON'T want to make this change, then we should at least ensure that AMO and reviewers treat tab &amp; activeTab with the same level of caution. (in line with &lt;all_urls&gt; )

[Tracking Requested - why for this release]:
This seems like an important incompatibility with chrome if the behavior is as described - if we didn't do this deliberately, its probably something we want to address.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Component: Untriaged &rarr; WebExtensions: Compatibility</div><div class="change">Flags: needinfo?(kmaglione+bmo)</div><div class="change">Flags: needinfo?(aswan)</div><div class="change">Product: Firefox &rarr; Toolkit</div></div></div><div class="change-set" id="a35080_434339"><div class="change" id="aa35080_434339">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a35080_434339"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_434339" id="a35080_434339"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a35080_434339"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a35080_434339">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a35080_434339">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 18:24 PDT" data-time="1504488241">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty?</div></div></div><div class="change-set" id="c3"><div class="comment" data-id="12624965" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a35080_434339"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a35080_434339"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 18:32 PDT" data-time="1504488759">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12624965">This behavior is intentional, yes. If Chrome behaves differently, that's certainly not the way it was documented when we implemented this. If we were to implement different restrictions, we'd probably still want to allow access to sub-frames that are same-origin with the root.

That said, I'm not sure that restricting access to subframes is what we want. Unless perhaps we only include subframes that were already present when the activeTab permission was granted.

But, really, any domain that's worth trying to hijack this way should set appropriate X-Frame-Options headers to prevent it being loaded in a subframe to begin with.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="a35635_106098"><div class="change" id="aa35635_106098">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_106098" id="a35635_106098"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a35635_106098"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a35635_106098">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a35635_106098">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 18:33 PDT" data-time="1504488796">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(aswan)</span></div></div></div><div class="change-set" id="c4"><div class="comment" data-id="12626298" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" id="a35635_106098"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-03 21:32 PDT" data-time="1504499571">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="12626298">Honestly the documentation is all over the shop on this topic(both ours and theirs). But I think there is no point implementing restrictions if we allow subframes (there is no way to tell between legit sub-frames and injected sub-frames, right?). I'd agree with you x-frame-options, except that most sites don't set this even though they should.

From digging a little more into the chrome documentation, I don't think we are meeting the intention of the activeTab permission[1]. IIUC The design goals were to provide a permission which was NOT as dangerous as &lt;all_urls&gt;, and hence they only allow scripting to the current page, until the page has been navigated. If don't restrict the sub-frame scripting then activeTab is as dangerous as &lt;all_urls&gt; and in fact worse, since the implication isn't clear.

[1] <a rel="nofollow" href="https://developer.chrome.com/extensions/activeTab#motivation">https://developer.chrome.com/extensions/activeTab#motivation</a>

And what our own documentation says is quoted above already ( &quot;The intention of this permission is to enable extensions to fulfill a common use case, without having to give them very powerful permissions.&quot;)

Currently activeTab effectively as dangerous as &lt;all_urls&gt;, just with the added restriction of requiring user interaction prior to execution. Of course, the other part of the story is that chrome doesn't show the activeTab permission to the user. Which seems deceptive to me. (I guess their assumption is that if the user is interacting with addon via a browser/page action, then this signals intent for the permission grant - and as such it would make sense to block sub-frames since the user cant be aware of the other origins that might be framed.)

So I actually think that we should 'fix' this, and block script execution in subframes, unless the extension has the correct permission.</pre></div><div class="change-set" id="c5"><div class="comment" data-id="12626842" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_255243" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/02588af8894bf993b88e868d0d0a24de?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_255243" id="a35635_106098"><a class="email " href="/user_profile?user_id=255243" > <span class="fna">Ronen Zilberman</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-04 02:52 PDT" data-time="1504518738">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12626842">I agree that it's confusing. Being called activeTab (and not activeTopFrameOfTab) it implies the entire tab. My own extension (Check4Change) would have wanted a &quot;real&quot; activeTab but would regrettably need to request &lt;all_urls&gt; in order to access subframes in the current tab.

However, leaving this unfixed is too dangerous (IMO) as, like was said above, it is &quot;effectively as dangerous as &lt;all_urls&gt;&quot; but without letting the user know.

One can overcome the X-Frame-Options restriction by loading URLs like these:
<a rel="nofollow" href="https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png">https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png</a>
<a rel="nofollow" href="https://www.facebook.com/ajax/bz">https://www.facebook.com/ajax/bz</a>

The header doesn't mitigate the attack as it is intended to stop clickjacking and therefor only needed in the top-level pages (where there are actions to be done). It is not present (nor needs to be) in inner elements (in the examples about: The google logo, or a facebook ajax point). But of course an iframe can load an image and once it does it is within the Same-Origin of its domain, allowing execution of client side scripts.</pre></div><div class="change-set" id="c6"><div class="comment" data-id="12628492" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_428608" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_428608" id="a35635_106098"><a class="email " href="/user_profile?user_id=428608" > <span class="fna">Frederik Braun [:freddy] - vacation (back Nov 1st)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-04 23:36 PDT" data-time="1504593365">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12628492">We'll want to fix this (i.e., align it with Chrome) for various reasons. Security and web-extension compatibility.</pre></div><div class="change-set" id="c7"><div class="comment" data-id="12639248" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_397635" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/4ae11454315077053052b613d6d77241?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_397635" id="a35635_106098"><a class="email " href="/user_profile?user_id=397635" > <span class="fna">Andy McKay</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-07 15:10 PDT" data-time="1504822258">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12639248">After fiddling with the poc a little I can't reproduce in Chrome. I agree with Paul and Frederik and think we should fix this in the 57 timeline to be consistent with Chrome if we can.</pre><div class="activity"><div class="change">Priority: -- &rarr; P2</div></div></div><div class="change-set" id="c8"><div class="comment" data-id="12639290" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" id="a35635_106098"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-07 15:14 PDT" data-time="1504822444">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8905692"
         class="attachment"
         data-id="8905692" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="activeTab.zip">
      <meta itemprop="contentSize" content="1845">
      <meta itemprop="encodingFormat" content="application/zip">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8905692" itemprop="contentUrl">
        <span id="att-8905692-description" itemprop="description">PoC modified to work in both chrome and firefox</span></a>
        — <a href="attachment.cgi?id=8905692&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-8" data-comment-id="12639290">This should work in both Chrome and Firefox.

STR:

1. Install addon as temporary addon
2. navigate to webpage that isnt exmaple.com (e.g. <a rel="nofollow" href="https://misuse.co">https://misuse.co</a>)
3. press the browser action button installed by the extension

Results:

In chrome, one alert fires (for the top level domain)
In Firefox, two alerts fire (for both domains)</pre></div><div class="change-set" id="c9"><div class="comment" data-id="12639367" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_372685" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/b2fec98200b3938bef69471c7005458c?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_372685" id="a35635_106098"><a class="email " href="/user_profile?user_id=372685" > <span class="fna">Shane Caraveo (:mixedpuppy)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-07 15:25 PDT" data-time="1504823127">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="12639367">My 2c.  I wonder why a malicious addon wouldn't just request the permissions it needs to access subframes anyway.  Maybe a few less people will install, but they wouldn't have to deal with limitations.</pre></div><div class="change-set" id="c10"><div class="comment" data-id="12639383" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_397635" id="a35635_106098"><img src="https://secure.gravatar.com/avatar/4ae11454315077053052b613d6d77241?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_397635" id="a35635_106098"><a class="email " href="/user_profile?user_id=397635" > <span class="fna">Andy McKay</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-07 15:29 PDT" data-time="1504823382">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="12639383">Its a fair point and why it's a P2 and not a blocker in my opinion.

Legacy add-ons could of course just do all this with no prompting at all, but hey we should probably get the permissions matching expectations.</pre></div><div class="change-set" id="a693527_1689"><div class="change" id="aa693527_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a693527_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a693527_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a693527_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a693527_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a693527_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-11 09:18 PDT" data-time="1505146688">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: firefox-core-security &rarr; toolkit-core-security</div></div></div><div class="change-set" id="a957294_1689"><div class="change" id="aa957294_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a957294_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a957294_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a957294_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a957294_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a957294_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-14 10:34 PDT" data-time="1505410455">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Status: UNCONFIRMED &rarr; NEW</div><div class="change">Ever confirmed: true</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-priv-escalation&amp;resolution=---">csectype-priv-escalation</a>, 
          
            <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a></div></div></div><div class="change-set" id="c11"><div class="comment" data-id="12669687" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_255243" id="a957294_1689"><img src="https://secure.gravatar.com/avatar/02588af8894bf993b88e868d0d0a24de?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_255243" id="a957294_1689"><a class="email " href="/user_profile?user_id=255243" > <span class="fna">Ronen Zilberman</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-15 03:52 PDT" data-time="1505472764">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="12669687">My 2c reply. One of the majors reasons moving away from legacy add-ons in the first place was security. The idea that add-ons couldn't just do anything they wanted anymore but rather had to ask for granular permissions and thus giving control back to the users to make an informed decision. 

It's definitely arguable if this security mechanism (permissions) is broken by design because most users just click &quot;ok&quot; anyway (similar to Android). However it is still *a* security mechanism of the browser. It would be much simpler to do away with it entirely and just grant all permissions to all add-ons, but I assume no one would advocate for that as the simplicity doesn't outweigh the security benefits.

----------

I've noticed the bug was labeled &quot;sec-moderate&quot;. It is my feeling that according to the guidelines (<a rel="nofollow" href="https://wiki.mozilla.org/Security_Severity_Ratings">https://wiki.mozilla.org/Security_Severity_Ratings</a>) the bug doesn't adhere to the description of &quot;sec-moderate&quot;, yet fits well as &quot;sec-high&quot;. From the doc &quot;sec-high&quot; allows &quot;Obtaining confidential data from other sites the user is visiting, or inject data or code into those sites, requiring no more than normal browsing actions.&quot; (assuming installing an add-on is normal browsing actions).

Disclaimer: While I genuinely feel all the above is true, I wouldn't be arguing over semantics if I wasn't excited about the possibility of my bug achieving bug-bounty fame. :)</pre></div><div class="change-set" id="c12"><div class="comment" data-id="12677842" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a957294_1689"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a957294_1689"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-18 10:09 PDT" data-time="1505754599">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="12677842">Not tracking for 57 (because of <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c10">comment #10</a> &amp; sec-moderate)</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=isnotempty">status-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=-">-</a></div></div></div><div class="change-set" id="a3314277_397635"><div class="change" id="aa3314277_397635">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_397635" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/4ae11454315077053052b613d6d77241?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_397635" id="a3314277_397635"><a class="email " href="/user_profile?user_id=397635" > <span class="fna">Andy McKay</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3314277_397635"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3314277_397635">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a3314277_397635">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-11 17:17 PDT" data-time="1507767438">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; aswan</div></div></div><div class="change-set" id="c13"><div class="comment" data-id="12751183" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" id="a3314277_397635"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-11 18:02 PDT" data-time="1507770151">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12751183">(In reply to Shane Caraveo (:mixedpuppy) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c9">comment #9</a>)
<span class="quote">&gt; My 2c.  I wonder why a malicious addon wouldn't just request the permissions
&gt; it needs to access subframes anyway.  Maybe a few less people will install,
&gt; but they wouldn't have to deal with limitations.</span >

I probably agree with you there - would the less scary warning be worth it for a malicious add-on writer? I don't know, but it's clear we need to fix this as currently the activeTab permission doesn't fulfill the purpose of its existence.

The whole reason for the existence of &quot;activeTab&quot; permission is that its supposed to be a less dangerous permission, and that's the justification for why we _show nothing_ in the install permission prompt when a add-on has this permission. The idea with ActiveTab is that since the user has interacted with the tab (browser/page action, context menu etc) [1] then there is an implicit permission grant to interact with that page, if the extension has asked that it needs such permission.

So I thinks an important bug to fix, as currently our permission warnings (or lack of) are somewhat misleading imho. 


(In reply to Ronen Zilberman from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c11">comment #11</a>)
<span class="quote">&gt; My 2c reply....</span >

Totally agree with you here that it needs to be fixed. Security is definitely a motivation for web extensions, but its more about removing the all-powerful nature of legacy extensions than actively trying to giving the user more control.

I do think however that sec-moderate is appropriate though both because the limited value this represents for attacker and inherent limitations of permission granting as a security control (i.e. users don't read prompts). Also activeTab requires user interaction in the form clicking a browser action, page action or context menu button. 

Regardless of the rating, I do think this is worth bounty consideration, and I have flagged it as such. I've been explicitly testing our web extension implementation and I hadn't noticed this bug, so I'm a definitely very grateful here for the bug report here.


[1] <a rel="nofollow" href="https://developer.chrome.com/extensions/activeTab#invoking-activeTab">https://developer.chrome.com/extensions/activeTab#invoking-activeTab</a></pre></div><div class="change-set" id="c14"><div class="comment" data-id="12796531" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a3314277_397635"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 10:40 PDT" data-time="1509126027">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="12796531">I did a little more testing on this in Chrome and empirically, it seems that Chrome distinguishes script-injected content and does not grant access to that content via activeTab.  When this bug was originally filed, it wasn't feasible to implement that behavior in Firefox.  But Kris, with your recent work on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use the subject principal as the triggering principal for loads of script-generated content"
   href="/show_bug.cgi?id=1406278">bug 1406278</a> would it be feasible to do that now?</pre><div class="activity"><div class="change">Flags: needinfo?(kmaglione+bmo)</div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12796540" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a3314277_397635"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 10:45 PDT" data-time="1509126344">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12796540">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c14">comment #14</a>)
<span class="quote">&gt; I did a little more testing on this in Chrome and empirically, it seems that
&gt; Chrome distinguishes script-injected content and does not grant access to
&gt; that content via activeTab.  When this bug was originally filed, it wasn't
&gt; feasible to implement that behavior in Firefox.  But Kris, with your recent
&gt; work on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use the subject principal as the triggering principal for loads of script-generated content"
   href="/show_bug.cgi?id=1406278">bug 1406278</a> would it be feasible to do that now?</span >

Yeah, to some extent. Script-injected frames should have a triggeringPrincipal set for their src attribute (but not for their srcdoc attribute). But there are other ways to navigate a frame than setting its src property.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="c16"><div class="comment" data-id="12796922" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a3314277_397635"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 13:28 PDT" data-time="1509136097">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12796922">So the rule can be: an extension can only use the activeTab permission to inject a script into a frame if the frame's current location matches its src attribute and its triggeringPrincipal is not an extension principal (or should this check be even more specific?)

If I can get consensus on this, I can put together a patch.  Shotgunning some needinfos...</pre><div class="activity"><div class="change">Flags: needinfo?(ptheriault)</div><div class="change">Flags: needinfo?(kmaglione+bmo)</div><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="c17"><div class="comment" data-id="12796939" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a3314277_397635"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-27 13:34 PDT" data-time="1509136493">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12796939">The extension can set the src using the page's principal, and we don't currently record any principal for parser-created nodes. We need to actually record when the src was set using a non-script-created parser.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12800954" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" id="a3314277_397635"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-30 00:59 PDT" data-time="1509350341">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12800954">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c14">comment #14</a>)
<span class="quote">&gt; I did a little more testing on this in Chrome and empirically, it seems that
&gt; Chrome distinguishes script-injected content and does not grant access to
&gt; that content via activeTab.  When this bug was originally filed, it wasn't
&gt; feasible to implement that behavior in Firefox.  But Kris, with your recent
&gt; work on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use the subject principal as the triggering principal for loads of script-generated content"
   href="/show_bug.cgi?id=1406278">bug 1406278</a> would it be feasible to do that now?</span >

When you say &quot;script-injected&quot; content - does that mean &quot;any frames that were injected by a script (as opposed to declared in html)&quot;? IE that if a webpage dynamically adds frames to itself with a script, Web Extensions will not have permission to inject into these with only the activetab permission?

Just making sure I understand this clearly (I should test this I suppose)</pre></div><div class="change-set" id="c19"><div class="comment" data-id="12800962" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434339" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/9a0a16bc1cb5b0144e373deb8e357804?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434339" id="a3314277_397635"><a class="email disabled" href="/user_profile?user_id=434339" > <span class="fna">Paul Theriault [:pauljt] (no longer reading bugmail)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-30 01:05 PDT" data-time="1509350730">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12800962">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c16">comment #16</a>)
<span class="quote">&gt; So the rule can be: an extension can only use the activeTab permission to
&gt; inject a script into a frame if the frame's current location matches its src
&gt; attribute and its triggeringPrincipal is not an extension principal (or
&gt; should this check be even more specific?)
&gt; 
&gt; If I can get consensus on this, I can put together a patch.  Shotgunning
&gt; some needinfos...</span >

That sounds great to me. Again just to make sure I understand your goal here, the effective permission of activeTab permission would then to allow script injection into:
 a) the top-level window of the current tab
 b) Any iframes which are declared in the HTML of the document

I was expecting just (a), but if you would prefer (a)&amp; (b) for compat reasons, that seems to make sense too. My goal here is to ensure that activeTab is significantly less privileged than &lt;all_urls&gt;.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ptheriault)</span></div></div></div><div class="change-set" id="c20"><div class="comment" data-id="12806873" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a3314277_397635"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-31 15:02 PDT" data-time="1509487339">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12806873">(In reply to Paul Theriault [:pauljt] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c18">comment #18</a>)
<span class="quote">&gt; (In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c14">comment #14</a>)
&gt; &gt; I did a little more testing on this in Chrome and empirically, it seems that
&gt; &gt; Chrome distinguishes script-injected content and does not grant access to
&gt; &gt; that content via activeTab.  When this bug was originally filed, it wasn't
&gt; &gt; feasible to implement that behavior in Firefox.  But Kris, with your recent
&gt; &gt; work on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Use the subject principal as the triggering principal for loads of script-generated content"
   href="/show_bug.cgi?id=1406278">bug 1406278</a> would it be feasible to do that now?
&gt; 
&gt; When you say &quot;script-injected&quot; content - does that mean &quot;any frames that
&gt; were injected by a script (as opposed to declared in html)&quot;? IE that if a
&gt; webpage dynamically adds frames to itself with a script, Web Extensions will
&gt; not have permission to inject into these with only the activetab permission?</span >

Yes, that is the proposal.  We can't reliably distinguish script-injected frames that are created by the page itself from those created by an extension so its really the only safe thing to do.


(In reply to Paul Theriault [:pauljt] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c19">comment #19</a>)
<span class="quote">&gt; That sounds great to me. Again just to make sure I understand your goal
&gt; here, the effective permission of activeTab permission would then to allow
&gt; script injection into:
&gt;  a) the top-level window of the current tab
&gt;  b) Any iframes which are declared in the HTML of the document
&gt; 
&gt; I was expecting just (a), but if you would prefer (a)&amp; (b) for compat
&gt; reasons, that seems to make sense too. My goal here is to ensure that
&gt; activeTab is significantly less privileged than &lt;all_urls&gt;.</span >

Right a&amp;b is what Chrome does and is what is proposed here.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="12816460" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a3314277_397635"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 14:04 PDT" data-time="1509743047">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8925147"
         class="attachment patch obsolete"
         data-id="8925147" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-0743e8abc00c">
      <meta itemprop="contentSize" content="17967">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8925147">
          <a class="link" href="attachment.cgi?id=8925147&amp;action=diff">
        <span id="att-8925147-description" itemprop="description">wip</span></a> (obsolete)
        — <a href="attachment.cgi?id=8925147&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8925147">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-21" data-comment-id="12816460">This will need reviews from a dom peer and from security but
lets start with telling me how badly I butchered the C++ bits.

MozReview-Commit-ID: ES3OcA1C4Zz</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925147&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8925147</a> -
        Flags: review?(kmaglione+bmo)</div></div></div><div class="change-set" id="c22"><div class="comment" data-id="12816633" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a3314277_397635"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 15:21 PDT" data-time="1509747685">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="12816633">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8925147" name="attach_8925147" title="wip">attachment 8925147</a> <a href="/attachment.cgi?id=8925147&amp;action=edit" title="wip">[details]</a> <a href="/attachment.cgi?id=8925147&amp;action=diff" title="wip">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8925147'>[review]</a>
wip

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8925147" name="attach_8925147" title="wip">attachment 8925147</a> <a href="/attachment.cgi?id=8925147&amp;action=edit" title="wip">[details]</a> <a href="/attachment.cgi?id=8925147&amp;action=diff" title="wip">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8925147'>[review]</a>:
-----------------------------------------------------------------

Good start, but I think the original URL tracking needs some work.

::: dom/base/nsContentUtils.cpp
&#64;&#64; +4758,5 &#64;&#64;
<span class="quote">&gt;  /* static */
&gt; +bool
&gt; +nsContentUtils::IsOriginalParserCreatedFrame(nsPIDOMWindowOuter* aWin)
&gt; +{
&gt; +  if (aWin == nullptr) {</span >

Can make this an assertion.

&#64;&#64; +4768,5 &#64;&#64;
<span class="quote">&gt; +    return false;
&gt; +  }
&gt; +
&gt; +  bool dynamic = true;
&gt; +  docshell-&gt;GetCreatedDynamically(&amp;dynamic);</span >

We should mark this infallible in the IDL.

&#64;&#64; +4775,5 &#64;&#64;
<span class="quote">&gt; +  }
&gt; +
&gt; +  nsIURI* currentURI = aWin-&gt;GetDocumentURI();
&gt; +
&gt; +  nsGenericHTMLFrameElement* frame = static_cast&lt;nsGenericHTMLFrameElement*&gt;(aWin-&gt;GetFrameElementInternal());</span >

This should probably be something like `RefPtr&lt;nsGenericHTMLFrameElement&gt; frame = do_QueryObject(...)`, or we should implement nsGenericHTMLFrameElement::FromContent.

&#64;&#64; +4779,5 &#64;&#64;
<span class="quote">&gt; +  nsGenericHTMLFrameElement* frame = static_cast&lt;nsGenericHTMLFrameElement*&gt;(aWin-&gt;GetFrameElementInternal());
&gt; +  nsCOMPtr&lt;nsIURI&gt; originalURI;
&gt; +  nsCOMPtr&lt;nsIPrincipal&gt; unusedPrincipal;
&gt; +  nsresult rv = frame-&gt;GetResolvedSrcURI(getter_AddRefs(originalURI), getter_AddRefs(unusedPrincipal));
&gt; +  if (rv != NS_OK) {</span >

You should always check NS_SUCCEEDED(rv) rather than comparing against NS_OK.

And you could use something like NS_ENSURE_SUCCESS(rv, true) here, but at this point I'd probably just have this return Result&lt;bool, nsresult&gt; and use MOZ_TRY

&#64;&#64; +4784,5 &#64;&#64;
<span class="quote">&gt; +    return false;
&gt; +  }
&gt; +
&gt; +  bool equal = false;
&gt; +  rv = (originalURI-&gt;Equals(currentURI, &amp;equal));</span >

I don't think this will work. It will just tell us the resolved URL of the current src attribute, but that could have changed since the frame was created.

I think we probably need to change the frame element code to clear the mNetworkCreated flag when the src/srcset attributes are changed, rather than when it's inserted into the document.

::: dom/base/nsFrameLoader.cpp
&#64;&#64; +2774,5 &#64;&#64;
<span class="quote">&gt; +    // XBL bindings doc shouldn't load sub-documents.
&gt; +    return NS_OK;
&gt; +  }
&gt; +
&gt; +  nsCOMPtr&lt;nsIURI&gt; base_uri = mOwnerContent-&gt;GetBaseURI();</span >

Urgh. I know you didn't write this, but underscored variable names violate our style guide. If you're changing this anyway, it would be nice to fix that while you're here.

::: dom/base/nsFrameLoader.h
&#64;&#64; +337,5 &#64;&#64;
<span class="quote">&gt;    void ApplySandboxFlags(uint32_t sandboxFlags);
&gt;  
&gt;    void GetURL(nsString&amp; aURL, nsIPrincipal** aTriggeringPrincipal);
&gt;  
&gt; +  nsresult GetResolvedURI(nsIURI** aURI, nsIPrincipal** aTriggeringPrincipal);</span >

Nit: Please document.

::: toolkit/components/extensions/WebExtensionContentScript.h
&#64;&#64; +49,5 &#64;&#64;
<span class="quote">&gt;    // be called for codebase principals.
&gt;    const URLInfo&amp; PrincipalURL() const;
&gt;  
&gt;    bool IsTopLevel() const;
&gt; +  bool HasActiveTabPermission() const;</span >

This name is a bit misleading. It seems like it should be something like IsNetworkCreated()

::: toolkit/components/extensions/WebExtensionPolicy.cpp
&#64;&#64; +303,5 &#64;&#64;
<span class="quote">&gt;  WebExtensionContentScript::WebExtensionContentScript(WebExtensionPolicy&amp; aExtension,
&gt;                                                       const ContentScriptInit&amp; aInit,
&gt;                                                       ErrorResult&amp; aRv)
&gt;    : mExtension(&amp;aExtension)
&gt; +  , mHasActiveTabPermission(aInit.mHasActiveTabPermission)</span >

Can we add an assertion that this is always false for manifest-registered content scripts?

&#64;&#64; +360,5 &#64;&#64;
<span class="quote">&gt; +  if (AddonManagerWebAPI::IsValidSite(aDoc.PrincipalURL().URI())) {
&gt; +    return false;
&gt; +  }
&gt; +
&gt; +  if (mHasActiveTabPermission &amp;&amp; aDoc.HasActiveTabPermission()) {</span >

I don't think this is right. I think we probably want a `requireParserCreated` flag, or something, and to return false if it's not set, rather than ignoring the URL match patterns in the opposite case.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925147&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8925147</a> -
        Flags: <span class="activity-deleted">review?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="c23"><div class="comment" data-id="12817016" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a3314277_397635"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-03 21:12 PDT" data-time="1509768771">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="12817016">(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c22">comment #22</a>)
<span class="quote">&gt; &#64;&#64; +360,5 &#64;&#64;
&gt; &gt; +  if (AddonManagerWebAPI::IsValidSite(aDoc.PrincipalURL().URI())) {
&gt; &gt; +    return false;
&gt; &gt; +  }
&gt; &gt; +
&gt; &gt; +  if (mHasActiveTabPermission &amp;&amp; aDoc.HasActiveTabPermission()) {
&gt; 
&gt; I don't think this is right. I think we probably want a
&gt; `requireParserCreated` flag, or something, and to return false if it's not
&gt; set, rather than ignoring the URL match patterns in the opposite case.</span >

Actually, ignore this. Your way is better. If an extension has permissions for a
frame, it should always be able to inject into it. If it doesn't, we should fall
back to active tab permissions.</pre></div><div class="change-set" id="c24"><div class="comment" data-id="12820145" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a3314277_397635"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a3314277_397635"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-05 23:24 PST" data-time="1509953057">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8925431"
         class="attachment patch obsolete"
         data-id="8925431" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-77b26dfc0034">
      <meta itemprop="contentSize" content="13891">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8925431">
          <a class="link" href="attachment.cgi?id=8925431&amp;action=diff">
        <span id="att-8925431-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8925431&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8925431">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-24" data-comment-id="12820145">Still needs a test which is going to be tricky since all the apis that grant
the activeTab permission are browser- or mobile-specific.  But for now here's
the patch to look at.

MozReview-Commit-ID: 9xPDX8Qk2iR</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925431&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8925431</a> -
        Flags: review?(kmaglione+bmo)</div></div></div><div class="change-set" id="a5499931_561655"><div class="change" id="aa5499931_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a5499931_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5499931_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5499931_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a5499931_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-05 23:24 PST" data-time="1509953092">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925147&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8925147</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c25"><div class="comment" data-id="12829009" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a5499931_561655"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 14:22 PST" data-time="1510179735">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="12829009">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8925431" name="attach_8925431" title="Clarify rules for applying activeTab permission to content scripts">attachment 8925431</a> <a href="/attachment.cgi?id=8925431&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8925431&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8925431'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8925431" name="attach_8925431" title="Clarify rules for applying activeTab permission to content scripts">attachment 8925431</a> <a href="/attachment.cgi?id=8925431&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8925431&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8925431'>[review]</a>:
-----------------------------------------------------------------

r=me for the extension parts, but they still needs tests (in a separate patch).

The docShell changes need DOM peer review.

::: docshell/base/nsDocShell.cpp
&#64;&#64; +2029,5 &#64;&#64;
<span class="quote">&gt;  
&gt; +  if (mHasLoadedNonBlankURI) {
&gt; +    bool equal;
&gt; +    if (NS_SUCCEEDED(mCurrentURI-&gt;Equals(aURI, &amp;equal))) {
&gt; +      mHasNavigatedFromInitialPage = !equal;</span >

I think this should be something like `if (!succeeded || !equal) mHasNavigated = true`

Otherwise, it should be possible to reset the flag.

Also, we probably want to skip this if LOCATION_CHANGE_SAME_DOCUMENT is set.

::: toolkit/components/extensions/WebExtensionContentScript.h
&#64;&#64; +49,5 &#64;&#64;
<span class="quote">&gt;    // be called for codebase principals.
&gt;    const URLInfo&amp; PrincipalURL() const;
&gt;  
&gt;    bool IsTopLevel() const;
&gt; +  bool ShouldGetActiveTabPermission() const;</span >

Maybe s/Get/Match/?

::: toolkit/components/extensions/WebExtensionPolicy.cpp
&#64;&#64; +88,5 &#64;&#64;
<span class="quote">&gt;    }
&gt;  
&gt;    mContentScripts.SetCapacity(aInit.mContentScripts.Length());
&gt;    for (const auto&amp; scriptInit : aInit.mContentScripts) {
&gt; +    MOZ_ASSERT(!scriptInit.mHasActiveTabPermission);</span >

Maybe make this a diagnostic assert? And set it to false, after the check.

&#64;&#64; +369,1 &#64;&#64;
<span class="quote">&gt;    return MatchesURI(aDoc.PrincipalURL());</span >

Maybe make this an else, just to make it clear that the last `if` breaks the pattern above of returning false on failure, but never returning true.

&#64;&#64; +447,5 &#64;&#64;
<span class="quote">&gt; +  if (mShouldGetActiveTabPermission.isNothing()) {
&gt; +    struct Matcher
&gt; +    {
&gt; +      bool match(Window aWin) {
&gt; +        // XXX ASSERT aWin not null</span >

Why not just add the assertion?

&#64;&#64; +461,5 &#64;&#64;
<span class="quote">&gt; +
&gt; +        if (docshell-&gt;GetCreatedDynamically() ||
&gt; +            docshell-&gt;GetHasNavigatedFromInitialPage()) {
&gt; +          return false;
&gt; +        }</span >

Maybe something like:

   if (nsIDocShell* docShell = aWin-&gt;GetDocShell()) {
     return !docShell-&gt;GetCreatedDynamically() &amp;&amp; !docShell-&gt;GetHasNavigetedFromInitialPage();
   }
   return false;</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925431&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8925431</a> -
        Flags: review?(kmaglione+bmo) &rarr; review+</div></div></div><div class="change-set" id="c26"><div class="comment" data-id="12829784" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5499931_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 20:33 PST" data-time="1510201988">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="12829784">(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c25">comment #25</a>)
<span class="quote">&gt; ::: toolkit/components/extensions/WebExtensionPolicy.cpp
&gt; &#64;&#64; +88,5 &#64;&#64;
&gt; &gt;    }
&gt; &gt;  
&gt; &gt;    mContentScripts.SetCapacity(aInit.mContentScripts.Length());
&gt; &gt;    for (const auto&amp; scriptInit : aInit.mContentScripts) {
&gt; &gt; +    MOZ_ASSERT(!scriptInit.mHasActiveTabPermission);
&gt; 
&gt; Maybe make this a diagnostic assert? And set it to false, after the check.</span >

aInit is const, do you suggest making a copy?  That seems like small overhead but totally unnecessary in most (hopefully all) cases.

<span class="quote">&gt; &#64;&#64; +447,5 &#64;&#64;
&gt; &gt; +  if (mShouldGetActiveTabPermission.isNothing()) {
&gt; &gt; +    struct Matcher
&gt; &gt; +    {
&gt; &gt; +      bool match(Window aWin) {
&gt; &gt; +        // XXX ASSERT aWin not null
&gt; 
&gt; Why not just add the assertion?</span >

Whoops, i didn't mean to leave that in, I just removed the comment.</pre></div><div class="change-set" id="c27"><div class="comment" data-id="12829792" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a5499931_561655"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 20:39 PST" data-time="1510202384">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="12829792">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c26">comment #26</a>)
<span class="quote">&gt; (In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're
&gt; blocked) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c25">comment #25</a>)
&gt; &gt; ::: toolkit/components/extensions/WebExtensionPolicy.cpp
&gt; &gt; &#64;&#64; +88,5 &#64;&#64;
&gt; &gt; &gt;    }
&gt; &gt; &gt;  
&gt; &gt; &gt;    mContentScripts.SetCapacity(aInit.mContentScripts.Length());
&gt; &gt; &gt;    for (const auto&amp; scriptInit : aInit.mContentScripts) {
&gt; &gt; &gt; +    MOZ_ASSERT(!scriptInit.mHasActiveTabPermission);
&gt; &gt; 
&gt; &gt; Maybe make this a diagnostic assert? And set it to false, after the check.
&gt; 
&gt; aInit is const, do you suggest making a copy?  That seems like small
&gt; overhead but totally unnecessary in most (hopefully all) cases.</span >

Hm. Fair enough. Maybe just throw and return rather than asserting, then.</pre></div><div class="change-set" id="c28"><div class="comment" data-id="12830018" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5499931_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 23:25 PST" data-time="1510212347">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8926757"
         class="attachment patch obsolete"
         data-id="8926757" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-0a61683d8387">
      <meta itemprop="contentSize" content="13996">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8926757">
          <a class="link" href="attachment.cgi?id=8926757&amp;action=diff">
        <span id="att-8926757-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8926757&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926757">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-28" data-comment-id="12830018">MozReview-Commit-ID: 9xPDX8Qk2iR</pre></div><div class="change-set" id="c29"><div class="comment" data-id="12830019" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5499931_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5499931_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 23:26 PST" data-time="1510212361">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8926758"
         class="attachment patch obsolete"
         data-id="8926758" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-f4ea902a7d44">
      <meta itemprop="contentSize" content="13152">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8926758">
          <a class="link" href="attachment.cgi?id=8926758&amp;action=diff">
        <span id="att-8926758-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8926758&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926758">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-29" data-comment-id="12830019">MozReview-Commit-ID: DyVtSuA9voI</pre></div><div class="change-set" id="a5759223_561655"><div class="change" id="aa5759223_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759223_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a5759223_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5759223_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5759223_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a5759223_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 23:26 PST" data-time="1510212384">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8925431&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8925431</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a5759363_561655"><div class="change" id="aa5759363_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5759363_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5759363_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a5759363_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 23:28 PST" data-time="1510212524">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926758&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8926758</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c30"><div class="comment" data-id="12830026" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-08 23:28 PST" data-time="1510212536">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8926760"
         class="attachment patch obsolete"
         data-id="8926760" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-48d0a3bc2503">
      <meta itemprop="contentSize" content="13049">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8926760">
          <a class="link" href="attachment.cgi?id=8926760&amp;action=diff">
        <span id="att-8926760-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8926760&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8926760">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-30" data-comment-id="12830026">MozReview-Commit-ID: DyVtSuA9voI</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926760&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8926760</a> -
        Flags: review?(kmaglione+bmo)</div></div></div><div class="change-set" id="c31"><div class="comment" data-id="12832585" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a5759363_561655"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 15:56 PST" data-time="1510271781">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="12832585">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8926757" name="attach_8926757" title="Clarify rules for applying activeTab permission to content scripts">attachment 8926757</a> <a href="/attachment.cgi?id=8926757&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8926757&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8926757'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8926757" name="attach_8926757" title="Clarify rules for applying activeTab permission to content scripts">attachment 8926757</a> <a href="/attachment.cgi?id=8926757&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8926757&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8926757'>[review]</a>:
-----------------------------------------------------------------

I'm just going to assume you intended to r? me on this.

::: docshell/base/nsDocShell.cpp
&#64;&#64; +2035,5 &#64;&#64;
<span class="quote">&gt;  
&gt; +  if (mHasLoadedNonBlankURI &amp;&amp; !(aLocationFlags &amp; LOCATION_CHANGE_SAME_DOCUMENT)) {
&gt; +    bool equal;
&gt; +    nsresult rv = mCurrentURI-&gt;Equals(aURI, &amp;equal);
&gt; +    if (!NS_SUCCEEDED(rv) || !equal) {</span >

No need for the `rv` here. This would normally be written as `if (NS_FAILED(Equal(&amp;equal)) || !equal)`

::: toolkit/components/extensions/WebExtensionPolicy.cpp
&#64;&#64; -378,5 &#64;&#64;
<span class="quote">&gt;    }
&gt;  
&gt; -  if (AddonManagerWebAPI::IsValidSite(aURL.URI())) {
&gt; -    return false;
&gt; -  }</span >

The more I think about this, the more I think we should also keep this check in `MatchesURI`, even if it is redundant. We don't currently call this function anywhere else, but we do expose it to JS, and it might lead to a future footgun.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926757&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8926757</a> -
        Flags: review+</div></div></div><div class="change-set" id="c32"><div class="comment" data-id="12832608" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a5759363_561655"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 16:07 PST" data-time="1510272470">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="12832608">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8926760" name="attach_8926760" title="Test for content scripts and activeTab permission">attachment 8926760</a> <a href="/attachment.cgi?id=8926760&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8926760&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8926760'>[review]</a>
Test for content scripts and activeTab permission

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8926760" name="attach_8926760" title="Test for content scripts and activeTab permission">attachment 8926760</a> <a href="/attachment.cgi?id=8926760&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8926760&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8926760'>[review]</a>:
-----------------------------------------------------------------

::: testing/specialpowers/content/SpecialPowersObserverAPI.js
&#64;&#64; +643,5 &#64;&#64;
<span class="quote">&gt;          extension.testMessage(...aMessage.data.args);
&gt;          return undefined;
&gt;        }
&gt;  
&gt; +      case &quot;SPExtensionGrantActiveTab&quot;: {</span >

SpecialPowers APIs are so ugly... *sigh*

::: toolkit/components/extensions/test/mochitest/test_ext_contentscript_activeTab.html
&#64;&#64; +31,5 &#64;&#64;
<span class="quote">&gt; +      let frame = document.getElementById(&quot;frame&quot;);
&gt; +      frame.addEventListener(&quot;load&quot;, () =&gt; {
&gt; +        browser.test.sendMessage(&quot;frame-navigated&quot;);
&gt; +      }, {once: true});
&gt; +      frame.src = &quot;<a rel="nofollow" href="http://test2.example.com">http://test2.example.com</a>&quot;;</span >

Nit: Please add a trailing / to the URL. It's technically illegal without one, but it gets fixed-up during parsing.

&#64;&#64; +41,5 &#64;&#64;
<span class="quote">&gt; +        try {
&gt; +          result = await browser.tabs.executeScript(tab.id, {
&gt; +            allFrames: true,
&gt; +            code: &quot;window.location.href;&quot;,
&gt; +          });</span >

Maybe something like `let result = await executeScript(...).catch(err =&gt; ({error: err.message}))` ?

&#64;&#64; +87,5 &#64;&#64;
<span class="quote">&gt; +
&gt; +  extension.sendMessage(&quot;execute&quot;);
&gt; +  result = await extension.awaitMessage(&quot;result&quot;);
&gt; +  is(result.length, 2, &quot;Script was injected into 2 frames&quot;);
&gt; +  let hosts = result.map(href =&gt; new URL(href).hostname);</span >

Nit: Maybe just send back `location.origin` from the content script rather than parsing the URLs for hostnames in every test?

&#64;&#64; +89,5 &#64;&#64;
<span class="quote">&gt; +  result = await extension.awaitMessage(&quot;result&quot;);
&gt; +  is(result.length, 2, &quot;Script was injected into 2 frames&quot;);
&gt; +  let hosts = result.map(href =&gt; new URL(href).hostname);
&gt; +  ok(hosts.includes(BASE_HOST), &quot;Script was injected into base page&quot;);
&gt; +  ok(hosts.includes(FRAME_HOST), &quot;Script was injected into original frame&quot;);</span >

Maybe just .sort() and use `Assert.deepEqual()` rather than checking the length and then doing two .include() checks? Would make it a bit clearer exactly what's going on...</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926760&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8926760</a> -
        Flags: review?(kmaglione+bmo) &rarr; review+</div></div></div><div class="change-set" id="c33"><div class="comment" data-id="12833027" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:06 PST" data-time="1510290385">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8927170"
         class="attachment patch obsolete"
         data-id="8927170" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-f98c002b37df">
      <meta itemprop="contentSize" content="13417">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8927170">
          <a class="link" href="attachment.cgi?id=8927170&amp;action=diff">
        <span id="att-8927170-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8927170&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8927170">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-33" data-comment-id="12833027">MozReview-Commit-ID: 9xPDX8Qk2iR</pre></div><div class="change-set" id="c34"><div class="comment" data-id="12833030" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:06 PST" data-time="1510290399">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8927171"
         class="attachment patch obsolete"
         data-id="8927171" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-2c99f80acc97">
      <meta itemprop="contentSize" content="12709">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8927171">
          <a class="link" href="attachment.cgi?id=8927171&amp;action=diff">
        <span id="att-8927171-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8927171&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8927171">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-34" data-comment-id="12833030">MozReview-Commit-ID: DyVtSuA9voI</pre></div><div class="change-set" id="c35"><div class="comment" data-id="12833035" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:07 PST" data-time="1510290471">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="12833035">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8927170" name="attach_8927170" title="Clarify rules for applying activeTab permission to content scripts">attachment 8927170</a> <a href="/attachment.cgi?id=8927170&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8927170&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8927170'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

carry over r+ from kmag from the previous patch after addressing his comments</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Flags: review+</div></div></div><div class="change-set" id="c36"><div class="comment" data-id="12833036" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5759363_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5759363_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:08 PST" data-time="1510290503">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="12833036">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8927171" name="attach_8927171" title="Test for content scripts and activeTab permission">attachment 8927171</a> <a href="/attachment.cgi?id=8927171&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8927171&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8927171'>[review]</a>
Test for content scripts and activeTab permission

carry over r+ from kmag from the previous patch after addressing his comments</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927171&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8927171</a> -
        Flags: review+</div></div></div><div class="change-set" id="a5837361_561655"><div class="change" id="aa5837361_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5837361_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a5837361_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5837361_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5837361_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a5837361_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:08 PST" data-time="1510290522">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926757&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8926757</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a5837375_561655"><div class="change" id="aa5837375_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5837375_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a5837375_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5837375_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5837375_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a5837375_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:08 PST" data-time="1510290536">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8926760&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8926760</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c37"><div class="comment" data-id="12833042" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a5837375_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a5837375_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-09 21:16 PST" data-time="1510290985">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="12833042">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8927170" name="attach_8927170" title="Clarify rules for applying activeTab permission to content scripts">attachment 8927170</a> <a href="/attachment.cgi?id=8927170&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8927170&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8927170'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

[Security approval request comment]
How easily could an exploit be constructed based on the patch?
Relatively easily by somebody who understands the code

Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?
The tests are in a separate patch that can be landed separately.  I've tried to avoid any comments in the code or the checkin summary that point toward the problem.

Which older supported branches are affected by this flaw?
I believe all supported branches (release, beta, esr) are affected.

If not all supported branches, which bug introduced the flaw?

Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?
This should backport easily to 57.  A backport to ESR would be rather difficult.

How likely is this patch to cause regressions; how much testing does it need?
The patch touches docshell which is heavily used, but it is small and follows our established practices so the risk should be low.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Flags: sec-approval?</div><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c38"><div class="comment" data-id="12841175" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a5837375_561655"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a5837375_561655"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-13 17:16 PST" data-time="1510622179">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="12841175">Sec-approval+ for checkin on November 28, two weeks into the new cycle. Please do not check in before that date.

We'll want this on other branches so branch patches should be made and nominated at that time as well. If you don't think we can easily do ESR52 (as mentioned in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c37">comment 37</a>) then we can go without it since it isn't that long until the next ESR branch.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=isnotempty">status-firefox57</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=isnotempty">status-firefox58</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=isnotempty">status-firefox59</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=isnotempty">tracking-firefox58</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox58&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=isnotempty">tracking-firefox59</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">Whiteboard: [checkin on 11/28]</div></div></div><div class="change-set" id="a6169030_280903"><div class="change" id="aa6169030_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a6169030_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6169030_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6169030_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a6169030_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-13 17:16 PST" data-time="1510622191">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Flags: sec-approval? &rarr; sec-approval+</div></div></div><div class="change-set" id="c39"><div class="comment" data-id="12852733" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 08:02 PST" data-time="1510934561">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="12852733">bz: this patch needs review from a DOM peer, I'm sure you're busy, should I redirect to somebody else?
This is still a week and a half from landing but I'm going to be on PTO most of next week and was hoping to get the review done before leaving.  If you're pinched for time, focusing on the docshell bits and ignoring the webextensions bits (which kmag reviwed) should be fine.

And abillings: should the patch and the tests be checked in on 11/28 or should the tests be held for some time?</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div><div class="change">Flags: needinfo?(abillings)</div></div></div><div class="change-set" id="c40"><div class="comment" data-id="12853224" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 10:40 PST" data-time="1510944005">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="12853224">I'm working on this as we speak.  I've been trying to make sure I actually think through the threat model here...</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c41"><div class="comment" data-id="12853255" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 10:51 PST" data-time="1510944671">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="12853255">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8927170" name="attach_8927170" title="Clarify rules for applying activeTab permission to content scripts">attachment 8927170</a> <a href="/attachment.cgi?id=8927170&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8927170&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8927170'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

<span class="quote">&gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399">Bug 1396399</a> Clarify rules for applying activeTab permission to content scripts</span >

This needs a much better commit message, unless that would expose the security issue.  It should describe what the new rules are and why the particular rules we're changing to are the ones we want.  This is part of what made this review so slow.  I've had to reverse-engineer the intent from the patch.  I probably should have just brought this up immediately instead.  :(

<span class="quote">&gt;+  , mHasNavigatedFromInitialPage(false)</span >

I don't understand the desired semantics of mHasNavigatedFromInitialPage.

If I do window.open(url), should that really have different semantics from:

  var w = window.open();
  setTimeout(function() { w.location.href = url }, 100);

?  It looks to me like the former would have mHasNavigatedFromInitialPage false while the latter has it true.

Same thing for &lt;iframe&gt; created without src and then getting it src attribute set.

<span class="quote">&gt;+  NS_ENSURE_ARG_POINTER(aResult);</span >

Please don't.  Callers just shouldn't do that.

<span class="quote">&gt;+    if (scriptInit.mHasActiveTabPermission) {
&gt;+      aRv.Throw(NS_ERROR_INVALID_ARG);</span >

I'm not sure I follow.  At the very least, this needs a comment explaining why.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Flags: review?(bzbarsky) &rarr; review-</div></div></div><div class="change-set" id="c42"><div class="comment" data-id="12853302" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 11:09 PST" data-time="1510945784">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="12853302">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c41">comment #41</a>)
<span class="quote">&gt; &gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399">Bug 1396399</a> Clarify rules for applying activeTab permission to content scripts
&gt; 
&gt; This needs a much better commit message, unless that would expose the
&gt; security issue.</span >

That (exposing the issue) is what I was concerned about.  I'm happy to expand on the commit message, but could use some feedback on how much is okay (ie from security).
Regardless, sorry for the confusion :/

<span class="quote">&gt; &gt;+  , mHasNavigatedFromInitialPage(false)
&gt; 
&gt; I don't understand the desired semantics of mHasNavigatedFromInitialPage.
&gt; 
&gt; If I do window.open(url), should that really have different semantics from:
&gt; 
&gt;   var w = window.open();
&gt;   setTimeout(function() { w.location.href = url }, 100);
&gt; 
&gt; ?  It looks to me like the former would have mHasNavigatedFromInitialPage
&gt; false while the latter has it true.</span >

Yes, that is desired for this particular scenario.  This case may be rather narrow but consider a page that has a blank iframe and an extension that has the activeTab permission (but no specific host permissions).  The extension can navigate the frame to some new URL, then inject a content script with allFrames: true and now they've managed to inject a script at a site that they should not have access to.  If we could distinguish when the extension is the one navigating the frame perhaps we could use that, but I don't think we actually can make that distinction in a foolproof way.
(If the above has too much WebExtensions jargon please ask for clarification, I'd be glad to clear it up here or on IRC or whatever)</pre></div><div class="change-set" id="c43"><div class="comment" data-id="12853384" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 11:32 PST" data-time="1510947166">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-43" data-comment-id="12853384"><span class="quote">&gt; I'm happy to expand on the commit message, but could use some feedback on how much is okay (ie from security).</span >

Can we start with a writeup in this bug of what the commit message would be if we ignore security considerations?

So if I understand correctly, if an extension has activeTab permissions we _do_ want to allow it to interact with cross-origin iframes the page itself loads, but not ones the extension loads?

Can the extension not inject the blank iframe itself?  Can it not inject an iframe with src already set?</pre></div><div class="change-set" id="c44"><div class="comment" data-id="12853407" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 11:38 PST" data-time="1510947500">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="12853407">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c43">comment #43</a>)
<span class="quote">&gt; So if I understand correctly, if an extension has activeTab permissions we
&gt; _do_ want to allow it to interact with cross-origin iframes the page itself
&gt; loads, but not ones the extension loads?</span >

Correct, but only frames created by the network parser. It's too easy for the extensions to create frames from the context of content JS.

<span class="quote">&gt; Can the extension not inject the blank iframe itself?  Can it not inject an
&gt; iframe with src already set?</span >

It can, but we're only allowing access to frames that were network-created.</pre></div><div class="change-set" id="c45"><div class="comment" data-id="12853428" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 11:44 PST" data-time="1510947872">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-45" data-comment-id="12853428">Ah, I see.  So the key part is that we're restricting this to &lt;iframe&gt; elements that have an src when they come out of the HTML parser, _and_ excluding cases when that parser is document.write() or innerHTML or whatever.

What happens if the extension injects something like:

  &lt;iframe srcdoc=&quot;&lt;iframe src=whatever&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;

Does that inner iframe get treated as &quot;created by the network parser&quot;?  If so, how is it handled by this setup?</pre></div><div class="change-set" id="c46"><div class="comment" data-id="12853445" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 11:51 PST" data-time="1510948267">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-46" data-comment-id="12853445">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c45">comment #45</a>)
<span class="quote">&gt; What happens if the extension injects something like:
&gt; 
&gt;   &lt;iframe srcdoc=&quot;&lt;iframe src=whatever&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;
&gt; 
&gt; Does that inner iframe get treated as &quot;created by the network parser&quot;?  If
&gt; so, how is it handled by this setup?</span >

That's a good question. I suspect that it does, but I'm not sure. We should test it.

I think we can solve that problem by checking the activeTab permission for parent frames when we do the matching.</pre></div><div class="change-set" id="c47"><div class="comment" data-id="12853536" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 12:32 PST" data-time="1510950731">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-47" data-comment-id="12853536">I assume we can't easily leverage the &quot;use the extension as the triggering principal for loads it starts&quot; work, because that doesn't actually happen in all the cases we care about?

(Plus of course it doesn't handle confused-deputy issues...)</pre></div><div class="change-set" id="c48"><div class="comment" data-id="12853550" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 12:37 PST" data-time="1510951030">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-48" data-comment-id="12853550">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c47">comment #47</a>)
<span class="quote">&gt; I assume we can't easily leverage the &quot;use the extension as the triggering
&gt; principal for loads it starts&quot; work, because that doesn't actually happen in
&gt; all the cases we care about?
&gt; 
&gt; (Plus of course it doesn't handle confused-deputy issues...)</span >

At this point, it's more that the extension can always do things using the page principal if it wants, using wrappedJSObject, eval, or injecting script nodes. I don't think there's really any reasonable way we can prevent that. I wish we could, though...</pre></div><div class="change-set" id="c49"><div class="comment" data-id="12853914" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 14:22 PST" data-time="1510957363">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-49" data-comment-id="12853914">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c45">comment #45</a>)
<span class="quote">&gt; What happens if the extension injects something like:
&gt; 
&gt;   &lt;iframe srcdoc=&quot;&lt;iframe src=whatever&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;
&gt; 
&gt; Does that inner iframe get treated as &quot;created by the network parser&quot;?  If
&gt; so, how is it handled by this setup?</span >

I tried this out and in my test, we never get around to checking hasNavigated.. since Matches() returns false here:
<a rel="nofollow" href="https://searchfox.org/mozilla-central/rev/9bab9dc5a9472e3c163ab279847d2249322c206e/toolkit/components/extensions/WebExtensionPolicy.cpp#338-340">https://searchfox.org/mozilla-central/rev/9bab9dc5a9472e3c163ab279847d2249322c206e/toolkit/components/extensions/WebExtensionPolicy.cpp#338-340</a>

This is over my head, I defer to kmag and bz to evaluate whether this is sufficient.</pre></div><div class="change-set" id="c50"><div class="comment" data-id="12853965" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 14:41 PST" data-time="1510958515">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-50" data-comment-id="12853965">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c49">comment #49</a>)
<span class="quote">&gt; I tried this out and in my test, we never get around to checking
&gt; hasNavigated.. since Matches() returns false here:
&gt; <a rel="nofollow" href="https://searchfox.org/mozilla-central/rev/">https://searchfox.org/mozilla-central/rev/</a>
&gt; 9bab9dc5a9472e3c163ab279847d2249322c206e/toolkit/components/extensions/
&gt; WebExtensionPolicy.cpp#338-340</span >

That will return false for the srcdoc iframe, but not for the iframe loaded from the parsed srcdoc attribute. Which may not actually exist in bz's actual example, depending on how the HTML parser deals with the invalid syntax from a &gt; being present in an attribute value, but, e.g.:

  &lt;iframe srcdoc=&quot;&lt;iframe src='<a rel="nofollow" href="http://example.com/'&amp;gt">http://example.com/'&amp;gt</a>;&lt;/iframe&amp;gt&gt;&quot;&gt;&lt;/iframe&gt;

for instance, should still wind up loading a content script into the example.com iframe.</pre></div><div class="change-set" id="c51"><div class="comment" data-id="12853991" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 14:50 PST" data-time="1510959038">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-51" data-comment-id="12853991">(In reply to Kris Maglione [:kmag] (long backlog; ping on IRC if you're blocked) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c50">comment #50</a>)
<span class="quote">&gt; (In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c49">comment #49</a>)
&gt; &gt; I tried this out and in my test, we never get around to checking
&gt; &gt; hasNavigated.. since Matches() returns false here:
&gt; &gt; <a rel="nofollow" href="https://searchfox.org/mozilla-central/rev/">https://searchfox.org/mozilla-central/rev/</a>
&gt; &gt; 9bab9dc5a9472e3c163ab279847d2249322c206e/toolkit/components/extensions/
&gt; &gt; WebExtensionPolicy.cpp#338-340
&gt; 
&gt; That will return false for the srcdoc iframe, but not for the iframe loaded
&gt; from the parsed srcdoc attribute. Which may not actually exist in bz's
&gt; actual example, depending on how the HTML parser deals with the invalid
&gt; syntax from a &gt; being present in an attribute value, but, e.g.:
&gt; 
&gt;   &lt;iframe srcdoc=&quot;&lt;iframe
&gt; src='<a rel="nofollow" href="http://example.com/'&amp;gt">http://example.com/'&amp;gt</a>;&lt;/iframe&amp;gt&gt;&quot;&gt;&lt;/iframe&gt;
&gt; 
&gt; for instance, should still wind up loading a content script into the
&gt; example.com iframe.</span >

Yes, I fixed that in my test.  What I actually ended up with in the top-level doc is (as copied from devtools Inspector):
&lt;iframe style=&quot;display: block;&quot; srcdoc=&quot;&lt;iframe src=&amp;quot;<a rel="nofollow" href="http://example.com/&amp;quot">http://example.com/&amp;quot</a>;&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;

The inner iframe didn't actually load anything from example.com though...</pre></div><div class="change-set" id="c52"><div class="comment" data-id="12854012" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 14:56 PST" data-time="1510959381">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="12854012">`&gt;` ends an element declaration, even when it appears in an attribute value. At least in theory. But it looks like our tag soup parser currently accepts it, and:

  document.body.innerHTML=`&lt;iframe srcdoc=&quot;&lt;iframe src='<a rel="nofollow" href="http://example.com/">http://example.com/</a>'&gt;&lt;/iframe&gt;&quot;&gt;&lt;/iframe&gt;`

does appear to actually create an iframe with an example.com iframe loaded into it.</pre></div><div class="change-set" id="c53"><div class="comment" data-id="12854038" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 15:07 PST" data-time="1510960041">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="12854038">Bleah, never mind <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c49">comment 49</a>, the inner frame was blocked by the CSP of the outer frame in my test.
With that removed, the script is indeed injected into the inner frame.</pre></div><div class="change-set" id="c54"><div class="comment" data-id="12854323" data-no="54"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-54" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-54"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-54" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c54">Comment 54</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 19:41 PST" data-time="1510976460">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-54">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8929679"
         class="attachment patch obsolete"
         data-id="8929679" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-3a61e90945c1">
      <meta itemprop="contentSize" content="13584">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8929679">
          <a class="link" href="attachment.cgi?id=8929679&amp;action=diff">
        <span id="att-8929679-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8929679&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8929679">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-54" data-comment-id="12854323">Addressed the srcdoc case that :bz raised, also addressed his other
review comments.  I haven't updated the commit summary or description,
I think recent comments on the bug have cleared up any oustanding
questions for people who have access to the bug.  If more detail in
the commit message is wanted, I'm happy to revise it.
Additional test case to come shortly.

MozReview-Commit-ID: 9xPDX8Qk2iR</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8929679&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8929679</a> -
        Flags: review?(kmaglione+bmo)</div><div class="change">
        <a href="/attachment.cgi?id=8929679&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8929679</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c55"><div class="comment" data-id="12854326" data-no="55"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-55" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-55"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-55" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c55">Comment 55</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 19:52 PST" data-time="1510977146">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-55">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-55" data-comment-id="12854326">So I'm still a bit confused by the semantics of mHasNavigatedFromInitialPage.  If the page has:

  &lt;iframe&gt;&lt;/iframe&gt;

(no src attribute) and then the extension navigates the iframe to a url of its choosing, what will mHasNavigatedFromInitialPage be set to?  Will the extension get access to the resulting page?</pre><div class="activity"><div class="change">Flags: needinfo?(aswan)</div></div></div><div class="change-set" id="c56"><div class="comment" data-id="12854330" data-no="56"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-56" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a6169030_280903"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-56"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-56" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c56">Comment 56</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 19:58 PST" data-time="1510977485">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-56">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-56" data-comment-id="12854330">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c55">comment #55</a>)
<span class="quote">&gt; So I'm still a bit confused by the semantics of
&gt; mHasNavigatedFromInitialPage.  If the page has:
&gt; 
&gt;   &lt;iframe&gt;&lt;/iframe&gt;
&gt; 
&gt; (no src attribute) and then the extension navigates the iframe to a url of
&gt; its choosing, what will mHasNavigatedFromInitialPage be set to?  Will the
&gt; extension get access to the resulting page?</span >

It shouldn't, but we should make sure that's tested.</pre></div><div class="change-set" id="c57"><div class="comment" data-id="12854338" data-no="57"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-57" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a6169030_280903"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-57"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-57" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c57">Comment 57</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 20:32 PST" data-time="1510979542">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-57">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-57" data-comment-id="12854338">Yep, that case isn't handled correctly.
Perhaps mHasNavigatedFromInitialPage is poorly named but the desired semantics are something like &quot;false if this page/frame is what was originally loaded from the network, true if it is possible that a script has caused this page/frame to load something from a different source&quot;.
My first pass at this involved monkeying around with nsGenericHTMLFrameElement and that got kind of messy but it seems like this particular case isn't going to be detectable from the docshell and we'll have to go back to the frame element and track whether any of the frame's attributes have been changed?  Any suggestions for simpler alternatives would be gratefully welcomed...</pre></div><div class="change-set" id="c58"><div class="comment" data-id="12854346" data-no="58"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-58" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-58"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-58" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c58">Comment 58</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-17 20:51 PST" data-time="1510980691">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-58">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-58" data-comment-id="12854346">I agree that it's not clear how to detect this stuff from the docshell right now.

So one option is that the first time nsGenericHTMLFrameElement::LoadSrc reaches the mFrameLoader-&gt;LoadFrame() line for a given element that came from network, we indicate that to nsFrameLoader::LoadFrame somehow.  This will, in practice, mean the load when we get inserted into the document.

I agree that threading this information through LoadFrame, LoadURI, frameloader initialization, etc, is a pain.  I'm not seeing an obvious better option, though...</pre></div><div class="change-set" id="c59"><div class="comment" data-id="12854982" data-no="59"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-59" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a6169030_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-59"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-59" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c59">Comment 59</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-18 13:21 PST" data-time="1511040098">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-59">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-59" data-comment-id="12854982">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c39">comment #39</a>)
 
<span class="quote">&gt; And abillings: should the patch and the tests be checked in on 11/28 or
&gt; should the tests be held for some time?</span >

No tests. No bug that needs sec-approval should ever land with tests. If it is nightly and beta only, we can check in tests right after it lands on both. Otherwise, tests need to wait until about a month after public release.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(abillings)</span></div></div></div><div class="change-set" id="c60"><div class="comment" data-id="12859533" data-no="60"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-60" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a6169030_280903"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-60"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-60" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c60">Comment 60</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-20 10:45 PST" data-time="1511203531">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-60">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-60" data-comment-id="12859533">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c20">comment #20</a>)
<span class="quote">&gt; (In reply to Paul Theriault [:pauljt] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c19">comment #19</a>)
&gt; &gt;  a) the top-level window of the current tab
&gt; &gt;  b) Any iframes which are declared in the HTML of the document
&gt; &gt; 
&gt; &gt; I was expecting just (a), but if you would prefer (a)&amp; (b) for compat
&gt; &gt; reasons, that seems to make sense too. My goal here is to ensure that
&gt; &gt; activeTab is significantly less privileged than &lt;all_urls&gt;.
&gt; 
&gt; Right a&amp;b is what Chrome does and is what is proposed here.</span >

In theory a&amp;b matches a user's expectation and Chrome compat is important, so I'm OK with it in theory. But implementing (b) raises all kinds of edge cases (some of which bz notes in comments above) that I worry in practice we won't be plugging the hole.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div></div></div><div class="change-set" id="c61"><div class="comment" data-id="12859547" data-no="61"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-61" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6169030_280903"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a6169030_280903"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-61"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-61" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c61">Comment 61</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-20 10:52 PST" data-time="1511203965">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-61">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-61" data-comment-id="12859547">(In reply to Ronen Zilberman from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c11">comment #11</a>)
<span class="quote">&gt; &quot;sec-high&quot; allows &quot;Obtaining confidential data from other sites the user is
&gt; visiting, or inject data or code into those sites, requiring no more than normal
&gt; browsing actions.&quot; (assuming installing an add-on is normal browsing actions).</span >

&quot;normal browsing&quot; means with an unmodified browser; an attack like that can affect all our users. Installing an extension of any kind is already granting extra power that would be considered a security hole if a web page suddenly started doing it.</pre></div><div class="change-set" id="c62"><div class="comment" data-id="12861026" data-no="62"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-62" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6169030_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6169030_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-62"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-62" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c62">Comment 62</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-20 20:52 PST" data-time="1511239928">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-62">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-62" data-comment-id="12861026">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8929679" name="attach_8929679" title="Clarify rules for applying activeTab permission to content scripts">attachment 8929679</a> <a href="/attachment.cgi?id=8929679&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8929679&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8929679'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Clearing review request until <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c55">comment 55</a> is addressed.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8929679&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8929679</a> -
        Flags: <span class="activity-deleted">review?(bzbarsky)</span></div></div></div><div class="change-set" id="a6788482_561655"><div class="change" id="aa6788482_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a6788482_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a6788482_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6788482_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6788482_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a6788482_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-20 21:20 PST" data-time="1511241643">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8929679&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8929679</a> -
        Attachment is obsolete: true</div><div class="change">Flags: <span class="activity-deleted">needinfo?(aswan)</span></div><div class="change">
        <a href="/attachment.cgi?id=8929679&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8929679</a> -
        Flags: <span class="activity-deleted">review?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="a7445773_75935"><div class="change" id="aa7445773_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a7445773_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a7445773_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7445773_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7445773_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a7445773_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-28 11:55 PST" data-time="1511898934">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Whiteboard: <span class="activity-deleted">[checkin on 11/28]</span></div></div></div><div class="change-set" id="c63"><div class="comment" data-id="12881921" data-no="63"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-63" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_255243" id="a7445773_75935"><img src="https://secure.gravatar.com/avatar/02588af8894bf993b88e868d0d0a24de?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_255243" id="a7445773_75935"><a class="email " href="/user_profile?user_id=255243" > <span class="fna">Ronen Zilberman</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-63"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-63" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c63">Comment 63</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-28 17:56 PST" data-time="1511920591">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-63">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-63" data-comment-id="12881921">I haven't followed this thread for a while, so I wanted to chip in.
If I understand your proposed solution correctly, the idea is that with ActiveTab an extension can interact with iframes that were loaded by the original page, but not with iframes that were loaded by the extension itself.
I'd like to point out that many pages might have &quot;high-value&quot; iframes originally: Facebook Like buttons for example, are implemented as an iframe pointing to facebook.com. This means that if a page has a Like button, an extension with &quot;ActiveTab&quot; can steal that user's cookies and therefor identity. Google ads might be the same case.</pre></div><div class="change-set" id="c64"><div class="comment" data-id="12887349" data-no="64"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-64" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7445773_75935"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a7445773_75935"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-64"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-64" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c64">Comment 64</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 10:42 PST" data-time="1512067336">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-64">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8933408"
         class="attachment patch obsolete"
         data-id="8933408" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-1c57a8345f96">
      <meta itemprop="contentSize" content="14811">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8933408">
          <a class="link" href="attachment.cgi?id=8933408&amp;action=diff">
        <span id="att-8933408-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8933408&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8933408">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-64" data-comment-id="12887349">Here's an update based on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c58">comment 58</a>.  But you lost me with the bit about
connecting this logic to nsFrameLoader.  If there's something I'm missing
here can you help me connect the dots?

MozReview-Commit-ID: 9xPDX8Qk2iR</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8933408&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8933408</a> -
        Flags: feedback?(bzbarsky)</div></div></div><div class="change-set" id="a7614200_561655"><div class="change" id="aa7614200_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7614200_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a7614200_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7614200_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7614200_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a7614200_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 10:42 PST" data-time="1512067361">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927170&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8927170</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c65"><div class="comment" data-id="12887656" data-no="65"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-65" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a7614200_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a7614200_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-65"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-65" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c65">Comment 65</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 12:14 PST" data-time="1512072861">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-65">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-65" data-comment-id="12887656">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8933408" name="attach_8933408" title="Clarify rules for applying activeTab permission to content scripts">attachment 8933408</a> <a href="/attachment.cgi?id=8933408&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8933408&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8933408'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

I _think_ there's a hole here, but please correct me if I'm wrong.

Say the page has &lt;iframe src=&quot;foo&quot;&gt;.  We go through nsGenericHTMLFrameElement, set mLoadCount to 1.

Then a navigation is performed by setting frame.contentWindow.location.href.  The docshell is not created dynamically, nsContentUtils::IsNavigatedFrame returns false, right?  So we're going to end up returning true from ShouldMatchActiveTabPermission(), but the desired behavior is to return false, I would think.  We should make sure to add a corresponding test.  And tests for all the other edge cases we've considered in this bug so far...

That is, we need to keep track of whether the thing we're looking at was in fact loaded from the src attribute of the element, not just of how many loads were done from that src attribute.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8933408&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8933408</a> -
        Flags: feedback?(bzbarsky) &rarr; feedback-</div></div></div><div class="change-set" id="c66"><div class="comment" data-id="12887963" data-no="66"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-66" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7614200_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a7614200_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-66"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-66" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c66">Comment 66</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 13:51 PST" data-time="1512078702">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-66">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8933464"
         class="attachment patch obsolete"
         data-id="8933464" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-b148f322d3eb">
      <meta itemprop="contentSize" content="14118">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8933464">
          <a class="link" href="attachment.cgi?id=8933464&amp;action=diff">
        <span id="att-8933464-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8933464&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8933464">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-66" data-comment-id="12887963">MozReview-Commit-ID: DyVtSuA9voI</pre></div><div class="change-set" id="a7625556_561655"><div class="change" id="aa7625556_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7625556_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a7625556_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7625556_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7625556_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a7625556_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 13:51 PST" data-time="1512078717">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8927171&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8927171</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c67"><div class="comment" data-id="12888243" data-no="67"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-67" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7625556_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a7625556_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-67"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-67" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c67">Comment 67</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-30 15:07 PST" data-time="1512083274">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-67">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-67" data-comment-id="12888243">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c65">comment #65</a>)
<span class="quote">&gt; I _think_ there's a hole here, but please correct me if I'm wrong.</span >

Nope, you're right, your original comment finally clicked for me with this example.  This is going to be tedious but I (think I) understand what's needed now...</pre></div><div class="change-set" id="a7963428_561655"><div class="change" id="aa7963428_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7963428_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a7963428_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7963428_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7963428_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a7963428_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-04 11:43 PST" data-time="1512416589">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8933408&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8933408</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a7963444_561655"><div class="change" id="aa7963444_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7963444_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a7963444_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7963444_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7963444_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a7963444_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-04 11:43 PST" data-time="1512416605">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8933464&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8933464</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c68"><div class="comment" data-id="12896121" data-no="68"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-68" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7963444_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a7963444_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-68"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-68" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c68">Comment 68</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-04 11:54 PST" data-time="1512417264">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-68">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8934269"
         class="attachment patch obsolete"
         data-id="8934269" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-f9a49dffe011">
      <meta itemprop="contentSize" content="46681">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8934269">
          <a class="link" href="attachment.cgi?id=8934269&amp;action=diff">
        <span id="att-8934269-description" itemprop="description">wip</span></a> (obsolete)
        — <a href="attachment.cgi?id=8934269&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8934269">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-68" data-comment-id="12896121">Here's a snapshot of the work in progress, I've rolled the tests into the
patch just to (hopefully) make it easier to look at for now.  I've done
the rough work from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c58">comment 58</a> but once we get into docshell I quickly
got lost.  In the current patch I just remember the value of the incoming
flag in nsDocShell::LoadURI() but that's clearly too early, if the load
fails or if it ends up occurring in a different shell, we won't do the
right thing.  But I am unsure how to handle this and could use some advice...</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8934269&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8934269</a> -
        Flags: feedback?(bzbarsky)</div></div></div><div class="change-set" id="c69"><div class="comment" data-id="12930231" data-no="69"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-69" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a7963444_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a7963444_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-69"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-69" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c69">Comment 69</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-20 14:19 PST" data-time="1513808360">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-69">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-69" data-comment-id="12930231">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8934269" name="attach_8934269" title="wip">attachment 8934269</a> <a href="/attachment.cgi?id=8934269&amp;action=edit" title="wip">[details]</a> <a href="/attachment.cgi?id=8934269&amp;action=diff" title="wip">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8934269'>[review]</a>
wip

I'm really sorry about the lag.  I was trying to figure out what we're really trying to accomplish here.

So my gut feeling is that trying to store this in members on docshell/frameloader/etc is going to be very fragile.

It seems to me that conceptually we should do something like this:

1)  A frame element &lt;iframe&gt; or &lt;frame&gt; keeps track of whether the load it's doing is for the initial value of the attribute for a parser-created element.  More on this below.

2)  We propagate this information far enough down the callstack to stash it in the LoadInfo of the channel.

3)  When we need to find this information for a given inner window or document, we ask the document channel.

This would handle cases like the page having &lt;iframe&gt;&lt;/iframe&gt; with no src and the extension setting src later, for example....

Note that this sort of needs to operate on inner windows, not outer ones.  I'm not sure why the existing checks are done on outer windows or docshells....

Does that make any sense?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8934269&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8934269</a> -
        Flags: feedback?(bzbarsky) &rarr; feedback-</div></div></div><div class="change-set" id="c70"><div class="comment" data-id="12933124" data-no="70"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-70" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a7963444_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a7963444_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-70"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-70" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c70">Comment 70</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-21 15:49 PST" data-time="1513900164">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-70">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-70" data-comment-id="12933124">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c69">comment #69</a>)
<span class="quote">&gt; I'm really sorry about the lag.  I was trying to figure out what we're
&gt; really trying to accomplish here.</span >

Not to worry, thanks for being patient with the elementary questions and multiple iterations, I'm slowly absorbing everything here...

<span class="quote">&gt; It seems to me that conceptually we should do something like this:
&gt; 
&gt; 1)  A frame element &lt;iframe&gt; or &lt;frame&gt; keeps track of whether the load it's
&gt; doing is for the initial value of the attribute for a parser-created
&gt; element.  More on this below.</span >

To be clear, is the way this information is gathered in the existing patch in nsFrameLoader adequate?

<span class="quote">&gt; 2)  We propagate this information far enough down the callstack to stash it
&gt; in the LoadInfo of the channel.</span >

And do I understand correctly that this is again mostly what the existing patch does but enabling the new INTERNAL_LOAD flag, then copying this into loadInfo inside nsDocShell::DoURILoad() ?

<span class="quote">&gt; Note that this sort of needs to operate on inner windows, not outer ones. 
&gt; I'm not sure why the existing checks are done on outer windows or
&gt; docshells....</span >

The code path in question here begins with an extension doing something like `browser.tabs.executeScript({tabid, {...}})` where tabid just identifies a tab (which corresponds to an outer window right?).  At some point we need to map this to the specific document currently loaded in that tab.  I'm having a hard time grokking all the different components here, is there a difference between accessing `outerWin.GetDoc()` and `outerWin.GetCurrentInnerWindow().GetDoc()`? (I know the syntax there is wrong but you get the idea)

<span class="quote">&gt; Does that make any sense?</span >

I think so, assuming the answer to the questions above isn't &quot;no you're wildly off the mark&quot;</pre></div><div class="change-set" id="c71"><div class="comment" data-id="12933334" data-no="71"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-71" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a7963444_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a7963444_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-71"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-71" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c71">Comment 71</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-12-21 20:21 PST" data-time="1513916461">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-71">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-71" data-comment-id="12933334"><span class="quote">&gt; To be clear, is the way this information is gathered in the existing patch in nsFrameLoader adequate?</span >

Hmm.  I guess we have to use a member there because the load goes async before it needs the &quot;is this the original src?&quot; info, right.

I read over that part just now, and it looks fine.  I wish it were simpler, but I don't see how to do that offhand without major surgery of some sort.

<span class="quote">&gt; And do I understand correctly that this is again mostly what the existing patch does but enabling the new
&gt; INTERNAL_LOAD flag, then copying this into loadInfo inside nsDocShell::DoURILoad() ?</span >

That seems plausible, yes.  I'd like to avoid the mFrameAtOriginalSrc member on docshell.

<span class="quote">&gt; where tabid just identifies a tab (which corresponds to an outer window right?)</span >

Yes.

<span class="quote">&gt; At some point we need to map this to the specific document currently loaded in that tab.</span >

That makes sense.

<span class="quote">&gt; is there a difference between accessing `outerWin.GetDoc()` and `outerWin.GetCurrentInnerWindow().GetDoc()`?</span >

There is not.  I guess my point was that we want to store this &quot;I am the result of this sort of load&quot; information on the document (and then get it from the window's current document), not the docshell.</pre></div><div class="change-set" id="a10415208_561655"><div class="change" id="aa10415208_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a10415208_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a10415208_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a10415208_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a10415208_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a10415208_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-01 20:46 PST" data-time="1514868369">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8934269&amp;action=edit"
           title="wip"
           class=""
        >Attachment #8934269</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c72"><div class="comment" data-id="12940509" data-no="72"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-72" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a10415208_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a10415208_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-72"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-72" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c72">Comment 72</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-02 13:15 PST" data-time="1514927705">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-72">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8939412"
         class="attachment patch obsolete"
         data-id="8939412" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-5e459a3290bf">
      <meta itemprop="contentSize" content="38038">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8939412">
          <a class="link" href="attachment.cgi?id=8939412&amp;action=diff">
        <span id="att-8939412-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a> (obsolete)
        — <a href="attachment.cgi?id=8939412&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8939412">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-72" data-comment-id="12940509">I think this reflects everything we discussed previously.  It touches
what seems to me like an unreasonably large number of files/lines, but
if there's a simpler way to do this I'm not seeing it :/

MozReview-Commit-ID: 9xPDX8Qk2iR</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939412&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8939412</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c73"><div class="comment" data-id="12940510" data-no="73"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-73" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a10415208_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a10415208_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-73"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-73" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c73">Comment 73</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-02 13:15 PST" data-time="1514927723">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-73">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8939413"
         class="attachment patch obsolete"
         data-id="8939413" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-f66bc2abf37e">
      <meta itemprop="contentSize" content="20462">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8939413">
          <a class="link" href="attachment.cgi?id=8939413&amp;action=diff">
        <span id="att-8939413-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8939413&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8939413">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-73" data-comment-id="12940510">MozReview-Commit-ID: DyVtSuA9voI</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939413&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8939413</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c74"><div class="comment" data-id="12948574" data-no="74"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-74" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a10415208_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a10415208_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-74"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-74" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c74">Comment 74</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-05 15:40 PST" data-time="1515195643">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-74">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-74" data-comment-id="12948574">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8939412" name="attach_8939412" title="Clarify rules for applying activeTab permission to content scripts">attachment 8939412</a> <a href="/attachment.cgi?id=8939412&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8939412&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8939412'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

<span class="quote">&gt;+  loadInfo-&gt;SetFrameOriginalSrc(aOriginalFrameSrc);</span >

SetOriginalFrameSrc, please, for consistency.

<span class="quote">&gt;+  const long INTERNAL_LOAD_FLAGS_FRAME_ORIGINAL_SRC      = 0x80;</span >

INTERNAL_LOAD_FLAGS_ORIGINAL_FRAME_SRC, please, for consistency.

<span class="quote">&gt;+++ b/dom/base/nsFrameLoader.h
&gt;+  // True if a pending load corresponds to the original src (or srcdoc)</span >

We should probably reset mLoadingOriginalSrc to false after we set it on the loadinfo in nsFrameLoader::ReallyStartLoadingInternal.

<span class="quote">&gt;+  uint32_t mLoadCount;</span >

Let's make this a boolean mSrcLoadHappened or something?  Then we don't have to worry about overflow.

<span class="quote">&gt;+++ b/netwerk/base/LoadInfo.h
&gt;+  bool                             mFrameOriginalSrc;</span >

mOriginalFrameSrcLoad, maybe, for consistency?

<span class="quote">&gt;+++ b/netwerk/base/nsILoadInfo.idl
&gt;+  [infallible] attribute boolean frameOriginalSrc;</span >

originalFrameSrcLoad, please.  Or at least originalFrameSrc, like other places.

<span class="quote">&gt;+++ b/toolkit/components/extensions/WebExtensionPolicy.cpp
&gt;+  if (AddonManagerWebAPI::IsValidSite(aDoc.PrincipalURL().URI())) {
&gt;+    return false;</span >

This needs documentation.  Why is that check there?  Presumably because we don't want to allow addons to mess with those sites?

<span class="quote">&gt;+    return true;
&gt;+  } else {</span >

else after return...

<span class="quote">&gt;+  nsCOMPtr&lt;nsILoadInfo&gt; loadInfo;
&gt;+  channel-&gt;GetLoadInfo(getter_AddRefs(loadInfo));</span >

  nsCOMPtr&lt;nsILoadInfo&gt; loadInfo = channel-&gt;GetLoadInfo();

r=me with the nits fixed.  Thank you for doing this.

And I agree that the way we had to propagate this boolean is moderately nuts.  We should really simplify the loading codepaths and deCOM docshell loadinfo...</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939412&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8939412</a> -
        Flags: review?(bzbarsky) &rarr; review+</div></div></div><div class="change-set" id="c75"><div class="comment" data-id="12948597" data-no="75"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-75" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a10415208_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a10415208_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-75"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-75" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c75">Comment 75</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-05 16:00 PST" data-time="1515196856">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-75">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-75" data-comment-id="12948597">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8939413" name="attach_8939413" title="Test for content scripts and activeTab permission">attachment 8939413</a> <a href="/attachment.cgi?id=8939413&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8939413&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8939413'>[review]</a>
Test for content scripts and activeTab permission

<span class="quote">&gt;+    let [tab] = await Promise.all([
&gt;+      browser.tabs.create({url: URL}),
&gt;+      awaitLoad({frameId: 0}),
&gt;+    ]);</span >

Is it really ok to race those against each other?

<span class="quote">&gt;+// activeTab perrmission</span >

&quot;permission&quot;.

<span class="quote">&gt;+    function awaitLoad(filter) {</span >

There's a lot of code duplication here with the first test...  Any way to share that code more?

<span class="quote">&gt;+                              &quot;XXX&quot;);</span >

What does that mean?

<span class="quote">&gt;+                              &quot;In original page, script is injected into base page and original frame&quot;);</span >

Why is it not injected into emptyframe?

There are some edge cases that are not really tested here:

1)  &lt;iframe&gt; coming from innerHTML (should not get injected into).
2)  &lt;iframe&gt; coming from an XHR responseXML (so from a network parser) and then getting adopted into the web page document.
3)  innerHTML injecting an &lt;iframe srcdoc&gt; containing another iframe, as in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c45">comment 45</a>.
4)  window.open of a new window, which should get injected into, presumably.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939413&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8939413</a> -
        Flags: review?(bzbarsky) &rarr; review-</div></div></div><div class="change-set" id="c76"><div class="comment" data-id="12957029" data-no="76"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-76" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a10415208_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a10415208_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-76"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-76" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c76">Comment 76</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:54 PST" data-time="1515560056">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-76">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-76" data-comment-id="12957029">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c75">comment #75</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8939413" name="attach_8939413" title="Test for content scripts and activeTab permission">attachment 8939413</a> <a href="/attachment.cgi?id=8939413&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8939413&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8939413'>[review]</a>
&gt; Test for content scripts and activeTab permission
&gt; 
&gt; &gt;+    let [tab] = await Promise.all([
&gt; &gt;+      browser.tabs.create({url: URL}),
&gt; &gt;+      awaitLoad({frameId: 0}),
&gt; &gt;+    ]);
&gt; 
&gt; Is it really ok to race those against each other?</span >

Maybe I'm misunderstanding the comment, are you concerned that the new tab can get created and loaded before we call awaitLoad()?  There are many asynchronous things that happen between entering browser.tabs.create() and the corresponding onCompleted event firing, they would all have to go away for that to become an issue, which I think it is safe to say will not happen.

<span class="quote">&gt; &gt;+    function awaitLoad(filter) {
&gt; 
&gt; There's a lot of code duplication here with the first test...  Any way to
&gt; share that code more?</span >

I've tried with the latest revision.  Its not completely straightforward since a bunch of these functions get serialized into strings in extensions (but we write the code this way so we can lint the functions instead of putting the code into big string constants).

<span class="quote">&gt; &gt;+                              &quot;XXX&quot;);
&gt; 
&gt; What does that mean?</span >

Oops, it means I meant to fill this in but I overlooked it before pushing.  Sorry about that, I'll fix it.

<span class="quote">&gt; &gt;+                              &quot;In original page, script is injected into base page and original frame&quot;);
&gt; 
&gt; Why is it not injected into emptyframe?</span >

Because in this case we're not passing the (somewhat misleadingly named) `matchAboutBlank` option to executeScript().  But I've done a bunch of refactoring of the tests and am now always passing that flag (and then checking empty frames as appropriate)</pre></div><div class="change-set" id="a11106914_561655"><div class="change" id="aa11106914_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106914_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a11106914_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11106914_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11106914_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11106914_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:54 PST" data-time="1515560075">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939412&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8939412</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a11106927_561655"><div class="change" id="aa11106927_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11106927_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11106927_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11106927_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:54 PST" data-time="1515560088">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8939413&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8939413</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c77"><div class="comment" data-id="12957032" data-no="77"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-77" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-77"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-77" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c77">Comment 77</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:55 PST" data-time="1515560141">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-77">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8941328"
         class="attachment patch"
         data-id="8941328" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-1a4044573faa">
      <meta itemprop="contentSize" content="38250">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8941328">
          <a class="link" href="attachment.cgi?id=8941328&amp;action=diff">
        <span id="att-8941328-description" itemprop="description">Clarify rules for applying activeTab permission to content scripts</span></a>
        — <a href="attachment.cgi?id=8941328&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8941328">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-77" data-comment-id="12957032">MozReview-Commit-ID: 9xPDX8Qk2iR</pre></div><div class="change-set" id="c78"><div class="comment" data-id="12957035" data-no="78"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-78" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-78"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-78" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c78">Comment 78</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:56 PST" data-time="1515560211">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-78">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8941329"
         class="attachment patch obsolete"
         data-id="8941329" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-85f25a976f5d">
      <meta itemprop="contentSize" content="22784">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8941329">
          <a class="link" href="attachment.cgi?id=8941329&amp;action=diff">
        <span id="att-8941329-description" itemprop="description">Test for content scripts and activeTab permission</span></a> (obsolete)
        — <a href="attachment.cgi?id=8941329&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8941329">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-78" data-comment-id="12957035">MozReview-Commit-ID: DyVtSuA9voI</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941329&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8941329</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c79"><div class="comment" data-id="12957042" data-no="79"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-79" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-79"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-79" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c79">Comment 79</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 20:59 PST" data-time="1515560396">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-79">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-79" data-comment-id="12957042">Comment on <span class=""><a href="/attachment.cgi?id=8941328" name="attach_8941328" title="Clarify rules for applying activeTab permission to content scripts">attachment 8941328</a> <a href="/attachment.cgi?id=8941328&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8941328&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8941328'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

(carried over r+ from :bz from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c74">comment 74</a>)

Earlier sec-approval request was in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c37">comment 37</a>, the answers there still apply.  Sorry for jumping the gun on the earlier request before getting the patch through review...</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941328&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8941328</a> -
        Flags: sec-approval?</div><div class="change">
        <a href="/attachment.cgi?id=8941328&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8941328</a> -
        Flags: review+</div></div></div><div class="change-set" id="c80"><div class="comment" data-id="12957047" data-no="80"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-80" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-80"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-80" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c80">Comment 80</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 21:07 PST" data-time="1515560827">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-80">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-80" data-comment-id="12957047">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c75">comment #75</a>)
<span class="quote">&gt; 4)  window.open of a new window, which should get injected into, presumably.</span >

Whoops I realized I didn't cover this in the latest test patch.
However, we don't currently propagate activeTab to children created in this way, and my gut reaction is that we shouldn't do so.  Maybe we could take this question to a follow-up bug?</pre></div><div class="change-set" id="c81"><div class="comment" data-id="12957052" data-no="81"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-81" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11106927_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11106927_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-81"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-81" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c81">Comment 81</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 21:12 PST" data-time="1515561128">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-81">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-81" data-comment-id="12957052"><span class="quote">&gt; are you concerned that the new tab can get created and loaded before we call awaitLoad()</span >

I'm concerned that it can get created and loaded before awaitLoad sets up enough of its state to be awaiting the load.  Or is the idea that once awaitLoad has returned we are all set for the listeners it needs to add?  If so this might be ok, though I would be happier if the awaitLoad() call happened _before_ the create() call.

<span class="quote">&gt; Maybe we could take this question to a follow-up bug?</span >

That seems fine.</pre></div><div class="change-set" id="c82"><div class="comment" data-id="12957055" data-no="82"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-82" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11106927_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11106927_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-82"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-82" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c82">Comment 82</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-09 21:13 PST" data-time="1515561203">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-82">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-82" data-comment-id="12957055"><span class="quote">&gt; That seems fine.</span >

Actually, we should probably just test that we do _not_ inject in that case, because an extension can do the window.open.  Followup bug is OK for the test, though.</pre></div><div class="change-set" id="c83"><div class="comment" data-id="12959635" data-no="83"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-83" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a11106927_561655"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-83"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-83" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c83">Comment 83</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 13:59 PST" data-time="1515621547">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-83">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-83" data-comment-id="12959635">I'd like to give this sec-approval+ and then beta+ to make the last beta but I need Gerry's approval to do so.

Andrew, please nominate the patch for beta if it applies.

Gerry, I would like to get this into the last beta.</pre><div class="activity"><div class="change">Flags: needinfo?(gchang)</div><div class="change">Flags: needinfo?(aswan)</div></div></div><div class="change-set" id="c84"><div class="comment" data-id="12959737" data-no="84"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-84" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-84"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-84" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c84">Comment 84</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 14:27 PST" data-time="1515623238">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-84">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-84" data-comment-id="12959737">The patch applies cleanly to beta, I haven't actually tried to build and test it yet (I can do so later today)
Which raises another question though, what's the policy about doing try runs with these patches?  This patch is big enough that I would ordinarily test it on try but then the patch would be out in public.  I can live without the new tests on try (the tests are commented enough that having them become public would really reveal how to exploit the bug) but what's okay as far as just ensuring that the main patch doesn't break something else?</pre><div class="activity"><div class="change">Flags: needinfo?(aswan) &rarr; needinfo?(abillings)</div></div></div><div class="change-set" id="c85"><div class="comment" data-id="12959811" data-no="85"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-85" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506302" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58cce0c47d9c6efb7d83bc34b9d79816?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506302" id="a11106927_561655"><a class="email disabled" href="/user_profile?user_id=506302" > <span class="fna">Gerry Chang [:gchang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-85"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-85" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c85">Comment 85</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 14:58 PST" data-time="1515625111">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-85">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-85" data-comment-id="12959811">Al, ok to get this in beta 16.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gchang)</span></div></div></div><div class="change-set" id="c86"><div class="comment" data-id="12959830" data-no="86"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-86" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a11106927_561655"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-86"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-86" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c86">Comment 86</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 15:04 PST" data-time="1515625487">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-86">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-86" data-comment-id="12959830">Comment on <span class=""><a href="/attachment.cgi?id=8941328" name="attach_8941328" title="Clarify rules for applying activeTab permission to content scripts">attachment 8941328</a> <a href="/attachment.cgi?id=8941328&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8941328&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8941328'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Thanks!

sec-approval+ for trunk.
I'll approve the beta? when it shows up.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(abillings)</span></div><div class="change">
        <a href="/attachment.cgi?id=8941328&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8941328</a> -
        Flags: sec-approval? &rarr; sec-approval+</div></div></div><div class="change-set" id="c87"><div class="comment" data-id="12959916" data-no="87"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-87" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a11106927_561655"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-87"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-87" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c87">Comment 87</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 15:52 PST" data-time="1515628363">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-87">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-87" data-comment-id="12959916"><a rel="nofollow" href="https://hg.mozilla.org/integration/autoland/rev/ff6e9d3a6441aa4510ed47d5383e79fe5a412576">https://hg.mozilla.org/integration/autoland/rev/ff6e9d3a6441aa4510ed47d5383e79fe5a412576</a></pre></div><div class="change-set" id="c88"><div class="comment" data-id="12960001" data-no="88"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-88" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a11106927_561655"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-88"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-88" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c88">Comment 88</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 16:42 PST" data-time="1515631375">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-88">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-88" data-comment-id="12960001">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c84">comment #84</a>)
<span class="quote">&gt; The patch applies cleanly to beta, I haven't actually tried to build and
&gt; test it yet (I can do so later today)
&gt; Which raises another question though, what's the policy about doing try runs
&gt; with these patches?  This patch is big enough that I would ordinarily test
&gt; it on try but then the patch would be out in public.  I can live without the
&gt; new tests on try (the tests are commented enough that having them become
&gt; public would really reveal how to exploit the bug) but what's okay as far as
&gt; just ensuring that the main patch doesn't break something else?</span >

I would just do it on try at this point since it is checked into the integration branch.</pre></div><div class="change-set" id="c89"><div class="comment" data-id="12960027" data-no="89"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-89" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-89"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-89" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c89">Comment 89</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 16:53 PST" data-time="1515632032">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-89">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-89" data-comment-id="12960027">(In reply to Al Billings [:abillings] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c88">comment #88</a>)
<span class="quote">&gt; I would just do it on try at this point since it is checked into the
&gt; integration branch.</span >

Oops, my question about try was originally meant for trunk but now the main patch has landed.  The patches apply cleanly to beta and all the new tests pass.  I haven't done a beta try run but I think if the patch sticks on autoland we should be good:
<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;revision=ff6e9d3a6441aa4510ed47d5383e79fe5a412576">https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;revision=ff6e9d3a6441aa4510ed47d5383e79fe5a412576</a>

I'm going to request beta approval now since I'll be away from the computer for a while this evening but if the approval is granted quickly can we wait to see that the above run is green before landing there (:RyanVM I assume you are the one who would be doing the landing)</pre></div><div class="change-set" id="c90"><div class="comment" data-id="12960036" data-no="90"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-90" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-90"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-90" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c90">Comment 90</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 16:58 PST" data-time="1515632304">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-90">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-90" data-comment-id="12960036">Comment on <span class=""><a href="/attachment.cgi?id=8941328" name="attach_8941328" title="Clarify rules for applying activeTab permission to content scripts">attachment 8941328</a> <a href="/attachment.cgi?id=8941328&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8941328&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8941328'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Approval Request Comment
[Feature/Bug causing the regression]:
none

[User impact if declined]:
sec-moderate vulnerability described in the original bug

[Is this code covered by automated tests?]:
yes, but the tests are in a separate patch so they can be embargoed for a while

[Has the fix been verified in Nightly?]:
with automated tests, yes

[Needs manual test from QE? If yes, steps to reproduce]: 
I don't believe additional manual testing is needed

[List of other uplifts needed for the feature/fix]:
none

[Is the change risky?]:
not especially

[Why is the change risky/not risky?]:
The patch does touch a lot of code but mostly this is plumbing to add a new flag that is only checked from the webextensions content script injection code.

[String changes made/needed]:
none</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941328&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8941328</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c91"><div class="comment" data-id="12960198" data-no="91"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-91" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506302" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58cce0c47d9c6efb7d83bc34b9d79816?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506302" id="a11106927_561655"><a class="email disabled" href="/user_profile?user_id=506302" > <span class="fna">Gerry Chang [:gchang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-91"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-91" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c91">Comment 91</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-10 18:47 PST" data-time="1515638838">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-91">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-91" data-comment-id="12960198">Comment on <span class=""><a href="/attachment.cgi?id=8941328" name="attach_8941328" title="Clarify rules for applying activeTab permission to content scripts">attachment 8941328</a> <a href="/attachment.cgi?id=8941328&amp;action=edit" title="Clarify rules for applying activeTab permission to content scripts">[details]</a> <a href="/attachment.cgi?id=8941328&amp;action=diff" title="Clarify rules for applying activeTab permission to content scripts">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8941328'>[review]</a>
Clarify rules for applying activeTab permission to content scripts

Take it in Beta58.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941328&amp;action=edit"
           title="Clarify rules for applying activeTab permission to content scripts"
           class=""
        >Attachment #8941328</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c92"><div class="comment" data-id="12961018" data-no="92"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-92" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_258347" id="a11106927_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_258347" id="a11106927_561655"><a class="email " href="/user_profile?user_id=258347" > <span class="fna">Sebastian Hengst [:aryx] (needinfo on intermittent or backout)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-92"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-92" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c92">Comment 92</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-11 04:43 PST" data-time="1515674608">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-92">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-92" data-comment-id="12961018"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/e57848b337fcaeec8a8e23f45354603df11c2b5b">https://hg.mozilla.org/releases/mozilla-beta/rev/e57848b337fcaeec8a8e23f45354603df11c2b5b</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=isnotempty">status-firefox58</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox58&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="c93"><div class="comment" data-id="12961072" data-no="93"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-93" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_258347" id="a11106927_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_258347" id="a11106927_561655"><a class="email " href="/user_profile?user_id=258347" > <span class="fna">Sebastian Hengst [:aryx] (needinfo on intermittent or backout)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-93"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-93" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c93">Comment 93</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-11 05:07 PST" data-time="1515676067">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-93">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-93" data-comment-id="12961072"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/ff6e9d3a6441">https://hg.mozilla.org/mozilla-central/rev/ff6e9d3a6441</a></pre><div class="activity"><div class="change">Status: NEW &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2018-01-11 05:07 PST" data-time="1515676067">4 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=isnotempty">status-firefox59</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox59&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div></div></div><div class="change-set" id="c95"><div class="comment" data-id="12963014" data-no="95"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-95" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a11106927_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-95"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-95" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c95">Comment 95</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-11 16:23 PST" data-time="1515716592">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-95">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-95" data-comment-id="12963014">Can we also get a date for when the tests should be checked in (assuming they get r+) so that doesn't fall through the cracks?</pre><div class="activity"><div class="change">Flags: needinfo?(abillings)</div></div></div><div class="change-set" id="c96"><div class="comment" data-id="12963339" data-no="96"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-96" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11106927_561655"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11106927_561655"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-96"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-96" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c96">Comment 96</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-11 20:56 PST" data-time="1515732974">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-96">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-96" data-comment-id="12963339">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8941329" name="attach_8941329" title="Test for content scripts and activeTab permission">attachment 8941329</a> <a href="/attachment.cgi?id=8941329&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8941329&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8941329'>[review]</a>
Test for content scripts and activeTab permission

<span class="quote">&gt;+// Test that dynamically created iframes do not get the activeTab permission
&gt;+      div2.innerHTML = &quot;&lt;iframe srcdoc=\&quot;&lt;iframe src='<a rel="nofollow" href="http://test2.example.com/'&amp;gt">http://test2.example.com/'&amp;gt</a>;&lt;/iframe&amp;gt;\&quot;&gt;&lt;/iframe&gt;&quot;;</span >

Is there a reason we don't listen to this frame's load with frameLoaded?  Seems like we should (and nframes should be 4, not 3).

r=me with that fixed or explained.  Thank you!</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941329&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8941329</a> -
        Flags: review?(bzbarsky) &rarr; review+</div></div></div><div class="change-set" id="c97"><div class="comment" data-id="12965685" data-no="97"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-97" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11106927_561655"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a11106927_561655"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-97"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-97" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c97">Comment 97</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-12 12:33 PST" data-time="1515789222">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-97">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-97" data-comment-id="12965685">(In reply to Andrew Swan [:aswan] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c95">comment #95</a>)
<span class="quote">&gt; Can we also get a date for when the tests should be checked in (assuming
&gt; they get r+) so that doesn't fall through the cracks?</span >

Set intestsuite? to flag them for later. It is going to be at least four weeks after a release containing the fixes, assuming normal uptake and that we don't, for example, turn off updates for a week to chemspill. In other words, I can't give a specific date at this time. Probably the end of February.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(abillings)</span></div></div></div><div class="change-set" id="a11345693_1689"><div class="change" id="aa11345693_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a11345693_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a11345693_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11345693_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11345693_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11345693_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-12 15:14 PST" data-time="1515798854">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty? &rarr; sec-bounty+</div></div></div><div class="change-set" id="a11679269_280903"><div class="change" id="aa11679269_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11679269_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a11679269_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11679269_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11679269_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11679269_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-16 11:53 PST" data-time="1516132430">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a> &rarr; ---</div><div class="change">Whiteboard: [adv-main58+]</div></div></div><div class="change-set" id="a11685202_280903"><div class="change" id="aa11685202_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11685202_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a11685202_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11685202_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11685202_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11685202_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-16 13:32 PST" data-time="1516138363">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2018-5116</div></div></div><div class="change-set" id="a11803706_452604"><div class="change" id="aa11803706_452604">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_452604" id="a11803706_452604"><img src="https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_452604" id="a11803706_452604"><a class="email disabled" href="/user_profile?user_id=452604" > <span class="fna">Matt Wobensmith [:mwobensmith][:matt:]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11803706_452604"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11803706_452604">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a11803706_452604">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-17 22:27 PST" data-time="1516256867">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [adv-main58+] &rarr; [adv-main58+][post-critsmash-triage]</div></div></div><div class="change-set" id="a12199911_1689"><div class="change" id="aa12199911_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a12199911_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a12199911_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a12199911_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a12199911_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a12199911_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-22 12:31 PST" data-time="1516653072">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: toolkit-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="a12209616_561655"><div class="change" id="aa12209616_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a12209616_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a12209616_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a12209616_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a12209616_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a12209616_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-22 15:12 PST" data-time="1516662777">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8941329&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8941329</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c98"><div class="comment" data-id="12987564" data-no="98"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-98" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a12209616_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a12209616_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-98"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-98" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c98">Comment 98</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-22 15:14 PST" data-time="1516662853">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-98">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8944564"
         class="attachment patch"
         data-id="8944564" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="base-e1a156fb6726">
      <meta itemprop="contentSize" content="23116">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8944564">
          <a class="link" href="attachment.cgi?id=8944564&amp;action=diff">
        <span id="att-8944564-description" itemprop="description">Test for content scripts and activeTab permission</span></a>
        — <a href="attachment.cgi?id=8944564&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1396399&attachment=8944564">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-98" data-comment-id="12987564">MozReview-Commit-ID: DyVtSuA9voI</pre></div><div class="change-set" id="a12209731_561655"><div class="change" id="aa12209731_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a12209731_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a12209731_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a12209731_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a12209731_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a12209731_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-22 15:14 PST" data-time="1516662892">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: in-testsuite?</div></div></div><div class="change-set" id="c99"><div class="comment" data-id="12987568" data-no="99"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-99" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a12209731_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_561655" id="a12209731_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-99"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-99" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c99">Comment 99</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-22 15:15 PST" data-time="1516662937">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-99">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-99" data-comment-id="12987568">Comment on <span class=""><a href="/attachment.cgi?id=8944564" name="attach_8944564" title="Test for content scripts and activeTab permission">attachment 8944564</a> <a href="/attachment.cgi?id=8944564&amp;action=edit" title="Test for content scripts and activeTab permission">[details]</a> <a href="/attachment.cgi?id=8944564&amp;action=diff" title="Test for content scripts and activeTab permission">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1396399&amp;attachment=8944564'>[review]</a>
Test for content scripts and activeTab permission

The item from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames"
   href="/show_bug.cgi?id=1396399#c96">comment 96</a> is addressed, carrying over the r+ from that comment.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8944564&amp;action=edit"
           title="Test for content scripts and activeTab permission"
           class=""
        >Attachment #8944564</a> -
        Flags: review+</div></div></div><div class="change-set" id="a13162483_1689"><div class="change" id="aa13162483_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a13162483_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a13162483_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a13162483_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a13162483_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a13162483_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-02 15:54 PST" data-time="1517615644">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - activeTab permission allows executing scripts on pages it shouldn't"
   href="/show_bug.cgi?id=1431371">CVE-2018-5135</a></div></div></div><div class="change-set" id="a14704001_75935"><div class="change" id="aa14704001_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a14704001_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a14704001_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a14704001_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a14704001_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a14704001_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-20 12:06 PST" data-time="1519157162">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Target Milestone: --- &rarr; mozilla59</div></div></div><div class="change-set" id="a24985449_546015"><div class="change" id="aa24985449_546015">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_546015" id="a24985449_546015"><img src="https://secure.gravatar.com/avatar/d0465b8931b44330f542efbeeae855da?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_546015" id="a24985449_546015"><a class="email " href="/user_profile?user_id=546015" > <span class="fna">BMO Automation</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a24985449_546015"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a24985449_546015">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a24985449_546015">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-06-19 13:03 PDT" data-time="1529438610">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Product: Toolkit &rarr; WebExtensions</div></div></div><div class="change-set" id="a37002623_1689"><div class="change" id="aa37002623_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a37002623_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a37002623_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a37002623_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a37002623_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a37002623_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-11-05 14:09 PST" data-time="1541455784">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=isnotempty">tracking-firefox59</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox59&amp;o1=equals&amp;v1=%2B">+</a> &rarr; ---</div></div></div><div class="change-set" id="c100"><div class="comment" data-id="15038138" data-no="100"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-100" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a37002623_1689"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_106098" id="a37002623_1689"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-100"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-100" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c100">Comment 100</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 16:54 PDT" data-time="1600214062">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-100">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-9175926"
         class="attachment"
         data-id="9175926" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="phabricator-D90333-url.txt">
      <meta itemprop="contentSize" content="47">
      <meta itemprop="encodingFormat" content="text/x-phabricator-request">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=9175926" itemprop="contentUrl">
        <span id="att-9175926-description" itemprop="description">Bug 1396399: Test for content scripts and activeTab permission.</span></a>
        — <a href="attachment.cgi?id=9175926&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div></div><div class="change-set" id="c101"><div class="comment" data-id="15038141" data-no="101"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-101" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_510726" id="a37002623_1689"><img src="https://secure.gravatar.com/avatar/4c5aee4c6938e29b1576314d2de9c6e7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_510726" id="a37002623_1689"><a class="email " href="/user_profile?user_id=510726" > <span class="fna">Pulsebot</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-101"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-101" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c101">Comment 101</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 16:57 PDT" data-time="1600214277">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-101">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-101" data-comment-id="15038141">Pushed by <a href="mailto:maglione.k&#64;gmail.com">maglione.k&#64;gmail.com</a>:
<a rel="nofollow" href="https://hg.mozilla.org/integration/autoland/rev/309b64bd96a1">https://hg.mozilla.org/integration/autoland/rev/309b64bd96a1</a>
Test for content scripts and activeTab permission.</pre></div><div class="change-set" id="c102"><div class="comment" data-id="15038193" data-no="102"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-102" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_600663" id="a37002623_1689"><img src="https://secure.gravatar.com/avatar/ddd43a36ab5c97cad726347062bbd08e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_600663" id="a37002623_1689"><a class="email disabled" href="/user_profile?user_id=600663" > <span class="fna">Cristian Brindusan [:cbrindusan]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-102"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-102" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c102">Comment 102</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 18:07 PDT" data-time="1600218432">1 year ago</span>
          </div>&bull;
<div class="change-revisions">
  <a href="/page.cgi?id=comment-revisions.html&amp;bug_id=1396399&amp;comment_id=15038193"
     title="1 revision">Edited</a>
</div>
        </td>
      </tr>

      <tr id="ctag-102">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div
        class="comment-text markdown-body "
        id="ct-102" data-comment-id="15038193" data-ismarkdown="true" ><p>Backed out changeset 309b64bd96a1 (<a class="bz_bug_link
          bz_status_RESOLVED bz_closed" href="/show_bug.cgi?id=1396399" title="RESOLVED FIXED - An extension can XSS any domain with only the ActiveTab permission using frames">bug 1396399</a>) for mochitest failures at test_ext_contentscript_activeTab.html and ESlint failure at SpecialPowersParent.js<br>
<a href="https://hg.mozilla.org/integration/autoland/rev/9a09309f554a33bd33996f23f6a9e6a58932fd9a" rel="nofollow">https://hg.mozilla.org/integration/autoland/rev/9a09309f554a33bd33996f23f6a9e6a58932fd9a</a></p>
<p>Failure log ESlint:<br>
<a href="https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception&amp;revision=309b64bd96a1763a8bb84bfe2c9338749254a978&amp;selectedTaskRun=cPodKgeyRgi5zeLXlrIORQ.0" rel="nofollow">https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception&amp;revision=309b64bd96a1763a8bb84bfe2c9338749254a978&amp;selectedTaskRun=cPodKgeyRgi5zeLXlrIORQ.0</a></p>
<p><a href="https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315797300&amp;repo=autoland&amp;lineNumber=403" rel="nofollow">https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315797300&amp;repo=autoland&amp;lineNumber=403</a></p>
<p>mochitest<br>
<a href="https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;selectedTaskRun=YVje81DST2iNfv_erEG2QA.0&amp;resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception&amp;revision=309b64bd96a1763a8bb84bfe2c9338749254a978" rel="nofollow">https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;selectedTaskRun=YVje81DST2iNfv_erEG2QA.0&amp;resultStatus=pending%2Crunning%2Csuccess%2Ctestfailed%2Cbusted%2Cexception&amp;revision=309b64bd96a1763a8bb84bfe2c9338749254a978</a></p>
<p><a href="https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315797897&amp;repo=autoland&amp;lineNumber=3748" rel="nofollow">https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315797897&amp;repo=autoland&amp;lineNumber=3748</a></p>
</div><div class="activity"><div class="change">Flags: needinfo?(andrew.swan)</div></div></div><div class="change-set" id="c103"><div class="comment" data-id="15038237" data-no="103"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-103" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_510726" id="a37002623_1689"><img src="https://secure.gravatar.com/avatar/4c5aee4c6938e29b1576314d2de9c6e7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_510726" id="a37002623_1689"><a class="email " href="/user_profile?user_id=510726" > <span class="fna">Pulsebot</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-103"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-103" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c103">Comment 103</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 19:09 PDT" data-time="1600222176">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-103">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-103" data-comment-id="15038237">Pushed by <a href="mailto:maglione.k&#64;gmail.com">maglione.k&#64;gmail.com</a>:
<a rel="nofollow" href="https://hg.mozilla.org/integration/autoland/rev/09f6522b2f48">https://hg.mozilla.org/integration/autoland/rev/09f6522b2f48</a>
Test for content scripts and activeTab permission.</pre></div><div class="change-set" id="a95771956_561655"><div class="change" id="aa95771956_561655">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_561655" id="a95771956_561655"><img src="https://secure.gravatar.com/avatar/2826368a4269673211a6539a73e9a056?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_561655" id="a95771956_561655"><a class="email " href="/user_profile?user_id=561655" > <span class="fna">Andrew Swan [:aswan]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a95771956_561655"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a95771956_561655">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a95771956_561655">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 19:58 PDT" data-time="1600225117">1 year ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(andrew.swan)</span></div></div></div><div class="change-set" id="c104"><div class="comment" data-id="15038315" data-no="104"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-104" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_624917" id="a95771956_561655"><img src="https://secure.gravatar.com/avatar/8428c6b32128e76ea2f154432716c9e8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_624917" id="a95771956_561655"><a class="email disabled" href="/user_profile?user_id=624917" > <span class="fna">Razvan Maries</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-104"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-104" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c104">Comment 104</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-15 22:38 PDT" data-time="1600234691">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-104">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div
        class="comment-text markdown-body "
        id="ct-104" data-comment-id="15038315" data-ismarkdown="true" ><p>Backed out for perma failures.</p>
<p>Push with failure: <a href="https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;selectedTaskRun=Cr4AL6LUTqWFZqz3GshyKA.0&amp;resultStatus=testfailed%2Cbusted%2Cexception&amp;revision=09f6522b2f48a938aa575e43306c2b0e1af5aa07&amp;failure_classification_id=2" rel="nofollow">https://treeherder.mozilla.org/#/jobs?repo=autoland&amp;selectedTaskRun=Cr4AL6LUTqWFZqz3GshyKA.0&amp;resultStatus=testfailed%2Cbusted%2Cexception&amp;revision=09f6522b2f48a938aa575e43306c2b0e1af5aa07&amp;failure_classification_id=2</a></p>
<p>Log: <a href="https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315803125&amp;repo=autoland&amp;lineNumber=5334" rel="nofollow">https://treeherder.mozilla.org/logviewer.html#/jobs?job_id=315803125&amp;repo=autoland&amp;lineNumber=5334</a></p>
<p>Backout: <a href="https://hg.mozilla.org/integration/autoland/rev/bc6413221c76ad99e57f80174b79c9c6a90baf76" rel="nofollow">https://hg.mozilla.org/integration/autoland/rev/bc6413221c76ad99e57f80174b79c9c6a90baf76</a></p>
</div><div class="activity"><div class="change">Flags: needinfo?(kmaglione+bmo)</div></div></div><div class="change-set" id="c105"><div class="comment" data-id="15048626" data-no="105"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-105" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_510726" id="a95771956_561655"><img src="https://secure.gravatar.com/avatar/4c5aee4c6938e29b1576314d2de9c6e7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_510726" id="a95771956_561655"><a class="email " href="/user_profile?user_id=510726" > <span class="fna">Pulsebot</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-105"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-105" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c105">Comment 105</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-22 10:44 PDT" data-time="1600796675">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-105">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-105" data-comment-id="15048626">Pushed by <a href="mailto:maglione.k&#64;gmail.com">maglione.k&#64;gmail.com</a>:
<a rel="nofollow" href="https://hg.mozilla.org/integration/autoland/rev/150632dfdf3a">https://hg.mozilla.org/integration/autoland/rev/150632dfdf3a</a>
Test for content scripts and activeTab permission.</pre></div><div class="change-set" id="a96352842_106098"><div class="change" id="aa96352842_106098">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_106098" id="a96352842_106098"><img src="https://secure.gravatar.com/avatar/06a624a82dd4430f86e9a67b300eecb3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_106098" id="a96352842_106098"><a class="email " href="/user_profile?user_id=106098" > <span class="fna">Kris Maglione [:kmag]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a96352842_106098"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a96352842_106098">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#a96352842_106098">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-22 13:20 PDT" data-time="1600806003">1 year ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(kmaglione+bmo)</span></div></div></div><div class="change-set" id="c106"><div class="comment" data-id="15049733" data-no="106"
       data-tags="bugherder">
    
    <table class="layout-table change-head " id="ch-106" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_661920" id="a96352842_106098"><img src="https://secure.gravatar.com/avatar/d57dec63a56cf8f6739509d2a319c6ee?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_661920" id="a96352842_106098"><a class="email " href="/user_profile?user_id=661920" > <span class="fna">Atila Butkovits</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-106"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-106" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1396399#c106">Comment 106</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2020-09-23 03:04 PDT" data-time="1600855449">1 year ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-106">
        <td colspan="2" class="comment-tags"><span class="comment-tag">bugherder</span>
        </td>
      </tr>
    </table>

    
  </div><div
        class="comment-text markdown-body "
        id="ct-106" data-comment-id="15049733" data-ismarkdown="true" ><p><a href="https://hg.mozilla.org/mozilla-central/rev/150632dfdf3a" rel="nofollow">https://hg.mozilla.org/mozilla-central/rev/150632dfdf3a</a></p>
</div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1396399&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>