<!DOCTYPE html>
<html lang='en'>
<head>
<title>wayland/wayland - Wayland Compositor Infrastructure  (mirrored from https://gitlab.freedesktop.org/wayland/wayland)</title>
<meta name='generator' content='cgit v1.2.1'/>
<meta name='robots' content='index, nofollow'/>
<link rel='stylesheet' type='text/css' href='https://cgit.freedesktop.org/cgit.css'/>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://cgit.freedesktop.org/wayland/wayland/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='https://gitlab.freedesktop.org/wayland/wayland' title='wayland/wayland Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='https://cgit.freedesktop.org/logo.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a title='wayland/wayland' href='/wayland/wayland/'>wayland/wayland</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='5d201df72f3d4f4cb8b8f75f980169b03507da38'/><select name='h' onchange='this.form.submit();'>
<option value='0.85'>0.85</option>
<option value='1.0'>1.0</option>
<option value='1.1'>1.1</option>
<option value='1.10'>1.10</option>
<option value='1.11'>1.11</option>
<option value='1.12'>1.12</option>
<option value='1.13'>1.13</option>
<option value='1.14'>1.14</option>
<option value='1.15'>1.15</option>
<option value='1.16'>1.16</option>
<option value='1.2'>1.2</option>
<option value='1.3'>1.3</option>
<option value='1.4'>1.4</option>
<option value='1.5'>1.5</option>
<option value='1.6'>1.6</option>
<option value='1.7'>1.7</option>
<option value='1.8'>1.8</option>
<option value='1.9'>1.9</option>
<option value='main'>main</option>
<option value='master' selected='selected'>master</option>
<option value='next'>next</option>
<option value='terminal'>terminal</option>
<option value='wayland-0.8'>wayland-0.8</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Wayland Compositor Infrastructure  (mirrored from https://gitlab.freedesktop.org/wayland/wayland)</td><td class='sub right'>root</td></tr></table>
<table class='tabs'><tr><td>
<a href='/wayland/wayland/'>summary</a><a href='/wayland/wayland/refs/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>refs</a><a href='/wayland/wayland/log/'>log</a><a href='/wayland/wayland/tree/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>tree</a><a class='active' href='/wayland/wayland/commit/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>commit</a><a href='/wayland/wayland/diff/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>diff</a></td><td class='form'><form class='right' method='get' action='/wayland/wayland/log/'>
<input type='hidden' name='id' value='5d201df72f3d4f4cb8b8f75f980169b03507da38'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='5d201df72f3d4f4cb8b8f75f980169b03507da38'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Tobias Stoeckmann &lt;tobias@stoeckmann.org&gt;</td><td class='right'>2017-11-28 21:38:07 +0100</td></tr>
<tr><th>committer</th><td>Pekka Paalanen &lt;pekka.paalanen@collabora.co.uk&gt;</td><td class='right'>2017-11-29 09:45:10 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='sha1'><a href='/wayland/wayland/commit/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>5d201df72f3d4f4cb8b8f75f980169b03507da38</a> (<a href='/wayland/wayland/patch/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='sha1'><a href='/wayland/wayland/tree/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>add592e4f349cdd7d7cb585e167525b718cf14bb</a></td></tr>
<tr><th>parent</th><td colspan='2' class='sha1'><a href='/wayland/wayland/commit/?id=242005636d0897db166215ed09cf3832217df008'>242005636d0897db166215ed09cf3832217df008</a> (<a href='/wayland/wayland/diff/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38&amp;id2=242005636d0897db166215ed09cf3832217df008'>diff</a>)</td></tr></table>
<div class='commit-subject'>cursor: Fix heap overflows when parsing malicious files.</div><div class='commit-msg'>It is possible to trigger heap overflows due to an integer overflow
while parsing images.

The integer overflow occurs because the chosen limit 0x10000 for
dimensions is too large for 32 bit systems, because each pixel takes
4 bytes. Properly chosen values allow an overflow which in turn will
lead to less allocated memory than needed for subsequent reads.

See also: https://cgit.freedesktop.org/xorg/lib/libXcursor/commit/?id=<a href="./?id=4794b5dd34688158fb51a2943032569d3780c4b8">4794b5dd34688158fb51a2943032569d3780c4b8</a>
Fixes: https://bugs.freedesktop.org/show_bug.cgi?id=103961

Signed-off-by: Tobias Stoeckmann &lt;tobias@stoeckmann.org&gt;
[Pekka: add link to the corresponding libXcursor commit]
Signed-off-by: Pekka Paalanen &lt;pekka.paalanen@collabora.co.uk&gt;
</div><div class='diffstat-header'><a href='/wayland/wayland/diff/?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/wayland/wayland/diff/cursor/xcursor.c?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>cursor/xcursor.c</a></td><td class='right'>8</td><td class='graph'><table summary='file diffstat' width='8%'><tr><td class='add' style='width: 87.5%;'/><td class='rem' style='width: 12.5%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 7 insertions, 1 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/cursor/xcursor.c b/cursor/xcursor.c<br/>index ca41c4a..689c702 100644<br/>--- a/<a href='/wayland/wayland/tree/cursor/xcursor.c?id=242005636d0897db166215ed09cf3832217df008'>cursor/xcursor.c</a><br/>+++ b/<a href='/wayland/wayland/tree/cursor/xcursor.c?id=5d201df72f3d4f4cb8b8f75f980169b03507da38'>cursor/xcursor.c</a></div><div class='hunk'>@@ -202,6 +202,11 @@ XcursorImageCreate (int width, int height)</div><div class='ctx'> {</div><div class='ctx'>     XcursorImage    *image;</div><div class='ctx'> </div><div class='add'>+    if (width &lt; 0 || height &lt; 0)</div><div class='add'>+       return NULL;</div><div class='add'>+    if (width &gt; XCURSOR_IMAGE_MAX_SIZE || height &gt; XCURSOR_IMAGE_MAX_SIZE)</div><div class='add'>+       return NULL;</div><div class='add'>+</div><div class='ctx'>     image = malloc (sizeof (XcursorImage) +</div><div class='ctx'> 		    width * height * sizeof (XcursorPixel));</div><div class='ctx'>     if (!image)</div><div class='hunk'>@@ -482,7 +487,8 @@ _XcursorReadImage (XcursorFile		*file,</div><div class='ctx'>     if (!_XcursorReadUInt (file, &amp;head.delay))</div><div class='ctx'> 	return NULL;</div><div class='ctx'>     /* sanity check data */</div><div class='del'>-    if (head.width &gt;= 0x10000 || head.height &gt; 0x10000)</div><div class='add'>+    if (head.width &gt; XCURSOR_IMAGE_MAX_SIZE  ||</div><div class='add'>+	head.height &gt; XCURSOR_IMAGE_MAX_SIZE)</div><div class='ctx'> 	return NULL;</div><div class='ctx'>     if (head.width == 0 || head.height == 0)</div><div class='ctx'> 	return NULL;</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit v1.2.1</a> (<a href='https://git-scm.com/'>git 2.18.0</a>) at 2021-10-30 22:00:15 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
