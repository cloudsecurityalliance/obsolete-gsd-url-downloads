<!DOCTYPE html>
<html lang='en'>
<head>
<title>accountsservice - D-Bus interface for user account query and manipulation  (mirrored from https://gitlab.freedesktop.org/accountsservice/accountsservice)</title>
<meta name='generator' content='cgit v1.2.1'/>
<meta name='robots' content='index, nofollow'/>
<link rel='stylesheet' type='text/css' href='https://cgit.freedesktop.org/cgit.css'/>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://cgit.freedesktop.org/accountsservice/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='https://gitlab.freedesktop.org/accountsservice/accountsservice' title='accountsservice Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='https://cgit.freedesktop.org/logo.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a title='accountsservice' href='/accountsservice/'>accountsservice</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='f9abd359f71a5bce421b9ae23432f539a067847a'/><select name='h' onchange='this.form.submit();'>
<option value='50112'>50112</option>
<option value='async-api'>async-api</option>
<option value='cache-fix'>cache-fix</option>
<option value='distcheck'>distcheck</option>
<option value='groups'>groups</option>
<option value='groups-squash'>groups-squash</option>
<option value='master' selected='selected'>master</option>
<option value='wip/fix-properties-changed-signal'>wip/fix-properties-changed-signal</option>
<option value='wip/fix-useradd'>wip/fix-useradd</option>
<option value='wip/scalability-fixes'>wip/scalability-fixes</option>
<option value='wip/systemd'>wip/systemd</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>D-Bus interface for user account query and manipulation  (mirrored from https://gitlab.freedesktop.org/accountsservice/accountsservice)</td><td class='sub right'>root</td></tr></table>
<table class='tabs'><tr><td>
<a href='/accountsservice/'>summary</a><a href='/accountsservice/refs/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>refs</a><a href='/accountsservice/log/'>log</a><a href='/accountsservice/tree/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>tree</a><a class='active' href='/accountsservice/commit/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>commit</a><a href='/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>diff</a></td><td class='form'><form class='right' method='get' action='/accountsservice/log/'>
<input type='hidden' name='id' value='f9abd359f71a5bce421b9ae23432f539a067847a'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='f9abd359f71a5bce421b9ae23432f539a067847a'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Matthias Gerstner &lt;matthias.gerstner@suse.de&gt;</td><td class='right'>2018-07-10 09:51:47 -0400</td></tr>
<tr><th>committer</th><td>Ray Strode &lt;rstrode@redhat.com&gt;</td><td class='right'>2018-07-10 09:55:59 -0400</td></tr>
<tr><th>commit</th><td colspan='2' class='sha1'><a href='/accountsservice/commit/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>f9abd359f71a5bce421b9ae23432f539a067847a</a> (<a href='/accountsservice/patch/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='sha1'><a href='/accountsservice/tree/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>d4bbace87219f370ad280095f28685fe3bdfd3f9</a></td></tr>
<tr><th>parent</th><td colspan='2' class='sha1'><a href='/accountsservice/commit/?id=34bedecf7da81a8b42382254e3f9a32398c1ca5d'>34bedecf7da81a8b42382254e3f9a32398c1ca5d</a> (<a href='/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a&amp;id2=34bedecf7da81a8b42382254e3f9a32398c1ca5d'>diff</a>)</td></tr></table>
<div class='commit-subject'>user: fix insufficient path prefix check</div><div class='commit-msg'>The path prefix check can be circumvented by regular users by passing
relative path component like so:

$ dbus-send --system --print-reply --dest=org.freedesktop.Accounts \
        /org/freedesktop/Accounts/User1000 \
        org.freedesktop.Accounts.User.SetIconFile \
        string:/usr/share/../../tmp/test

This results in a user controlled path being stored in the
accountsservice. Clients of accountsservice may unwittingly trust this
path.

To fix that situation this commit canonicalizes the input path before
the prefix comparison.

Some small changes to patch by Ray Strode.

https://bugs.freedesktop.org/show_bug.cgi?id=107085
</div><div class='notes-header'>Notes</div><div class='notes'>
Notes:
    CVE-2018-14036
</div><div class='notes-footer'></div><div class='diffstat-header'><a href='/accountsservice/diff/?id=f9abd359f71a5bce421b9ae23432f539a067847a'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/accountsservice/diff/src/user.c?id=f9abd359f71a5bce421b9ae23432f539a067847a'>src/user.c</a></td><td class='right'>8</td><td class='graph'><table summary='file diffstat' width='8%'><tr><td class='add' style='width: 100.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 8 insertions, 0 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/src/user.c b/src/user.c<br/>index c8a2942..174530f 100644<br/>--- a/<a href='/accountsservice/tree/src/user.c?id=34bedecf7da81a8b42382254e3f9a32398c1ca5d'>src/user.c</a><br/>+++ b/<a href='/accountsservice/tree/src/user.c?id=f9abd359f71a5bce421b9ae23432f539a067847a'>src/user.c</a></div><div class='hunk'>@@ -1334,6 +1334,14 @@ user_change_icon_file_authorized_cb (Daemon                *daemon,</div><div class='ctx'>         }</div><div class='ctx'> </div><div class='ctx'>         file = g_file_new_for_path (filename);</div><div class='add'>+        g_clear_pointer (&amp;filename, g_free);</div><div class='add'>+</div><div class='add'>+        /* Canonicalize path so we can call g_str_has_prefix on it</div><div class='add'>+         * below without concern for ../ path components moving outside</div><div class='add'>+         * the prefix</div><div class='add'>+         */</div><div class='add'>+        filename = g_file_get_path (file);</div><div class='add'>+</div><div class='ctx'>         info = g_file_query_info (file, G_FILE_ATTRIBUTE_UNIX_MODE ","</div><div class='ctx'>                                         G_FILE_ATTRIBUTE_STANDARD_TYPE ","</div><div class='ctx'>                                         G_FILE_ATTRIBUTE_STANDARD_SIZE,</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit v1.2.1</a> (<a href='https://git-scm.com/'>git 2.18.0</a>) at 2021-10-30 22:00:04 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
