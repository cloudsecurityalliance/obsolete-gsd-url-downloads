<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 910053002: Validate debuggee.targetId before use in chrome.debugger  -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = 'd27f211847ae3679bf202bc228aff509';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/910053002%252526ust%25253D1608684484576257%252526usg%25253DAFQjCNEfSdqDrBX-8HniJsBjE7P0v54KTw%26service%3Dah">Sign out</a>

</div>
<div class="counter">(272)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-910053002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/910053002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            910053002</a>:
    Validate debuggee.targetId before use in chrome.debugger   (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            5 years, 10 months ago by <a href="/user/robwu" onMouseOver="M_showUserInfoPopup(this)">robwu</a>
          </div>
          <div><b>Modified:</b><br/>
            5 years, 10 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'>*<a href="/user/Devlin" onMouseOver="M_showUserInfoPopup(this)">Devlin</a></span>, <a href="/user/meacer" onMouseOver="M_showUserInfoPopup(this)">meacer</a>, <a href="/user/not%20at%20google%20-%20send%20to%20devlin" onMouseOver="M_showUserInfoPopup(this)">not at google - send to devlin</a>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, chromium-apps-reviews_chromium.org, extensions-reviews_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Validate debuggee.targetId before use in chrome.debugger

And refactored the tests to make sure that the debugger is detached upon
returning from RunAttachFunction. Previously, if the debugger
unexpectedly succeeded in attaching, the method would return (because
empty error != some error), causing the attached debugger to not be
detached.

<a href="mailto:R=rdevlin.cronin@chromium.org">R=rdevlin.cronin@chromium.org</a>
BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=456841">456841</a>
TEST=browser_tests DebuggerApiTest.DebuggerNotAllowedOnOtherExtensionPages

Committed: <a href="https://crrev.com/409bf9d6104f83c80cd85bd261784b39cab8e93e">https://crrev.com/409bf9d6104f83c80cd85bd261784b39cab8e93e</a>
Cr-Commit-Position: refs/heads/master@{#315675}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/910053002/#ps1"
       onclick="M_toggleSectionForPS('910053002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 12
      
    </div>
  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/910053002/#ps20001"
       onclick="M_toggleSectionForPS('910053002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Comments #4
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 6
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/910053002/#ps40001"
       onclick="M_toggleSectionForPS('910053002', '40001')"
       class="toggled-section opentriangle">
      Patch Set 3
      : Comments #6
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-40001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 5 years, 10 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue910053002_40001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/910053002/40001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+67 lines, -21 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/910053002/patch/40001/50001">
            chrome/browser/extensions/api/debugger/debugger_api.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/910053002/diff/40001/chrome/browser/extensions/api/debugger/debugger_api.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/910053002/diff2/1:40001/chrome/browser/extensions/api/debugger/debugger_api.cc"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+9 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue910053002_40001_50001.diff"
             title="Download patch for chrome/browser/extensions/api/debugger/debugger_api.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/910053002/patch/40001/50002">
            chrome/browser/extensions/api/debugger/debugger_apitest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/910053002/diff/40001/chrome/browser/extensions/api/debugger/debugger_apitest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/910053002/diff2/1:40001/chrome/browser/extensions/api/debugger/debugger_apitest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/910053002/diff2/20001:40001/chrome/browser/extensions/api/debugger/debugger_apitest.cc"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+58 lines, -21 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue910053002_40001_50002.diff"
             title="Download patch for chrome/browser/extensions/api/debugger/debugger_apitest.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 40001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 12 (4 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 12)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 12)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(12)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(12)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          rob@robwu.nl changed reviewers: + kalman@chromium.org, meacer@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-09 21:18:35 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed reviewers:
+ <a href="mailto:kalman@chromium.org">kalman@chromium.org</a>, <a href="mailto:meacer@chromium.org">meacer@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          rob@robwu.nl changed required reviewers: + rdevlin.cronin@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-09 21:18:35 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed required reviewers:
+ <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          Devlin: PTAL Ben, Mustafa: FYI
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-09 21:18:36 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >Devlin: PTAL

Ben, Mustafa: FYI</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Thanks for fixing this, Rob. :) https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc File chrome/browser/extensions/api/debugger/debugger_api.cc (right): https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533 chrome/browser/extensions/api/debugger/debugger_api.cc:533: if (PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(), I&#39;m ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-09 23:11:22 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Thanks for fixing this, Rob. :)

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
File chrome/browser/extensions/api/debugger/debugger_api.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:533: if
(PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(),
I&#39;m a little worried about race conditions here, if, for instance, the debugger
is attached before the url is fully resolved. Not sure how much we can do about
it, but a sanity check that url is_valid() would probably be better than
nothing.

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode537" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:537: agent_host_ = NULL;
nit: prefer nullptr now.

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
File chrome/browser/extensions/api/debugger/debugger_apitest.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode40" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:40:
testing::AssertionResult RunAttachFunctionImpl(
Two things:
- Despite what you see around the codebase, we try to avoid &quot;Impl&quot; names (though
we often do a terrible job).  Maybe something like
&quot;RunAttachFunctionOnTarget()&quot;?
- This should probably be private (no tests should be using it directly).

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode78" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:78: // Attach by
tabId
nit: comments should usually end in a period (also line 86).

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode140" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:140: if
(expected_error.empty()) {
We can simplify these ifs to be
if (expected_error.empty() &amp;&amp; !actual_error.empty()) {
  return ...
} else if (expected_error != actual_error) {
  return ...
}
return success;</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc File chrome/browser/extensions/api/debugger/debugger_api.cc (right): https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533 chrome/browser/extensions/api/debugger/debugger_api.cc:533: if (PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(), On 2015/02/09 23:11:22, Devlin wrote: &gt; I&#39;m ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 12:56:32 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            ><a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
File chrome/browser/extensions/api/debugger/debugger_api.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:533: if
(PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(),
On 2015/02/09 23:11:22, Devlin wrote:
&gt; I&#39;m a little worried about race conditions here, if, for instance, the
debugger
&gt; is attached before the url is fully resolved. Not sure how much we can do
about
&gt; it, but a sanity check that url is_valid() would probably be better than
&gt; nothing.

Isn&#39;t the IsValidSchemeForExtensions check in PermissionsData::IsRestrictedUrl
sufficient?

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode537" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:537: agent_host_ = NULL;
On 2015/02/09 23:11:22, Devlin wrote:
&gt; nit: prefer nullptr now.

Done, but the rest of the file still uses NULL (should I change back to NULL,
replace the rest with nullptr, or leave it as-is?).

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
File chrome/browser/extensions/api/debugger/debugger_apitest.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode40" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:40:
testing::AssertionResult RunAttachFunctionImpl(
On 2015/02/09 23:11:22, Devlin wrote:
&gt; Two things:
&gt; - Despite what you see around the codebase, we try to avoid &quot;Impl&quot; names
(though
&gt; we often do a terrible job).  Maybe something like
&gt; &quot;RunAttachFunctionOnTarget()&quot;?
&gt; - This should probably be private (no tests should be using it directly).

Done.

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode78" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:78: // Attach by
tabId
On 2015/02/09 23:11:22, Devlin wrote:
&gt; nit: comments should usually end in a period (also line 86).

Done.

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode140" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:140: if
(expected_error.empty()) {
On 2015/02/09 23:11:22, Devlin wrote:
&gt; We can simplify these ifs to be
&gt; if (expected_error.empty() &amp;&amp; !actual_error.empty()) {
&gt;   return ...
&gt; } else if (expected_error != actual_error) {
&gt;   return ...
&gt; }
&gt; return success;

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          lgtm https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc File chrome/browser/extensions/api/debugger/debugger_api.cc (right): https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533 chrome/browser/extensions/api/debugger/debugger_api.cc:533: if (PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(), On 2015/02/10 12:56:31, robwu wrote: &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 17:14:43 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >lgtm

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
File chrome/browser/extensions/api/debugger/debugger_api.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode533" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:533: if
(PermissionsData::IsRestrictedUrl(agent_host_-&gt;GetURL(),
On 2015/02/10 12:56:31, robwu wrote:
&gt; On 2015/02/09 23:11:22, Devlin wrote:
&gt; &gt; I&#39;m a little worried about race conditions here, if, for instance, the
&gt; debugger
&gt; &gt; is attached before the url is fully resolved. Not sure how much we can do
&gt; about
&gt; &gt; it, but a sanity check that url is_valid() would probably be better than
&gt; &gt; nothing.
&gt; 
&gt; Isn&#39;t the IsValidSchemeForExtensions check in PermissionsData::IsRestrictedUrl
&gt; sufficient?

Yeah, that&#39;d probably work.  Nevermind.

<a href="https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/api/debugger/debugger_api.cc#newcode537" rel="nofollow">https://codereview.chromium.org/910053002/diff/1/chrome/browser/extensions/ap...</a>
chrome/browser/extensions/api/debugger/debugger_api.cc:537: agent_host_ = NULL;
On 2015/02/10 12:56:31, robwu wrote:
&gt; On 2015/02/09 23:11:22, Devlin wrote:
&gt; &gt; nit: prefer nullptr now.
&gt; 
&gt; Done, but the rest of the file still uses NULL (should I change back to NULL,
&gt; replace the rest with nullptr, or leave it as-is?).

The rule for nullptr is pretty much just &quot;prefer nullptr&quot;.  So it&#39;s worth using
in new code, or when refactoring old code, but probably not worth contaminating
the git blame history for the whole file (which is why we haven&#39;t just done a
repo-wide find-and-replace).

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
File chrome/browser/extensions/api/debugger/debugger_apitest.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode93" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:93: base::ListValue*
targets = NULL;
nit: nullptr (also line 98)

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode100" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:100: int id;
nit: even though it shouldn&#39;t matter, please initialize this to something sane
(-1 is a good choice, since we use that for invalid tab ids).

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode110" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:110: result =
RunAttachFunctionOnTarget(debugee_by_target_id, expected_error);
nit: just return RunAttach... here.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          New patchsets have been uploaded after l-g-t-m from rdevlin.cronin@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 22:35:33 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >New patchsets have been uploaded after l-g-t-m from <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc File chrome/browser/extensions/api/debugger/debugger_apitest.cc (right): https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode93 chrome/browser/extensions/api/debugger/debugger_apitest.cc:93: base::ListValue* targets = NULL; On 2015/02/10 17:14:42, Devlin wrote: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 22:35:44 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            ><a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
File chrome/browser/extensions/api/debugger/debugger_apitest.cc (right):

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode93" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:93: base::ListValue*
targets = NULL;
On 2015/02/10 17:14:42, Devlin wrote:
&gt; nit: nullptr (also line 98)

Done.

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode100" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:100: int id;
On 2015/02/10 17:14:42, Devlin wrote:
&gt; nit: even though it shouldn&#39;t matter, please initialize this to something sane
&gt; (-1 is a good choice, since we use that for invalid tab ids).

Done.

<a href="https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extensions/api/debugger/debugger_apitest.cc#newcode110" rel="nofollow">https://codereview.chromium.org/910053002/diff/20001/chrome/browser/extension...</a>
chrome/browser/extensions/api/debugger/debugger_apitest.cc:110: result =
RunAttachFunctionOnTarget(debugee_by_target_id, expected_error);
On 2015/02/10 17:14:42, Devlin wrote:
&gt; nit: just return RunAttach... here.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          The CQ bit was checked by rob@robwu.nl
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 22:36:16 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >The CQ bit was checked by <a href="mailto:rob@robwu.nl">rob@robwu.nl</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/910053002/40001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 22:36:41 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/910053002/40001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/910053002/40001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          Committed patchset #3 (id:40001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 23:37:15 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-10"
            >Committed patchset #3 (id:40001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-11">
                          Patchset 3 (id:??) landed as https://crrev.com/409bf9d6104f83c80cd85bd261784b39cab8e93e Cr-Commit-Position: refs/heads/master@{#315675}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-10 23:37:46 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-11"
            >Patchset 3 (id:??) landed as
<a href="https://crrev.com/409bf9d6104f83c80cd85bd261784b39cab8e93e" rel="nofollow">https://crrev.com/409bf9d6104f83c80cd85bd261784b39cab8e93e</a>
Cr-Commit-Position: refs/heads/master@{#315675}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 12)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 12)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(12)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(12)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 12;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 910053002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 910053002: Validate debuggee.targetId before use in chrome.debugger 
     (Closed) </b><br/>
      Created 5 years, 10 months ago by robwu<br/>
      Modified 5 years, 10 months ago<br/>
      Reviewers: Devlin, not at google - send to devlin, meacer<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 18
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
