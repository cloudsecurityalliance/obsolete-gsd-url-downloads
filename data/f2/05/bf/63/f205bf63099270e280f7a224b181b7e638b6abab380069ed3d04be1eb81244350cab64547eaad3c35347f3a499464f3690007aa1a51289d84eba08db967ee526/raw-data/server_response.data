<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#773041 - libmspack: CVE-2014-9556: frame_end overflow which could cause infinite loop - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=773041&quot;&gt;773041&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:773041@bugs.debian.org">#773041</a><br>
libmspack: CVE-2014-9556: frame_end overflow which could cause infinite loop</h1>
<div class="versiongraph"><a href="version.cgi?found=libmspack%2F0.4-1;collapse=1;absolute=0;info=1;package=libmspack0;fixed=libmspack%2F0.4-2"><img alt="version graph" src="version.cgi?absolute=0;fixed=libmspack%2F0.4-2;width=2;found=libmspack%2F0.4-1;collapse=1;height=2;package=libmspack0"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=libmspack0">libmspack0</a>;
Maintainer for <a href="pkgreport.cgi?package=libmspack0">libmspack0</a> is <a href="pkgreport.cgi?maint=Duck%40DuckCorp.org">Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</a>; Source for <a href="pkgreport.cgi?package=libmspack0">libmspack0</a> is <a href="pkgreport.cgi?src=libmspack">src:libmspack</a> (<a href="https://tracker.debian.org/pkg/libmspack">PTS</a>, <a href="https://buildd.debian.org/libmspack">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=libmspack">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=jwilk%40debian.org">Jakub Wilk &lt;jwilk@debian.org&gt;</a></p>
  <p>Date: Thu, 11 Dec 2014 23:51:02 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: patch, security, upstream</p>

<p>Found in version libmspack/0.4-1</p>
<p>Fixed in version libmspack/0.4-2</p>

<p><strong>Done:</strong> Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=773041;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, jwilk@debian.org, Eric Sharkey &lt;sharkey@debian.org&gt; -->
<!-- time:1418341867 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, jwilk@debian.org, Eric Sharkey &lt;sharkey@debian.org&gt;</code>:<br>
<code>Bug#772891</code>; Package <code>cabextract</code>.
 (Thu, 11 Dec 2014 23:51:07 GMT) (<a href="bugreport.cgi?bug=773041;msg=2">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="3"></a><a name="msg3"></a><a href="#3">Message #3</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=3">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=3">mbox</a>, <a href="mailto:773041@bugs.debian.org?References=%3C20141211234721.GA988%40jwilk.net%3E&amp;body=On%20Fri%2C%2012%20Dec%202014%2000%3A47%3A21%20%2B0100%20Jakub%20Wilk%20%3Cjwilk%40debian.org%3E%20wrote%3A%0A%3E%20Package%3A%20cabextract%0A%3E%20Version%3A%201.4-4%2Bb1%0A%3E%20Severity%3A%20minor%0A%3E%20Usertags%3A%20afl%0A%3E%20%0A%3E%20The%20attached%20file%20makes%20cabextract%20hang%20forever%20%28or%20at%20least%20for%20two%20%0A%3E%20minutes%2C%20after%20which%20I%20lost%20my%20patience%20%3A-P%29.%0A%3E%20%0A%3E%20This%20bug%20was%20found%20using%20American%20fuzzy%20lop%3A%0A%3E%20http%3A%2F%2Flcamtuf.coredump.cx%2Fafl%2F%0A%3E%20%0A%3E%20%0A%3E%20--%20System%20Information%3A%0A%3E%20Debian%20Release%3A%208.0%0A%3E%20%20%20APT%20prefers%20unstable%0A%3E%20%20%20APT%20policy%3A%20%28990%2C%20%27unstable%27%29%2C%20%28500%2C%20%27experimental%27%29%0A%3E%20Architecture%3A%20i386%20%28x86_64%29%0A%3E%20Foreign%20Architectures%3A%20amd64%0A%3E%20%0A%3E%20Kernel%3A%20Linux%203.2.0-4-amd64%20%28SMP%20w%2F2%20CPU%20cores%29%0A%3E%20Locale%3A%20LANG%3DC%2C%20LC_CTYPE%3Dpl_PL.UTF-8%20%28charmap%3DUTF-8%29%0A%3E%20Shell%3A%20%2Fbin%2Fsh%20linked%20to%20%2Fbin%2Fdash%0A%3E%20Init%3A%20sysvinit%20%28via%20%2Fsbin%2Finit%29%0A%3E%20%0A%3E%20Versions%20of%20packages%20cabextract%20depends%20on%3A%0A%3E%20ii%20%20libc6%20%202.19-13%0A%3E%20%0A%3E%20--%20%0A%3E%20Jakub%20Wilk%0A&amp;In-Reply-To=%3C20141211234721.GA988%40jwilk.net%3E&amp;subject=Re%3A%20cabextract%3A%20hangs%20on%20a%20crafted%20CAB%20file">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jwilk%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Jakub Wilk &lt;jwilk@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> cabextract: hangs on a crafted CAB file</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 12 Dec 2014 00:47:21 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=773041;msg=3">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message flowed">Package: cabextract
Version: 1.4-4+b1
Severity: minor
Usertags: afl

The attached file makes cabextract hang forever (or at least for two 
minutes, after which I lost my patience :-P).

This bug was found using American fuzzy lop:
<a href="http://lcamtuf.coredump.cx/afl/">http://lcamtuf.coredump.cx/afl/</a>


-- System Information:
Debian Release: 8.0
 APT prefers unstable
 APT policy: (990, &#39;unstable&#39;), (500, &#39;experimental&#39;)
Architecture: i386 (x86_64)
Foreign Architectures: amd64

Kernel: Linux 3.2.0-4-amd64 (SMP w/2 CPU cores)
Locale: LANG=C, LC_CTYPE=pl_PL.UTF-8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash
Init: sysvinit (via /sbin/init)

Versions of packages cabextract depends on:
ii  libc6  2.19-13

-- 
Jakub Wilk
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=773041;filename=hang.cab;msg=3">hang.cab</a> (application/x-cab, attachment)]</pre>

<div class="infmessage"><hr><p>
<a name="4"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Eric Sharkey &lt;sharkey@debian.org&gt; -->
<!-- time:1418360584 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Eric Sharkey &lt;sharkey@debian.org&gt;</code>:<br>
<code>Bug#772891</code>; Package <code>cabextract</code>.
 (Fri, 12 Dec 2014 05:03:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=5">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=5">mbox</a>, <a href="#4">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: Eric Sharkey &lt;eric@lisaneric.org&gt; -->
<!-- time:1418360584 -->
<strong>Acknowledgement sent</strong>
to <code>Eric Sharkey &lt;eric@lisaneric.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Eric Sharkey &lt;sharkey@debian.org&gt;</code>.
 (Fri, 12 Dec 2014 05:03:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=7">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="8"></a><a name="msg8"></a><a href="#8">Message #8</a> received at 772891@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=8">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=8">mbox</a>, <a href="mailto:773041@bugs.debian.org?body=On%20Fri%2C%2012%20Dec%202014%2000%3A00%3A37%20-0500%20Eric%20Sharkey%20%3Ceric%40lisaneric.org%3E%20wrote%3A%0A%3E%20On%20Thu%2C%20Dec%2011%2C%202014%20at%206%3A47%20PM%2C%20Jakub%20Wilk%20%3Cjwilk%40debian.org%3E%20wrote%3A%0A%3E%20%3E%20Package%3A%20cabextract%0A%3E%20%3E%20Version%3A%201.4-4%2Bb1%0A%3E%20%3E%20Severity%3A%20minor%0A%3E%20%3E%20Usertags%3A%20afl%0A%3E%20%3E%0A%3E%20%3E%20The%20attached%20file%20makes%20cabextract%20hang%20forever%20%28or%20at%20least%20for%20two%0A%3E%20%3E%20minutes%2C%20after%20which%20I%20lost%20my%20patience%20%3A-P%29.%0A%3E%20%3E%0A%3E%20%3E%20This%20bug%20was%20found%20using%20American%20fuzzy%20lop%3A%0A%3E%20%3E%20http%3A%2F%2Flcamtuf.coredump.cx%2Fafl%2F%0A%3E%20%0A%3E%20It%27s%20definitely%20an%20infinite%20loop.%20%20It%20gets%20caught%20in%20qtmd_decompress%28%29%0A%3E%20and%20never%20gets%20out%20of%20the%20loop%20on%20line%20290.%0A%3E%20%0A%3E%20The%20problem%20seems%20to%20be%20on%20this%20line%3A%0A%3E%20%0A%3E%20%20%20%20%20%2F%2A%20decode%20more%2C%20up%20to%20the%20number%20of%20bytes%20needed%2C%20the%20frame%20boundary%2C%0A%3E%20%20%20%20%20%20%2A%20or%20the%20window%20boundary%2C%20whichever%20comes%20first%20%2A%2F%0A%3E%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20%28out_bytes%20-%20%28qtm-%3Eo_end%20-%20qtm-%3Eo_ptr%29%29%3B%0A%3E%20%0A%3E%20out_bytes%20is%20an%20off_t%20%288%20bytes%29%20but%20frame_end%20is%20an%20unsigned%20int%20%284%0A%3E%20bytes%29%20and%20it%20overflows.%0A%3E%20%0A%3E%20If%20I%20change%20the%20%22unsigned%20int%22%20to%20%22off_t%22%20in%20the%20first%20line%20of%20this%0A%3E%20function%2C%20the%20function%20terminates%20properly%20and%20declares%20the%20file%0A%3E%20corrupt%3A%0A%3E%20%0A%3E%20%0A%3E%20marvin%25%20.%2Fcabextract%20~%2FDownload%2Fhang.cab%0A%3E%20Extracting%20cabinet%3A%20%2Fhome%2Fsharkey%2FDownload%2Fhang.cab%0A%3E%20%20%20extracting%20limerick%0A%3E%20limerick%3A%20error%20in%20CAB%20data%20format%0A%3E%20%0A%3E%20All%20done%2C%20errors%20in%20processing%201%20file%28s%29%0A%3E%20%0A%3E%20%0A%3E%20Stuart%2C%20is%20this%20the%20right%20fix%20in%20your%20opinion%3F%0A%3E%20%0A%3E%20Eric%0A%3E%20%0A%3E%20%0A&amp;References=%3C20141211234721.GA988%40jwilk.net%3E%0A%20%3CCAC73aR3J84P%2BpOqOVOJp1Bez1PYAoP6C_ABJ_Ky3FxnrQ3CHEg%40mail.gmail.com%3E&amp;subject=Re%3A%20Bug%23772891%3A%20cabextract%3A%20hangs%20on%20a%20crafted%20CAB%20file&amp;In-Reply-To=%3CCAC73aR3J84P%2BpOqOVOJp1Bez1PYAoP6C_ABJ_Ky3FxnrQ3CHEg%40mail.gmail.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=eric%40lisaneric.org" alt="">
<div class="header"><span class="headerfield">From:</span> Eric Sharkey &lt;eric@lisaneric.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Jakub Wilk &lt;jwilk@debian.org&gt;, 772891@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> kyzer@4u.net</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#772891: cabextract: hangs on a crafted CAB file</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 12 Dec 2014 00:00:37 -0500</div>
</div>
<pre class="message">On Thu, Dec 11, 2014 at 6:47 PM, Jakub Wilk &lt;jwilk@debian.org&gt; wrote:
&gt; Package: cabextract
&gt; Version: 1.4-4+b1
&gt; Severity: minor
&gt; Usertags: afl
&gt;
&gt; The attached file makes cabextract hang forever (or at least for two
&gt; minutes, after which I lost my patience :-P).
&gt;
&gt; This bug was found using American fuzzy lop:
&gt; <a href="http://lcamtuf.coredump.cx/afl/">http://lcamtuf.coredump.cx/afl/</a>

It&#39;s definitely an infinite loop.  It gets caught in qtmd_decompress()
and never gets out of the loop on line 290.

The problem seems to be on this line:

    /* decode more, up to the number of bytes needed, the frame boundary,
     * or the window boundary, whichever comes first */
    frame_end = window_posn + (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr));

out_bytes is an off_t (8 bytes) but frame_end is an unsigned int (4
bytes) and it overflows.

If I change the &quot;unsigned int&quot; to &quot;off_t&quot; in the first line of this
function, the function terminates properly and declares the file
corrupt:


marvin% ./cabextract ~/Download/hang.cab
Extracting cabinet: /home/sharkey/Download/hang.cab
  extracting limerick
limerick: error in CAB data format

All done, errors in processing 1 file(s)


Stuart, is this the right fix in your opinion?

Eric


</pre>

<div class="infmessage"><hr><p>
<a name="9"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Eric Sharkey &lt;sharkey@debian.org&gt; -->
<!-- time:1418482084 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Eric Sharkey &lt;sharkey@debian.org&gt;</code>:<br>
<code>Bug#772891</code>; Package <code>cabextract</code>.
 (Sat, 13 Dec 2014 14:48:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=10">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=10">mbox</a>, <a href="#9">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="11"></a>
<!-- request_addr: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- time:1418482084 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Eric Sharkey &lt;sharkey@debian.org&gt;</code>.
 (Sat, 13 Dec 2014 14:48:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=12">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="13"></a><a name="msg13"></a><a href="#13">Message #13</a> received at 772891@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=13">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=13">mbox</a>, <a href="mailto:773041@bugs.debian.org?body=On%20Sat%2C%2013%20Dec%202014%2015%3A44%3A29%20%2B0100%20Sebastian%20Ramacher%20%3Csramacher%40debian.org%3E%20wrote%3A%0A%3E%20Control%3A%20clone%20-1%20-2%0A%3E%20Control%3A%20reassign%20-2%20libmspack0%200.4-1%0A%3E%20Control%3A%20retitle%20-2%20libmspack%3A%20hangs%20on%20a%20crafted%20CAB%20file%0A%3E%20%0A%3E%20On%202014-12-12%2000%3A47%3A21%2C%20Jakub%20Wilk%20wrote%3A%0A%3E%20%3E%20Package%3A%20cabextract%0A%3E%20%3E%20Version%3A%201.4-4%2Bb1%0A%3E%20%3E%20Severity%3A%20minor%0A%3E%20%3E%20Usertags%3A%20afl%0A%3E%20%3E%20%0A%3E%20%3E%20The%20attached%20file%20makes%20cabextract%20hang%20forever%20%28or%20at%20least%20for%20two%0A%3E%20%3E%20minutes%2C%20after%20which%20I%20lost%20my%20patience%20%3A-P%29.%0A%3E%20%3E%20%0A%3E%20%3E%20This%20bug%20was%20found%20using%20American%20fuzzy%20lop%3A%0A%3E%20%3E%20http%3A%2F%2Flcamtuf.coredump.cx%2Fafl%2F%0A%3E%20%0A%3E%20This%20issue%20also%20affects%20libmspack.%20I%20noticed%20this%20while%20clamav%20was%0A%3E%20scanning%20Jakub%27s%20mail%20for%20malware%20and%20it%20was%20stuck%20in%20an%20infinite%20loop.%0A%3E%20%0A%3E%20The%20issue%20is%20easy%20to%20reproduce%20with%20the%20crafted%20file%20and%20the%20following%0A%3E%20example%20code%3A%0A%3E%20%0A%3E%20%23include%20%3Cstdio.h%3E%0A%3E%20%23include%20%3Cunistd.h%3E%0A%3E%20%23include%20%3Cmspack.h%3E%0A%3E%20%0A%3E%20int%20main%28%29%0A%3E%20%7B%0A%3E%20%20%20struct%20mscab_decompressor%20%2Acabd%3B%0A%3E%20%20%20struct%20mscabd_cabinet%20%2Acab%3B%0A%3E%20%20%20struct%20mscabd_file%20%2Afile%3B%0A%3E%20%20%20int%20test%3B%0A%3E%20%0A%3E%20%20%20MSPACK_SYS_SELFTEST%28test%29%3B%0A%3E%20%20%20if%20%28test%20%21%3D%20MSPACK_ERR_OK%29%20exit%280%29%3B%0A%3E%20%20%20if%20%28%28cabd%20%3D%20mspack_create_cab_decompressor%28NULL%29%29%29%20%7B%0A%3E%20%20%20%20%20if%20%28%28cab%20%3D%20cabd-%3Eopen%28cabd%2C%20%22hang.cab%22%29%29%29%20%7B%0A%3E%20%20%20%20%20%20%20for%20%28file%20%3D%20cab-%3Efiles%3B%20file%3B%20file%20%3D%20file-%3Enext%29%20%7B%0A%3E%20%20%20%20%20%20%20%20%20printf%28%22%25s%5Cn%22%2C%20file-%3Efilename%29%3B%0A%3E%20%20%20%20%20%20%20%20%20cabd-%3Eextract%28cabd%2C%20file%2C%20file-%3Efilename%29%3B%0A%3E%20%20%20%20%20%20%20%7D%0A%3E%20%20%20%20%20%20%20cabd-%3Eclose%28cabd%2C%20cab%29%3B%0A%3E%20%20%20%20%20%7D%0A%3E%20%20%20%20%20mspack_destroy_cab_decompressor%28cabd%29%3B%0A%3E%20%20%20%7D%0A%3E%20%20%20return%200%3B%0A%3E%20%7D%0A%3E%20%0A%3E%20%28From%20https%3A%2F%2Fgithub.com%2Fcooljeanius%2Flibmspack%2Fblob%2Fmaster%2FREADME%20with%20a%0A%3E%20call%20to%20extract%20added.%29%0A%3E%20%0A%3E%20Cheers%0A%3E%20--%20%0A%3E%20Sebastian%20Ramacher%0A&amp;References=%3C20141211234721.GA988%40jwilk.net%3E%0A%20%3C20141213144429.GA27622%40ramacher.at%3E&amp;In-Reply-To=%3C20141213144429.GA27622%40ramacher.at%3E&amp;subject=Re%3A%20Bug%23772891%3A%20cabextract%3A%20hangs%20on%20a%20crafted%20CAB%20file">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sramacher%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastian Ramacher &lt;sramacher@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Jakub Wilk &lt;jwilk@debian.org&gt;, 772891@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#772891: cabextract: hangs on a crafted CAB file</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 13 Dec 2014 15:44:29 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=773041;msg=13">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Control: clone -1 -2
Control: reassign -2 libmspack0 0.4-1
Control: retitle -2 libmspack: hangs on a crafted CAB file

On 2014-12-12 00:47:21, Jakub Wilk wrote:
&gt; Package: cabextract
&gt; Version: 1.4-4+b1
&gt; Severity: minor
&gt; Usertags: afl
&gt; 
&gt; The attached file makes cabextract hang forever (or at least for two
&gt; minutes, after which I lost my patience :-P).
&gt; 
&gt; This bug was found using American fuzzy lop:
&gt; <a href="http://lcamtuf.coredump.cx/afl/">http://lcamtuf.coredump.cx/afl/</a>

This issue also affects libmspack. I noticed this while clamav was
scanning Jakub&#39;s mail for malware and it was stuck in an infinite loop.

The issue is easy to reproduce with the crafted file and the following
example code:

#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
#include &lt;mspack.h&gt;

int main()
{
  struct mscab_decompressor *cabd;
  struct mscabd_cabinet *cab;
  struct mscabd_file *file;
  int test;

  MSPACK_SYS_SELFTEST(test);
  if (test != MSPACK_ERR_OK) exit(0);
  if ((cabd = mspack_create_cab_decompressor(NULL))) {
    if ((cab = cabd-&gt;open(cabd, &quot;hang.cab&quot;))) {
      for (file = cab-&gt;files; file; file = file-&gt;next) {
        printf(&quot;%s\n&quot;, file-&gt;filename);
        cabd-&gt;extract(cabd, file, file-&gt;filename);
      }
      cabd-&gt;close(cabd, cab);
    }
    mspack_destroy_cab_decompressor(cabd);
  }
  return 0;
}

(From <a href="https://github.com/cooljeanius/libmspack/blob/master/README">https://github.com/cooljeanius/libmspack/blob/master/README</a> with a
call to extract added.)

Cheers
-- 
Sebastian Ramacher
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=773041;filename=signature.asc;msg=13">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="14"></a>
<!-- requester: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- request_addr: 772891-submit@bugs.debian.org -->
<!-- time:1418482084 -->
<strong>Bug <a href="bugreport.cgi?bug=772891">772891</a> cloned as bug <a href="bugreport.cgi?bug=773041">773041</a></strong>
Request was from <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>
to <code>772891-submit@bugs.debian.org</code>.
 (Sat, 13 Dec 2014 14:48:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=15">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=15">mbox</a>, <a href="#14">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="16"></a>
<!-- command:package -->
<!-- requester: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- request_addr: 772891-submit@bugs.debian.org -->
<!-- time:1418482085 -->
<!-- new_data:
$new_data = {
              &#39;package&#39; =&gt; &#39;libmspack0&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;package&#39; =&gt; &#39;cabextract&#39;
            };
-->
<strong>Bug reassigned from package &#39;<a href="pkgreport.cgi?package=cabextract">cabextract</a>&#39; to &#39;<a href="pkgreport.cgi?package=libmspack0">libmspack0</a>&#39;.</strong>
Request was from <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>
to <code>772891-submit@bugs.debian.org</code>.
 (Sat, 13 Dec 2014 14:48:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=17">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="18"></a>
<!-- command:found -->
<!-- requester: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- request_addr: 772891-submit@bugs.debian.org -->
<!-- time:1418482086 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;cabextract/1.4-4&#39;
                                  ]
            };
-->
<strong>No longer marked as found in versions cabextract/1.4-4.</strong>
Request was from <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>
to <code>772891-submit@bugs.debian.org</code>.
 (Sat, 13 Dec 2014 14:48:06 GMT) (<a href="bugreport.cgi?bug=773041;msg=19">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="20"></a>
<!-- command:found -->
<!-- requester: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- request_addr: 772891-submit@bugs.debian.org -->
<!-- time:1418482086 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libmspack/0.4-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<strong>Marked as found in versions libmspack/0.4-1.</strong>
Request was from <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>
to <code>772891-submit@bugs.debian.org</code>.
 (Sat, 13 Dec 2014 14:48:06 GMT) (<a href="bugreport.cgi?bug=773041;msg=21">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="22"></a>
<!-- command:title -->
<!-- requester: Sebastian Ramacher &lt;sramacher@debian.org&gt; -->
<!-- request_addr: 772891-submit@bugs.debian.org -->
<!-- time:1418482087 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;libmspack: hangs on a crafted CAB file&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;cabextract: hangs on a crafted CAB file&#39;
            };
-->
<strong>Changed Bug title to &#39;libmspack: hangs on a crafted CAB file&#39; from &#39;cabextract: hangs on a crafted CAB file&#39;</strong>
Request was from <code>Sebastian Ramacher &lt;sramacher@debian.org&gt;</code>
to <code>772891-submit@bugs.debian.org</code>.
 (Sat, 13 Dec 2014 14:48:07 GMT) (<a href="bugreport.cgi?bug=773041;msg=23">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=23">mbox</a>, <a href="#22">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="24"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419074105 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Sat, 20 Dec 2014 11:15:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=25">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=25">mbox</a>, <a href="#24">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="26"></a>
<!-- request_addr: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt; -->
<!-- time:1419074105 -->
<strong>Acknowledgement sent</strong>
to <code>Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Sat, 20 Dec 2014 11:15:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=27">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=27">mbox</a>, <a href="#26">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="28"></a><a name="msg28"></a><a href="#28">Message #28</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=28">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=28">mbox</a>, <a href="mailto:773041@bugs.debian.org?body=On%20Sat%2C%2020%20Dec%202014%2012%3A12%3A13%20%2B0100%20Andreas%20Cadhalpun%20%3Candreas.cadhalpun%40googlemail.com%3E%20wrote%3A%0A%3E%20Control%3A%20tags%20773041%20security%0A%3E%20Control%3A%20severity%20773041%20grave%0A%3E%20Justification%3A%20causes%20remote%20denial%20of%20service%0A%3E%20%0A%3E%20Hi%20James%2C%0A%3E%20%0A%3E%20On%2019.12.2014%2023%3A12%2C%20James%20Cloos%20wrote%3A%0A%3E%20%3E%20Even%20w%2F%20the%20milter%20not%20called%2C%20one%20of%20the%20MXs%20has%20one%20clamd%20thread%0A%3E%20%3E%20consuming%20100%25%20cpu%20right%20now.%20%20gdb%20says%3A%0A%3E%20%3E%0A%3E%20%3E%20%230%20%200x00007fd0b4791ed0%20in%20%3F%3F%20%28%29%20from%20%2Fusr%2Flib%2Fx86_64-linux-gnu%2Flibmspack.so.0%0A%3E%20%3E%20%231%20%200x00007fd0b47863ea%20in%20%3F%3F%20%28%29%20from%20%2Fusr%2Flib%2Fx86_64-linux-gnu%2Flibmspack.so.0%0A%3E%20%3E%20%232%20%200x00007fd0b55c1e26%20in%20cli_scanmscab%20%28ctx%3D0x7fd096dfb6b0%2C%20sfx_offset%3D256%29%20at%20libmspack.c%3A384%0A%3E%20%3E%20%233%20%200x00007fd0b5597aa0%20in%20magic_scandesc%20%28ctx%3D0x7fd096dfb6b0%2C%20type%3DCL_TYPE_ANY%29%0A%3E%20%3E%20%20%20%20%20%20at%20scanners.c%3A2703%0A%3E%20%3E%20%234%20%200x00007fd0b5598059%20in%20cli_base_scandesc%20%28desc%3D12%2C%20ctx%3D0x7fd096dfb6b0%2C%20type%3DCL_TYPE_ANY%29%0A%3E%20%3E%20%20%20%20%20%20at%20scanners.c%3A3051%0A%3E%20%3E%20%235%20%200x00007fd0b559bf33%20in%20fileblobScan%20%28fb%3D0x7fd088003910%29%20at%20blob.c%3A641%0A%3E%20%3E%20%236%20%200x00007fd0b559c01d%20in%20fileblobScanAndDestroy%20%28fb%3Dfb%40entry%3D0x7fd088003910%29%20at%20blob.c%3A399%0A%3E%20%3E%20%237%20%200x00007fd0b55a08db%20in%20do_multipart%20%28mainMessage%3D0x0%2C%20messages%3D%3Coptimized%20out%3E%2C%0A%3E%20%3E%20%20%20%20%20%20i%3D%3Coptimized%20out%3E%2C%20rc%3D0x7fd096dfa35c%2C%20mctx%3D0x7fd096dfa420%2C%20messageIn%3D%3Coptimized%20out%3E%2C%0A%3E%20%3E%20%20%20%20%20%20tptr%3D0x7fd096dfa360%2C%20recursion_level%3D0%29%20at%20mbox.c%3A3712%0A%3E%20%3E%20%238%20%200x00007fd0b55a0019%20in%20parseEmailBody%20%28messageIn%3D0x7fd095df4000%2C%0A%3E%20%3E%20%20%20%20%20%20messageIn%40entry%3D0x7fd088004940%2C%20textIn%3D0x100%2C%20textIn%40entry%3D0x0%2C%20mctx%3D0x7fd0880047b1%2C%0A%3E%20%3E%20%20%20%20%20%20recursion_level%3D32512%2C%20recursion_level%40entry%3D0%29%20at%20mbox.c%3A1533%0A%3E%20%3E%20%239%20%200x00007fd0b55a1232%20in%20cli_parse_mbox%20%28%0A%3E%20%3E%20%20%20%20%20%20dir%3Ddir%40entry%3D0x7fd088000e50%20%22%2Ftmp%2Fclamav-4b94ddbad0a132b5af6d2f6db3a76e40.tmp%22%2C%0A%3E%20%3E%20%20%20%20%20%20ctx%3Dctx%40entry%3D0x7fd096dfb6b0%29%20at%20mbox.c%3A508%0A%3E%20%3E%20%2310%200x00007fd0b55a1b1a%20in%20cli_mbox%20%28%0A%3E%20%3E%20%20%20%20%20%20dir%3Ddir%40entry%3D0x7fd088000e50%20%22%2Ftmp%2Fclamav-4b94ddbad0a132b5af6d2f6db3a76e40.tmp%22%2C%0A%3E%20%3E%20%20%20%20%20%20ctx%3Dctx%40entry%3D0x7fd096dfb6b0%29%20at%20mbox.c%3A309%0A%3E%20%3E%20%2311%200x00007fd0b5579218%20in%20cli_scanmail%20%28ctx%3D0x7fd096dfb6b0%29%20at%20scanners.c%3A1702%0A%3E%20%0A%3E%20Thanks%20for%20the%20backtrace%21%0A%3E%20%0A%3E%20As%20it%20shows%20that%20clamd%20hangs%20in%20libmspack%2C%20I%20think%20this%20is%20bug%20%23773041%20%0A%3E%20%5B1%5D.%20A%20possible%20fix%20is%20mentioned%20in%20%5B2%5D.%20We%27ll%20have%20to%20include%20it%20in%20the%20%0A%3E%20libmspack%20copy%20embedded%20in%20clamav%2C%20which%20is%20used%20in%20wheezy.%0A%3E%20%0A%3E%20Best%20regards%2C%0A%3E%20Andreas%0A%3E%20%0A%3E%20%0A%3E%201%3A%20https%3A%2F%2Fbugs.debian.org%2F773041%0A%3E%202%3A%20https%3A%2F%2Fbugs.debian.org%2F773041%238%0A%3E%20%0A%3E%20%0A&amp;References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%09%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%09%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%20%3C54909C46.1010109%40googlemail.com%3E%09%3C5490A05E.5070700%40googlemail.com%3E%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E&amp;In-Reply-To=%3C5495598D.6020706%40googlemail.com%3E&amp;subject=Re%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=andreas.cadhalpun%40googlemail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> James Cloos &lt;cloos@jhcloos.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773318@bugs.debian.org, 773041@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 20 Dec 2014 12:12:13 +0100</div>
</div>
<pre class="message flowed">Control: tags 773041 security
Control: severity 773041 grave
Justification: causes remote denial of service

Hi James,

On 19.12.2014 23:12, James Cloos wrote:
&gt; Even w/ the milter not called, one of the MXs has one clamd thread
&gt; consuming 100% cpu right now.  gdb says:
&gt;
&gt; #0  0x00007fd0b4791ed0 in ?? () from /usr/lib/x86_64-linux-gnu/libmspack.so.0
&gt; #1  0x00007fd0b47863ea in ?? () from /usr/lib/x86_64-linux-gnu/libmspack.so.0
&gt; #2  0x00007fd0b55c1e26 in cli_scanmscab (ctx=0x7fd096dfb6b0, sfx_offset=256) at libmspack.c:384
&gt; #3  0x00007fd0b5597aa0 in magic_scandesc (ctx=0x7fd096dfb6b0, type=CL_TYPE_ANY)
&gt;      at scanners.c:2703
&gt; #4  0x00007fd0b5598059 in cli_base_scandesc (desc=12, ctx=0x7fd096dfb6b0, type=CL_TYPE_ANY)
&gt;      at scanners.c:3051
&gt; #5  0x00007fd0b559bf33 in fileblobScan (fb=0x7fd088003910) at blob.c:641
&gt; #6  0x00007fd0b559c01d in fileblobScanAndDestroy (fb=fb@entry=0x7fd088003910) at blob.c:399
&gt; #7  0x00007fd0b55a08db in do_multipart (mainMessage=0x0, messages=&lt;optimized out&gt;,
&gt;      i=&lt;optimized out&gt;, rc=0x7fd096dfa35c, mctx=0x7fd096dfa420, messageIn=&lt;optimized out&gt;,
&gt;      tptr=0x7fd096dfa360, recursion_level=0) at mbox.c:3712
&gt; #8  0x00007fd0b55a0019 in parseEmailBody (messageIn=0x7fd095df4000,
&gt;      messageIn@entry=0x7fd088004940, textIn=0x100, textIn@entry=0x0, mctx=0x7fd0880047b1,
&gt;      recursion_level=32512, recursion_level@entry=0) at mbox.c:1533
&gt; #9  0x00007fd0b55a1232 in cli_parse_mbox (
&gt;      dir=dir@entry=0x7fd088000e50 &quot;/tmp/clamav-4b94ddbad0a132b5af6d2f6db3a76e40.tmp&quot;,
&gt;      ctx=ctx@entry=0x7fd096dfb6b0) at mbox.c:508
&gt; #10 0x00007fd0b55a1b1a in cli_mbox (
&gt;      dir=dir@entry=0x7fd088000e50 &quot;/tmp/clamav-4b94ddbad0a132b5af6d2f6db3a76e40.tmp&quot;,
&gt;      ctx=ctx@entry=0x7fd096dfb6b0) at mbox.c:309
&gt; #11 0x00007fd0b5579218 in cli_scanmail (ctx=0x7fd096dfb6b0) at scanners.c:1702

Thanks for the backtrace!

As it shows that clamd hangs in libmspack, I think this is bug #773041 
[1]. A possible fix is mentioned in [2]. We&#39;ll have to include it in the 
libmspack copy embedded in clamav, which is used in wheezy.

Best regards,
Andreas


1: <a href="https://bugs.debian.org/773041">https://bugs.debian.org/773041</a>
2: <a href="https://bugs.debian.org/773041#8">https://bugs.debian.org/773041#8</a>


</pre>

<div class="msgreceived"><hr><p>
<a name="29"></a>
<!-- command:tag -->
<!-- requester: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt; -->
<!-- request_addr: 773041-submit@bugs.debian.org -->
<!-- time:1419074105 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) security.</strong>
Request was from <code>Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</code>
to <code>773041-submit@bugs.debian.org</code>.
 (Sat, 20 Dec 2014 11:15:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=30">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=30">mbox</a>, <a href="#29">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="31"></a>
<!-- requester: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt; -->
<!-- request_addr: 773041-submit@bugs.debian.org -->
<!-- time:1419074106 -->
<strong>Severity set to &#39;grave&#39; from &#39;minor&#39;</strong>
Request was from <code>Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</code>
to <code>773041-submit@bugs.debian.org</code>.
 (Sat, 20 Dec 2014 11:15:06 GMT) (<a href="bugreport.cgi?bug=773041;msg=32">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=32">mbox</a>, <a href="#31">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="33"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419196864 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Sun, 21 Dec 2014 21:21:04 GMT) (<a href="bugreport.cgi?bug=773041;msg=34">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="35"></a>
<!-- request_addr: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt; -->
<!-- time:1419196865 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Sun, 21 Dec 2014 21:21:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=36">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=36">mbox</a>, <a href="#35">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="37"></a><a name="msg37"></a><a href="#37">Message #37</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=37">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=37">mbox</a>, <a href="mailto:773041@bugs.debian.org?In-Reply-To=%3C20141221211609.GB2382%40breakpoint.cc%3E&amp;subject=Re%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;body=On%20Sun%2C%2021%20Dec%202014%2022%3A16%3A09%20%2B0100%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%20wrote%3A%0A%3E%20On%202014-12-20%2012%3A12%3A13%20%5B%2B0100%5D%2C%20Andreas%20Cadhalpun%20wrote%3A%0A%3E%20%3E%20As%20it%20shows%20that%20clamd%20hangs%20in%20libmspack%2C%20I%20think%20this%20is%20bug%20%23773041%20%5B1%5D.%0A%3E%20%3E%20A%20possible%20fix%20is%20mentioned%20in%20%5B2%5D.%20We%27ll%20have%20to%20include%20it%20in%20the%0A%3E%20%3E%20libmspack%20copy%20embedded%20in%20clamav%2C%20which%20is%20used%20in%20wheezy.%0A%3E%20%0A%3E%20Oh%20great.%20So%20for%20clamav%20we%20have%20to%20fix%20it%20stable%20since%20sid%20uses%20the%0A%3E%20external%20library%20%28jay%21%29.%0A%3E%20This%20%22type%20fix%22%20does%20not%20look%20that%20bad.%20Do%20we%20wait%20for%20the%20upstream%0A%3E%20maintainer%20on%20this%20atm%3F%0A%3E%20%0A%3E%20Is%20the%20security%20team%20aware%20of%20the%20various%20in-tree%20copy%20of%20this%20library%3F%0A%3E%20%23675555%20tries%20%2F%20tried%20to%20track%20them.%0A%3E%20%0A%3E%20%3E%20Best%20regards%2C%0A%3E%20%3E%20Andreas%0A%3E%20%0A%3E%20Sebastian%0A%3E%20%0A%3E%20%0A&amp;References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%0A%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%0A%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%0A%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%0A%20%3C20141221211609.GB2382%40breakpoint.cc%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sebastian%40breakpoint.cc" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</div>
<div class="header"><span class="headerfield">To:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;,
	773318@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> James Cloos &lt;cloos@jhcloos.com&gt;, 773041@bugs.debian.org,
	Josselin Mouette &lt;joss@debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 21 Dec 2014 22:16:09 +0100</div>
</div>
<pre class="message">On 2014-12-20 12:12:13 [+0100], Andreas Cadhalpun wrote:
&gt; As it shows that clamd hangs in libmspack, I think this is bug #773041 [1].
&gt; A possible fix is mentioned in [2]. We&#39;ll have to include it in the
&gt; libmspack copy embedded in clamav, which is used in wheezy.

Oh great. So for clamav we have to fix it stable since sid uses the
external library (jay!).
This &quot;type fix&quot; does not look that bad. Do we wait for the upstream
maintainer on this atm?

Is the security team aware of the various in-tree copy of this library?
#675555 tries / tried to track them.

&gt; Best regards,
&gt; Andreas

Sebastian


</pre>

<div class="infmessage"><hr><p>
<a name="38"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419213425 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Mon, 22 Dec 2014 01:57:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=39">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="40"></a>
<!-- request_addr: duck@duckcorp.org -->
<!-- time:1419213425 -->
<strong>Acknowledgement sent</strong>
to <code>duck@duckcorp.org</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Mon, 22 Dec 2014 01:57:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=41">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=41">mbox</a>, <a href="#40">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="42"></a><a name="msg42"></a><a href="#42">Message #42</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=42">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=42">mbox</a>, <a href="mailto:773041@bugs.debian.org?subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E&amp;References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%0A%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%20%3C20141221211609.GB2382%40breakpoint.cc%3E%0A%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E&amp;body=On%20Mon%2C%2022%20Dec%202014%2002%3A52%3A02%20%2B0100%20%3D%3FUTF-8%3FQ%3FMarc_Dequ%3DC3%3DA8nes_%3D28duck%3D29%3F%3D%20%3Cduck%40duckcorp.org%3E%20wrote%3A%0A%3E%20Coin%2C%0A%3E%20%0A%3E%20On%202014-12-21%2022%3A16%2C%20Sebastian%20Andrzej%20Siewior%20wrote%3A%0A%3E%20%3E%20On%202014-12-20%2012%3A12%3A13%20%5B%2B0100%5D%2C%20Andreas%20Cadhalpun%20wrote%3A%0A%3E%20%3E%3E%20As%20it%20shows%20that%20clamd%20hangs%20in%20libmspack%2C%20I%20think%20this%20is%20bug%20%23773041%20%0A%3E%20%3E%3E%20%5B1%5D.%0A%3E%20%3E%3E%20A%20possible%20fix%20is%20mentioned%20in%20%5B2%5D.%0A%3E%20%0A%3E%20I%20can%20upload%20this%20simple%20fix%20quickly%2C%20nevertheless%20i%20did%20not%20have%20time%20%0A%3E%20to%20proofread%20it.%20Any%20comment%3F%0A%3E%20%0A%3E%20%3E%20Is%20the%20security%20team%20aware%20of%20the%20various%20in-tree%20copy%20of%20this%20library%3F%0A%3E%20%3E%20%23675555%20tries%20%2F%20tried%20to%20track%20them.%0A%3E%20%0A%3E%20Joss%20filled%20%23675560%20tagged%20security.%0A%3E%20%0A%3E%20I%20tested%20the%20cabextract%20build%20using%20the%20library%20but%20had%20no%20reply.%20I%20%0A%3E%20wanted%20to%20have%20at%20least%20one%20real%20user%20for%20the%20lib%20before%20pinging%20the%20%0A%3E%20other%20related%20packages.%20I%20should%20probably%20have%20been%20more%20aggressive%20on%20%0A%3E%20this%20front%2C%20my%20bad.%0A%3E%20%0A%3E%20Regards.%0A%3E%20%0A%3E%20--%20%0A%3E%20Marc%20Dequ%C3%A8nes%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=duck%40duckcorp.org" alt="">
<div class="header"><span class="headerfield">From:</span> Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;,  773041@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 22 Dec 2014 02:52:02 +0100</div>
</div>
<pre class="message flowed">Coin,

On 2014-12-21 22:16, Sebastian Andrzej Siewior wrote:
&gt; On 2014-12-20 12:12:13 [+0100], Andreas Cadhalpun wrote:
&gt;&gt; As it shows that clamd hangs in libmspack, I think this is bug #773041 
&gt;&gt; [1].
&gt;&gt; A possible fix is mentioned in [2].

I can upload this simple fix quickly, nevertheless i did not have time 
to proofread it. Any comment?

&gt; Is the security team aware of the various in-tree copy of this library?
&gt; #675555 tries / tried to track them.

Joss filled #675560 tagged security.

I tested the cabextract build using the library but had no reply. I 
wanted to have at least one real user for the lib before pinging the 
other related packages. I should probably have been more aggressive on 
this front, my bad.

Regards.

-- 
Marc Dequènes


</pre>

<div class="infmessage"><hr><p>
<a name="43"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419252305 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Mon, 22 Dec 2014 12:45:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=44">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="45"></a>
<!-- request_addr: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt; -->
<!-- time:1419252305 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Mon, 22 Dec 2014 12:45:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=46">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=46">mbox</a>, <a href="#45">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="47"></a><a name="msg47"></a><a href="#47">Message #47</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=47">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=47">mbox</a>, <a href="mailto:773041@bugs.debian.org?References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%0A%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%0A%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%0A%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%0A%20%3C20141221211609.GB2382%40breakpoint.cc%3E%0A%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%0A%20%3C20141222123708.GA12886%40kibibi%3E&amp;body=On%20Mon%2C%2022%20Dec%202014%2013%3A37%3A09%20%2B0100%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%20wrote%3A%0A%3E%20%2A%20Marc%20Dequ%C3%A8nes%20%28duck%29%20%7C%202014-12-22%2002%3A52%3A02%20%5B%2B0100%5D%3A%0A%3E%20%0A%3E%20%3ECoin%2C%0A%3E%20%3E%0A%3E%20%3EOn%202014-12-21%2022%3A16%2C%20Sebastian%20Andrzej%20Siewior%20wrote%3A%0A%3E%20%3E%3EOn%202014-12-20%2012%3A12%3A13%20%5B%2B0100%5D%2C%20Andreas%20Cadhalpun%20wrote%3A%0A%3E%20%3E%3E%3EAs%20it%20shows%20that%20clamd%20hangs%20in%20libmspack%2C%20I%20think%20this%20is%20bug%20%23773041%0A%3E%20%3E%3E%3E%5B1%5D.%0A%3E%20%3E%3E%3EA%20possible%20fix%20is%20mentioned%20in%20%5B2%5D.%0A%3E%20%3E%0A%3E%20%3EI%20can%20upload%20this%20simple%20fix%20quickly%2C%20nevertheless%20i%20did%20not%20have%20time%20to%0A%3E%20%3Eproofread%20it.%20Any%20comment%3F%0A%3E%20%0A%3E%20It%20would%20be%20nice%20if%20we%20could%20keep%20this%20in%20sync.%20I%20will%20look%20at%20this%20in%0A%3E%20tonight%20at%20the%20latest%20and%20give%20more%20feedback.%0A%3E%20%0A%3E%20%3E%3EIs%20the%20security%20team%20aware%20of%20the%20various%20in-tree%20copy%20of%20this%20library%3F%0A%3E%20%3E%3E%23675555%20tries%20%2F%20tried%20to%20track%20them.%0A%3E%20%3E%0A%3E%20%3EJoss%20filled%20%23675560%20tagged%20security.%0A%3E%20%0A%3E%20Yes.%20Atleast%20clamav%20can%20be%20triggered%20via%20remote.%20Not%20sure%20about%20the%0A%3E%20others.%0A%3E%20%0A%3E%20%3ERegards.%0A%3E%20%0A%3E%20Sebastian%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C20141222123708.GA12886%40kibibi%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sebastian%40breakpoint.cc" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</div>
<div class="header"><span class="headerfield">To:</span> Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773041@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 22 Dec 2014 13:37:09 +0100</div>
</div>
<pre class="message">* Marc Dequènes (duck) | 2014-12-22 02:52:02 [+0100]:

&gt;Coin,
&gt;
&gt;On 2014-12-21 22:16, Sebastian Andrzej Siewior wrote:
&gt;&gt;On 2014-12-20 12:12:13 [+0100], Andreas Cadhalpun wrote:
&gt;&gt;&gt;As it shows that clamd hangs in libmspack, I think this is bug #773041
&gt;&gt;&gt;[1].
&gt;&gt;&gt;A possible fix is mentioned in [2].
&gt;
&gt;I can upload this simple fix quickly, nevertheless i did not have time to
&gt;proofread it. Any comment?

It would be nice if we could keep this in sync. I will look at this in
tonight at the latest and give more feedback.

&gt;&gt;Is the security team aware of the various in-tree copy of this library?
&gt;&gt;#675555 tries / tried to track them.
&gt;
&gt;Joss filled #675560 tagged security.

Yes. Atleast clamav can be triggered via remote. Not sure about the
others.

&gt;Regards.

Sebastian


</pre>

<div class="infmessage"><hr><p>
<a name="48"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419285440 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Mon, 22 Dec 2014 21:57:20 GMT) (<a href="bugreport.cgi?bug=773041;msg=49">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=49">mbox</a>, <a href="#48">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="50"></a>
<!-- request_addr: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt; -->
<!-- time:1419285441 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Mon, 22 Dec 2014 21:57:21 GMT) (<a href="bugreport.cgi?bug=773041;msg=51">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=51">mbox</a>, <a href="#50">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="52"></a><a name="msg52"></a><a href="#52">Message #52</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=52">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=52">mbox</a>, <a href="mailto:773041@bugs.debian.org?References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%0A%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%0A%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%0A%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%0A%20%3C20141221211609.GB2382%40breakpoint.cc%3E%0A%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%0A%20%3C20141222215203.GA3530%40breakpoint.cc%3E&amp;body=On%20Mon%2C%2022%20Dec%202014%2022%3A52%3A03%20%2B0100%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%20wrote%3A%0A%3E%20On%202014-12-22%2002%3A52%3A02%20%5B%2B0100%5D%2C%20Marc%20Dequ%C3%A8nes%20%28duck%29%20wrote%3A%0A%3E%20%3E%20I%20can%20upload%20this%20simple%20fix%20quickly%2C%20nevertheless%20i%20did%20not%20have%20time%20to%0A%3E%20%3E%20proofread%20it.%20Any%20comment%3F%0A%3E%20%0A%3E%20I%20plan%20to%20add%20the%20following%20patch%20to%20clamav.%20I%20added%20a%20small%20comment%0A%3E%20why%20we%20have%20the%20busy%20loop%20there.%20So%20far%20it%20looks%20like%20a%20good%20idea.%20The%0A%3E%20only%20problem%20is%20that%20we%20need%20off_t%20beeing%2064bit%20%28LFS%29%20or%20it%20won%27t%20work%0A%3E%20on%2032bit.%20No%20problem%20on%20Debian%20side%E2%80%A6%0A%3E%20%0A%3E%20I%20added%20upstream%20on%20CC%20hoping%20that%20they%20will%20take%20this%20or%20do%20something%0A%3E%20about%20it%20%3A%29%0A%3E%20%0A%3E%20If%20nobody%20objects%2C%20I%20push%20this%20tomorrow%20into%20the%20clamav%20repo.%0A%3E%20%0A%3E%20From%209041fefc0d48aa3c307baa20c5cc4b7eceafe616%20Mon%20Sep%2017%2000%3A00%3A00%202001%0A%3E%20From%3A%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%0A%3E%20Date%3A%20Mon%2C%2022%20Dec%202014%2022%3A10%3A47%20%2B0100%0A%3E%20Subject%3A%20%5BPATCH%5D%20make%20frame_end%20off_t%0A%3E%20%0A%3E%20Debian%20bts%20%23773041%2C%20%23772891%20contains%20a%20report%20of%20a%20.cab%20file%20which%0A%3E%20causes%20an%20endless%20loop.%0A%3E%20Eric%20Sharkey%20diagnosed%20the%20problem%20as%20frame_end%20is%2032bit%20and%20overflows%0A%3E%20and%20the%20result%20the%20loop%20makes%20no%20progress.%20He%20also%20added%20that%20making%0A%3E%20it%20off_t%20%28and%20so%2064bit%20with%20LFS%29%20fixes%20the%20problem.%0A%3E%20%0A%3E%20The%20problem%20seems%20that%20after%20the%20overflow%2C%20window_posn%20is%20larger%20than%0A%3E%20frame_end%20and%20therefore%20we%20never%20enter%20the%20loop%20to%20make%20progress.%20But%20we%0A%3E%20still%20have%20out_bytes%20%3E0%20so%20we%20don%27t%20leave%20the%20outer%20loop%20either.%0A%3E%20%0A%3E%20This%20patch%20is%20based%20on%20Eric%20Sharkey%20comments.%0A%3E%20%0A%3E%20Signed-off-by%3A%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%0A%3E%20---%0A%3E%20%20mspack%2Fqtmd.c%20%7C%203%20%2B%2B-%0A%3E%20%201%20file%20changed%2C%202%20insertions%28%2B%29%2C%201%20deletion%28-%29%0A%3E%20%0A%3E%20diff%20--git%20a%2Fmspack%2Fqtmd.c%20b%2Fmspack%2Fqtmd.c%0A%3E%20index%2012b27f5608c4..6e1640579119%20100644%0A%3E%20---%20a%2Fmspack%2Fqtmd.c%0A%3E%20%2B%2B%2B%20b%2Fmspack%2Fqtmd.c%0A%3E%20%40%40%20-253%2C7%20%2B253%2C8%20%40%40%20struct%20qtmd_stream%20%2Aqtmd_init%28struct%20mspack_system%20%2Asystem%2C%0A%3E%20%20%7D%0A%3E%20%20%0A%3E%20%20int%20qtmd_decompress%28struct%20qtmd_stream%20%2Aqtm%2C%20off_t%20out_bytes%29%20%7B%0A%3E%20-%20%20unsigned%20int%20frame_todo%2C%20frame_end%2C%20window_posn%2C%20match_offset%2C%20range%3B%0A%3E%20%2B%20%20unsigned%20int%20frame_todo%2C%20window_posn%2C%20match_offset%2C%20range%3B%0A%3E%20%2B%20%20off_t%20frame_end%3B%0A%3E%20%20%20%20unsigned%20char%20%2Awindow%2C%20%2Ai_ptr%2C%20%2Ai_end%2C%20%2Arunsrc%2C%20%2Arundest%3B%0A%3E%20%20%20%20int%20i%2C%20j%2C%20selector%2C%20extra%2C%20sym%2C%20match_length%3B%0A%3E%20%20%20%20unsigned%20short%20H%2C%20L%2C%20C%2C%20symf%3B%0A%3E%20--%20%0A%3E%202.1.3%0A%3E%20%0A%3E%20Sebastian%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C20141222215203.GA3530%40breakpoint.cc%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sebastian%40breakpoint.cc" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</div>
<div class="header"><span class="headerfield">To:</span> Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773041@bugs.debian.org, 773318@bugs.debian.org, kyzer@4u.net</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 22 Dec 2014 22:52:03 +0100</div>
</div>
<pre class="message">On 2014-12-22 02:52:02 [+0100], Marc Dequènes (duck) wrote:
&gt; I can upload this simple fix quickly, nevertheless i did not have time to
&gt; proofread it. Any comment?

I plan to add the following patch to clamav. I added a small comment
why we have the busy loop there. So far it looks like a good idea. The
only problem is that we need off_t beeing 64bit (LFS) or it won&#39;t work
on 32bit. No problem on Debian side…

I added upstream on CC hoping that they will take this or do something
about it :)

If nobody objects, I push this tomorrow into the clamav repo.

From 9041fefc0d48aa3c307baa20c5cc4b7eceafe616 Mon Sep 17 00:00:00 2001
From: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;
Date: Mon, 22 Dec 2014 22:10:47 +0100
Subject: [PATCH] make frame_end off_t

Debian bts #773041, #772891 contains a report of a .cab file which
causes an endless loop.
Eric Sharkey diagnosed the problem as frame_end is 32bit and overflows
and the result the loop makes no progress. He also added that making
it off_t (and so 64bit with LFS) fixes the problem.

The problem seems that after the overflow, window_posn is larger than
frame_end and therefore we never enter the loop to make progress. But we
still have out_bytes &gt;0 so we don&#39;t leave the outer loop either.

This patch is based on Eric Sharkey comments.

Signed-off-by: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;
---
 mspack/qtmd.c | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/mspack/qtmd.c b/mspack/qtmd.c
index 12b27f5608c4..6e1640579119 100644
--- a/mspack/qtmd.c
+++ b/mspack/qtmd.c
@@ -253,7 +253,8 @@ struct qtmd_stream *qtmd_init(struct mspack_system *system,
 }
 
 int qtmd_decompress(struct qtmd_stream *qtm, off_t out_bytes) {
-  unsigned int frame_todo, frame_end, window_posn, match_offset, range;
+  unsigned int frame_todo, window_posn, match_offset, range;
+  off_t frame_end;
   unsigned char *window, *i_ptr, *i_end, *runsrc, *rundest;
   int i, j, selector, extra, sym, match_length;
   unsigned short H, L, C, symf;
-- 
2.1.3

Sebastian


</pre>

<div class="infmessage"><hr><p>
<a name="53"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419355085 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Tue, 23 Dec 2014 17:18:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=54">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=54">mbox</a>, <a href="#53">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="55"></a>
<!-- request_addr: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt; -->
<!-- time:1419355085 -->
<strong>Acknowledgement sent</strong>
to <code>Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Tue, 23 Dec 2014 17:18:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=56">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=56">mbox</a>, <a href="#55">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="57"></a><a name="msg57"></a><a href="#57">Message #57</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=57">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=57">mbox</a>, <a href="mailto:773041@bugs.debian.org?subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C5499A341.50203%40googlemail.com%3E&amp;body=On%20Tue%2C%2023%20Dec%202014%2018%3A15%3A45%20%2B0100%20Andreas%20Cadhalpun%20%3Candreas.cadhalpun%40googlemail.com%3E%20wrote%3A%0A%3E%20Hi%2C%0A%3E%20%0A%3E%20On%2022.12.2014%2022%3A52%2C%20Sebastian%20Andrzej%20Siewior%20wrote%3A%0A%3E%20%3E%20On%202014-12-22%2002%3A52%3A02%20%5B%2B0100%5D%2C%20Marc%20Dequ%C3%A8nes%20%28duck%29%20wrote%3A%0A%3E%20%3E%3E%20I%20can%20upload%20this%20simple%20fix%20quickly%2C%20nevertheless%20i%20did%20not%20have%20time%20to%0A%3E%20%3E%3E%20proofread%20it.%20Any%20comment%3F%0A%3E%20%3E%0A%3E%20%3E%20I%20plan%20to%20add%20the%20following%20patch%20to%20clamav.%20I%20added%20a%20small%20comment%0A%3E%20%3E%20why%20we%20have%20the%20busy%20loop%20there.%20So%20far%20it%20looks%20like%20a%20good%20idea.%20The%0A%3E%20%3E%20only%20problem%20is%20that%20we%20need%20off_t%20beeing%2064bit%20%28LFS%29%20or%20it%20won%27t%20work%0A%3E%20%3E%20on%2032bit.%20No%20problem%20on%20Debian%20side%E2%80%A6%0A%3E%20%0A%3E%20I%20think%20there%20is%20a%20better%20way%20than%20changing%20the%20type%20of%20frame_end%20to%20off_t.%0A%3E%20It%20is%20possible%20to%20avoid%20the%20overflow%20by%20reordering%20the%20code%3A%0A%3E%20%0A%3E%20---%20libmspack-0.4.orig%2Fmspack%2Fqtmd.c%0A%3E%20%2B%2B%2B%20libmspack-0.4%2Fmspack%2Fqtmd.c%0A%3E%20%40%40%20-296%2C10%20%2B296%2C12%20%40%40%20int%20qtmd_decompress%28struct%20qtmd_stream%20%2A%0A%3E%20%0A%3E%20%20%20%20%20%20%20%2F%2A%20decode%20more%2C%20up%20to%20the%20number%20of%20bytes%20needed%2C%20the%20frame%20boundary%2C%0A%3E%20%20%20%20%20%20%20%20%2A%20or%20the%20window%20boundary%2C%20whichever%20comes%20first%20%2A%2F%0A%3E%20-%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20%28out_bytes%20-%20%28qtm-%3Eo_end%20-%20qtm-%3Eo_ptr%29%29%3B%0A%3E%20-%20%20%20%20if%20%28%28window_posn%20%2B%20frame_todo%29%20%3C%20frame_end%29%20%7B%0A%3E%20%2B%20%20%20%20if%20%28frame_todo%20%3C%20%28out_bytes%20-%20%28qtm-%3Eo_end%20-%20qtm-%3Eo_ptr%29%29%29%20%7B%0A%3E%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20frame_todo%3B%0A%3E%20%20%20%20%20%20%20%7D%0A%3E%20%2B%20%20%20%20else%20%7B%0A%3E%20%2B%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20%28out_bytes%20-%20%28qtm-%3Eo_end%20-%20qtm-%3Eo_ptr%29%29%3B%0A%3E%20%2B%20%20%20%20%7D%0A%3E%20%20%20%20%20%20%20if%20%28frame_end%20%3E%20qtm-%3Ewindow_size%29%20%7B%0A%3E%20%20%20%20%20%20%20%20%20frame_end%20%3D%20qtm-%3Ewindow_size%3B%0A%3E%20%20%20%20%20%20%20%7D%0A%3E%20%0A%3E%20This%20works%2C%20because%20frame_todo%20is%20at%20most%20QTM_FRAME_SIZE%20%3D%2032768.%0A%3E%20%0A%3E%20Merry%20Christmas%2C%0A%3E%20Andreas%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%20%3C54909C46.1010109%40googlemail.com%3E%20%3C5490A05E.5070700%40googlemail.com%3E%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%20%3C5495598D.6020706%40googlemail.com%3E%20%3C20141221211609.GB2382%40breakpoint.cc%3E%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%20%3C20141222215203.GA3530%40breakpoint.cc%3E%0A%20%3C5499A341.50203%40googlemail.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=andreas.cadhalpun%40googlemail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;,
 773041@bugs.debian.org, Marc Dequènes (duck)
 &lt;duck@duckcorp.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773318@bugs.debian.org, kyzer@4u.net</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 23 Dec 2014 18:15:45 +0100</div>
</div>
<pre class="message flowed">Hi,

On 22.12.2014 22:52, Sebastian Andrzej Siewior wrote:
&gt; On 2014-12-22 02:52:02 [+0100], Marc Dequènes (duck) wrote:
&gt;&gt; I can upload this simple fix quickly, nevertheless i did not have time to
&gt;&gt; proofread it. Any comment?
&gt;
&gt; I plan to add the following patch to clamav. I added a small comment
&gt; why we have the busy loop there. So far it looks like a good idea. The
&gt; only problem is that we need off_t beeing 64bit (LFS) or it won&#39;t work
&gt; on 32bit. No problem on Debian side…

I think there is a better way than changing the type of frame_end to off_t.
It is possible to avoid the overflow by reordering the code:

--- libmspack-0.4.orig/mspack/qtmd.c
+++ libmspack-0.4/mspack/qtmd.c
@@ -296,10 +296,12 @@ int qtmd_decompress(struct qtmd_stream *

     /* decode more, up to the number of bytes needed, the frame boundary,
      * or the window boundary, whichever comes first */
-    frame_end = window_posn + (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr));
-    if ((window_posn + frame_todo) &lt; frame_end) {
+    if (frame_todo &lt; (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr))) {
       frame_end = window_posn + frame_todo;
     }
+    else {
+      frame_end = window_posn + (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr));
+    }
     if (frame_end &gt; qtm-&gt;window_size) {
       frame_end = qtm-&gt;window_size;
     }

This works, because frame_todo is at most QTM_FRAME_SIZE = 32768.

Merry Christmas,
Andreas



</pre>

<div class="infmessage"><hr><p>
<a name="58"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419367689 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Tue, 23 Dec 2014 20:48:09 GMT) (<a href="bugreport.cgi?bug=773041;msg=59">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=59">mbox</a>, <a href="#58">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="60"></a>
<!-- request_addr: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt; -->
<!-- time:1419367689 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Tue, 23 Dec 2014 20:48:09 GMT) (<a href="bugreport.cgi?bug=773041;msg=61">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=61">mbox</a>, <a href="#60">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="62"></a><a name="msg62"></a><a href="#62">Message #62</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=62">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=62">mbox</a>, <a href="mailto:773041@bugs.debian.org?subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C20141223204404.GA6913%40breakpoint.cc%3E&amp;body=On%20Tue%2C%2023%20Dec%202014%2021%3A44%3A04%20%2B0100%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%20wrote%3A%0A%3E%20tags%20773318%20-%20moreinfo%20%2B%20patch%0A%3E%20thanks%0A%3E%20%0A%3E%20On%202014-12-23%2018%3A15%3A45%20%5B%2B0100%5D%2C%20Andreas%20Cadhalpun%20wrote%3A%0A%3E%20%3E%20Hi%2C%0A%3E%20Hi%20Andreas%2C%0A%3E%20%0A%3E%20%3E%20I%20think%20there%20is%20a%20better%20way%20than%20changing%20the%20type%20of%20frame_end%20to%20off_t.%0A%3E%20%3E%20It%20is%20possible%20to%20avoid%20the%20overflow%20by%20reordering%20the%20code%3A%0A%3E%20%0A%3E%20Even%20better%2C%20I%20like%20it.%20The%20patch%20at%20the%20end%20of%20the%20email%20is%20what%20I%0A%3E%20pushed%20into%20the%20wheezy%20branch%20for%20clamav%20%5B0%5D.%20So%20after%20an%20upload%20for%0A%3E%20stable%2C%20we%20have%20Wheezy%20fixed.%20I%20have%20no%20idea%20how%20to%20close%20this%20bug%20for%0A%3E%20unstable%20since%20it%20has%20to%20be%20fixed%20in%20a%20different%20package.%20Probably%0A%3E%20manually%20with%20a%20comment%E2%80%A6%0A%3E%20Side%20question%3A%20In%20case%20someone%20has%20unattended-upgrades%20running%2C%20how%20does%0A%3E%20he%20get%20clamd%20restarted%20after%20a%20libmspack%20update%3F%0A%3E%20%0A%3E%20From%20a0449d2079c4ba5822e6567ad7094c10108f16cd%20Mon%20Sep%2017%2000%3A00%3A00%202001%0A%3E%20From%3A%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%0A%3E%20Date%3A%20Tue%2C%2023%20Dec%202014%2021%3A20%3A43%20%2B0100%0A%3E%20Subject%3A%20libmspack%3A%20qtmd%3A%20fix%20frame_end%20overflow%0A%3E%20%0A%3E%20Debian%20bts%20%23773041%2C%20%23772891%20contains%20a%20report%20of%20a%20.cab%20file%20which%0A%3E%20causes%20an%20endless%20loop.%0A%3E%20Eric%20Sharkey%20diagnosed%20the%20problem%20as%20frame_end%20is%2032bit%20and%20overflows%0A%3E%20and%20the%20result%20the%20loop%20makes%20no%20progress.%0A%3E%20The%20problem%20seems%20that%20after%20the%20overflow%2C%20window_posn%20is%20larger%20than%0A%3E%20frame_end%20and%20therefore%20we%20never%20enter%20the%20loop%20to%20make%20progress.%20But%20we%0A%3E%20still%20have%20out_bytes%20%3E0%20so%20we%20don%27t%20leave%20the%20outer%20loop%20either.%0A%3E%20%0A%3E%20Andreas%20Cadhalpun%20suggested%20to%20instead%20makeing%20frame_end%2064bit%2C%20we%20could%0A%3E%20avoid%20the%20overflow%20by%20reordering%20the%20code%20the%20following%20way%3A%0A%3E%20%0A%3E%20original%2C%20with%20just%20out_bytes%20%28without%20%28qtm-%3Eo_end%20-%20qtm-%3Eo_ptr%29%29%0A%3E%20%7C%20frame_end%20%3D%20window_posn%20%2B%20out_bytes%3B%0A%3E%20%7C%20if%20%28%28window_posn%20%2B%20frame_todo%29%20%3C%20frame_end%29%20%7B%0A%3E%20%7C%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20frame_todo%3B%0A%3E%20%7C%20%7D%0A%3E%20%0A%3E%20replace%20frame_end%20in%20%22if%22%20with%20its%20content%20%28and%20move%20the%20first%20frame_end%0A%3E%20into%20the%20else%20path%29%0A%3E%20%7C%20if%20%28%28window_posn%20%2B%20frame_todo%29%20%3C%20%28window_posn%20%2B%20out_bytes%29%29%0A%3E%20%7C%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20frame_todo%3B%0A%3E%20%7C%20else%0A%3E%20%7C%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20out_bytes%3B%0A%3E%20%0A%3E%20remove%20window_posn%20from%20%22if%22%20since%20it%20is%20the%20same%20both%20times.%0A%3E%20%7C%20if%20%28frame_todo%20%3C%20%20out_bytes%29%0A%3E%20%7C%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20frame_todo%3B%0A%3E%20%7C%20else%0A%3E%20%7C%20%20%20%20%20%20%20%20%20frame_end%20%3D%20window_posn%20%2B%20out_bytes%3B%0A%3E%20%0A%3E%20Andreas%20added%3A%0A%3E%20%7CThis%20works%2C%20because%20frame_todo%20is%20at%20most%20QTM_FRAME_SIZE%20%3D%2032768.%0A%3E%20%0A%3E%20Suggested-as-patch%3A%20Andreas%20Cadhalpun%20%3Candreas.cadhalpun%40googlemail.com%3E%0A%3E%20%5Bsebastian%40breakpoint%3A%20added%20patch%20description%5D%0A%3E%20Signed-off-by%3A%20Sebastian%20Andrzej%20Siewior%20%3Csebastian%40breakpoint.cc%3E%0A%3E%20---%0A&amp;References=%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%0A%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%0A%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%0A%20%3C20141221211609.GB2382%40breakpoint.cc%3E%0A%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%0A%20%3C20141222215203.GA3530%40breakpoint.cc%3E%0A%20%3C5499A341.50203%40googlemail.com%3E%0A%20%3C20141223204404.GA6913%40breakpoint.cc%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sebastian%40breakpoint.cc" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</div>
<div class="header"><span class="headerfield">To:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773041@bugs.debian.org,
	Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;,
	773318@bugs.debian.org, kyzer@4u.net</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 23 Dec 2014 21:44:04 +0100</div>
</div>
<pre class="message">tags 773318 - moreinfo + patch
thanks

On 2014-12-23 18:15:45 [+0100], Andreas Cadhalpun wrote:
&gt; Hi,
Hi Andreas,

&gt; I think there is a better way than changing the type of frame_end to off_t.
&gt; It is possible to avoid the overflow by reordering the code:

Even better, I like it. The patch at the end of the email is what I
pushed into the wheezy branch for clamav [0]. So after an upload for
stable, we have Wheezy fixed. I have no idea how to close this bug for
unstable since it has to be fixed in a different package. Probably
manually with a comment…
Side question: In case someone has unattended-upgrades running, how does
he get clamd restarted after a libmspack update?

From a0449d2079c4ba5822e6567ad7094c10108f16cd Mon Sep 17 00:00:00 2001
From: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;
Date: Tue, 23 Dec 2014 21:20:43 +0100
Subject: libmspack: qtmd: fix frame_end overflow

Debian bts #773041, #772891 contains a report of a .cab file which
causes an endless loop.
Eric Sharkey diagnosed the problem as frame_end is 32bit and overflows
and the result the loop makes no progress.
The problem seems that after the overflow, window_posn is larger than
frame_end and therefore we never enter the loop to make progress. But we
still have out_bytes &gt;0 so we don&#39;t leave the outer loop either.

Andreas Cadhalpun suggested to instead makeing frame_end 64bit, we could
avoid the overflow by reordering the code the following way:

original, with just out_bytes (without (qtm-&gt;o_end - qtm-&gt;o_ptr))
| frame_end = window_posn + out_bytes;
| if ((window_posn + frame_todo) &lt; frame_end) {
|         frame_end = window_posn + frame_todo;
| }

replace frame_end in &quot;if&quot; with its content (and move the first frame_end
into the else path)
| if ((window_posn + frame_todo) &lt; (window_posn + out_bytes))
|         frame_end = window_posn + frame_todo;
| else
|         frame_end = window_posn + out_bytes;

remove window_posn from &quot;if&quot; since it is the same both times.
| if (frame_todo &lt;  out_bytes)
|         frame_end = window_posn + frame_todo;
| else
|         frame_end = window_posn + out_bytes;

Andreas added:
|This works, because frame_todo is at most QTM_FRAME_SIZE = 32768.

Suggested-as-patch: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;
[sebastian@breakpoint: added patch description]
Signed-off-by: Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;
---
 libclamav/libmspack-0.4alpha/mspack/qtmd.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/libclamav/libmspack-0.4alpha/mspack/qtmd.c b/libclamav/libmspack-0.4alpha/mspack/qtmd.c
index 12b27f5608c4..e584aef8e576 100644
--- a/libclamav/libmspack-0.4alpha/mspack/qtmd.c
+++ b/libclamav/libmspack-0.4alpha/mspack/qtmd.c
@@ -296,9 +296,10 @@ int qtmd_decompress(struct qtmd_stream *qtm, off_t out_bytes) {
 
     /* decode more, up to the number of bytes needed, the frame boundary,
      * or the window boundary, whichever comes first */
-    frame_end = window_posn + (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr));
-    if ((window_posn + frame_todo) &lt; frame_end) {
+    if (frame_todo &lt; (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr))) {
       frame_end = window_posn + frame_todo;
+    } else {
+      frame_end = window_posn + (out_bytes - (qtm-&gt;o_end - qtm-&gt;o_ptr));
     }
     if (frame_end &gt; qtm-&gt;window_size) {
       frame_end = qtm-&gt;window_size;


[0] <a href="https://anonscm.debian.org/cgit/pkg-clamav/clamav.git/tree/debian/patches/0018-libmspack-qtmd-fix-frame_end-overflow.patch?h=wheezy">https://anonscm.debian.org/cgit/pkg-clamav/clamav.git/tree/debian/patches/0018-libmspack-qtmd-fix-frame_end-overflow.patch?h=wheezy</a>

Sebastian


</pre>

<div class="infmessage"><hr><p>
<a name="63"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419374709 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Tue, 23 Dec 2014 22:45:09 GMT) (<a href="bugreport.cgi?bug=773041;msg=64">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=64">mbox</a>, <a href="#63">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="65"></a>
<!-- request_addr: Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt; -->
<!-- time:1419374709 -->
<strong>Acknowledgement sent</strong>
to <code>Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Tue, 23 Dec 2014 22:45:09 GMT) (<a href="bugreport.cgi?bug=773041;msg=66">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=66">mbox</a>, <a href="#65">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="67"></a><a name="msg67"></a><a href="#67">Message #67</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=67">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=67">mbox</a>, <a href="mailto:773041@bugs.debian.org?subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs&amp;In-Reply-To=%3C5499EFB1.6010507%40googlemail.com%3E&amp;References=%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%20%3C54909C46.1010109%40googlemail.com%3E%20%3C5490A05E.5070700%40googlemail.com%3E%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%20%3C5495598D.6020706%40googlemail.com%3E%20%3C20141221211609.GB2382%40breakpoint.cc%3E%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%20%3C20141222215203.GA3530%40breakpoint.cc%3E%20%3C5499A341.50203%40googlemail.com%3E%20%3C20141223204404.GA6913%40breakpoint.cc%3E%0A%20%3C5499EFB1.6010507%40googlemail.com%3E&amp;body=On%20Tue%2C%2023%20Dec%202014%2023%3A41%3A53%20%2B0100%20Andreas%20Cadhalpun%20%3Candreas.cadhalpun%40googlemail.com%3E%20wrote%3A%0A%3E%20Control%3A%20found%20773318%200.98.5%2Bdfsg-0%2Bdeb7u1%0A%3E%20Control%3A%20notfound%20773318%200.98.5%2Bdfsg-3%0A%3E%20%23%200.98.5%2Bdfsg-3%20uses%20the%20system%20libmspack%0A%3E%20%23%20see%20bug%20%23773041%20for%20progress%20there%0A%3E%20%0A%3E%20Hi%20Sebastian%2C%0A%3E%20%0A%3E%20On%2023.12.2014%2021%3A44%2C%20Sebastian%20Andrzej%20Siewior%20wrote%3A%0A%3E%20%3E%20Even%20better%2C%20I%20like%20it.%20The%20patch%20at%20the%20end%20of%20the%20email%20is%20what%20I%0A%3E%20%3E%20pushed%20into%20the%20wheezy%20branch%20for%20clamav%20%5B0%5D.%20So%20after%20an%20upload%20for%0A%3E%20%3E%20stable%2C%20we%20have%20Wheezy%20fixed.%0A%3E%20%0A%3E%20Yes%2C%20thanks.%0A%3E%20%0A%3E%20%3E%20I%20have%20no%20idea%20how%20to%20close%20this%20bug%20for%0A%3E%20%3E%20unstable%20since%20it%20has%20to%20be%20fixed%20in%20a%20different%20package.%20Probably%0A%3E%20%3E%20manually%20with%20a%20comment%E2%80%A6%0A%3E%20%0A%3E%20I%27m%20marking%20the%20unstable%20version%20as%20not%20affected%2C%20because%20we%20have%20%23773041%0A%3E%20to%20track%20the%20progress%20for%20libmspack.%20So%20the%20upload%20of%20the%20fixed%20wheezy%0A%3E%20version%20will%20close%20this%20bug.%0A%3E%20%0A%3E%20%3E%20Side%20question%3A%20In%20case%20someone%20has%20unattended-upgrades%20running%2C%20how%20does%0A%3E%20%3E%20he%20get%20clamd%20restarted%20after%20a%20libmspack%20update%3F%0A%3E%20%0A%3E%20I%20think%20needrestart%20can%20do%20that.%0A%3E%20%0A%3E%20Best%20regards%2C%0A%3E%20Andreas%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=andreas.cadhalpun%40googlemail.com" alt="">
<div class="header"><span class="headerfield">From:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Sebastian Andrzej Siewior &lt;sebastian@breakpoint.cc&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 773041@bugs.debian.org, Marc Dequènes (duck)
 &lt;duck@duckcorp.org&gt;, 773318@bugs.debian.org, kyzer@4u.net</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 23 Dec 2014 23:41:53 +0100</div>
</div>
<pre class="message flowed">Control: found 773318 0.98.5+dfsg-0+deb7u1
Control: notfound 773318 0.98.5+dfsg-3
# 0.98.5+dfsg-3 uses the system libmspack
# see bug #773041 for progress there

Hi Sebastian,

On 23.12.2014 21:44, Sebastian Andrzej Siewior wrote:
&gt; Even better, I like it. The patch at the end of the email is what I
&gt; pushed into the wheezy branch for clamav [0]. So after an upload for
&gt; stable, we have Wheezy fixed.

Yes, thanks.

&gt; I have no idea how to close this bug for
&gt; unstable since it has to be fixed in a different package. Probably
&gt; manually with a comment…

I&#39;m marking the unstable version as not affected, because we have #773041
to track the progress for libmspack. So the upload of the fixed wheezy
version will close this bug.

&gt; Side question: In case someone has unattended-upgrades running, how does
&gt; he get clamd restarted after a libmspack update?

I think needrestart can do that.

Best regards,
Andreas


</pre>

<div class="infmessage"><hr><p>
<a name="68"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419955925 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
<code>Bug#773041</code>; Package <code>libmspack0</code>.
 (Tue, 30 Dec 2014 16:12:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=69">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=69">mbox</a>, <a href="#68">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="70"></a>
<!-- request_addr: duck@duckcorp.org -->
<!-- time:1419955925 -->
<strong>Acknowledgement sent</strong>
to <code>duck@duckcorp.org</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>.
 (Tue, 30 Dec 2014 16:12:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=71">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=71">mbox</a>, <a href="#70">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="72"></a><a name="msg72"></a><a href="#72">Message #72</a> received at 773041@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=72">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=72">mbox</a>, <a href="mailto:773041@bugs.debian.org?References=%3Cm3zjaov3ee.fsf%40carbon.jhcloos.org%3E%0A%20%3C585754F2-52B5-4173-ACF9-46DF61C05127%40kitterman.com%3E%0A%20%3Cm3lhm7vdws.fsf%40carbon.jhcloos.org%3E%20%3C54909C46.1010109%40googlemail.com%3E%0A%20%3C5490A05E.5070700%40googlemail.com%3E%20%3Cm34msr1e7o.fsf%40carbon.jhcloos.org%3E%0A%20%3C5495598D.6020706%40googlemail.com%3E%20%3C20141221211609.GB2382%40breakpoint.cc%3E%0A%20%3C9afc59780c32f526ecc22866b3ddf514%40webmail-rc.duckcorp.org%3E%0A%20%3C20141222215203.GA3530%40breakpoint.cc%3E%20%3C5499A341.50203%40googlemail.com%3E%0A%20%3C191b28a9a14f12c7f906a378045d371d%40webmail-rc.duckcorp.org%3E&amp;body=On%20Tue%2C%2030%20Dec%202014%2017%3A08%3A52%20%2B0100%20%3D%3FUTF-8%3FQ%3FMarc_Dequ%3DC3%3DA8nes_%3D28duck%3D29%3F%3D%20%3Cduck%40duckcorp.org%3E%20wrote%3A%0A%3E%20Control%3A%20tag%20773041%20%2B%20pending%0A%3E%20%0A%3E%20Coin%2C%0A%3E%20%0A%3E%20Thanks%20a%20lot%20Andreas.%0A%3E%20%0A%3E%20Have%20a%20pleasant%20end%20of%20year%20time.%0A%3E%20%0A%3E%20--%20%0A%3E%20Marc%20Dequ%C3%A8nes%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C191b28a9a14f12c7f906a378045d371d%40webmail-rc.duckcorp.org%3E&amp;subject=Re%3A%20Bug%23773041%3A%20Bug%23773318%3A%20clamav%20dies%2Fhangs">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=duck%40duckcorp.org" alt="">
<div class="header"><span class="headerfield">From:</span> Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Andreas Cadhalpun &lt;andreas.cadhalpun@googlemail.com&gt;,  773041@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#773041: Bug#773318: clamav dies/hangs</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 30 Dec 2014 17:08:52 +0100</div>
</div>
<pre class="message flowed wrapping">Control: tag 773041 + pending

Coin,

Thanks a lot Andreas.

Have a pleasant end of year time.

-- 
Marc Dequènes


</pre>

<div class="msgreceived"><hr><p>
<a name="73"></a>
<!-- command:tag -->
<!-- requester: Marc Dequènes (duck) &lt;duck@duckcorp.org&gt; -->
<!-- request_addr: 773041-submit@bugs.debian.org -->
<!-- time:1419955925 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security pending&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<strong>Added tag(s) pending.</strong>
Request was from <code>Marc Dequènes (duck) &lt;duck@duckcorp.org&gt;</code>
to <code>773041-submit@bugs.debian.org</code>.
 (Tue, 30 Dec 2014 16:12:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=74">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=74">mbox</a>, <a href="#73">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="75"></a>
<!-- request_addr: Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; -->
<!-- time:1419959165 -->
<strong>Reply sent</strong>
to <code>Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</code>:<br>
You have taken responsibility.
 (Tue, 30 Dec 2014 17:06:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=76">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=76">mbox</a>, <a href="#75">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="77"></a>
<!-- request_addr: Jakub Wilk &lt;jwilk@debian.org&gt; -->
<!-- time:1419959165 -->
<strong>Notification sent</strong>
to <code>Jakub Wilk &lt;jwilk@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
 (Tue, 30 Dec 2014 17:06:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=78">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=78">mbox</a>, <a href="#77">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="79"></a><a name="msg79"></a><a href="#79">Message #79</a> received at 773041-close@bugs.debian.org (<a href="bugreport.cgi?bug=773041;msg=79">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=79">mbox</a>, <a href="mailto:773041@bugs.debian.org?body=On%20Tue%2C%2030%20Dec%202014%2017%3A03%3A39%20%2B0000%20%3D%3Futf-8%3Fb%3FTWFyYyBEZXF1w6huZXMgKER1Y2sp%3F%3D%20%3CDuck%40DuckCorp.org%3E%20wrote%3A%0A%3E%20Source%3A%20libmspack%0A%3E%20Source-Version%3A%200.4-2%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20libmspack%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20773041%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Marc%20Dequ%C3%A8nes%20%28Duck%29%20%3CDuck%40DuckCorp.org%3E%20%28supplier%20of%20updated%20libmspack%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA512%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Tue%2C%2030%20Dec%202014%2017%3A40%3A47%20%2B0100%0A%3E%20Source%3A%20libmspack%0A%3E%20Binary%3A%20libmspack0%20libmspack-dev%20libmspack-dbg%20libmspack-doc%0A%3E%20Architecture%3A%20source%20amd64%20all%0A%3E%20Version%3A%200.4-2%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20medium%0A%3E%20Maintainer%3A%20Marc%20Dequ%C3%A8nes%20%28Duck%29%20%3CDuck%40DuckCorp.org%3E%0A%3E%20Changed-By%3A%20Marc%20Dequ%C3%A8nes%20%28Duck%29%20%3CDuck%40DuckCorp.org%3E%0A%3E%20Description%3A%0A%3E%20%20libmspack-dbg%20-%20library%20for%20Microsoft%20compression%20formats%20%28debugging%20symbols%29%0A%3E%20%20libmspack-dev%20-%20library%20for%20Microsoft%20compression%20formats%20%28development%20files%29%0A%3E%20%20libmspack-doc%20-%20library%20for%20Microsoft%20compression%20formats%20%28documentation%29%0A%3E%20%20libmspack0%20-%20library%20for%20Microsoft%20compression%20formats%20%28shared%20library%29%0A%3E%20Closes%3A%20773041%0A%3E%20Changes%3A%0A%3E%20%20libmspack%20%280.4-2%29%20unstable%3B%20urgency%3Dmedium%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20Added%20patch%20%27qtmd-fix-frame_end-overflow.patch%27%20to%20fix%20an%20overflow%0A%3E%20%20%20%20%20%20causing%20an%20infinite%20loop%20in%20some%20situation%20%28Closes%3A%20%23773041%29.%0A%3E%20Checksums-Sha1%3A%0A%3E%20%20f84986daa0318462b156e739abfa10a83e3c3f35%202064%20libmspack_0.4-2.dsc%0A%3E%20%20fb6cbf08a9fc2fbfd713ba2d048f06d7aeeccceb%203516%20libmspack_0.4-2.debian.tar.xz%0A%3E%20%20a9ea854769dcd26dad3a965daee1cc8d5f42fc20%2045570%20libmspack0_0.4-2_amd64.deb%0A%3E%20%20bebc11d8e2e89c1e87998a913d6ece23d768a946%2063944%20libmspack-dev_0.4-2_amd64.deb%0A%3E%20%20583b9ab31401e42fb336e2d5e085e83fff638192%2082966%20libmspack-dbg_0.4-2_amd64.deb%0A%3E%20%206a6ed210f9125f7a11b2f1a835197a38b2189609%2087766%20libmspack-doc_0.4-2_all.deb%0A%3E%20Checksums-Sha256%3A%0A%3E%20%2045c8f9a2280a0857b1dc2a3b1ed2a1c593eefc25b003dcb1e8ccdd9d5201c008%202064%20libmspack_0.4-2.dsc%0A%3E%20%20cc59f38c4661112139817ddbb177ec966b7ffbb8fa215ccf9fa6531e9b1c6e54%203516%20libmspack_0.4-2.debian.tar.xz%0A%3E%20%20d5bfe0ddfd7eae30bf5dff7b68053f28f8844f1fa204fc6419992e3e6d623091%2045570%20libmspack0_0.4-2_amd64.deb%0A%3E%20%2060bd8c1fcbce7a165fc62313b048b02d1d4c0cda19ec86e713f1f2c429019e6b%2063944%20libmspack-dev_0.4-2_amd64.deb%0A%3E%20%20e5a5a5da15bcedcaf6439732e08941ba9619f72718bd630978d20bee0c901aad%2082966%20libmspack-dbg_0.4-2_amd64.deb%0A%3E%20%20578913a0c8bc6bba3abf7b045f10a73f55449f0219a97a653b5c2f1bc7c298e5%2087766%20libmspack-doc_0.4-2_all.deb%0A&amp;References=%3CE1Y60Cp-0000yl-PP%40franck.debian.org%3E&amp;In-Reply-To=%3CE1Y60Cp-0000yl-PP%40franck.debian.org%3E&amp;subject=Re%3A%20Bug%23773041%3A%20fixed%20in%20libmspack%200.4-2">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=Duck%40DuckCorp.org" alt="">
<div class="header"><span class="headerfield">From:</span> Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 773041-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#773041: fixed in libmspack 0.4-2</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 30 Dec 2014 17:03:39 +0000</div>
</div>
<pre class="message">Source: libmspack
Source-Version: 0.4-2

We believe that the bug you reported is fixed in the latest version of
libmspack, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 773041@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt; (supplier of updated libmspack package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Tue, 30 Dec 2014 17:40:47 +0100
Source: libmspack
Binary: libmspack0 libmspack-dev libmspack-dbg libmspack-doc
Architecture: source amd64 all
Version: 0.4-2
Distribution: unstable
Urgency: medium
Maintainer: Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;
Changed-By: Marc Dequènes (Duck) &lt;Duck@DuckCorp.org&gt;
Description:
 libmspack-dbg - library for Microsoft compression formats (debugging symbols)
 libmspack-dev - library for Microsoft compression formats (development files)
 libmspack-doc - library for Microsoft compression formats (documentation)
 libmspack0 - library for Microsoft compression formats (shared library)
Closes: <a href="bugreport.cgi?bug=773041">773041</a>
Changes:
 libmspack (0.4-2) unstable; urgency=medium
 .
   * Added patch &#39;qtmd-fix-frame_end-overflow.patch&#39; to fix an overflow
     causing an infinite loop in some situation (Closes: #<a href="bugreport.cgi?bug=773041">773041</a>).
Checksums-Sha1:
 f84986daa0318462b156e739abfa10a83e3c3f35 2064 libmspack_0.4-2.dsc
 fb6cbf08a9fc2fbfd713ba2d048f06d7aeeccceb 3516 libmspack_0.4-2.debian.tar.xz
 a9ea854769dcd26dad3a965daee1cc8d5f42fc20 45570 libmspack0_0.4-2_amd64.deb
 bebc11d8e2e89c1e87998a913d6ece23d768a946 63944 libmspack-dev_0.4-2_amd64.deb
 583b9ab31401e42fb336e2d5e085e83fff638192 82966 libmspack-dbg_0.4-2_amd64.deb
 6a6ed210f9125f7a11b2f1a835197a38b2189609 87766 libmspack-doc_0.4-2_all.deb
Checksums-Sha256:
 45c8f9a2280a0857b1dc2a3b1ed2a1c593eefc25b003dcb1e8ccdd9d5201c008 2064 libmspack_0.4-2.dsc
 cc59f38c4661112139817ddbb177ec966b7ffbb8fa215ccf9fa6531e9b1c6e54 3516 libmspack_0.4-2.debian.tar.xz
 d5bfe0ddfd7eae30bf5dff7b68053f28f8844f1fa204fc6419992e3e6d623091 45570 libmspack0_0.4-2_amd64.deb
 60bd8c1fcbce7a165fc62313b048b02d1d4c0cda19ec86e713f1f2c429019e6b 63944 libmspack-dev_0.4-2_amd64.deb
 e5a5a5da15bcedcaf6439732e08941ba9619f72718bd630978d20bee0c901aad 82966 libmspack-dbg_0.4-2_amd64.deb
 578913a0c8bc6bba3abf7b045f10a73f55449f0219a97a653b5c2f1bc7c298e5 87766 libmspack-doc_0.4-2_all.deb
Files:
 2f4d81be6b8025ba24d3318678200fd7 2064 libs optional libmspack_0.4-2.dsc
 40301461d418e010cd6fbbf3d3fd6a55 3516 libs optional libmspack_0.4-2.debian.tar.xz
 a1f869d6e77d53784d9cdcd089c64366 45570 libs optional libmspack0_0.4-2_amd64.deb
 d4258fb2c2747ec3c0edfafe8ff7db11 63944 libdevel optional libmspack-dev_0.4-2_amd64.deb
 6bb0e11c8893f0fc0b1a0f701f9d5b32 82966 debug extra libmspack-dbg_0.4-2_amd64.deb
 fb93a34a6279963a791dcc6e09448ba0 87766 doc optional libmspack-doc_0.4-2_all.deb

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1

iQIcBAEBCgAGBQJUotguAAoJEFXp+fesHEQ/WVgQAKZMKwZpeaGokq9RqOp4rsbr
ADo7kRd/h8eceZRVhWllB3HdBgSOJXSOPfltNloUiNdXMhRRVpQd5/LJT/g9ObGG
wz44AfCm4o311P5hKekv05H69LJSK1GvOIAPJpxVXgdfI4u67HGBPesq19UNdobf
oDbuDxICgkymAB/QqoqFrKBW9aOpwWgqpqugG7l0EUhLx7HeBmcLL9lXA6FWACWb
88XDneCPkeYs/H+LfsYEPVyIyo1sWVP+3ZnJ8SkDzqu2WoLP9dK0fFa69eERiy5n
hT6gIX+jIS4VrEjPXkv9GDdCe8/Nw/p/BR6vf+39liN372hyvo0A0aJa7XXYJDdU
Civ6IdQ02UIAmMjf3/yY7orBYV5+6vR2rorSfg/wzQG22LXkCK/D2DJFrBiJdcvo
p3cB9qz/2rwyz4uCvXAoGCPJZBxYQJBhcqExIgOPIODnnHGmo3lzyc265LI0avly
BZ66rrPPflaP7fc+FOVmZcJvAf4PTvZTT5JX6WXFJMKoPzBzdJ4iLAmR8i4PhKiz
/1hMJNYlp8SMYuYB6f75qdL1Wo01AT4Edc+p8YT5pevVuWNiPoOApAXNKDYwv9vm
ktMmy7G7leEnVY4s9DhEmm/zMZr+jMTvzlmli4IUoAkPd0xXPqoxaWraODQV+WPp
zK0J4mgyKmMNZ0X5JiUi
=aOVn
-----END PGP SIGNATURE-----



</pre>

<div class="msgreceived"><hr><p>
<a name="80"></a>
<!-- command:tag -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1420118107 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security patch&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<strong>Added tag(s) upstream and patch.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 01 Jan 2015 13:15:07 GMT) (<a href="bugreport.cgi?bug=773041;msg=81">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=81">mbox</a>, <a href="#80">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="82"></a>
<!-- command:title -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1420638315 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;libmspack: CVE-2014-9556: frame_end overflow which could cause infinite loop&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;libmspack: hangs on a crafted CAB file&#39;
            };
-->
<strong>Changed Bug title to &#39;libmspack: CVE-2014-9556: frame_end overflow which could cause infinite loop&#39; from &#39;libmspack: hangs on a crafted CAB file&#39;</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Wed, 07 Jan 2015 13:45:15 GMT) (<a href="bugreport.cgi?bug=773041;msg=83">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=83">mbox</a>, <a href="#82">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="84"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1423121225 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Thu, 05 Feb 2015 07:27:05 GMT) (<a href="bugreport.cgi?bug=773041;msg=85">full text</a>, <a href="bugreport.cgi?bug=773041;mbox=yes;msg=85">mbox</a>, <a href="#84">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=773041">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:30:18 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->buxtehude<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
