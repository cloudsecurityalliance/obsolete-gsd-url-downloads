<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>d0307d1711bd74e51b783a49f9160775aa22e659 - chromiumos/third_party/bsdiff - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://chromium.googlesource.com/login/chromiumos/third_party/bsdiff/%2B/d0307d1711bd74e51b783a49f9160775aa22e659">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">chromium</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/">chromiumos</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/third_party/">third_party</a> / <a class="Breadcrumbs-crumb" href="/chromiumos/third_party/bsdiff/">bsdiff</a> / <span class="Breadcrumbs-crumb">d0307d1711bd74e51b783a49f9160775aa22e659</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>d0307d1711bd74e51b783a49f9160775aa22e659</td><td><span>[<a href="/chromiumos/third_party/bsdiff/+log/d0307d1711bd74e51b783a49f9160775aa22e659">log</a>]</span> <span>[<a href="/chromiumos/third_party/bsdiff/+archive/d0307d1711bd74e51b783a49f9160775aa22e659.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Alex Deymo &lt;deymo@chromium.org&gt;</td><td>Mon May 12 20:34:02 2014</td></tr><tr><th class="Metadata-title">committer</th><td>Alex Deymo &lt;deymo@chromium.org&gt;</td><td>Tue Apr 07 23:53:48 2015</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/">9fe5a6034501cffa69e1922f49e405afb9301553</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659%5E">53c95a3549aeba70b2f50095799eff9295c8fe3f</a> <span>[<a href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">bspatch: Add a sanity-check for malformed patches.

This patch adds an extra sanity-check for malformed patches. A
corrupted patch should be cached by update_engine before reaching
this step anyway.

BUG=chromium:372525
TEST=emerge-link bsdiff &amp;&amp; chroot/build/link/usr/bin/bspatch foo bar malformed_patch
bspatch segfaults without the patch and shows the error message with it.

Change-Id: <a href="https://chromium-review.googlesource.com/#/q/I8007b41cf3ab6558a99ffd6085e382f1c32f9bdf">I8007b41cf3ab6558a99ffd6085e382f1c32f9bdf</a>
Reviewed-on: <a href="https://chromium-review.googlesource.com/199377">https://chromium-review.googlesource.com/199377</a>
Tested-by: Alex Deymo &lt;deymo@chromium.org&gt;
Reviewed-by: Jorge Lucangeli Obes &lt;jorgelo@chromium.org&gt;
Commit-Queue: Alex Deymo &lt;deymo@chromium.org&gt;
</pre><ul class="DiffTree"><li><a href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/bspatch.c">bspatch.c</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659%5E%21/#F0">diff</a>]</span></li></ul><div class="DiffSummary">1 file changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: 9fe5a6034501cffa69e1922f49e405afb9301553</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - Makefile"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/Makefile">Makefile</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bsdiff.1"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/bsdiff.1">bsdiff.1</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bsdiff.c"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/bsdiff.c">bsdiff.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bspatch.1"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/bspatch.1">bspatch.1</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bspatch.c"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/bspatch.c">bspatch.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - exfile.c"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/exfile.c">exfile.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - exfile.h"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/exfile.h">exfile.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - extents.c"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/extents.c">extents.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - extents.h"><a class="FileList-itemLink" href="/chromiumos/third_party/bsdiff/+/d0307d1711bd74e51b783a49f9160775aa22e659/extents.h">extents.h</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>