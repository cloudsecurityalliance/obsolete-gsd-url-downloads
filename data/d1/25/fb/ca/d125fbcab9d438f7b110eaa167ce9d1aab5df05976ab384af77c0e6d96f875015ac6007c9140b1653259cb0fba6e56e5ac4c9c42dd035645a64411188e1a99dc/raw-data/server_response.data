<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1608573002: RDH: Block a compromised renderer from reusing request ids -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '83d3be554f39b50b0db9e9a0a2631766';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1608573002%252526ust%25253D1608694201524298%252526usg%25253DAFQjCNEJadAQWYLzNolSPY2gY5cWsc4PnA%26service%3Dah">Sign out</a>

</div>
<div class="counter">(229)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1608573002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1608573002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1608573002</a>:
    RDH: Block a compromised renderer from reusing request ids  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 11 months ago by <a href="/user/gzobqq" onMouseOver="M_showUserInfoPopup(this)">gzobqq</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 10 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/Charlie%20Reis" onMouseOver="M_showUserInfoPopup(this)">Charlie Reis</a></span>, <span class='approval'><a href="/user/Mark%20P" onMouseOver="M_showUserInfoPopup(this)">Mark P</a></span>, <span class='approval'><a href="/user/mmenke" onMouseOver="M_showUserInfoPopup(this)">mmenke</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            loading-reviews_chromium.org, darin-cc_chromium.org, jam, asvitkine+watch_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Block a compromised renderer from reusing request ids.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=578882">578882</a>
Committed: <a href="https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2">https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2</a>
Cr-Commit-Position: refs/heads/master@{#372547}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1608573002/#ps1"
       onclick="M_toggleSectionForPS('1608573002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1608573002/#ps20001"
       onclick="M_toggleSectionForPS('1608573002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Fix resource_loader_unittest.cc
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 1
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1608573002/#ps40001"
       onclick="M_toggleSectionForPS('1608573002', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Check pending_loaders_ and blocked_loaders_map_ instead
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1608573002/#ps60001"
       onclick="M_toggleSectionForPS('1608573002', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Declaration order
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1608573002/#ps80001"
       onclick="M_toggleSectionForPS('1608573002', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Add a test
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 8
      
    </div>
  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1608573002/#ps100001"
       onclick="M_toggleSectionForPS('1608573002', '100001')"
       class="toggled-section ">
      Patch Set 6
      : Address comments
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 12
      
    </div>
  

  <div id="ps-100001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-120001-pointer"
       href="/1608573002/#ps120001"
       onclick="M_toggleSectionForPS('1608573002', '120001')"
       class="toggled-section ">
      Patch Set 7
      : Rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-120001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-140001-pointer"
       href="/1608573002/#ps140001"
       onclick="M_toggleSectionForPS('1608573002', '140001')"
       class="toggled-section ">
      Patch Set 8
      : Address comments
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-140001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-160001-pointer"
       href="/1608573002/#ps160001"
       onclick="M_toggleSectionForPS('1608573002', '160001')"
       class="toggled-section opentriangle">
      Patch Set 9
      : Rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-160001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 10 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1608573002_160001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1608573002/160001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+100 lines, -8 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1608573002/patch/160001/170001">
            content/browser/bad_message.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1608573002/diff/160001/content/browser/bad_message.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1608573002/diff2/1:160001/content/browser/bad_message.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1608573002/diff2/20001:160001/content/browser/bad_message.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1608573002/diff2/40001:160001/content/browser/bad_message.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1608573002/diff2/60001:160001/content/browser/bad_message.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1608573002/diff2/80001:160001/content/browser/bad_message.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1608573002/diff2/100001:160001/content/browser/bad_message.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1608573002/diff2/120001:160001/content/browser/bad_message.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1608573002/diff2/140001:160001/content/browser/bad_message.h"
             title="Delta from patch set 8">8</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1608573002_160001_170001.diff"
             title="Download patch for content/browser/bad_message.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1608573002/patch/160001/170003">
            content/browser/loader/resource_dispatcher_host_impl.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1608573002/diff/160001/content/browser/loader/resource_dispatcher_host_impl.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1608573002/diff2/1:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1608573002/diff2/20001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1608573002/diff2/40001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1608573002/diff2/60001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1608573002/diff2/80001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1608573002/diff2/100001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1608573002/diff2/120001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1608573002/diff2/140001:160001/content/browser/loader/resource_dispatcher_host_impl.h"
             title="Delta from patch set 8">8</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1608573002_160001_170003.diff"
             title="Download patch for content/browser/loader/resource_dispatcher_host_impl.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1608573002/patch/160001/170002">
            content/browser/loader/resource_dispatcher_host_impl.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1608573002/diff/160001/content/browser/loader/resource_dispatcher_host_impl.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1608573002/diff2/1:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1608573002/diff2/20001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1608573002/diff2/40001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1608573002/diff2/60001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1608573002/diff2/80001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1608573002/diff2/100001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1608573002/diff2/120001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1608573002/diff2/140001:160001/content/browser/loader/resource_dispatcher_host_impl.cc"
             title="Delta from patch set 8">8</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+21 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1608573002_160001_170002.diff"
             title="Download patch for content/browser/loader/resource_dispatcher_host_impl.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1608573002/patch/160001/170004">
            content/browser/security_exploit_browsertest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1608573002/diff/160001/content/browser/security_exploit_browsertest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1608573002/diff2/1:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1608573002/diff2/20001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1608573002/diff2/40001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1608573002/diff2/60001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1608573002/diff2/80001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1608573002/diff2/100001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1608573002/diff2/120001:160001/content/browser/security_exploit_browsertest.cc"
             title="Delta from patch set 7">7</a>
        
        </td>
        
          <td style="white-space: nowrap">10 chunks</td>
          <td style="white-space: nowrap">+75 lines, -8 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1608573002_160001_170004.diff"
             title="Download patch for content/browser/security_exploit_browsertest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1608573002/patch/160001/170005">
            tools/metrics/histograms/histograms.xml
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1608573002/diff/160001/tools/metrics/histograms/histograms.xml">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1608573002/diff2/1:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 1">1</a>
        
          <a href="/1608573002/diff2/20001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 2">2</a>
        
          <a href="/1608573002/diff2/40001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 3">3</a>
        
          <a href="/1608573002/diff2/60001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 4">4</a>
        
          <a href="/1608573002/diff2/80001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 5">5</a>
        
          <a href="/1608573002/diff2/100001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 6">6</a>
        
          <a href="/1608573002/diff2/120001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 7">7</a>
        
          <a href="/1608573002/diff2/140001:160001/tools/metrics/histograms/histograms.xml"
             title="Delta from patch set 8">8</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1608573002_160001_170005.diff"
             title="Download patch for tools/metrics/histograms/histograms.xml">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 160001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 38 (11 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 38)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 38)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(38)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(38)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          Description was changed from ========== Fix RDH delegate_map_.end() dereference BUG=578882 ========== to ========== Block a ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 13:56:32 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >Description was changed from

==========
Fix RDH delegate_map_.end() dereference

BUG=578882
==========

to

==========
Block a compromised renderer from reusing request ids.

BUG=578882
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          gzobqq@gmail.com changed reviewers: + mmenke@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 14:01:02 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ><a href="mailto:gzobqq@gmail.com">gzobqq@gmail.com</a> changed reviewers:
+ <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          mmenke, PTAL. This adds a request_ids_in_use_ set to RDH. It is used to validate that ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 14:11:16 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >mmenke, PTAL.

This adds a request_ids_in_use_ set to RDH. It is used to validate that a
request id from the renderer is unique and doesn&#39;t overwrite pending_loaders_ or
delegate_map_ entries. It&#39;s not so nice that information is duplicated. The set
of request ids in use can also be obtained from pending_loaders_ and
blocked_loaders_map_, but the latter would have to be iterated. Another option
would probably be to generate request ids on browser side. I figured an extra
set is the safest option for merging.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          On 2016/01/19 14:11:16, gzobqq wrote: &gt; mmenke, PTAL. &gt; &gt; This adds a request_ids_in_use_ set ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 16:29:47 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >On 2016/01/19 14:11:16, gzobqq wrote:
&gt; mmenke, PTAL.
&gt; 
&gt; This adds a request_ids_in_use_ set to RDH. It is used to validate that a
&gt; request id from the renderer is unique and doesn&#39;t overwrite pending_loaders_
or
&gt; delegate_map_ entries. It&#39;s not so nice that information is duplicated. The
set
&gt; of request ids in use can also be obtained from pending_loaders_ and
&gt; blocked_loaders_map_, but the latter would have to be iterated. Another option
&gt; would probably be to generate request ids on browser side. I figured an extra
&gt; set is the safest option for merging.

Could I get access to the bug this issue references?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc File content/browser/loader/resource_dispatcher_host_impl.cc (right): https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177 content/browser/loader/resource_dispatcher_host_impl.cc:1177: void ResourceDispatcherHostImpl::UpdateRequestForTransfer( BUG: This changes the id of a ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 20:30:31 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            ><a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
File content/browser/loader/resource_dispatcher_host_impl.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
ResourceDispatcherHostImpl::UpdateRequestForTransfer(
BUG:  This changes the id of a request, so needs to update the set as well.  I&#39;m
not a huge fan of the information duplicating approach because it inevitably
leads to bug like this.  Wonder if we can come up with something better...</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          So here&#39;s my suggestion: Check blocked_loaders_map_ and pending_loaders_. blocked_loaders_map_ should generally be empty, anyways, so ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-19 22:18:23 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >So here&#39;s my suggestion:  Check blocked_loaders_map_ and pending_loaders_. 
blocked_loaders_map_ should generally be empty, anyways, so I&#39;m not sure we need
to go further than that (I believe it&#39;s only populated when we&#39;re showing an
interstitial page).  If we do, however, we could make it contain maps as well,
and just jump to the one entry we care about.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          On 2016/01/19 20:30:31, mmenke wrote: &gt; https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc &gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right): &gt; &gt; https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177 &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-20 05:51:01 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >On 2016/01/19 20:30:31, mmenke wrote:
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; BUG:  This changes the id of a request, so needs to update the set as well. 
I&#39;m
&gt; not a huge fan of the information duplicating approach because it inevitably
&gt; leads to bug like this.  Wonder if we can come up with something better...

Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But yeah,
let&#39;s go with checking pending_loaders_ and blocked_loaders_map_ instead then.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          On 2016/01/20 05:51:01, gzobqq wrote: &gt; On 2016/01/19 20:30:31, mmenke wrote: &gt; &gt; &gt; https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-20 15:38:23 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >On 2016/01/20 05:51:01, gzobqq wrote:
&gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right):
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; BUG:  This changes the id of a request, so needs to update the set as well. 
&gt; I&#39;m
&gt; &gt; not a huge fan of the information duplicating approach because it inevitably
&gt; &gt; leads to bug like this.  Wonder if we can come up with something better...
&gt; 
&gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But yeah,
&gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_ instead then.

Great.  Also, how unit/browser-testable are bad_message::ReceivedBadMessage
calls?  I generally feel that every fix should come with a test.  I&#39;m less sure
about issues like this, but then, perhaps it should be considered more important
to have tests because it&#39;s considered a security issue.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          On 2016/01/20 15:38:23, mmenke wrote: &gt; On 2016/01/20 05:51:01, gzobqq wrote: &gt; &gt; On 2016/01/19 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-20 15:41:44 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >On 2016/01/20 15:38:23, mmenke wrote:
&gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right):
&gt; &gt; &gt; 
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the set as
well. 
&gt; &gt; I&#39;m
&gt; &gt; &gt; not a huge fan of the information duplicating approach because it
inevitably
&gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something better...
&gt; &gt; 
&gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But yeah,
&gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_ instead
then.
&gt; 
&gt; Great.  Also, how unit/browser-testable are bad_message::ReceivedBadMessage
&gt; calls?  I generally feel that every fix should come with a test.  I&#39;m less
sure
&gt; about issues like this, but then, perhaps it should be considered more
important
&gt; to have tests because it&#39;s considered a security issue.

Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">chromium.org</a> account, sorry, I didn&#39;t notice.  I&#39;ll look
into the testing situation myself.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          On 2016/01/20 15:41:44, mmenke wrote: &gt; On 2016/01/20 15:38:23, mmenke wrote: &gt; &gt; On 2016/01/20 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-20 18:57:48 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >On 2016/01/20 15:41:44, mmenke wrote:
&gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right):
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the set as
&gt; well. 
&gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because it
&gt; inevitably
&gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something
better...
&gt; &gt; &gt; 
&gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But
yeah,
&gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_ instead
&gt; then.
&gt; &gt; 
&gt; &gt; Great.  Also, how unit/browser-testable are bad_message::ReceivedBadMessage
&gt; &gt; calls?  I generally feel that every fix should come with a test.  I&#39;m less
&gt; sure
&gt; &gt; about issues like this, but then, perhaps it should be considered more
&gt; important
&gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; 
&gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t notice. 
I&#39;ll look
&gt; into the testing situation myself.

Here is the second attempt which checks the maps. About testing, perhaps
overriding ResourceMessageFilter::ShutdownForBadMessage() in
content/browser/loader/resource_dispatcher_host_unittest.cc would do it. There&#39;s
something similar in
content/browser/service_worker/service_worker_handle_unittest.cc. My gmail
account is really not an excuse for not writing a test. But I&#39;m very much
willing to leave this to you if you&#39;re up for it. If you&#39;re busy though, I can
take it. Might take me some time, I&#39;m slow paced.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          On 2016/01/20 18:57:48, gzobqq wrote: &gt; On 2016/01/20 15:41:44, mmenke wrote: &gt; &gt; On 2016/01/20 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-21 16:32:34 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >On 2016/01/20 18:57:48, gzobqq wrote:
&gt; On 2016/01/20 15:41:44, mmenke wrote:
&gt; &gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc (right):
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the set as
&gt; &gt; well. 
&gt; &gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because it
&gt; &gt; inevitably
&gt; &gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something
&gt; better...
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But
&gt; yeah,
&gt; &gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_ instead
&gt; &gt; then.
&gt; &gt; &gt; 
&gt; &gt; &gt; Great.  Also, how unit/browser-testable are
bad_message::ReceivedBadMessage
&gt; &gt; &gt; calls?  I generally feel that every fix should come with a test.  I&#39;m less
&gt; &gt; sure
&gt; &gt; &gt; about issues like this, but then, perhaps it should be considered more
&gt; &gt; important
&gt; &gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; &gt; 
&gt; &gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t notice.

&gt; I&#39;ll look
&gt; &gt; into the testing situation myself.
&gt; 
&gt; Here is the second attempt which checks the maps. About testing, perhaps
&gt; overriding ResourceMessageFilter::ShutdownForBadMessage() in
&gt; content/browser/loader/resource_dispatcher_host_unittest.cc would do it.
There&#39;s
&gt; something similar in
&gt; content/browser/service_worker/service_worker_handle_unittest.cc. My gmail
&gt; account is really not an excuse for not writing a test. But I&#39;m very much
&gt; willing to leave this to you if you&#39;re up for it. If you&#39;re busy though, I can
&gt; take it. Might take me some time, I&#39;m slow paced.

I&#39;ll do the legwork to figure out what would be involved in writing a test - I
think it&#39;s reasonable to ask for a test, just since you&#39;re not working on Chrome
full time, I don&#39;t feel it&#39;s reasonable to expect you to figure out a reasonable
approach (And if I have time, I may also be willing to write it, we&#39;ll see).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          On 2016/01/21 16:32:34, mmenke wrote: &gt; On 2016/01/20 18:57:48, gzobqq wrote: &gt; &gt; On 2016/01/20 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-21 17:34:33 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >On 2016/01/21 16:32:34, mmenke wrote:
&gt; On 2016/01/20 18:57:48, gzobqq wrote:
&gt; &gt; On 2016/01/20 15:41:44, mmenke wrote:
&gt; &gt; &gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; &gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc
(right):
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; &gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the set
as
&gt; &gt; &gt; well. 
&gt; &gt; &gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because it
&gt; &gt; &gt; inevitably
&gt; &gt; &gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something
&gt; &gt; better...
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching. But
&gt; &gt; yeah,
&gt; &gt; &gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_
instead
&gt; &gt; &gt; then.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Great.  Also, how unit/browser-testable are
&gt; bad_message::ReceivedBadMessage
&gt; &gt; &gt; &gt; calls?  I generally feel that every fix should come with a test.  I&#39;m
less
&gt; &gt; &gt; sure
&gt; &gt; &gt; &gt; about issues like this, but then, perhaps it should be considered more
&gt; &gt; &gt; important
&gt; &gt; &gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; &gt; &gt; 
&gt; &gt; &gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t
notice.
&gt; 
&gt; &gt; I&#39;ll look
&gt; &gt; &gt; into the testing situation myself.
&gt; &gt; 
&gt; &gt; Here is the second attempt which checks the maps. About testing, perhaps
&gt; &gt; overriding ResourceMessageFilter::ShutdownForBadMessage() in
&gt; &gt; content/browser/loader/resource_dispatcher_host_unittest.cc would do it.
&gt; There&#39;s
&gt; &gt; something similar in
&gt; &gt; content/browser/service_worker/service_worker_handle_unittest.cc. My gmail
&gt; &gt; account is really not an excuse for not writing a test. But I&#39;m very much
&gt; &gt; willing to leave this to you if you&#39;re up for it. If you&#39;re busy though, I
can
&gt; &gt; take it. Might take me some time, I&#39;m slow paced.
&gt; 
&gt; I&#39;ll do the legwork to figure out what would be involved in writing a test - I
&gt; think it&#39;s reasonable to ask for a test, just since you&#39;re not working on
Chrome
&gt; full time, I don&#39;t feel it&#39;s reasonable to expect you to figure out a
reasonable
&gt; approach (And if I have time, I may also be willing to write it, we&#39;ll see).

Sounds good, thank you.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          On 2016/01/21 17:34:33, gzobqq wrote: &gt; On 2016/01/21 16:32:34, mmenke wrote: &gt; &gt; On 2016/01/20 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-25 20:08:31 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >On 2016/01/21 17:34:33, gzobqq wrote:
&gt; On 2016/01/21 16:32:34, mmenke wrote:
&gt; &gt; On 2016/01/20 18:57:48, gzobqq wrote:
&gt; &gt; &gt; On 2016/01/20 15:41:44, mmenke wrote:
&gt; &gt; &gt; &gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc
&gt; (right):
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177: void
&gt; &gt; &gt; &gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the set
&gt; as
&gt; &gt; &gt; &gt; well. 
&gt; &gt; &gt; &gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because it
&gt; &gt; &gt; &gt; inevitably
&gt; &gt; &gt; &gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something
&gt; &gt; &gt; better...
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching.
But
&gt; &gt; &gt; yeah,
&gt; &gt; &gt; &gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_
&gt; instead
&gt; &gt; &gt; &gt; then.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Great.  Also, how unit/browser-testable are
&gt; &gt; bad_message::ReceivedBadMessage
&gt; &gt; &gt; &gt; &gt; calls?  I generally feel that every fix should come with a test.  I&#39;m
&gt; less
&gt; &gt; &gt; &gt; sure
&gt; &gt; &gt; &gt; &gt; about issues like this, but then, perhaps it should be considered more
&gt; &gt; &gt; &gt; important
&gt; &gt; &gt; &gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t
&gt; notice.
&gt; &gt; 
&gt; &gt; &gt; I&#39;ll look
&gt; &gt; &gt; &gt; into the testing situation myself.
&gt; &gt; &gt; 
&gt; &gt; &gt; Here is the second attempt which checks the maps. About testing, perhaps
&gt; &gt; &gt; overriding ResourceMessageFilter::ShutdownForBadMessage() in
&gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_unittest.cc would do it.
&gt; &gt; There&#39;s
&gt; &gt; &gt; something similar in
&gt; &gt; &gt; content/browser/service_worker/service_worker_handle_unittest.cc. My gmail
&gt; &gt; &gt; account is really not an excuse for not writing a test. But I&#39;m very much
&gt; &gt; &gt; willing to leave this to you if you&#39;re up for it. If you&#39;re busy though, I
&gt; can
&gt; &gt; &gt; take it. Might take me some time, I&#39;m slow paced.
&gt; &gt; 
&gt; &gt; I&#39;ll do the legwork to figure out what would be involved in writing a test -
I
&gt; &gt; think it&#39;s reasonable to ask for a test, just since you&#39;re not working on
&gt; Chrome
&gt; &gt; full time, I don&#39;t feel it&#39;s reasonable to expect you to figure out a
&gt; reasonable
&gt; &gt; approach (And if I have time, I may also be willing to write it, we&#39;ll see).
&gt; 
&gt; Sounds good, thank you.

Sorry for slowness.  content/browser/security_exploit_browsertest.cc looks to be
the place you want to add a test.  See InvalidOriginHeaders, in particular.  I
think it&#39;s safe to use IpcSecurityTestUtil::PwnMessageReceived for both the
initial request, and the followup with the duplicate id.

Ideally we&#39;d have a test where the initial request is in the BlockedLoadersList,
and a test where it&#39;s in the pending list.

For a URL to request, to avoid any chance the request will actually complete, I
think it&#39;s best to use  
net::URLRequestFailedJob::GetMockHttpUrlWithFailurePhase(net::URLRequestFailedJob::START,
net::ERR_IO_PENDING) as the URL.  To use the mocks, you&#39;ll need to add code in
the test fixture&#39;s SetUpOnMainThread() method to post a task to the IOThread to
call net::URLRequestFailedJob::AddUrlHandler();

Happy to talk more about the details of setting up the test.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          On 2016/01/25 20:08:31, mmenke wrote: &gt; On 2016/01/21 17:34:33, gzobqq wrote: &gt; &gt; On 2016/01/21 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 11 months ago
		(2016-01-26 10:07:46 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >On 2016/01/25 20:08:31, mmenke wrote:
&gt; On 2016/01/21 17:34:33, gzobqq wrote:
&gt; &gt; On 2016/01/21 16:32:34, mmenke wrote:
&gt; &gt; &gt; On 2016/01/20 18:57:48, gzobqq wrote:
&gt; &gt; &gt; &gt; On 2016/01/20 15:41:44, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc
&gt; &gt; (right):
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177:
void
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the
set
&gt; &gt; as
&gt; &gt; &gt; &gt; &gt; well. 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because
it
&gt; &gt; &gt; &gt; &gt; inevitably
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with something
&gt; &gt; &gt; &gt; better...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for catching.
&gt; But
&gt; &gt; &gt; &gt; yeah,
&gt; &gt; &gt; &gt; &gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_
&gt; &gt; instead
&gt; &gt; &gt; &gt; &gt; then.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; Great.  Also, how unit/browser-testable are
&gt; &gt; &gt; bad_message::ReceivedBadMessage
&gt; &gt; &gt; &gt; &gt; &gt; calls?  I generally feel that every fix should come with a test. 
I&#39;m
&gt; &gt; less
&gt; &gt; &gt; &gt; &gt; sure
&gt; &gt; &gt; &gt; &gt; &gt; about issues like this, but then, perhaps it should be considered
more
&gt; &gt; &gt; &gt; &gt; important
&gt; &gt; &gt; &gt; &gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t
&gt; &gt; notice.
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I&#39;ll look
&gt; &gt; &gt; &gt; &gt; into the testing situation myself.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Here is the second attempt which checks the maps. About testing, perhaps
&gt; &gt; &gt; &gt; overriding ResourceMessageFilter::ShutdownForBadMessage() in
&gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_unittest.cc would do it.
&gt; &gt; &gt; There&#39;s
&gt; &gt; &gt; &gt; something similar in
&gt; &gt; &gt; &gt; content/browser/service_worker/service_worker_handle_unittest.cc. My
gmail
&gt; &gt; &gt; &gt; account is really not an excuse for not writing a test. But I&#39;m very
much
&gt; &gt; &gt; &gt; willing to leave this to you if you&#39;re up for it. If you&#39;re busy though,
I
&gt; &gt; can
&gt; &gt; &gt; &gt; take it. Might take me some time, I&#39;m slow paced.
&gt; &gt; &gt; 
&gt; &gt; &gt; I&#39;ll do the legwork to figure out what would be involved in writing a test
-
&gt; I
&gt; &gt; &gt; think it&#39;s reasonable to ask for a test, just since you&#39;re not working on
&gt; &gt; Chrome
&gt; &gt; &gt; full time, I don&#39;t feel it&#39;s reasonable to expect you to figure out a
&gt; &gt; reasonable
&gt; &gt; &gt; approach (And if I have time, I may also be willing to write it, we&#39;ll
see).
&gt; &gt; 
&gt; &gt; Sounds good, thank you.
&gt; 
&gt; Sorry for slowness.  content/browser/security_exploit_browsertest.cc looks to
be
&gt; the place you want to add a test.  See InvalidOriginHeaders, in particular.  I
&gt; think it&#39;s safe to use IpcSecurityTestUtil::PwnMessageReceived for both the
&gt; initial request, and the followup with the duplicate id.
&gt; 
&gt; Ideally we&#39;d have a test where the initial request is in the
BlockedLoadersList,
&gt; and a test where it&#39;s in the pending list.
&gt; 
&gt; For a URL to request, to avoid any chance the request will actually complete,
I
&gt; think it&#39;s best to use  
&gt;
net::URLRequestFailedJob::GetMockHttpUrlWithFailurePhase(net::URLRequestFailedJob::START,
&gt; net::ERR_IO_PENDING) as the URL.  To use the mocks, you&#39;ll need to add code in
&gt; the test fixture&#39;s SetUpOnMainThread() method to post a task to the IOThread
to
&gt; call net::URLRequestFailedJob::AddUrlHandler();
&gt; 
&gt; Happy to talk more about the details of setting up the test.

Thanks for figuring this out. I am now working on it.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          On 2016/01/26 10:07:46, gzobqq wrote: &gt; On 2016/01/25 20:08:31, mmenke wrote: &gt; &gt; On 2016/01/21 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 14:35:37 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >On 2016/01/26 10:07:46, gzobqq wrote:
&gt; On 2016/01/25 20:08:31, mmenke wrote:
&gt; &gt; On 2016/01/21 17:34:33, gzobqq wrote:
&gt; &gt; &gt; On 2016/01/21 16:32:34, mmenke wrote:
&gt; &gt; &gt; &gt; On 2016/01/20 18:57:48, gzobqq wrote:
&gt; &gt; &gt; &gt; &gt; On 2016/01/20 15:41:44, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/20 15:38:23, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/20 05:51:01, gzobqq wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; On 2016/01/19 20:30:31, mmenke wrote:
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; File content/browser/loader/resource_dispatcher_host_impl.cc
&gt; &gt; &gt; (right):
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt; &gt;
&gt; &gt; &gt; &gt;
&gt; &gt; &gt;
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/20001/content/browser/loader/...</a>
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_impl.cc:1177:
&gt; void
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; ResourceDispatcherHostImpl::UpdateRequestForTransfer(
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; BUG:  This changes the id of a request, so needs to update the
&gt; set
&gt; &gt; &gt; as
&gt; &gt; &gt; &gt; &gt; &gt; well. 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; I&#39;m
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; not a huge fan of the information duplicating approach because
&gt; it
&gt; &gt; &gt; &gt; &gt; &gt; inevitably
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; leads to bug like this.  Wonder if we can come up with
something
&gt; &gt; &gt; &gt; &gt; better...
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; Well darn. Can&#39;t believe I forgot about this. Thanks for
catching.
&gt; &gt; But
&gt; &gt; &gt; &gt; &gt; yeah,
&gt; &gt; &gt; &gt; &gt; &gt; &gt; &gt; let&#39;s go with checking pending_loaders_ and blocked_loaders_map_
&gt; &gt; &gt; instead
&gt; &gt; &gt; &gt; &gt; &gt; then.
&gt; &gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; &gt; Great.  Also, how unit/browser-testable are
&gt; &gt; &gt; &gt; bad_message::ReceivedBadMessage
&gt; &gt; &gt; &gt; &gt; &gt; &gt; calls?  I generally feel that every fix should come with a test. 
&gt; I&#39;m
&gt; &gt; &gt; less
&gt; &gt; &gt; &gt; &gt; &gt; sure
&gt; &gt; &gt; &gt; &gt; &gt; &gt; about issues like this, but then, perhaps it should be considered
&gt; more
&gt; &gt; &gt; &gt; &gt; &gt; important
&gt; &gt; &gt; &gt; &gt; &gt; &gt; to have tests because it&#39;s considered a security issue.
&gt; &gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; &gt; Ahh, you&#39;re not using a <a href="http://chromium.org" rel="nofollow">http://chromium.org</a> account, sorry, I didn&#39;t
&gt; &gt; &gt; notice.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; I&#39;ll look
&gt; &gt; &gt; &gt; &gt; &gt; into the testing situation myself.
&gt; &gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; &gt; Here is the second attempt which checks the maps. About testing,
perhaps
&gt; &gt; &gt; &gt; &gt; overriding ResourceMessageFilter::ShutdownForBadMessage() in
&gt; &gt; &gt; &gt; &gt; content/browser/loader/resource_dispatcher_host_unittest.cc would do
it.
&gt; &gt; &gt; &gt; There&#39;s
&gt; &gt; &gt; &gt; &gt; something similar in
&gt; &gt; &gt; &gt; &gt; content/browser/service_worker/service_worker_handle_unittest.cc. My
&gt; gmail
&gt; &gt; &gt; &gt; &gt; account is really not an excuse for not writing a test. But I&#39;m very
&gt; much
&gt; &gt; &gt; &gt; &gt; willing to leave this to you if you&#39;re up for it. If you&#39;re busy
though,
&gt; I
&gt; &gt; &gt; can
&gt; &gt; &gt; &gt; &gt; take it. Might take me some time, I&#39;m slow paced.
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; I&#39;ll do the legwork to figure out what would be involved in writing a
test
&gt; -
&gt; &gt; I
&gt; &gt; &gt; &gt; think it&#39;s reasonable to ask for a test, just since you&#39;re not working
on
&gt; &gt; &gt; Chrome
&gt; &gt; &gt; &gt; full time, I don&#39;t feel it&#39;s reasonable to expect you to figure out a
&gt; &gt; &gt; reasonable
&gt; &gt; &gt; &gt; approach (And if I have time, I may also be willing to write it, we&#39;ll
&gt; see).
&gt; &gt; &gt; 
&gt; &gt; &gt; Sounds good, thank you.
&gt; &gt; 
&gt; &gt; Sorry for slowness.  content/browser/security_exploit_browsertest.cc looks
to
&gt; be
&gt; &gt; the place you want to add a test.  See InvalidOriginHeaders, in particular. 
I
&gt; &gt; think it&#39;s safe to use IpcSecurityTestUtil::PwnMessageReceived for both the
&gt; &gt; initial request, and the followup with the duplicate id.
&gt; &gt; 
&gt; &gt; Ideally we&#39;d have a test where the initial request is in the
&gt; BlockedLoadersList,
&gt; &gt; and a test where it&#39;s in the pending list.
&gt; &gt; 
&gt; &gt; For a URL to request, to avoid any chance the request will actually
complete,
&gt; I
&gt; &gt; think it&#39;s best to use  
&gt; &gt;
&gt;
net::URLRequestFailedJob::GetMockHttpUrlWithFailurePhase(net::URLRequestFailedJob::START,
&gt; &gt; net::ERR_IO_PENDING) as the URL.  To use the mocks, you&#39;ll need to add code
in
&gt; &gt; the test fixture&#39;s SetUpOnMainThread() method to post a task to the IOThread
&gt; to
&gt; &gt; call net::URLRequestFailedJob::AddUrlHandler();
&gt; &gt; 
&gt; &gt; Happy to talk more about the details of setting up the test.
&gt; 
&gt; Thanks for figuring this out. I am now working on it.

PTAL</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          Thanks for the test! The looks good, just a few minor things. To reduce round-trips, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 16:20:08 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >Thanks for the test!  The looks good, just a few minor things.

To reduce round-trips, suggest you add an owner for the security tests (tsepez
or creis) once you&#39;ve responded to comments.  Since creis owns bad_messages as
well, suggest you go with him.  You also need a histograms.xml owner - anyone in
the histograms owners file should be fine.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
File content/browser/security_exploit_browsertest.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode103" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:103: ResourceHostMsg_Request
CreateDefaultRequest() {
Optional:  Suggest making this take in a url, and setting the request.url to it.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode144" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:144: child_id,
web_rfh-&gt;GetRoutingID());
This needs to be run on the IO thread, and we&#39;re currently on the UI thread. 
You can just post a task to run this to the IO thread - no need to wait for it
to complete, since everything else this needs to run before will also happen on
the IO thread.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode149" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:149: // blocks indefinitely,
which is good because the request stays alive and we
nit (x2):  Avoid &quot;we&quot; in comments, due to ambiguity (Does it mean &quot;we&quot; the
chromium authors, &quot;we&quot; the object, &quot;we&quot; the code, etc).  Prefer passive voice.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode437" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:437:
ResourceHostMsg_RequestResource(web_rfh-&gt;GetRoutingID(), 1,
These tests make me nervous now - we&#39;re depending on the request for the
navigation either not to use ID 1, or to be completely cleaned up before this
message reaches the IO thread.  Otherwise, the new check will cause these tests
to pass, even if what they&#39;re testing breaks.

Could we just declare a constant &quot;const int kRequestIdNotPreviouslyUsed = 10000&quot;
and use that for all of these (It&#39;s not a problem using the same ID in each
test, because in each case the old RFH is destroyed, so the new one has a new
ID).

May want to do that for your new test as well, though it shouldn&#39;t really
matter, there, since even if we match the ID of the original request, and it&#39;s
not cleaned up yet, we&#39;ll still crash the process the right way.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          gzobqq@gmail.com changed reviewers: + creis@chromium.org, mpearson@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 20:21:16 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="mailto:gzobqq@gmail.com">gzobqq@gmail.com</a> changed reviewers:
+ <a href="mailto:creis@chromium.org">creis@chromium.org</a>, <a href="mailto:mpearson@chromium.org">mpearson@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          mmenke, PTAL creis, PTAL at security_exploit_browsertest.cc and bad_message.h mpearson, PTAL at histograms.xml Thanks. https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc File ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 20:21:17 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >mmenke, PTAL

creis, PTAL at security_exploit_browsertest.cc and bad_message.h

mpearson, PTAL at histograms.xml

Thanks.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
File content/browser/security_exploit_browsertest.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode103" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:103: ResourceHostMsg_Request
CreateDefaultRequest() {
On 2016/01/28 16:20:08, mmenke wrote:
&gt; Optional:  Suggest making this take in a url, and setting the request.url to
it.

Done.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode144" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:144: child_id,
web_rfh-&gt;GetRoutingID());
On 2016/01/28 16:20:08, mmenke wrote:
&gt; This needs to be run on the IO thread, and we&#39;re currently on the UI thread. 
&gt; You can just post a task to run this to the IO thread - no need to wait for it
&gt; to complete, since everything else this needs to run before will also happen
on
&gt; the IO thread.

Good catch, done.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode149" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:149: // blocks indefinitely,
which is good because the request stays alive and we
On 2016/01/28 16:20:08, mmenke wrote:
&gt; nit (x2):  Avoid &quot;we&quot; in comments, due to ambiguity (Does it mean &quot;we&quot; the
&gt; chromium authors, &quot;we&quot; the object, &quot;we&quot; the code, etc).  Prefer passive voice.

Done.

<a href="https://codereview.chromium.org/1608573002/diff/80001/content/browser/security_exploit_browsertest.cc#newcode437" rel="nofollow">https://codereview.chromium.org/1608573002/diff/80001/content/browser/securit...</a>
content/browser/security_exploit_browsertest.cc:437:
ResourceHostMsg_RequestResource(web_rfh-&gt;GetRoutingID(), 1,
On 2016/01/28 16:20:08, mmenke wrote:
&gt; These tests make me nervous now - we&#39;re depending on the request for the
&gt; navigation either not to use ID 1, or to be completely cleaned up before this
&gt; message reaches the IO thread.  Otherwise, the new check will cause these
tests
&gt; to pass, even if what they&#39;re testing breaks.
&gt; 
&gt; Could we just declare a constant &quot;const int kRequestIdNotPreviouslyUsed =
10000&quot;
&gt; and use that for all of these (It&#39;s not a problem using the same ID in each
&gt; test, because in each case the old RFH is destroyed, so the new one has a new
&gt; ID).
&gt; 
&gt; May want to do that for your new test as well, though it shouldn&#39;t really
&gt; matter, there, since even if we match the ID of the original request, and it&#39;s
&gt; not cleaned up yet, we&#39;ll still crash the process the right way.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Mark P</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          histograms.xml lgtm
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 21:09:35 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >histograms.xml lgtm</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          LGTM, just two nits. Thanks again both for catching this, and for the fix! https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 21:12:33 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >LGTM, just two nits.  Thanks again both for catching this, and for the fix!

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
File content/browser/security_exploit_browsertest.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode49" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:49: const int
kRequestIdNotPreviouslyUsed = 10000;
nit:  Should have a comment about this.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode126" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:126: ResourceHostMsg_Request
request = CreateXHRRequest(&quot;http://bar.com/simple_page.html&quot;);
nit:  Split onto two lines, so no line is over 80 characters.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          Thanks! content/ LGTM with nits. https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc File content/browser/loader/resource_dispatcher_host_impl.cc (right): https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177 content/browser/loader/resource_dispatcher_host_impl.cc:1177: for (BlockedLoadersMap::const_iterator iter = ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-28 22:05:17 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >Thanks!  content/ LGTM with nits.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader...</a>
File content/browser/loader/resource_dispatcher_host_impl.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader...</a>
content/browser/loader/resource_dispatcher_host_impl.cc:1177: for
(BlockedLoadersMap::const_iterator iter = blocked_loaders_map_.begin();
nit: Maybe use C++11 range-based for loop here, similar to
ResourceDispatcherHostImpl::OnShutdown?  Would be a little more concise.

(For reference, the allowed C++11 uses are here:
<a href="https://chromium-cpp.appspot.com/." rel="nofollow">https://chromium-cpp.appspot.com/.</a>)

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
File content/browser/security_exploit_browsertest.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode126" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:126: ResourceHostMsg_Request
request = CreateXHRRequest(&quot;http://bar.com/simple_page.html&quot;);
On 2016/01/28 21:12:33, mmenke wrote:
&gt; nit:  Split onto two lines, so no line is over 80 characters.

Tip: Running &quot;git cl format&quot; should take care of this automatically.  :)

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode134" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:134: RenderFrameHost* web_rfh =
shell-&gt;web_contents()-&gt;GetMainFrame();
nit: s/web_rfh/rfh/

(The web_ prefix was useful in the InvalidOriginHeaders test because the logic
was specific to RFHs in web processes, as opposed to chrome:// or other
privileged processes.  This test applies to all renderer processes.)

Same below with web_process_killed.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode156" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:156: // Use the same request id
twice.
nit: Move comment above the RenderProcessHostWatcher declaration, since it&#39;s a
good description of the whole block.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc File content/browser/loader/resource_dispatcher_host_impl.cc (right): https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177 content/browser/loader/resource_dispatcher_host_impl.cc:1177: for (BlockedLoadersMap::const_iterator iter = blocked_loaders_map_.begin(); On 2016/01/28 22:05:16, Charlie ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:18:58 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            ><a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader...</a>
File content/browser/loader/resource_dispatcher_host_impl.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader/resource_dispatcher_host_impl.cc#newcode1177" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/loader...</a>
content/browser/loader/resource_dispatcher_host_impl.cc:1177: for
(BlockedLoadersMap::const_iterator iter = blocked_loaders_map_.begin();
On 2016/01/28 22:05:16, Charlie Reis wrote:
&gt; nit: Maybe use C++11 range-based for loop here, similar to
&gt; ResourceDispatcherHostImpl::OnShutdown?  Would be a little more concise.
&gt; 
&gt; (For reference, the allowed C++11 uses are here:
&gt; <a href="https://chromium-cpp.appspot.com/." rel="nofollow">https://chromium-cpp.appspot.com/.</a>)

Done.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
File content/browser/security_exploit_browsertest.cc (right):

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode49" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:49: const int
kRequestIdNotPreviouslyUsed = 10000;
On 2016/01/28 21:12:33, mmenke wrote:
&gt; nit:  Should have a comment about this.

Done.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode126" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:126: ResourceHostMsg_Request
request = CreateXHRRequest(&quot;http://bar.com/simple_page.html&quot;);
On 2016/01/28 21:12:33, mmenke wrote:
&gt; nit:  Split onto two lines, so no line is over 80 characters.

Done.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode126" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:126: ResourceHostMsg_Request
request = CreateXHRRequest(&quot;http://bar.com/simple_page.html&quot;);
On 2016/01/28 22:05:16, Charlie Reis wrote:
&gt; On 2016/01/28 21:12:33, mmenke wrote:
&gt; &gt; nit:  Split onto two lines, so no line is over 80 characters.
&gt; 
&gt; Tip: Running &quot;git cl format&quot; should take care of this automatically.  :)

That helps, thanks.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode134" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:134: RenderFrameHost* web_rfh =
shell-&gt;web_contents()-&gt;GetMainFrame();
On 2016/01/28 22:05:16, Charlie Reis wrote:
&gt; nit: s/web_rfh/rfh/
&gt; 
&gt; (The web_ prefix was useful in the InvalidOriginHeaders test because the logic
&gt; was specific to RFHs in web processes, as opposed to chrome:// or other
&gt; privileged processes.  This test applies to all renderer processes.)
&gt; 
&gt; Same below with web_process_killed.

Done.

<a href="https://codereview.chromium.org/1608573002/diff/100001/content/browser/security_exploit_browsertest.cc#newcode156" rel="nofollow">https://codereview.chromium.org/1608573002/diff/100001/content/browser/securi...</a>
content/browser/security_exploit_browsertest.cc:156: // Use the same request id
twice.
On 2016/01/28 22:05:16, Charlie Reis wrote:
&gt; nit: Move comment above the RenderProcessHostWatcher declaration, since it&#39;s a
&gt; good description of the whole block.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          The CQ bit was checked by gzobqq@gmail.com to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:24:14 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >The CQ bit was checked by <a href="mailto:gzobqq@gmail.com">gzobqq@gmail.com</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1608573002/140001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1608573002/140001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:24:22 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1608573002/140001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1608573002/140001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1608573002/140001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1608573002/140001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:26:34 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          Dry run: Try jobs failed on following builders: mac_chromium_compile_dbg_ng on tryserver.chromium.mac (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_compile_dbg_ng/builds/152629) mac_chromium_gn_rel on ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:26:34 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >Dry run: Try jobs failed on following builders:
  mac_chromium_compile_dbg_ng on tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_compile_dbg_ng/builds/152629" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_comp...</a>)
  mac_chromium_gn_rel on tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_gn_rel/builds/59722" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_gn_r...</a>)
  mac_chromium_rel_ng on tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_rel_ng/builds/172778" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_rel_...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          bad_message.h is moving faster than I can manage to rebase and recompile :)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:38:48 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >bad_message.h is moving faster than I can manage to rebase and recompile :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          The CQ bit was checked by gzobqq@gmail.com to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:52:47 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-27"
            >The CQ bit was checked by <a href="mailto:gzobqq@gmail.com">gzobqq@gmail.com</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1608573002/160001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 07:52:55 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-28"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1608573002/160001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1608573002/160001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-29">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 09:08:49 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-29"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg31"
           name="30">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(30)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-30">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 09:08:49 UTC)
                <a href="#msg31">#31</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-30"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-30"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg32"
           name="31">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(31)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-31">
                          The CQ bit was checked by gzobqq@gmail.com
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:01:28 UTC)
                <a href="#msg32">#32</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-31"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-31"
            >The CQ bit was checked by <a href="mailto:gzobqq@gmail.com">gzobqq@gmail.com</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg33"
           name="32">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(32)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>gzobqq</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-32">
                          The patchset sent to the CQ was uploaded after l-g-t-m from creis@chromium.org, mpearson@chromium.org, mmenke@chromium.org Link ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:01:29 UTC)
                <a href="#msg33">#33</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-32"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-32"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:creis@chromium.org">creis@chromium.org</a>,
<a href="mailto:mpearson@chromium.org">mpearson@chromium.org</a>, <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1608573002/#ps160001" rel="nofollow">https://codereview.chromium.org/1608573002/#ps160001</a>
(title: &quot;Rebase&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg34"
           name="33">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(33)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-33">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1608573002/160001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:02:53 UTC)
                <a href="#msg34">#34</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-33"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-33"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1608573002/160001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1608573002/160001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1608573002/160001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg35"
           name="34">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(34)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-34">
                          Description was changed from ========== Block a compromised renderer from reusing request ids. BUG=578882 ========== ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:07:17 UTC)
                <a href="#msg35">#35</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-34"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-34"
            >Description was changed from

==========
Block a compromised renderer from reusing request ids.

BUG=578882
==========

to

==========
Block a compromised renderer from reusing request ids.

BUG=578882
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg36"
           name="35">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(35)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-35">
                          Committed patchset #9 (id:160001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:07:18 UTC)
                <a href="#msg36">#36</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-35"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-35"
            >Committed patchset #9 (id:160001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg37"
           name="36">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(36)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-36">
                          Description was changed from ========== Block a compromised renderer from reusing request ids. BUG=578882 ========== ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:08:09 UTC)
                <a href="#msg37">#37</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-36"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-36"
            >Description was changed from

==========
Block a compromised renderer from reusing request ids.

BUG=578882
==========

to

==========
Block a compromised renderer from reusing request ids.

BUG=578882

Committed: <a href="https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2" rel="nofollow">https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2</a>
Cr-Commit-Position: refs/heads/master@{#372547}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg38"
           name="37">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(37)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-37">
                          Patchset 9 (id:??) landed as https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2 Cr-Commit-Position: refs/heads/master@{#372547}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-01-30 13:08:10 UTC)
                <a href="#msg38">#38</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-37"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-37"
            >Patchset 9 (id:??) landed as
<a href="https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2" rel="nofollow">https://crrev.com/1af4fada49c4f3890f16daac31d38379a9d782b2</a>
Cr-Commit-Position: refs/heads/master@{#372547}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 38)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 38)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(38)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(38)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 38;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1608573002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1608573002: RDH: Block a compromised renderer from reusing request ids
     (Closed) </b><br/>
      Created 4 years, 11 months ago by gzobqq<br/>
      Modified 4 years, 10 months ago<br/>
      Reviewers: mmenke, Charlie Reis, Mark P<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 21
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
