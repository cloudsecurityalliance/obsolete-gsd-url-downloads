<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication - Security Announcements - Ruby on Rails Discussions</title>
    <meta name="description" content="There is a possible DoS vulnerability in the Token Authentication logic in
Action Controller.  This vulnerability has been assigned the CVE identifier
CVE-2021-22904. 
Versions Affected:  &amp;gt;= 4.0.0
Not affected:       &amp;lt; 4&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta7 - https://github.com/discourse/discourse version 50f4f438257fb6761172201a9f0a4af80b6e7dd8">
<link rel="icon" type="image/png" href="https://aws1.discourse-cdn.com/rubyonrails/optimized/1X/bc68acbc8c022726e69f980e00d6811212d9378d_2_32x32.ico">
<link rel="apple-touch-icon" type="image/png" href="https://aws1.discourse-cdn.com/rubyonrails/optimized/1X/d8ed67d6489f869100eacbced1ea316808abcfd6_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://discuss.rubyonrails.org/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://discuss.rubyonrails.org","potentialAction":{"@type":"SearchAction","target":"https://discuss.rubyonrails.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="https://discuss.rubyonrails.org/opensearch.xml" title="Ruby on Rails Discussions Search">

      <link href="https://sea2.discourse-cdn.com/rubyonrails/stylesheets/desktop_1024b0b8e2199c58885788047ccd35b205921cfd.css?__ws=discuss.rubyonrails.org" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="https://sea2.discourse-cdn.com/rubyonrails/stylesheets/desktop_theme_5_c5f146008a874f642044cfb2b8de502123142d2b.css?__ws=discuss.rubyonrails.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="5" data-theme-name="ruby on rails theme"/>
    
    
        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication&#39;" href="https://discuss.rubyonrails.org/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869.rss" />
    <meta property="og:site_name" content="Ruby on Rails Discussions" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://aws1.discourse-cdn.com/rubyonrails/original/1X/d8ed67d6489f869100eacbced1ea316808abcfd6.png" />
<meta property="og:image" content="https://aws1.discourse-cdn.com/rubyonrails/original/1X/d8ed67d6489f869100eacbced1ea316808abcfd6.png" />
<meta property="og:url" content="https://discuss.rubyonrails.org/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869" />
<meta name="twitter:url" content="https://discuss.rubyonrails.org/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869" />
<meta property="og:title" content="[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication" />
<meta name="twitter:title" content="[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication" />
<meta property="og:description" content="There is a possible DoS vulnerability in the Token Authentication logic in Action Controller.  This vulnerability has been assigned the CVE identifier CVE-2021-22904.  Versions Affected:  &gt;= 4.0.0 Not affected:       &lt; 4.0.0 Fixed Versions:     6.1.3.2, 6.0.3.7, 5.2.4.6, 5.2.6   Impact Impacted code uses authenticate_or_request_with_http_token or authenticate_with_http_token for request authentication.  Impacted code will look something like this:  class PostsController &lt; ApplicationController  ..." />
<meta name="twitter:description" content="There is a possible DoS vulnerability in the Token Authentication logic in Action Controller.  This vulnerability has been assigned the CVE identifier CVE-2021-22904.  Versions Affected:  &gt;= 4.0.0 Not affected:       &lt; 4.0.0 Fixed Versions:     6.1.3.2, 6.0.3.7, 5.2.4.6, 5.2.6   Impact Impacted code uses authenticate_or_request_with_http_token or authenticate_with_http_token for request authentication.  Impacted code will look something like this:  class PostsController &lt; ApplicationController  ..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="9 ❤" />
<meta property="article:published_time" content="2021-05-05T17:00:36+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    <script src="https://sea2.discourse-cdn.com/rubyonrails/theme-javascripts/92683bad5b14642de0ab5e8229122dc5cb2bd36d.js?__ws=discuss.rubyonrails.org"></script>
<script src="https://sea2.discourse-cdn.com/rubyonrails/theme-javascripts/ab7adb162e289d842333f7822f418ce6cb97b436.js?__ws=discuss.rubyonrails.org"></script>
    <header>
      <a href="/">
          <img src="https://aws1.discourse-cdn.com/rubyonrails/original/1X/a53da4734108d2580fcca0de1bbb1b742180f1f3.png" alt="Ruby on Rails Discussions" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869">[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://discuss.rubyonrails.org/c/security-announcements/9" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Security Announcements</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='Ruby on Rails Discussions'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://aws1.discourse-cdn.com/rubyonrails/original/1X/a53da4734108d2580fcca0de1bbb1b742180f1f3.png'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://discuss.rubyonrails.org/u/tenderlove'><span itemprop='name'>tenderlove</span></a>
            (Aaron Patterson)
          </span>

          <link itemprop="mainEntityOfPage" href="https://discuss.rubyonrails.org/t/cve-2021-22904-possible-dos-vulnerability-in-action-controller-token-authentication/77869">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-05-05T17:00:36Z' class='post-time'>
                May 5, 2021,  5:00pm
              </time>
              <meta itemprop='dateModified' content='2021-05-05T17:00:36Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p>There is a possible DoS vulnerability in the Token Authentication logic in
Action Controller.  This vulnerability has been assigned the CVE identifier
CVE-2021-22904.</p>
<p>Versions Affected:  &gt;= 4.0.0
Not affected:       &lt; 4.0.0
Fixed Versions:     6.1.3.2, 6.0.3.7, 5.2.4.6, 5.2.6</p>
<h2>
<a name="impact" class="anchor" href="#impact"></a>Impact</h2>
<p>Impacted code uses <code>authenticate_or_request_with_http_token</code> or
<code>authenticate_with_http_token</code> for request authentication.  Impacted code will
look something like this:</p>
<pre><code class="lang-ruby">class PostsController &lt; ApplicationController
  before_action :authenticate

  private

  def authenticate
    authenticate_or_request_with_http_token do |token, options|
      # ...
    end
  end
end
</code></pre>
<p>All users running an affected release should either upgrade or use one of the
workarounds immediately.</p>
<h2>
<a name="releases" class="anchor" href="#releases"></a>Releases</h2>
<p>The fixed releases are available at the normal locations.</p>
<h2>
<a name="workarounds" class="anchor" href="#workarounds"></a>Workarounds</h2>
<p>The following monkey patch placed in an initializer can be used to work around
the issue:</p>
<pre><code class="lang-ruby">module ActionController::HttpAuthentication::Token
  AUTHN_PAIR_DELIMITERS = /(?:,|;|\t)/
end
</code></pre>
<h2>
<a name="patches" class="anchor" href="#patches"></a>Patches</h2>
<p>To aid users who aren’t able to upgrade immediately we have provided patches for
the two supported release series. They are in git-am format and consist of a
single changeset.</p>
<ul>
<li>5-2-http-authentication-dos.patch - Patch for 5.2 series</li>
<li>6-0-http-authentication-dos.patch - Patch for 6.0 series</li>
<li>6-1-http-authentication-dos.patch - Patch for 6.1 series</li>
</ul>
<p>Please note that only the 6.1.Z, 6.0.Z, and 5.2.Z series are supported at
present. Users of earlier unsupported releases are advised to upgrade as soon
as possible as we cannot guarantee the continued availability of security
fixes for unsupported releases.</p>
<h2>
<a name="credits" class="anchor" href="#credits"></a>Credits</h2>
<p>Thank you to <a href="https://hackerone.com/wonda_tea_coffee" class="inline-onebox">HackerOne</a> for reporting this issue!</p>
<p><a class="attachment" href="/uploads/short-url/7HOig9iT2ceYqZOwvaQCm28bwqY.patch">6-1-http-authentication-dos.patch</a> (2.1 KB) <a class="attachment" href="/uploads/short-url/gwnS9XUZIwlE13MPmSR1317gitJ.patch">6-0-http-authentication-dos.patch</a> (2.1 KB) <a class="attachment" href="/uploads/short-url/4mcMlTWKyAsoU8VUArnfJPm2NnQ.patch">5-2-http-authentication-dos.patch</a> (2.1 KB)</p>
        </div>

        <meta itemprop='headline' content='[CVE-2021-22904] Possible DoS Vulnerability in Action Controller Token Authentication'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="9" />
           <span class='post-likes'>9 Likes</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    <div class="custom-footer">
  <img src="https://rubyonrails.org/images/more.png" alt="More Resources">
  <p>Keep up to date with <a href="https://twitter.com/rails">Rails on Twitter</a> and <a href="https://rails-weekly.ongoodbits.com">This Week in Rails</a></p>
  <p><small>Policies: <a href="https://rubyonrails.org/conduct">Conduct</a>, <a href="http://opensource.org/licenses/MIT">License</a>, <a href="https://rubyonrails.org/maintenance">Maintenance</a>, <a href="https://rubyonrails.org/security">Security</a>, <a href="https://rubyonrails.org/trademarks">Trademarks</a></small></p>
</div>

    
  </body>
  
</html>
