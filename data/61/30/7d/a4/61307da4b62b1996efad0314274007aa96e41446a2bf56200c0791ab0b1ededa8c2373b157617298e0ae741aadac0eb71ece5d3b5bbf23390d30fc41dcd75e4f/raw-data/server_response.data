<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 1181050 &ndash; VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://bugzilla.suse.com/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=1181050&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=1181050">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=1181050">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=1181050">



    
    <link href="skins/standard/global.css?1411227340"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="skins/standard/global.css?1411227340" rel="stylesheet"
            type="text/css" ><link href="skins/standard/show_bug.css?1416528352" rel="stylesheet"
            type="text/css" ><link href="extensions/Voting/web/style.css?1411227348" rel="stylesheet"
            type="text/css" ><!--[if lte IE 7]>
      


      <link href="skins/standard/IE-fixes.css?1411227340" rel="stylesheet"
            type="text/css" >
<![endif]-->

    <link href="skins/contrib/SUSE/global.css?1411227340" rel="stylesheet"
            type="text/css" 
          title="SUSE">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1411227335"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1411227333"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1411227329"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1411227329"></script><script type="text/javascript" src="js/yui/json/json-min.js?1411227333"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1411227334"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1411227335"></script><script type="text/javascript" src="js/global.js?1411227336"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 1181050 – VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh",  
                             "show_bug.cgi?id=1181050" );
        document.title = "Bug 1181050 – VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 1181050 – VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1411227336"></script><script type="text/javascript" src="js/field.js?1414105521"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" ><link href="extensions/Testopia/css/testopia.css" rel="stylesheet" type="text/css">
    <link href="extensions/Testopia/extjs/examples/ux/css/RowEditor.css" rel="stylesheet" type="text/css"  />
    <script type="text/javascript">
        Testopia_user = {login: "", id: 0};
        DEFAULT_CASE_STATUS = 'CONFIRMED';
    </script>
  </head>



  <body onload=""
        class="bugzilla-suse-com bz_bug bz_status_NEW bz_product_SUSE_Security_Incidents bz_component_Audits bz_bug_1181050 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<!--div id="tmp_warning_wnd" style="
    position:fixed; 
    color:red; 
    font-size:20px; 
    top:50px; 
    left:10%; 
    right:10%; 
    padding:1em;
    background-color:#ffffff;
    border:3px solid red;
    z-index:9999;
    text-align:center;">
  This Bugzilla is for TESTING ONLY. All new bugs and comments WILL BE LOST. Use <a href="https://bugzilla.suse.com">bugzilla.suse.com</a> instead.
  <button style="
      background:none;
      border:0;
      box-shadow:none;
      color:red;
      text-shadow:none;
      position:absolute;
      right:0;
      top:0;" onclick="document.getElementById('tmp_warning_wnd').style.display='none';">[X]</button>
</div-->

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1181050</p>
    </td>

    <td id="subtitle">
      <p class="subheader">VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2021-07-08 09:15:07 UTC</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <!--a id="login_link_top" href="show_bug.cgi?id=1181050&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a-->
  <a id="login_link_top" href="show_bug.cgi?id=1181050&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1181050" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
</div> 

<div id="bugzilla-body">

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2021-07-08 09:15:07">
  <input type="hidden" name="longdesclength" value="17">
  <input type="hidden" name="id" value="1181050">
  <input type="hidden" name="token" value="1635630547-8Iz9cvVqt_i_hqgZdKYpg49rd9RbkAAHbHO3JxNkeDs">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=1181050"><b>Bug&nbsp;1181050</b></a> -<span id="summary_alias_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2021-32000</span>) 
      <span id="short_desc_nonedit_display">VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh</span>
     </span>  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">(CVE-2021-32000)
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=glossary.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td><span title="VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh">VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file syst...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('VUL-0: CVE-2021-32000: clone-master-clean-up: potentially dangerous file system operations in clone-master-clean-up.sh', 'CVE-2021-32000');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=status_resolution_matrix.html">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">NEW
      </span>
    </td>
  </tr>

          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
      </tr>

    
    
    
    <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >SUSE Security Incidents</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=SUSE Security Incidents"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Audits</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=glossary.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=glossary.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">Other
       Other
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority">
          <a href="page.cgi?id=glossary.html#priority">Priority</a></label>:
      </th>
      <td>P3 - Medium
        <label for="severity">
          <b>Severity</b></label>:
       Normal
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=glossary.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=glossary.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Egbert Eich</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">

    <label for="qa_contact" accesskey="q">

  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#qa_contact"
  >QA Contact:</a>
</label>
</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-team\x40suse.de',
        'security-team\x40suse.de');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=glossary.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=glossary.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    <a class="bz_bug_link 
          bz_status_IN_PROGRESS "
   title="IN_PROGRESS"
   href="show_bug.cgi?id=1180865">1180865</a> 
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=1181050&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=1181050">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2021-01-18 09:58 UTC by <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2021-07-08 09:15 UTC 
      (<a href="show_activity.cgi?id=1181050">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>4 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="abriel">abriel</option>
                <option value="eich">eich</option>
                <option value="matthias.gerstner">matthias.gerstner</option>
                <option value="security-team">security-team</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=glossary.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_foundby">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_foundby"
  >Found By:</a>

</th>
  <td class="field_value "
      id="field_container_cf_foundby"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_nts_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_nts_priority"
  >Services Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_nts_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_biz_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_biz_priority"
  >Business Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_biz_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_blocker">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_blocker"
  >Blocker:</a>

</th>
  <td class="field_value "
      id="field_container_cf_blocker"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_marketing_qa_status">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_marketing_qa_status"
  >Marketing QA Status:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_marketing_qa_status"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_it_deployment">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_it_deployment"
  >IT Deployment:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_it_deployment"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         <ul>
    <li><a href="tr_new_case.cgi?product=SUSE%20Security%20Incidents&bug=1181050">Create test case</a></li>
</ul><ul>
  <li><a href="enter_bug.cgi?cloned_bug_id=1181050">Clone This Bug</a></li>
</ul>
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=1181050&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=1181050&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1411227336" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-18 09:58:36 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Looking at openSUSE:Factory/clone-master-clean-up/clone-master-clean-up.sh I
stumbled upon potentially dangerous file system operations.

line 49:

```
rm -rf /etc/ssh/ssh_host*key* /root/.ssh/* /home/*/.ssh/* /home/*/.*_history &amp;&gt; /dev/null
```

In any unprivileged user with a home directory places a symlink like:

    /home/evil/.ssh -&gt; /

then the whole file system would be deleted.

Some other locations are owned by unprivileged accounts like:

line 56:

```
rm -rf /var/spool/postfix/{active,corrupt,deferred,hold,maildrop,saved,bounce,defer,flush,incoming,trace}/*
```

These directories are owned by the 'postfix' user. If compromised this could
also be used as an attacker vector.

Also some log files or log directories are owned by non-privileged accounts,
so line 62:

```
find /var/log -type f -exec truncate -s 0 {} \;
```

could also possibly follow symlinks, when race conditions are exploited.

I realize that a partially compromised system being used as a master clone
image is a problem in the first place. But maybe some of these operations can
be made more security aware anyway.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-18 10:43:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Before we play a guessing game again, any suggestion how to do this securely?</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-18 11:45:29 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1181050#c0">comment #0</a>)
<span class="quote">&gt; Looking at openSUSE:Factory/clone-master-clean-up/clone-master-clean-up.sh I
&gt; stumbled upon potentially dangerous file system operations.
&gt; 
&gt; line 49:
&gt; 
&gt; ```
&gt; rm -rf /etc/ssh/ssh_host*key* /root/.ssh/* /home/*/.ssh/* /home/*/.*_history
&gt; &amp;&gt; /dev/null
&gt; ```
&gt; 
&gt; In any unprivileged user with a home directory places a symlink like:
&gt; 
&gt;     /home/evil/.ssh -&gt; /
&gt; 
&gt; then the whole file system would be deleted.</span >

Removing anything under /home is probably a bad idea anyway:
A system with active homes should probably not be cloned. If it is done anyway it is probably not good to remove people's ssh keys.
The only valid use case would be to clone a freshly installed system on which the installation has created a single user. This user would not have any ssh keys set.
Maybe we should check for a populated /home and warn the user.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-18 12:25:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1181050#c0">comment #0</a>)

<span class="quote">&gt; rm -rf
&gt; /var/spool/postfix/{active,corrupt,deferred,hold,maildrop,saved,bounce,defer,
&gt; flush,incoming,trace}/*</span >

How about:

for i in /var/spool/postfix/{active,corrupt,deferred,hold,maildrop,saved,bounce,defer,flush,incoming,trace}; do 
   # descend following symlink and check if it was symlink, if not, recursively delete entries in this directory. 'rm -rf' doesn't follow symlinks. 
   cd -P $i
   [ &quot;$i&quot; = &quot;${pwd}&quot; ] &amp;&amp; find -maxdepth 1 ! -name . -print0 | xargs -0 rm -rf
done</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-19 10:58:07 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Egbert Eich from <a href="show_bug.cgi?id=1181050#c3">comment #3</a>)
<span class="quote">&gt; (In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1181050#c0">comment #0</a>)
&gt; 
&gt; &gt; rm -rf
&gt; &gt; /var/spool/postfix/{active,corrupt,deferred,hold,maildrop,saved,bounce,defer,
&gt; &gt; flush,incoming,trace}/*
&gt; 
&gt; How about:
&gt; 
&gt; for i in
&gt; /var/spool/postfix/{active,corrupt,deferred,hold,maildrop,saved,bounce,defer,
&gt; flush,incoming,trace}; do 
&gt;    # descend following symlink and check if it was symlink, if not,
&gt; recursively delete entries in this directory. 'rm -rf' doesn't follow
&gt; symlinks. 
&gt;    cd -P $i
&gt;    [ &quot;$i&quot; = &quot;${pwd}&quot; ] &amp;&amp; find -maxdepth 1 ! -name . -print0 | xargs -0 rm
&gt; -rf
&gt; done</span >

This goes in the right direction. Maybe replacing the `find` pipeline by a `rm -rf *` would be even better. `rm` should be safe against symlink race conditions in its recursion logic. It only is a problem if a command line argument is already a symlink like `rm somelink/*`.

The most orubst approach actually would be using `sudo`, `su` or `setpriv` to change to the uid/gid that owns the directory tree.</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-22 12:08:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ok, thanks!

Regarding:

<span class="quote">&gt; Also some log files or log directories are owned by non-privileged accounts,
&gt; so line 62:
&gt; 
&gt; ```
&gt; find /var/log -type f -exec truncate -s 0 {} \;
&gt; ```</span >

I'd suggest something like this:
while IFS= read -r -d $'\0' file; do
   d=$(dirname $file);
   u=$(stat --printf=&quot;%u&quot; %d);
   f=$(basename $file);
   t=$(mktemp -d $d/tmp-XXXXXXXXX) || continue;
   mv $file $t
   if ! test -h $t/$f || ! setpriv --ruid $u truncate -s 0 $t/$f ; then
      setpriv --ruid $u rm $t/$f &amp;&amp; setpriv --ruid $u touch $t/$f
   fi
   mv $t/$f $file
   rmdir $t
done &lt; &lt;(find /var/log -type f -print0)</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-22 12:09:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Setting to needinfo for Matthias - see above comment.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-01-25 12:10:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Egbert Eich from <a href="show_bug.cgi?id=1181050#c5">comment #5</a>)
<span class="quote">&gt; I'd suggest something like this:
&gt; while IFS= read -r -d $'\0' file; do
&gt;    d=$(dirname $file);
&gt;    u=$(stat --printf=&quot;%u&quot; %d);
&gt;    f=$(basename $file);
&gt;    t=$(mktemp -d $d/tmp-XXXXXXXXX) || continue;
&gt;    mv $file $t
&gt;    if ! test -h $t/$f || ! setpriv --ruid $u truncate -s 0 $t/$f ; then
&gt;       setpriv --ruid $u rm $t/$f &amp;&amp; setpriv --ruid $u touch $t/$f
&gt;    fi
&gt;    mv $t/$f $file
&gt;    rmdir $t
&gt; done &lt; &lt;(find /var/log -type f -print0)</span >

Hmm I find the approach with the temporary directory a bit confusing. Also if more deeply nested directories exist (like /var/log/nginx/some-sub-dir) then this could still have issues.

Doing this in bash is not pretty, sadly. How about that:

```
while IFS= read -r -d $'\0' dir; do
	cd -P &quot;$dir&quot;
	# not the expected directory (symlink involved?), skip over this
	[ &quot;$PWD&quot; != &quot;$dir&quot; ] &amp;&amp; continue
	info=( $(stat --printf=&quot;%u %g 0%a&quot; &quot;.&quot;) )
	owner=${info[0]}
	group=${info[1]}
	mode=${info[2]}

	rmuid=0
	rmgid=0

	if (( &quot;$group&quot; != 0 &amp;&amp; ($mode &amp; 0020) != 0 )); then
		rmuid=nobody
		rmgid=$group
	elif (( &quot;$owner&quot; != 0 )); then
		rmuid=$owner
		rmgid=nobody
	fi

	setpriv --clear-groups --reuid &quot;$rmuid&quot; --regid &quot;$rmgid&quot; find -maxdepth 1 -type f -print
done &lt; &lt;(find /var/log -type d -print0)
```</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Egbert Eich</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-03-26 09:04:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >&#64;Matthias, I don't think we are getting any closer to the goal ie securely truncating log files: if I'm not totally mistaken, the suggestion in <a href="show_bug.cgi?id=1181050#c7">comment #7</a> is doing nothing (it runs a find, but what does this do except printing output?).
Maybe, you've intended to run 'truncate' instead, however, I doubt that this will work on directory permissions if the file ownership/permission does not allow writing.

This addresses the symlink race condition issue only indirectly by allowing it to act only on files which have at least group modify rights for the group of the directory or owner modify rights for the owner, thus, it cannot affect anything owned by root.

The subdir mechanism suggested in <a href="show_bug.cgi?id=1181050#c6">comment #6</a> is to prevent any symlink race by virtue of the discussion in <a href="http://bugzilla.suse.com/show_bug.cgi?id=1155075">bsc#1155075</a>.
All this seems to be overkill as a system prepared for cloning should be 'well defined' ie the sysadmin needs to be sufficiently sure that
a. no users - neither legitimate nor malicious  are logged in
b. no unwanted processes and services are running (that would exploit a 
   symlink race).
If the sysadmin cannot rule out these with reasonable certainty, the issue is much larger than just a few truncated files that are system relevant.

I fear that the attempt to make this script more secure will cause it to do less.</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-03-29 08:52:01 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Egbert Eich from <a href="show_bug.cgi?id=1181050#c8">comment #8</a>)
<span class="quote">&gt; &#64;Matthias, I don't think we are getting any closer to the goal ie securely
&gt; truncating log files: if I'm not totally mistaken, the suggestion in comment
&gt; #7 is doing nothing (it runs a find, but what does this do except printing
&gt; output?).</span >

Probably remains of my testing, the `setpriv` call should of course perform some kind of deletion/truncation.

<span class="quote">&gt; Maybe, you've intended to run 'truncate' instead, however, I doubt that this
&gt; will work on directory permissions if the file ownership/permission does not
&gt; allow writing.</span >

Why should there be a logfile that doesn't allow writing by the user that has write permission on the containing directory? Such cases would be suspicious, security wise, I guess.
 
<span class="quote">&gt; This addresses the symlink race condition issue only indirectly by allowing
&gt; it to act only on files which have at least group modify rights for the
&gt; group of the directory or owner modify rights for the owner, thus, it cannot
&gt; affect anything owned by root.</span >

You mean when a directory has write-permission for somebody who is not root but it contains a logfile writable only by root?
 
<span class="quote">&gt; The subdir mechanism suggested in <a href="show_bug.cgi?id=1181050#c6">comment #6</a> is to prevent any symlink race
&gt; by virtue of the discussion in <a href="http://bugzilla.suse.com/show_bug.cgi?id=1155075">bsc#1155075</a>.</span >

If the temporary directory would be in a safe place then this would be fine, but putting it below potentially non-root controlled directories can be an issue again, especially when more deeply nested like I mentioned in <a href="show_bug.cgi?id=1181050#c7">comment 7</a>.

<span class="quote">&gt; All this seems to be overkill as a system prepared for cloning should be
&gt; 'well defined' ie the sysadmin needs to be sufficiently sure that
&gt; a. no users - neither legitimate nor malicious  are logged in
&gt; b. no unwanted processes and services are running (that would exploit a 
&gt;    symlink race).
&gt; If the sysadmin cannot rule out these with reasonable certainty, the issue
&gt; is much larger than just a few truncated files that are system relevant.
&gt; 
&gt; I fear that the attempt to make this script more secure will cause it to do
&gt; less.</span >

Yes the complexity is unfortunate and I know it is annoying. Still something like the .ssh symlink can be prepared long before any sysadmin runs this cleanup script, so it is not just a question about whether at the time of execution of the cleanup script any evil players are around in the system. So this /home bit should be addressed in any case like you already stated in <a href="show_bug.cgi?id=1181050#c2">comment 2</a>.

Symlinks in /var can in theory also be prepared ahead of time by compromised services. A discussion about whether this is realistic or not is tedious. Cloning a partially compromised system is always problematic, of course. On the other hand, when code like this accumulates then at some point we will have actual problems again. Another question is if something could go wrong by accident in the future e.g. when a service deliberately places a symlink in its /var directory.

If the precondition for this tool is that the admin is aware and the system is safe and sound then maybe it would help if the admin makes an informed decision e.g. by the tool printing a security note and a list of actions that will be executed when continuing.</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1181050#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-07-05 11:07:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please use CVE-2021-32000</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=1181050">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=1181050">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=1181050">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <!--a id="login_link_bottom" href="show_bug.cgi?id=1181050&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a-->
  <a id="login_link_bottom" href="show_bug.cgi?id=1181050&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1181050" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
  </li>

  
    


  <form id="testopia_helper_frm"></form><ul class="links">
    <li>Legal: </li>
    <li><a href="http://en.opensuse.org/Terms_of_site">openSUSE</a></li>
    <li><a href="https://www.suse.com/company/legal/">SUSE</a></li>
  </ul>
</ul>

  <div class="outro"></div>
</div>


</body>
</html>