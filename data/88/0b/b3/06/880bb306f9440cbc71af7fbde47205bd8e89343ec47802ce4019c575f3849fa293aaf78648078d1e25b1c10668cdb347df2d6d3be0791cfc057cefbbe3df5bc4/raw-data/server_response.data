<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1678233003: Don&#39;t focus the location bar in a phishy situation. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '51a9bc308241f3046321afacefd40b44';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1678233003%252526ust%25253D1608679072318450%252526usg%25253DAFQjCNHXiY1kIqO8jGoG8Y_VFLa6l_EfWw%26service%3Dah">Sign out</a>

</div>
<div class="counter">(193)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1678233003">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1678233003/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1678233003</a>:
    Don&#39;t focus the location bar in a phishy situation.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 10 months ago by <a href="/user/palmer" onMouseOver="M_showUserInfoPopup(this)">palmer</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 9 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <a href="/user/groby-ooo-7-16" onMouseOver="M_showUserInfoPopup(this)">groby-ooo-7-16</a>, <span class='approval'><a href="/user/Charlie%20Reis" onMouseOver="M_showUserInfoPopup(this)">Charlie Reis</a></span>, <span class='approval'><a href="/user/Peter%20Kasting" onMouseOver="M_showUserInfoPopup(this)">Peter Kasting</a></span>, <a href="/user/nasko" onMouseOver="M_showUserInfoPopup(this)">nasko</a>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, darin-cc_chromium.org, nasko+codewatch_chromium.org, jam, creis+watch_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Don't focus the location bar in a phishy situation.

There is logic to focus the location bar for editing if the URL is about:blank.
However, if the page transition type is PAGE_TRANSITION_LINK, bypass that logic;
it's not really a blank page. This avoids a phishy edge case with window.open.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=567445">567445</a>
Committed: <a href="https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63">https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63</a>
Cr-Commit-Position: refs/heads/master@{#379396}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1678233003/#ps1"
       onclick="M_toggleSectionForPS('1678233003', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 2
      
    </div>
  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1678233003/#ps20001"
       onclick="M_toggleSectionForPS('1678233003', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Take creis&#39; suggestion; useless sketch of a test.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1678233003/#ps40001"
       onclick="M_toggleSectionForPS('1678233003', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Test in chrome/.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 4
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1678233003/#ps60001"
       onclick="M_toggleSectionForPS('1678233003', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Make it a uitest.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 6
      
    </div>
  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1678233003/#ps80001"
       onclick="M_toggleSectionForPS('1678233003', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Wait for load in the WC returned by GetActiveWebContents
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 12
      
    </div>
  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1678233003/#ps100001"
       onclick="M_toggleSectionForPS('1678233003', '100001')"
       class="toggled-section opentriangle">
      Patch Set 6
      : Respond to comments. Thanks!
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 1
      
    </div>
  

  <div id="ps-100001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 9 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1678233003_100001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1678233003/100001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+46 lines, -2 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1678233003/patch/100001/110001">
            chrome/browser/ui/browser_focus_uitest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1678233003/diff/100001/chrome/browser/ui/browser_focus_uitest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1678233003/diff2/1:100001/chrome/browser/ui/browser_focus_uitest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1678233003/diff2/20001:100001/chrome/browser/ui/browser_focus_uitest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1678233003/diff2/40001:100001/chrome/browser/ui/browser_focus_uitest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1678233003/diff2/60001:100001/chrome/browser/ui/browser_focus_uitest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1678233003/diff2/80001:100001/chrome/browser/ui/browser_focus_uitest.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+25 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1678233003_100001_110001.diff"
             title="Download patch for chrome/browser/ui/browser_focus_uitest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1678233003/patch/100001/110002">
            content/browser/web_contents/web_contents_impl.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1678233003/diff/100001/content/browser/web_contents/web_contents_impl.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1678233003/diff2/1:100001/content/browser/web_contents/web_contents_impl.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1678233003/diff2/20001:100001/content/browser/web_contents/web_contents_impl.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1678233003/diff2/40001:100001/content/browser/web_contents/web_contents_impl.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1678233003/diff2/60001:100001/content/browser/web_contents/web_contents_impl.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1678233003/diff2/80001:100001/content/browser/web_contents/web_contents_impl.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+21 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          <b>
            1 comment
            
            
          </b>
        </td>
        <td>
          <a href="/download/issue1678233003_100001_110002.diff"
             title="Download patch for content/browser/web_contents/web_contents_impl.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 100001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 30 (8 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 30)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 30)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(30)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(30)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          palmer@chromium.org changed reviewers: + creis@chromium.org, nasko@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 04:05:32 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:palmer@chromium.org">palmer@chromium.org</a> changed reviewers:
+ <a href="mailto:creis@chromium.org">creis@chromium.org</a>, <a href="mailto:nasko@chromium.org">nasko@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          nasko or creis, could you please take a look?
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 04:05:32 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >nasko or creis, could you please take a look?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          The CQ bit was checked by palmer@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 04:05:44 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >The CQ bit was checked by <a href="mailto:palmer@chromium.org">palmer@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1678233003/1 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1678233003/1
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 04:09:17 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1678233003/1" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1678233003/1</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1678233003/1" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1678233003/1</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 05:15:45 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 05:15:46 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          Glad you&#39;re narrowing down the cause for this! That said, this doesn&#39;t look like the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:03:41 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >Glad you&#39;re narrowing down the cause for this!  That said, this doesn&#39;t look
like the right fix to me.  We shouldn&#39;t be depending on PageTransition for
security decisions in general, and this seems a few steps removed from the bug.

Let&#39;s try to understand a bit more of how the attack works, since I suspect it
involves cross-process navigations.  I&#39;ll see if I can take another look
tomorrow.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          New suggestion below, after investigating. Is it possible to add a test for this? The ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 05:47:48 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >New suggestion below, after investigating.

Is it possible to add a test for this?  The navigation part would be easy (run a
script in a page that does w=window.open(); w.opener=null; w.location.href=url).
 The interesting part is checking whether the omnibox has focus afterward.  Not
sure how easy that is.

<a href="https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/1/content/browser/web_content...</a>
File content/browser/web_contents/web_contents_impl.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc#newcode2920" rel="nofollow">https://codereview.chromium.org/1678233003/diff/1/content/browser/web_content...</a>
content/browser/web_contents/web_contents_impl.cc:2920: entry-&gt;GetURL() ==
GURL(url::kAboutBlankURL)) {
Here&#39;s what I would recommend (if we decide to keep the focus-about-blank logic
for startup):

// If we are starting at about:blank, give the omnibox focus to let the user
easily edit it.  We intentionally check the pending entry rather than the
visible one, since we don&#39;t want to be tricked by non-visible pending URLs.  See
<a href="https://crbug.com/567445" rel="nofollow">https://crbug.com/567445</a>.
NavigationEntryImpl* entry = controller_.GetPendingEntry();
if (controller_.IsInitialNavigation() &amp;&amp;
    entry &amp;&amp; !entry-&gt;is_renderer_initiated() &amp;&amp;
    entry-&gt;GetURL() == GURL(url::kAboutBlankURL)) {
...</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc File content/browser/web_contents/web_contents_impl.cc (right): https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc#newcode2920 content/browser/web_contents/web_contents_impl.cc:2920: entry-&gt;GetURL() == GURL(url::kAboutBlankURL)) { On 2016/02/10 05:47:48, Charlie Reis ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 23:15:25 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            ><a href="https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/1/content/browser/web_content...</a>
File content/browser/web_contents/web_contents_impl.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/1/content/browser/web_contents/web_contents_impl.cc#newcode2920" rel="nofollow">https://codereview.chromium.org/1678233003/diff/1/content/browser/web_content...</a>
content/browser/web_contents/web_contents_impl.cc:2920: entry-&gt;GetURL() ==
GURL(url::kAboutBlankURL)) {
On 2016/02/10 05:47:48, Charlie Reis wrote:
&gt; Here&#39;s what I would recommend (if we decide to keep the focus-about-blank
logic
&gt; for startup):
&gt; 
&gt; // If we are starting at about:blank, give the omnibox focus to let the user
&gt; easily edit it.  We intentionally check the pending entry rather than the
&gt; visible one, since we don&#39;t want to be tricked by non-visible pending URLs. 
See
&gt; <a href="https://crbug.com/567445" rel="nofollow">https://crbug.com/567445</a>.
&gt; NavigationEntryImpl* entry = controller_.GetPendingEntry();
&gt; if (controller_.IsInitialNavigation() &amp;&amp;
&gt;     entry &amp;&amp; !entry-&gt;is_renderer_initiated() &amp;&amp;
&gt;     entry-&gt;GetURL() == GURL(url::kAboutBlankURL)) {
&gt; ...

OK, I did that, and added a sketch of a test that tests nothing. :) Do you have
any clues about how I can make a test that does do something? Do I need to
migrate it to chrome browsertests, or is there some vestigial LocationBar in
content/ (doesn&#39;t look like it)?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          creis@chromium.org changed reviewers: + pkasting@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 00:22:23 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            ><a href="mailto:creis@chromium.org">creis@chromium.org</a> changed reviewers:
+ <a href="mailto:pkasting@chromium.org">pkasting@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          Good question about the test. It will need to be in the chrome/ layer to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 00:22:24 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >Good question about the test.  It will need to be in the chrome/ layer to be
meaningful, since the bug involves going out to OpenURLFromTab to get to
UpdateUIForNavigationInTab.  Maybe something like
browser_navigator_browsertest.cc?

We&#39;ll also want to check whether the location bar was given focus.  @pkasting,
can you recommend how to do that?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          OK, here&#39;s a test in chrome/. If ui_test_utils::IsViewFocused worked, I&#39;d be more sure that the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 01:15:54 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >OK, here&#39;s a test in chrome/. If ui_test_utils::IsViewFocused worked, I&#39;d be
more sure that the test was testing the right thing.

<a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_navigator_browsertest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc#newcode1450" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_navigator_browsertest.cc:1450:
ASSERT_FALSE(omnibox-&gt;IsEditingOrEmpty());
This test passes, but I&#39;m not 100% sure it&#39;s testing the right thing. Any clues?

<a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc#newcode1451" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_navigator_browsertest.cc:1451: //
ASSERT_TRUE(ui_test_utils::IsViewFocused(browser(), VIEW_ID_OMNIBOX));
This line causes the link to fail: No implementation available for the function
ui_test_utils::IsViewFocused. I&#39;m not sure why. Any clues?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc File chrome/browser/ui/browser_navigator_browsertest.cc (right): https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc#newcode1450 chrome/browser/ui/browser_navigator_browsertest.cc:1450: ASSERT_FALSE(omnibox-&gt;IsEditingOrEmpty()); On 2016/02/12 01:15:54, palmer wrote: &gt; This test ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 01:37:20 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            ><a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_navigator_browsertest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc#newcode1450" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_navigator_browsertest.cc:1450:
ASSERT_FALSE(omnibox-&gt;IsEditingOrEmpty());
On 2016/02/12 01:15:54, palmer wrote:
&gt; This test passes, but I&#39;m not 100% sure it&#39;s testing the right thing. Any
clues?

It&#39;s not.  Just focusing the omnibox does not set the state to editing.

<a href="https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/browser_navigator_browsertest.cc#newcode1451" rel="nofollow">https://codereview.chromium.org/1678233003/diff/40001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_navigator_browsertest.cc:1451: //
ASSERT_TRUE(ui_test_utils::IsViewFocused(browser(), VIEW_ID_OMNIBOX));
On 2016/02/12 01:15:54, palmer wrote:
&gt; This line causes the link to fail: No implementation available for the
function
&gt; ui_test_utils::IsViewFocused. I&#39;m not sure why. Any clues?

That&#39;s linked into the interactive_ui_tests target, whereas this is linked into
browser_tests.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          &gt; &gt; This line causes the link to fail: No implementation available for the &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 23:00:17 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >&gt; &gt; This line causes the link to fail: No implementation available for the
&gt; function
&gt; &gt; ui_test_utils::IsViewFocused. I&#39;m not sure why. Any clues?
&gt; 
&gt; That&#39;s linked into the interactive_ui_tests target, whereas this is linked
into
&gt; browser_tests.

Thank you. Fixed that. I think this works; the test fails without the change and
passes with it.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          On 2016/02/12 23:00:17, palmer wrote: &gt; &gt; &gt; This line causes the link to fail: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 23:43:47 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >On 2016/02/12 23:00:17, palmer wrote:
&gt; &gt; &gt; This line causes the link to fail: No implementation available for the
&gt; &gt; function
&gt; &gt; &gt; ui_test_utils::IsViewFocused. I&#39;m not sure why. Any clues?
&gt; &gt; 
&gt; &gt; That&#39;s linked into the interactive_ui_tests target, whereas this is linked
&gt; into
&gt; &gt; browser_tests.
&gt; 
&gt; Thank you. Fixed that. I think this works; the test fails without the change
and
&gt; passes with it.


Hmm, I&#39;m curious which way the test is failing without the fix, since it looks
like the test is looking at the wrong tab.  (Glad you&#39;re finding a way forward!)

I&#39;m in a meeting so I can&#39;t try it out myself right now.

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_focus_uitest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode759" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:759:
EXPECT_FALSE(web_contents-&gt;GetController().GetPendingEntry());
I don&#39;t think you don&#39;t need this line.  Technically there will be a pending
entry during the popup&#39;s navigation.

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode761" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:761: web_contents-&gt;GetVisibleURL());
Hmm, this isn&#39;t the WebContents where the spoof happens.  There&#39;s a separate
popup WebContents that we have to wait for (and wait for it to finish
navigating).

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode762" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:762:
EXPECT_FALSE(IsViewFocused(VIEW_ID_OMNIBOX));
Which window is this checking?  Is the test opening the popup in the same window
or a different one?  (I&#39;m not sure if you need the popup to be in a new window
for the attack to succeed.  If so, you might need to specify the size in the
window.open call.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          &gt; Hmm, I&#39;m curious which way the test is failing without the fix, since it ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 02:22:14 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >&gt; Hmm, I&#39;m curious which way the test is failing without the fix, since it looks
&gt; like the test is looking at the wrong tab.  (Glad you&#39;re finding a way
forward!)

[11452:11516:0216/173324:WARNING:embedded_test_server.cc(167)] Request not
handled. Returning 404: /favicon.ico
../../chrome/browser/ui/browser_focus_uitest.cc:762: Failure
Value of: IsViewFocused(VIEW_ID_OMNIBOX)
  Actual: true
Expected: false
[  FAILED  ] BrowserFocusTest.AboutBlankNavigationLocationTest, where TypeParam
=  and GetParam() =  (3373 ms)
[----------] 1 test from BrowserFocusTest (3373 ms total)

[----------] Global test environment tear-down
[==========] 1 test from 1 test case ran. (3374 ms total)
[  PASSED  ] 0 tests.
[  FAILED  ] 1 test, listed below:
[  FAILED  ] BrowserFocusTest.AboutBlankNavigationLocationTest, where TypeParam
=  and GetParam() = 

 1 FAILED TEST
[0216/173324:ERROR:kill_posix.cc(82)] Unable to terminate process group 11452:
No such process
[1/1] BrowserFocusTest.AboutBlankNavigationLocationTest (4195 ms)
1 test failed:
    BrowserFocusTest.AboutBlankNavigationLocationTest
(../../chrome/browser/ui/browser_focus_uitest.cc:742)

(I will address the other comments in a subsequent message)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc File chrome/browser/ui/browser_focus_uitest.cc (right): https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode759 chrome/browser/ui/browser_focus_uitest.cc:759: EXPECT_FALSE(web_contents-&gt;GetController().GetPendingEntry()); On 2016/02/12 23:43:47, Charlie Reis (catching up) wrote: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 00:37:59 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_focus_uitest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode759" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:759:
EXPECT_FALSE(web_contents-&gt;GetController().GetPendingEntry());
On 2016/02/12 23:43:47, Charlie Reis (catching up) wrote:
&gt; I don&#39;t think you don&#39;t need this line.  Technically there will be a pending
&gt; entry during the popup&#39;s navigation.

Done.

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode761" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:761: web_contents-&gt;GetVisibleURL());
On 2016/02/12 23:43:47, Charlie Reis (slow til Mar 7) wrote:
&gt; Hmm, this isn&#39;t the WebContents where the spoof happens.  There&#39;s a separate
&gt; popup WebContents that we have to wait for (and wait for it to finish
&gt; navigating).

Following the example of other code in this file, I added:

  ASSERT_NO_FATAL_FAILURE(content::WaitForLoadStop(
      browser()-&gt;tab_strip_model()-&gt;GetActiveWebContents()));

<a href="https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/browser_focus_uitest.cc#newcode762" rel="nofollow">https://codereview.chromium.org/1678233003/diff/60001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:762:
EXPECT_FALSE(IsViewFocused(VIEW_ID_OMNIBOX));
On 2016/02/12 23:43:47, Charlie Reis (slow til Mar 7) wrote:
&gt; Which window is this checking?  Is the test opening the popup in the same
window
&gt; or a different one?  (I&#39;m not sure if you need the popup to be in a new window
&gt; for the attack to succeed.  If so, you might need to specify the size in the
&gt; window.open call.)

I think the core problem is that the Omnibox is focused for editing, not so much
that it&#39;s a particular size. The size arguments in the example spoof 
seem to be just for tuning the attack to get the right text scrolled to the
leading-most edge. I could be wrong though.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          &gt; Following the example of other code in this file, I added: &gt; &gt; ASSERT_NO_FATAL_FAILURE(content::WaitForLoadStop( ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 00:54:08 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >&gt; Following the example of other code in this file, I added:
&gt; 
&gt;   ASSERT_NO_FATAL_FAILURE(content::WaitForLoadStop(
&gt;       browser()-&gt;tab_strip_model()-&gt;GetActiveWebContents()));

I should add that I&#39;m not entirely certain that&#39;s sufficient. (But the test does
continue to pass with it, and it seems to make sense to me.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          Sorry for the delay! (I&#39;ve been at an event all week.) LGTM. The fix looks ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-25 00:48:40 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >Sorry for the delay!  (I&#39;ve been at an event all week.)

LGTM.  The fix looks right, and the updated test seems to be doing the right
thing, to the extent I understand it.

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_focus_uitest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode763" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:763:
EXPECT_FALSE(IsViewFocused(VIEW_ID_OMNIBOX));
Sure, these lines look plausible to me, assuming the popup opens in the same
window.  (That&#39;s probably enough to repro the bug.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          pkasting, ping. :)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-03 01:40:11 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >pkasting, ping. :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          LGTM https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc File chrome/browser/ui/browser_focus_uitest.cc (right): https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode741 chrome/browser/ui/browser_focus_uitest.cc:741: // Ensure that crbug.com/567445 does not regress. Nit: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-03 21:02:19 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >LGTM

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_focus_uitest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode741" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:741: // Ensure that crbug.com/567445
does not regress.
Nit: Explain here what this is testing, e.g. &quot;Ensure the omnibox does not get
focused when loading about:blank in a case where it&#39;s not the startup URL, e.g.
when a page opens a popup to about:blank and then navigates it.  This is a
potential security issue; see comments in
WebContentsImpl::FocusLocationBarByDefault().&quot;

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode744" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:744:
embedded_test_server()-&gt;GetURL(&quot;/title1.html&quot;));
Nit: Store URL in a temp since you use it twice:

  const std::string url1(embedded_test_server()-&gt;GetURL(&quot;/title1.html&quot;));
  ui_test_utils::NavigateToURL(browser(), url1);
  ...
  EXPECT_EQ(url1, web_contents-&gt;GetVisibleURL());

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode747" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:747: &quot;var w =
window.open(&#39;about:blank&#39;);&quot;
Nit: Could go on previous line (and next two lines get indented even)

But even better would be this, which is shorter and simpler overall:

  const std::string url2(embedded_test_server()-&gt;GetURL(&quot;/title2.html&quot;).spec());
  const std::string spoof(&quot;var w = window.open(&#39;about:blank&#39;); w.opener = null;&quot;
                          &quot;w.document.location = &#39;&quot; + url2 + &quot;&#39;;&quot;);
  ...
  ASSERT_TRUE(content::ExecuteScript(web_contents, spoof));

(|url2| here is so named to parallel the suggestion above)

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode762" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:762:
browser()-&gt;tab_strip_model()-&gt;GetActiveWebContents()));
Is this different than |web_contents|?  If so I&#39;d add a comment about why, since
this seems subtle.

<a href="https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_contents/web_contents_impl.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_con...</a>
File content/browser/web_contents/web_contents_impl.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_contents/web_contents_impl.cc#newcode2938" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_con...</a>
content/browser/web_contents/web_contents_impl.cc:2938: // See
<a href="https://crbug.com/567445" rel="nofollow">https://crbug.com/567445</a>.
Nit: I&#39;d prefer to explain sufficiently inline that we don&#39;t need the bug
reference.  This way a reader doesn&#39;t need to go anywhere else to understand
this sufficiently.

Maybe something like this:

When the browser is started with about:blank as the startup URL, focus the
location bar (which will also select its contents) so users can simply begin
typing to navigate elsewhere.

We need to be careful not to trigger this for anything other than the startup
navigation.  In particular, if we allow an attacker to open a popup to
about:blank, then navigate, focusing the omnibox will cause the end of the new
URL to be scrolled into view instead of the start, allowing the attacker to
spoof other URLs.  The conditions checked here are all aimed at ensuring no such
attacker-controlled navigation can trigger this.

Note that we check the pending entry instead of the visible one; for the startup
URL case these are the same, but for the attacker-controlled navigation case the
visible entry is the committed &quot;about:blank&quot; URL and the pending entry is the
problematic navigation elsewhere.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc File chrome/browser/ui/browser_focus_uitest.cc (right): https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode741 chrome/browser/ui/browser_focus_uitest.cc:741: // Ensure that crbug.com/567445 does not regress. On 2016/03/03 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 22:15:57 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            ><a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
File chrome/browser/ui/browser_focus_uitest.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode741" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:741: // Ensure that crbug.com/567445
does not regress.
On 2016/03/03 21:02:18, Peter Kasting wrote:
&gt; Nit: Explain here what this is testing, e.g. &quot;Ensure the omnibox does not get
&gt; focused when loading about:blank in a case where it&#39;s not the startup URL,
e.g.
&gt; when a page opens a popup to about:blank and then navigates it.  This is a
&gt; potential security issue; see comments in
&gt; WebContentsImpl::FocusLocationBarByDefault().&quot;

Done.

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode744" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:744:
embedded_test_server()-&gt;GetURL(&quot;/title1.html&quot;));
On 2016/03/03 21:02:18, Peter Kasting wrote:
&gt; Nit: Store URL in a temp since you use it twice:
&gt; 
&gt;   const std::string url1(embedded_test_server()-&gt;GetURL(&quot;/title1.html&quot;));
&gt;   ui_test_utils::NavigateToURL(browser(), url1);
&gt;   ...
&gt;   EXPECT_EQ(url1, web_contents-&gt;GetVisibleURL());

Done.

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode747" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:747: &quot;var w =
window.open(&#39;about:blank&#39;);&quot;
On 2016/03/03 21:02:18, Peter Kasting wrote:
&gt; Nit: Could go on previous line (and next two lines get indented even)
&gt; 
&gt; But even better would be this, which is shorter and simpler overall:
&gt; 
&gt;   const std::string
url2(embedded_test_server()-&gt;GetURL(&quot;/title2.html&quot;).spec());
&gt;   const std::string spoof(&quot;var w = window.open(&#39;about:blank&#39;); w.opener =
null;&quot;
&gt;                           &quot;w.document.location = &#39;&quot; + url2 + &quot;&#39;;&quot;);
&gt;   ...
&gt;   ASSERT_TRUE(content::ExecuteScript(web_contents, spoof));
&gt; 
&gt; (|url2| here is so named to parallel the suggestion above)

Done.

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode762" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:762:
browser()-&gt;tab_strip_model()-&gt;GetActiveWebContents()));
On 2016/03/03 21:02:18, Peter Kasting wrote:
&gt; Is this different than |web_contents|?  If so I&#39;d add a comment about why,
since
&gt; this seems subtle.

Yes, they are different; it&#39;s the newly-opened contents that has the
phishy-looking URL. I added a comment.

<a href="https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/browser_focus_uitest.cc#newcode763" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/chrome/browser/ui/brows...</a>
chrome/browser/ui/browser_focus_uitest.cc:763:
EXPECT_FALSE(IsViewFocused(VIEW_ID_OMNIBOX));
On 2016/02/25 00:48:40, Charlie Reis (OOO til Mar 7) wrote:
&gt; Sure, these lines look plausible to me, assuming the popup opens in the same
&gt; window.  (That&#39;s probably enough to repro the bug.)

Acknowledged.

<a href="https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_contents/web_contents_impl.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_con...</a>
File content/browser/web_contents/web_contents_impl.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_contents/web_contents_impl.cc#newcode2938" rel="nofollow">https://codereview.chromium.org/1678233003/diff/80001/content/browser/web_con...</a>
content/browser/web_contents/web_contents_impl.cc:2938: // See
<a href="https://crbug.com/567445" rel="nofollow">https://crbug.com/567445</a>.
On 2016/03/03 21:02:19, Peter Kasting wrote:
&gt; Nit: I&#39;d prefer to explain sufficiently inline that we don&#39;t need the bug
&gt; reference.  This way a reader doesn&#39;t need to go anywhere else to understand
&gt; this sufficiently.
&gt; 
&gt; Maybe something like this:
&gt; 
&gt; When the browser is started with about:blank as the startup URL, focus the
&gt; location bar (which will also select its contents) so users can simply begin
&gt; typing to navigate elsewhere.
&gt; 
&gt; We need to be careful not to trigger this for anything other than the startup
&gt; navigation.  In particular, if we allow an attacker to open a popup to
&gt; about:blank, then navigate, focusing the omnibox will cause the end of the new
&gt; URL to be scrolled into view instead of the start, allowing the attacker to
&gt; spoof other URLs.  The conditions checked here are all aimed at ensuring no
such
&gt; attacker-controlled navigation can trigger this.
&gt; 
&gt; Note that we check the pending entry instead of the visible one; for the
startup
&gt; URL case these are the same, but for the attacker-controlled navigation case
the
&gt; visible entry is the committed &quot;about:blank&quot; URL and the pending entry is the
&gt; problematic navigation elsewhere.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          The CQ bit was checked by palmer@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 22:24:28 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >The CQ bit was checked by <a href="mailto:palmer@chromium.org">palmer@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          The patchset sent to the CQ was uploaded after l-g-t-m from creis@chromium.org, pkasting@chromium.org Link to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 22:24:29 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:creis@chromium.org">creis@chromium.org</a>,
<a href="mailto:pkasting@chromium.org">pkasting@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1678233003/#ps100001" rel="nofollow">https://codereview.chromium.org/1678233003/#ps100001</a>
(title: &quot;Respond to comments. Thanks!&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1678233003/100001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1678233003/100001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 22:24:48 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1678233003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1678233003/100001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1678233003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1678233003/100001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          Committed patchset #6 (id:100001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 23:41:36 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-25"
            >Committed patchset #6 (id:100001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          Description was changed from ========== Don&#39;t focus the location bar in a phishy situation. There ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 23:43:46 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-26"
            >Description was changed from

==========
Don&#39;t focus the location bar in a phishy situation.

There is logic to focus the location bar for editing if the URL is about:blank.
However, if the page transition type is PAGE_TRANSITION_LINK, bypass that logic;
it&#39;s not really a blank page. This avoids a phishy edge case with window.open.

BUG=567445
==========

to

==========
Don&#39;t focus the location bar in a phishy situation.

There is logic to focus the location bar for editing if the URL is about:blank.
However, if the page transition type is PAGE_TRANSITION_LINK, bypass that logic;
it&#39;s not really a blank page. This avoids a phishy edge case with window.open.

BUG=567445

Committed: <a href="https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63" rel="nofollow">https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63</a>
Cr-Commit-Position: refs/heads/master@{#379396}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          Patchset 6 (id:??) landed as https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63 Cr-Commit-Position: refs/heads/master@{#379396}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-04 23:43:48 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-27"
            >Patchset 6 (id:??) landed as
<a href="https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63" rel="nofollow">https://crrev.com/c70cb1fe9303df33b11187d0f5f60d22938e6e63</a>
Cr-Commit-Position: refs/heads/master@{#379396}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>groby-ooo-7-16</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          groby@chromium.org changed reviewers: + groby@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-07 20:00:36 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-28"
            ><a href="mailto:groby@chromium.org">groby@chromium.org</a> changed reviewers:
+ <a href="mailto:groby@chromium.org">groby@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>groby-ooo-7-16</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-29">
                          https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_contents/web_contents_impl.cc File content/browser/web_contents/web_contents_impl.cc (right): https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_contents/web_contents_impl.cc#newcode2952 content/browser/web_contents/web_contents_impl.cc:2952: // the pending entry is the problematic navigation elsewhere. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-07 20:00:37 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-29"
            ><a href="https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_contents/web_contents_impl.cc" rel="nofollow">https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_co...</a>
File content/browser/web_contents/web_contents_impl.cc (right):

<a href="https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_contents/web_contents_impl.cc#newcode2952" rel="nofollow">https://codereview.chromium.org/1678233003/diff/100001/content/browser/web_co...</a>
content/browser/web_contents/web_contents_impl.cc:2952: // the pending entry is
the problematic navigation elsewhere.
Thank you, thank you, thank you!

Future Rachel is immensely grateful for this comment! (Because 6 months hence,
I&#39;ll have no idea why this is here otherwise :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 30)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 30)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(30)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(30)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 30;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1678233003;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1678233003: Don&#39;t focus the location bar in a phishy situation.
     (Closed) </b><br/>
      Created 4 years, 10 months ago by palmer<br/>
      Modified 4 years, 9 months ago<br/>
      Reviewers: nasko, Charlie Reis, Peter Kasting, groby-ooo-7-16<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 25
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
