<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps | Flanker Sky</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="https://blog.flanker017.me/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="https://blog.flanker017.me/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel='dns-prefetch' href='//v0.wordpress.com' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel='dns-prefetch' href='//i0.wp.com' />
<link rel='dns-prefetch' href='//i1.wp.com' />
<link rel='dns-prefetch' href='//i2.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Flanker Sky &raquo; Feed" href="https://blog.flanker017.me/feed/" />
<link rel="alternate" type="application/rss+xml" title="Flanker Sky &raquo; Comments Feed" href="https://blog.flanker017.me/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Flanker Sky &raquo; CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps Comments Feed" href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/feed/" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.1\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.flanker017.me\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.7.3"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://c0.wp.com/c/5.7.3/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='wp-block-library-theme-css'  href='https://c0.wp.com/c/5.7.3/wp-includes/css/dist/block-library/theme.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='https://blog.flanker017.me/wp-content/themes/twentytwelve/style.css?ver=5.7.3' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-block-style-css'  href='https://blog.flanker017.me/wp-content/themes/twentytwelve/css/blocks.css?ver=20181018' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='https://blog.flanker017.me/wp-content/themes/twentytwelve/css/ie.css?ver=20121010' type='text/css' media='all' />
<![endif]-->
<link rel='stylesheet' id='social-logos-css'  href='https://c0.wp.com/p/jetpack/9.7.1/_inc/social-logos/social-logos.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_css-css'  href='https://c0.wp.com/p/jetpack/9.7.1/css/jetpack.css' type='text/css' media='all' />
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/jquery/jquery.min.js' id='jquery-core-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/jquery/jquery-migrate.min.js' id='jquery-migrate-js'></script>
<link rel="https://api.w.org/" href="https://blog.flanker017.me/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.flanker017.me/wp-json/wp/v2/posts/677" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.flanker017.me/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.flanker017.me/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 5.7.3" />
<link rel="canonical" href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/" />
<link rel='shortlink' href='https://wp.me/p4wP0T-aV' />
<link rel="alternate" type="application/json+oembed" href="https://blog.flanker017.me/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.flanker017.me%2Fcve-2017-2416-gif-remote-exec%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.flanker017.me/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.flanker017.me%2Fcve-2017-2416-gif-remote-exec%2F&#038;format=xml" />
<style type='text/css'>img#wpstats{display:none}</style>
		<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>			<style type="text/css">
				/* If html does not have either class, do not show lazy loaded images. */
				html:not( .jetpack-lazy-images-js-enabled ):not( .js ) .jetpack-lazy-image {
					display: none;
				}
			</style>
			<script>
				document.documentElement.classList.add(
					'jetpack-lazy-images-js-enabled'
				);
			</script>
		
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps" />
<meta property="og:url" content="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/" />
<meta property="og:description" content="CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps ImageIO Available for: iPhone 5 and later, iPad 4th generation and later, iPod tou…" />
<meta property="article:published_time" content="2017-04-06T05:15:52+00:00" />
<meta property="article:modified_time" content="2019-05-28T14:04:37+00:00" />
<meta property="og:site_name" content="Flanker Sky" />
<meta property="og:image" content="https://blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png" />
<meta property="og:image:width" content="1690" />
<meta property="og:image:height" content="1326" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps" />
<meta name="twitter:image" content="https://blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
</head>

<body class="post-template-default single single-post postid-677 single-format-standard wp-embed-responsive single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="https://blog.flanker017.me/" title="Flanker Sky" rel="home">Flanker Sky</a></h1>
			<h2 class="site-description">About security and coding</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul>
<li ><a href="https://blog.flanker017.me/">Home</a></li><li class="page_item page-item-442"><a href="https://blog.flanker017.me/an-online-source-browsing-site/">An online source browsing site</a></li>
<li class="page_item page-item-568"><a href="https://blog.flanker017.me/contact-gpg/">Contact &amp; GPG</a></li>
<li class="page_item page-item-359"><a href="https://blog.flanker017.me/publications-presentations/">Publications &amp; Presentations</a></li>
<li class="page_item page-item-17"><a href="https://blog.flanker017.me/about-me/">关于我 &#038; My CVEs</a></li>
<li class="page_item page-item-601"><a href="https://blog.flanker017.me/%e5%be%ae%e4%bf%a1%e5%85%ac%e4%bc%97%e5%8f%b7%ef%bc%8c%e6%ac%a2%e8%bf%8e%e5%85%b3%e6%b3%a8/">微信公众号，欢迎关注</a></li>
</ul></div>
		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-677" class="post-677 post type-post status-publish format-standard hentry category-cve-writeup category-apple-security">
				<header class="entry-header">
			
						<h1 class="entry-title">CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps</h1>
										<div class="comments-link">
					<a href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/#comments">1 Reply</a>				</div><!-- .comments-link -->
					</header><!-- .entry-header -->

				<div class="entry-content">
			<h1>CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps</h1>
<blockquote><p>ImageIO Available for: iPhone 5 and later, iPad 4th generation and later, iPod touch 6th generation and later</p>
<p>Impact: Processing a maliciously crafted image may lead to arbitrary code execution</p>
<p>Description: A memory corruption issue was addressed through improved input validation.</p>
<p>CVE-2017-2416: flanker_hqd of KeenLab, Tencent</p></blockquote>
<h1>Abstract</h1>
<p>(For Chinese version of this writeup see https://blog.flanker017.me/cve-2017-2416-gif-rce-chn/)</p>
<p>Recently I&#8217;ve switched my main research focus back from Apple stuff to Android and browsers. While I was auditing a custom image parsing library written by some ppls, I transferred the test case image manipulated by 010editor via a popular IM messenger, and all of a sudden, the app crashed. I investigated the crash and found it is a issue in ImageIO library, and can be automatically triggered in all kinds of iOS/macOS apps that receives GIF images, especially the ones for instant messaging, such as <code>Signal, Telegram, Slack, iMessage</code> etc and Email clients such as <code>Mail, Outlook, Inbox, Gmail</code>, etc and even financial apps that want to be an IM such as <code>Alipay</code>. All these apps will crash on receiving the malicious GIF.</p>
<p>I haven&#8217;t test Twitter, but should you find a way to post the malformed GIF online (which I think can be done by manipulated the post stream to bypass the frontend filtering, but I was too busy to try that), the client should also crash as well.</p>
<p>What make things worse is that many clients will automatically reload and reparse the image on open, triggering the vulnerability again and again, lead to infinite loop and eliminating the need for attacker to persistent &#8211; -b</p>
<h1>DEMO video1</h1>
<p>The first video demonstrates receiving malformed gif file via iMessage lead to crash</p>
<div style="width: 625px;" class="wp-video"><!--[if lt IE 9]><script>document.createElement('video');</script><![endif]-->
<video class="wp-video-shortcode" id="video-677-1" width="625" height="352" preload="metadata" controls="controls"><source type="video/mp4" src="https://blog.flanker017.me/wp-content/uploads/2017/04/crash1.mp4?_=1" /><a href="https://blog.flanker017.me/wp-content/uploads/2017/04/crash1.mp4">https://blog.flanker017.me/wp-content/uploads/2017/04/crash1.mp4</a></video></div>
<h1>DEMO video2</h1>
<p>the second video demonstrates persistence (user cannot open iMessage anymore&#8230;)</p>
<div style="width: 625px;" class="wp-video"><video class="wp-video-shortcode" id="video-677-2" width="625" height="517" preload="metadata" controls="controls"><source type="video/mp4" src="https://blog.flanker017.me/wp-content/uploads/2017/04/crash123.m4v?_=2" /><a href="https://blog.flanker017.me/wp-content/uploads/2017/04/crash123.m4v">https://blog.flanker017.me/wp-content/uploads/2017/04/crash123.m4v</a></video></div>
<h1>Crash trace</h1>
<pre><code>* thread #1: tid = 0x17570, 0x00007fff9557f1ab ImageIO`IIOReadPlugin::IIOReadPlugin(CGImagePlus*, unsigned int, unsigned int, long long, unsigned char) + 67, queue = 'com.apple.main-thread', stop reason = EXC_BAD_ACCESS (code=EXC_I386_GPFLT)
    frame #0: 0x00007fff9557f1ab ImageIO`IIOReadPlugin::IIOReadPlugin(CGImagePlus*, unsigned int, unsigned int, long long, unsigned char) + 67
ImageIO`IIOReadPlugin::IIOReadPlugin:
-&gt;  0x7fff9557f1ab &lt;+67&gt;: mov    al, byte ptr [rdi + 0x40]
    0x7fff9557f1ae &lt;+70&gt;: mov    qword ptr [rbx + 0x20], rdi
    0x7fff9557f1b2 &lt;+74&gt;: mov    byte ptr [rbx + 0xc8], al
    0x7fff9557f1b8 &lt;+80&gt;: xor    eax, eax
Thread 0 Crashed:: Dispatch queue: com.apple.main-thread
0   com.apple.ImageIO.framework        0x00007fffa144d1ab IIOReadPlugin::IIOReadPlugin(CGImagePlus*, unsigned int, unsigned int, long long, unsigned char) + 67
1   com.apple.ImageIO.framework        0x00007fffa14b8c93 GIFReadPlugin::InitProc(CGImagePlugin*, unsigned long, unsigned long) + 59
2   com.apple.ImageIO.framework        0x00007fffa14177da IIOImageSource::makeImagePlus(unsigned long, __CFDictionary const*) + 252
3   com.apple.ImageIO.framework        0x00007fffa141918b IIOImageSource::getPropertiesAtIndexInternal(unsigned long, __CFDictionary const*) + 57
4   com.apple.ImageIO.framework        0x00007fffa141911c IIOImageSource::copyPropertiesAtIndex(unsigned long, __CFDictionary const*) + 98
5   com.apple.ImageIO.framework        0x00007fffa13f03ca CGImageSourceCopyPropertiesAtIndex + 181
6   com.apple.AppKit                   0x00007fff9cfdbcae +[NSBitmapImageRep _imagesWithData:hfsFileType:extension:zone:expandImageContentNow:includeAllReps:] + 543
7   com.apple.AppKit                   0x00007fff9cfdba68 +[NSBitmapImageRep _imageRepsWithData:hfsFileType:extension:expandImageContentNow:] + 93
8   com.apple.AppKit                   0x00007fff9d4bf08e -[NSImage _initWithData:fileType:hfsType:] + 479
</code></pre>
<p>Almost all image related functions on Apple platform calls down to <code>[NSImage _initWithData:fileType:hfsType:]</code>, and <code>IIOImageSource</code> dispatches image parsing to corresponding plugin based on signature detection (note: not based on file extension). This feature will be useful afterwards.</p>
<h1>Sample file to test if you&#8217;re vulnerable</h1>
<p>Test image sample:</p>
<p><a href="https://blog.flanker017.me/wp-content/uploads/2017/04/Stykz_Sample2.png">Sample PNG</a> <a href="https://blog.flanker017.me/wp-content/uploads/2017/04/Stykz_Sample2.gif">Sample GIF</a></p>
<p>Grab an image file and change the width/height field to both negative short whose unsigned form value larger than 0xff00. <a href="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?ssl=1"><img loading="lazy" class="alignnone size-full wp-image-692 jetpack-lazy-image" src="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=625%2C490&#038;ssl=1" alt width="625" height="490" data-recalc-dims="1" data-lazy-srcset="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?w=1690&amp;ssl=1 1690w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=300%2C235&amp;ssl=1 300w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=768%2C603&amp;ssl=1 768w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=1024%2C803&amp;ssl=1 1024w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?w=1250&amp;ssl=1 1250w" data-lazy-sizes="(max-width: 625px) 100vw, 625px" data-lazy-src="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=625%2C490&amp;is-pending-load=1#038;ssl=1" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"><noscript><img loading="lazy" class="alignnone size-full wp-image-692" src="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=625%2C490&#038;ssl=1" alt="" width="625" height="490" srcset="https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?w=1690&amp;ssl=1 1690w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=300%2C235&amp;ssl=1 300w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=768%2C603&amp;ssl=1 768w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?resize=1024%2C803&amp;ssl=1 1024w, https://i1.wp.com/blog.flanker017.me/wp-content/uploads/2017/04/Screen-Shot-2017-02-23-at-9.06.40-AM.png?w=1250&amp;ssl=1 1250w" sizes="(max-width: 625px) 100vw, 625px" data-recalc-dims="1" /></noscript></a></p>
<p>Drag it into /send to any macos/iOS application and if it crashes, you&#8217;re vulnerable.</p>
<h1>Analysis</h1>
<p>The root cause seems to be at GIFReadPlugin::init function, in the following decompiled snippet:</p>
<pre><code>  v32 = (signed __int16)width * (signed __int64)height;
  if ( v32 &gt; filesize * 1100 * v29 )
  {
    LOBYTE(aspectbyte) = 0;
    v15 = 0LL;
    if ( this-&gt;gapC0[8] )
    {
      LOBYTE(aspectbyte) = 0;
      LogError(
        "init",
        498,
        "malformed GIF file (%d x %d) - [canvasSize: %ld  fileSize: %ld   ratio: %d]  \n",
        (unsigned int)(signed __int16)width,
        (unsigned int)(height),    // width &gt;&gt; 16 is height
        (signed __int16)width * (signed __int64)SHIWORD(width),
        filesize,
        v32 / filesize);
      v15 = 0LL;
    }
    goto LABEL_71;
  }
__text:00000000000CC51F                 movsx   rax, r9w
__text:00000000000CC523                 mov     ecx, r9d
__text:00000000000CC526                 shr     ecx, 10h
__text:00000000000CC529                 movsx   rbx, cx
__text:00000000000CC52D                 imul    rbx, rax
__text:00000000000CC531                 imul    rdx, r12, 44Ch
__text:00000000000CC538                 mov     rax, rdx
__text:00000000000CC53B                 imul    rax, rsi
__text:00000000000CC53F                 cmp     rbx, rax
</code></pre>
<p>An attacker can craft an image of negative height and weight, thus bypassing the check comparing to file size, lead to following out-of-bound. As I have mentioned above, the dispatching is based on file signature rather than file extension. I noticed some applications&#8217; web interfaces have check on the size of GIF images, preventing me from spreading this POC to mobile apps. However they do not have check on PNG extension, allowing me to upload the malformed GIF image in PNG extension, bypassing the check and crashes whoever receives it.</p>
<p>While this does make sense, after Apple releases the fix I checked the new ImageIO binary and found the fix actually goes another way. Recall the crash happens in IIOReadPlugin::IIOReadPlugin, in the following pseudo code at 10.11.2/3:</p>
<pre><code>bool __fastcall IIOReadPlugin::IIOReadPlugin(IIOReadPlugin *a1, __int64 a2, int a3, int a4, __int64 a5, unsigned __int8 a6)
{
    unsigned __int8 v6; // r14@1
    IIOReadPlugin *this; // rbx@1
    __int64 v8; // rax@1
    __int64 sessionwrap; // rdi@1
    IIOImageReadSession *session; // rax@2
    IIOImageRead *v11; // rdi@2
    __int64 v12; // rax@2
    __int64 *v13; // rcx@5
    __int64 v14; // rdx@5
    bool result; // al@5
    v6 = a6;
    this = a1;
    a1-&gt;vt = (__int64)off_1659D0;
    a1-&gt;field_8 = a2;
    v8 = *(_QWORD *)(a2 + 24);
    a1-&gt;field_10 = v8;
    a1-&gt;field_38 = a3;
    a1-&gt;field_3c = a4;
    a1-&gt;field_30 = a5;
    sessionwrap = *(_QWORD *)(v8 + 24);
    if ( sessionwrap )
    {
        session = (IIOImageReadSession *)CGImageReadSessionGetSession(sessionwrap); //session is invalid
        this-&gt;session = session;
        v11 = (IIOImageRead *)session-&gt;imageread; //oob happens here and lead to crash
        LOBYTE(session) = v11-&gt;field_40;
        this-&gt;field_20 = (__int64)v11;
        this-&gt;field_c8 = (char)session;
        v12 = 0LL;
        if ( v11 )
            v12 = IIOImageRead::getSize(v11);
    }
    else
    {
        this-&gt;field_20 = 0LL;
        this-&gt;session = 0LL;
        this-&gt;field_c8 = 1;
        v12 = 0LL;
    }
 And now apple changes the if-block in 10.12.4:
  a1-&gt;field_8 = cgimgplus;
  imageplus = CGImagePlusGetIPlus(cgimgplus);
  a1-&gt;field_10 = imageplus;
  a1-&gt;field_38 = v9;
  a1-&gt;field_3c = v8;
  a1-&gt;field_30 = v7;
  v12 = *(_QWORD *)(imageplus + 32);
  a1-&gt;field_18 = v12;
  imageread = *(IIOImageRead **)(v12 + 32);
  if ( imageread )
  {
    v10-&gt;field_c8 = *((_BYTE *)imageread + 64);
    v10-&gt;field_20 = (__int64)imageread;
    v14 = IIOImageRead::getSize(imageread);
  }
  else
  {
    v10-&gt;field_c8 = 0;
    v10-&gt;field_20 = 0LL;
    v14 = 0LL;
  }
</code></pre>
<p>Removing the usage of IIOImageReadSession in this function. Is it better than fixing the size change? Dunno.</p>
<h1>Custom fix?</h1>
<p>For app developers who want to mitigate this issue for users staying at old versions, I suggest check for negative width and height before passing to NSImage.</p>
<p>I believe this vulnerability is introduced in iOS 10, so iOS 9/OSX 10.11 users are not affected (how many ppls are still using iOS9? Raise your hands). For iOS 10/macOS 10.12 users, please upgrade to 10.3/10.12.4 for the official fix.</p>
<h1>Timeline</h1>
<ul>
<li>2017.1.10 Initial discovery</li>
<li>2017.1.16 Report to Apple</li>
<li>2017.1.24 Apple responds on they are working on a fix</li>
<li>2017.3.23 CVE-2017-2416 assigned</li>
<li>2017.3.28 Advisory published at https://support.apple.com/en-us/HT207617</li>
<li>2017.4.6 Public disclosure</li>
</ul>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-677" class="share-twitter sd-button share-icon no-text" href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/?share=twitter" target="_blank" title="Click to share on Twitter"><span></span><span class="sharing-screen-reader-text">Click to share on Twitter (Opens in new window)</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-677" class="share-facebook sd-button share-icon no-text" href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/?share=facebook" target="_blank" title="Click to share on Facebook"><span></span><span class="sharing-screen-reader-text">Click to share on Facebook (Opens in new window)</span></a></li><li class="share-end"></li></ul></div></div></div>					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="https://blog.flanker017.me/category/cve-writeup/" rel="category tag">CVE writeup</a>, <a href="https://blog.flanker017.me/category/apple-security/" rel="category tag">macOS/iOS security</a> on <a href="https://blog.flanker017.me/cve-2017-2416-gif-remote-exec/" title="1:15 pm" rel="bookmark"><time class="entry-date" datetime="2017-04-06T13:15:52+08:00">April 6, 2017</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="https://blog.flanker017.me/author/flanker017/" title="View all posts by flanker017" rel="author">flanker017</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="https://blog.flanker017.me/the-disappearing-bluelight/" rel="prev"><span class="meta-nav">&larr;</span> 江湖夜话之消失的蓝光</a></span>
					<span class="nav-next"><a href="https://blog.flanker017.me/cve-2017-2416-gif-rce-chn/" rel="next">CVE-2017-2416 GIF表情引发的远程代码执行 <span class="meta-nav">&rarr;</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			One thought on &ldquo;<span>CVE-2017-2416 Remote code execution triggered by malformed GIF in ImageIO framework, affecting most iOS/macOS apps</span>&rdquo;		</h2>

		<ol class="commentlist">
				<li class="pingback even thread-even depth-1" id="comment-15210">
		<p>Pingback: <a href='https://zaufanatrzeciastrona.pl/post/weekendowa-lektura-2017-04-22-bierzcie-i-czytajcie/' rel='external nofollow ugc' class='url'>Weekendowa Lektura 2017-04-22 &#8211; bierzcie i czytajcie | Zaufana Trzecia Strona</a> </p>
	</li><!-- #comment-## -->
		</ol><!-- .commentlist -->

		
		
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/cve-2017-2416-gif-remote-exec/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://blog.flanker017.me/wp-comments-post.php" method="post" id="commentform" class="comment-form"><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="text" value="" size="30" maxlength="200" /></p>
<p class="comment-subscription-form"><input type="checkbox" name="subscribe_comments" id="subscribe_comments" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-label" for="subscribe_comments">Notify me of follow-up comments by email.</label></p><p class="comment-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto; -moz-appearance: checkbox; -webkit-appearance: checkbox;" /> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog">Notify me of new posts by email.</label></p><p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='677' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="3457f52d25" /></p><input type="hidden" id="ak_js" name="ak_js" value="206"/><textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100" style="display: none !important;"></textarea></form>	</div><!-- #respond -->
	
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


			<div id="secondary" class="widget-area" role="complementary">
			<aside id="search-2" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="https://blog.flanker017.me/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s" />
					<input type="submit" id="searchsubmit" value="Search" />
				</div>
			</form></aside>
		<aside id="recent-posts-2" class="widget widget_recent_entries">
		<h3 class="widget-title">Recent Posts</h3>
		<ul>
											<li>
					<a href="https://blog.flanker017.me/fuzzing%e6%88%98%e4%ba%89%e7%b3%bb%e5%88%97%e4%b9%8b%e4%ba%8c%ef%bc%9a%e4%b8%8d%e7%95%8f%e6%b5%ae%e4%ba%91%e9%81%ae%e6%9c%9b%e7%9c%bc/">Fuzzing战争系列之二：不畏浮云遮望眼</a>
									</li>
											<li>
					<a href="https://blog.flanker017.me/fuzzing%e6%88%98%e4%ba%89-%e4%bb%8e%e5%88%80%e5%89%91%e5%bc%93%e6%96%a7%e5%88%b0%e6%98%9f%e7%90%83%e5%a4%a7%e6%88%98/">Fuzzing战争: 从刀剑弓斧到星球大战</a>
									</li>
											<li>
					<a href="https://blog.flanker017.me/text-to-speech-speaks-pwned/">Text-To-Speech speaks pwned</a>
									</li>
											<li>
					<a href="https://blog.flanker017.me/examining-and-exploiting-android-vendor-binder-services-part1/">Examining and exploiting android vendor binder services &#8211; part1</a>
									</li>
											<li>
					<a href="https://blog.flanker017.me/examining-and-exploiting-android-vendor-binder-services-part-1-cn/">Examining and exploiting android vendor binder services &#8211; part 1</a>
									</li>
					</ul>

		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h3 class="widget-title">Recent Comments</h3><ul id="recentcomments"><li class="recentcomments"><span class="comment-author-link">hurricane618</span> on <a href="https://blog.flanker017.me/fuzzing%e6%88%98%e4%ba%89%e7%b3%bb%e5%88%97%e4%b9%8b%e4%ba%8c%ef%bc%9a%e4%b8%8d%e7%95%8f%e6%b5%ae%e4%ba%91%e9%81%ae%e6%9c%9b%e7%9c%bc/#comment-34085">Fuzzing战争系列之二：不畏浮云遮望眼</a></li><li class="recentcomments"><span class="comment-author-link">flanker017</span> on <a href="https://blog.flanker017.me/text-to-speech-speaks-pwned/#comment-32279">Text-To-Speech speaks pwned</a></li><li class="recentcomments"><span class="comment-author-link">gandalf</span> on <a href="https://blog.flanker017.me/text-to-speech-speaks-pwned/#comment-25770">Text-To-Speech speaks pwned</a></li><li class="recentcomments"><span class="comment-author-link">lofiboy</span> on <a href="https://blog.flanker017.me/the-disappearing-bluelight/#comment-25235">江湖夜话之消失的蓝光</a></li><li class="recentcomments"><span class="comment-author-link">lola</span> on <a href="https://blog.flanker017.me/zz-%e9%9d%a2%e8%af%95%e4%b8%80%e5%b9%b4%e5%89%8d%e7%9a%84%e8%87%aa%e5%b7%b1/#comment-23684">zz-面试一年前的自己</a></li></ul></aside><aside id="archives-2" class="widget widget_archive"><h3 class="widget-title">Archives</h3>
			<ul>
					<li><a href='https://blog.flanker017.me/2021/01/'>January 2021</a></li>
	<li><a href='https://blog.flanker017.me/2020/05/'>May 2020</a></li>
	<li><a href='https://blog.flanker017.me/2019/11/'>November 2019</a></li>
	<li><a href='https://blog.flanker017.me/2019/10/'>October 2019</a></li>
	<li><a href='https://blog.flanker017.me/2019/08/'>August 2019</a></li>
	<li><a href='https://blog.flanker017.me/2019/05/'>May 2019</a></li>
	<li><a href='https://blog.flanker017.me/2017/09/'>September 2017</a></li>
	<li><a href='https://blog.flanker017.me/2017/04/'>April 2017</a></li>
	<li><a href='https://blog.flanker017.me/2017/02/'>February 2017</a></li>
	<li><a href='https://blog.flanker017.me/2017/01/'>January 2017</a></li>
	<li><a href='https://blog.flanker017.me/2016/09/'>September 2016</a></li>
	<li><a href='https://blog.flanker017.me/2016/08/'>August 2016</a></li>
	<li><a href='https://blog.flanker017.me/2016/06/'>June 2016</a></li>
	<li><a href='https://blog.flanker017.me/2016/01/'>January 2016</a></li>
	<li><a href='https://blog.flanker017.me/2015/12/'>December 2015</a></li>
	<li><a href='https://blog.flanker017.me/2015/11/'>November 2015</a></li>
	<li><a href='https://blog.flanker017.me/2015/08/'>August 2015</a></li>
	<li><a href='https://blog.flanker017.me/2015/06/'>June 2015</a></li>
	<li><a href='https://blog.flanker017.me/2015/05/'>May 2015</a></li>
	<li><a href='https://blog.flanker017.me/2015/03/'>March 2015</a></li>
	<li><a href='https://blog.flanker017.me/2014/09/'>September 2014</a></li>
	<li><a href='https://blog.flanker017.me/2014/06/'>June 2014</a></li>
	<li><a href='https://blog.flanker017.me/2014/04/'>April 2014</a></li>
	<li><a href='https://blog.flanker017.me/2014/01/'>January 2014</a></li>
	<li><a href='https://blog.flanker017.me/2013/12/'>December 2013</a></li>
	<li><a href='https://blog.flanker017.me/2012/10/'>October 2012</a></li>
	<li><a href='https://blog.flanker017.me/2012/01/'>January 2012</a></li>
	<li><a href='https://blog.flanker017.me/2011/10/'>October 2011</a></li>
	<li><a href='https://blog.flanker017.me/2011/09/'>September 2011</a></li>
	<li><a href='https://blog.flanker017.me/2011/08/'>August 2011</a></li>
	<li><a href='https://blog.flanker017.me/2011/07/'>July 2011</a></li>
			</ul>

			</aside><aside id="categories-2" class="widget widget_categories"><h3 class="widget-title">Categories</h3>
			<ul>
					<li class="cat-item cat-item-20"><a href="https://blog.flanker017.me/category/java/android/">Android</a>
</li>
	<li class="cat-item cat-item-2"><a href="https://blog.flanker017.me/category/cc/">C/C++</a>
</li>
	<li class="cat-item cat-item-3"><a href="https://blog.flanker017.me/category/cve-writeup/">CVE writeup</a>
</li>
	<li class="cat-item cat-item-4"><a href="https://blog.flanker017.me/category/hacking-tools/">Hacking Tools</a>
</li>
	<li class="cat-item cat-item-5"><a href="https://blog.flanker017.me/category/java/">Java</a>
</li>
	<li class="cat-item cat-item-6"><a href="https://blog.flanker017.me/category/linux/">Linux</a>
</li>
	<li class="cat-item cat-item-7"><a href="https://blog.flanker017.me/category/apple-security/">macOS/iOS security</a>
</li>
	<li class="cat-item cat-item-8"><a href="https://blog.flanker017.me/category/mobile-security/">mobile security</a>
</li>
	<li class="cat-item cat-item-9"><a href="https://blog.flanker017.me/category/pwn/">pwn</a>
</li>
	<li class="cat-item cat-item-22"><a href="https://blog.flanker017.me/category/python/pyqt/">PyQt</a>
</li>
	<li class="cat-item cat-item-10"><a href="https://blog.flanker017.me/category/python/">Python</a>
</li>
	<li class="cat-item cat-item-11"><a href="https://blog.flanker017.me/category/java/qt-jambi/">Qt-jambi</a>
</li>
	<li class="cat-item cat-item-1"><a href="https://blog.flanker017.me/category/uncategorized/">Uncategorized</a>
</li>
	<li class="cat-item cat-item-12"><a href="https://blog.flanker017.me/category/cc/windows-api/">Windows API</a>
</li>
	<li class="cat-item cat-item-13"><a href="https://blog.flanker017.me/category/xss/">xss</a>
</li>
	<li class="cat-item cat-item-14"><a href="https://blog.flanker017.me/category/%e5%bf%83%e6%83%85/">心情</a>
</li>
	<li class="cat-item cat-item-16"><a href="https://blog.flanker017.me/category/%e7%94%9f%e6%b4%bb/">生活</a>
</li>
	<li class="cat-item cat-item-17"><a href="https://blog.flanker017.me/category/%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af/">网络技术</a>
</li>
	<li class="cat-item cat-item-18"><a href="https://blog.flanker017.me/category/%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af/%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af-%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af/">网络技术</a>
</li>
	<li class="cat-item cat-item-19"><a href="https://blog.flanker017.me/category/%e7%bd%91%e7%bb%9c%e6%8a%80%e6%9c%af/%e7%bd%91%e9%a1%b5%e6%8a%80%e6%9c%af/">网页技术</a>
</li>
			</ul>

			</aside><aside id="meta-2" class="widget widget_meta"><h3 class="widget-title">Meta</h3>
		<ul>
						<li><a href="https://blog.flanker017.me/wp-login.php">Log in</a></li>
			<li><a href="https://blog.flanker017.me/feed/">Entries feed</a></li>
			<li><a href="https://blog.flanker017.me/comments/feed/">Comments feed</a></li>

			<li><a href="https://wordpress.org/">WordPress.org</a></li>
		</ul>

		</aside>		</div><!-- #secondary -->
		</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
									<a href="https://wordpress.org/" class="imprint" title="Semantic Personal Publishing Platform">
				Proudly powered by WordPress			</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->


	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/blog.flanker017.me\/cve-2017-2416-gif-remote-exec\/":677};
	</script>
				<link rel='stylesheet' id='mediaelement-css'  href='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css'  href='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<script type='text/javascript' src='https://c0.wp.com/p/jetpack/9.7.1/_inc/build/photon/photon.min.js' id='jetpack-photon-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/comment-reply.min.js' id='comment-reply-js'></script>
<script type='text/javascript' src='https://blog.flanker017.me/wp-content/themes/twentytwelve/js/navigation.js?ver=20140711' id='twentytwelve-navigation-js'></script>
<script type='text/javascript' src='https://blog.flanker017.me/wp-content/plugins/jetpack/vendor/automattic/jetpack-lazy-images/src/js/intersectionobserver-polyfill.min.js?ver=1.1.2' id='jetpack-lazy-images-polyfill-intersectionobserver-js'></script>
<script type='text/javascript' id='jetpack-lazy-images-js-extra'>
/* <![CDATA[ */
var jetpackLazyImagesL10n = {"loading_warning":"Images are still loading. Please cancel your print and try again."};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.flanker017.me/wp-content/plugins/jetpack/vendor/automattic/jetpack-lazy-images/src/js/lazy-images.min.js?ver=1.1.2' id='jetpack-lazy-images-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/wp-embed.min.js' id='wp-embed-js'></script>
<script type='text/javascript' id='mediaelement-core-js-before'>
var mejsL10n = {"language":"en","strings":{"mejs.download-file":"Download File","mejs.install-flash":"You are using a browser that does not have Flash player enabled or installed. Please turn on your Flash player plugin or download the latest version from https:\/\/get.adobe.com\/flashplayer\/","mejs.fullscreen":"Fullscreen","mejs.play":"Play","mejs.pause":"Pause","mejs.time-slider":"Time Slider","mejs.time-help-text":"Use Left\/Right Arrow keys to advance one second, Up\/Down arrows to advance ten seconds.","mejs.live-broadcast":"Live Broadcast","mejs.volume-help-text":"Use Up\/Down Arrow keys to increase or decrease volume.","mejs.unmute":"Unmute","mejs.mute":"Mute","mejs.volume-slider":"Volume Slider","mejs.video-player":"Video Player","mejs.audio-player":"Audio Player","mejs.captions-subtitles":"Captions\/Subtitles","mejs.captions-chapters":"Chapters","mejs.none":"None","mejs.afrikaans":"Afrikaans","mejs.albanian":"Albanian","mejs.arabic":"Arabic","mejs.belarusian":"Belarusian","mejs.bulgarian":"Bulgarian","mejs.catalan":"Catalan","mejs.chinese":"Chinese","mejs.chinese-simplified":"Chinese (Simplified)","mejs.chinese-traditional":"Chinese (Traditional)","mejs.croatian":"Croatian","mejs.czech":"Czech","mejs.danish":"Danish","mejs.dutch":"Dutch","mejs.english":"English","mejs.estonian":"Estonian","mejs.filipino":"Filipino","mejs.finnish":"Finnish","mejs.french":"French","mejs.galician":"Galician","mejs.german":"German","mejs.greek":"Greek","mejs.haitian-creole":"Haitian Creole","mejs.hebrew":"Hebrew","mejs.hindi":"Hindi","mejs.hungarian":"Hungarian","mejs.icelandic":"Icelandic","mejs.indonesian":"Indonesian","mejs.irish":"Irish","mejs.italian":"Italian","mejs.japanese":"Japanese","mejs.korean":"Korean","mejs.latvian":"Latvian","mejs.lithuanian":"Lithuanian","mejs.macedonian":"Macedonian","mejs.malay":"Malay","mejs.maltese":"Maltese","mejs.norwegian":"Norwegian","mejs.persian":"Persian","mejs.polish":"Polish","mejs.portuguese":"Portuguese","mejs.romanian":"Romanian","mejs.russian":"Russian","mejs.serbian":"Serbian","mejs.slovak":"Slovak","mejs.slovenian":"Slovenian","mejs.spanish":"Spanish","mejs.swahili":"Swahili","mejs.swedish":"Swedish","mejs.tagalog":"Tagalog","mejs.thai":"Thai","mejs.turkish":"Turkish","mejs.ukrainian":"Ukrainian","mejs.vietnamese":"Vietnamese","mejs.welsh":"Welsh","mejs.yiddish":"Yiddish"}};
</script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/mediaelement-and-player.min.js' id='mediaelement-core-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/mediaelement-migrate.min.js' id='mediaelement-migrate-js'></script>
<script type='text/javascript' id='mediaelement-js-extra'>
/* <![CDATA[ */
var _wpmejsSettings = {"pluginPath":"\/wp-includes\/js\/mediaelement\/","classPrefix":"mejs-","stretching":"responsive"};
/* ]]> */
</script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/wp-mediaelement.min.js' id='wp-mediaelement-js'></script>
<script type='text/javascript' src='https://c0.wp.com/c/5.7.3/wp-includes/js/mediaelement/renderers/vimeo.min.js' id='mediaelement-vimeo-js'></script>
<script async="async" type='text/javascript' src='https://blog.flanker017.me/wp-content/plugins/akismet/_inc/form.js?ver=4.1.9' id='akismet-form-js'></script>
<script type='text/javascript' id='sharing-js-js-extra'>
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type='text/javascript' src='https://c0.wp.com/p/jetpack/9.7.1/_inc/build/sharedaddy/sharing.min.js' id='sharing-js-js'></script>
<script type='text/javascript' id='sharing-js-js-after'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
<script src='https://stats.wp.com/e-202143.js' defer></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:9.7.1',blog:'66927939',post:'677',tz:'8',srv:'blog.flanker017.me'} ]);
	_stq.push([ 'clickTrackerInit', '66927939', '677' ]);
</script>
</body>
</html>