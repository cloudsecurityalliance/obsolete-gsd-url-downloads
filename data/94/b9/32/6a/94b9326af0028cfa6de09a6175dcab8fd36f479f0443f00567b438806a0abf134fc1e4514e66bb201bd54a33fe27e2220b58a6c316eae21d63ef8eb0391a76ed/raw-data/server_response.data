
<!DOCTYPE html>
<html>
  <head>
    <title>Akka Http 10.0.x / 10.1.x DoS vulnerability found | Akka</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="viewport" content="width=device-width" />

    <meta name="og:title" content="Akka Http 10.0.x / 10.1.x DoS vulnerability found">
    <meta name="og:description" content="Akka Http 10.0.x / 10.1.x DoS vulnerability found" >
    
    <meta name="og:image" content="https://akka.io/resources/images/social.png" >
    
    <meta name="og:url" content="https://akka.io/blog/news/2018/08/30/akka-http-dos-vulnerability-found">

    <meta name="twitter:title" content="Akka Http 10.0.x / 10.1.x DoS vulnerability found">
    <meta name="twitter:description" content="Akka Http 10.0.x / 10.1.x DoS vulnerability found" >

    
    <meta name="twitter:image" content="https://akka.io/resources/images/social.png" >
    
    <meta name="twitter:card" content="summary_large_image" >

    
    <link rel="shortcut icon"  href="/resources/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/resources/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/resources/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/resources/favicon-16x16.png">
    <link rel="manifest" href="/resources/manifest.json">
    <meta name="msapplication-TileImage" content="/resources/mstile-150x150.png">
    <meta name="msapplication-TileColor" content="#15a9ce">
    <!-- CSS -->
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="/resources/stylesheets/style.css?v=03" type="text/css" />
    <link href="/resources/stylesheets/styles/banner.css?v=04" type="text/css" rel="stylesheet" />
    <link href="/resources/stylesheets/styles/github.css" type="text/css" rel="stylesheet" />
    <!-- Blog feed -->
    <link rel="alternate" type="application/atom+xml" href="https://akka.io/atom.xml" />

    <!-- OneTrust Cookies Consent Notice start for akka.io -->
    <script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js"  type="text/javascript" charset="UTF-8" data-domain-script="28b912e7-09e9-43d5-91e4-3d1897044004"></script>
    <!-- OneTrust Cookies Consent Notice end for akka.io -->
    
    <!--Google Analytics & Google Tag Manager-->
    <script type="text/plain" class="optanon-category-2">
    
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-21117439-1']);
      _gaq.push(['_setDomainName', 'akka.io']);
      _gaq.push(['_trackPageview']);
    
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-KBJGH35');

    </script>
    <!--Marketo-->
    <script type="text/plain" class="optanon-category-3">
        (function() {
          var didInit = false;
          function initMunchkin() {
            if(didInit === false) {
              didInit = true;
              Munchkin.init('558-NCX-702', { 'asyncOnly': true, 'disableClickDelay': true });
            }
          }
          var s = document.createElement('script');
          s.type = 'text/javascript';
          s.src = '//munchkin.marketo.net/munchkin.js';
          s.onreadystatechange = function() {
            if (this.readyState == 'complete' || this.readyState == 'loaded') {
              initMunchkin();
            }
          };
          s.onload = initMunchkin;
          document.getElementsByTagName('head')[0].appendChild(s);
        })();
    </script>
</head>

<body class="post">

<div id="lightbend-banner" class="lightbend-banner akka full-width" data-category="OSS Lightbend Banner Impression" data-label="Akka Banner Impression">
	<div class="oss-wrapper">
		<div class="oss-brand">
			<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Lightbend Logo - Akka Banner" href="https://www.lightbend.com">
				<img class="lightbend-logo" src="/resources/images/banner-logos/lightbend-reverse.svg" alt="Lightbend" title="Lightbend">
			</a>
		</div>
		<div class="oss-ad no-drop-down">
			<nav id="lightbendRotator" class="lightbend-rotator">
				<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Akka Serverless Open Beta - Keep the data. Lose the database. Try now for free. [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-serverless">
					<strong>Akka Serverless Open Beta</strong> - Keep the data. Lose the database. Try now for free. <span class="akka-btn">Learn More</span>
				</a>
				<a class="oss-track-link-label" data-category="OSS Lightbend Banner Clicks" data-label="Promo Rotator - Using AWS or GCP? Simplify deployments with Akka Cloud Platform [Learn More] - Akka Banner" href="https://www.lightbend.com/akka-cloud-platform">
					<strong>Using AWS or GCP?</strong>&nbsp;&nbsp;Simplify deployments with Akka Cloud Platform. <span class="akka-btn">Learn More</span>
				</a>
			</nav>
		</div>
	</div>
</div>
<header>
  <div class="row">
    <a class="logo" href="/"><img class="svg-logo" src="/resources/images/akka_full_color.svg" /></a>

    <ul class="desktopHeaderNav desktop-only">
      <li><a href="/try-akka/">Try Akka</a></li>
<li><a href="/docs/">Documentation</a></li>
<li><a href="/blog/">Blog</a></li>
<li><a href="/get-involved/">Get Involved</a></li>
    </ul>

    <ul class="mobileHeaderNavButton">
      <li><a href="#mobileHeaderNav" id="go-to-navigation" class="mini-toggler ss-icons ss-rows"></a></li>
    </ul>

    <nav id="mobileHeaderNav" class="hidden">
      <ul>
        <li><a href="/try-akka/">Try Akka</a></li>
<li><a href="/docs/">Documentation</a></li>
<li><a href="/blog/">Blog</a></li>
<li><a href="/get-involved/">Get Involved</a></li>
      </ul>
    </nav>
  </div>
</header>
<section class="wrapper headerHero">
	<div class="row">
		<h1>News & Articles</h1>
		<a href="/blog/archive" class="btn mobile">Full archive</a>
	</div>
</section>

<section class="wrapper">
  <div class="row">
    <div class="ninecol">
      <div class="box selArticle">
        <div class="selArticleHeader">
          <div class="date">
            <p>August 30</p>
            <p>2018 </p>
          </div>
          <h1>Akka Http 10.0.x / 10.1.x DoS vulnerability found</h1>
        </div>
        <div class="selArticleContent">
          <p>Dear hakkers,</p>

<p>we want to inform you that a bug in Akka HTTP has been found that can be used as a Denial-Of-Service against Akka HTTP servers
when using <code class="language-plaintext highlighter-rouge">decodeRequest</code> and <code class="language-plaintext highlighter-rouge">decodeRequestWith</code> directives on Akka HTTP servers.</p>

<p>As the problem was shared publicly with us we want to give advance notice about it and provide a workaround until the release
of fixed versions of Akka HTTP.</p>

<p>Please subscribe to the <a href="https://groups.google.com/forum/#!forum/akka-security">akka-security</a> mailing list to be
notified promptly about future security issues.</p>

<p>When reporting security relevant information, please <a href="https://doc.akka.io/docs/akka-http/current/security.html#reporting-vulnerabilities">follow our guidelines</a>
for reporting vulnerabilities.</p>

<h2 id="description">Description</h2>

<p>Directives <code class="language-plaintext highlighter-rouge">decodeRequest</code> and <code class="language-plaintext highlighter-rouge">decodeRequestWith</code> which handle compressed request data don’t limit the amount of uncompressed
data flowing out of it. In combination with common request directives like <code class="language-plaintext highlighter-rouge">entity(as)</code>, <code class="language-plaintext highlighter-rouge">toStrict</code>, or <code class="language-plaintext highlighter-rouge">formField</code>, this can lead
to excessive memory usage ultimately leading to an out of memory situation when highly compressed data is received
(so-called “Zip Bomb”).</p>

<p>Any code that uses <code class="language-plaintext highlighter-rouge">decodeRequest</code> or <code class="language-plaintext highlighter-rouge">decodeRequestWith</code> is likely to be affected.</p>

<h2 id="workaround">Workaround</h2>

<p>Until we publish a fix that will limit the amount of memory by default, you can use this custom directive instead of
<code class="language-plaintext highlighter-rouge">decodeRequest</code> to guard against excessive decompressed data:</p>

<p>Scala:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">safeDecodeRequest</span><span class="o">(</span><span class="n">maxBytes</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span><span class="k">:</span> <span class="kt">Directive0</span> <span class="o">=</span>
 <span class="n">decodeRequest</span> <span class="o">&amp;</span> <span class="nf">mapRequest</span><span class="o">(</span><span class="nv">_</span><span class="o">.</span><span class="py">mapEntity</span> <span class="o">{</span>
   <span class="k">case</span> <span class="n">c</span><span class="k">:</span> <span class="kt">HttpEntity.Chunked</span> <span class="k">⇒</span> <span class="kt">c.copy</span><span class="o">(</span><span class="kt">chunks</span> <span class="o">=</span> <span class="kt">HttpEntity.limitableChunkSource</span><span class="o">(</span><span class="kt">c.chunks</span><span class="o">))</span>
   <span class="k">case</span> <span class="n">e</span>                     <span class="k">⇒</span> <span class="n">e</span>
 <span class="o">})</span> <span class="o">&amp;</span> <span class="nf">withSizeLimit</span><span class="o">(</span><span class="n">maxBytes</span><span class="o">)</span>
</code></pre></div></div>

<p>And replace all <code class="language-plaintext highlighter-rouge">decodeRequest </code> usages with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>safeDecodeRequest(maxDecompressedBytesToSupport)
</code></pre></div></div>

<p>Java:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nc">RequestEntity</span> <span class="nf">chunkedWithLimit</span><span class="o">(</span><span class="nc">RequestEntity</span> <span class="n">entity</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">entity</span><span class="o">.</span><span class="na">isChunked</span><span class="o">())</span>
      <span class="k">return</span>
        <span class="nc">HttpEntities</span><span class="o">.</span><span class="na">createChunked</span><span class="o">(</span>
          <span class="n">entity</span><span class="o">.</span><span class="na">getContentType</span><span class="o">(),</span>
          <span class="n">akka</span><span class="o">.</span><span class="na">http</span><span class="o">.</span><span class="na">scaladsl</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">HttpEntity</span><span class="o">.</span><span class="na">limitableByteSource</span><span class="o">(((</span><span class="nc">HttpEntity</span><span class="o">.</span><span class="na">Chunked</span><span class="o">)</span><span class="n">entity</span><span class="o">).</span><span class="na">getDataBytes</span><span class="o">().</span><span class="na">asScala</span><span class="o">()).</span><span class="na">asJava</span><span class="o">()</span>
        <span class="o">);</span>
    <span class="k">else</span>
      <span class="k">return</span> <span class="n">entity</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="nc">Route</span> <span class="nf">safeDecodeRequest</span><span class="o">(</span><span class="kt">long</span> <span class="n">maxBytes</span><span class="o">,</span> <span class="nc">Supplier</span><span class="o">&lt;</span><span class="nc">Route</span><span class="o">&gt;</span> <span class="n">inner</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span>
      <span class="nf">decodeRequest</span><span class="o">(()</span> <span class="o">-&gt;</span>
        <span class="n">mapRequest</span><span class="o">(</span><span class="n">req</span> <span class="o">-&gt;</span> <span class="n">req</span><span class="o">.</span><span class="na">withEntity</span><span class="o">(</span><span class="n">chunkedWithLimit</span><span class="o">(</span><span class="n">req</span><span class="o">.</span><span class="na">entity</span><span class="o">())),</span> <span class="o">()</span> <span class="o">-&gt;</span>
          <span class="n">withSizeLimit</span><span class="o">(</span><span class="n">maxBytes</span><span class="o">,</span> <span class="n">inner</span><span class="o">)</span>
        <span class="o">)</span>
      <span class="o">);</span>
  <span class="o">}</span>
</code></pre></div></div>

<p>And replace all <code class="language-plaintext highlighter-rouge">decodeRequest(innerRoute)</code> with</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>safeDecodeRequest(maxDecompressedBytesToSupport, innerRoute)
</code></pre></div></div>

<p>See https://gist.github.com/jrudolph/2be2e6fcde5f7f395b1dacdb6b70baf7 for full code including imports.</p>

<h2 id="severity">Severity</h2>

<p>The CVSS score of this vulnerability is 7.3 (High), based on vector
<a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:H/RL:W/RC:C">AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:N/A:H/E:H/RL:W/RC:C</a>.</p>

<p>Rationale for the score:</p>

<ul>
  <li>A:H: Server runs into OOM, so availability is highly affected.</li>
  <li>E:H: It’s relatively simple to exploit.</li>
</ul>

<h2 id="affected-versions">Affected Versions</h2>

<p>All released Akka HTTP versions are affected:</p>

<ul>
  <li>10.1.x &lt;= 10.1.4</li>
  <li>10.0.x &lt;= 10.0.13</li>
</ul>

<p>Not affected:</p>

<ul>
  <li>Play and Lagom applications, even though both are using Akka HTTP as their server backend, remain unaffected by this vulnerability. This is because they implement their own content length validations on top of the underlying models (by using <code class="language-plaintext highlighter-rouge">BodyParser</code>s).</li>
</ul>

<h2 id="fixed-versions">Fixed Versions</h2>

<p>We will release fixed versions as soon as possible.</p>

<p>Happy and safe hakking!</p>

<p>– The Akka Team</p>

        </div>
      </div>
    </div>
    <div class="threecol latestArticles">
    <a href="/blog/tags.html">All posts by tag</a>


    <h2>Latest news</h2>
    <ul>
        
        <li>
            <p>Oct 15 2021</p>
            <a href="/blog/news/2021/10/15/akka-2.6.17-released">Akka 2.6.17 Released</a>
        </li>
        
        <li>
            <p>Sep 14 2021</p>
            <a href="/blog/news/2021/09/14/akka-grpc-performance-improvement">Akka gRPC 2.1 performance improvement</a>
        </li>
        
        <li>
            <p>Aug 31 2021</p>
            <a href="/blog/news/2021/08/31/akka-grpc-2.1.0-released">Akka gRPC 2.1.0 Released</a>
        </li>
        
        <li>
            <p>Aug 19 2021</p>
            <a href="/blog/news/2021/08/19/akka-2.6.16-released">Akka 2.6.16 Released - including Durable State persistence</a>
        </li>
        
        <li>
            <p>Aug 05 2021</p>
            <a href="/blog/news/2021/08/05/akka-http-10.2.6-released">Akka HTTP 10.2.6 Released</a>
        </li>
        

        <li>
            <a href="/blog/news-archive.html">All news</a>
        </li>
    </ul>


    <h2>Latest articles</h2>
    <ul>
        
        <li>
            <p>Oct 27 2021</p>
            
            <a href="/blog/article/2021/10/27/akka-cluster-mtls">Securing Akka cluster communication in Kubernetes</a>
            
        </li>
        
        <li>
            <p>Sep 09 2019</p>
            
            <a href="/blog/article/2019/09/09/akka-family-builds">Akka family build infrastructure</a>
            
        </li>
        
        <li>
            <p>Apr 23 2019</p>
            
            <a href="/blog/article/2019/04/23/thanks-joe">Thanks, Joe</a>
            
        </li>
        
        <li>
            <p>Feb 12 2019</p>
            
            <a href="/blog/article/2019/02/12/streams-resource-safety">Streams and Resource Safety</a>
            
        </li>
        
        <li>
            <p>Feb 05 2019</p>
            
            <a href="/blog/article/2019/02/05/typed-supervision">Typed Supervision: why the changes?</a>
            
        </li>
        

        <li>
            <a href="/blog/article-archive.html">All articles</a>
        </li>
    </ul>
    <!-- <a href="/blog/archive.html" class="btn sec">Full archive</a> -->
    <h2>Latest external</h2>
    <ul>
        
        <li>
            <p>Jun 05 2020</p>
            
            <a href="/blog/external/2020/06/05/external-akka-cluster-dashboard">Akka Cluster Quickstart Dashboard</a>
            
        </li>
        
        <li>
            <p>Apr 27 2020</p>
            
            <a href="/blog/external/2020/04/27/external-akka-cluster-state">How To Distribute Application State with Akka Cluster</a>
            
        </li>
        
        <li>
            <p>Mar 24 2020</p>
            
            <a href="/blog/external/2020/03/24/external-tesla-virtual-power-plant">Tesla Virtual Power Plant</a>
            
        </li>
        
        <li>
            <p>Jan 26 2020</p>
            
            <a href="/blog/external/2020/01/26/external-alpakka-kafka-flow-control">How Alpakka Uses Flow Control Optimizations In Apache Kafka 2.4</a>
            
        </li>
        
        <li>
            <p>Nov 03 2019</p>
            
            <a href="/blog/external/2019/11/03/external-embracing-errors-in-distributed-systems">On Embracing Error in Distributed Software Systems</a>
            
        </li>
        

        <li>
            <a href="/blog/external-archive.html">All external</a>
        </li>
    </ul>


    


  
    
  



</div>
  </div>
</section>


<footer>
  <div class="row">
    <div class="eightcol">
      <div class="footerLinks">
        <ul>
          <h2>Akka</h2>
          <li><a class="bright" href="/docs/">Documentation</a></li>
          <li><a class="bright" href="https://github.com/akka/akka">Source Code</a></li>
          <li><a class="bright" href="/team/">Team</a></li>
          <li><a class="bright" href="https://www.lightbend.com/akka-platform#subscription">Lightbend Subscription</a></li>
        </ul>
        <ul>
          <h2>Contribute</h2>
          <li><a class="bright" href="https://www.lightbend.com/conduct">Lightbend Community Code of Conduct</a></li>
          <li><a class="bright" href="/get-involved/">Get Involved</a></li>
          <li><a class="bright" href="/community/">Community Projects</a></li>
          <li><a class="bright" href="https://discuss.akka.io/">Discuss Akka forums</a></li>
          <li><a class="bright" href="https://doc.akka.io/docs/akka/current/project/issue-tracking.html">Report a Bug</a></li>
        </ul>
      </div>
      <p class="legal">
        Akka is Open Source and available under the Apache 2 License.</br>
        &copy; 2011-2021 Lightbend, Inc. |
        <a class="bright" href="https://www.lightbend.com/legal/licenses" target="_blank">Licenses</a> |
        <a class="bright" href="https://www.lightbend.com/legal/terms" target="_blank">Terms</a> |
        <a class="bright" href="https://www.lightbend.com/legal/privacy" target="_blank">Privacy Policy</a> |
        <a class="bright" href="/cookie/">Cookie Listing</a> |
        <a class="bright optanon-toggle-display">Cookie Settings</a>
      </p>
    </div>
    <div class="fourcol">
      <img class="footerLogo desktop-only" src="/resources/images/akka_icon_reverse.svg" />
    </div>
  </div>
</footer>

  <!-- javascript -->
  <script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
  <script src="/resources/javascript/fastclick.js" type="text/javascript"></script>
  <!-- highlight js -->
  <script src="/resources/javascript/highlight.pack.js" type="text/javascript"></script>
  <!-- algolia search -->
  <script src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js" type="text/javascript"></script>
  <!-- copy-pasta support -->
  <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>

  <script src="/resources/javascript/akka-io.js?v=01" type="text/javascript"></script>

  <script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>

