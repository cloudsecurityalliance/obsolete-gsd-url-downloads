<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1113431 - (CVE-2015-2711) &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1113431">
<meta property="og:description"
      content="RESOLVED (averstak) in Firefox - General. Last updated 2015-09-29.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1113431 - (CVE-2015-2711) &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1113431&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1113431">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1113431">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/yui.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/global.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/util.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"comments\":{\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox38\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox37\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox36\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"}},\"flags\":{\"project\":{\"cf_fission_milestone\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_root_cause\":\"---\",\"cf_tracking_firefox_sumo\":\"---\"},\"tracking\":{\"cf_tracking_firefox36\":\"+\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox38\":\"+\",\"cf_tracking_firefox37\":\"+\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_status_firefox37\":\"wontfix\",\"cf_status_firefox39\":\"fixed\",\"cf_status_firefox95\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_status_firefox36\":\"wontfix\",\"cf_status_firefox38\":\"fixed\"}},\"types\":[\"tracking\"]}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1113431;
  BUGZILLA.bug_title = '1113431 - (CVE-2015-2711) \x3cmeta name=\"referrer\"\x3e is ignored for navigations from the context menu and via a middle-click';
  BUGZILLA.bug_summary = '\x3cmeta name=\"referrer\"\x3e is ignored for navigations from the context menu and via a middle-click';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1113431';
  BUGZILLA.bug_keywords = 'addon-compat, dev-doc-complete, privacy, sec-low',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/field.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/comments.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1113431">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1113431"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1113431 - (CVE-2015-2711) &amp;lt;meta name=&amp;quot;referrer&amp;quot;&amp;gt; is ignored for navigations from the context menu and via a middle-click">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="8rp26w0hIDp4pIs0t3iKDmrkaMqmJcOzGq6EL206OZuNxQzfD0XASVMw1WbboaLLHGv07RjSvqDs7jWW1OlUEL108jaPZiN3LfJah8I4jRnyHZOJhlXqCHbsbxilINkJJUWeNMgdg7ZAZaDsvR0LsMdGrugRFfXtmFbxJAqoOy4wMOWZDET7uNMoyzRtEqJzRzi0vPYe07nXEOHwJIZYW9HZqV7Ysg5iaw1CJAHFUHZC2WLNxFiCNtxHuA1fQggo">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1113431" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635622556-uk0hbceApo6ldFsBJN5jodRaRUqATr2dmo_w_GrXBgw">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1113431" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1113431" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1113431">Bug 1113431</a>
          <span class="edit-hide">(CVE-2015-2711)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2014-12-18 16:50 PST" data-time="1418950250">7 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2015-03-18 15:40 PDT" data-time="1426718405">7 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">&lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Firefox :: General, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Firefox" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Firefox
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Firefox</div>
            <div class="description">For bugs in  Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Core">Core</a> product. Bugs for developer tools (F12) should be filed in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools">DevTools</a> product.  (<a href="https://wiki.mozilla.org/Modules/All#Firefox">more info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Firefox&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Firefox"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Firefox"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Firefox&component=General#General" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">General
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Firefox :: General</div>
            <div class="description">For bugs in Firefox which do not fit into other more specific Firefox components</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Firefox&amp;component=General&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Firefox&amp;component=General&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Firefox&amp;component=General"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Firefox" data-component="General"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-version" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            Trunk

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            All

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            All

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_status_firefox37&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox38&quot;:&quot;fixed&quot;,&quot;cf_status_firefox36&quot;:&quot;wontfix&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_tracking_firefox36&quot;:&quot;+&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;Firefox 39&quot;,&quot;keywords&quot;:[&quot;addon-compat&quot;,&quot;dev-doc-complete&quot;,&quot;privacy&quot;,&quot;sec-low&quot;],&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_tracking_firefox38&quot;:&quot;+&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;flags&quot;:[{&quot;status&quot;:&quot;+&quot;,&quot;name&quot;:&quot;firefox-backlog&quot;},{&quot;status&quot;:&quot;+&quot;,&quot;name&quot;:&quot;in-testsuite&quot;}],&quot;cf_status_firefox39&quot;:&quot;fixed&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;id&quot;:1113431,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;priority&quot;:&quot;--&quot;,&quot;cf_tracking_firefox37&quot;:&quot;+&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            Firefox 39

        </span>
    </div>

  
</div>

    <div class="field" id="field-cf_fx_iteration"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            39.2 - 23 Mar

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox36</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox37</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox37&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox38</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox38&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox39</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox36</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox36-dirty">
  <select id="cf_tracking_firefox36" name="cf_tracking_firefox36">
        <option value="+"
          id="v1948_cf_tracking_firefox36" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox36-dirty">
  <select id="cf_status_firefox36" name="cf_status_firefox36">
        <option value="wontfix"
          id="v1955_cf_status_firefox36" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox37</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox37-dirty">
  <select id="cf_tracking_firefox37" name="cf_tracking_firefox37">
        <option value="+"
          id="v1997_cf_tracking_firefox37" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox37-dirty">
  <select id="cf_status_firefox37" name="cf_status_firefox37">
        <option value="wontfix"
          id="v1991_cf_status_firefox37" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox38</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox38-dirty">
  <select id="cf_tracking_firefox38" name="cf_tracking_firefox38">
        <option value="+"
          id="v2086_cf_tracking_firefox38" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox38-dirty">
  <select id="cf_status_firefox38" name="cf_status_firefox38">
        <option value="fixed"
          id="v2092_cf_status_firefox38" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox39</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox39-dirty">
  <select id="cf_status_firefox39" name="cf_status_firefox39">
        <option value="fixed"
          id="v2163_cf_status_firefox39" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: averstak, Assigned: averstak)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=526840" > <span class="fna">averstak</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=526840" > <span class="fna">averstak</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_91159" ><img src="https://secure.gravatar.com/avatar/8f56e46f0120d9477f8f320991a2196a?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=91159" > <span class="fna">mossop</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="23">23 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
          <h3 class="module-subtitle" id="module-references-subtitle">
            (Depends on 1 open bug, Blocks 1 open bug)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Intermittent browser_referrer_open_link_in_tab.js | Test timed out"
   href="/show_bug.cgi?id=1144816">1144816</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent browser_referrer_open_link_in_private.js,browser_referrer_open_link_in_window.js | Test timed out"
   href="/show_bug.cgi?id=1145199">1145199</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list" id="field-blocked"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Propagate referrer policy throughout the UI: command-click and context menu open link in new tab/window (Port relevant bits from Bug 1113431)"
   href="/show_bug.cgi?id=1178104">CVE-2015-2711-SeaMonkey</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Implement &lt;meta name=&quot;referrer&quot;&gt;"
   href="/show_bug.cgi?id=704320">704320</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED INCOMPLETE - propagate referrer policy in android"
   href="/show_bug.cgi?id=1141142">1141142</a>
      </div>

        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1113431&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1113431">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-see_also"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Disable &lt;meta referrer&gt; on 37 due to outstanding middle click bug and risk to uplifting its fix"
   href="/show_bug.cgi?id=1140638">1140638</a>
      </div>

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (4 keywords, Whiteboard: [adv-main38+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2015-2711

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=addon-compat&amp;resolution=---">addon-compat</a>, 
          <a href="/buglist.cgi?keywords=dev-doc-complete&amp;resolution=---">dev-doc-complete</a>, 
          <a href="/buglist.cgi?keywords=privacy&amp;resolution=---">privacy</a>, 
          <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[adv-main38+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_305228" ><a class="email " href="/user_profile?user_id=305228" > <span class="fna">MattN</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c6"
            class="rel-time-title activity-ref"
            title="7 years ago"
        data-time="1423606612"
      >firefox-backlog</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_305228" ><a class="email " href="/user_profile?user_id=305228" > <span class="fna">MattN</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag-1096983">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1096983-dirty">
      <select id="flag-1096983" name="flag-1096983"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
            <option value="+" selected>+</option>
      </select>
    </td>


  </tr>
          </tbody>
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_75935" ><a class="email " href="/user_profile?user_id=75935" > <span class="fna">RyanVM</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c146"
            class="rel-time-title activity-ref"
            title="7 years ago"
        data-time="1426692432"
      >in-testsuite</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_75935" ><a class="email " href="/user_profile?user_id=75935" > <span class="fna">RyanVM</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag-1125406">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1125406-dirty">
      <select id="flag-1125406" name="flag-1125406"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" selected>+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="This bug must be fixed for Firefox Sync 1.7" for="flag_type-708">blocking-fx-sync1.7</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-708-dirty">
      <select id="flag_type-708" name="flag_type-708"
        title="This bug must be fixed for Firefox Sync 1.7"
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (11 files, 28 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8563141">WIP</a>
        </div>
        <div>
            <a href="#c26" class="attach-time activity-ref"><span class="rel-time" title="2015-02-11 16:40 PST" data-time="1423701641">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_339203" ><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div></span>
        </div>
        <div class="attach-info">5.30 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_103593" ><span class="fn">Gavin</span>
</div>:
              <a href="#c42"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1423701641"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8563141&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8563141&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8563141">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8568280">broswer_referrer_tests.patch</a>
        </div>
        <div>
            <a href="#c43" class="attach-time activity-ref"><span class="rel-time" title="2015-02-23 17:30 PST" data-time="1424741431">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">8.24 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8568280&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8568280&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568280">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8568664">Propagate referrer policy throughout the UI.</a>
        </div>
        <div>
            <a href="#c47" class="attach-time activity-ref"><span class="rel-time" title="2015-02-24 10:43 PST" data-time="1424803421">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">42.82 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8568664&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8568664&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568664">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8568706">broswer_referrer_tests.patch</a>
        </div>
        <div>
            <a href="#c48" class="attach-time activity-ref"><span class="rel-time" title="2015-02-24 11:35 PST" data-time="1424806550">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">11.35 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8568706&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8568706&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568706">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8568722">broswer_referrer_tests.patch</a>
        </div>
        <div>
            <a href="#c50" class="attach-time activity-ref"><span class="rel-time" title="2015-02-24 11:55 PST" data-time="1424807736">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">11.40 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8568722&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8568722&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568722">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8568784">broswer_referrer_tests.patch</a>
        </div>
        <div>
            <a href="#c51" class="attach-time activity-ref"><span class="rel-time" title="2015-02-24 13:31 PST" data-time="1424813494">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">15.20 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8568784&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8568784&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568784">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8569473">bug_1113431_referrer_tests.patch</a>
        </div>
        <div>
            <a href="#c55" class="attach-time activity-ref"><span class="rel-time" title="2015-02-25 14:36 PST" data-time="1424903807">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">23.24 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_339203" ><span class="fn">geekboy</span>
</div>:
              <a href="#c60"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1424903807"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8569473&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8569473&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8569473">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8569532">bug_1113431_referrer.patch</a>
        </div>
        <div>
            <a href="#c57" class="attach-time activity-ref"><span class="rel-time" title="2015-02-25 16:24 PST" data-time="1424910254">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">46.10 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_339203" ><span class="fn">geekboy</span>
</div>:
              <a href="#c59"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1424910254"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8569532&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8569532&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8569532">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8572479">accept referrer policy in webNav.loadURIWithOptions</a>
        </div>
        <div>
            <a href="#c64" class="attach-time activity-ref"><span class="rel-time" title="2015-03-03 23:52 PST" data-time="1425455536">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">16.14 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_103593" ><span class="fn">Gavin</span>
</div>:
              <a href="#c67"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425494366"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8572479&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8572479&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8572479">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8572483">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c65" class="attach-time activity-ref"><span class="rel-time" title="2015-03-04 00:00 PST" data-time="1425456012">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">31.24 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8572483&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8572483&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8572483">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8573098">Document and nsIWebNavigation changes for referrer policy in UI code</a>
        </div>
        <div>
            <a href="#c70" class="attach-time activity-ref"><span class="rel-time" title="2015-03-05 00:26 PST" data-time="1425543995">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">18.19 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c83"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425543995"
            >
              superreview+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8573098&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8573098&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573098">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8573099">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c71" class="attach-time activity-ref"><span class="rel-time" title="2015-03-05 00:30 PST" data-time="1425544238">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">30.28 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c74"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425544238"
            >
              review-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8573099&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8573099&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573099">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8573709">dragdrop.patch</a>
        </div>
        <div>
            <a href="#c84" class="attach-time activity-ref"><span class="rel-time" title="2015-03-05 20:37 PST" data-time="1425616635">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">8.40 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8573709&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8573709&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573709">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8573850">Document and nsIWebNavigation changes for referrer policy in UI code</a>
        </div>
        <div>
            <a href="#c85" class="attach-time activity-ref"><span class="rel-time" title="2015-03-06 02:12 PST" data-time="1425636726">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">18.78 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8573850&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8573850&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573850">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8573866">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c87" class="attach-time activity-ref"><span class="rel-time" title="2015-03-06 02:56 PST" data-time="1425639377">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">30.10 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c89"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425639377"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8573866&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8573866&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573866">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8574270">Document and nsIWebNavigation changes for referrer policy in UI code</a>
        </div>
        <div>
            <a href="#c96" class="attach-time activity-ref"><span class="rel-time" title="2015-03-07 02:57 PST" data-time="1425725852">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">22.54 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_12352" ><span class="fn">jst</span>
</div>:
              <a href="#a7660816_12352"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425725852"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c100"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425725852"
            >
              feedback+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_339203" ><span class="fn">geekboy</span>
</div>:
              <a href="#c140"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426553921"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8574270&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8574270&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574270">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8574272">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c98" class="attach-time activity-ref"><span class="rel-time" title="2015-03-07 03:10 PST" data-time="1425726636">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">32.38 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c102"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1425726636"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8574272&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8574272&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574272">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8574273">test cases - click, ctrl-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c99" class="attach-time activity-ref"><span class="rel-time" title="2015-03-07 03:19 PST" data-time="1425727141">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">23.83 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8574273&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8574273&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574273">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8575445">test cases - click, ctrl-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c105" class="attach-time activity-ref"><span class="rel-time" title="2015-03-10 11:28 PDT" data-time="1426012109">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">19.97 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8575445&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8575445&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8575445">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8575868">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c109" class="attach-time activity-ref"><span class="rel-time" title="2015-03-11 02:43 PDT" data-time="1426066991">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">23.14 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c110"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426115589"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8575868&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8575868&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8575868">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8576322">Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)</a>
        </div>
        <div>
            <a href="#c112" class="attach-time activity-ref"><span class="rel-time" title="2015-03-11 16:22 PDT" data-time="1426116122">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">37.32 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c115"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426116362"
            >
              review-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8576322&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8576322&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576322">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8576558">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c116" class="attach-time activity-ref"><span class="rel-time" title="2015-03-12 02:58 PDT" data-time="1426154282">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">36.44 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c123"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426154282"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8576558&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8576558&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576558">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8576569">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c117" class="attach-time activity-ref"><span class="rel-time" title="2015-03-12 03:12 PDT" data-time="1426155158">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">19.64 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c124"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426155158"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8576569&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8576569&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576569">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8576754">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c126" class="attach-time activity-ref"><span class="rel-time" title="2015-03-12 10:10 PDT" data-time="1426180224">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">36.48 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c126"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426180224"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8576754&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8576754&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576754">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8576756">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c127" class="attach-time activity-ref"><span class="rel-time" title="2015-03-12 10:13 PDT" data-time="1426180415">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">19.64 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c127"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426180415"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8576756&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8576756&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576756">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8577368">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c133" class="attach-time activity-ref"><span class="rel-time" title="2015-03-13 11:47 PDT" data-time="1426272440">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">19.40 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_159069" ><span class="fn">Gijs</span>
</div>:
              <a href="#c134"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426272440"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8577368&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8577368&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8577368">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8577711">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c137" class="attach-time activity-ref"><span class="rel-time" title="2015-03-15 01:03 PDT" data-time="1426406629">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">20.41 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c137"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426406629"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8577711&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8577711&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8577711">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8579148">Document and nsIWebNavigation changes for referrer policy in UI code</a>
        </div>
        <div>
            <a href="#c142" class="attach-time activity-ref"><span class="rel-time" title="2015-03-17 23:14 PDT" data-time="1426659297">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">22.63 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c142"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426659297"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8579148&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8579148&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579148">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8579150">propagate referrer policy throughout the ui</a>
        </div>
        <div>
            <a href="#c143" class="attach-time activity-ref"><span class="rel-time" title="2015-03-17 23:16 PDT" data-time="1426659381">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">36.48 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c143"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426659381"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_495955" ><span class="fn">Sylvestre</span>
</div>:
              <a href="#a8146243_495955"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427050035"
            >
              approval-mozilla-aurora+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8579150&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8579150&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579150">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8579151">test cases - click, middle-click, new-{tab,window}</a>
        </div>
        <div>
            <a href="#c144" class="attach-time activity-ref"><span class="rel-time" title="2015-03-17 23:17 PDT" data-time="1426659437">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">20.41 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c144"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1426659437"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8579151&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8579151&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579151">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582266">aurora-01-1133577-openLinkAndFramevFinal.patch</a>
        </div>
        <div>
            <a href="#c154" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:50 PDT" data-time="1427187058">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">11.27 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c154"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187058"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582266&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582266&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582266">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582267">aurora-02-1133577-fixTestBrowser_bug734076v2.2.patch</a>
        </div>
        <div>
            <a href="#c155" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:51 PDT" data-time="1427187102">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">3.15 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c155"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187102"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582267&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582267&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582267">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582269">aurora-03-1113431-api.patch</a>
        </div>
        <div>
            <a href="#c156" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:52 PDT" data-time="1427187140">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">22.63 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c164"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427188527"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582269&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582269&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582269">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582270">aurora-04-1113431-browser.patch</a>
        </div>
        <div>
            <a href="#c157" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:55 PDT" data-time="1427187323">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">36.42 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c157"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187323"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582270&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582270&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582270">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582271">aurora-05-1113431-tests.patch</a>
        </div>
        <div>
            <a href="#c158" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:56 PDT" data-time="1427187360">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">20.41 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c158"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187360"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582271&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582271&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582271">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582272">aurora-06-1144816-timeout.patch</a>
        </div>
        <div>
            <a href="#c159" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:56 PDT" data-time="1427187398">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">2.30 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c159"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187398"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582272&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582272&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582272">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582273">aurora-07-1144816-focus.patch</a>
        </div>
        <div>
            <a href="#c160" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:57 PDT" data-time="1427187439">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">3.31 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c160"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187439"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582273&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582273&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582273">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582274">aurora-08-1144816-longer.patch</a>
        </div>
        <div>
            <a href="#c161" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 01:59 PDT" data-time="1427187552">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">3.70 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_526840" ><span class="fn">averstak</span>
</div>:
              <a href="#c161"
                  class="flag-name-status rel-time-title activity-ref"
                  title="7 years ago"
              data-time="1427187552"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582274&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582274&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582274">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8582278">aurora-09-1113431-skip-e10s.patch</a>
        </div>
        <div>
            <a href="#c162" class="attach-time activity-ref"><span class="rel-time" title="2015-03-24 02:05 PDT" data-time="1427187909">7 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div></span>
        </div>
        <div class="attach-info">704 bytes,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8582278&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8582278&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582278">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="aTOQ6w4YYbNtApF1Gejj2MvPIwjP89vh9qrJF32agiLusXP3">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="9712560" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-18 16:50 PST" data-time="1418950250">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-0" data-comment-id="9712560">User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/40.0.2214.38 Safari/537.36

Steps to reproduce:

1. Open <a rel="nofollow" href="https://scholar.google.com/scholar?q=news&amp;mref=origin">https://scholar.google.com/scholar?q=news&amp;mref=origin</a> .
Middle-click on &quot;Creating reality: How TV news distorts events&quot; from ERIC to open the link in a new tab.
On the ERIC page, open the console and type document.referrer to see HTTP Referer.

2. Repeat 1, but left-click on the ERIC page to open it in the same tab, not a new tab.

3. Repeat 1, but from plain HTTP - <a rel="nofollow" href="http://scholar.google.com/scholar?q=news&amp;mref=origin">http://scholar.google.com/scholar?q=news&amp;mref=origin</a> .


Actual results:

1. document.referrer is empty - incorrect, HTTPS -&gt; HTTP in a new tab ignores meta referrer.
2. document.referrer = &quot;<a rel="nofollow" href="https://scholar.google.com">https://scholar.google.com</a>&quot; - correct, HTTPS -&gt; HTTP in the same tab respects meta referrer.
3. document.referrer = &quot;<a rel="nofollow" href="http://scholar.google.com">http://scholar.google.com</a>&quot; - correct, HTTP -&gt; HTTP in a new tab respects meta referrer.


Expected results:

1-2. document.referrer = &quot;<a rel="nofollow" href="https://scholar.google.com">https://scholar.google.com</a>&quot;.
3. document.referrer = &quot;<a rel="nofollow" href="http://scholar.google.com">http://scholar.google.com</a>&quot;.

Basically, it appears that the meta referrer implementation in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Implement &lt;meta name=&quot;referrer&quot;&gt;"
   href="/show_bug.cgi?id=704320">Bug 704320</a> is incomplete.  When the source page is HTTPS, following a link to an HTTP page in the same tab respects meta referrer, but opening a link in a new tab does not.  Both cases respect meta-referrer when the source page is plain HTTP.

(Ditto for mref=unsafe-url - this is respected from HTTPS in the same tab, but not in a new tab.)</pre></div><div class="change-set" id="c1"><div class="comment" data-id="9712662" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-18 17:22 PST" data-time="1418952150">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="9712662">(This is obviously on Aurora, not Chrome. :-)

User-Agent: Mozilla/5.0 (Windows NT 6.1; rv:36.0) Gecko/20100101 Firefox/36.0
Built from <a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-aurora/rev/8408727d213e">https://hg.mozilla.org/releases/mozilla-aurora/rev/8408727d213e</a></pre></div><div class="change-set" id="c2"><div class="comment" data-id="9713440" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-18 22:13 PST" data-time="1418969582">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="9713440">Presumably the front-end code handling the middle-click needs to set the referrer policy (based on the meta tag), not just the referrer.</pre><div class="activity"><div class="change">Product: Core &rarr; Firefox</div></div></div><div class="change-set" id="c3"><div class="comment" data-id="9715670" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" ><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" ><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-19 08:55 PST" data-time="1419008140">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="9715670">Maybe here?  
<a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/dom/ipc/TabParent.cpp#446">http://mxr.mozilla.org/mozilla-central/source/dom/ipc/TabParent.cpp#446</a>

Was this encountered with remote tabs (e10s) enabled?</pre><div class="activity"><div class="change">Flags: needinfo?(averstak)</div></div></div><div class="change-set" id="c4"><div class="comment" data-id="9716110" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-19 10:34 PST" data-time="1419014053">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="9716110">It's the same with and without e10s.  Tried Aurora (doesn't support e10s) and Nightly (e10s enabled and e10s disabled).  All three clear Referer in this case - opening a link from HTTPS to HTTP in a new tab, with meta-referrer set to &quot;origin&quot;.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(averstak)</span></div></div></div><div class="change-set" id="c5"><div class="comment" data-id="9743005" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2014-12-30 18:56 PST" data-time="1419994602">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="9743005">Two issues here:

1. UI code - _loadURIWithFlags() in browser.js - doesn't pass referrer policy to docshell, because it knows docshell as nsIWebNavigation whose loadURI() doesn't have a referrer policy parameter.  It's a direct call without e10s, and a sequence that leads to restoreTabContent() in ContentRestore.jsm with e10s; both call webNavigation.loadURI() at the end.

2. Links opened via the context menu get no referrer at all, because _loadURIWithFlags() is passed the following as referrer: (a) chrome://browser/content/browser.xul for &quot;Open link in new tab&quot;, and (b) undefined for &quot;Open link in new window&quot;.  This looks like a bigger issue; it strips Referer for websites that do nothing special - plain HTTP, no meta referrer.  (Stable and aurora pass Referer in this case; nightly doesn't.)

To address #1, we could do the following:

A. Add a function that passes referrer policy to nsIWebNavigation, e.g., loadURL2().

B. Add referrer policy to nsIDOMDocument.  Or rather make the one already in nsIDocument.h scriptable.

C. Propagate B to A - handleLinkClick() in browser.js gets the doc from event.target.ownerDocument, then calls openLinkIn() -&gt; loadOneTab() -&gt; addTab() -&gt; _LoadURIWithFlags(), which eventually calls into nsIWebNavigation.  Likewise for the context menu - _openLinkInParameters() in nsContextMenu.js gets the doc and fills in the params to openLinkIn(), etc. (This would only propagate the referrer policy; fixing referrers in #2 is a separate issue.)

Thoughts?  Better alternatives?</pre></div><div class="change-set" id="c6"><div class="comment" data-id="9904999" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_305228" ><img src="https://secure.gravatar.com/avatar/8c3bddad3fd0f45662210771f8f0ad15?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_305228" ><a class="email " href="/user_profile?user_id=305228" > <span class="fna">Matthew N. [:MattN]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 14:16 PST" data-time="1423606612">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="9904999">[Tracking Requested - why for this release]: We're shipping a feature (&lt;meta name=&quot;referrer&quot;&gt;) partially broken.

Gavin, do you have opinions on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c5">comment 5</a>? This is going out the door in 36 in a broken state :(</pre><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Implement &lt;meta name=&quot;referrer&quot;&gt;"
   href="/show_bug.cgi?id=704320">704320</a></div><div class="change">Status: UNCONFIRMED &rarr; NEW</div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=isnotempty">status-firefox36</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=isnotempty">status-firefox37</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=isnotempty">status-firefox38</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=isnotempty">tracking-firefox36</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Ever confirmed: true</div><div class="change">Flags: needinfo?(gavin.sharp)</div><div class="change">Flags: firefox-backlog+</div><div class="change">OS: Linux &rarr; All</div><div class="change">Hardware: x86_64 &rarr; All</div><div class="change">Summary: &lt;meta referrer&gt; doesn't set referrer for https -&gt; http links opened in a new tab &rarr; &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click</div></div></div><div class="change-set" id="c7"><div class="comment" data-id="9905031" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" ><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" ><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 14:21 PST" data-time="1423606918">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="9905031">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c5">comment #5</a>)
<span class="quote">&gt; 2. Links opened via the context menu get no referrer at all, because
&gt; _loadURIWithFlags() is passed the following as referrer: (a)
&gt; chrome://browser/content/browser.xul for &quot;Open link in new tab&quot;, and (b)
&gt; undefined for &quot;Open link in new window&quot;.  This looks like a bigger issue; it
&gt; strips Referer for websites that do nothing special - plain HTTP, no meta
&gt; referrer.  (Stable and aurora pass Referer in this case; nightly doesn't.)</span >

This is <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - New rel=noreferrer logic breaks insert related tab after current"
   href="/show_bug.cgi?id=1118502">bug 1118502</a>. Affects current DevEdition/Nightly, and we're already tracking it to ensure it is fixed before we hit release.

<span class="quote">&gt; To address #1, we could do the following:
&gt; 
&gt; A. Add a function that passes referrer policy to nsIWebNavigation, e.g.,
&gt; loadURL2().
&gt; 
&gt; B. Add referrer policy to nsIDOMDocument.  Or rather make the one already in
&gt; nsIDocument.h scriptable.
&gt; 
&gt; C. Propagate B to A - handleLinkClick() in browser.js gets the doc from
&gt; event.target.ownerDocument, then calls openLinkIn() -&gt; loadOneTab() -&gt;
&gt; addTab() -&gt; _LoadURIWithFlags(), which eventually calls into
&gt; nsIWebNavigation.  Likewise for the context menu - _openLinkInParameters()
&gt; in nsContextMenu.js gets the doc and fills in the params to openLinkIn(),
&gt; etc. (This would only propagate the referrer policy; fixing referrers in #2
&gt; is a separate issue.)
&gt; 
&gt; Thoughts?  Better alternatives?</span >

This sounds about right.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gavin.sharp)</span></div></div></div><div class="change-set" id="c8"><div class="comment" data-id="9905050" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" ><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" ><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 14:25 PST" data-time="1423607139">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="9905050">I don't have a great sense of the severity of this issue. It seems like something we can follow-up to fix in 37 despite shipping &lt;meta name=&quot;referrer&quot;&gt; in 36, but maybe it would be preferred to delay shipping the feature entirely until this bug is fixed?</pre><div class="activity"><div class="change">Flags: needinfo?(sstamm)</div><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c9"><div class="comment" data-id="9905500" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" ><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 16:11 PST" data-time="1423613515">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="9905500">IMHO it's better to ship the feature and fix this later. It's an edge case that behaves as if the feature didn't exist so it's not any worse than before, and sites can start to benefit from the feature in the majority of normal use .</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=privacy&amp;resolution=---">privacy</a>, 
          
            <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a></div></div></div><div class="change-set" id="c10"><div class="comment" data-id="9905689" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_305228" ><img src="https://secure.gravatar.com/avatar/8c3bddad3fd0f45662210771f8f0ad15?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_305228" ><a class="email " href="/user_profile?user_id=305228" > <span class="fna">Matthew N. [:MattN]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 17:08 PST" data-time="1423616932">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="9905689">(In reply to Daniel Veditz [:dveditz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c9">comment #9</a>)
<span class="quote">&gt; It's an edge case</span >

I personally don't think something as common as middle-clicking a link is an &quot;edge case&quot;. I would guess that &gt;10% of my navigations via links are in a new tab.</pre></div><div class="change-set" id="c11"><div class="comment" data-id="9905703" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" ><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" ><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 17:12 PST" data-time="1423617167">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="9905703">+1 for shipping meta-referrer in 36.  FWIW, it wouldn't be entirely without precedent - <a rel="nofollow" href="https://code.google.com/p/chromium/issues/detail?id=124750">https://code.google.com/p/chromium/issues/detail?id=124750</a> :-)

Would be good to mention the caveats in the release notes - this bug, and also <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta referrer&gt; origin-when-crossorigin sets incorrect referrer"
   href="/show_bug.cgi?id=1113438">bug 1113438</a>, which is already fixed in 37.</pre></div><div class="change-set" id="c12"><div class="comment" data-id="9906059" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-10 19:09 PST" data-time="1423624186">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="9906059">I think it's fine to ship &lt;meta name=&quot;referrer&quot;&gt; without this bug being fixed, as long as we plan to fix it at some point...

Note that this bug _does_ mean that we'll send referrers in some cases when the page asks not to, so it's not quite as low-priority as <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c0">comment 0</a> makes it sound.  But it's certainly no worse than complete lack of &lt;meta name=&quot;referrer&quot;&gt; support.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c13"><div class="comment" data-id="9906937" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" ><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" ><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 01:43 PST" data-time="1423647799">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="9906937">Seems that people are happy with shipping the feature with that bug. So, not tracking.
If you have a safe fix, this could land in beta 9 (go to build tomorrow).</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=isnotempty">tracking-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=-">-</a></div></div></div><div class="change-set" id="c14"><div class="comment" data-id="9906973" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_14661" ><img src="https://secure.gravatar.com/avatar/708ad4f6494aae9c1711a823f447d415?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_14661" ><a class="email " href="/user_profile?user_id=14661" > <span class="fna">Brian Smith (:briansmith, :bsmith, use NEEDINFO?)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 01:56 PST" data-time="1423648600">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="9906973">[Tracking Requested - why for this release]:

(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c12">comment #12</a>)
<span class="quote">&gt; I think it's fine to ship &lt;meta name=&quot;referrer&quot;&gt; without this bug being
&gt; fixed, as long as we plan to fix it at some point...
&gt; 
&gt; Note that this bug _does_ mean that we'll send referrers in some cases when
&gt; the page asks not to, so it's not quite as low-priority as <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c0">comment 0</a> makes
&gt; it sound.  But it's certainly no worse than complete lack of &lt;meta
&gt; name=&quot;referrer&quot;&gt; support.</span >

Actually, it is *much* worse than complete lack of &lt;meta name=referrer&gt; support. Websites such as Facebook use feature detection to detect &lt;meta name=referrer&gt;, and when the feature detection indicates that it is supported, then they use direct links to third-party content, relying on meta referrer to strip sensitive information from the referrer URL. When the feature detection indicates the &lt;meta name=referrer&gt; is not supported, they use their own tricks (e.g. redirects) to ensure the sensitive information is stripped.

With this bug, their feature detection will detect &lt;meta name=referrer&gt; support, so these websites will not strip the sensitive information from the referrer URLs when linking to untrusted third-party content.

By the way, where was the intent to implement/ship thread for this feature? As far as I can tell, there wasn't one. So, I'll just point out here that the editor of the spec for this feature has already acknowledged that some of the issues I raised in the webappsec mailing list regarding this feature are significant and that major changes to the spec are likely, which is another reason it may be wise to hold back.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=isnotempty">tracking-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=-">-</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%3F">?</a></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="9907035" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" ><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" ><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 02:19 PST" data-time="1423649996">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="9907035">OK. Seems that there is actually no consensus on this.

So, I see three potential solutions:
* Disable the feature
* Ship anyway
* Fix the bug (or workaround)

Gavin, what is your call on this?</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=isnotempty">tracking-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox36&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">Flags: needinfo?(gavin.sharp)</div></div></div><div class="change-set" id="c16"><div class="comment" data-id="9907438" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 04:42 PST" data-time="1423658523">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="9907438"><span class="quote">&gt; Websites such as Facebook use feature detection</span >

What do they detect, do you know?  We may be able to add support without enabling whatever it is they're detecting if that's what we want to do.

<span class="quote">&gt; By the way, where was the intent to implement/ship thread for this feature?</span >

I'm not sure there was one...  You're right, there should have been.  Sid, what's the story with the spec issues?</pre></div><div class="change-set" id="c17"><div class="comment" data-id="9908039" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" ><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" ><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 07:30 PST" data-time="1423668623">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="9908039">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c16">comment #16</a>)
<span class="quote">&gt; &gt; By the way, where was the intent to implement/ship thread for this feature?
&gt; 
&gt; I'm not sure there was one...  You're right, there should have been.  Sid,
&gt; what's the story with the spec issues?</span >

Ack, yeah, sorry.  That slipped through my fingers.  Owen had been generously working on it for a very long time and when I picked it up to finish it I totally forgot to post the intent.

As Brian said, the spec is not complete or perfectly stable.  I wanted Firefox to provide a reference implementation to shake out any additional deployment issues with the spec sooner rather than later (which is why I pushed to get it done before the spec went to LC). Most of the issues are going to be deployment issues, and it's important to give web devs something to try out. There are, indeed, still things up for debate in the WebAppSec WG.  See for instance this thread:
<a rel="nofollow" href="http://lists.w3.org/Archives/Public/public-webappsec/2015Feb/0147.html">http://lists.w3.org/Archives/Public/public-webappsec/2015Feb/0147.html</a>

To Gavin: I think we should fix this bug, and _not_ disable the feature in the meantime.  We should be moving forward, not backwards, especially so we can find and fix more bugs like this sooner rather than later (and also shake out implementation problems in the spec).</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sstamm)</span></div></div></div><div class="change-set" id="c18"><div class="comment" data-id="9908075" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 07:43 PST" data-time="1423669391">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="9908075">Sid, giving web devs something to try out can be done by enabling the feature in Aurora only, no?

Past that, you didn't respond to Brian's point about feature detection.  I don't think we should be shipping the feature in its current state; we need to either make Facebook not detect it or something.</pre><div class="activity"><div class="change">Flags: needinfo?(sstamm)</div></div></div><div class="change-set" id="c19"><div class="comment" data-id="9908246" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" ><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" ><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:18 PST" data-time="1423671490">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="9908246">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c18">comment #18</a>)
<span class="quote">&gt; Sid, giving web devs something to try out can be done by enabling the
&gt; feature in Aurora only, no?</span >

Sure, but performance improvements at scale is the real value of this feature and that's easiest to test once it's in released versions of browsers.  Devs can try it out in Aurora and extrapolate perf gains, but really what they want to know is what effect it will have on actual server load when their users' browsers can employ the feature.

In hindsight it may have been wise to hold in Aurora until the spec went to LC, but it's out now, shouldn't we really just fix the bug?  Regardless of how the spec changes, this bug will still be an implementation flaw and need to be fixed.

<span class="quote">&gt; Past that, you didn't respond to Brian's point about feature detection.  I
&gt; don't think we should be shipping the feature in its current state; we need
&gt; to either make Facebook not detect it or something.</span >

I don't understand why this bug requires us to un-ship a feature.  This is not a bug in the spec, it is a bug in our implementation and we should fix it.  We should not blame my failure to catch this referrer-policy-application case on the spec.  If we fix this bug, Facebook's problem goes away, right?

While I totally agree with Brian that feature detection can be problematic, it is a problem with all optional security features; regardless of any spec state, if there's an implementation bug in a security feature that a web site doesn't know about and they rely on the feature, then it could cause security failures. Seems to me we just need to fix the bug (this bug is a flaw in our implementation).

Regarding spec churn: I believe Brian is referencing this message[0] from Mike.  From what I can tell from the WG discussion, the major change that will happen has to do with combining policies (i.e., changing the referrer policy after applying one).  Right now any attempt to combine policies shuts referrers off entirely.  Any change to this would be &quot;more generous&quot;, referrer-wise.  Maybe I missed something else that is more concerning and would warrant turning off the feature in the meantime?

Mike, do you anticipate the spec will change substantially such that current implementations will be less secure or incompatible with the future revision of the spec?  Do you think sites' security would suffer if they start using the meta referrer we implemented in Firefox?

[0] <a rel="nofollow" href="http://lists.w3.org/Archives/Public/public-webappsec/2015Jan/0080.html">http://lists.w3.org/Archives/Public/public-webappsec/2015Jan/0080.html</a></pre><div class="activity"><div class="change">Flags: needinfo?(sstamm) &rarr; needinfo?(mkwst)</div></div></div><div class="change-set" id="c20"><div class="comment" data-id="9908295" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:24 PST" data-time="1423671871">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="9908295"><span class="quote">&gt; I don't understand why this bug requires us to un-ship a feature</span >

We haven't shipped this feature yet, unless I'm missing something.  I'm questioning whether we _should_ ship it in the current state, as opposed to holding it one more cycle or modifying it so it can't be detected for the moment.

<span class="quote">&gt; If we fix this bug, Facebook's problem goes away, right?</span >

Yes, but how likely are we to fix this bug on beta 36?</pre><div class="activity"><div class="change">Flags: needinfo?(sstamm)</div></div></div><div class="change-set" id="c21"><div class="comment" data-id="9908310" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" ><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" ><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:27 PST" data-time="1423672044">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="9908310">I'm all for &quot;fixing this bug and moving forward&quot;, but:

a) someone needs to do that (can you take it, Sid?)
b) we can't realistically fix this bug in the 36 time frame, so unless we take other measures, we're going to end up shipping &lt;meta name=&quot;referrer&quot;&gt; in Firefox 36 with this bug. That sounds acceptable to me, but it sounds like maybe we should reach out to known potential users, like Facebook, and warn them about it. Probably also worth a note in the release notes/MDN.</pre></div><div class="change-set" id="a4721805_103593"><div class="change" id="aa4721805_103593">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_103593" id="a4721805_103593"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a4721805_103593"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a4721805_103593">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a4721805_103593">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:27 PST" data-time="1423672055">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gavin.sharp)</span></div></div></div><div class="change-set" id="c22"><div class="comment" data-id="9908369" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a4721805_103593"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:41 PST" data-time="1423672873">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="9908369">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c20">comment #20</a>)
<span class="quote">&gt; &gt; I don't understand why this bug requires us to un-ship a feature
&gt; 
&gt; We haven't shipped this feature yet, unless I'm missing something.  I'm
&gt; questioning whether we _should_ ship it in the current state, as opposed to
&gt; holding it one more cycle or modifying it so it can't be detected for the
&gt; moment.</span >

/me facepalm... yes, sorry, you're right. I see more clearly now.

I don't think it's terrible to ship with this bug, and getting it out there in more browsers will cause more good than harm. From what I've heard out of Facebook and other implementers, much of the use-case for meta referrer is for subresources (for things like embedded games or third-party widgets), not clicked links.

So I'm with Gavin.  We  can fix it quickly and target 37 (especially if Alex is willing to help -- Alex: you've been tremendously helpful on the other referrer stuff).  And we should put a release note in 36 with this &quot;known bug&quot;.  If it helps, I'm willing to do a mea culpa post on the security blog to say &quot;oops, missed this thing, but don't worry we will fix it quickly&quot;.

If we want to do a last-minute tweak to 36 to make sure this thing doesn't get abused, we could (just for 36) prefix the feature to be like:
 &lt;meta name=&quot;moz_referrer&quot; instead of &lt;meta name=&quot;referrer&quot;
but I don't think that's necessary.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sstamm)</span></div></div></div><div class="change-set" id="c23"><div class="comment" data-id="9908426" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a4721805_103593"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a4721805_103593"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:53 PST" data-time="1423673582">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="9908426">I'd still like to understand what sort of detection Facebook does.  Because say we ship with this relnoted.  What do we expect them to do?  UA-sniff the browser version?  That's generally something we try to avoid forcing people to do....</pre></div><div class="change-set" id="c24"><div class="comment" data-id="9908455" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a4721805_103593"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 08:58 PST" data-time="1423673903">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="9908455">(In reply to Sid Stamm [:geekboy or :sstamm] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c22">comment #22</a>)
<span class="quote">&gt; And we should put a release note in 36 with this &quot;known bug&quot;.</span >
We have this as a new feature for 36 [1]. Marking this bug as a know bug would give the impression that we are shipping broken feature. I am not sure it is what we want to do...

Worst case scenario: 37 is just 5 weeks after the 36 release... (and no Mea culpa to do)

[1] <a rel="nofollow" href="https://www.mozilla.org/en-US/mobile/36.0beta/releasenotes/">https://www.mozilla.org/en-US/mobile/36.0beta/releasenotes/</a></pre></div><div class="change-set" id="c25"><div class="comment" data-id="9910147" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a4721805_103593"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 15:01 PST" data-time="1423695677">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="9910147">Sid - I should be able to help with this, but it'd probably take me several weeks to get to it, due to travel and schedule constraints.  If you want it done sooner, someone else should pick it up.  No rocket science here, just a bit of parameter propagation - see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c7">comment 7</a>.

Shipping meta-referrer as-is in 36 (prefixed or unprefixed) would let me make Scholar HTTPS-only in Firefox, as it already is in Chrome and Safari.  I don't know how representative my use case is, but here's one concrete example of security improvements that this feature would enable here and now.

Re feature detection - the only way I can think of that would also work in Webkit is to load an iframe and check its document.referrer.  So, if compatibility is a major concern... let's not go there, it'd be saner to just ship it with a prefix. :-)</pre></div><div class="change-set" id="c26"><div class="comment" data-id="9910520" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a4721805_103593"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 16:40 PST" data-time="1423701641">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8563141"
         class="attachment patch obsolete"
         data-id="8563141" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug1113431">
      <meta itemprop="contentSize" content="5431">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8563141">
          <a class="link" href="attachment.cgi?id=8563141&amp;action=diff">
        <span id="att-8563141-description" itemprop="description">WIP</span></a> (obsolete)
        — <a href="attachment.cgi?id=8563141&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8563141">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-26" data-comment-id="9910520">Thanks, Alex.

I ran out of time before getting around to testing or writing a test, but I had a thought; what if we take the NetUtil.applyReferrerPolicy implementation in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - add referrer policy support to Downloads.jsm"
   href="/show_bug.cgi?id=1073187">bug 1073187</a>, and then instead of propogating the referrer policy into nsIDOMDocument, just obtaining the referrer policy in browser.js and calculating the &quot;effective referrer&quot; there.

So taking the patch in <span class="bz_obsolete"><a href="/attachment.cgi?id=8552570" name="attach_8552570" title="bug1073187_netutil">attachment 8552570</a> <a href="/attachment.cgi?id=8552570&amp;action=edit" title="bug1073187_netutil">[details]</a> <a href="/attachment.cgi?id=8552570&amp;action=diff" title="bug1073187_netutil">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1073187&amp;attachment=8552570'>[review]</a> on <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - add referrer policy support to Downloads.jsm"
   href="/show_bug.cgi?id=1073187">bug 1073187</a> (which we can probably land whenever), then applying this patch on top, I think we can:
* get the referrer and referrerPolicy from the doc
* compute the effective referrer
* stuff that (instead of the full referrer) into the params object (via handleLinkClick)
* use the effective/computed referrer when calling the various loaders in browser.js

It's basically what you said in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c5">comment 5</a>, Alex, but instead we can compute and use the referrer higher in the stack instead of modifying nsIDOMDocument.

Does this look like a reasonable approach, Gavin?  I won't be able to follow through and finish this until next week (I'm taking off for 4 days of vacation in just over 24 hours) but I can at least try to get it started.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8563141&amp;action=edit"
           title="WIP"
           class=""
        >Attachment #8563141</a> -
        Flags: feedback?(gavin.sharp)</div></div></div><div class="change-set" id="c27"><div class="comment" data-id="9910767" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a4721805_103593"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-11 17:44 PST" data-time="1423705469">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="9910767">But then you'll probably need to also propagate the &quot;don't mess with referrer&quot; flag, which would defeat the point of doing it this way?  E.g., consider an HTTPS -&gt; HTTP link with referrer=origin.  If you propagate referrer=<a rel="nofollow" href="https://just.host">https://just.host</a> then wouldn't it get stripped at the end, because it's a downgrade?  That would be incorrect - referrer policy is supposed to override the defaults, which could make it more restrictive, or less restrictive.</pre></div><div class="change-set" id="c28"><div class="comment" data-id="9911675" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a4721805_103593"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-12 00:20 PST" data-time="1423729239">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="9911675">But if you could pick some intermediate call site X and make sure that everyone upstream of X always passes it effectiveReferrer, then X could propagate (referrer=effectiveReferrer, referrerPolicy=unsafe-URL) downstream.  This might work, and would probably still look a lot cleaner than propagating referrerPolicy all over town.

The catch is that &quot;everyone upstream&quot; may be a fairly large set - {middle-click, context-menu, download, save-as, print} come to mind.  They should all be changed at some point, but it may not be a good idea to lump them all into the same patch.</pre></div><div class="change-set" id="c29"><div class="comment" data-id="9911739" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_457467" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/b077b817d1cc35923e737e54d19ce6b3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_457467" id="a4721805_103593"><a class="email " href="/user_profile?user_id=457467" > <span class="fna">Mike West</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-12 00:47 PST" data-time="1423730842">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="9911739">(In reply to Sid Stamm [:geekboy or :sstamm] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c19">comment #19</a>)
<span class="quote">&gt; Regarding spec churn: I believe Brian is referencing this message[0] from
&gt; Mike.  From what I can tell from the WG discussion, the major change that
&gt; will happen has to do with combining policies (i.e., changing the referrer
&gt; policy after applying one).  Right now any attempt to combine policies shuts
&gt; referrers off entirely.  Any change to this would be &quot;more generous&quot;,
&gt; referrer-wise.  Maybe I missed something else that is more concerning and
&gt; would warrant turning off the feature in the meantime?</span >

Brian (Hi, Brian!) is probably referencing his proposal at <a rel="nofollow" href="https://briansmith.org/referrer-01.html">https://briansmith.org/referrer-01.html</a>, and my response at <a rel="nofollow" href="https://lists.w3.org/Archives/Public/public-webappsec/2014Dec/0027.html">https://lists.w3.org/Archives/Public/public-webappsec/2014Dec/0027.html</a>. I've said similar things, possibly more strongly, in other more recent threads. I do think we need to make some wider changes to the referrer spec.

<span class="quote">&gt; Mike, do you anticipate the spec will change substantially such that current
&gt; implementations will be less secure or incompatible with the future revision
&gt; of the spec?  Do you think sites' security would suffer if they start using
&gt; the meta referrer we implemented in Firefox?</span >

I do anticipate changes to the spec. As I noted on the WebAppSec mailing list, I think Brian's general proposal is awesome, though I think it goes significantly further than is feasible in a number of areas. I do think we'll end up taking on several of his suggestions soonish (sorry, I've been distracted with CSP and MIX topics recently; I hope to get back to referrer in the near future).


In particular, splitting navigational referrers from subresource referrers is important, but I imagine that being implemented in a way that allows the current syntax to retain it's meaning (e.g. `&lt;meta name=&quot;referrer&quot; content=&quot;origin&quot;&gt;` could be desugared into something like `&lt;meta name=&quot;referrer&quot; content=&quot;navigational-origin subresource-origin&quot;&gt;`. My hope would be that current implementations would retain meaning in whatever new world we come up with.

However, I think his suggestion to drop `&lt;meta&gt;` entirely is unlikely to fly. Chrome and Safari have had `&lt;meta&gt;` support for years, and it's in wide use. I can't imagine that Chrome will change it's `&lt;meta&gt;` implementation in a backwards incompatible way in anything like a near-term timeframe.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(mkwst)</span></div></div></div><div class="change-set" id="c30"><div class="comment" data-id="9914505" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a4721805_103593"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-12 13:41 PST" data-time="1423777280">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-30" data-comment-id="9914505">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c27">comment #27</a>)
<span class="quote">&gt; But then you'll probably need to also propagate the &quot;don't mess with
&gt; referrer&quot; flag, which would defeat the point of doing it this way?</span >

Yeah, I see.  Thanks for the example.  To do this right, we probably need to propagate it all the way through to where the channel is created.

Unfortunately I'm hopping on a plane shortly and won't be online again until sometime on Tuesday.  If someone wants to pick this up and run with it, be my guest (or I can take a look next week).</pre></div><div class="change-set" id="c31"><div class="comment" data-id="9923213" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a4721805_103593"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-16 05:33 PST" data-time="1424093614">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="9923213">So, looks like we are going to ship this new feature with this bug.

Jean-Yves, could you document this bug in MDN? (know issues).
(to reassign the ni to someone else)

Tracked for 37 to make sure we have a fix landing for this release.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=isnotempty">status-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox37&amp;o1=isnotempty">tracking-firefox37</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox37&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">Flags: needinfo?(jypenator)</div></div></div><div class="change-set" id="c32"><div class="comment" data-id="9934576" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a4721805_103593"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a4721805_103593"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-18 21:23 PST" data-time="1424323386">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="9934576">We have this tracked for 36 as well.  What will ensure that we fix for 37?

Do we have communications prepared for people who detect the feature about how they should detect the Firefox versions they can't rely on it in?

Is there a reason we're not just disabling the feature in 36 instead?</pre><div class="activity"><div class="change">Flags: needinfo?(sledru)</div></div></div><div class="change-set" id="c33"><div class="comment" data-id="9934718" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a4721805_103593"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-18 23:45 PST" data-time="1424331942">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="9934718">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c32">comment #32</a>)
<span class="quote">&gt; We have this tracked for 36 as well.  What will ensure that we fix for 37?</span >
We have been tracking it for only a week in 36. We have much more time for 37.

<span class="quote">&gt; Is there a reason we're not just disabling the feature in 36 instead?</span >
I am following Gavin's call on this but I really don't have any issue to disable this feature for 37.

Can someone prepare a patch to disable the feature (in case we want to do it)? 36 RC build is today.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sledru)</span></div></div></div><div class="change-set" id="c34"><div class="comment" data-id="9934788" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_14661" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/708ad4f6494aae9c1711a823f447d415?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_14661" id="a4721805_103593"><a class="email " href="/user_profile?user_id=14661" > <span class="fna">Brian Smith (:briansmith, :bsmith, use NEEDINFO?)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 00:24 PST" data-time="1424334253">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="9934788">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c16">comment #16</a>)
<span class="quote">&gt; &gt; Websites such as Facebook use feature detection
&gt; 
&gt; What do they detect, do you know?  We may be able to add support without
&gt; enabling whatever it is they're detecting if that's what we want to do.</span >

How feature detection is typically done is mentioned in my proposal [1]. See [2] and [3].

There are serious problems with how meta referrer is specified, which are also pointed out in my proposal. In particular, the way mixed content is handled doesn't make sense at all.

I agree with Mike West that browsers that ship &lt;meta referrer&gt; will need to find some way to cope with existing web pages depending on it. They may struggle to do so, depending on how much the spec ends up changing. I'm hoping and expecting it will change *considerably*. If Mozilla wants to paint itself into the same corner that Google and Safari have painted themselves in, that's up to Mozilla. But, IMO, it would be better to actively participate in resolving the issues with the referrer draft spec and implement those fixes before activating the feature. Note that Mozilla just sent its first (AFAICT) contribution for improving the referrer control spec *last week* and that reviewing (and implementing?) a reasonable referrer policy seems to be a Q1 goal for the security team, according to [4]. IMO, it makes more sense to evaluate and decide upon a policy for referrer control *before* shipping a copy of Google's existing policy (which, it seems, will also change), instead of after.

[1] <a rel="nofollow" href="https://briansmith.org/referrer-01">https://briansmith.org/referrer-01</a>
[2] <a rel="nofollow" href="https://stackoverflow.com/questions/8370341/how-can-i-detect-rel-noreferrer-support/10020992">https://stackoverflow.com/questions/8370341/how-can-i-detect-rel-noreferrer-support/10020992</a>
[3] <a rel="nofollow" href="https://www.facebook.com/notes/facebook-engineering/protecting-privacy-with-referrers/392382738919">https://www.facebook.com/notes/facebook-engineering/protecting-privacy-with-referrers/392382738919</a>
[4] <a rel="nofollow" href="https://wiki.mozilla.org/SecurityEngineering/2015/Q1Goals">https://wiki.mozilla.org/SecurityEngineering/2015/Q1Goals</a></pre></div><div class="change-set" id="c35"><div class="comment" data-id="9934939" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_457467" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/b077b817d1cc35923e737e54d19ce6b3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_457467" id="a4721805_103593"><a class="email " href="/user_profile?user_id=457467" > <span class="fna">Mike West</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 01:54 PST" data-time="1424339694">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="9934939">Mozilla's decisions about the feature are, of course, Mozilla's to make. I'll note, however, that the `&lt;meta&gt;` implementation is widely used, and has solid performance and privacy benefits. I think it would be a shame if Firefox continued to force pages who require control over the `referer` header to push users through redirects to achieve it.

While I continue to agree with Brian that the Referrer Policy spec needs some work, I think we differ on the scope of that change, and in particular about whether or not it will continue to be backwards compatible with existing `&lt;meta&gt;` usage. Even if there was general agreement that `&lt;meta&gt;` should be deprecated, it's unlikely that we'll be removing it from Chrome in anything resembling near-term given that it's been in relatively wide use for ~3 years.

All that said, I'd echo Brian's call for comments on the spec. I do hope we'll make some real progress on it in the next few weeks, now that we're wrapping up CSP2 and MIX1.</pre></div><div class="change-set" id="c36"><div class="comment" data-id="9935083" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_14661" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/708ad4f6494aae9c1711a823f447d415?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_14661" id="a4721805_103593"><a class="email " href="/user_profile?user_id=14661" > <span class="fna">Brian Smith (:briansmith, :bsmith, use NEEDINFO?)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 03:05 PST" data-time="1424343926">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="9935083">(In reply to Mike West from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c35">comment #35</a>)
<span class="quote">&gt; Mozilla's decisions about the feature are, of course, Mozilla's to make.
&gt; I'll note, however, that the `&lt;meta&gt;` implementation is widely used, and has
&gt; solid performance and privacy benefits. I think it would be a shame if
&gt; Firefox continued to force pages who require control over the `referer`
&gt; header to push users through redirects to achieve it.</span >

I'm not advocating that Mozilla never implement referrer control. I'm advocating that Mozilla avoid shipping a referrer control mechanism in its next release where the implementation is significantly broken (the feature detection logic documented on stackoverflow and by Facebook gives misleading results that will lead some websites to do unsafe things) and where the specification has some significant flaws.

I don't think this is the place to debate how much the specification is likely to change. But, it is pretty clear that the specification is going to change significantly. I know that some people think my original proposal goes too far and I've already started a second revision based on Google's and Mozilla's feedback that addresses the concerns. Mozilla is also making proposals now.

I fail to see how the likelihood of it being painful for Chrome to remove or change its meta referrer implementation is an argument for rushing an implementation of the same into Firefox. Rather, I see it as an argument for making sure that the wrong thing doesn't ship in Firefox in the first place, to avoid that pain completely.</pre></div><div class="change-set" id="c37"><div class="comment" data-id="9935084" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_14661" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/708ad4f6494aae9c1711a823f447d415?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_14661" id="a4721805_103593"><a class="email " href="/user_profile?user_id=14661" > <span class="fna">Brian Smith (:briansmith, :bsmith, use NEEDINFO?)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 03:07 PST" data-time="1424344026">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="9935084">Also, this type of scenerio is why Mozilla has this policy:
<a rel="nofollow" href="https://wiki.mozilla.org/WebAPI/ExposureGuidelines">https://wiki.mozilla.org/WebAPI/ExposureGuidelines</a>

I suggest that Mozilla stick to its own policies here. Then we could have this discussion in the Intent to Ship email thread.</pre></div><div class="change-set" id="c38"><div class="comment" data-id="9935409" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a4721805_103593"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a4721805_103593"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 06:20 PST" data-time="1424355652">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="9935409"><span class="quote">&gt; I am following Gavin's call on this</span >

With all due respect, I don't think Gavin is the right person to make unilateral calls on web-facing features.

I agree with Brian: this needs to be disabled, at least for purposes of detection, on 36 for now, and we need to have an intent to ship.  I filed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Disable &lt;meta referrer&gt; handling on 36 pending an actual request to ship process"
   href="/show_bug.cgi?id=1134606">bug 1134606</a>.

It looks like detection is done via use, so we need to actually disable entirely.

I will prepare a patch to do so, but this is NOT making me a happy camper in terms of people effectively owning their own stuff.</pre></div><div class="change-set" id="c39"><div class="comment" data-id="9935489" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a4721805_103593"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a4721805_103593"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 06:47 PST" data-time="1424357228">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="9935489">One other thing: we also have referrer control via CSP in 37.  That presumably also has the issue described in this bug, though possibly not the spec-side issues...</pre></div><div class="change-set" id="c40"><div class="comment" data-id="9935681" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a4721805_103593"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" id="a4721805_103593"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 07:28 PST" data-time="1424359685">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="9935681">I wasn't intending to make any unilateral calls :) Disabling the feature is fine by me.</pre></div><div class="change-set" id="a5409796_495955"><div class="change" id="aa5409796_495955">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_495955" id="a5409796_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5409796_495955"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5409796_495955">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a5409796_495955">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 07:34 PST" data-time="1424360046">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=isnotempty">status-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=wontfix">wontfix</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox38&amp;o1=isnotempty">tracking-firefox38</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox38&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c41"><div class="comment" data-id="9936629" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a5409796_495955"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 10:32 PST" data-time="1424370751">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="9936629">Yeah, disabling is the right thing for 36.  I'm working on a fix for this bug, but am strapped for time and it's turning out to be more complicated than I initially expected.  Would still appreciate Gavin's feedback on the WIP.</pre></div><div class="change-set" id="c42"><div class="comment" data-id="9938103" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" id="a5409796_495955"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-19 15:01 PST" data-time="1424386899">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="9938103">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8563141" name="attach_8563141" title="WIP">attachment 8563141</a> <a href="/attachment.cgi?id=8563141&amp;action=edit" title="WIP">[details]</a> <a href="/attachment.cgi?id=8563141&amp;action=diff" title="WIP">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8563141'>[review]</a>
WIP

<span class="quote">&gt;diff -r 12ca91298b43 browser/base/content/browser.js</span >

<span class="quote">&gt;       case Ci.nsIBrowserDOMWindow.OPEN_NEWTAB :
&gt;         let referrer = aOpener ? makeURI(aOpener.location.href) : null;
&gt;+        if (referrer) {
&gt;+          let referrerPolicy = doc.referrerPolicy;</span >

&quot;doc&quot; is undefined here. I guess you can probably use aOpener.document. But is this code actually invoked for the STR from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c0">comment 0</a>?

The approach in general seems fine.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8563141&amp;action=edit"
           title="WIP"
           class=""
        >Attachment #8563141</a> -
        Flags: feedback?(gavin.sharp) &rarr; feedback+</div></div></div><div class="change-set" id="c43"><div class="comment" data-id="9949426" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-23 17:30 PST" data-time="1424741431">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8568280"
         class="attachment patch obsolete"
         data-id="8568280" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="broswer_referrer_tests.patch">
      <meta itemprop="contentSize" content="8434">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8568280">
          <a class="link" href="attachment.cgi?id=8568280&amp;action=diff">
        <span id="att-8568280-description" itemprop="description">broswer_referrer_tests.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8568280&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568280">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-43" data-comment-id="9949426">Adding a WIP patch for the testcases because I do need some help figuring out what's going on.

Here is how the test works:
* I based the test on another test which I wrote a while back [1] but essentially performs the same task, we register a clickHandler, intercept the click and perform a call to gTestWin.contentAreaClick().
* In the other testcase [1], that strategy works fine.
* In the attached patch (in the clickHandler)
<span class="quote">&gt; aEvent.target = [object XULElement],</span >
whereas (as the other test [1] shows), the
<span class="quote">&gt; aEvent.target = <a rel="nofollow" href="http://mochi.test:8888/browser/browser/base/content/test/general/file_meta_referrer_testserver.sjs">http://mochi.test:8888/browser/browser/base/content/test/general/file_meta_referrer_testserver.sjs</a></span >
I don't know why and where that happens, but apparently this difference causes us to enter this branch [2] and hence not to perform the actual click.

Any help is highly appreciated!

&#64;Gijs: I followed your suggestion, and tried to not register a clickHandler but instead 'faking' a eventObject and calling
<span class="quote">&gt; gTestWin.contentAreaClick(aEvent, true);</span >
with that eventObject. Unfortunately I had to give up on that solution, because faking all the different objects within that event object became to cumbersome.

Thanks for any help - also, I am happy to rewrite the test if there is an easier solution to accomplish the same task, but at the moment I don't think there is. For all recommendations, please keep in mind that manipulatively we need tests for:
* Ctrl-click
* ctrl-drag and drop
* right-click open link in new tab
* middle click

[1] <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/test/general/browser_bug906190.js#98">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/test/general/browser_bug906190.js#98</a>
[2] <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.js#5406">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.js#5406</a></pre><div class="activity"><div class="change">Flags: needinfo?(nfitzgerald)</div><div class="change">Flags: needinfo?(gijskruitbosch+bugs)</div><div class="change">Flags: needinfo?(gavin.sharp)</div></div></div><div class="change-set" id="c44"><div class="comment" data-id="9951230" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a5409796_495955"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 06:32 PST" data-time="1424788377">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="9951230">You should waitForFocus(aTest, gTestWin.content) in the waitForSomeTabToLoad callback in setupTest. The other test does an executeSoon and waits for a load, *and* loads another tab manually before trying to click the link. Right now the simulated click seems to just focus the content, for whatever reason.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="c45"><div class="comment" data-id="9951880" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_417695" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/c06f47a89886d2056c8e3c7757632d1b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_417695" id="a5409796_495955"><a class="email disabled" href="/user_profile?user_id=417695" > <span class="fna">Nick Fitzgerald [:fitzgen] [⏰PST; UTC-8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 08:43 PST" data-time="1424796192">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-45" data-comment-id="9951880">Sorry, this isn't an area of the code base I'm familiar with, and I don't think I can provide any useful information here :(</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(nfitzgerald)</span></div></div></div><div class="change-set" id="c46"><div class="comment" data-id="9952041" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 09:19 PST" data-time="1424798380">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-46" data-comment-id="9952041">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c44">comment #44</a>)
<span class="quote">&gt; You should waitForFocus(aTest, gTestWin.content) in the waitForSomeTabToLoad
&gt; callback in setupTest. The other test does an executeSoon and waits for a
&gt; load, *and* loads another tab manually before trying to click the link.
&gt; Right now the simulated click seems to just focus the content, for whatever
&gt; reason.</span >

Thanks Gijs - I wouldn't have figured myself. Surprises my that you can do a document.getElementById(&quot;&quot;) which returns the right thing but you can't perform the click on it. Thanks anyway, it works now!</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gavin.sharp)</span></div></div></div><div class="change-set" id="c47"><div class="comment" data-id="9952513" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 10:43 PST" data-time="1424803421">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8568664"
         class="attachment patch obsolete"
         data-id="8568664" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431.patch">
      <meta itemprop="contentSize" content="43844">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8568664">
          <a class="link" href="attachment.cgi?id=8568664&amp;action=diff">
        <span id="att-8568664-description" itemprop="description">Propagate referrer policy throughout the UI.</span></a> (obsolete)
        — <a href="attachment.cgi?id=8568664&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568664">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-47" data-comment-id="9952513">Christoph - in case this helps you.  Unpolished and no automatic tests, but shows what/where to change.  Tested command-click and context menu's new {tab,window} by hand with meta-referrer={unsafe-URL,origin,origin-when-crossorigin}; all seem to work per current spec.</pre></div><div class="change-set" id="c48"><div class="comment" data-id="9952812" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 11:35 PST" data-time="1424806550">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8568706"
         class="attachment patch obsolete"
         data-id="8568706" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="broswer_referrer_tests.patch">
      <meta itemprop="contentSize" content="11622">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8568706">
          <a class="link" href="attachment.cgi?id=8568706&amp;action=diff">
        <span id="att-8568706-description" itemprop="description">broswer_referrer_tests.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8568706&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568706">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-48" data-comment-id="9952812">Ok - we have an automatic testcase, it's still WIP, but it works. Of course we can polish the testcode a little, but I think that's not high priority at the moment. Further, we potentially need to extend the tests anyway.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8568280&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568280</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c49"><div class="comment" data-id="9952816" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 11:36 PST" data-time="1424806614">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-49" data-comment-id="9952816">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c47">comment #47</a>)
<span class="quote">&gt; Created <span class="bz_obsolete"><a href="/attachment.cgi?id=8568664" name="attach_8568664" title="Propagate referrer policy throughout the UI.">attachment 8568664</a> <a href="/attachment.cgi?id=8568664&amp;action=edit" title="Propagate referrer policy throughout the UI.">[details]</a> <a href="/attachment.cgi?id=8568664&amp;action=diff" title="Propagate referrer policy throughout the UI.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8568664'>[review]</a>
&gt; Propagate referrer policy throughout the UI.
&gt; 
&gt; Christoph - in case this helps you.  Unpolished and no automatic tests, but
&gt; shows what/where to change.  Tested command-click and context menu's new
&gt; {tab,window} by hand with
&gt; meta-referrer={unsafe-URL,origin,origin-when-crossorigin}; all seem to work
&gt; per current spec.</span >

That's great - thanks for providing the patch - I'll take a look right away.</pre></div><div class="change-set" id="c50"><div class="comment" data-id="9952900" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 11:55 PST" data-time="1424807736">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8568722"
         class="attachment patch obsolete"
         data-id="8568722" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="broswer_referrer_tests.patch">
      <meta itemprop="contentSize" content="11674">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8568722">
          <a class="link" href="attachment.cgi?id=8568722&amp;action=diff">
        <span id="att-8568722-description" itemprop="description">broswer_referrer_tests.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8568722&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568722">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-50" data-comment-id="9952900">Alex, your code looks good, passes all the automatic tests - I need to fine grain them though, because at the moment I am only testing:
<span class="quote">&gt;   &lt;meta name=&quot;referrer&quot; content=&quot;origin&quot;&gt;</span ></pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8568706&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568706</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c51"><div class="comment" data-id="9953365" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 13:31 PST" data-time="1424813494">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8568784"
         class="attachment patch obsolete"
         data-id="8568784" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="broswer_referrer_tests.patch">
      <meta itemprop="contentSize" content="15560">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8568784">
          <a class="link" href="attachment.cgi?id=8568784&amp;action=diff">
        <span id="att-8568784-description" itemprop="description">broswer_referrer_tests.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8568784&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8568784">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-51" data-comment-id="9953365">&#64;Alex: your patch seems to work really well - do you wanna finish it up since you already provided the whole patch? Or do you want me to take over? But I don't think there is every much to do anymore.

&#64;Sid: Here are testcases, fully automatic, but they time out - please let me know which ones you want to keep. I don't think we need all of them on TBPL, but it's still nice to test offline to make sure everything works correctly. Whenever you get a chance, please take a look at the test - I am also happy to rewrite and simplify, just let me know.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8568722&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568722</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8568784&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568784</a> -
        Flags: feedback?(sstamm)</div></div></div><div class="change-set" id="c52"><div class="comment" data-id="9953686" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a5409796_495955"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 14:38 PST" data-time="1424817481">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="9953686">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c51">comment #51</a>)
<span class="quote">&gt; &#64;Sid: Here are testcases, fully automatic, but they time out - please let me
&gt; know which ones you want to keep.</span >

To solve the timeout, can you just split them into three test files (one for each case)?  I'd rather have more test coverage here than less, given the complexity of the feature.</pre></div><div class="change-set" id="c53"><div class="comment" data-id="9954272" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-24 16:41 PST" data-time="1424824869">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="9954272">&#64;Christoph: it'd be best if you could take this over - I'm short on time.  A few things you might want to consider:

1. nsIWebNavigation::loadURIWithBase should probably be renamed to loadURIWithOptions and changed to take an options struct, similarly to nsIDocShell::loadURI.  A JS util function could convert the JS params dict to this struct, to make it easier to call.  (Changing nsIWebNavitation::loadURI seems like a non-starter - too many call sites; but changing loadURIWithBase sounds like a good idea - it's a subset, it's new, and it's only used in view-source.)

2. I only tested this with multi-process.  Not expecting any issues with single-process, but it certainly needs to be run through - single-process is using different browser &amp; webNavigation objects.

3. The test should probably also cover origin-when-crossorigin.  Current tests cover propagation of the referrer policy, but not of the triggering principal.  It works, probably via some global state, but the test doesn't cover it.  A single same-origin case should be sufficient - if it uses the wrong triggering principal, it would truncate referrer to just origin.

(As an aside, if I were to pick just one test case for this bug, that would be HTTPS -&gt; HTTP with meta-referrer=origin.  It would catch both failure to propagate the referrer policy, and also failure to trump the default policy.  My second choice would be origin-when-crossorigin, to test propagation of the triggering principal.  My third choice would be rel=noreferrer, to test that it trumps the meta-tag.  And then the cross-product of the default referrer policy cases - they're certainly most important, but also least likely to break.  As Sid says, the more the merrier, but if there's need to prioritize tests, those would be my picks.)

4. There's also save-as, view-source, and print.  And metro and maybe other forks (android?).  I'd file separate bugs for those - the scope of this one is already plenty large enough.</pre></div><div class="change-set" id="c54"><div class="comment" data-id="9955220" data-no="54"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-54" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-54"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-54" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c54">Comment 54</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-25 00:05 PST" data-time="1424851502">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-54">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-54" data-comment-id="9955220"><span class="quote">&gt; 1. nsIWebNavigation::loadURIWithBase should probably be renamed to
&gt; loadURIWithOptions and changed to take an options struct, similarly to
&gt; nsIDocShell::loadURI.</span >

Thinking more about it, renaming loadURIWithBase to loadURIWithOptions is probably a good idea, but passing a struct here seems like more boilerplate than it's worth.  Since all the non-trivial usage is from JS, it'd be simpler to write a JS wrapper that takes a params dict and calls loadURIWithOptions with the long complete list of parameters.

<span class="quote">&gt; 2. I only tested this with multi-process.  Not expecting any issues with
&gt; single-process, but it certainly needs to be run through - single-process is
&gt; using different browser &amp; webNavigation objects.</span >

Did a bit of manual testing with single-process too.  Works fine.

Leaving the rest in Christoph's able hands.</pre></div><div class="change-set" id="c55"><div class="comment" data-id="9959003" data-no="55"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-55" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-55"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-55" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c55">Comment 55</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-25 14:36 PST" data-time="1424903807">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-55">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8569473"
         class="attachment patch obsolete"
         data-id="8569473" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug_1113431_referrer_tests.patch">
      <meta itemprop="contentSize" content="23798">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8569473">
          <a class="link" href="attachment.cgi?id=8569473&amp;action=diff">
        <span id="att-8569473-description" itemprop="description">bug_1113431_referrer_tests.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8569473&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8569473">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-55" data-comment-id="9959003">Hey Sid,

I factored out the common code and extended the tests to cover the following policies:
* origin
* no-referrer
* no-referrer-when-downgrade
* origin-when-crossorigin
* unsafe-url

The tests cover going from:
* http-&gt;http
* http-&gt;https
* https-&gt;https
* https-&gt;http

Further, the tests include coverage for:
* simple left clicks
* right-click -&gt; open link in tab
* ctrl-click

When thinking about it there are other scenarios as well, not sure if we need automated tests for those as well:
* drag and drop the URL into a new tab
* drag and drop the URL into a new window
* use keyboard navigation to open the link (e.g. using tab and then hitting ctrl-enter


Let me know what you think - all the tests work fine with Alex patch applied.

&#64;Alex: Thanks again for providing the patch, I will follow your suggestions and finalize your work.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8568784&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568784</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8568784&amp;action=edit"
           title="broswer_referrer_tests.patch"
           class=""
        >Attachment #8568784</a> -
        Flags: <span class="activity-deleted">feedback?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8569473&amp;action=edit"
           title="bug_1113431_referrer_tests.patch"
           class=""
        >Attachment #8569473</a> -
        Flags: feedback?(sstamm)</div></div></div><div class="change-set" id="c56"><div class="comment" data-id="9959085" data-no="56"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-56" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-56"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-56" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c56">Comment 56</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-25 14:54 PST" data-time="1424904847">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-56">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-56" data-comment-id="9959085">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c53">comment #53</a>)
<span class="quote">&gt; &#64;Christoph: it'd be best if you could take this over - I'm short on time.  A
&gt; few things you might want to consider:
&gt; 
&gt; 1. nsIWebNavigation::loadURIWithBase should probably be renamed to
&gt; loadURIWithOptions and changed to take an options struct, similarly to
&gt; nsIDocShell::loadURI.  A JS util function could convert the JS params dict
&gt; to this struct, to make it easier to call.  (Changing
&gt; nsIWebNavitation::loadURI seems like a non-starter - too many call sites;
&gt; but changing loadURIWithBase sounds like a good idea - it's a subset, it's
&gt; new, and it's only used in view-source.)</span >

That sounds reasonable to me.

<span class="quote">&gt; 2. I only tested this with multi-process.  Not expecting any issues with
&gt; single-process, but it certainly needs to be run through - single-process is
&gt; using different browser &amp; webNavigation objects.</span >

Works fine on single process (at least passes all the automated tests we have so far).
 
<span class="quote">&gt; 3. The test should probably also cover origin-when-crossorigin.  Current
&gt; tests cover propagation of the referrer policy, but not of the triggering
&gt; principal.  It works, probably via some global state, but the test doesn't
&gt; cover it.  A single same-origin case should be sufficient - if it uses the
&gt; wrong triggering principal, it would truncate referrer to just origin.</span >

That is a good point - I will incorporate such a test once I get feedback from Sid.

<span class="quote">&gt; (As an aside, if I were to pick just one test case for this bug, that would
&gt; be HTTPS -&gt; HTTP with meta-referrer=origin.  It would catch both failure to
&gt; propagate the referrer policy, and also failure to trump the default policy.
&gt; My second choice would be origin-when-crossorigin, to test propagation of
&gt; the triggering principal.  My third choice would be rel=noreferrer, to test
&gt; that it trumps the meta-tag.  And then the cross-product of the default
&gt; referrer policy cases - they're certainly most important, but also least
&gt; likely to break.  As Sid says, the more the merrier, but if there's need to
&gt; prioritize tests, those would be my picks.)</span >

Since I splitted the tests, they don't time out anymore and we can keep all of them.

<span class="quote">&gt; 4. There's also save-as, view-source, and print.  And metro and maybe other
&gt; forks (android?).  I'd file separate bugs for those - the scope of this one
&gt; is already plenty large enough.</span >

I agree, this bug already covers a lot by itself.</pre></div><div class="change-set" id="c57"><div class="comment" data-id="9959483" data-no="57"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-57" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-57"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-57" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c57">Comment 57</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-25 16:24 PST" data-time="1424910254">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-57">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8569532"
         class="attachment patch obsolete"
         data-id="8569532" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug_1113431_referrer.patch">
      <meta itemprop="contentSize" content="47205">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8569532">
          <a class="link" href="attachment.cgi?id=8569532&amp;action=diff">
        <span id="att-8569532-description" itemprop="description">bug_1113431_referrer.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8569532&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8569532">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-57" data-comment-id="9959483">Sid: I rebased Alex's patch and (for now) I just replaced loadURIWithBase to loadURIWithOptions. Even though I like Alex's suggestion in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c53">Comment 53</a> to use a struct that we can hand to loadURIWithOptions I am not sure if we want to introduce that change at the moment given that we have to uplift the change to 37.

I already had to rebase the patch and probably lots of things changed between 37 and now. In other words, I am worried that we introduce other problems if we perform too big of a change.

Currently loadURIWithOptions takes 7 arguments, which is not too bad in my opinion.

Anyway, I think the patch looks great by itself. What do you think?

Also, Alex left some comments in the code - can you also have a look at those and tell me what you think? e.g. saveURL.

So far this looks good, the patch passes all the automatic tests we have at the moment, but probably we should add some more (see my previous comment when I uploaded the latest test patch).</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8568664&amp;action=edit"
           title="Propagate referrer policy throughout the UI."
           class=""
        >Attachment #8568664</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8569532&amp;action=edit"
           title="bug_1113431_referrer.patch"
           class=""
        >Attachment #8569532</a> -
        Flags: feedback?(sstamm)</div></div></div><div class="change-set" id="c58"><div class="comment" data-id="9961062" data-no="58"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-58" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a5409796_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-58"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-58" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c58">Comment 58</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-26 02:11 PST" data-time="1424945485">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-58">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-58" data-comment-id="9961062">We won't fix that for 36</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=isnotempty">status-firefox36</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox36&amp;o1=equals&amp;v1=wontfix">wontfix</a></div></div></div><div class="change-set" id="c59"><div class="comment" data-id="9966999" data-no="59"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-59" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a5409796_495955"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-59"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-59" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c59">Comment 59</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-27 07:45 PST" data-time="1425051906">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-59">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-59" data-comment-id="9966999">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8569532" name="attach_8569532" title="bug_1113431_referrer.patch">attachment 8569532</a> <a href="/attachment.cgi?id=8569532&amp;action=edit" title="bug_1113431_referrer.patch">[details]</a> <a href="/attachment.cgi?id=8569532&amp;action=diff" title="bug_1113431_referrer.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8569532'>[review]</a>
bug_1113431_referrer.patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8569532" name="attach_8569532" title="bug_1113431_referrer.patch">attachment 8569532</a> <a href="/attachment.cgi?id=8569532&amp;action=edit" title="bug_1113431_referrer.patch">[details]</a> <a href="/attachment.cgi?id=8569532&amp;action=diff" title="bug_1113431_referrer.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8569532'>[review]</a>:
-----------------------------------------------------------------

I think this looks good.  You'll obviously need review from browser/toolkit peers, and a super-review or at least interface design review for docshell (probably bz).  Here are a couple specific bits of feedback.

::: browser/base/content/browser.js
&#64;&#64; +1982,5 &#64;&#64;
<span class="quote">&gt;  /* Required because the tab needs time to set up its content viewers and get the load of
&gt;     the URI kicked off before becoming the active content area. */
&gt;  function delayedOpenTab(aUrl, aReferrer, aCharset, aPostData, aAllowThirdPartyFixup)
&gt;  {
&gt; +  // TODO(averstak): referrerPolicy? this function appears unused.</span >

Need to resolve or delete this todo.

::: browser/base/content/utilityOverlay.js
&#64;&#64; +102,5 &#64;&#64;
<span class="quote">&gt;      params = {
&gt;        allowThirdPartyFixup: aAllowThirdPartyFixup,
&gt;        postData: aPostData,
&gt;        referrerURI: aReferrerURI,
&gt; +      // Default referrer policy is fine for UI links.</span >

Please make the comment clear that you're omitting the referrer policy or set the default here.

&#64;&#64; +198,5 &#64;&#64;
<span class="quote">&gt;      params = {
&gt;        allowThirdPartyFixup: aAllowThirdPartyFixup,
&gt;        postData: aPostData,
&gt;        referrerURI: aReferrerURI
&gt; +      // Default referrer policy is fine for UI links.</span >

Here too, please.

&#64;&#64; +233,5 &#64;&#64;
<span class="quote">&gt;        Components.utils.reportError(&quot;openUILink/openLinkIn was called with &quot; +
&gt;          &quot;where == 'save' but without initiatingDoc.  See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - bug 795065 broke calling openUILink without an event parameter"
   href="/show_bug.cgi?id=814264">bug 814264</a>.&quot;);
&gt;        return;
&gt;      }
&gt; +    // TODO(averstak): referrerPolicy?</span >

This todo needs addressing.

&#64;&#64; +269,5 &#64;&#64;
<span class="quote">&gt;      allowThirdPartyFixupSupports.data = aAllowThirdPartyFixup;
&gt;  
&gt; +    var referrerPolicySupports = Cc[&quot;&#64;mozilla.org/supports-PRInt32;1&quot;].
&gt; +                                 createInstance(Ci.nsISupportsPRInt32);
&gt; +    referrerPolicySupports.data = aReferrerPolicy || 0;</span >

Please use a referrer policy constant/enum instead of &quot;0&quot; here.
See nsIHttpChannel (<a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/netwerk/protocol/http/nsIHttpChannel.idl#63">http://mxr.mozilla.org/mozilla-central/source/netwerk/protocol/http/nsIHttpChannel.idl#63</a>).

::: docshell/base/nsDocShell.cpp
&#64;&#64; +4859,5 &#64;&#64;
<span class="quote">&gt;  
&gt;    loadInfo-&gt;SetLoadType(ConvertLoadTypeToDocShellLoadInfo(loadType));
&gt;    loadInfo-&gt;SetPostDataStream(postStream);
&gt;    loadInfo-&gt;SetReferrer(aReferringURI);
&gt; +  loadInfo-&gt;SetReferrerPolicy(aReferrerPolicy);</span >

Since this is an implementation of a semi-public interface, it's probably a good idea to do validation of the aReferrerPolicy argument value before setting loadInfo so we don't end up with some weird referrer policy value.

::: toolkit/components/viewsource/content/viewPartialSource.js
&#64;&#64; +176,5 &#64;&#64;
<span class="quote">&gt; +  getWebNavigation().loadURIWithOptions((isHTML ?
&gt; +                                         &quot;<a rel="nofollow" href="view-source:data:text/html;charset=utf-8">view-source:data:text/html;charset=utf-8</a>,&quot; :
&gt; +                                         &quot;<a rel="nofollow" href="view-source:data:application/xml;charset=utf-8">view-source:data:application/xml;charset=utf-8</a>,&quot;)
&gt; +                                        + encodeURIComponent(tmpNode.innerHTML),
&gt; +                                        loadFlags, null, 0, null, null,</span >

Maybe clearer to use a constant/enum or explain why you're sending zero for this argument.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8569532&amp;action=edit"
           title="bug_1113431_referrer.patch"
           class=""
        >Attachment #8569532</a> -
        Flags: feedback?(sstamm) &rarr; feedback+</div></div></div><div class="change-set" id="c60"><div class="comment" data-id="9967131" data-no="60"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-60" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a5409796_495955"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-60"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-60" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c60">Comment 60</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-02-27 08:20 PST" data-time="1425054011">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-60">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-60" data-comment-id="9967131">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8569473" name="attach_8569473" title="bug_1113431_referrer_tests.patch">attachment 8569473</a> <a href="/attachment.cgi?id=8569473&amp;action=edit" title="bug_1113431_referrer_tests.patch">[details]</a> <a href="/attachment.cgi?id=8569473&amp;action=diff" title="bug_1113431_referrer_tests.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8569473'>[review]</a>
bug_1113431_referrer_tests.patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8569473" name="attach_8569473" title="bug_1113431_referrer_tests.patch">attachment 8569473</a> <a href="/attachment.cgi?id=8569473&amp;action=edit" title="bug_1113431_referrer_tests.patch">[details]</a> <a href="/attachment.cgi?id=8569473&amp;action=diff" title="bug_1113431_referrer_tests.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8569473'>[review]</a>:
-----------------------------------------------------------------

These tests look pretty good.  I'm concerned they're still pretty long and may time out on some platforms, so a try run is warranted before getting these reviewed and landed.  Thanks for tackling this!</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8569473&amp;action=edit"
           title="bug_1113431_referrer_tests.patch"
           class=""
        >Attachment #8569473</a> -
        Flags: feedback?(sstamm) &rarr; feedback+</div></div></div><div class="change-set" id="c61"><div class="comment" data-id="9980314" data-no="61"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-61" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-61"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-61" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c61">Comment 61</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-03 10:04 PST" data-time="1425405862">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-61">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-61" data-comment-id="9980314">&#64;Christoph - I have my evenings back, and can wrap this up if you prefer.  Please let me know.  My strategy would be to clean this up per Sid's comments, and to file followup bugs for anything that's non-trivial to do or to unittest.  Hoping that this makes it into 37, with some time to bake on the beta.</pre><div class="activity"><div class="change">Flags: needinfo?(mozilla)</div></div></div><div class="change-set" id="c62"><div class="comment" data-id="9980362" data-no="62"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-62" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a5409796_495955"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-62"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-62" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c62">Comment 62</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-03 10:15 PST" data-time="1425406510">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-62">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-62" data-comment-id="9980362">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c61">comment #61</a>)
<span class="quote">&gt; &#64;Christoph - I have my evenings back, and can wrap this up if you prefer. 
&gt; Please let me know.  My strategy would be to clean this up per Sid's
&gt; comments, and to file followup bugs for anything that's non-trivial to do or
&gt; to unittest.  Hoping that this makes it into 37, with some time to bake on
&gt; the beta.</span >

Alex, that's great - please do. I had everything on TRY the other day and seems tests time out:
<span class="quote">&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f270fb202f56">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f270fb202f56</a></span >

The good news, your patch seems to work just fine. So, I am going to break the tests yet again (also including some same origin tests).

I will leave you patch untouched - thanks for doing all this - you are awesome!</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(mozilla)</span></div></div></div><div class="change-set" id="c63"><div class="comment" data-id="9983337" data-no="63"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-63" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-63"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-63" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c63">Comment 63</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-03 23:32 PST" data-time="1425454321">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-63">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-63" data-comment-id="9983337">(In reply to Sid Stamm [:geekboy or :sstamm] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c59">comment #59</a>)
<span class="quote">&gt; ::: browser/base/content/browser.js
&gt; &#64;&#64; +1982,5 &#64;&#64;
&gt; &gt;  /* Required because the tab needs time to set up its content viewers and get the load of
&gt; &gt;     the URI kicked off before becoming the active content area. */
&gt; &gt;  function delayedOpenTab(aUrl, aReferrer, aCharset, aPostData, aAllowThirdPartyFixup)
&gt; &gt;  {
&gt; &gt; +  // TODO(averstak): referrerPolicy? this function appears unused.
&gt; 
&gt; Need to resolve or delete this todo.</span >

Deleted todo.  Seems unwise to increase the scope of this patch - it's plenty large enough already.

<span class="quote">&gt; &#64;&#64; +233,5 &#64;&#64;
&gt; &gt;        Components.utils.reportError(&quot;openUILink/openLinkIn was called with &quot; +
&gt; &gt;          &quot;where == 'save' but without initiatingDoc.  See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - bug 795065 broke calling openUILink without an event parameter"
   href="/show_bug.cgi?id=814264">bug 814264</a>.&quot;);
&gt; &gt;        return;
&gt; &gt;      }
&gt; &gt; +    // TODO(averstak): referrerPolicy?
&gt; 
&gt; This todo needs addressing.</span >

Looks like <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - add referrer policy support to Downloads.jsm"
   href="/show_bug.cgi?id=1073187">bug 1073187</a>; changed the comment to reference it.

<span class="quote">&gt; ::: docshell/base/nsDocShell.cpp
&gt; &#64;&#64; +4859,5 &#64;&#64;
&gt; &gt;  
&gt; &gt;    loadInfo-&gt;SetLoadType(ConvertLoadTypeToDocShellLoadInfo(loadType));
&gt; &gt;    loadInfo-&gt;SetPostDataStream(postStream);
&gt; &gt;    loadInfo-&gt;SetReferrer(aReferringURI);
&gt; &gt; +  loadInfo-&gt;SetReferrerPolicy(aReferrerPolicy);
&gt; 
&gt; Since this is an implementation of a semi-public interface, it's probably a
&gt; good idea to do validation of the aReferrerPolicy argument value before
&gt; setting loadInfo so we don't end up with some weird referrer policy value.</span >

I don't think this is a good place to do validation.  It's just another stop on the long train to the http channel.  E.g., one could easily bypass it by QI'ing webnav to docshell and filling loadInfo directly.

Validation, if any, probably belongs all the way in HttpBaseChannel::SetReferrerWithPolicy, because that's the first and only function that does something useful with the value.

Thoughts?

Addressed all the other review comments.  Will slice it into smaller patches and send them out shortly.</pre></div><div class="change-set" id="c64"><div class="comment" data-id="9983393" data-no="64"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-64" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-64"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-64" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c64">Comment 64</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-03 23:52 PST" data-time="1425455536">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-64">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8572479"
         class="attachment patch obsolete"
         data-id="8572479" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-webnav.patch">
      <meta itemprop="contentSize" content="16527">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8572479">
          <a class="link" href="attachment.cgi?id=8572479&amp;action=diff">
        <span id="att-8572479-description" itemprop="description">accept referrer policy in webNav.loadURIWithOptions</span></a> (obsolete)
        — <a href="attachment.cgi?id=8572479&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8572479">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-64" data-comment-id="9983393">Renamed webNav.loadURIWithBase (added recently in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Relative links not linkified in &quot;View Selection Source&quot;"
   href="/show_bug.cgi?id=464222">bug 464222</a>) to loadURIWithOptions and added the referrerPolicy argument.  Updated various wrappers and the only real call site - view-source.  Added an implementation to the e10s version.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: superreview?(gavin.sharp)</div><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: review?(sstamm)</div></div></div><div class="change-set" id="c65"><div class="comment" data-id="9983418" data-no="65"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-65" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-65"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-65" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c65">Comment 65</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 00:00 PST" data-time="1425456012">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-65">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8572483"
         class="attachment patch obsolete"
         data-id="8572483" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="31990">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8572483">
          <a class="link" href="attachment.cgi?id=8572483&amp;action=diff">
        <span id="att-8572483-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8572483&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8572483">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-65" data-comment-id="9983418">Covers {command,middle}-click and open-in-new-{tab,window} from the context menu.  Tested manually and with Christoph's automatic test.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Flags: superreview?(gavin.sharp)</div><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Flags: review?(sstamm)</div></div></div><div class="change-set" id="c66"><div class="comment" data-id="9983470" data-no="66"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-66" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a5409796_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-66"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-66" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c66">Comment 66</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 00:20 PST" data-time="1425457254">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-66">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-66" data-comment-id="9983470">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c62">comment #62</a>)
<span class="quote">&gt; I had everything on TRY the other day and seems tests time out:
&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f270fb202f56">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=f270fb202f56</a></span >

Other alternatives:

1. requestLongerTimeout(240) at the top of test().

2. Reduce the number of test cases - see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c53">comment 53</a>.

3. Parallelize the loads of the source pages, e.g., load them all into one tab with lots of iframes.  There'd still be 40 tabs/windows to open one-at-a-time after that, but at least it wouldn't open each source page in its own new tab too - so it should be 2X faster.</pre></div><div class="change-set" id="c67"><div class="comment" data-id="9986183" data-no="67"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-67" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a5409796_495955"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" id="a5409796_495955"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-67"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-67" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c67">Comment 67</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 10:39 PST" data-time="1425494366">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-67">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-67" data-comment-id="9986183">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8572479" name="attach_8572479" title="accept referrer policy in webNav.loadURIWithOptions">attachment 8572479</a> <a href="/attachment.cgi?id=8572479&amp;action=edit" title="accept referrer policy in webNav.loadURIWithOptions">[details]</a> <a href="/attachment.cgi?id=8572479&amp;action=diff" title="accept referrer policy in webNav.loadURIWithOptions">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8572479'>[review]</a>
accept referrer policy in webNav.loadURIWithOptions

I'm not familiar with the background of loadURIWithBase, but assuming it is relatively new and that there are no compatibility issues with renaming it (including from possible use in add-ons), renaming it seems fine. I agree this is a better name.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: <span class="activity-deleted">superreview?(gavin.sharp)</span></div><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: superreview?(bugs)</div><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: feedback+</div></div></div><div class="change-set" id="a6544138_103593"><div class="change" id="aa6544138_103593">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a6544138_103593"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_103593" id="a6544138_103593"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6544138_103593"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6544138_103593">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a6544138_103593">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 10:39 PST" data-time="1425494388">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Flags: superreview?(gavin.sharp) &rarr; review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c68"><div class="comment" data-id="9987631" data-no="68"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-68" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_39966" id="a6544138_103593"><img src="https://secure.gravatar.com/avatar/7ba0f00f24191ccef0d14185bd7ca4ca?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_39966" id="a6544138_103593"><a class="email " href="/user_profile?user_id=39966" > <span class="fna">Olli Pettay [:smaug]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-68"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-68" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c68">Comment 68</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 14:27 PST" data-time="1425508074">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-68">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-68" data-comment-id="9987631">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8572479" name="attach_8572479" title="accept referrer policy in webNav.loadURIWithOptions">attachment 8572479</a> <a href="/attachment.cgi?id=8572479&amp;action=edit" title="accept referrer policy in webNav.loadURIWithOptions">[details]</a> <a href="/attachment.cgi?id=8572479&amp;action=diff" title="accept referrer policy in webNav.loadURIWithOptions">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8572479'>[review]</a>
accept referrer policy in webNav.loadURIWithOptions

bz reviewed both <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Implement &lt;meta name=&quot;referrer&quot;&gt;"
   href="/show_bug.cgi?id=704320">bug 704320</a> and LoadURIWithBase, so would be better to get review from him.
But if he is busy, move the request back to my queue.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: superreview?(bugs) &rarr; superreview?(bzbarsky)</div></div></div><div class="change-set" id="c69"><div class="comment" data-id="9987901" data-no="69"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-69" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6544138_103593"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6544138_103593"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-69"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-69" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c69">Comment 69</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-04 15:19 PST" data-time="1425511142">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-69">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-69" data-comment-id="9987901">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8572483" name="attach_8572483" title="propagate referrer policy throughout the ui">attachment 8572483</a> <a href="/attachment.cgi?id=8572483&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8572483&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8572483'>[review]</a>
propagate referrer policy throughout the ui

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8572483" name="attach_8572483" title="propagate referrer policy throughout the ui">attachment 8572483</a> <a href="/attachment.cgi?id=8572483&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8572483&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8572483'>[review]</a>:
-----------------------------------------------------------------

I'll look at the rest tomorrow, but here are some initial comments from looking at the easy bits...

::: browser/components/sessionstore/ContentRestore.jsm
&#64;&#64; +200,5 &#64;&#64;
<span class="quote">&gt;          }
&gt;          let referrer = loadArguments.referrer ?
&gt;                         Utils.makeURI(loadArguments.referrer) : null;
&gt; +        let referrerPolicy = loadArguments.referrerPolicy ||
&gt; +                             Ci.nsIHttpChannel.REFERRER_POLICY_NO_REFERRER_WHEN_DOWNGRADE;</span >

Am I paranoid for wanting to encode this &quot;default&quot; somewhere else than in lots of hardcoded references to it, e.g. by adding a static readonly default policy property to nsIHttpChannel, rather than referring directly to this?

::: dom/webidl/Document.webidl
&#64;&#64; +208,5 &#64;&#64;
<span class="quote">&gt; +   * Current referrer policy - one of the REFERRER_POLICY_* constants
&gt; +   * from nsIHttpChannel.
&gt; +   */
&gt; +  [ChromeOnly]
&gt; +  readonly attribute unsigned long? referrerPolicy;</span >

I'm pretty sure I'm not officially able to review this bit of the patch. Should it have been in the other patch?</pre></div><div class="change-set" id="c70"><div class="comment" data-id="9989510" data-no="70"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-70" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6544138_103593"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6544138_103593"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-70"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-70" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c70">Comment 70</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 00:26 PST" data-time="1425543995">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-70">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8573098"
         class="attachment patch obsolete"
         data-id="8573098" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-api.patch">
      <meta itemprop="contentSize" content="18622">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8573098">
          <a class="link" href="attachment.cgi?id=8573098&amp;action=diff">
        <span id="att-8573098-description" itemprop="description">Document and nsIWebNavigation changes for referrer policy in UI code</span></a> (obsolete)
        — <a href="attachment.cgi?id=8573098&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573098">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-70" data-comment-id="9989510">Sending this to bz because everyone is asking me to do that.

Full description in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c64">comment 64</a>.  Added Document.referrerPolicy and nsIHttpChannel.REFERRER_POLICY_DEFAULT per request from Gijs.

Compatibility-wise, loadURIWithBase was added on 2014/2/20, and I updated all the references I could find on mozilla-central.  Not sure how to check the addons - <a rel="nofollow" href="https://mxr.mozilla.org/addons/ident?i=loadURIWithBase&amp;filter">https://mxr.mozilla.org/addons/ident?i=loadURIWithBase&amp;filter</a>= seems to require an AMO admin account.  I could, of course, easily add another function and leave this one alone, but my gut feeling is that it's not necessary here.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: <span class="activity-deleted">superreview?(bzbarsky)</span></div><div class="change">
        <a href="/attachment.cgi?id=8572479&amp;action=edit"
           title="accept referrer policy in webNav.loadURIWithOptions"
           class=""
        >Attachment #8572479</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8573098&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573098</a> -
        Flags: superreview?(bzbarsky)</div><div class="change">
        <a href="/attachment.cgi?id=8573098&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573098</a> -
        Flags: review?(sstamm)</div></div></div><div class="change-set" id="c71"><div class="comment" data-id="9989514" data-no="71"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-71" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6544138_103593"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6544138_103593"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-71"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-71" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c71">Comment 71</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 00:30 PST" data-time="1425544238">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-71">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8573099"
         class="attachment patch obsolete"
         data-id="8573099" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="31005">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8573099">
          <a class="link" href="attachment.cgi?id=8573099&amp;action=diff">
        <span id="att-8573099-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8573099&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573099">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-71" data-comment-id="9989514">Addressed Gijs' feedback.  I do like REFERRER_POLICY_DEFAULT, I certainly do.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8572483&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8572483</a> -
        Flags: <span class="activity-deleted">review?(gijskruitbosch+bugs)</span></div><div class="change">
        <a href="/attachment.cgi?id=8573099&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573099</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="a6594314_526840"><div class="change" id="aa6594314_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6594314_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6594314_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a6594314_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 00:36 PST" data-time="1425544564">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573099&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573099</a> -
        Flags: review?(sstamm)</div></div></div><div class="change-set" id="c72"><div class="comment" data-id="9989645" data-no="72"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-72" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-72"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-72" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c72">Comment 72</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 01:16 PST" data-time="1425547006">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-72">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-72" data-comment-id="9989645">&#64;Christoph - would you mind if I take over the tests too?  I'll still bug you to submit a try run - I don't have committer access - but I think it would be more efficient for a single person to own the bug.

If so, can you please upload the latest tests?  The patch here doesn't seem to have open-in-new-window.  This would save me a bit of time.

My strategy with tests would be to reduce the total number of cases to about twenty, per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c53">comment 53</a>.  Opening a new tab takes several seconds on a debug build; doing this 40*4 times just doesn't seem to be worth it.  I think we'll get nearly all the benefit by testing propagation of two pieces of info - referrer policy and triggering principal - which can be covered with a small number of test cases.  There's little, if any, benefit from testing every combination of protocols and policy values - the UI code merely passes them on to the http channel, which is already covered by all-combinations tests.  Thoughts?</pre><div class="activity"><div class="change">Flags: needinfo?(mozilla)</div></div></div><div class="change-set" id="c73"><div class="comment" data-id="9990265" data-no="73"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-73" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6594314_526840"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-73"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-73" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c73">Comment 73</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 03:35 PST" data-time="1425555336">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-73">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-73" data-comment-id="9990265">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c70">comment #70</a>)
<span class="quote">&gt; Compatibility-wise, loadURIWithBase was added on 2014/2/20, and I updated
&gt; all the references I could find on mozilla-central.  Not sure how to check
&gt; the addons - <a rel="nofollow" href="https://mxr.mozilla.org/addons/ident?i=loadURIWithBase&amp;filter">https://mxr.mozilla.org/addons/ident?i=loadURIWithBase&amp;filter</a>=
&gt; seems to require an AMO admin account.  I could, of course, easily add
&gt; another function and leave this one alone, but my gut feeling is that it's
&gt; not necessary here.</span >

Indeed, this isn't called. That being said, I am worried about the add-on compat of the browser changes here... I'll have a look at that when I review (soon now, promise!).</pre></div><div class="change-set" id="c74"><div class="comment" data-id="9990517" data-no="74"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-74" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6594314_526840"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-74"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-74" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c74">Comment 74</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 05:03 PST" data-time="1425560609">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-74">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-74" data-comment-id="9990517">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573099" name="attach_8573099" title="propagate referrer policy throughout the ui">attachment 8573099</a> <a href="/attachment.cgi?id=8573099&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8573099&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573099'>[review]</a>
propagate referrer policy throughout the ui

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8573099" name="attach_8573099" title="propagate referrer policy throughout the ui">attachment 8573099</a> <a href="/attachment.cgi?id=8573099&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8573099&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573099'>[review]</a>:
-----------------------------------------------------------------

Please file a followup bug for seamonkey/thunderbird/comm-central, too. r- because of the browser.xml issue.

I've done a &quot;positive&quot; review, in that I've looked at all your changes and reviewed them. I haven't yet done a &quot;negative&quot; review, ie tried to go around the codebase to see if there's places you've missed. Before I do that (also considering this is for sure missing a bit of toolkit, and that might let you find more already), can you explain how you found / decided which bits to update here?

::: browser/base/content/browser.js
&#64;&#64; +855,5 &#64;&#64;
<span class="quote">&gt;        LoadInOtherProcess(browser, {
&gt;          uri: uri,
&gt;          flags: flags,
&gt;          referrer: referrer ? referrer.spec : null,
&gt; +        referrerPolicy: referrerPolicy</span >

Nit: add trailing comma, please (like previous line)

&#64;&#64; +1193,3 &#64;&#64;
<span class="quote">&gt;        else if (window.arguments.length &gt;= 3) {
&gt;          loadURI(uriToLoad, window.arguments[2], window.arguments[3] || null,
&gt; +                window.arguments[4] || false, window.arguments[5] || 0);</span >

Nit: The 0 here should be a reference to the DEFAULT_POLICY thing you added, so that if we change the default, it'll magically Just Work. :-)

Probably makes sense to stick that in a temp var so as not to make this fn call completely unreadable.

&#64;&#64; +4600,5 &#64;&#64;
<span class="quote">&gt;  nsBrowserAccess.prototype = {
&gt;    QueryInterface: XPCOMUtils.generateQI([Ci.nsIBrowserDOMWindow, Ci.nsISupports]),
&gt;  
&gt; +  _openURIInNewTab: function(aURI, aReferrer, aReferrerPolicy, aIsPrivate,
&gt; +                             aIsExternal, aForceNotRemote=false) {</span >

addons mxr indicates this might break tabmix plus.

Because this is &quot;private&quot; (underscore prefix), I don't think we should make the function signature ugly just to avoid this (and even if we did, it'd likely mean tabmixplus would *still* need work to get the referrer policy thing right), but I'll add keywords and CC the author.

&#64;&#64; +4651,5 &#64;&#64;
<span class="quote">&gt;      var newWindow = null;
&gt;      var isExternal = (aContext == Ci.nsIBrowserDOMWindow.OPEN_EXTERNAL);
&gt; +    var referrer = aOpener ? makeURI(aOpener.location.href) : null;
&gt; +    var referrerPolicy =
&gt; +        (aOpener &amp;&amp; aOpener.document &amp;&amp; aOpener.document.referrerPolicy) ||</span >

Why are you falsy-checking aOpener.document.referrerPolicy? I guess it's equivalent now because of the ||, but if the default were different, this would ignore the int being set to 0 (which is also falsy in JS).

Let's instead do:

var referrerPolicy = Ci.nsIHttpChannel.REFERRER_POLICY_DEFAULT;
if (aOpener &amp;&amp; aOpener.document) {
  referrerPolicy = aOpener.document.referrerPolicy;
}

Which should always work, AIUI.

&#64;&#64; +4658,5 &#64;&#64;
<span class="quote">&gt;      if (aOpener &amp;&amp; isExternal) {
&gt;        Cu.reportError(&quot;nsBrowserAccess.openURI did not expect an opener to be &quot; +
&gt;                       &quot;passed if the context is OPEN_EXTERNAL.&quot;);
&gt;        throw Cr.NS_ERROR_FAILURE;
&gt;      }</span >

Hm, looks like you moved these definitions quite early. They should go after this check (which throws), at least - probably right before the definition of isPrivate would make sense?

::: browser/base/content/tabbrowser.xml
&#64;&#64; +1854,5 &#64;&#64;
<span class="quote">&gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_FROM_EXTERNAL;
&gt;                if (aAllowMixedContent)
&gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_ALLOW_MIXED_CONTENT;
&gt;                try {
&gt; +                b.loadURIWithFlags(aURI, {</span >

b here is a &lt;browser&gt;, not a &lt;tabbrowser&gt;, so if you do this you need to update browser.xml to deal with this change, too...

That's a little bit of a can of worms, because it's toolkit... but I think you could probably make it take the same kind of object as you've written here, and call webNavigation.loadURIWithOptions instead of just loadURI.

This does make me wonder how you tested this change. We know from previous mucking about with aNoReferrer that our automated tests here are deficient and we break stuff when we change pretty much anything. These are already pretty big patches so I feel a little bad asking it, but if you *could* write *some* tests, at least, that would make me feel better.

&#64;&#64; +5557,5 &#64;&#64;
<span class="quote">&gt;            &lt;![CDATA[
&gt; +            var params = arguments[1];
&gt; +            if (typeof(params) == &quot;number&quot;) {
&gt; +              params = {
&gt; +                flags: aFlags, referrerURI: aReferrerURI, charset: aCharset,</span >

Nit: one per line, please

&#64;&#64; +5558,5 &#64;&#64;
<span class="quote">&gt; +            var params = arguments[1];
&gt; +            if (typeof(params) == &quot;number&quot;) {
&gt; +              params = {
&gt; +                flags: aFlags, referrerURI: aReferrerURI, charset: aCharset,
&gt; +                postData: aPostData</span >

Nit: add trailing comma

&#64;&#64; +5584,5 &#64;&#64;
<span class="quote">&gt; +            var params = arguments[1];
&gt; +            if (typeof(params) == &quot;number&quot;) {
&gt; +              params = {
&gt; +                flags: aFlags, referrerURI: aReferrerURI, charset: aCharset,
&gt; +                postData: aPostData</span >

Same here.

::: browser/base/content/utilityOverlay.js
&#64;&#64; +87,5 &#64;&#64;
<span class="quote">&gt;   * accepted by openUILinkIn, plus &quot;ignoreButton&quot; and &quot;ignoreAlt&quot;.
&gt;   */
&gt;  function openUILink(url, event, aIgnoreButton, aIgnoreAlt, aAllowThirdPartyFixup,
&gt;                      aPostData, aReferrerURI) {
&gt; +  const Ci = Components.interfaces;</span >

Nit: I'd just:

const kDefaultPolicy = Components.interfaces.nsIHttpChannel.REFERRER_POLICY_DEFAULT;

&#64;&#64; +190,5 &#64;&#64;
<span class="quote">&gt;   *   skipTabAnimation     (boolean)
&gt;   *   allowPinnedTabHostChange (boolean)
&gt;   */
&gt;  function openUILinkIn(url, where, aAllowThirdPartyFixup, aPostData, aReferrerURI) {
&gt; +  const Ci = Components.interfaces;</span >

Same.

&#64;&#64; +200,5 &#64;&#64;
<span class="quote">&gt;      params = {
&gt;        allowThirdPartyFixup: aAllowThirdPartyFixup,
&gt;        postData: aPostData,
&gt; +      referrerURI: aReferrerURI,
&gt; +      referrerPolicy: Ci.nsIHttpChannel.REFERRER_POLICY_DEFAULT</span >

Nit: add trailing comma here so we don't have to touch again if we're adding more properties.

&#64;&#64; +341,5 &#64;&#64;
<span class="quote">&gt;        flags |= Ci.nsIWebNavigation.LOAD_FLAGS_DISALLOW_INHERIT_OWNER;
&gt;  
&gt; +    w.gBrowser.loadURIWithFlags(url, {
&gt; +      flags: flags, referrerURI: aNoReferrer ? null : aReferrerURI,
&gt; +      referrerPolicy: aReferrerPolicy, postData: aPostData});</span >

Nit: now that this is already multiline, this would be slightly easier to read (esp. with the ternary) if every property was on its own line.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573099&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573099</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review-</div></div></div><div class="change-set" id="c75"><div class="comment" data-id="9990530" data-no="75"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-75" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6594314_526840"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-75"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-75" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c75">Comment 75</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 05:11 PST" data-time="1425561075">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-75">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-75" data-comment-id="9990530">Marking as add-on compat, see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c74">comment #74</a> (but note that a bunch of other fn signature changes may also impact add-ons, as will the IDL changes in the Document/nsIWebNavigation code).</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=addon-compat&amp;resolution=---">addon-compat</a></div></div></div><div class="change-set" id="c76"><div class="comment" data-id="9991975" data-no="76"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-76" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a6594314_526840"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-76"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-76" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c76">Comment 76</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 09:46 PST" data-time="1425577584">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-76">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-76" data-comment-id="9991975">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c72">comment #72</a>)
<span class="quote">&gt; &#64;Christoph - would you mind if I take over the tests too?  I'll still bug
&gt; you to submit a try run - I don't have committer access - but I think it
&gt; would be more efficient for a single person to own the bug.</span >

Alex, I don't mind at all and I think that makes perfect sense. You could/should also assign the bug to yourself so you get the credit for doing all the work here.

<span class="quote">&gt; If so, can you please upload the latest tests?  The patch here doesn't seem
&gt; to have open-in-new-window.  This would save me a bit of time.</span >

It was included in the try run, find it here
<span class="quote">&gt; <a rel="nofollow" href="https://hg.mozilla.org/try/rev/f270fb202f56">https://hg.mozilla.org/try/rev/f270fb202f56</a></span >
and just click 'raw' so you can download a diff.

<span class="quote">&gt; My strategy with tests would be to reduce the total number of cases to about
&gt; twenty, per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c53">comment 53</a>.  Opening a new tab takes several seconds on a debug
&gt; build; doing this 40*4 times just doesn't seem to be worth it.  I think
&gt; we'll get nearly all the benefit by testing propagation of two pieces of
&gt; info - referrer policy and triggering principal - which can be covered with
&gt; a small number of test cases.  There's little, if any, benefit from testing
&gt; every combination of protocols and policy values - the UI code merely passes
&gt; them on to the http channel, which is already covered by all-combinations
&gt; tests.  Thoughts?</span >

Sid and I discussed that yesterday and since the bug needs to be uplifted, we would like to have tests for all the different combinations (basically what we have at the moment). Plus, we would also need one for same origin (as you mentioned previously) which is not included in the current tests.
One other reason why we want all the combinations is that we could eliminate the original tests or at least convert them to fit into this new 'referrer test suite' we are about to create with this bug.

But we can ask Sid again to make sure! Sid?</pre><div class="activity"><div class="change">Flags: needinfo?(mozilla) &rarr; needinfo?(sstamm)</div></div></div><div class="change-set" id="c77"><div class="comment" data-id="9991998" data-no="77"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-77" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-77"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-77" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c77">Comment 77</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 09:50 PST" data-time="1425577812">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-77">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-77" data-comment-id="9991998">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c74">comment #74</a>)
<span class="quote">&gt; I've done a &quot;positive&quot; review, in that I've looked at all your changes and
&gt; reviewed them. I haven't yet done a &quot;negative&quot; review, ie tried to go around
&gt; the codebase to see if there's places you've missed. Before I do that (also
&gt; considering this is for sure missing a bit of toolkit, and that might let
&gt; you find more already), can you explain how you found / decided which bits
&gt; to update here?</span >

It all works. :-)  With and without e10s.

Tested by hand - middle-click and open-link-in-new-{tab,window,private-window} from the context menu with various referrer policies, then printed document.referrer on the console.  See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c0">comment 0</a>.

Also ran Christoph's excellent automatic tests - see his tests patch on top.  We need to trim these tests down a bit because they take too long, and cover interaction with rel=noreferrer.  But they actually do test exactly this bug.

You might want to apply the two patches and try it out yourself.  It's quick to test by hand - see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c0">comment 0</a>.

Will address detailed feedback and upload another version in the evening, when I have a bit of time.  Thanks for the lightning fast review!</pre></div><div class="change-set" id="c78"><div class="comment" data-id="9992169" data-no="78"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-78" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-78"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-78" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c78">Comment 78</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 10:16 PST" data-time="1425579399">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-78">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-78" data-comment-id="9992169">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c76">comment #76</a>)
<span class="quote">&gt; Sid and I discussed that yesterday and since the bug needs to be uplifted,
&gt; we would like to have tests for all the different combinations (basically
&gt; what we have at the moment). Plus, we would also need one for same origin
&gt; (as you mentioned previously) which is not included in the current tests.</span >

Also rel=noreferrer should trump the meta-tag.

<span class="quote">&gt; One other reason why we want all the combinations is that we could eliminate
&gt; the original tests or at least convert them to fit into this new 'referrer
&gt; test suite' we are about to create with this bug.</span >

I'm a noob here, so I have a very basic question - how long is too long for a UI test?  Suppose it takes ten minutes overall.  Is it reasonable to just shard it into ten 1-minute tests?  Or do I have to worry about the try-bot's overall capacity at this point?  How much of the overall try-bot capacity can I reasonably use for these tests - is there a guideline / limit?  Does it even run different UI tests in parallel, or am I going to slow down everyone's try runs by ten minutes no matter how the test is sharded?

Asking this because the http channel tests are much faster to run than the UI tests.  The channel tests can load lots of iframes in parallel, but the UI tests are limited to one click at a time, which takes several seconds per click.  If we're running up against the overall time limit, then it would make more sense to keep the exhaustive tests in the http channel, and keep the UI tests small and focused.

Also, keep in mind that adding interactions with rel=noreferrer will double the current test time.  And then someone's gonna land the referrer attribute, which would be another 3X.  And then there will be referrer CSP or something...  I'm afraid that no matter what the time limit is, all-combinations UI tests will exceed it soon enough.

Sid - thoughts?</pre></div><div class="change-set" id="c79"><div class="comment" data-id="9992242" data-no="79"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-79" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a6594314_526840"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-79"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-79" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c79">Comment 79</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 10:30 PST" data-time="1425580244">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-79">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-79" data-comment-id="9992242">Yeah.

<span class="quote">&gt; If we're running up against the overall time limit, then it would make more sense 
&gt; to keep the exhaustive tests in the http channel, and keep the UI tests small and 
&gt; focused.</span >

Do this.  Doesn't add a whole lot to do the exhaustive tests in an expensive way when we can check completeness in an easier way and spot-check using the UI tests.  Also the tests run on every check-in, so adding 10 min to the tests gets expensive quickly.

You can just spot-check rel=noreferrer too, don't need to be overly-complete since the &quot;overrides&quot; logic should be the same code path for many of the cases.</pre><div class="activity"><div class="change">Status: NEW &rarr; ASSIGNED</div><div class="change">Flags: <span class="activity-deleted">needinfo?(sstamm)</span></div></div></div><div class="change-set" id="c80"><div class="comment" data-id="9992265" data-no="80"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-80" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a6594314_526840"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-80"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-80" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c80">Comment 80</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 10:34 PST" data-time="1425580475">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-80">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-80" data-comment-id="9992265">Alex: I did some more manual testing and it 'seems drag and drop into a new tab' doesn't propagate the referrer. I will try to add an automatic testcase for that today. For now, I will use my current testsetup and then I let you incorporate the test into your setup. The integration should be fairly simple, I guess finding out how the drag and drop works automatically is the harder part.

Any chance you an you take a look at your patch and try to find out why it's not propagating for drag and drop operations?</pre><div class="activity"><div class="change">Flags: needinfo?(averstak)</div></div></div><div class="change-set" id="c81"><div class="comment" data-id="9993085" data-no="81"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-81" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-81"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-81" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c81">Comment 81</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 13:11 PST" data-time="1425589897">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-81">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-81" data-comment-id="9993085">&#64;Christoph - IIRC, the drag-and-drop code path doesn't propagate referrer at all, even in the normal meta-referrer-less same-origin HTTP-&gt;HTTP scenario.  My patch didn't change this; it seems unnecessary.

If that's something we want to reconsider, it would be best to file a separate bug.  The code change should be trivial, but I'm not sure that we want to do this from the policy perspective.  Actually, I'm pretty sure that we don't - neither FF35 nor Chrome41 currently set referrer on drag-and-drop, even with meta-referrer=always.  This seems to be working as intended; but please do file a separate bug if you disagree.

(OTOH, if you have an automatic test that covers drag-and-drop, I'd love to include it, and test that there's no referrer in this case.)</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(averstak)</span></div></div></div><div class="change-set" id="c82"><div class="comment" data-id="9994439" data-no="82"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-82" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a6594314_526840"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-82"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-82" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c82">Comment 82</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 18:17 PST" data-time="1425608225">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-82">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-82" data-comment-id="9994439">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573099" name="attach_8573099" title="propagate referrer policy throughout the ui">attachment 8573099</a> <a href="/attachment.cgi?id=8573099&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8573099&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573099'>[review]</a>
propagate referrer policy throughout the ui

Clearing review flag until you've addressed comments from Gijs</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573099&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573099</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div></div></div><div class="change-set" id="c83"><div class="comment" data-id="9994814" data-no="83"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-83" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6594314_526840"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6594314_526840"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-83"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-83" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c83">Comment 83</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 20:33 PST" data-time="1425616422">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-83">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-83" data-comment-id="9994814">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573098" name="attach_8573098" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8573098</a> <a href="/attachment.cgi?id=8573098&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8573098&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573098'>[review]</a>
Document and nsIWebNavigation changes for referrer policy in UI code

I guess the webnav change is OK.  Chances are not many binary things are using that API yet, and addons mxr shows no JS uses.

For the webidl change, though that return value should not be nullable.  The fact that it even compiles that way doesn't make me terribly happy, though I haven't figured out how to prevent it yet...

Please make it non-nullable.  sr=me with that.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573098&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573098</a> -
        Flags: superreview?(bzbarsky) &rarr; superreview+</div></div></div><div class="change-set" id="c84"><div class="comment" data-id="9994833" data-no="84"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-84" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a6594314_526840"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-84"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-84" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c84">Comment 84</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-05 20:37 PST" data-time="1425616635">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-84">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8573709"
         class="attachment patch obsolete"
         data-id="8573709" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="dragdrop.patch">
      <meta itemprop="contentSize" content="8602">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8573709">
          <a class="link" href="attachment.cgi?id=8573709&amp;action=diff">
        <span id="att-8573709-description" itemprop="description">dragdrop.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8573709&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573709">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-84" data-comment-id="9994833">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c81">comment #81</a>)
<span class="quote">&gt; &#64;Christoph - IIRC, the drag-and-drop code path doesn't propagate referrer at
&gt; all, even in the normal meta-referrer-less same-origin HTTP-&gt;HTTP scenario. 
&gt; My patch didn't change this; it seems unnecessary.</span >

Yes, you are right. I should have looked at the code first but nevertheless, I don't understand why:
* right click - open link in new tab, and
* drag and drop into new tab
are semantically any different and why one propagates the referrer and the other does not.

Anyway, I will follow up with Sid and others and I think we have to file a follow up to get that fixed so that both of these cases propagate the referrer.

<span class="quote">&gt; If that's something we want to reconsider, it would be best to file a
&gt; separate bug.  The code change should be trivial, but I'm not sure that we
&gt; want to do this from the policy perspective.  Actually, I'm pretty sure that
&gt; we don't - neither FF35 nor Chrome41 currently set referrer on
&gt; drag-and-drop, even with meta-referrer=always.  This seems to be working as
&gt; intended; but please do file a separate bug if you disagree.
&gt; 
&gt; (OTOH, if you have an automatic test that covers drag-and-drop, I'd love to
&gt; include it, and test that there's no referrer in this case.)</span >

I am attaching a testcase that tests drag and drop operations. Just a few notes:
* I had to copy in a few helper functions from:
<a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/test/newtab/head.js#495">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/test/newtab/head.js#495</a>
to make it work - unfortunately we end up having some duplicate code, but I think that's ok for testcode.

* Using 'todo_is' when performing the actual test - we have to update that, see the following link for any help:
<a rel="nofollow" href="https://developer.mozilla.org/en-US/docs/Mochitest#Test_functions">https://developer.mozilla.org/en-US/docs/Mochitest#Test_functions</a>
but I think the tricky part of the test is already there.


Please let me know if I can be of any more help - thanks again for taking on that work.</pre></div><div class="change-set" id="c85"><div class="comment" data-id="9995617" data-no="85"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-85" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-85"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-85" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c85">Comment 85</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 02:12 PST" data-time="1425636726">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-85">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8573850"
         class="attachment patch obsolete"
         data-id="8573850" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-api.patch">
      <meta itemprop="contentSize" content="19228">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8573850">
          <a class="link" href="attachment.cgi?id=8573850&amp;action=diff">
        <span id="att-8573850-description" itemprop="description">Document and nsIWebNavigation changes for referrer policy in UI code</span></a> (obsolete)
        — <a href="attachment.cgi?id=8573850&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573850">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-85" data-comment-id="9995617">Made Document.referrerPolicy non-nullable per bz's request, plus bindings.conf magic to make that compile.  Carrying sr=bz.

&#64;Sid - PTAL.  I think this addresses everyone's high-level API concerns, but I don't think I ever got a regular r+.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573098&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573098</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8573098&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573098</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8573850&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573850</a> -
        Flags: review?(sstamm)</div></div></div><div class="change-set" id="c86"><div class="comment" data-id="9995721" data-no="86"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-86" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-86"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-86" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c86">Comment 86</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 02:52 PST" data-time="1425639166">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-86">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-86" data-comment-id="9995721">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c74">comment #74</a>)
<span class="quote">&gt; Please file a followup bug for seamonkey/thunderbird/comm-central, too.</span >

Yep, will do.  Also android and metro, right?

<span class="quote">&gt; I've done a &quot;positive&quot; review, in that I've looked at all your changes and
&gt; reviewed them. I haven't yet done a &quot;negative&quot; review, ie tried to go around
&gt; the codebase to see if there's places you've missed. Before I do that (also
&gt; considering this is for sure missing a bit of toolkit, and that might let
&gt; you find more already), can you explain how you found / decided which bits
&gt; to update here?</span >

Logging and divination...

<span class="quote">&gt; ::: browser/base/content/tabbrowser.xml
&gt; &#64;&#64; +1854,5 &#64;&#64;
&gt; &gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_FROM_EXTERNAL;
&gt; &gt;                if (aAllowMixedContent)
&gt; &gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_ALLOW_MIXED_CONTENT;
&gt; &gt;                try {
&gt; &gt; +                b.loadURIWithFlags(aURI, {
&gt; 
&gt; b here is a &lt;browser&gt;, not a &lt;tabbrowser&gt;, so if you do this you need to
&gt; update browser.xml to deal with this change, too...
&gt; 
&gt; That's a little bit of a can of worms, because it's toolkit... but I think
&gt; you could probably make it take the same kind of object as you've written
&gt; here, and call webNavigation.loadURIWithOptions instead of just loadURI.</span >

It appears to call the loadURIWithOptions variants in tabbrowser.xml.  The one in toolkit/.../browser.xml was never called during my manual testing with various ways to open new tabs/windows.  Non-e10s calls the version in the &#64;tabbrowser-browser bindings; and e10s calls a combination of &#64;tabbrowser-remote-browser and &#64;tabbrowser-browser - they're both in tabbrowser.xml and are both updated in this patch.  (I don't know how this works internally; I just added a bit of logging to track down which functions get called.)

I could update browser.xml too, of course, but I don't know how to test that?  Nothing that I've done triggered that code path.  I added logging to it too, but never saw it log.

<span class="quote">&gt; This does make me wonder how you tested this change. We know from previous
&gt; mucking about with aNoReferrer that our automated tests here are deficient
&gt; and we break stuff when we change pretty much anything. These are already
&gt; pretty big patches so I feel a little bad asking it, but if you *could*
&gt; write *some* tests, at least, that would make me feel better.</span >

Yes, and they're good tests too, see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c77">comment 77</a> &amp; Christoph's patch.  Will send you the tests patch when it's ready - sorry, didn't have time to finish this tonight.</pre></div><div class="change-set" id="c87"><div class="comment" data-id="9995732" data-no="87"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-87" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-87"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-87" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c87">Comment 87</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 02:56 PST" data-time="1425639377">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-87">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8573866"
         class="attachment patch obsolete"
         data-id="8573866" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="30819">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8573866">
          <a class="link" href="attachment.cgi?id=8573866&amp;action=diff">
        <span id="att-8573866-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8573866&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8573866">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-87" data-comment-id="9995732">Addressed Gijs' style comments.  Allow non-zero default referrer policy (hypothetical, future).  Tested by hand and with Christoph's lovely tests patch.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573099&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573099</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8573866&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573866</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c88"><div class="comment" data-id="9995744" data-no="88"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-88" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6594314_526840"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-88"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-88" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c88">Comment 88</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 03:05 PST" data-time="1425639926">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-88">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-88" data-comment-id="9995744">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c86">comment #86</a>)
<span class="quote">&gt; (In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c74">comment #74</a>)
&gt; &gt; Please file a followup bug for seamonkey/thunderbird/comm-central, too.
&gt; 
&gt; Yep, will do.  Also android and metro, right?</span >

Yes.

<span class="quote">&gt; &gt; I've done a &quot;positive&quot; review, in that I've looked at all your changes and
&gt; &gt; reviewed them. I haven't yet done a &quot;negative&quot; review, ie tried to go around
&gt; &gt; the codebase to see if there's places you've missed. Before I do that (also
&gt; &gt; considering this is for sure missing a bit of toolkit, and that might let
&gt; &gt; you find more already), can you explain how you found / decided which bits
&gt; &gt; to update here?
&gt; 
&gt; Logging and divination...</span >

Heh, fair.

<span class="quote">&gt; &gt; ::: browser/base/content/tabbrowser.xml
&gt; &gt; &#64;&#64; +1854,5 &#64;&#64;
&gt; &gt; &gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_FROM_EXTERNAL;
&gt; &gt; &gt;                if (aAllowMixedContent)
&gt; &gt; &gt;                  flags |= Ci.nsIWebNavigation.LOAD_FLAGS_ALLOW_MIXED_CONTENT;
&gt; &gt; &gt;                try {
&gt; &gt; &gt; +                b.loadURIWithFlags(aURI, {
&gt; &gt; 
&gt; &gt; b here is a &lt;browser&gt;, not a &lt;tabbrowser&gt;, so if you do this you need to
&gt; &gt; update browser.xml to deal with this change, too...
&gt; &gt; 
&gt; &gt; That's a little bit of a can of worms, because it's toolkit... but I think
&gt; &gt; you could probably make it take the same kind of object as you've written
&gt; &gt; here, and call webNavigation.loadURIWithOptions instead of just loadURI.
&gt; 
&gt; It appears to call the loadURIWithOptions variants in tabbrowser.xml.  The
&gt; one in toolkit/.../browser.xml was never called during my manual testing
&gt; with various ways to open new tabs/windows.  Non-e10s calls the version in
&gt; the &#64;tabbrowser-browser bindings; and e10s calls a combination of
&gt; &#64;tabbrowser-remote-browser and &#64;tabbrowser-browser - they're both in
&gt; tabbrowser.xml and are both updated in this patch.  (I don't know how this
&gt; works internally; I just added a bit of logging to track down which
&gt; functions get called.)</span >

Ah, d'oh. Sorry, I should have realized that. You're right. I can tell you how it works: they are extensions of the default binding, and they are applied to the browsers that we create in tabbrowser through this bit of CSS: <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.css#49">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/browser.css#49</a>

<span class="quote">&gt; I could update browser.xml too, of course, but I don't know how to test
&gt; that?  Nothing that I've done triggered that code path.  I added logging to
&gt; it too, but never saw it log.</span >

Hmmmmm. For regular Firefox, this is not strictly necessary. For toolkit, it will be, I think.

I wonder how all this should work with view-source URLs. You can click links in those, and I expect they will use the regular toolkit browser binding, though I've not checked. I also don't know if the referrer policy of the original document does/should apply to the view-source document. (Though I expect it currently doesn't... not sure if that's an issue, and/or how much we care here.)

The other things that use regular browsers will probably still want updating... but we can leave that for a followup. We'd need to audit the relevant code (I suspect at least sidebars, social and Firefox Hello, off the top of my head). This patch is big enough as it is.

<span class="quote">&gt; &gt; This does make me wonder how you tested this change. We know from previous
&gt; &gt; mucking about with aNoReferrer that our automated tests here are deficient
&gt; &gt; and we break stuff when we change pretty much anything. These are already
&gt; &gt; pretty big patches so I feel a little bad asking it, but if you *could*
&gt; &gt; write *some* tests, at least, that would make me feel better.
&gt; 
&gt; Yes, and they're good tests too, see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c77">comment 77</a> &amp; Christoph's patch.  Will
&gt; send you the tests patch when it's ready - sorry, didn't have time to finish
&gt; this tonight.</span >

Great!</pre></div><div class="change-set" id="c89"><div class="comment" data-id="9995778" data-no="89"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-89" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6594314_526840"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-89"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-89" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c89">Comment 89</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 03:11 PST" data-time="1425640303">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-89">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-89" data-comment-id="9995778">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573866" name="attach_8573866" title="propagate referrer policy throughout the ui">attachment 8573866</a> <a href="/attachment.cgi?id=8573866&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8573866&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573866'>[review]</a>
propagate referrer policy throughout the ui

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8573866" name="attach_8573866" title="propagate referrer policy throughout the ui">attachment 8573866</a> <a href="/attachment.cgi?id=8573866&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8573866&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573866'>[review]</a>:
-----------------------------------------------------------------

r+ on the assumption that tests. :-)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573866&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573866</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review+</div></div></div><div class="change-set" id="c90"><div class="comment" data-id="9996383" data-no="90"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-90" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6594314_526840"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6594314_526840"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-90"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-90" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c90">Comment 90</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 06:28 PST" data-time="1425652097">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-90">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-90" data-comment-id="9996383">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573850" name="attach_8573850" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8573850</a> <a href="/attachment.cgi?id=8573850&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8573850&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573850'>[review]</a>
Document and nsIWebNavigation changes for referrer policy in UI code

Please don't binarynames stuff unless it's absolutely necessary.  Why not just give the nsIDocument member the right name?</pre><div class="activity"><div class="change">Flags: needinfo?(averstak)</div></div></div><div class="change-set" id="c91"><div class="comment" data-id="9996770" data-no="91"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-91" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_424995" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/44db89c3c0e0ff5a5bff6afac6e68a17?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_424995" id="a6594314_526840"><a class="email disabled" href="/user_profile?user_id=424995" > <span class="fna">Lawrence Mandel [:lmandel] (use needinfo)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-91"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-91" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c91">Comment 91</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 07:45 PST" data-time="1425656731">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-91">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-91" data-comment-id="9996770">Unless there is a real pressing reason to ship the feature in 37 (more than <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c19">comment 19</a>), given that the change looks non trivial, that it hasn't landed on m-c yet, and that we're already past the cutoff for slight risk in the shorter 37 cycle, I would prefer that we disable the feature again in 37 (like <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Disable &lt;meta referrer&gt; handling on 36 pending an actual request to ship process"
   href="/show_bug.cgi?id=1134606">bug 1134606</a> did for 36) and target 38.

Sid - Can you live with this?</pre><div class="activity"><div class="change">Flags: needinfo?(sstamm)</div></div></div><div class="change-set" id="c92"><div class="comment" data-id="9997442" data-no="92"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-92" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6594314_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6594314_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-92"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-92" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c92">Comment 92</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 09:52 PST" data-time="1425664327">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-92">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-92" data-comment-id="9997442">&#64;bz - that doesn't compile; it would need to be called ReferrerPolicy which is also an enum.  I could add a thin wrapper called ReferrerPolicyFromJS to follow existing convention, but there doesn't seem to be a good way to avoid binarynames entirely.  Tried removing the typedef and using fully qualified mozilla::net::ReferrerPolicy, but that looks inconsistent with the rest of this code.  Thoughts?</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="a6714092_526840"><div class="change" id="aa6714092_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6714092_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a6714092_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6714092_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6714092_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a6714092_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 09:52 PST" data-time="1425664342">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(averstak)</span></div></div></div><div class="change-set" id="c93"><div class="comment" data-id="9997622" data-no="93"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-93" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6714092_526840"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6714092_526840"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-93"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-93" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c93">Comment 93</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 10:24 PST" data-time="1425666253">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-93">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-93" data-comment-id="9997622">typedef mozilla::net::ReferrerPolicy to ReferrerPolicyEnum?</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c94"><div class="comment" data-id="9997810" data-no="94"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-94" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a6714092_526840"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a6714092_526840"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-94"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-94" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c94">Comment 94</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 11:04 PST" data-time="1425668662">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-94">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-94" data-comment-id="9997810">(In reply to Lawrence Mandel [:lmandel] (use needinfo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c91">comment #91</a>)
<span class="quote">&gt; Sid - Can you live with this?</span >

Yes. The patch for this bug has indeed turned out to be more complicated than I initially thought.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sstamm)</span></div></div></div><div class="change-set" id="c95"><div class="comment" data-id="9998159" data-no="95"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-95" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_424995" id="a6714092_526840"><img src="https://secure.gravatar.com/avatar/44db89c3c0e0ff5a5bff6afac6e68a17?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_424995" id="a6714092_526840"><a class="email disabled" href="/user_profile?user_id=424995" > <span class="fna">Lawrence Mandel [:lmandel] (use needinfo)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-95"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-95" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c95">Comment 95</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 12:15 PST" data-time="1425672908">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-95">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-95" data-comment-id="9998159">I have marked this bug as wontfix for 37. We can still consider uplift for 38.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=isnotempty">status-firefox37</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox37&amp;o1=equals&amp;v1=wontfix">wontfix</a></div></div></div><div class="change-set" id="a6736228_339203"><div class="change" id="aa6736228_339203">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_339203" id="a6736228_339203"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6736228_339203"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6736228_339203">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a6736228_339203">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-06 16:01 PST" data-time="1425686478">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Disable &lt;meta referrer&gt; on 37 due to outstanding middle click bug and risk to uplifting its fix"
   href="/show_bug.cgi?id=1140638">1140638</a></div></div></div><div class="change-set" id="c96"><div class="comment" data-id="9999741" data-no="96"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-96" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-96"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-96" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c96">Comment 96</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-07 02:57 PST" data-time="1425725852">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-96">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8574270"
         class="attachment patch obsolete"
         data-id="8574270" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-api.patch">
      <meta itemprop="contentSize" content="23081">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8574270">
          <a class="link" href="attachment.cgi?id=8574270&amp;action=diff">
        <span id="att-8574270-description" itemprop="description">Document and nsIWebNavigation changes for referrer policy in UI code</span></a> (obsolete)
        — <a href="attachment.cgi?id=8574270&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574270">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-96" data-comment-id="9999741">Implemented bz's suggestion to avoid bindings.conf.  Carrying over his sr+.  Still need a regular review from someone, I think - flagging Sid.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573850&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573850</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8573850&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8573850</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: review?(sstamm)</div><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: feedback?(bzbarsky)</div></div></div><div class="change-set" id="c97"><div class="comment" data-id="9999745" data-no="97"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-97" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-97"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-97" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c97">Comment 97</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-07 03:08 PST" data-time="1425726505">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-97">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-97" data-comment-id="9999745">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c88">comment #88</a>)
<span class="quote">&gt; &gt; I could update browser.xml too, of course, but I don't know how to test
&gt; &gt; that?  Nothing that I've done triggered that code path.  I added logging to
&gt; &gt; it too, but never saw it log.
&gt; 
&gt; Hmmmmm. For regular Firefox, this is not strictly necessary. For toolkit, it
&gt; will be, I think.
&gt; 
&gt; I wonder how all this should work with view-source URLs. You can click links
&gt; in those, and I expect they will use the regular toolkit browser binding,
&gt; though I've not checked.</span >

View-source doesn't seem to call browser.xml either, but I just went ahead and changed that anyway.  It's a backwards compatible change; and it would be odd to have different interfaces for different browser objects.  Also added a comment to one of the three versions in tabbrowser.xml - it doesn't look like it supports a params object, but it actually does.

<span class="quote">&gt; I also don't know if the referrer policy of the
&gt; original document does/should apply to the view-source document. (Though I
&gt; expect it currently doesn't... not sure if that's an issue, and/or how much
&gt; we care here.)</span >

It gets an empty referrer from view-source, which seems just fine to me.

<span class="quote">&gt; The other things that use regular browsers will probably still want
&gt; updating... but we can leave that for a followup. We'd need to audit the
&gt; relevant code (I suspect at least sidebars, social and Firefox Hello, off
&gt; the top of my head). This patch is big enough as it is.</span >

All right, followup it is.  I wouldn't even know all the places to look at... :-)</pre></div><div class="change-set" id="c98"><div class="comment" data-id="9999747" data-no="98"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-98" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-98"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-98" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c98">Comment 98</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-07 03:10 PST" data-time="1425726636">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-98">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8574272"
         class="attachment patch obsolete"
         data-id="8574272" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="33154">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8574272">
          <a class="link" href="attachment.cgi?id=8574272&amp;action=diff">
        <span id="att-8574272-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8574272&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574272">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-98" data-comment-id="9999747">PTAL at toolkit browser.xml changes.  I know you already r+'ed the rest.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573866&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8573866</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8574272&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8574272</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c99"><div class="comment" data-id="9999752" data-no="99"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-99" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-99"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-99" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c99">Comment 99</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-07 03:19 PST" data-time="1425727141">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-99">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8574273"
         class="attachment patch obsolete"
         data-id="8574273" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="24406">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8574273">
          <a class="link" href="attachment.cgi?id=8574273&amp;action=diff">
        <span id="att-8574273-description" itemprop="description">test cases - click, ctrl-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8574273&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8574273">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-99" data-comment-id="9999752">Adopted from Christoph's excellent patch.  Narrowed down from 20 to 6 key cases, so it should be fast enough now.  Added plain-jane cases, interaction with rel=noreferrer, and a same-origin origin-when-crossorigin test.  Skipped drag-and-drop for now - ran out of time.  All four tests pass locally on linux-debug, and take 70-90 seconds a pop.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574273&amp;action=edit"
           title="test cases - click, ctrl-click, new-{tab,window}"
           class=""
        >Attachment #8574273</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c100"><div class="comment" data-id="10003962" data-no="100"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-100" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a6736228_339203"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a6736228_339203"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-100"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-100" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c100">Comment 100</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-09 08:09 PDT" data-time="1425913749">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-100">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-100" data-comment-id="10003962">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8574270" name="attach_8574270" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8574270</a> <a href="/attachment.cgi?id=8574270&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8574270&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574270'>[review]</a>
Document and nsIWebNavigation changes for referrer policy in UI code

Yeah, this seems reasonable....</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: feedback?(bzbarsky) &rarr; feedback+</div></div></div><div class="change-set" id="c101"><div class="comment" data-id="10004355" data-no="101"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-101" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-101"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-101" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c101">Comment 101</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-09 09:29 PDT" data-time="1425918560">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-101">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-101" data-comment-id="10004355">Filed followup bugs: 1141140 (comm-central), 1141142 (android), 1141143 (metro), 1141146 (sidebars, etc.).  There's also 1073187 for download.</pre></div><div class="change-set" id="c102"><div class="comment" data-id="10004361" data-no="102"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-102" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-102"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-102" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c102">Comment 102</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-09 09:30 PDT" data-time="1425918600">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-102">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-102" data-comment-id="10004361">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8574272" name="attach_8574272" title="propagate referrer policy throughout the ui">attachment 8574272</a> <a href="/attachment.cgi?id=8574272&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8574272&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574272'>[review]</a>
propagate referrer policy throughout the ui

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8574272" name="attach_8574272" title="propagate referrer policy throughout the ui">attachment 8574272</a> <a href="/attachment.cgi?id=8574272&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8574272&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574272'>[review]</a>:
-----------------------------------------------------------------

r=me, but we shouldn't forget the followup per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c97">comment 97</a> / 88.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574272&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8574272</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review+</div></div></div><div class="change-set" id="c103"><div class="comment" data-id="10004552" data-no="103"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-103" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-103"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-103" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c103">Comment 103</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-09 10:01 PDT" data-time="1425920515">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-103">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-103" data-comment-id="10004552">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8574273" name="attach_8574273" title="test cases - click, ctrl-click, new-{tab,window}">attachment 8574273</a> <a href="/attachment.cgi?id=8574273&amp;action=edit" title="test cases - click, ctrl-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8574273&amp;action=diff" title="test cases - click, ctrl-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574273'>[review]</a>
test cases - click, ctrl-click, new-{tab,window}

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8574273" name="attach_8574273" title="test cases - click, ctrl-click, new-{tab,window}">attachment 8574273</a> <a href="/attachment.cgi?id=8574273&amp;action=edit" title="test cases - click, ctrl-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8574273&amp;action=diff" title="test cases - click, ctrl-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574273'>[review]</a>:
-----------------------------------------------------------------

Can we put these in their own folder? &quot;general&quot; has something like 300 tests and if we keep dumping in there that will never improve... :-)

Also, I'm a little concerned that we're limiting the tests because of timeouts... Equally, I don't have quick fixes to split the tests up further, short of numbering them and splitting the test suites.

The actual bad news (besides nits/comments below) is that this won't run in --e10s mode, and ideally we shouldn't really add the tests before we've fixed that. However... it seems that the test relies on itself calling contentAreaClick. I don't know why it does that and why it can't rely on the browser's own handling here. I don't think we can call the equivalent e10s stuff ( <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content.js#640">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content.js#640</a> ) because that just defines an object as a local variable. We'd have to change that and stick it on |this| in order to access it from another content script... 

It seems like the &quot;simple_click&quot; code doesn't need to do this, though. Can we investigate fixing the content menu case to also not need more motivation than just synthesizing the click? :-)

::: browser/base/content/test/general/BrowserReferrerTestUtils.jsm
&#64;&#64; +6,5 &#64;&#64;
<span class="quote">&gt; +
&gt; +&quot;use strict&quot;;
&gt; +
&gt; +this.EXPORTED_SYMBOLS = [
&gt; +  'BrowserReferrerTestUtils',</span >

I feel bad saying this but... please use double quotes throughout all the JS here.

&#64;&#64; +117,5 &#64;&#64;
<span class="quote">&gt; +    let query = '?scheme=' + escape(aTest.toScheme) +
&gt; +                '&amp;policy=' + escape(aTest.policy || '') +
&gt; +                '&amp;rel=' + escape(aTest.rel || '');
&gt; +    aWin.gBrowser.addTab(aTest.fromScheme + BASE_URL + query);
&gt; +    aWin.gBrowser.selectTabAtIndex(1);</span >

aWin.gBrowser.selectedTab = aWin.gBrowser.addTab(...);

&#64;&#64; +118,5 &#64;&#64;
<span class="quote">&gt; +                '&amp;policy=' + escape(aTest.policy || '') +
&gt; +                '&amp;rel=' + escape(aTest.rel || '');
&gt; +    aWin.gBrowser.addTab(aTest.fromScheme + BASE_URL + query);
&gt; +    aWin.gBrowser.selectTabAtIndex(1);
&gt; +    this.waitForSomeTabToLoad(aWin, aCallback);</span >

BrowserTestUtils.browserLoaded(aWin.gBrowser.selectedBrowser).then(aCallback);

::: browser/base/content/test/general/file_referrer_policyserver.sjs
&#64;&#64; +10,5 &#64;&#64;
<span class="quote">&gt; +
&gt; +  request.queryString.split('&amp;').forEach(function(val) {
&gt; +    let [name, value] = val.split('=');
&gt; +    query[name] = unescape(value);
&gt; +  });</span >

Let's use URLSearchParams instead.

&#64;&#64; +14,5 &#64;&#64;
<span class="quote">&gt; +  });
&gt; +
&gt; +  let policy = query.policy;
&gt; +  let metaReferrerTag =
&gt; +      (policy &amp;&amp; '&lt;meta name=&quot;referrer&quot; content=&quot;' + policy + '&quot;&gt;') || '';</span >

Nit: template string.

&#64;&#64; +19,5 &#64;&#64;
<span class="quote">&gt; +  let linkUrl = query.scheme +
&gt; +                'test1.example.com/browser/browser/base/content/test/general/' +
&gt; +                'file_referrer_testserver.sjs';
&gt; +  let relAttr =
&gt; +      (query.rel &amp;&amp; ' rel=&quot;' + query.rel + '&quot;') || '';</span >

Why is this its own line? Should fit perfectly well on the previous line, surely?

&#64;&#64; +32,5 &#64;&#64;
<span class="quote">&gt; +             metaReferrerTag +
&gt; +             '&lt;title&gt;Test referrer&lt;/title&gt;' +
&gt; +             '&lt;/head&gt;' +
&gt; +             '&lt;body&gt;' + linkTag + '&lt;/body&gt;' +
&gt; +             '&lt;/html&gt;';</span >

Please use a template string instead.

::: browser/base/content/test/general/file_referrer_testserver.sjs
&#64;&#64; +23,5 &#64;&#64;
<span class="quote">&gt; +             '&lt;/head&gt;' +
&gt; +             '&lt;body&gt;' +
&gt; +             '&lt;div id=&quot;testdiv&quot;&gt;' + referrer + '&lt;/div&gt;' +
&gt; +             '&lt;/body&gt;' +
&gt; +             '&lt;/html&gt;';</span >

More template string fodder.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574273&amp;action=edit"
           title="test cases - click, ctrl-click, new-{tab,window}"
           class=""
        >Attachment #8574273</a> -
        Flags: <span class="activity-deleted">review?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="c104"><div class="comment" data-id="10010673" data-no="104"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-104" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-104"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-104" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c104">Comment 104</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-10 11:25 PDT" data-time="1426011949">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-104">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-104" data-comment-id="10010673">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c103">comment #103</a>)
<span class="quote">&gt; Also, I'm a little concerned that we're limiting the tests because of
&gt; timeouts... Equally, I don't have quick fixes to split the tests up further,
&gt; short of numbering them and splitting the test suites.</span >

How long is too long, even with sharding?  See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c78">comment 78</a>.

(They would also be duplicating an exhaustive channel test, so I'm not sure there would be any real benefit...)

<span class="quote">&gt; The actual bad news (besides nits/comments below) is that this won't run in
&gt; --e10s mode, and ideally we shouldn't really add the tests before we've
&gt; fixed that. However... it seems that the test relies on itself calling
&gt; contentAreaClick. I don't know why it does that and why it can't rely on the
&gt; browser's own handling here. I don't think we can call the equivalent e10s
&gt; stuff (
&gt; <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content</a>.
&gt; js#640 ) because that just defines an object as a local variable. We'd have
&gt; to change that and stick it on |this| in order to access it from another
&gt; content script... 
&gt; 
&gt; It seems like the &quot;simple_click&quot; code doesn't need to do this, though. Can
&gt; we investigate fixing the content menu case to also not need more motivation
&gt; than just synthesizing the click? :-)</span >

Removed the call to contentAreaClick, I'm not sure why it was there either.

But I have a more basic problem in e10s - waitForFocus() doesn't, says &quot;child process window cannot be focused&quot;.  Will poke around when I have a bit of time.  This is even in the simple click test.</pre></div><div class="change-set" id="c105"><div class="comment" data-id="10010689" data-no="105"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-105" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-105"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-105" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c105">Comment 105</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-10 11:28 PDT" data-time="1426012109">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-105">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8575445"
         class="attachment patch obsolete"
         data-id="8575445" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="20452">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8575445">
          <a class="link" href="attachment.cgi?id=8575445&amp;action=diff">
        <span id="att-8575445-description" itemprop="description">test cases - click, ctrl-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8575445&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8575445">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-105" data-comment-id="10010689">WIP.  Addressed Gijs' style comments.  Made logic clearer.  Still no cigar with e10s, but for a different reason - waitForFocus() doesn't like me somehow.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574273&amp;action=edit"
           title="test cases - click, ctrl-click, new-{tab,window}"
           class=""
        >Attachment #8574273</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c106"><div class="comment" data-id="10010820" data-no="106"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-106" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-106"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-106" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c106">Comment 106</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-10 11:44 PDT" data-time="1426013086">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-106">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-106" data-comment-id="10010820">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c105">comment #105</a>)
<span class="quote">&gt; waitForFocus() doesn't like me somehow.</span >

How?

You probably need to ensure that you either pass it a chrome window when calling it in a chrome process, and that you can access the function and have it work and pass it a content window when calling it in a content process.</pre></div><div class="change-set" id="c107"><div class="comment" data-id="10010960" data-no="107"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-107" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-107"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-107" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c107">Comment 107</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-10 12:14 PDT" data-time="1426014863">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-107">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-107" data-comment-id="10010960">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c104">comment #104</a>)
<span class="quote">&gt; (In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c103">comment #103</a>)
&gt; &gt; Also, I'm a little concerned that we're limiting the tests because of
&gt; &gt; timeouts... Equally, I don't have quick fixes to split the tests up further,
&gt; &gt; short of numbering them and splitting the test suites.
&gt; 
&gt; How long is too long, even with sharding?  See <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c78">comment 78</a>.</span >

Ah. So any machine will only run one test in parallel (mostly because browser_ tests are basically integration tests that (in some cases) rely on OS-level focus and such, so parallelizing them is... not easy), so no need to worry about that.

AFAIK the only issue is ensuring that (debug/asan) tests (comfortably) complete within the timeout limit on the hardware we use. So yes, splitting in 10 * 1min tests is totally an option from that perspective.


<span class="quote">&gt; (They would also be duplicating an exhaustive channel test, so I'm not sure
&gt; there would be any real benefit...)</span >

I don't know what you mean here, although I guess you're saying there are unit tests for the underlying DOM/HttpChannel bits? That's nice, but it's still valuable to have the tests in this patch considering that in fact, those existing unit tests are passing but in practice the browser isn't doing the right thing. :-)

One thing we could potentially do is that rather than the integration-test-type approach the tests use, to directly call methods and ensure that they call the underlying DOM/webidl stuff with the right parameters as a result. But in the absence of a good mocking tool, that is difficult, and it would be quite tightly coupled to the current implementation, and will make it easy to miss stuff - both of which will make them less future-proof as tests go.

<span class="quote">&gt; &gt; The actual bad news (besides nits/comments below) is that this won't run in
&gt; &gt; --e10s mode, and ideally we shouldn't really add the tests before we've
&gt; &gt; fixed that. However... it seems that the test relies on itself calling
&gt; &gt; contentAreaClick. I don't know why it does that and why it can't rely on the
&gt; &gt; browser's own handling here. I don't think we can call the equivalent e10s
&gt; &gt; stuff (
&gt; &gt; <a rel="nofollow" href="http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content">http://mxr.mozilla.org/mozilla-central/source/browser/base/content/content</a>.
&gt; &gt; js#640 ) because that just defines an object as a local variable. We'd have
&gt; &gt; to change that and stick it on |this| in order to access it from another
&gt; &gt; content script... 
&gt; &gt; 
&gt; &gt; It seems like the &quot;simple_click&quot; code doesn't need to do this, though. Can
&gt; &gt; we investigate fixing the content menu case to also not need more motivation
&gt; &gt; than just synthesizing the click? :-)
&gt; 
&gt; Removed the call to contentAreaClick, I'm not sure why it was there either.</span >

\o/

<span class="quote">&gt; But I have a more basic problem in e10s - waitForFocus() doesn't, says
&gt; &quot;child process window cannot be focused&quot;.  Will poke around when I have a
&gt; bit of time.  This is even in the simple click test.</span >

(sorry for missing this comment initially)

Looking at this, it's likely because you're asking for a content window in aTestWindow, and SimpleTest.waitForFocus tries to find the browser for the window by asking the tabbrowser element in its own window, which obviously isn't going to work (wrong chrome window).

This is an issue with waitForFocus. See:

<a rel="nofollow" href="http://hg.mozilla.org/mozilla-central/annotate/c42e7e3bb0a0/testing/mochitest/tests/SimpleTest/SimpleTest.js#l823">http://hg.mozilla.org/mozilla-central/annotate/c42e7e3bb0a0/testing/mochitest/tests/SimpleTest/SimpleTest.js#l823</a>

Asking around there doesn't seem to be a way to determine the toplevel chrome window from the content window in e10s land. There are two possibilities:
a) add a param to pass the chrome window
b) write another inner function to get the parent window by looping over the windows of type &quot;navigator:browser&quot; using something like:

let wm = Components.classes[&quot;&#64;mozilla.org/appshell/window-mediator;1&quot;].getService(Components.interfaces.nsIWindowMediator);
let windows = wm.getEnumerator(&quot;navigator:browser&quot;);
while (windows.hasMoreElements()) {
  let win = windows.getNext();
  let tabbrowser = win.gBrowser;
  // see if the tabbrowser knows about the inner window, and if so, return that window.
}
// Nope!



Does that help?</pre></div><div class="change-set" id="c108"><div class="comment" data-id="10010984" data-no="108"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-108" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-108"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-108" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c108">Comment 108</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-10 12:19 PDT" data-time="1426015190">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-108">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-108" data-comment-id="10010984">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c107">comment #107</a>)
<span class="quote">&gt; (In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c104">comment #104</a>)
&gt; &gt; But I have a more basic problem in e10s - waitForFocus() doesn't, says
&gt; &gt; &quot;child process window cannot be focused&quot;.  Will poke around when I have a
&gt; &gt; bit of time.  This is even in the simple click test.
&gt; 
&gt; (sorry for missing this comment initially)
&gt; 
&gt; Looking at this, it's likely because you're asking for a content window in
&gt; aTestWindow, and SimpleTest.waitForFocus tries to find the browser for the
&gt; window by asking the tabbrowser element in its own window, which obviously
&gt; isn't going to work (wrong chrome window).
&gt; 
&gt; This is an issue with waitForFocus. See:
&gt; 
&gt; <a rel="nofollow" href="http://hg.mozilla.org/mozilla-central/annotate/c42e7e3bb0a0/testing/">http://hg.mozilla.org/mozilla-central/annotate/c42e7e3bb0a0/testing/</a>
&gt; mochitest/tests/SimpleTest/SimpleTest.js#l823
&gt; 
&gt; Asking around there doesn't seem to be a way to determine the toplevel
&gt; chrome window from the content window in e10s land. There are two
&gt; possibilities:
&gt; a) add a param to pass the chrome window
&gt; b) write another inner function to get the parent window by looping over the
&gt; windows of type &quot;navigator:browser&quot; using something like:
&gt; 
&gt; let wm =
&gt; Components.classes[&quot;&#64;mozilla.org/appshell/window-mediator;1&quot;].
&gt; getService(Components.interfaces.nsIWindowMediator);
&gt; let windows = wm.getEnumerator(&quot;navigator:browser&quot;);
&gt; while (windows.hasMoreElements()) {
&gt;   let win = windows.getNext();
&gt;   let tabbrowser = win.gBrowser;
&gt;   // see if the tabbrowser knows about the inner window, and if so, return
&gt; that window.
&gt; }
&gt; // Nope!
&gt; 
&gt; 
&gt; 
&gt; Does that help?</span >

... or you could wait for <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - waitForFocus needs to handle content process windows in a different window"
   href="/show_bug.cgi?id=1131656">bug 1131656</a> to be fixed (and/or apply that patch for now). :-\

(Only heard about this after I finished writing the previous comment!)</pre></div><div class="change-set" id="c109"><div class="comment" data-id="10014091" data-no="109"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-109" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a6736228_339203"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-109"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-109" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c109">Comment 109</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 02:43 PDT" data-time="1426066991">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-109">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8575868"
         class="attachment patch obsolete"
         data-id="8575868" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="23696">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8575868">
          <a class="link" href="attachment.cgi?id=8575868&amp;action=diff">
        <span id="att-8575868-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8575868&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8575868">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-109" data-comment-id="10014091">Mostly works in e10s now.

1. The new-window e10s version spins at 100% CPU for a few minutes during shutdown, and then complains that it leaked 16 bytes in WeakReference&lt;MessageListener&gt;.  I'm getting a funny feeling that opening new windows is not well covered by e10s tests, and this is something totally unrelated to my changes...  Am inclined to disable new-window in e10s and file a followup bug; the other three tests run fine.

2. I'll make you more test cases once you're happy with the basics.  Don't want to iterate on the full enchilada - current set is 3min non-e10s + 7min e10s; full set would be 7X more cases - so, an hour.  Definitely too slow for iteration.  Actually, do you still want it at all?  Yes, I can shard it, but running locally would still take an hour...</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8575445&amp;action=edit"
           title="test cases - click, ctrl-click, new-{tab,window}"
           class=""
        >Attachment #8575445</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8575868&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8575868</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c110"><div class="comment" data-id="10018060" data-no="110"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-110" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-110"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-110" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c110">Comment 110</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:13 PDT" data-time="1426115589">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-110">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-110" data-comment-id="10018060">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8575868" name="attach_8575868" title="test cases - click, middle-click, new-{tab,window}">attachment 8575868</a> <a href="/attachment.cgi?id=8575868&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8575868&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8575868'>[review]</a>
test cases - click, middle-click, new-{tab,window}

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8575868" name="attach_8575868" title="test cases - click, middle-click, new-{tab,window}">attachment 8575868</a> <a href="/attachment.cgi?id=8575868&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8575868&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8575868'>[review]</a>:
-----------------------------------------------------------------

Unfortunately the 'real' frontend patch has bitrotted (specifically the context menu bit), so now it's more difficult to test this. I'm looking into this. Some code-inspection-based feedback below.

::: browser/base/content/test/referrer/browser_referrer_middle_click.js
&#64;&#64; +4,5 &#64;&#64;
<span class="quote">&gt; +function startTestCase(aTestNumber, aTestWindow) {
&gt; +  info(&quot;browser_referrer_middle_click: &quot; +
&gt; +       getReferrerTestDescription(referrerTests[aTestNumber]));
&gt; +  newTabLoaded(aTestWindow).then(function(aNewTab) {
&gt; +    aTestWindow.gBrowser.selectedTab = aNewTab;</span >

You probably don't need to select the tab, but OTOH it'll help with debugging on try if it fails there (the screenshot will show it if it did open and then timed out / stopped / whatever), so let's leave it in.

&#64;&#64; +16,5 &#64;&#64;
<span class="quote">&gt; +function checkReferrerInNewTab(aTestNumber, aTestWindow, aNewTab) {
&gt; +  referrerResultReady(aTestWindow).then(function(result) {
&gt; +    let test = referrerTests[aTestNumber];
&gt; +    let desc = getReferrerTestDescription(test);
&gt; +    is(result, test.result, desc);</span >

The block of the 3 lines here is the same all the time. Can you factor it into referrerResultReady(aTestWindow) ?

&#64;&#64; +23,5 &#64;&#64;
<span class="quote">&gt; +    aTestWindow.gBrowser.removeTab(aNewTab);
&gt; +    is(aTestWindow.gBrowser.tabs.length, 2, &quot;two tabs open&quot;);
&gt; +    aTestWindow.gBrowser.removeTab(aTestWindow.gBrowser.tabs[1]);
&gt; +
&gt; +    // Move on to the next test.</span >

This block (from is(..., 2, &quot;two tabs open&quot;) until the end of the function) is the same in every file (minus info(&quot;DONE DONE DONE&quot;)...).

Can you factor it out into head.js, too? nextTestOrFinish(aTestNumber, aTestWindow) or something? :-)

&#64;&#64; +37,5 &#64;&#64;
<span class="quote">&gt; +    }
&gt; +  });
&gt; +}
&gt; +
&gt; +function test() {</span >

In fact, so is this... which almost makes me wonder if you can factor this out into head.js, too. :-)

When you refactor this, can you please get rid of the param but add a gTestWindow global in head.js and stick the window on there? You can then also add a:

registerCleanupFunction(function() {
  gTestWindow &amp;&amp; gTestWindow.close();
});

in head.js to ensure we always close the window even if the test fails halfway through or whatever.

::: browser/base/content/test/referrer/browser_referrer_open_link_in_window.js
&#64;&#64; +39,5 &#64;&#64;
<span class="quote">&gt; +  });
&gt; +}
&gt; +
&gt; +function test() {
&gt; +  requestLongerTimeout(240);  // slowwww shutdown on e10s</span >

err, this means 240 *times* the regular timeout. That's almost definitely wrong.

Do you have level 1 commit access so you can push to try?

::: browser/base/content/test/referrer/file_referrer_policyserver.sjs
&#64;&#64; +25,5 &#64;&#64;
<span class="quote">&gt; +              ${metaReferrerTag}
&gt; +              &lt;title&gt;Test referrer&lt;/title&gt;
&gt; +              &lt;/head&gt;
&gt; +              &lt;body&gt;
&gt; +              &lt;a id='testlink' href='${linkUrl}' ${rel ? ` rel='${rel}'` : &quot;&quot;}&gt;</span >

I'm amazed this works!

::: browser/base/content/test/referrer/head.js
&#64;&#64; +111,5 &#64;&#64;
<span class="quote">&gt; +                                           handleResult);
&gt; +      resolve(aMessage.data);
&gt; +    });
&gt; +    messageManager.loadFrameScript(
&gt; +        REFERRER_FRAME_SCRIPT_URL + &quot;referrer_frame_script.js&quot;, false);</span >

This seems too trivial to need an extra file and all this setup. Instead of doing this, try using ContentTask:

return ContentTask.spawn(aWindow.gBrowser.selectedBrowser, {}, function() {
  return content.document.getElementById(&quot;testdiv&quot;).textContent;
});

should work, off the top of my head?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8575868&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8575868</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; feedback+</div></div></div><div class="change-set" id="c111"><div class="comment" data-id="10018074" data-no="111"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-111" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-111"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-111" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c111">Comment 111</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:14 PDT" data-time="1426115686">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-111">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-111" data-comment-id="10018074">Also, looking at the reasons for the bitrotting, are we intentionally not doing anything about &quot;open frame in new tab&quot; and friends?</pre></div><div class="change-set" id="c112"><div class="comment" data-id="10018093" data-no="112"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-112" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6736228_339203"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6736228_339203"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-112"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-112" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c112">Comment 112</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:22 PDT" data-time="1426116122">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-112">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8576322"
         class="attachment patch obsolete"
         data-id="8576322" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="38212">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8576322">
          <a class="link" href="attachment.cgi?id=8576322&amp;action=diff">
        <span id="att-8576322-description" itemprop="description">Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)</span></a> (obsolete)
        — <a href="attachment.cgi?id=8576322&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576322">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a7165877_159069"><div class="change" id="aa7165877_159069">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7165877_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a7165877_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7165877_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7165877_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7165877_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:22 PDT" data-time="1426116127">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574272&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8574272</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c113"><div class="comment" data-id="10018112" data-no="113"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-113" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7165877_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7165877_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-113"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-113" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c113">Comment 113</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:26 PDT" data-time="1426116362">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-113">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-113" data-comment-id="10018112">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8576322" name="attach_8576322" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">attachment 8576322</a> <a href="/attachment.cgi?id=8576322&amp;action=edit" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[details]</a> <a href="/attachment.cgi?id=8576322&amp;action=diff" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576322'>[review]</a>
Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)

Alex, can you doublecheck this? interdiff: 

<a rel="nofollow" href="https://bugzilla.mozilla.org/attachment.cgi?oldid=8574272&amp;action=interdiff&amp;newid=8576322&amp;headers=1">https://bugzilla.mozilla.org/attachment.cgi?oldid=8574272&amp;action=interdiff&amp;newid=8576322&amp;headers=1</a>

I also changed doc.referrerPolicy to gContextMenuContentData.referrerPolicy in nsContextMenu.js (that's the only hunk for that file), but the interdiff tool is too dumb to figure that out because the context changed and so it can't apply both diffs.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576322&amp;action=edit"
           title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)"
           class=""
        >Attachment #8576322</a> -
        Attachment description: Un-bitrotted patch (pass referrerPolicy through context menu) &rarr; Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)</div><div class="change">
        <a href="/attachment.cgi?id=8576322&amp;action=edit"
           title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)"
           class=""
        >Attachment #8576322</a> -
        Flags: review?(averstak)</div></div></div><div class="change-set" id="a7166149_159069"><div class="change" id="aa7166149_159069">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a7166149_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7166149_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7166149_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7166149_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 16:26 PDT" data-time="1426116399">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; averstak</div></div></div><div class="change-set" id="c114"><div class="comment" data-id="10018263" data-no="114"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-114" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-114"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-114" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c114">Comment 114</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-11 17:18 PDT" data-time="1426119489">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-114">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-114" data-comment-id="10018263">Re test case coverage - this is the existing &quot;channel test&quot; I was referring to earlier:

<a rel="nofollow" href="http://lxr.mozilla.org/mozilla-central/source/dom/base/test/test_bug704320.html?force=1">http://lxr.mozilla.org/mozilla-central/source/dom/base/test/test_bug704320.html?force=1</a>

It covers the full cross product of {source-scheme, target-scheme, policy}.  But it triggers navigation from content, not from chrome.  So, it's more than just a unittest, it covers everything other than chrome event dispatch (which is this bug).

Given the existence of this other test, my 6-case / 10-minute strategy in the latest tests patch is to verify that (a) chrome gives the channel enough info to do its job, *not* that (b) the channel does its job for all possible inputs.  Either stance has reasonable philosophical arguments going for and against it.  It's probably not necessary to go there because I think we can resolve this on practical grounds; but I'd just like to point out that there's method and merit to my test strategy - it's the result of a different systematic approach, not of cutting corners.

The practical matter, of course, is how long these tests take to run, and how we expect this to grow over time.  Currently, a full cross-product would be 2 (source) * 2 (target) * 6 (policy|none) * 2 (rel=noreferrer) = 48 cases.  So, we're talking 10 minutes (mine) vs. 80 minutes (cross-product) of machine time.  Other cases that could reasonably be added in the future are the 6 CSP referrer values and the 3 referrer attribute values (I'm not sure of the implementation status, but both are in the spec, and bugs to implement them exist).  At that point, we're talking 18*48 = 864 cases = 15 hours.

Still think cross-product testing is a good idea?  If you do - fine, I'll fold my tent and implement the cross-product.  Just making sure you know what you're asking for, because you're going to get it. ;-)

(Re recent code review comments - thanks, will rebase and address them when I'm home later tonight.  Thanks for the blazingly fast reviews - this is really helpful.)</pre></div><div class="change-set" id="c115"><div class="comment" data-id="10019820" data-no="115"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-115" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-115"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-115" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c115">Comment 115</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 02:54 PDT" data-time="1426154064">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-115">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-115" data-comment-id="10019820">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8576322" name="attach_8576322" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">attachment 8576322</a> <a href="/attachment.cgi?id=8576322&amp;action=edit" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[details]</a> <a href="/attachment.cgi?id=8576322&amp;action=diff" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576322'>[review]</a>
Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)

This doesn't quite work in e10s - open-in-new-tab needs another line in tabbrowser.xml to propagate the referrer policy; and open-in-new-window drops the referrer completely in all cases, AFAICT (by no fault of this patch - passing nsIURI to window.arguments is broken somehow, but a string works).  I'll send a counter-patch.

(BTW, my tests caught both of these bugs, and quickly.  Just saying... ;-)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576322&amp;action=edit"
           title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)"
           class=""
        >Attachment #8576322</a> -
        Flags: review?(averstak) &rarr; review-</div></div></div><div class="change-set" id="c116"><div class="comment" data-id="10019834" data-no="116"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-116" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-116"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-116" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c116">Comment 116</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 02:58 PDT" data-time="1426154282">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-116">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8576558"
         class="attachment patch obsolete"
         data-id="8576558" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="37317">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8576558">
          <a class="link" href="attachment.cgi?id=8576558&amp;action=diff">
        <span id="att-8576558-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8576558&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576558">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-116" data-comment-id="10019834">Counter-patch - unbitrotted, plus a minor line in tabbrowser.xml, plus changed window.arguments to propagate a string instead of nsIURI - the latter gets lost somehow, but a string works.  Works in manual testing and passes automatic referrer tests.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576558&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8576558</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c117"><div class="comment" data-id="10019876" data-no="117"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-117" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-117"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-117" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c117">Comment 117</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 03:12 PDT" data-time="1426155158">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-117">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8576569"
         class="attachment patch obsolete"
         data-id="8576569" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="20107">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8576569">
          <a class="link" href="attachment.cgi?id=8576569&amp;action=diff">
        <span id="att-8576569-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8576569&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576569">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-117" data-comment-id="10019876">Addressed review feedback.  All pass both with and without e10s.

Pending issues with tests:

1. Coverage / strategy - see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c114">comment 114</a>.

2. Leaks.  I get this intermittently with and w/o e10s, and am inclined to just ignore it:

TEST-INFO | leakcheck | default process: leaked 3 WeakReference&lt;MessageListener&gt; (48 bytes)
TEST-UNEXPECTED-FAIL | leakcheck | default process: 48 bytes leaked (WeakReference&lt;MessageListener&gt;)

3. Try run - sorry, I don't have committer access.

(The open-in-new-window test doesn't seem to be flaky anymore after the rebase - this was probably caused by the CPOW stuff that was fixed in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - [e10s] &quot;Open Link in New Tab&quot; in remote browser causes unsafe CPOW usage warning"
   href="/show_bug.cgi?id=1133577">bug 1133577</a>.)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8575868&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8575868</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8576569&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8576569</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c118"><div class="comment" data-id="10019899" data-no="118"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-118" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7166149_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-118"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-118" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c118">Comment 118</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 03:22 PDT" data-time="1426155739">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-118">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-118" data-comment-id="10019899">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c115">comment #115</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8576322" name="attach_8576322" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">attachment 8576322</a> <a href="/attachment.cgi?id=8576322&amp;action=edit" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[details]</a> <a href="/attachment.cgi?id=8576322&amp;action=diff" title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576322'>[review]</a>
&gt; Un-bitrotted browser patch (pass referrerPolicy from content process in e10s
&gt; contextmenu case)
&gt; 
&gt; This doesn't quite work in e10s - open-in-new-tab needs another line in
&gt; tabbrowser.xml to propagate the referrer policy; and open-in-new-window
&gt; drops the referrer completely in all cases, AFAICT (by no fault of this
&gt; patch - passing nsIURI to window.arguments is broken somehow, but a string
&gt; works).  I'll send a counter-patch.
&gt; 
&gt; (BTW, my tests caught both of these bugs, and quickly.  Just saying... ;-)</span >

FWIW, I did run the tests after I wrote the patch - but only in non-e10s mode (which was also broken before). D'oh. I'll look at the changes in more detail hopefully later today, but potentially it may have to be tomorrow as I'm a little overbooked this afternoon + evening.


(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c114">comment #114</a>)
<span class="quote">&gt; Re test case coverage - this is the existing &quot;channel test&quot; I was referring
&gt; to earlier:
&gt; 
&gt; <a rel="nofollow" href="http://lxr.mozilla.org/mozilla-central/source/dom/base/test/test_bug704320">http://lxr.mozilla.org/mozilla-central/source/dom/base/test/test_bug704320</a>.
&gt; html?force=1
&gt; 
&gt; It covers the full cross product of {source-scheme, target-scheme, policy}. 
&gt; But it triggers navigation from content, not from chrome.  So, it's more
&gt; than just a unittest, it covers everything other than chrome event dispatch
&gt; (which is this bug).</span >

OK, great.

<span class="quote">&gt; Given the existence of this other test, my 6-case / 10-minute strategy in
&gt; the latest tests patch is to verify that (a) chrome gives the channel enough
&gt; info to do its job, *not* that (b) the channel does its job for all possible
&gt; inputs.  Either stance has reasonable philosophical arguments going for and
&gt; against it.  It's probably not necessary to go there because I think we can
&gt; resolve this on practical grounds; but I'd just like to point out that
&gt; there's method and merit to my test strategy - it's the result of a
&gt; different systematic approach, not of cutting corners.</span >

Right, sorry if I seemed to imply otherwise, that wasn't the intention.

<span class="quote">&gt; The practical matter, of course, is how long these tests take to run, and
&gt; how we expect this to grow over time.  Currently, a full cross-product would
&gt; be 2 (source) * 2 (target) * 6 (policy|none) * 2 (rel=noreferrer) = 48
&gt; cases.  So, we're talking 10 minutes (mine) vs. 80 minutes (cross-product)
&gt; of machine time.  Other cases that could reasonably be added in the future
&gt; are the 6 CSP referrer values and the 3 referrer attribute values (I'm not
&gt; sure of the implementation status, but both are in the spec, and bugs to
&gt; implement them exist).  At that point, we're talking 18*48 = 864 cases = 15
&gt; hours.</span >

Right. That doesn't sound feasible.

<span class="quote">&gt; Still think cross-product testing is a good idea?  If you do - fine, I'll
&gt; fold my tent and implement the cross-product.  Just making sure you know
&gt; what you're asking for, because you're going to get it. ;-)
&gt; 
&gt; (Re recent code review comments - thanks, will rebase and address them when
&gt; I'm home later tonight.  Thanks for the blazingly fast reviews - this is
&gt; really helpful.)</span >

Very welcome, and apologies in advance if this iteration will be slightly more tardy...


Do you have ideas about my note in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c111">comment 111</a> regarding &quot;open frame in &lt;whatever&gt;&quot; ? Followup bug? Do we even need to do something there?


(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c117">comment #117</a>)
<span class="quote">&gt; Created <span class="bz_obsolete"><a href="/attachment.cgi?id=8576569" name="attach_8576569" title="test cases - click, middle-click, new-{tab,window}">attachment 8576569</a> <a href="/attachment.cgi?id=8576569&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8576569&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576569'>[review]</a>
&gt; test cases - click, middle-click, new-{tab,window}
&gt; 
&gt; Addressed review feedback.  All pass both with and without e10s.
&gt; 
&gt; Pending issues with tests:
&gt; 
&gt; 1. Coverage / strategy - see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c114">comment 114</a>.
&gt; 
&gt; 2. Leaks.  I get this intermittently with and w/o e10s, and am inclined to
&gt; just ignore it:
&gt; 
&gt; TEST-INFO | leakcheck | default process: leaked 3
&gt; WeakReference&lt;MessageListener&gt; (48 bytes)
&gt; TEST-UNEXPECTED-FAIL | leakcheck | default process: 48 bytes leaked
&gt; (WeakReference&lt;MessageListener&gt;)</span >

If it's intermittent it probably isn't anything new, but we can push this to try, which is always a new adventure...

<span class="quote">&gt; 3. Try run - sorry, I don't have committer access.</span >

OK, then I shall push this for you in a bit.</pre></div><div class="change-set" id="c119"><div class="comment" data-id="10019953" data-no="119"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-119" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-119"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-119" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c119">Comment 119</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 03:38 PDT" data-time="1426156714">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-119">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-119" data-comment-id="10019953">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c111">comment #111</a>)
<span class="quote">&gt; Also, looking at the reasons for the bitrotting, are we intentionally not
&gt; doing anything about &quot;open frame in new tab&quot; and friends?</span >

Yes. They reuse their own document.referrer, so there's no privacy / security issue.

(My goal is to help fix issues that reasonably block shipping of meta-referrer, so that I can get rid of plain http and silly redirectors on my website...)</pre></div><div class="change-set" id="c120"><div class="comment" data-id="10019986" data-no="120"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-120" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7166149_159069"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7166149_159069"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-120"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-120" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c120">Comment 120</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 03:51 PDT" data-time="1426157502">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-120">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-120" data-comment-id="10019986">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c118">comment #118</a>)
<span class="quote">&gt; Do you have ideas about my note in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c111">comment 111</a> regarding &quot;open frame in
&gt; &lt;whatever&gt;&quot; ? Followup bug? Do we even need to do something there?</span >

I'm inclined to ignore this. The problem case is the following - an https source, with meta-referrer=origin, links to an http target. Then, the user does &quot;open frame in&quot; on the target. It would ignore the referrer policy of the source, i.e., use the default no-referrer-on-downgrade policy, so it would strip the referrer completely. But correct behavior would be to keep <a rel="nofollow" href="https://source">https://source</a>.

I could file a followup bug, or I could just set the referrer policy here to unsafe-url w/o automatic tests, but somehow I just don't think this matters. It's reusing its own referrer, so it can only over-strip it, not under-strip it. Which means it's not a privacy / security issue, which means leaving it like this forever is probably just fine.

Thoughts?</pre></div><div class="change-set" id="a7207579_159069"><div class="change" id="aa7207579_159069">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7207579_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a7207579_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7207579_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7207579_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7207579_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 03:57 PDT" data-time="1426157829">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576322&amp;action=edit"
           title="Un-bitrotted browser patch (pass referrerPolicy from content process in e10s contextmenu case)"
           class=""
        >Attachment #8576322</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c121"><div class="comment" data-id="10020053" data-no="121"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-121" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7207579_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7207579_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-121"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-121" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c121">Comment 121</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 04:19 PDT" data-time="1426159185">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-121">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-121" data-comment-id="10020053">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c120">comment #120</a>)
<span class="quote">&gt; (In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c118">comment #118</a>)
&gt; &gt; Do you have ideas about my note in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c111">comment 111</a> regarding &quot;open frame in
&gt; &gt; &lt;whatever&gt;&quot; ? Followup bug? Do we even need to do something there?
&gt; 
&gt; I'm inclined to ignore this. The problem case is the following - an https
&gt; source, with meta-referrer=origin, links to an http target.</span >

When you say &quot;links to&quot; you mean &quot;has a frame with&quot;, right?

<span class="quote">&gt; Then, the user
&gt; does &quot;open frame in&quot; on the target. It would ignore the referrer policy of
&gt; the source, i.e., use the default no-referrer-on-downgrade policy, so it
&gt; would strip the referrer completely. But correct behavior would be to keep
&gt; <a rel="nofollow" href="https://source">https://source</a>.</span >
&gt;
<span class="quote">&gt; I could file a followup bug, or I could just set the referrer policy here to
&gt; unsafe-url w/o automatic tests, but somehow I just don't think this matters.
&gt; It's reusing its own referrer, so it can only over-strip it, not under-strip
&gt; it. Which means it's not a privacy / security issue, which means leaving it
&gt; like this forever is probably just fine.</span >

Ugh, human language. So confusing sometimes (&quot;it's reusing its own referrer&quot; - which? pre- or post-stripping?). AIUI, your argument is:

given page A containing a frame with page B:

i) page B was already opened with referrer of page A, subject to A's referrer policy, because it was opened in a frame of page A (right?)
ii) if we open page B in a new tab/window, the logical thing would be for the referrer to still be A, again subject to A's referrer policy
iii) for this case, we currently apply the default of no-referrer-on-downgrade, and the only case where that is problematic from a security/privacy perspective is when the referrer policy of page A allows passing (more of) A's URL to B then no-referrer-on-downgrade does.

You're saying that the opposite of (iii) (that is, &quot;under-stripping&quot; the referrer, so leaving too much of it where it really ought to be stripped down further to either origin or none) isn't possible. Is that really the case?

Let's say both A and B are https:, and A specifies referrer policy of &quot;none&quot;. AIUI, B-in-a-frame gets no referrer info. However, right now, we pass all of A's URL to B when B is opened in a new tab/window, right? (AFAICT this is the case when A and B are both http:, too)

I'm assuming I'm missing something, but I'm not sure what. :-)

Even if I haven't missed anything, this can still be a followup because I think it's more of an edgecase than opening links - but *if* I'm right, we do need to do something.</pre></div><div class="change-set" id="c122"><div class="comment" data-id="10020067" data-no="122"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-122" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7207579_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7207579_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-122"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-122" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c122">Comment 122</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 04:30 PDT" data-time="1426159822">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-122">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-122" data-comment-id="10020067">remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=0b66002bd78e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=0b66002bd78e</a></pre></div><div class="change-set" id="c123"><div class="comment" data-id="10020089" data-no="123"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-123" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7207579_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7207579_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-123"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-123" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c123">Comment 123</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 04:39 PDT" data-time="1426160380">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-123">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-123" data-comment-id="10020089">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8576558" name="attach_8576558" title="propagate referrer policy throughout the ui">attachment 8576558</a> <a href="/attachment.cgi?id=8576558&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8576558&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576558'>[review]</a>
propagate referrer policy throughout the ui

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8576558" name="attach_8576558" title="propagate referrer policy throughout the ui">attachment 8576558</a> <a href="/attachment.cgi?id=8576558&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8576558&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576558'>[review]</a>:
-----------------------------------------------------------------

::: browser/base/content/browser.js
&#64;&#64; +1193,3 &#64;&#64;
<span class="quote">&gt;        else if (window.arguments.length &gt;= 3) {
&gt; +        let referrerURI = window.arguments[2];
&gt; +        if (typeof(referrerURI) == 'string') {</span >

Nit: double quotes</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576558&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8576558</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review+</div></div></div><div class="change-set" id="c124"><div class="comment" data-id="10020137" data-no="124"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-124" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7207579_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7207579_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-124"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-124" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c124">Comment 124</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 04:54 PDT" data-time="1426161299">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-124">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-124" data-comment-id="10020137">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8576569" name="attach_8576569" title="test cases - click, middle-click, new-{tab,window}">attachment 8576569</a> <a href="/attachment.cgi?id=8576569&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8576569&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576569'>[review]</a>
test cases - click, middle-click, new-{tab,window}

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8576569" name="attach_8576569" title="test cases - click, middle-click, new-{tab,window}">attachment 8576569</a> <a href="/attachment.cgi?id=8576569&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8576569&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8576569'>[review]</a>:
-----------------------------------------------------------------

::: browser/base/content/test/referrer/browser_referrer_simple_click.js
&#64;&#64; +5,5 &#64;&#64;
<span class="quote">&gt; +  info(&quot;browser_referrer_simple_click: &quot; +
&gt; +       getReferrerTestDescription(aTestNumber));
&gt; +  BrowserTestUtils.browserLoaded(gTestWindow.gBrowser.selectedBrowser).then(
&gt; +      function() {
&gt; +    checkReferrerAndStartNextTest(aTestNumber, null, null,</span >

Nit: is it possible to have less wonky indentation here? I've noticed that you stick to a conservative characters-per-line limit (not a criticism!). Personally, I'm not fussed until you go over something like 120, so I would just put the function() { on the previous line, but I appreciate that opinions may differ. :-)

If you would prefer not to, one other option would be passing:

checkReferrerAndStartNextTest.bind(null, aTestNumber, null, null, startSimpleClickTestCase)

as the callback, or using a temp var somewhere. My brain is just confused by a function body that is less indented than the start of the function. :-\</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576569&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8576569</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review+</div></div></div><div class="change-set" id="a7229363_526840"><div class="change" id="aa7229363_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229363_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a7229363_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7229363_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7229363_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7229363_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:00 PDT" data-time="1426179613">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8569532&amp;action=edit"
           title="bug_1113431_referrer.patch"
           class=""
        >Attachment #8569532</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a7229399_526840"><div class="change" id="aa7229399_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229399_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a7229399_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7229399_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7229399_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7229399_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:00 PDT" data-time="1426179649">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8563141&amp;action=edit"
           title="WIP"
           class=""
        >Attachment #8563141</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a7229438_526840"><div class="change" id="aa7229438_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229438_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a7229438_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7229438_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7229438_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7229438_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:01 PDT" data-time="1426179688">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8569473&amp;action=edit"
           title="bug_1113431_referrer_tests.patch"
           class=""
        >Attachment #8569473</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c125"><div class="comment" data-id="10021670" data-no="125"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-125" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229438_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7229438_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-125"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-125" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c125">Comment 125</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:03 PDT" data-time="1426179834">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-125">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-125" data-comment-id="10021670">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8573709" name="attach_8573709" title="dragdrop.patch">attachment 8573709</a> <a href="/attachment.cgi?id=8573709&amp;action=edit" title="dragdrop.patch">[details]</a> <a href="/attachment.cgi?id=8573709&amp;action=diff" title="dragdrop.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8573709'>[review]</a>
dragdrop.patch

I don't think we need this - drag-n-drop hadn't been passing referrer before the meta-referrer changes, and it still doesn't. But feel free to file a followup if you wish.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8573709&amp;action=edit"
           title="dragdrop.patch"
           class=""
        >Attachment #8573709</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c126"><div class="comment" data-id="10021715" data-no="126"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-126" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229438_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7229438_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-126"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-126" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c126">Comment 126</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:10 PDT" data-time="1426180224">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-126">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8576754"
         class="attachment patch obsolete"
         data-id="8576754" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="37353">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8576754">
          <a class="link" href="attachment.cgi?id=8576754&amp;action=diff">
        <span id="att-8576754-description" itemprop="description">propagate referrer policy throughout the ui</span></a> (obsolete)
        — <a href="attachment.cgi?id=8576754&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576754">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-126" data-comment-id="10021715">Addressed style comment, and s/Ci/Components.interfaces/ in toolkit's browser.xml (per try run). Carrying r+ from Gijs.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576558&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8576558</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8576754&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8576754</a> -
        Flags: review+</div></div></div><div class="change-set" id="c127"><div class="comment" data-id="10021738" data-no="127"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-127" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229438_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7229438_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-127"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-127" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c127">Comment 127</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:13 PDT" data-time="1426180415">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-127">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8576756"
         class="attachment patch obsolete"
         data-id="8576756" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="20115">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8576756">
          <a class="link" href="attachment.cgi?id=8576756&amp;action=diff">
        <span id="att-8576756-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8576756&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8576756">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-127" data-comment-id="10021738">Addressed style comment. Carrying r+ from Gijs.

Could you please do another try run with the latest -browser and -tests patches?  The former contains a small fix that was causing failures all over.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576569&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8576569</a> -
        Attachment is obsolete: true</div><div class="change">Flags: needinfo?(gijskruitbosch+bugs)</div><div class="change">
        <a href="/attachment.cgi?id=8576756&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8576756</a> -
        Flags: review+</div></div></div><div class="change-set" id="c128"><div class="comment" data-id="10021782" data-no="128"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-128" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7229438_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7229438_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-128"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-128" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c128">Comment 128</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:20 PDT" data-time="1426180817">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-128">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-128" data-comment-id="10021782">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8574270" name="attach_8574270" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8574270</a> <a href="/attachment.cgi?id=8574270&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8574270&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574270'>[review]</a>
Document and nsIWebNavigation changes for referrer policy in UI code

&#64;Sid - can you please review or reassign this?  sr=bz already but needs a regular review, I think.  Also see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c63">comment 63</a>.</pre><div class="activity"><div class="change">Flags: needinfo?(sstamm)</div></div></div><div class="change-set" id="a7230871_346894"><div class="change" id="aa7230871_346894">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_346894" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/9878b2a2629e131ec58a9760e2733b2f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_346894" id="a7230871_346894"><a class="email " href="/user_profile?user_id=346894" > <span class="fna">:Margaret Leibovic</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7230871_346894"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7230871_346894">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7230871_346894">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:25 PDT" data-time="1426181121">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED INCOMPLETE - propagate referrer policy in android"
   href="/show_bug.cgi?id=1141142">1141142</a></div></div></div><div class="change-set" id="c129"><div class="comment" data-id="10021933" data-no="129"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-129" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7230871_346894"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-129"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-129" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c129">Comment 129</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-12 10:44 PDT" data-time="1426182288">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-129">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-129" data-comment-id="10021933">(In reply to Gijs Kruitbosch (unavailable until Friday March 13th) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c121">comment #121</a>)
<span class="quote">&gt; given page A containing a frame with page B:
&gt; 
&gt; i) page B was already opened with referrer of page A, subject to A's
&gt; referrer policy, because it was opened in a frame of page A (right?)
&gt; ii) if we open page B in a new tab/window, the logical thing would be for
&gt; the referrer to still be A, again subject to A's referrer policy
&gt; iii) for this case, we currently apply the default of
&gt; no-referrer-on-downgrade, and the only case where that is problematic from a
&gt; security/privacy perspective is when the referrer policy of page A allows
&gt; passing (more of) A's URL to B then no-referrer-on-downgrade does.</span >

Yep.

<span class="quote">&gt; You're saying that the opposite of (iii) (that is, &quot;under-stripping&quot; the
&gt; referrer, so leaving too much of it where it really ought to be stripped
&gt; down further to either origin or none) isn't possible. Is that really the
&gt; case?</span >

Yep.

<span class="quote">&gt; Let's say both A and B are https:, and A specifies referrer policy of
&gt; &quot;none&quot;. AIUI, B-in-a-frame gets no referrer info.</span >

Yep.

<span class="quote">&gt; However, right now, we
&gt; pass all of A's URL to B when B is opened in a new tab/window, right?</span >

Nope.  We pass B.document.referrer, which is already empty; not A.document.documentURIObject, which is the full URL of A.

<a rel="nofollow" href="http://lxr.mozilla.org/mozilla-central/source/browser/base/content/nsContextMenu.js#925">http://lxr.mozilla.org/mozilla-central/source/browser/base/content/nsContextMenu.js#925</a>
-- passes gContextMenuContentData.referrer.

<a rel="nofollow" href="http://lxr.mozilla.org/mozilla-central/source/browser/base/content/content.js#161">http://lxr.mozilla.org/mozilla-central/source/browser/base/content/content.js#161</a>
-- sets gContextMenuContentData.referrer to event.target.ownerDocument.referrer (event is the contextmenu open event, so its target is in B, not in A - you need to right-click inside B to open B in a new frame).

<span class="quote">&gt; Even if I haven't missed anything, this can still be a followup because I
&gt; think it's more of an edgecase than opening links - but *if* I'm right, we
&gt; do need to do something.</span >

Still want a followup?  Methinks not, but if you wish...</pre></div><div class="change-set" id="c130"><div class="comment" data-id="10025380" data-no="130"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-130" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-130"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-130" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c130">Comment 130</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-13 02:44 PDT" data-time="1426239899">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-130">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-130" data-comment-id="10025380">remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a0a991cfbd6e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a0a991cfbd6e</a></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="c131"><div class="comment" data-id="10025383" data-no="131"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-131" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-131"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-131" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c131">Comment 131</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-13 02:45 PDT" data-time="1426239955">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-131">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-131" data-comment-id="10025383">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c129">comment #129</a>)
<span class="quote">&gt; (In reply to Gijs Kruitbosch (unavailable until Friday March 13th) from
&gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c121">comment #121</a>)
&gt; &gt; Even if I haven't missed anything, this can still be a followup because I
&gt; &gt; think it's more of an edgecase than opening links - but *if* I'm right, we
&gt; &gt; do need to do something.
&gt; 
&gt; Still want a followup?  Methinks not, but if you wish...</span >

Nope, thanks for clearing up my confusion!</pre></div><div class="change-set" id="c132"><div class="comment" data-id="10027566" data-no="132"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-132" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7230871_346894"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-132"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-132" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c132">Comment 132</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-13 11:41 PDT" data-time="1426272116">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-132">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-132" data-comment-id="10027566">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c130">comment #130</a>)
<span class="quote">&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a0a991cfbd6e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a0a991cfbd6e</a></span >

All fine, except a race on linux opt e10s in the open-in-new-window test:

03:44:29 browser_referrer_open_link_in_window: policy=[undefined] rel=[undefined] http:// -&gt; http://
03:44:30 must wait for load
03:44:30 must wait for focus
... logging from unrelated addons code ...
03:45:13 Longer timeout required, waiting longer...

It opened the window and loaded the target:

<a rel="nofollow" href="http://mozilla-releng-blobs.s3.amazonaws.com/blobs/try/sha512/ec315ae00685fd5d73a946c9b18e6559f0ec290a5c833fd3c79dcdda043ddfd3dfbe7fba70317fbd90dbcc609597344369d0e282383970644088a55987783850">http://mozilla-releng-blobs.s3.amazonaws.com/blobs/try/sha512/ec315ae00685fd5d73a946c9b18e6559f0ec290a5c833fd3c79dcdda043ddfd3dfbe7fba70317fbd90dbcc609597344369d0e282383970644088a55987783850</a>

...but didn't call me back the way I expected.  Ah, life is like that.  One more version is coming right up...</pre></div><div class="change-set" id="c133"><div class="comment" data-id="10027600" data-no="133"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-133" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7230871_346894"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-133"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-133" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c133">Comment 133</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-13 11:47 PDT" data-time="1426272440">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-133">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8577368"
         class="attachment patch obsolete"
         data-id="8577368" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="19864">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8577368">
          <a class="link" href="attachment.cgi?id=8577368&amp;action=diff">
        <span id="att-8577368-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8577368&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8577368">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-133" data-comment-id="10027600">Exfoliate waitForFocus from the test - it appears to race with the new tab load in linux opt e10s.  Replace it with the &quot;load&quot; event when waiting for a new window to open.  Remove it from the other places too, we don't seem to need it.

Another try run?  (Sorry to keep bugging you...)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576756&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8576756</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8577368&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8577368</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c134"><div class="comment" data-id="10030447" data-no="134"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-134" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-134"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-134" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c134">Comment 134</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-14 12:48 PDT" data-time="1426362539">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-134">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-134" data-comment-id="10030447">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8577368" name="attach_8577368" title="test cases - click, middle-click, new-{tab,window}">attachment 8577368</a> <a href="/attachment.cgi?id=8577368&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8577368&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8577368'>[review]</a>
test cases - click, middle-click, new-{tab,window}

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8577368" name="attach_8577368" title="test cases - click, middle-click, new-{tab,window}">attachment 8577368</a> <a href="/attachment.cgi?id=8577368&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8577368&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8577368'>[review]</a>:
-----------------------------------------------------------------

::: browser/base/content/test/referrer/head.js
&#64;&#64; +145,5 &#64;&#64;
<span class="quote">&gt; +  return new Promise(function(resolve) {
&gt; +    Services.obs.addObserver(function observer(aSubject, aTopic) {
&gt; +      if (aWindow == aSubject) {
&gt; +        Services.obs.removeObserver(observer, aTopic);
&gt; +        executeSoon(resolve);</span >

Why executeSoon? Why not just resolve immediately?

&#64;&#64; +183,5 &#64;&#64;
<span class="quote">&gt; +        Services.wm.removeListener(this);
&gt; +        var newWindow = aXULWindow.QueryInterface(Ci.nsIInterfaceRequestor)
&gt; +                                  .getInterface(Ci.nsIDOMWindow);
&gt; +        newWindow.addEventListener(&quot;load&quot;, function onLoad() {
&gt; +          newWindow.removeEventListener(&quot;load&quot;, onLoad, false);</span >

I am skeptical about your change to remove the focus handling here. I also just realized you could use promiseFocus() (or perhaps it needs to be SimpleTest.promiseFocus; not sure) here in the previous version. In any case, I'll push to try in a sec.

Also, instead of this load handler, perhaps use:

delayedStartupFinished(newWindow).then(resolve);

?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8577368&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8577368</a> -
        Flags: review?(gijskruitbosch+bugs) &rarr; review+</div></div></div><div class="change-set" id="c135"><div class="comment" data-id="10030451" data-no="135"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-135" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-135"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-135" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c135">Comment 135</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-14 12:52 PDT" data-time="1426362741">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-135">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-135" data-comment-id="10030451">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c134">comment #134</a>)
<span class="quote">&gt; ::: browser/base/content/test/referrer/head.js
&gt; &#64;&#64; +183,5 &#64;&#64;
&gt; &gt; +        Services.wm.removeListener(this);
&gt; &gt; +        var newWindow = aXULWindow.QueryInterface(Ci.nsIInterfaceRequestor)
&gt; &gt; +                                  .getInterface(Ci.nsIDOMWindow);
&gt; &gt; +        newWindow.addEventListener(&quot;load&quot;, function onLoad() {
&gt; &gt; +          newWindow.removeEventListener(&quot;load&quot;, onLoad, false);
&gt; 
&gt; I am skeptical about your change to remove the focus handling here.</span >

Err, scratch that. We don't actually need focus on this window anyway. :-\

<span class="quote">&gt; I also
&gt; just realized you could use promiseFocus() (or perhaps it needs to be
&gt; SimpleTest.promiseFocus; not sure) here in the previous version. In any
&gt; case, I'll push to try in a sec.</span >

Well, I would have, but we're in the middle of a treeclosing window. Will try to do it afterwards (should be finished in 1 hour or so, if my timezone math is right), or tomorrow. If there isn't a link here monday, please yell at (needinfo) me.</pre></div><div class="change-set" id="c136"><div class="comment" data-id="10030534" data-no="136"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-136" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-136"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-136" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c136">Comment 136</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-14 14:55 PDT" data-time="1426370111">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-136">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-136" data-comment-id="10030534">remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=762951d39c9c">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=762951d39c9c</a>

(and sorry that this took a little longer than the previous reviews, yesterday and today were a bit manic)</pre></div><div class="change-set" id="c137"><div class="comment" data-id="10031177" data-no="137"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-137" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7230871_346894"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-137"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-137" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c137">Comment 137</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-15 01:03 PDT" data-time="1426406629">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-137">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8577711"
         class="attachment patch obsolete"
         data-id="8577711" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="20897">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8577711">
          <a class="link" href="attachment.cgi?id=8577711&amp;action=diff">
        <span id="att-8577711-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a> (obsolete)
        — <a href="attachment.cgi?id=8577711&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8577711">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-137" data-comment-id="10031177">Addressed review comments - removed executeSoon, changed load to browser-delayed-startup-finished.  Snuck in one more test - open in new private window.  Fixed outdated comments and removed leftover debug logging.  Carrying r+ from Gijs.

Last try-run looked good - none of the orange was from the referrer tests.  Ship it?  Or another try run?  Your call.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8577368&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8577368</a> -
        Attachment is obsolete: true</div><div class="change">Flags: needinfo?(gijskruitbosch+bugs)</div><div class="change">
        <a href="/attachment.cgi?id=8577711&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8577711</a> -
        Flags: review+</div></div></div><div class="change-set" id="c138"><div class="comment" data-id="10031611" data-no="138"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-138" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a7230871_346894"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-138"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-138" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c138">Comment 138</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-15 07:55 PDT" data-time="1426431327">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-138">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-138" data-comment-id="10031611">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c137">comment #137</a>)
<span class="quote">&gt; Created <span class="bz_obsolete"><a href="/attachment.cgi?id=8577711" name="attach_8577711" title="test cases - click, middle-click, new-{tab,window}">attachment 8577711</a> <a href="/attachment.cgi?id=8577711&amp;action=edit" title="test cases - click, middle-click, new-{tab,window}">[details]</a> <a href="/attachment.cgi?id=8577711&amp;action=diff" title="test cases - click, middle-click, new-{tab,window}">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8577711'>[review]</a>
&gt; test cases - click, middle-click, new-{tab,window}
&gt; 
&gt; Addressed review comments - removed executeSoon, changed load to
&gt; browser-delayed-startup-finished.  Snuck in one more test - open in new
&gt; private window.  Fixed outdated comments and removed leftover debug logging.
&gt; Carrying r+ from Gijs.
&gt; 
&gt; Last try-run looked good - none of the orange was from the referrer tests. 
&gt; Ship it?  Or another try run?  Your call.</span >

I'm happy to do another try run, but in any case, you still need review on the dom/docshell/embedding/netwerk changes before this can land, I think?

remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e</a></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="c139"><div class="comment" data-id="10036841" data-no="139"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-139" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7230871_346894"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-139"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-139" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c139">Comment 139</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-16 15:50 PDT" data-time="1426546220">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-139">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-139" data-comment-id="10036841">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c138">comment #138</a>)
<span class="quote">&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e</a></span >

Looks good, thanks!

<span class="quote">&gt; ...but in any case, you still need review on
&gt; the dom/docshell/embedding/netwerk changes before this can land, I think?</span >

Yes.  Now if only the person who asked me for help with this bug in the first place would kindly do this review that has been in his queue for over a week... :-/</pre></div><div class="change-set" id="c140"><div class="comment" data-id="10037460" data-no="140"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-140" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a7230871_346894"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-140"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-140" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c140">Comment 140</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-16 17:58 PDT" data-time="1426553921">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-140">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-140" data-comment-id="10037460">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8574270" name="attach_8574270" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8574270</a> <a href="/attachment.cgi?id=8574270&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8574270&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574270'>[review]</a>
Document and nsIWebNavigation changes for referrer policy in UI code

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8574270" name="attach_8574270" title="Document and nsIWebNavigation changes for referrer policy in UI code">attachment 8574270</a> <a href="/attachment.cgi?id=8574270&amp;action=edit" title="Document and nsIWebNavigation changes for referrer policy in UI code">[details]</a> <a href="/attachment.cgi?id=8574270&amp;action=diff" title="Document and nsIWebNavigation changes for referrer policy in UI code">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8574270'>[review]</a>:
-----------------------------------------------------------------

Ack!  I'm so sorry for the long delay, Alex.  :(  bz sr+'ed the interface bits, and that's most of what this patch does: update the interface call-sites.  The rest looks good to me, but unfortunately I'm not a DOM or DocShell peer so I can't technically r+ it.

jst: I would r+ this if I could.  Can you help?

::: toolkit/components/viewsource/content/viewPartialSource.js
&#64;&#64; +177,5 &#64;&#64;
<span class="quote">&gt; +                                         &quot;<a rel="nofollow" href="view-source:data:text/html;charset=utf-8">view-source:data:text/html;charset=utf-8</a>,&quot; :
&gt; +                                         &quot;<a rel="nofollow" href="view-source:data:application/xml;charset=utf-8">view-source:data:application/xml;charset=utf-8</a>,&quot;)
&gt; +                                        + encodeURIComponent(tmpNode.innerHTML),
&gt; +                                        loadFlags,
&gt; +                                        null, 0,  // referrer, referrerPolicy</span >

Minor nit: can you use a more meaningful constant instead of 0 so it's clearer?  I'm thinking: Ci.nsIHttpChannel.REFERRER_POLICY_DEFAULT like in RemoteWebNavigation.jsm.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: <span class="activity-deleted">review?(sstamm)</span></div><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: review?(jst)</div><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: feedback+</div></div></div><div class="change-set" id="c141"><div class="comment" data-id="10037466" data-no="141"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-141" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339203" id="a7230871_346894"><img src="https://secure.gravatar.com/avatar/acd21cf298169c0b87813c52025ee6e9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339203" id="a7230871_346894"><a class="email " href="/user_profile?user_id=339203" > <span class="fna">Sid Stamm [:geekboy or :sstamm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-141"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-141" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c141">Comment 141</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-16 18:00 PDT" data-time="1426554011">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-141">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-141" data-comment-id="10037466">Alex: please needinfo me again (and perhaps pester me via email too) if jst doesn't get back to us quickly and I'll try to find another peer to review.  Your code looks good, but want to make sure I didn't miss something module specific.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sstamm)</span></div></div></div><div class="change-set" id="a7660816_12352"><div class="change" id="aa7660816_12352">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_12352" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/1e8a6f9ec1e854e31b94b2edc0c56b81?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_12352" id="a7660816_12352"><a class="email " href="/user_profile?user_id=12352" > <span class="fna">Johnny Stenback (:jst)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7660816_12352"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7660816_12352">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7660816_12352">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-17 09:51 PDT" data-time="1426611066">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Flags: review?(jst) &rarr; review+</div></div></div><div class="change-set" id="c142"><div class="comment" data-id="10043731" data-no="142"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-142" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7660816_12352"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-142"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-142" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c142">Comment 142</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-17 23:14 PDT" data-time="1426659297">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-142">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8579148"
         class="attachment patch"
         data-id="8579148" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-api.patch">
      <meta itemprop="contentSize" content="23171">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8579148">
          <a class="link" href="attachment.cgi?id=8579148&amp;action=diff">
        <span id="att-8579148-description" itemprop="description">Document and nsIWebNavigation changes for referrer policy in UI code</span></a>
        — <a href="attachment.cgi?id=8579148&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579148">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-142" data-comment-id="10043731">Addressed Sid's style comment; did a trivial rebase.  Carrying over r=jst sr=bz.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8574270&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8574270</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8579148&amp;action=edit"
           title="Document and nsIWebNavigation changes for referrer policy in UI code"
           class=""
        >Attachment #8579148</a> -
        Flags: review+</div></div></div><div class="change-set" id="c143"><div class="comment" data-id="10043735" data-no="143"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-143" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7660816_12352"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-143"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-143" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c143">Comment 143</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-17 23:16 PDT" data-time="1426659381">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-143">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8579150"
         class="attachment patch"
         data-id="8579150" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-browser.patch">
      <meta itemprop="contentSize" content="37354">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8579150">
          <a class="link" href="attachment.cgi?id=8579150&amp;action=diff">
        <span id="att-8579150-description" itemprop="description">propagate referrer policy throughout the ui</span></a>
        — <a href="attachment.cgi?id=8579150&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579150">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-143" data-comment-id="10043735">Trivial rebase.  Carrying over r+ from Gijs.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8576754&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8576754</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8579150&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8579150</a> -
        Flags: review+</div></div></div><div class="change-set" id="c144"><div class="comment" data-id="10043737" data-no="144"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-144" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7660816_12352"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-144"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-144" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c144">Comment 144</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-17 23:17 PDT" data-time="1426659437">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-144">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8579151"
         class="attachment patch"
         data-id="8579151" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="1113431-tests.patch">
      <meta itemprop="contentSize" content="20898">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8579151">
          <a class="link" href="attachment.cgi?id=8579151&amp;action=diff">
        <span id="att-8579151-description" itemprop="description">test cases - click, middle-click, new-{tab,window}</span></a>
        — <a href="attachment.cgi?id=8579151&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8579151">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-144" data-comment-id="10043737">Trivial rebase.  Carrying over r+ from Gijs.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8577711&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8577711</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8579151&amp;action=edit"
           title="test cases - click, middle-click, new-{tab,window}"
           class=""
        >Attachment #8579151</a> -
        Flags: review+</div></div></div><div class="change-set" id="c145"><div class="comment" data-id="10043778" data-no="145"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-145" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7660816_12352"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-145"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-145" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c145">Comment 145</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-17 23:41 PDT" data-time="1426660902">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-145">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-145" data-comment-id="10043778">Looks like all the ducks are in a row - time to land this on M/C.

Last try run:

<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=346747818e3e</a>

(I'm not sure what the process is for landing this on 38 too; assuming this is a separate step, and that someone knowledgeable will chime in.  That would probably also require the patches from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - [e10s] &quot;Open Link in New Tab&quot; in remote browser causes unsafe CPOW usage warning"
   href="/show_bug.cgi?id=1133577">bug 1133577</a>.)</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=checkin-needed&amp;resolution=---">checkin-needed</a></div><div class="change">Version: 36 Branch &rarr; Trunk</div></div></div><div class="change-set" id="c146"><div class="comment" data-id="10045587" data-no="146"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-146" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a7660816_12352"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-146"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-146" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c146">Comment 146</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-18 08:27 PDT" data-time="1426692432">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-146">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-146" data-comment-id="10045587"><a rel="nofollow" href="https://hg.mozilla.org/integration/fx-team/rev/6a170ee249b2">https://hg.mozilla.org/integration/fx-team/rev/6a170ee249b2</a>
<a rel="nofollow" href="https://hg.mozilla.org/integration/fx-team/rev/3019cfbbfd0d">https://hg.mozilla.org/integration/fx-team/rev/3019cfbbfd0d</a>
<a rel="nofollow" href="https://hg.mozilla.org/integration/fx-team/rev/4b5850a205d0">https://hg.mozilla.org/integration/fx-team/rev/4b5850a205d0</a></pre><div class="activity"><div class="change">Flags: in-testsuite+</div><div class="change">Keywords: <span class="activity-deleted"><a href="/buglist.cgi?keywords=checkin-needed&amp;resolution=---">checkin-needed</a></span></div><div class="change">Whiteboard: [fixed-in-fx-team]</div></div></div><div class="change-set" id="c147"><div class="comment" data-id="10046845" data-no="147"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-147" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_103593" id="a7660816_12352"><img src="https://secure.gravatar.com/avatar/08de945228403cb0598d5906e2407a7d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_103593" id="a7660816_12352"><a class="email " href="/user_profile?user_id=103593" > <span class="fna">:Gavin Sharp [email: gavin&#64;gavinsharp.com]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-147"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-147" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c147">Comment 147</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-18 11:44 PDT" data-time="1426704264">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-147">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-147" data-comment-id="10046845">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c145">comment #145</a>)
<span class="quote">&gt; (I'm not sure what the process is for landing this on 38 too; assuming this
&gt; is a separate step, and that someone knowledgeable will chime in.  That
&gt; would probably also require the patches from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - [e10s] &quot;Open Link in New Tab&quot; in remote browser causes unsafe CPOW usage warning"
   href="/show_bug.cgi?id=1133577">bug 1133577</a>.)</span >

Once the patch is merged to mozilla-central safely, the next step is to request approval‑mozilla‑aurora from the attachment details page (you can do it for just one of the three patches here). That will auto-fill in a little questionnaire to be filled out explaining the rationale, <a rel="nofollow" href="https://wiki.mozilla.org/Release_Management/Uplift_rules#Guidelines_on_approval_comments">https://wiki.mozilla.org/Release_Management/Uplift_rules#Guidelines_on_approval_comments</a> has some more context on that. Once that's done the process is pretty automatic from there. Gijs can help with the overall process as needed.</pre></div><div class="change-set" id="a7754498_75935"><div class="change" id="aa7754498_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a7754498_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a7754498_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7754498_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7754498_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7754498_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-18 11:52 PDT" data-time="1426704748">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Intermittent browser_referrer_open_link_in_tab.js | Test timed out"
   href="/show_bug.cgi?id=1144816">1144816</a></div></div></div><div class="change-set" id="c148"><div class="comment" data-id="10048093" data-no="148"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-148" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a7754498_75935"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a7754498_75935"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-148"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-148" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c148">Comment 148</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-18 15:40 PDT" data-time="1426718405">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-148">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-148" data-comment-id="10048093"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/6a170ee249b2">https://hg.mozilla.org/mozilla-central/rev/6a170ee249b2</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/3019cfbbfd0d">https://hg.mozilla.org/mozilla-central/rev/3019cfbbfd0d</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/4b5850a205d0">https://hg.mozilla.org/mozilla-central/rev/4b5850a205d0</a></pre><div class="activity"><div class="change">Status: ASSIGNED &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2015-03-18 15:40 PDT" data-time="1426718405">7 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=isnotempty">status-firefox39</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox39&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Whiteboard: <span class="activity-deleted">[fixed-in-fx-team]</span></div><div class="change">Target Milestone: --- &rarr; Firefox 39</div></div></div><div class="change-set" id="a7773418_458208"><div class="change" id="aa7773418_458208">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_458208" id="a7773418_458208"><img src="https://secure.gravatar.com/avatar/77b9a64a0b7dedcdc291ede3655d202d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_458208" id="a7773418_458208"><a class="email " href="/user_profile?user_id=458208" > <span class="fna">Marco Mucci [:MarcoM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7773418_458208"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7773418_458208">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7773418_458208">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-18 17:07 PDT" data-time="1426723668">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Iteration: --- &rarr; 39.2 - 23 Mar</div></div></div><div class="change-set" id="a7831518_75935"><div class="change" id="aa7831518_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a7831518_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a7831518_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7831518_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7831518_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a7831518_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-19 09:16 PDT" data-time="1426781768">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent browser_referrer_open_link_in_private.js,browser_referrer_open_link_in_window.js | Test timed out"
   href="/show_bug.cgi?id=1145199">1145199</a></div></div></div><div class="change-set" id="c149"><div class="comment" data-id="10061704" data-no="149"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-149" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a7831518_75935"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a7831518_75935"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-149"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-149" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c149">Comment 149</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-22 05:07 PDT" data-time="1427026035">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-149">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-149" data-comment-id="10061704">Alex, could you fill the uplift request to aurora (38)? thanks</pre><div class="activity"><div class="change">Flags: needinfo?(averstak)</div></div></div><div class="change-set" id="c150"><div class="comment" data-id="10062140" data-no="150"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-150" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a7831518_75935"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a7831518_75935"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-150"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-150" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c150">Comment 150</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-22 11:47 PDT" data-time="1427050035">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-150">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-150" data-comment-id="10062140">Comment on <span class=""><a href="/attachment.cgi?id=8579150" name="attach_8579150" title="propagate referrer policy throughout the ui">attachment 8579150</a> <a href="/attachment.cgi?id=8579150&amp;action=edit" title="propagate referrer policy throughout the ui">[details]</a> <a href="/attachment.cgi?id=8579150&amp;action=diff" title="propagate referrer policy throughout the ui">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8579150'>[review]</a>
propagate referrer policy throughout the ui

Approval Request Comment

[Feature/regressing bug #]:

1113431 (primary 3 patches)
1133577 (likely needed for the above to apply)
1144816 (focus patch fixes race condition in the test)

I'd also disable referrer tests on e10s - they're flaky on several platforms, for several different reasons (unrelated to these patches, AFAICT).

[User impact if declined]:

Meta referrer will get delayed yet again:

<a rel="nofollow" href="https://groups.google.com/forum/#!topic/mozilla.dev.platform/0elnyR7jZe8">https://groups.google.com/forum/#!topic/mozilla.dev.platform/0elnyR7jZe8</a>

This feature enables several privacy &amp; security improvements.  Facebook, Yahoo, and Google want this, and have been using a similar feature in Chrome &amp; Safari for years.  For Google Scholar specifically (I cannot speak for others), lack of meta referrer support stops me from moving Firefox to HTTPS / HSTS, which has obvious privacy and security implications.

[Describe test coverage new/current, TreeHerder]:

Primary bug includes an integration test.  TreeHerder has been happy for several days, except on e10s - see <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Intermittent browser_referrer_open_link_in_tab.js | Test timed out"
   href="/show_bug.cgi?id=1144816">bug 1144816</a> and <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent browser_referrer_open_link_in_private.js,browser_referrer_open_link_in_window.js | Test timed out"
   href="/show_bug.cgi?id=1145199">bug 1145199</a>, both of which are test flakiness on e10s only, not bugs in the feature AFAICT.

[Risks and why]:

Medium - there's a fair amount of code, but it's all straightforward parameter propagation, and it's well covered by the automatic tests.  The underlying meta referrer implementation had been on MC and Aurora / Beta since last fall.  This set of patches merely propagates the referrer policy in a few more places in the UI.

These changes obviously touch click and context menu handling code in the UI.  But if I broke _that_ completely, these patches would be backed out by now. :-)

The real risk here is the privacy / security risk of propagating overly detailed referrer headers due to unknown implementation deficiencies.  I'm not aware of any logic errors in this set of patches, but, of course, I'm merely human.

[String/UUID change made/needed]:

One of the patches changes UUID for nsIWebNavigation, and renames one of the methods in it.  I updated all the calls on MC, and it was not in use by any of the addons.

Per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c74">comment 74</a>, this breaks source compatibility with one of the addons, due to the addon's use of a private function in browser.js.  The author had been copied on the bug for some time.  No UUID change is involved.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(averstak)</span></div><div class="change">
        <a href="/attachment.cgi?id=8579150&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8579150</a> -
        Flags: approval-mozilla-aurora?</div></div></div><div class="change-set" id="a8146243_495955"><div class="change" id="aa8146243_495955">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_495955" id="a8146243_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a8146243_495955"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a8146243_495955">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a8146243_495955">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-23 00:41 PDT" data-time="1427096493">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8579150&amp;action=edit"
           title="propagate referrer policy throughout the ui"
           class=""
        >Attachment #8579150</a> -
        Flags: approval-mozilla-aurora? &rarr; approval-mozilla-aurora+</div></div></div><div class="change-set" id="c151"><div class="comment" data-id="10064908" data-no="151"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-151" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a8146243_495955"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-151"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-151" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c151">Comment 151</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-23 09:00 PDT" data-time="1427126446">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-151">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-151" data-comment-id="10064908">Part 2 needs rebasing for Aurora.</pre><div class="activity"><div class="change">Flags: needinfo?(averstak)</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=branch-patch-needed&amp;resolution=---">branch-patch-needed</a></div></div></div><div class="change-set" id="c152"><div class="comment" data-id="10065160" data-no="152"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-152" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-152"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-152" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c152">Comment 152</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-23 09:46 PDT" data-time="1427129181">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-152">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-152" data-comment-id="10065160">Sure, will do in the evening (have a day job, sorry).</pre></div><div class="change-set" id="c153"><div class="comment" data-id="10065346" data-no="153"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-153" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a8146243_495955"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-153"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-153" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c153">Comment 153</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-23 10:19 PDT" data-time="1427131150">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-153">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-153" data-comment-id="10065346">(In reply to Alex Verstak from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c152">comment #152</a>)
<span class="quote">&gt; Sure, will do in the evening (have a day job, sorry).</span >
No worries! Thanks for doing it.</pre></div><div class="change-set" id="c154"><div class="comment" data-id="10069055" data-no="154"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-154" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-154"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-154" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c154">Comment 154</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:50 PDT" data-time="1427187058">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-154">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582266"
         class="attachment patch"
         data-id="8582266" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-01-1133577-openLinkAndFramevFinal.patch">
      <meta itemprop="contentSize" content="11543">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582266">
          <a class="link" href="attachment.cgi?id=8582266&amp;action=diff">
        <span id="att-8582266-description" itemprop="description">aurora-01-1133577-openLinkAndFramevFinal.patch</span></a>
        — <a href="attachment.cgi?id=8582266&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582266">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-154" data-comment-id="10069055">Aurora patch 1 of 9; applies cleanly.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582266&amp;action=edit"
           title="aurora-01-1133577-openLinkAndFramevFinal.patch"
           class=""
        >Attachment #8582266</a> -
        Flags: review+</div></div></div><div class="change-set" id="c155"><div class="comment" data-id="10069057" data-no="155"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-155" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-155"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-155" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c155">Comment 155</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:51 PDT" data-time="1427187102">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-155">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582267"
         class="attachment patch"
         data-id="8582267" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-02-1133577-fixTestBrowser_bug734076v2.2.patch">
      <meta itemprop="contentSize" content="3222">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582267">
          <a class="link" href="attachment.cgi?id=8582267&amp;action=diff">
        <span id="att-8582267-description" itemprop="description">aurora-02-1133577-fixTestBrowser_bug734076v2.2.patch</span></a>
        — <a href="attachment.cgi?id=8582267&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582267">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-155" data-comment-id="10069057">Aurora patch 2 of 9; applies cleanly.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582267&amp;action=edit"
           title="aurora-02-1133577-fixTestBrowser_bug734076v2.2.patch"
           class=""
        >Attachment #8582267</a> -
        Flags: review+</div></div></div><div class="change-set" id="c156"><div class="comment" data-id="10069060" data-no="156"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-156" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-156"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-156" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c156">Comment 156</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:52 PDT" data-time="1427187140">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-156">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582269"
         class="attachment patch"
         data-id="8582269" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-03-1113431-api.patch">
      <meta itemprop="contentSize" content="23171">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582269">
          <a class="link" href="attachment.cgi?id=8582269&amp;action=diff">
        <span id="att-8582269-description" itemprop="description">aurora-03-1113431-api.patch</span></a>
        — <a href="attachment.cgi?id=8582269&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582269">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-156" data-comment-id="10069060">Aurora patch 3 of 9; applies cleanly.</pre></div><div class="change-set" id="c157"><div class="comment" data-id="10069061" data-no="157"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-157" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-157"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-157" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c157">Comment 157</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:55 PDT" data-time="1427187323">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-157">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582270"
         class="attachment patch"
         data-id="8582270" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-04-1113431-browser.patch">
      <meta itemprop="contentSize" content="37290">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582270">
          <a class="link" href="attachment.cgi?id=8582270&amp;action=diff">
        <span id="att-8582270-description" itemprop="description">aurora-04-1113431-browser.patch</span></a>
        — <a href="attachment.cgi?id=8582270&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582270">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-157" data-comment-id="10069061">Aurora patch 4 of 9; minor rebase against an earlier rel=noreferrer patch, covered by the test in the upcoming part 5.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582270&amp;action=edit"
           title="aurora-04-1113431-browser.patch"
           class=""
        >Attachment #8582270</a> -
        Flags: review+</div></div></div><div class="change-set" id="c158"><div class="comment" data-id="10069063" data-no="158"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-158" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-158"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-158" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c158">Comment 158</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:56 PDT" data-time="1427187360">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-158">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582271"
         class="attachment patch"
         data-id="8582271" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-05-1113431-tests.patch">
      <meta itemprop="contentSize" content="20898">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582271">
          <a class="link" href="attachment.cgi?id=8582271&amp;action=diff">
        <span id="att-8582271-description" itemprop="description">aurora-05-1113431-tests.patch</span></a>
        — <a href="attachment.cgi?id=8582271&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582271">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-158" data-comment-id="10069063">Aurora patch 5 of 9; applies cleanly.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582271&amp;action=edit"
           title="aurora-05-1113431-tests.patch"
           class=""
        >Attachment #8582271</a> -
        Flags: review+</div></div></div><div class="change-set" id="c159"><div class="comment" data-id="10069064" data-no="159"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-159" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-159"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-159" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c159">Comment 159</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:56 PDT" data-time="1427187398">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-159">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582272"
         class="attachment patch"
         data-id="8582272" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-06-1144816-timeout.patch">
      <meta itemprop="contentSize" content="2356">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582272">
          <a class="link" href="attachment.cgi?id=8582272&amp;action=diff">
        <span id="att-8582272-description" itemprop="description">aurora-06-1144816-timeout.patch</span></a>
        — <a href="attachment.cgi?id=8582272&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582272">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-159" data-comment-id="10069064">Aurora patch 6 of 9; applies cleanly.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582272&amp;action=edit"
           title="aurora-06-1144816-timeout.patch"
           class=""
        >Attachment #8582272</a> -
        Flags: review+</div></div></div><div class="change-set" id="c160"><div class="comment" data-id="10069065" data-no="160"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-160" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-160"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-160" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c160">Comment 160</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:57 PDT" data-time="1427187439">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-160">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582273"
         class="attachment patch"
         data-id="8582273" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-07-1144816-focus.patch">
      <meta itemprop="contentSize" content="3388">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582273">
          <a class="link" href="attachment.cgi?id=8582273&amp;action=diff">
        <span id="att-8582273-description" itemprop="description">aurora-07-1144816-focus.patch</span></a>
        — <a href="attachment.cgi?id=8582273&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582273">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-160" data-comment-id="10069065">Aurora patch 7 of 9; applies cleanly.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582273&amp;action=edit"
           title="aurora-07-1144816-focus.patch"
           class=""
        >Attachment #8582273</a> -
        Flags: review+</div></div></div><div class="change-set" id="c161"><div class="comment" data-id="10069067" data-no="161"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-161" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-161"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-161" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c161">Comment 161</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 01:59 PDT" data-time="1427187552">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-161">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582274"
         class="attachment patch"
         data-id="8582274" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-08-1144816-longer.patch">
      <meta itemprop="contentSize" content="3787">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582274">
          <a class="link" href="attachment.cgi?id=8582274&amp;action=diff">
        <span id="att-8582274-description" itemprop="description">aurora-08-1144816-longer.patch</span></a>
        — <a href="attachment.cgi?id=8582274&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582274">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-161" data-comment-id="10069067">Aurora patch 8 of 9; applies cleanly, not checked in to MC yet but safe (just increases timeouts) and r=gijs already.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582274&amp;action=edit"
           title="aurora-08-1144816-longer.patch"
           class=""
        >Attachment #8582274</a> -
        Flags: review+</div></div></div><div class="change-set" id="c162"><div class="comment" data-id="10069080" data-no="162"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-162" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-162"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-162" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c162">Comment 162</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 02:05 PDT" data-time="1427187909">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-162">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8582278"
         class="attachment patch obsolete"
         data-id="8582278" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aurora-09-1113431-skip-e10s.patch">
      <meta itemprop="contentSize" content="704">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8582278">
          <a class="link" href="attachment.cgi?id=8582278&amp;action=diff">
        <span id="att-8582278-description" itemprop="description">aurora-09-1113431-skip-e10s.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8582278&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1113431&attachment=8582278">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-162" data-comment-id="10069080">Aurora patch 9 of 9.  Skip flaky e10s tests on win &amp; mac due to <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Intermittent browser_referrer_open_link_in_private.js,browser_referrer_open_link_in_window.js | Test timed out"
   href="/show_bug.cgi?id=1145199">bug 1145199</a> and <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Intermittent browser_referrer_open_link_in_tab.js | Test timed out"
   href="/show_bug.cgi?id=1144816">bug 1144816</a>.  The mac one could well be fixed by part 8, but we don't know this yet.  The win one is still open.  Both are e10s races unrelated to meta-referrer code, hence silencing them on Aurora.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582278&amp;action=edit"
           title="aurora-09-1113431-skip-e10s.patch"
           class=""
        >Attachment #8582278</a> -
        Flags: review?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="c163"><div class="comment" data-id="10069109" data-no="163"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-163" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-163"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-163" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c163">Comment 163</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 02:14 PDT" data-time="1427188449">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-163">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-163" data-comment-id="10069109">This should do it for Aurora, though it obviously needs a try run (I don't have committer access to submit one).  Part 9 should be reviewed - flagging Gijs, though it's quite trivial.  All else is patches from MC with at worst a simple rebase.</pre></div><div class="change-set" id="c164"><div class="comment" data-id="10069116" data-no="164"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-164" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8146243_495955"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-164"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-164" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c164">Comment 164</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 02:15 PDT" data-time="1427188527">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-164">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-164" data-comment-id="10069116">Comment on <span class=""><a href="/attachment.cgi?id=8582269" name="attach_8582269" title="aurora-03-1113431-api.patch">attachment 8582269</a> <a href="/attachment.cgi?id=8582269&amp;action=edit" title="aurora-03-1113431-api.patch">[details]</a> <a href="/attachment.cgi?id=8582269&amp;action=diff" title="aurora-03-1113431-api.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8582269'>[review]</a>
aurora-03-1113431-api.patch

(Obviously reviewed, just forgot the flag.)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582269&amp;action=edit"
           title="aurora-03-1113431-api.patch"
           class=""
        >Attachment #8582269</a> -
        Flags: review+</div></div></div><div class="change-set" id="c165"><div class="comment" data-id="10069547" data-no="165"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-165" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a8146243_495955"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a8146243_495955"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-165"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-165" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c165">Comment 165</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 05:32 PDT" data-time="1427200328">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-165">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-165" data-comment-id="10069547">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8582278" name="attach_8582278" title="aurora-09-1113431-skip-e10s.patch">attachment 8582278</a> <a href="/attachment.cgi?id=8582278&amp;action=edit" title="aurora-09-1113431-skip-e10s.patch">[details]</a> <a href="/attachment.cgi?id=8582278&amp;action=diff" title="aurora-09-1113431-skip-e10s.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1113431&amp;attachment=8582278'>[review]</a>
aurora-09-1113431-skip-e10s.patch

We don't run e10s tests on aurora:

<a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=mozilla-aurora">https://treeherder.mozilla.org/#/jobs?repo=mozilla-aurora</a>

so this shouldn't be necessary.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582278&amp;action=edit"
           title="aurora-09-1113431-skip-e10s.patch"
           class=""
        >Attachment #8582278</a> -
        Flags: <span class="activity-deleted">review?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="a8264140_526840"><div class="change" id="aa8264140_526840">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8264140_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_526840" id="a8264140_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a8264140_526840"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a8264140_526840">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a8264140_526840">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 09:26 PDT" data-time="1427214390">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8582278&amp;action=edit"
           title="aurora-09-1113431-skip-e10s.patch"
           class=""
        >Attachment #8582278</a> -
        Attachment is obsolete: true</div><div class="change">Flags: <span class="activity-deleted">needinfo?(averstak)</span></div></div></div><div class="change-set" id="c166"><div class="comment" data-id="10070875" data-no="166"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-166" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_526840" id="a8264140_526840"><img src="https://secure.gravatar.com/avatar/d6e6bf9591db0d428df5f428d3131b5a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_526840" id="a8264140_526840"><a class="email " href="/user_profile?user_id=526840" > <span class="fna">Alex Verstak</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-166"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-166" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c166">Comment 166</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 09:37 PDT" data-time="1427215032">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-166">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-166" data-comment-id="10070875">Aurora patches are ready for checkin.  8 total; part 9 isn't needed, per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - &lt;meta name=&quot;referrer&quot;&gt; is ignored for navigations from the context menu and via a middle-click"
   href="/show_bug.cgi?id=1113431#c165">comment 165</a>.</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=checkin-needed&amp;resolution=---">checkin-needed</a></div></div></div><div class="change-set" id="c167"><div class="comment" data-id="10071029" data-no="167"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-167" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a8264140_526840"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a8264140_526840"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-167"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-167" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c167">Comment 167</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 10:03 PDT" data-time="1427216602">7 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-167">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-167" data-comment-id="10071029"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-aurora/rev/de0c010c81a4">https://hg.mozilla.org/releases/mozilla-aurora/rev/de0c010c81a4</a>
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-aurora/rev/5aaef73ac73e">https://hg.mozilla.org/releases/mozilla-aurora/rev/5aaef73ac73e</a>
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-aurora/rev/7670a26203b6">https://hg.mozilla.org/releases/mozilla-aurora/rev/7670a26203b6</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=isnotempty">status-firefox38</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox38&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Keywords: <span class="activity-deleted"><a href="/buglist.cgi?keywords=checkin-needed&amp;resolution=---">checkin-needed</a></span></div></div></div><div class="change-set" id="a8267036_75935"><div class="change" id="aa8267036_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a8267036_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a8267036_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a8267036_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a8267036_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a8267036_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-03-24 10:14 PDT" data-time="1427217286">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Keywords: <span class="activity-deleted"><a href="/buglist.cgi?keywords=branch-patch-needed&amp;resolution=---">branch-patch-needed</a></span></div></div></div><div class="change-set" id="a11910838_280903"><div class="change" id="aa11910838_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11910838_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a11910838_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11910838_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11910838_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a11910838_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-05-05 14:24 PDT" data-time="1430861088">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [adv-main38+]</div></div></div><div class="change-set" id="a11917726_280903"><div class="change" id="aa11917726_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a11917726_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a11917726_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11917726_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11917726_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a11917726_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-05-05 16:19 PDT" data-time="1430867976">7 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2015-2711</div></div></div><div class="change-set" id="a16565789_188891"><div class="change" id="aa16565789_188891">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_188891" id="a16565789_188891"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_188891" id="a16565789_188891"><a class="email " href="/user_profile?user_id=188891" > <span class="fna">Philip Chee</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a16565789_188891"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a16565789_188891">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#a16565789_188891">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-06-28 11:27 PDT" data-time="1435516039">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Propagate referrer policy throughout the UI: command-click and context menu open link in new tab/window (Port relevant bits from Bug 1113431)"
   href="/show_bug.cgi?id=1178104">CVE-2015-2711-SeaMonkey</a></div></div></div><div class="change-set" id="c168"><div class="comment" data-id="10780483" data-no="168"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-168" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_248150" id="a16565789_188891"><img src="https://secure.gravatar.com/avatar/d0d90148e08e3b64ccf75c46f31442c5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_248150" id="a16565789_188891"><a class="email " href="/user_profile?user_id=248150" > <span class="fna">Jean-Yves Perrier [:teoli]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-168"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-168" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c168">Comment 168</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-27 00:56 PDT" data-time="1443340568">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-168">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-168" data-comment-id="10780483">Morphing the ni/ in a dev-doc-needed</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(jypenator)</span></div><div class="change">Keywords: <a href="/buglist.cgi?keywords=dev-doc-needed&amp;resolution=---">dev-doc-needed</a></div></div></div><div class="change-set" id="c169"><div class="comment" data-id="10787375" data-no="169"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-169" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_248150" id="a16565789_188891"><img src="https://secure.gravatar.com/avatar/d0d90148e08e3b64ccf75c46f31442c5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_248150" id="a16565789_188891"><a class="email " href="/user_profile?user_id=248150" > <span class="fna">Jean-Yves Perrier [:teoli]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-169"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-169" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1113431#c169">Comment 169</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2015-09-29 00:37 PDT" data-time="1443512261">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-169">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-169" data-comment-id="10787375">Added a note
<a rel="nofollow" href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Browser_compatibility">https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta#Browser_compatibility</a>
and updated
<a rel="nofollow" href="https://developer.mozilla.org/en-US/Firefox/Releases/38#HTML">https://developer.mozilla.org/en-US/Firefox/Releases/38#HTML</a></pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=dev-doc-needed&amp;resolution=---">dev-doc-needed</a> &rarr; <a href="/buglist.cgi?keywords=dev-doc-complete&amp;resolution=---">dev-doc-complete</a></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1113431&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>