<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1642283002: Deal with frame removal by content scripts -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '1605d08f757a7cca67f98a07b72e82db';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1642283002%252526ust%25253D1608720855425494%252526usg%25253DAFQjCNFk_p14rmPAJMyWW8H9I2NZak32nA%26service%3Dah">Sign out</a>

</div>
<div class="counter">(100)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1642283002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1642283002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1642283002</a>:
    Deal with frame removal by content scripts  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 10 months ago by <a href="/user/robwu" onMouseOver="M_showUserInfoPopup(this)">robwu</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 9 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <a href="/user/Ken%20Rockot(use%20gerrit%20already)" onMouseOver="M_showUserInfoPopup(this)">Ken Rockot(use gerrit already)</a>, <span class='approval'>*<a href="/user/Devlin" onMouseOver="M_showUserInfoPopup(this)">Devlin</a></span>, <span class='approval'><a href="/user/sky" onMouseOver="M_showUserInfoPopup(this)">sky</a></span>, <span class='approval'><a href="/user/esprehn" onMouseOver="M_showUserInfoPopup(this)">esprehn</a></span>, <span class='approval'>*<a href="/user/ncarter%20(slow)" onMouseOver="M_showUserInfoPopup(this)">ncarter (slow)</a></span>, <a href="/user/dcheng" onMouseOver="M_showUserInfoPopup(this)">dcheng</a>, <a href="/user/nasko" onMouseOver="M_showUserInfoPopup(this)">nasko</a>, <span class='approval'>*<a href="/user/kouhei%20(in%20TOK)" onMouseOver="M_showUserInfoPopup(this)">kouhei (in TOK)</a></span>
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
"document element created" and "document loaded" notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=582008">582008</a>
Committed: <a href="https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb">https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb</a>
Cr-Commit-Position: refs/heads/master@{#382162}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1642283002/#ps1"
       onclick="M_toggleSectionForPS('1642283002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1642283002/#ps20001"
       onclick="M_toggleSectionForPS('1642283002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Don&#39;t forget to check in test files...
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1642283002/#ps40001"
       onclick="M_toggleSectionForPS('1642283002', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Check for detaching in all Document types + tests
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1642283002/#ps60001"
       onclick="M_toggleSectionForPS('1642283002', '60001')"
       class="toggled-section ">
      Patch Set 4
      : ImageDocument: Account for detach in DOM mutations
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 4
      
    </div>
  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1642283002/#ps80001"
       onclick="M_toggleSectionForPS('1642283002', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Run scripts at microtask checkpoint
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1642283002/#ps100001"
       onclick="M_toggleSectionForPS('1642283002', '100001')"
       class="toggled-section ">
      Patch Set 6
      : Schedule microtask for document_end scripts
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 2
      
    </div>
  

  <div id="ps-100001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-120001-pointer"
       href="/1642283002/#ps120001"
       onclick="M_toggleSectionForPS('1642283002', '120001')"
       class="toggled-section ">
      Patch Set 7
      : rebase, discard all changes except for Blink and tests
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-120001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-140001-pointer"
       href="/1642283002/#ps140001"
       onclick="M_toggleSectionForPS('1642283002', '140001')"
       class="toggled-section ">
      Patch Set 8
      : Add AfterDidCreateDocumentElement/AfterDidFinishDocumentLoad
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 11
      
    </div>
  

  <div id="ps-140001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-160001-pointer"
       href="/1642283002/#ps160001"
       onclick="M_toggleSectionForPS('1642283002', '160001')"
       class="toggled-section ">
      Patch Set 9
      : Push down WeakPtr
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 13
      
    </div>
  

  <div id="ps-160001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-180001-pointer"
       href="/1642283002/#ps180001"
       onclick="M_toggleSectionForPS('1642283002', '180001')"
       class="toggled-section ">
      Patch Set 10
      : Up to #50: ExtensionFrameHelper callbacks, comments
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 13
      
    </div>
  

  <div id="ps-180001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-200001-pointer"
       href="/1642283002/#ps200001"
       onclick="M_toggleSectionForPS('1642283002', '200001')"
       class="toggled-section ">
      Patch Set 11
      : Use ScriptForbiddenScope in FrameLoader; Rename callbacks.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-200001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-220001-pointer"
       href="/1642283002/#ps220001"
       onclick="M_toggleSectionForPS('1642283002', '220001')"
       class="toggled-section ">
      Patch Set 12
      : rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-220001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-240001-pointer"
       href="/1642283002/#ps240001"
       onclick="M_toggleSectionForPS('1642283002', '240001')"
       class="toggled-section ">
      Patch Set 13
      : Add more runScriptsAtDocumentElementAvailable + comments
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 19
      
    </div>
  

  <div id="ps-240001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-260001-pointer"
       href="/1642283002/#ps260001"
       onclick="M_toggleSectionForPS('1642283002', '260001')"
       class="toggled-section ">
      Patch Set 14
      : Improve tests
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-260001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-280001-pointer"
       href="/1642283002/#ps280001"
       onclick="M_toggleSectionForPS('1642283002', '280001')"
       class="toggled-section ">
      Patch Set 15
      : rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-280001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-300001-pointer"
       href="/1642283002/#ps300001"
       onclick="M_toggleSectionForPS('1642283002', '300001')"
       class="toggled-section ">
      Patch Set 16
      : Use 1 test bucket, allow MojoBindingsController to run scripts
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 4
      
    </div>
  

  <div id="ps-300001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-320001-pointer"
       href="/1642283002/#ps320001"
       onclick="M_toggleSectionForPS('1642283002', '320001')"
       class="toggled-section opentriangle">
      Patch Set 17
      : Last nits
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-320001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 9 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1642283002_320001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1642283002/320001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+791 lines, -28 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330001">
            chrome/browser/extensions/execute_script_apitest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/browser/extensions/execute_script_apitest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 15">15</a>
        
          <a href="/1642283002/diff2/300001:320001/chrome/browser/extensions/execute_script_apitest.cc"
             title="Delta from patch set 16">16</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+78 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330001.diff"
             title="Download patch for chrome/browser/extensions/execute_script_apitest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330003">
            chrome/renderer/chrome_content_renderer_client.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/renderer/chrome_content_renderer_client.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/renderer/chrome_content_renderer_client.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330003.diff"
             title="Download patch for chrome/renderer/chrome_content_renderer_client.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330002">
            chrome/renderer/chrome_content_renderer_client.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/renderer/chrome_content_renderer_client.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/renderer/chrome_content_renderer_client.cc"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+18 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330002.diff"
             title="Download patch for chrome/renderer/chrome_content_renderer_client.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330005">
            chrome/renderer/extensions/chrome_extensions_renderer_client.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.h"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+3 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330005.diff"
             title="Download patch for chrome/renderer/extensions/chrome_extensions_renderer_client.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330004">
            chrome/renderer/extensions/chrome_extensions_renderer_client.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/renderer/extensions/chrome_extensions_renderer_client.cc"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+10 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330004.diff"
             title="Download patch for chrome/renderer/extensions/chrome_extensions_renderer_client.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330006">
            chrome/test/data/extensions/api_test/executescript/destructive/about_blank_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/about_blank_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/about_blank_frame.html"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330006.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/about_blank_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330007">
            chrome/test/data/extensions/api_test/executescript/destructive/audio.oga
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330007.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/audio.oga">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330008">
            chrome/test/data/extensions/api_test/executescript/destructive/audio.oga.mock-http-headers
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga.mock-http-headers">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga.mock-http-headers"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio.oga.mock-http-headers"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330008.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/audio.oga.mock-http-headers">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330009">
            chrome/test/data/extensions/api_test/executescript/destructive/audio_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/audio_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/audio_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330009.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/audio_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330010">
            chrome/test/data/extensions/api_test/executescript/destructive/empty.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/empty.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/empty.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/empty.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330010.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/empty.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330011">
            chrome/test/data/extensions/api_test/executescript/destructive/empty_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/empty_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/empty_frame.html"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330011.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/empty_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330012">
            chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js"
             title="Delta from patch set 13">13</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+7 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330012.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/flag_document_end.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330013">
            chrome/test/data/extensions/api_test/executescript/destructive/image.png
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/image.png">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/image.png"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/image.png"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap" colspan="2"><i>Binary file</i></td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330013.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/image.png">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330014">
            chrome/test/data/extensions/api_test/executescript/destructive/image_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/image_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/image_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/image_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330014.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/image_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330015">
            chrome/test/data/extensions/api_test/executescript/destructive/manifest.json
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/test/data/extensions/api_test/executescript/destructive/manifest.json"
             title="Delta from patch set 13">13</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+33 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330015.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/manifest.json">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330016">
            chrome/test/data/extensions/api_test/executescript/destructive/no_url_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/no_url_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/no_url_frame.html"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330016.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/no_url_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330017">
            chrome/test/data/extensions/api_test/executescript/destructive/plain.txt
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/plain.txt">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/plain.txt"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/plain.txt"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330017.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/plain.txt">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330018">
            chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330018.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330019">
            chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf.mock-http-headers
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf.mock-http-headers">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf.mock-http-headers"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf.mock-http-headers"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330019.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/plugin_file.pdf.mock-http-headers">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330020">
            chrome/test/data/extensions/api_test/executescript/destructive/plugin_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/plugin_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330020.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/plugin_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330021">
            chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 15">15</a>
        
          <a href="/1642283002/diff2/300001:320001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js"
             title="Delta from patch set 16">16</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+93 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330021.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330022">
            chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_html_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_html_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_html_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_html_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330022.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_html_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330023">
            chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_text_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_text_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_text_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_text_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330023.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/srcdoc_text_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330024">
            chrome/test/data/extensions/api_test/executescript/destructive/test.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/test.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330024.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/test.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330025">
            chrome/test/data/extensions/api_test/executescript/destructive/test.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 15">15</a>
        
          <a href="/1642283002/diff2/300001:320001/chrome/test/data/extensions/api_test/executescript/destructive/test.js"
             title="Delta from patch set 16">16</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+241 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330025.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/test.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330026">
            chrome/test/data/extensions/api_test/executescript/destructive/txt_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/txt_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/txt_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/txt_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330026.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/txt_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330027">
            chrome/test/data/extensions/api_test/executescript/destructive/video.ogv
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">0 chunks</td>
          <td style="white-space: nowrap">+-1 lines, --1 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330027.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/video.ogv">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330028">
            chrome/test/data/extensions/api_test/executescript/destructive/video.ogv.mock-http-headers
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv.mock-http-headers">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv.mock-http-headers"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/video.ogv.mock-http-headers"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330028.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/video.ogv.mock-http-headers">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330029">
            chrome/test/data/extensions/api_test/executescript/destructive/video_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/video_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/video_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/video_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330029.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/video_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330030">
            chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+9 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330030.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330031">
            chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml.mock-http-headers
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml.mock-http-headers">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml.mock-http-headers"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml.mock-http-headers"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330031.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/xhtml_document.xhtml.mock-http-headers">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330032">
            chrome/test/data/extensions/api_test/executescript/destructive/xhtml_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/xhtml_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330032.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/xhtml_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330033">
            chrome/test/data/extensions/api_test/executescript/destructive/xml_document.xml
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_document.xml">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_document.xml"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_document.xml"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330033.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/xml_document.xml">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330034">
            chrome/test/data/extensions/api_test/executescript/destructive/xml_frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/chrome/test/data/extensions/api_test/executescript/destructive/xml_frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330034.diff"
             title="Download patch for chrome/test/data/extensions/api_test/executescript/destructive/xml_frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330035">
            content/public/renderer/content_renderer_client.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/content/public/renderer/content_renderer_client.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/content/public/renderer/content_renderer_client.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+9 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330035.diff"
             title="Download patch for content/public/renderer/content_renderer_client.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330037">
            content/renderer/mojo_bindings_controller.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/content/renderer/mojo_bindings_controller.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/content/renderer/mojo_bindings_controller.h"
             title="Delta from patch set 15">15</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+2 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330037.diff"
             title="Download patch for content/renderer/mojo_bindings_controller.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330036">
            content/renderer/mojo_bindings_controller.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/content/renderer/mojo_bindings_controller.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/content/renderer/mojo_bindings_controller.cc"
             title="Delta from patch set 15">15</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+5 lines, -5 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330036.diff"
             title="Download patch for content/renderer/mojo_bindings_controller.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330039">
            content/renderer/render_frame_impl.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/content/renderer/render_frame_impl.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/content/renderer/render_frame_impl.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+3 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330039.diff"
             title="Download patch for content/renderer/render_frame_impl.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330038">
            content/renderer/render_frame_impl.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/content/renderer/render_frame_impl.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 14">14</a>
        
          <a href="/1642283002/diff2/280001:320001/content/renderer/render_frame_impl.cc"
             title="Delta from patch set 15">15</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+32 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330038.diff"
             title="Download patch for content/renderer/render_frame_impl.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330041">
            extensions/renderer/dispatcher.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/dispatcher.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/dispatcher.h"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+6 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330041.diff"
             title="Download patch for extensions/renderer/dispatcher.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330040">
            extensions/renderer/dispatcher.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/dispatcher.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/extensions/renderer/dispatcher.cc"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+18 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330040.diff"
             title="Download patch for extensions/renderer/dispatcher.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330043">
            extensions/renderer/extension_frame_helper.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/extension_frame_helper.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/extension_frame_helper.h"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+27 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330043.diff"
             title="Download patch for extensions/renderer/extension_frame_helper.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330042">
            extensions/renderer/extension_frame_helper.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/extension_frame_helper.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/extensions/renderer/extension_frame_helper.cc"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+41 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330042.diff"
             title="Download patch for extensions/renderer/extension_frame_helper.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330044">
            extensions/renderer/render_frame_observer_natives.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/render_frame_observer_natives.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/render_frame_observer_natives.cc"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -5 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330044.diff"
             title="Download patch for extensions/renderer/render_frame_observer_natives.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330045">
            extensions/renderer/script_injection_manager.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/renderer/script_injection_manager.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/renderer/script_injection_manager.cc"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+16 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330045.diff"
             title="Download patch for extensions/renderer/script_injection_manager.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330047">
            extensions/shell/renderer/shell_content_renderer_client.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/shell/renderer/shell_content_renderer_client.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/shell/renderer/shell_content_renderer_client.h"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330047.diff"
             title="Download patch for extensions/shell/renderer/shell_content_renderer_client.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330046">
            extensions/shell/renderer/shell_content_renderer_client.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/extensions/shell/renderer/shell_content_renderer_client.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/extensions/shell/renderer/shell_content_renderer_client.cc"
             title="Delta from patch set 10">10</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+10 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330046.diff"
             title="Download patch for extensions/shell/renderer/shell_content_renderer_client.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330048">
            third_party/WebKit/Source/core/html/ImageDocument.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/ImageDocument.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/html/ImageDocument.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">5 chunks</td>
          <td style="white-space: nowrap">+15 lines, -11 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330048.diff"
             title="Download patch for third_party/WebKit/Source/core/html/ImageDocument.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330049">
            third_party/WebKit/Source/core/html/MediaDocument.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/MediaDocument.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/MediaDocument.cpp"
             title="Delta from patch set 12">12</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330049.diff"
             title="Download patch for third_party/WebKit/Source/core/html/MediaDocument.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330050">
            third_party/WebKit/Source/core/html/PluginDocument.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/PluginDocument.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/html/PluginDocument.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+15 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330050.diff"
             title="Download patch for third_party/WebKit/Source/core/html/PluginDocument.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330051">
            third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp"
             title="Delta from patch set 12">12</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330051.diff"
             title="Download patch for third_party/WebKit/Source/core/html/parser/HTMLConstructionSite.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330052">
            third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+9 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330052.diff"
             title="Download patch for third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330053">
            third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp"
             title="Delta from patch set 12">12</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330053.diff"
             title="Download patch for third_party/WebKit/Source/core/html/parser/TextDocumentParser.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330054">
            third_party/WebKit/Source/core/loader/DocumentLoader.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/loader/DocumentLoader.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+3 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330054.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/DocumentLoader.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330055">
            third_party/WebKit/Source/core/loader/EmptyClients.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/loader/EmptyClients.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/loader/EmptyClients.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330055.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/EmptyClients.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330057">
            third_party/WebKit/Source/core/loader/FrameLoader.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/loader/FrameLoader.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/loader/FrameLoader.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330057.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/FrameLoader.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330056">
            third_party/WebKit/Source/core/loader/FrameLoader.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+14 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330056.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/FrameLoader.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330058">
            third_party/WebKit/Source/core/loader/FrameLoaderClient.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/loader/FrameLoaderClient.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330058.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/FrameLoaderClient.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330059">
            third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330059.diff"
             title="Download patch for third_party/WebKit/Source/core/xml/parser/XMLDocumentParser.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330061">
            third_party/WebKit/Source/web/FrameLoaderClientImpl.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330061.diff"
             title="Download patch for third_party/WebKit/Source/web/FrameLoaderClientImpl.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330060">
            third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+14 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330060.diff"
             title="Download patch for third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1642283002/patch/320001/330062">
            third_party/WebKit/public/web/WebFrameClient.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1642283002/diff/320001/third_party/WebKit/public/web/WebFrameClient.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1642283002/diff2/1:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1642283002/diff2/20001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1642283002/diff2/40001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1642283002/diff2/60001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1642283002/diff2/80001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1642283002/diff2/100001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1642283002/diff2/120001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1642283002/diff2/140001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1642283002/diff2/160001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 9">9</a>
        
          <a href="/1642283002/diff2/180001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 10">10</a>
        
          <a href="/1642283002/diff2/200001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 11">11</a>
        
          <a href="/1642283002/diff2/220001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 12">12</a>
        
          <a href="/1642283002/diff2/240001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 13">13</a>
        
          <a href="/1642283002/diff2/260001:320001/third_party/WebKit/public/web/WebFrameClient.h"
             title="Delta from patch set 14">14</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+10 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1642283002_320001_330062.diff"
             title="Download patch for third_party/WebKit/public/web/WebFrameClient.h">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 320001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 101 (16 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 101)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 101)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(101)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(101)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          rob@robwu.nl changed reviewers: + dcheng@chromium.org, nasko@chromium.org, rdevlin.cronin@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-08 12:27:29 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed reviewers:
+ <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a>, <a href="mailto:nasko@chromium.org">nasko@chromium.org</a>, <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          Devlin: extensions/renderer/script_injection_manager.cc nasko: content/renderer/render_frame_impl.cc Daniel: everything else (Blink, tests). I tracked down every call path ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-08 12:27:30 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >Devlin: extensions/renderer/script_injection_manager.cc

nasko: content/renderer/render_frame_impl.cc 

Daniel: everything else (Blink, tests). I tracked down every call path up to a
safe point from FrameLoader::dispatchDocumentElementAvailable, and added checks
where necessary.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          On 2016/02/08 12:27:30, robwu wrote: &gt; Devlin: extensions/renderer/script_injection_manager.cc &gt; &gt; nasko: content/renderer/render_frame_impl.cc &gt; &gt; Daniel: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-08 17:57:06 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >On 2016/02/08 12:27:30, robwu wrote:
&gt; Devlin: extensions/renderer/script_injection_manager.cc
&gt; 
&gt; nasko: content/renderer/render_frame_impl.cc 
&gt; 
&gt; Daniel: everything else (Blink, tests). I tracked down every call path up to a
&gt; safe point from FrameLoader::dispatchDocumentElementAvailable, and added
checks
&gt; where necessary.

I&#39;m gonna wait for Nasko&#39;s/Daniel&#39;s input before I do a really in depth review
(since most changes are in blink), but in principle looks okay.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Please add a bit more to the CL description. I had to read the code ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-08 18:12:53 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Please add a bit more to the CL description. I had to read the code to
understand what this CL is aiming to achieve. Ideally, the description should
deliver the message and the code should be inspected to verify the expected
change.

<a href="https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render_frame_impl.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render...</a>
File content/renderer/render_frame_impl.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render_frame_impl.cc#newcode3354" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render...</a>
content/renderer/render_frame_impl.cc:3354: if
(observers_.might_have_observers()) {
Yuck :(. Why is this the only method that needs this functionality? Shouldn&#39;t
most observer interfaces that notify extensions be fixed in the same way?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          esprehn@chromium.org changed reviewers: + esprehn@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 00:37:09 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            ><a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a> changed reviewers:
+ <a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Hmm, do we really need to tell extensions about the internal document types like ImageDocument? ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 00:37:09 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Hmm, do we really need to tell extensions about the internal document types like
ImageDocument? I guess there&#39;s some extensions that inject into the page loaded
when you load a .png directly?

<a href="https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp#newcode182" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp:182:
m_webFrame-&gt;client()-&gt;didCreateDocumentElement(m_webFrame);
Woah what, there&#39;s script down here??

Can we instead schedule a micro task and yield the parser instead? :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          On 2016/02/08 18:12:53, nasko wrote: &gt; Please add a bit more to the CL description. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 00:53:46 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >On 2016/02/08 18:12:53, nasko wrote:
&gt; Please add a bit more to the CL description.

All details are in the linked bug report.

I&#39;ll address your other comment tomorrow.

On 2016/02/09 00:37:09, esprehn wrote:
&gt; Hmm, do we really need to tell extensions about the internal document types
like
&gt; ImageDocument? I guess there&#39;s some extensions that inject into the page
loaded
&gt; when you load a .png directly?

Yes, it is needed. ImageDocument is just an implementation detail, web/extension
devs just see a HTML document with an image in it. I have an extension that
detects &lt;embed&gt; tags in (plugin) documents and then does something special with
it. And when I search for &quot;image&quot; in the Chrome Web Store, I see many results
that should work with ImageDocuments.

<a href="https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp#newcode182" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp:182:
m_webFrame-&gt;client()-&gt;didCreateDocumentElement(m_webFrame);
On 2016/02/09 00:37:09, esprehn wrote:
&gt; Woah what, there&#39;s script down here??
&gt; 
&gt; Can we instead schedule a micro task and yield the parser instead? :)

That could mean that a lot of DOM is generated, right? If so, then no.
The contract for when document_start scripts run is quite clear in this regard:
<a href="https://developer.chrome.com/extensions/content_scripts#run_at" rel="nofollow">https://developer.chrome.com/extensions/content_scripts#run_at</a>

On the other hand, if the microtask runs quite soon (like, right after the
document looks like &lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;), then I think that
breaking the contact is not going to be that bad for extension compatibility.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          I don&#39;t know how there would be a lot of DOM at the microtask if ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 01:11:16 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >I don&#39;t know how there would be a lot of DOM at the microtask if we yield the
parser, the only case is the image/plugin documents which sync build the DOM
inside them. For those we could call performMicrotaskCheckpoint() directly,
which is super explicit as a &quot;SCRIPT WILL RUN&quot; signal.

The RenderFrameImpl change is scary to me, what other hidden script runs down
there? Ideally we should be putting WebScriptForbiddenScope all over until we
understand exactly what happens in the system.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          On 2016/02/09 at 01:11:16, esprehn wrote: &gt; I don&#39;t know how there would be a ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 01:15:31 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >On 2016/02/09 at 01:11:16, esprehn wrote:
&gt; I don&#39;t know how there would be a lot of DOM at the microtask if we yield the
parser, the only case is the image/plugin documents which sync build the DOM
inside them. For those we could call performMicrotaskCheckpoint() directly,
which is super explicit as a &quot;SCRIPT WILL RUN&quot; signal.
&gt; 
&gt; The RenderFrameImpl change is scary to me, what other hidden script runs down
there? Ideally we should be putting WebScriptForbiddenScope all over until we
understand exactly what happens in the system.

Not directly related, but <a href="https://crbug.com/555773" rel="nofollow">https://crbug.com/555773</a> is where I started tracking
&#39;embedder runs way too much script in callbacks&#39; issues.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          On 2016/02/09 01:11:16, esprehn wrote: &gt; I don&#39;t know how there would be a lot ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 01:18:10 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >On 2016/02/09 01:11:16, esprehn wrote:
&gt; I don&#39;t know how there would be a lot of DOM at the microtask if we yield the
&gt; parser, the only case is the image/plugin documents which sync build the DOM
&gt; inside them. For those we could call performMicrotaskCheckpoint() directly,
&gt; which is super explicit as a &quot;SCRIPT WILL RUN&quot; signal.

This has potential. What about the most common case (HTML documents)? Do you
know whether the parser will yield soon enough?
(I can try your idea and see if things break, but if you know the answer already
;) )

&gt; The RenderFrameImpl change is scary to me, what other hidden script runs down
&gt; there? Ideally we should be putting WebScriptForbiddenScope all over until we
&gt; understand exactly what happens in the system.

... that would certainly break extensions. The analysis was easier than
expected, see my reply to Nasko.

<a href="https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render_frame_impl.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render...</a>
File content/renderer/render_frame_impl.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render_frame_impl.cc#newcode3354" rel="nofollow">https://codereview.chromium.org/1642283002/diff/60001/content/renderer/render...</a>
content/renderer/render_frame_impl.cc:3354: if
(observers_.might_have_observers()) {
On 2016/02/08 18:12:53, nasko wrote:
&gt; Yuck :(. Why is this the only method that needs this functionality? Shouldn&#39;t
&gt; most observer interfaces that notify extensions be fixed in the same way?

This is needed because the observers expect the subject (RenderFrame) to be
valid, so that e.g. RenderFrameObserver::render_frame() returns a valid pointer.
But because content script execute synchronously, this assumption does not hold,
so we have to tread carefully, and check whether the RenderFrame is still valid.

I checked every file in extensions/renderer that includes
render_frame_observer.h, and found a few occurrences:
- extensions_render_frame_observer.h - safe (no untrusted calls)
- extension_frame_helper.h - safe (no untrusted calls in observer notifications)
- render_frame_observer_natives.cc - DidFailProvisionalLoad should be addressed
(that is for another CL, because it is unrelated to this specific issue and I
found another bug - crbug.com/585268).
- script_injection_manager.cc - all fixed by this CL.
- app_window_custom_bindings.cc - fixed by this CL.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          On 2016/02/09 at 01:18:10, rob wrote: &gt; On 2016/02/09 01:11:16, esprehn wrote: &gt; &gt; I ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 01:21:17 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >On 2016/02/09 at 01:18:10, rob wrote:
&gt; On 2016/02/09 01:11:16, esprehn wrote:
&gt; &gt; I don&#39;t know how there would be a lot of DOM at the microtask if we yield
the
&gt; &gt; parser, the only case is the image/plugin documents which sync build the DOM
&gt; &gt; inside them. For those we could call performMicrotaskCheckpoint() directly,
&gt; &gt; which is super explicit as a &quot;SCRIPT WILL RUN&quot; signal.
&gt; 
&gt; This has potential. What about the most common case (HTML documents)? Do you
know whether the parser will yield soon enough?

I&#39;m saying we should _force_ the parser to yield. :)


&gt; [...] 
&gt; 
&gt; This is needed because the observers expect the subject (RenderFrame) to be
valid, so that e.g. RenderFrameObserver::render_frame() returns a valid pointer.
But because content script execute synchronously, this assumption does not hold,
so we have to tread carefully, and check whether the RenderFrame is still valid.

Yup, the question is why not everywhere else.

&gt; 
&gt; I checked every file in extensions/renderer that includes
render_frame_observer.h, and found a few occurrences:
&gt; - extensions_render_frame_observer.h - safe (no untrusted calls)
&gt; - extension_frame_helper.h - safe (no untrusted calls in observer
notifications)
&gt; - render_frame_observer_natives.cc - DidFailProvisionalLoad should be
addressed (that is for another CL, because it is unrelated to this specific
issue and I found another bug - crbug.com/585268).
&gt; - script_injection_manager.cc - all fixed by this CL.
&gt; - app_window_custom_bindings.cc - fixed by this CL.

You should land a WebScriptForbidenScope to anywhere you think is &quot;safe&quot; to
prevent any future script from being added. It&#39;s the only way to be sure.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          On 2016/02/09 at 01:21:17, esprehn wrote: &gt; On 2016/02/09 at 01:18:10, rob wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-09 01:24:42 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >On 2016/02/09 at 01:21:17, esprehn wrote:
&gt; On 2016/02/09 at 01:18:10, rob wrote:
&gt; &gt; On 2016/02/09 01:11:16, esprehn wrote:
&gt; &gt; &gt; I don&#39;t know how there would be a lot of DOM at the microtask if we yield
the
&gt; &gt; &gt; parser, the only case is the image/plugin documents which sync build the
DOM
&gt; &gt; &gt; inside them. For those we could call performMicrotaskCheckpoint()
directly,
&gt; &gt; &gt; which is super explicit as a &quot;SCRIPT WILL RUN&quot; signal.
&gt; &gt; 
&gt; &gt; This has potential. What about the most common case (HTML documents)? Do you
know whether the parser will yield soon enough?
&gt; 
&gt; I&#39;m saying we should _force_ the parser to yield. :)
&gt; 
&gt; 
&gt; &gt; [...] 
&gt; &gt; 
&gt; &gt; This is needed because the observers expect the subject (RenderFrame) to be
valid, so that e.g. RenderFrameObserver::render_frame() returns a valid pointer.
But because content script execute synchronously, this assumption does not hold,
so we have to tread carefully, and check whether the RenderFrame is still valid.
&gt; 
&gt; Yup, the question is why not everywhere else.

In general, we consider it an anti-pattern for observers to mutate the thing in
a way that will break other observers =)

We&#39;ve fixed some bugs in the past around things like the NTP synchronously
navigating in WebFrameClient callbacks, causing the
WebLocalFrame/RenderFrameImpl to be blown away before other observers run.

&gt; 
&gt; &gt; 
&gt; &gt; I checked every file in extensions/renderer that includes
render_frame_observer.h, and found a few occurrences:
&gt; &gt; - extensions_render_frame_observer.h - safe (no untrusted calls)
&gt; &gt; - extension_frame_helper.h - safe (no untrusted calls in observer
notifications)
&gt; &gt; - render_frame_observer_natives.cc - DidFailProvisionalLoad should be
addressed (that is for another CL, because it is unrelated to this specific
issue and I found another bug - crbug.com/585268).
&gt; &gt; - script_injection_manager.cc - all fixed by this CL.
&gt; &gt; - app_window_custom_bindings.cc - fixed by this CL.
&gt; 
&gt; You should land a WebScriptForbidenScope to anywhere you think is &quot;safe&quot; to
prevent any future script from being added. It&#39;s the only way to be sure.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          I have been experimenting with microtasks, and I see more disadvantages than advantages. Because the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 00:51:27 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >I have been experimenting with microtasks, and I see more disadvantages than
advantages.

Because the scripts have to be injected before the rest of the document is
parsed, there is no change from Blink&#39;s perspective.

The only benefit is that the RenderFrame observers are not invalidated while
notifying the observers.

The downsides are:
1. If the parser is activated while the microtask queue is being drained, then
the content script is NOT &quot;immediately&quot; injected (because nested microtasks are
not possible).
2. Forcing a microtask checkpoint might have side effects.
3. Bookkeeping of injection state in the script injection manager is more
complex.

Do you still want to go down the route of microtasks, or is the original method
(patch set 4) okay?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          esprehn@chromium.org changed reviewers: + kouhei@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:08:57 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            ><a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a> changed reviewers:
+ <a href="mailto:kouhei@chromium.org">kouhei@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          I have to think about this more, in the meantime you should get kouhei to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:08:57 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >I have to think about this more, in the meantime you should get kouhei to look
at the parser changes.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          On 2016/02/10 01:08:57, esprehn wrote: &gt; I have to think about this more, in the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:21:19 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >On 2016/02/10 01:08:57, esprehn wrote:
&gt; I have to think about this more, in the meantime you should get kouhei to look
&gt; at the parser changes.

Would you add me to the bug? It&#39;s hard to see why the change is made.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          kouhei@chromium.org changed reviewers: + haraken@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:38:01 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="mailto:kouhei@chromium.org">kouhei@chromium.org</a> changed reviewers:
+ <a href="mailto:haraken@chromium.org">haraken@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          I don&#39;t think adding Microtask::performCheckpoint is a right solution. +haraken: would you confirm? https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp File ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:38:02 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >I don&#39;t think adding Microtask::performCheckpoint is a right solution.
+haraken: would you confirm?

<a href="https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Sou...</a>
File third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp#newcode2296" rel="nofollow">https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp:2296: if
(m_parser-&gt;isStopped()) {
I don&#39;t understand the intention of the change here. Would you describe this in
detail?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          haraken@chromium.org changed reviewers: + yhirano@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:47:03 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            ><a href="mailto:haraken@chromium.org">haraken@chromium.org</a> changed reviewers:
+ <a href="mailto:yhirano@chromium.org">yhirano@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          +yhirano@ for Micotask::performCheckpoint
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:47:03 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >+yhirano@ for Micotask::performCheckpoint</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>yhirano</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          On 2016/02/10 01:47:03, haraken wrote: &gt; +yhirano@ for Micotask::performCheckpoint I cannot see the crbug issue: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 01:51:50 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >On 2016/02/10 01:47:03, haraken wrote:
&gt; +yhirano@ for Micotask::performCheckpoint

I cannot see the crbug issue: Can you cc me?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp File third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp (right): https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp#newcode2296 third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp:2296: if (m_parser-&gt;isStopped()) { On 2016/02/10 01:38:02, kouhei wrote: &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 10:19:52 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            ><a href="https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Sou...</a>
File third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp#newcode2296" rel="nofollow">https://codereview.chromium.org/1642283002/diff/100001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/parser/HTMLTreeBuilder.cpp:2296: if
(m_parser-&gt;isStopped()) {
On 2016/02/10 01:38:02, kouhei wrote:
&gt; I don&#39;t understand the intention of the change here. Would you describe this
in
&gt; detail?

When the HTML document consists of text only, e.g. as in &lt;iframe
srcdoc=&quot;text&quot;&gt;&lt;/iframe&gt;, then we fall through to to &quot;case InHeadMode&quot; below,
which calls m_tree.insertTextNode
(<a href="https://cs.chromium.org/HTMLConstructionSite%3A%3AinsertTextNode%20file%3Acpp" rel="nofollow">https://cs.chromium.org/HTMLConstructionSite%3A%3AinsertTextNode%20file%3Acpp</a>),
which populates m_pendingText. The destructor of HTMLConstructionSite asserts
whether m_pendingText is empty
(<a href="https://cs.chromium.org/HTMLConstructionSite%3A%3A~HTMLConstructionSite%20file%3Acpp" rel="nofollow">https://cs.chromium.org/HTMLConstructionSite%3A%3A~HTMLConstructionSite%20fil...</a>).
This assertion is triggered if we don&#39;t return early.

Now, before returning the buffer must also be drained, or an assertion would be
triggered in ~CharacterTokenBuffer:
<a href="https://cs.chromium.org/~CharacterTokenBuffer" rel="nofollow">https://cs.chromium.org/~CharacterTokenBuffer</a>

I found these assertions when I ran the unit tests that I introduced with this
CL.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>yhirano</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          Description was changed from ========== Deal with frame removal by content scripts BUG=582008 ========== to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 18:32:21 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >Description was changed from

==========
Deal with frame removal by content scripts

BUG=582008
==========

to

==========
Deal with frame removal by content scripts

BUG=582008
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>yhirano</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          I made the CL protected and removed auto-cc.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 18:50:42 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >I made the CL protected and removed auto-cc.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>yhirano</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          I agree with https://codereview.chromium.org/1642283002/#msg13 and https://codereview.chromium.org/1642283002/#msg18. If we don&#39;t want to execute scripts in RenderFrameObserver::DidCreateDocumentElement, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 19:53:46 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >I agree with <a href="https://codereview.chromium.org/1642283002/#msg13" rel="nofollow">https://codereview.chromium.org/1642283002/#msg13</a> and
<a href="https://codereview.chromium.org/1642283002/#msg18" rel="nofollow">https://codereview.chromium.org/1642283002/#msg18</a>. If we don&#39;t want to execute
scripts in RenderFrameObserver::DidCreateDocumentElement, adding an explicit
output task parameter so that the caller can execute that task after
RenderFrameObserver::DidCreateDocumentElement returns is more preferable than
relying on Microtask.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          On 2016/02/10 19:53:46, yhirano wrote: &gt; I agree with https://codereview.chromium.org/1642283002/#msg13 and &gt; https://codereview.chromium.org/1642283002/#msg18. If we ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 20:33:08 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >On 2016/02/10 19:53:46, yhirano wrote:
&gt; I agree with <a href="https://codereview.chromium.org/1642283002/#msg13" rel="nofollow">https://codereview.chromium.org/1642283002/#msg13</a> and
&gt; <a href="https://codereview.chromium.org/1642283002/#msg18" rel="nofollow">https://codereview.chromium.org/1642283002/#msg18</a>. If we don&#39;t want to execute
&gt; scripts in RenderFrameObserver::DidCreateDocumentElement, adding an explicit
&gt; output task parameter so that the caller can execute that task after
&gt; RenderFrameObserver::DidCreateDocumentElement returns is more preferable than
&gt; relying on Microtask.

I&#39;m in favor of not adding an extra out parameter, because not calling the
DidCreateDocumentElement / didFinishDocumentLoad notifications for frames that
are going to be deleted is not that harmful. And besides, frame deletion is
extremely rare.

Nasko, WDYT?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          On 2016/02/10 20:33:08, robwu wrote: &gt; On 2016/02/10 19:53:46, yhirano wrote: &gt; &gt; I agree ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 22:25:20 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >On 2016/02/10 20:33:08, robwu wrote:
&gt; On 2016/02/10 19:53:46, yhirano wrote:
&gt; &gt; I agree with <a href="https://codereview.chromium.org/1642283002/#msg13" rel="nofollow">https://codereview.chromium.org/1642283002/#msg13</a> and
&gt; &gt; <a href="https://codereview.chromium.org/1642283002/#msg18" rel="nofollow">https://codereview.chromium.org/1642283002/#msg18</a>. If we don&#39;t want to
execute
&gt; &gt; scripts in RenderFrameObserver::DidCreateDocumentElement, adding an explicit
&gt; &gt; output task parameter so that the caller can execute that task after
&gt; &gt; RenderFrameObserver::DidCreateDocumentElement returns is more preferable
than
&gt; &gt; relying on Microtask.
&gt; 
&gt; I&#39;m in favor of not adding an extra out parameter, because not calling the
&gt; DidCreateDocumentElement / didFinishDocumentLoad notifications for frames that
&gt; are going to be deleted is not that harmful. And besides, frame deletion is
&gt; extremely rare.
&gt; 
&gt; Nasko, WDYT?

Why do we care about the frequency of the event? I don&#39;t think it matters, as if
it can happen, it means code needs to handle it.

In general, observer APIs are not meant to change state RFH lifetime. Is it
possible to plumb this through a different interface, something like
ChromeRendererClient, then verify the frame exist before continuing? 
We have been trying to remove cases of frames being deleted during observer
notifications. Explicitly doing it is a backwards step IMHO.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          On 2016/02/10 22:25:20, nasko wrote: &gt; On 2016/02/10 20:33:08, robwu wrote: &gt; &gt; On 2016/02/10 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 22:38:58 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-27"
            >On 2016/02/10 22:25:20, nasko wrote:
&gt; On 2016/02/10 20:33:08, robwu wrote:
&gt; &gt; On 2016/02/10 19:53:46, yhirano wrote:
&gt; &gt; &gt; I agree with <a href="https://codereview.chromium.org/1642283002/#msg13" rel="nofollow">https://codereview.chromium.org/1642283002/#msg13</a> and
&gt; &gt; &gt; <a href="https://codereview.chromium.org/1642283002/#msg18" rel="nofollow">https://codereview.chromium.org/1642283002/#msg18</a>. If we don&#39;t want to
&gt; execute
&gt; &gt; &gt; scripts in RenderFrameObserver::DidCreateDocumentElement, adding an
explicit
&gt; &gt; &gt; output task parameter so that the caller can execute that task after
&gt; &gt; &gt; RenderFrameObserver::DidCreateDocumentElement returns is more preferable
&gt; than
&gt; &gt; &gt; relying on Microtask.
&gt; &gt; 
&gt; &gt; I&#39;m in favor of not adding an extra out parameter, because not calling the
&gt; &gt; DidCreateDocumentElement / didFinishDocumentLoad notifications for frames
that
&gt; &gt; are going to be deleted is not that harmful. And besides, frame deletion is
&gt; &gt; extremely rare.
&gt; &gt; 
&gt; &gt; Nasko, WDYT?
&gt; 
&gt; Why do we care about the frequency of the event? I don&#39;t think it matters, as
if
&gt; it can happen, it means code needs to handle it.
&gt; 
&gt; In general, observer APIs are not meant to change state RFH lifetime. Is it
&gt; possible to plumb this through a different interface, something like
&gt; ChromeRendererClient, then verify the frame exist before continuing? 
&gt; We have been trying to remove cases of frames being deleted during observer
&gt; notifications. Explicitly doing it is a backwards step IMHO.

So you prefer something like this?

std::vector&lt;base::Callback&lt;void(RenderFrame)&gt; &gt; tasks;
FOR_EACH_OBSERVER(RenderFrameObserver, observers_,
DidCreateDocumentElement(&amp;tasks));

if (!tasks.empty()) {
  base::WeakPtr&lt;RenderFrameImpl&gt; self = weak_factory_.GetWeakPtr();
  for (auto&amp; task : tasks) {
    task.Run(this);
    if (!self.get())
      return;
  }
}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          On 2016/02/10 22:38:58, robwu wrote: &gt; On 2016/02/10 22:25:20, nasko wrote: &gt; &gt; On 2016/02/10 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 22:50:57 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-28"
            >On 2016/02/10 22:38:58, robwu wrote:
&gt; On 2016/02/10 22:25:20, nasko wrote:
&gt; &gt; On 2016/02/10 20:33:08, robwu wrote:
&gt; &gt; &gt; On 2016/02/10 19:53:46, yhirano wrote:
&gt; &gt; &gt; &gt; I agree with <a href="https://codereview.chromium.org/1642283002/#msg13" rel="nofollow">https://codereview.chromium.org/1642283002/#msg13</a> and
&gt; &gt; &gt; &gt; <a href="https://codereview.chromium.org/1642283002/#msg18" rel="nofollow">https://codereview.chromium.org/1642283002/#msg18</a>. If we don&#39;t want to
&gt; &gt; execute
&gt; &gt; &gt; &gt; scripts in RenderFrameObserver::DidCreateDocumentElement, adding an
&gt; explicit
&gt; &gt; &gt; &gt; output task parameter so that the caller can execute that task after
&gt; &gt; &gt; &gt; RenderFrameObserver::DidCreateDocumentElement returns is more preferable
&gt; &gt; than
&gt; &gt; &gt; &gt; relying on Microtask.
&gt; &gt; &gt; 
&gt; &gt; &gt; I&#39;m in favor of not adding an extra out parameter, because not calling the
&gt; &gt; &gt; DidCreateDocumentElement / didFinishDocumentLoad notifications for frames
&gt; that
&gt; &gt; &gt; are going to be deleted is not that harmful. And besides, frame deletion
is
&gt; &gt; &gt; extremely rare.
&gt; &gt; &gt; 
&gt; &gt; &gt; Nasko, WDYT?
&gt; &gt; 
&gt; &gt; Why do we care about the frequency of the event? I don&#39;t think it matters,
as
&gt; if
&gt; &gt; it can happen, it means code needs to handle it.
&gt; &gt; 
&gt; &gt; In general, observer APIs are not meant to change state RFH lifetime. Is it
&gt; &gt; possible to plumb this through a different interface, something like
&gt; &gt; ChromeRendererClient, then verify the frame exist before continuing? 
&gt; &gt; We have been trying to remove cases of frames being deleted during observer
&gt; &gt; notifications. Explicitly doing it is a backwards step IMHO.
&gt; 
&gt; So you prefer something like this?
&gt; 
&gt; std::vector&lt;base::Callback&lt;void(RenderFrame)&gt; &gt; tasks;
&gt; FOR_EACH_OBSERVER(RenderFrameObserver, observers_,
&gt; DidCreateDocumentElement(&amp;tasks));
&gt; 
&gt; if (!tasks.empty()) {
&gt;   base::WeakPtr&lt;RenderFrameImpl&gt; self = weak_factory_.GetWeakPtr();
&gt;   for (auto&amp; task : tasks) {
&gt;     task.Run(this);
&gt;     if (!self.get())
&gt;       return;
&gt;   }
&gt; }

Hmm, no. Why do we need tasks here? What I had in mind is something like this:

... // existing observer loop can be before or after the following code ...

base::WeakPtr&lt;RenderFrameImpl&gt; self = weak_factory_.GetWeakPtr();
GetContentClient()-&gt;renderer()-&gt;CreatedDocument(frame_);
if (!self.get())
  return;

Then this CreateDocument API can be documented that it is allowed to delete the
RenderFrame. In the chrome/ layer, it can be directed over to the extensions
code, which will move whatever handling it has today from the observer method to
this one.

The ContentRendererClient is an interface that is used to alter behavior
already. It makes a lot more sense to go through it, even though at the end of
the day the exact same code will execute as part of the extensions/ handling of
the event.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-29">
                          I&#39;d prefer we didn&#39;t do that, I want this to be the only case we ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 23:06:11 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-29"
            >I&#39;d prefer we didn&#39;t do that, I want this to be the only case we ever do run
script. I&#39;d much prefer we do something like tasks and then add a
WebScriptForbiddenScope to the FOR_EACH_OBSERVER notification macro.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg31"
           name="30">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(30)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-30">
                          On 2016/02/10 23:06:11, esprehn wrote: &gt; I&#39;d prefer we didn&#39;t do that, I want this ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 23:25:38 UTC)
                <a href="#msg31">#31</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-30"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-30"
            >On 2016/02/10 23:06:11, esprehn wrote:
&gt; I&#39;d prefer we didn&#39;t do that, I want this to be the only case we ever do run
&gt; script. I&#39;d much prefer we do something like tasks and then add a
&gt; WebScriptForbiddenScope to the FOR_EACH_OBSERVER notification macro.

Why aren&#39;t the two approaches compatible? We can still add
WebScriptForbiddenScope around observer notifications, I&#39;m all for it. I&#39;m
basically saying that we formalize the only case where we run scripts into a
separate ContentRendererClient API. What&#39;s the part about tasks that I&#39;m missing
and cannot be done from the extensions/ code?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg32"
           name="31">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(31)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-31">
                          On 2016/02/10 at 23:25:38, nasko wrote: &gt; On 2016/02/10 23:06:11, esprehn wrote: &gt; &gt; I&#39;d ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-10 23:53:03 UTC)
                <a href="#msg32">#32</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-31"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-31"
            >On 2016/02/10 at 23:25:38, nasko wrote:
&gt; On 2016/02/10 23:06:11, esprehn wrote:
&gt; &gt; I&#39;d prefer we didn&#39;t do that, I want this to be the only case we ever do run
&gt; &gt; script. I&#39;d much prefer we do something like tasks and then add a
&gt; &gt; WebScriptForbiddenScope to the FOR_EACH_OBSERVER notification macro.
&gt; 
&gt; Why aren&#39;t the two approaches compatible? We can still add
WebScriptForbiddenScope around observer notifications, I&#39;m all for it. I&#39;m
basically saying that we formalize the only case where we run scripts into a
separate ContentRendererClient API. What&#39;s the part about tasks that I&#39;m missing
and cannot be done from the extensions/ code?

I&#39;m fine with that approach too. I&#39;m just saying I don&#39;t want anyone else inside
documentElementAvailable() to run script, this should be the only case, no new
instances should be added. :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg33"
           name="32">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(32)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-32">
                          On 2016/02/10 23:53:03, esprehn wrote: &gt; On 2016/02/10 at 23:25:38, nasko wrote: &gt; &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 00:08:28 UTC)
                <a href="#msg33">#33</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-32"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-32"
            >On 2016/02/10 23:53:03, esprehn wrote:
&gt; On 2016/02/10 at 23:25:38, nasko wrote:
&gt; &gt; On 2016/02/10 23:06:11, esprehn wrote:
&gt; &gt; &gt; I&#39;d prefer we didn&#39;t do that, I want this to be the only case we ever do
run
&gt; &gt; &gt; script. I&#39;d much prefer we do something like tasks and then add a
&gt; &gt; &gt; WebScriptForbiddenScope to the FOR_EACH_OBSERVER notification macro.
&gt; &gt; 
&gt; &gt; Why aren&#39;t the two approaches compatible? We can still add
&gt; WebScriptForbiddenScope around observer notifications, I&#39;m all for it. I&#39;m
&gt; basically saying that we formalize the only case where we run scripts into a
&gt; separate ContentRendererClient API. What&#39;s the part about tasks that I&#39;m
missing
&gt; and cannot be done from the extensions/ code?
&gt; 
&gt; I&#39;m fine with that approach too. I&#39;m just saying I don&#39;t want anyone else
inside
&gt; documentElementAvailable() to run script, this should be the only case, no new
&gt; instances should be added. :)

Great! I wasn&#39;t sure what part was concerning you when you said &quot;I&#39;d prefer we
didn&#39;t do that&quot;. It sounds like we are in agreement that we need to restrict
script running to only this case and try to prevent the rest.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg34"
           name="33">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(33)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-33">
                          I routed the script injection of all extension code via the ContentRendererClient (except for the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 12:40:24 UTC)
                <a href="#msg34">#34</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-33"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-33"
            >I routed the script injection of all extension code via the
ContentRendererClient (except for the RenderFrameObserver in
extensions/renderer/app_window_custom_bindings.cc because it appears to be dead
code).

And I didn&#39;t add WebForbiddenScope around the observers because it is not
required for this patch and there is a lot going on in DidFinishDocumentLoad.
E.g. MojoBindingsController::DidFinishDocumentLoad seems to run some JavaScript,
and adding a WebForbiddenScope around the observer without understanding all
leaves introduces the risk of breaking functionality (and might impede merging
this patch with M-49 / M-48).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg35"
           name="34">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(34)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>nasko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-34">
                          https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h File content/public/renderer/content_renderer_client.h (right): https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h#newcode311 content/public/renderer/content_renderer_client.h:311: virtual void AfterDidCreateDocumentElement( Why the &quot;After&quot; prefix? It is ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 16:49:01 UTC)
                <a href="#msg35">#35</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-34"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-34"
            ><a href="https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/public/rendere...</a>
File content/public/renderer/content_renderer_client.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h#newcode311" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/public/rendere...</a>
content/public/renderer/content_renderer_client.h:311: virtual void
AfterDidCreateDocumentElement(
Why the &quot;After&quot; prefix? It is called from DidCreateDocumentElement, right?

I also wonder if there is a way to avoid using a WeakPtr as an argument to this
method.

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
File content/renderer/render_frame_impl.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc#newcode3384" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
content/renderer/render_frame_impl.cc:3384: // Do not use |this| or |frame|!
ContentClient may might deleted them by now!
nit: &quot;may might deleted&quot; doesn&#39;t sound right. Maybe &quot;ContentClient may have
deleted this object.&quot;</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg36"
           name="35">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(35)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-35">
                          https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h File content/public/renderer/content_renderer_client.h (right): https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h#newcode311 content/public/renderer/content_renderer_client.h:311: virtual void AfterDidCreateDocumentElement( On 2016/02/11 16:49:01, nasko wrote: &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 17:51:09 UTC)
                <a href="#msg36">#36</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-35"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-35"
            ><a href="https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/public/rendere...</a>
File content/public/renderer/content_renderer_client.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/public/renderer/content_renderer_client.h#newcode311" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/public/rendere...</a>
content/public/renderer/content_renderer_client.h:311: virtual void
AfterDidCreateDocumentElement(
On 2016/02/11 16:49:01, nasko wrote:
&gt; Why the &quot;After&quot; prefix? It is called from DidCreateDocumentElement, right?

It is called after the DidCreateDocumentElement observers have been notified.

&gt; I also wonder if there is a way to avoid using a WeakPtr as an argument to
this
&gt; method.

It is possible, by inheriting from SupportsWeakPtr&lt;RenderFrame&gt; instead of
making the WeakPtrFactory a member of RenderFrame. Callees can then use
render_frame-&gt;AsWeakPtr().

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
File content/renderer/render_frame_impl.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc#newcode3384" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
content/renderer/render_frame_impl.cc:3384: // Do not use |this| or |frame|!
ContentClient may might deleted them by now!
On 2016/02/11 16:49:01, nasko wrote:
&gt; nit: &quot;may might deleted&quot; doesn&#39;t sound right. Maybe &quot;ContentClient may have
&gt; deleted this object.&quot;

Oops. I intended to write &quot;might have&quot;. I&#39;ll fix it with the next patchset.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg37"
           name="36">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(36)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-36">
                          nick@chromium.org changed reviewers: + nick@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 22:47:31 UTC)
                <a href="#msg37">#37</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-36"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-36"
            ><a href="mailto:nick@chromium.org">nick@chromium.org</a> changed reviewers:
+ <a href="mailto:nick@chromium.org">nick@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg38"
           name="37">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(37)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-37">
                          https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc File extensions/renderer/dispatcher.cc (right): https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507 extensions/renderer/dispatcher.cc:507: ExtensionFrameHelper::Get(render_frame.get()); Nasko pointed me at this CL to see ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 22:47:32 UTC)
                <a href="#msg38">#38</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-37"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-37"
            ><a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:507:
ExtensionFrameHelper::Get(render_frame.get());
Nasko pointed me at this CL to see if there might be an alternative to minting
the WeakPtr on the content side and passing it through here. 

One idea would be to add a WeakPtrFactory&lt;&gt; to the ExtensionFrameHelper (whose
lifetime, I think, is bound to the renderframe). This would let the whole
WeakPtr dance be contained entirely inside the //extensions layer.

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/extension_frame_helper.cc#newcode138" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:138: return;  // Frame invalidated
by callback.
That also means that |this| was deleted (right?).

I&#39;m not super familiar with this code, but as an aesthetic measure, it might be
worth considering moving this loop out into calling code (i.e. expose something
like a &quot;vector&lt;Callback&gt; GetAndClearDocumentElementCreatedCallbacks()&quot;).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg39"
           name="38">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(38)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-38">
                          https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc File content/renderer/render_frame_impl.cc (right): https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc#newcode3384 content/renderer/render_frame_impl.cc:3384: // Do not use |this| or |frame|! ContentClient may ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-11 23:36:51 UTC)
                <a href="#msg39">#39</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-38"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-38"
            ><a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
File content/renderer/render_frame_impl.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/content/renderer/render_frame_impl.cc#newcode3384" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/content/renderer/rende...</a>
content/renderer/render_frame_impl.cc:3384: // Do not use |this| or |frame|!
ContentClient may might deleted them by now!
On 2016/02/11 17:51:08, robwu wrote:
&gt; On 2016/02/11 16:49:01, nasko wrote:
&gt; &gt; nit: &quot;may might deleted&quot; doesn&#39;t sound right. Maybe &quot;ContentClient may have
&gt; &gt; deleted this object.&quot;
&gt; 
&gt; Oops. I intended to write &quot;might have&quot;. I&#39;ll fix it with the next patchset.

Done.

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:507:
ExtensionFrameHelper::Get(render_frame.get());
On 2016/02/11 22:47:32, ncarter wrote:
&gt; Nasko pointed me at this CL to see if there might be an alternative to minting
&gt; the WeakPtr on the content side and passing it through here. 
&gt; 
&gt; One idea would be to add a WeakPtrFactory&lt;&gt; to the ExtensionFrameHelper (whose
&gt; lifetime, I think, is bound to the renderframe). This would let the whole
&gt; WeakPtr dance be contained entirely inside the //extensions layer.

Done. I don&#39;t see any issue with passing a weakptr down from content/ (except
that the creation of the weak ptr is unnecessary if extensions are disabled),
but it&#39;s your call.

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/extension_frame_helper.cc#newcode138" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:138: return;  // Frame invalidated
by callback.
On 2016/02/11 22:47:32, ncarter wrote:
&gt; That also means that |this| was deleted (right?).

Yes.

&gt; I&#39;m not super familiar with this code, but as an aesthetic measure, it might
be
&gt; worth considering moving this loop out into calling code (i.e. expose
something
&gt; like a &quot;vector&lt;Callback&gt; GetAndClearDocumentElementCreatedCallbacks()&quot;).
&gt; 

I prefer to keep it in this class, since then all (frame-specific!) callback
registration and running logic is within this class.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg40"
           name="39">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(39)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-39">
                          lgtm https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc File extensions/renderer/dispatcher.cc (right): https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507 extensions/renderer/dispatcher.cc:507: ExtensionFrameHelper::Get(render_frame.get()); On 2016/02/11 23:36:50, robwu wrote: &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 19:32:57 UTC)
                <a href="#msg40">#40</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-39"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-39"
            >lgtm

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:507:
ExtensionFrameHelper::Get(render_frame.get());
On 2016/02/11 23:36:50, robwu wrote:
&gt; On 2016/02/11 22:47:32, ncarter wrote:
&gt; &gt; Nasko pointed me at this CL to see if there might be an alternative to
minting
&gt; &gt; the WeakPtr on the content side and passing it through here. 
&gt; &gt; 
&gt; &gt; One idea would be to add a WeakPtrFactory&lt;&gt; to the ExtensionFrameHelper
(whose
&gt; &gt; lifetime, I think, is bound to the renderframe). This would let the whole
&gt; &gt; WeakPtr dance be contained entirely inside the //extensions layer.
&gt; 
&gt; Done. I don&#39;t see any issue with passing a weakptr down from content/ (except
&gt; that the creation of the weak ptr is unnecessary if extensions are disabled),
&gt; but it&#39;s your call.

I&#39;m not opposed to it per se either, but I think it&#39;s cleaner if we handle the
deletion-detection at the same layer that the deletion-triggering happens.

My reasoning is that passing a weakptr as an in-param fairly uncommon idiom
outside of ctors and functions used as callbacks (where time might pass between
the bind and the invocation). Uncommon idioms result in code that&#39;s harder to
understand: in the case of the content client calls, when I first saw them, I
wondered &quot;Why would content need to pass a WeakPtr here? Is it possible the
frame has already been deleted? If so why would content be reporting an event on
the deleted frame?&quot;

If RenderFrameHost had already exposed a public GetWeakPtr&lt;&gt; method I would have
had no trouble with you using that. But it wasn&#39;t there already, and since there
is a way to get the behavior you need without adding a method to
RenderFrameHost, that&#39;s what I suggested.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg41"
           name="40">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(40)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-40">
                          rob@robwu.nl changed required reviewers: + kouhei@chromium.org, nick@chromium.org, rdevlin.cronin@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 19:51:42 UTC)
                <a href="#msg41">#41</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-40"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-40"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed required reviewers:
+ <a href="mailto:kouhei@chromium.org">kouhei@chromium.org</a>, <a href="mailto:nick@chromium.org">nick@chromium.org</a>, <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg42"
           name="41">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(41)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-41">
                          Devlin: Could you review extensions/? content/ has been approved, so I don&#39;t expect major changes ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 19:51:43 UTC)
                <a href="#msg42">#42</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-41"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-41"
            >Devlin: Could you review extensions/?
content/ has been approved, so I don&#39;t expect major changes in extensions code.

If you&#39;d like to, you can skip reviewing the tests until the Blink review by
kouhei is done, since the tests are designed to cover all relevant code paths
through Blink (which is still under review).

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/dispatcher.cc#newcode507" rel="nofollow">https://codereview.chromium.org/1642283002/diff/140001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:507:
ExtensionFrameHelper::Get(render_frame.get());
On 2016/02/12 19:32:57, ncarter wrote:
&gt; On 2016/02/11 23:36:50, robwu wrote:
&gt; &gt; On 2016/02/11 22:47:32, ncarter wrote:
&gt; &gt; &gt; Nasko pointed me at this CL to see if there might be an alternative to
&gt; minting
&gt; &gt; &gt; the WeakPtr on the content side and passing it through here. 
&gt; &gt; &gt; 
&gt; &gt; &gt; One idea would be to add a WeakPtrFactory&lt;&gt; to the ExtensionFrameHelper
&gt; (whose
&gt; &gt; &gt; lifetime, I think, is bound to the renderframe). This would let the whole
&gt; &gt; &gt; WeakPtr dance be contained entirely inside the //extensions layer.
&gt; &gt; 
&gt; &gt; Done. I don&#39;t see any issue with passing a weakptr down from content/
(except
&gt; &gt; that the creation of the weak ptr is unnecessary if extensions are
disabled),
&gt; &gt; but it&#39;s your call.
&gt; 
&gt; I&#39;m not opposed to it per se either, but I think it&#39;s cleaner if we handle the
&gt; deletion-detection at the same layer that the deletion-triggering happens.
&gt; 
&gt; My reasoning is that passing a weakptr as an in-param fairly uncommon idiom
&gt; outside of ctors and functions used as callbacks (where time might pass
between
&gt; the bind and the invocation). Uncommon idioms result in code that&#39;s harder to
&gt; understand: in the case of the content client calls, when I first saw them, I
&gt; wondered &quot;Why would content need to pass a WeakPtr here? Is it possible the
&gt; frame has already been deleted? If so why would content be reporting an event
on
&gt; the deleted frame?&quot;
&gt; 
&gt; If RenderFrameHost had already exposed a public GetWeakPtr&lt;&gt; method I would
have
&gt; had no trouble with you using that. But it wasn&#39;t there already, and since
there
&gt; is a way to get the behavior you need without adding a method to
&gt; RenderFrameHost, that&#39;s what I suggested.

That makes sense. Thanks for explaining your line of reasoning and review!</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg43"
           name="42">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(42)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-42">
                          haven&#39;t checked the tests yet. https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc File chrome/renderer/chrome_content_renderer_client.cc (right): https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393 chrome/renderer/chrome_content_renderer_client.cc:1393: -&gt;AfterDidCreateDocumentElement(render_frame); hmm... I&#39;d say ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 22:21:56 UTC)
                <a href="#msg43">#43</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-42"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-42"
            >haven&#39;t checked the tests yet.

<a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
File chrome/renderer/chrome_content_renderer_client.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
chrome/renderer/chrome_content_renderer_client.cc:1393:
-&gt;AfterDidCreateDocumentElement(render_frame);
hmm... I&#39;d say we should probably mention that |render_frame| can be invalid
after this point (I know it&#39;s mentioned elsewhere, but it&#39;s good to have it at
the main entry points).

Unfortunately, there&#39;s also not really a good way of *checking* if the render
frame is alive at this point - I suppose if we really need to, we could cache
the routing id, and then RenderFrame::FromRoutingID() if we need to (or expose
something from the extensions layer but...yuck).  I suppose I&#39;m fine with
crossing that bridge when we come to it, but it is kind of a shame.

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:512:
script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame);
Would it make sense to have the script injection manager register a callback
with the frame helper?  Then, there&#39;s one canonical way to do work here (and we
don&#39;t have *quite* as many lifetime checks)?

Also, would that allow us to contain ExtensionFrameHelper&#39;s weakness entirely
within itself?  (We generally prefer to just have an internal weak ptr over
SupportsWeakPtr - there are a few threads on chromium-dev that explain it pretty
well.)

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h#newcode111" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.h:111: // This method is not allowed to run
JavaScript code in the frame.
Can we DCHECK this (in general for DidCreateDocumentElement) somewhere in the
blink layer? Are we already?

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/script_injection_manager.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/sc...</a>
File extensions/renderer/script_injection_manager.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/script_injection_manager.cc#newcode254" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/sc...</a>
extensions/renderer/script_injection_manager.cc:254: void
ScriptInjectionManager::AfterDidCreateDocumentElement(
In general, it kind of makes me sad that we can&#39;t centralize the protection for
render frames a little bit more.  We have this class, ScriptInjection, and
ExtensionFrameHelper all kinda-sorta trying to figure it out.  Unfortunately, I
don&#39;t immediately have ideas of how to make it better, either.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg44"
           name="43">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(43)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-43">
                          https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc File chrome/renderer/chrome_content_renderer_client.cc (right): https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393 chrome/renderer/chrome_content_renderer_client.cc:1393: -&gt;AfterDidCreateDocumentElement(render_frame); On 2016/02/12 22:21:56, Devlin wrote: &gt; hmm... I&#39;d ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 22:37:13 UTC)
                <a href="#msg44">#44</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-43"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-43"
            ><a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
File chrome/renderer/chrome_content_renderer_client.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
chrome/renderer/chrome_content_renderer_client.cc:1393:
-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 22:21:56, Devlin wrote:
&gt; hmm... I&#39;d say we should probably mention that |render_frame| can be invalid
&gt; after this point (I know it&#39;s mentioned elsewhere, but it&#39;s good to have it at
&gt; the main entry points).

Will do.

&gt; Unfortunately, there&#39;s also not really a good way of *checking* if the render
&gt; frame is alive at this point

When it is really needed, we can pass a WeakPtr&lt;RenderFrame&gt; from content/. But
it&#39;s not needed at the moment.

&gt; I suppose if we really need to, we could cache
&gt; the routing id, and then RenderFrame::FromRoutingID() if we need to (or expose
&gt; something from the extensions layer but...yuck).  I suppose I&#39;m fine with
&gt; crossing that bridge when we come to it, but it is kind of a shame.

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:512:
script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 22:21:56, Devlin wrote:
&gt; Would it make sense to have the script injection manager register a callback
&gt; with the frame helper?

I avoided that, because ScriptInjectionManager needs to be notified of every
frame, so I optimized for minimal overhead.
The callbacks in ExtensionFrameHelper are only used to support
chrome.app.window.create, which rarely happens.

&gt; Then, there&#39;s one canonical way to do work here (and we
&gt; don&#39;t have *quite* as many lifetime checks)?
&gt; 
&gt; Also, would that allow us to contain ExtensionFrameHelper&#39;s weakness entirely
&gt; within itself?  (We generally prefer to just have an internal weak ptr over
&gt; SupportsWeakPtr - there are a few threads on chromium-dev that explain it
pretty
&gt; well.)

If we follow your suggestion, then yes. An alternative to what we currently
have,
ContentRendererClient -&gt; Dispatcher -&gt; ExtensionFrameHost
is
ContentRendererClient -&gt; ExtensionFrameHost -&gt; Dispatcher

but then the following pattern would be repeated 4x (for the two AfterDidXXX
notifications, for shell and chrome clients).

ExtensionFrameHelper* frame_helper = ExtensionFrameHelper::Get(render_frame);
if (frame_helper)
  frame_helper-&gt;AfterDidXXX(render_frame);
  // AfterDidXXX might have invalidated |render_frame| and |this|.

WDYT? Should we trade self-contained WeakPtrFactory for a bit of duplication?

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h#newcode111" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.h:111: // This method is not allowed to run
JavaScript code in the frame.
On 2016/02/12 22:21:56, Devlin wrote:
&gt; Can we DCHECK this (in general for DidCreateDocumentElement) somewhere in the
&gt; blink layer? Are we already?

Blink has ScriptForbiddenScope, but it&#39;s not public.
I am reluctant to add this restriction now, because of the risk of breaking
functionality in a merge. See <a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg45"
           name="44">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(44)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-44">
                          https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc File extensions/renderer/dispatcher.cc (right): https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512 extensions/renderer/dispatcher.cc:512: script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame); On 2016/02/12 22:37:13, robwu wrote: &gt; On 2016/02/12 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 22:51:01 UTC)
                <a href="#msg45">#45</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-44"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-44"
            ><a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:512:
script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 22:37:13, robwu wrote:
&gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; Would it make sense to have the script injection manager register a callback
&gt; &gt; with the frame helper?
&gt; 
&gt; I avoided that, because ScriptInjectionManager needs to be notified of every
&gt; frame, so I optimized for minimal overhead.
&gt; The callbacks in ExtensionFrameHelper are only used to support
&gt; chrome.app.window.create, which rarely happens.

What&#39;s the optimization there?  Just avoiding creating a callback and running
it?  If that&#39;s all, I&#39;d say let&#39;s do it anyway - base::Callback is designed to
be fast and lightweight.

&gt; &gt; Then, there&#39;s one canonical way to do work here (and we
&gt; &gt; don&#39;t have *quite* as many lifetime checks)?
&gt; &gt; 
&gt; &gt; Also, would that allow us to contain ExtensionFrameHelper&#39;s weakness
entirely
&gt; &gt; within itself?  (We generally prefer to just have an internal weak ptr over
&gt; &gt; SupportsWeakPtr - there are a few threads on chromium-dev that explain it
&gt; pretty
&gt; &gt; well.)
&gt; 
&gt; If we follow your suggestion, then yes. An alternative to what we currently
&gt; have,
&gt; ContentRendererClient -&gt; Dispatcher -&gt; ExtensionFrameHost
&gt; is
&gt; ContentRendererClient -&gt; ExtensionFrameHost -&gt; Dispatcher
&gt; 
&gt; but then the following pattern would be repeated 4x (for the two AfterDidXXX
&gt; notifications, for shell and chrome clients).
&gt; 
&gt; ExtensionFrameHelper* frame_helper = ExtensionFrameHelper::Get(render_frame);
&gt; if (frame_helper)
&gt;   frame_helper-&gt;AfterDidXXX(render_frame);
&gt;   // AfterDidXXX might have invalidated |render_frame| and |this|.
&gt; 
&gt; WDYT? Should we trade self-contained WeakPtrFactory for a bit of duplication?

Nah, going into dispatcher is good.  It&#39;s what everything else does.  I&#39;d prefer
to not expose too much more to the content client.

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h#newcode111" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.h:111: // This method is not allowed to run
JavaScript code in the frame.
On 2016/02/12 22:37:13, robwu wrote:
&gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; Can we DCHECK this (in general for DidCreateDocumentElement) somewhere in
the
&gt; &gt; blink layer? Are we already?
&gt; 
&gt; Blink has ScriptForbiddenScope, but it&#39;s not public.
&gt; I am reluctant to add this restriction now, because of the risk of breaking
&gt; functionality in a merge. See
<a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a>

SG.  Can we put an artfully placed TODO somewhere?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg46"
           name="45">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(45)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-45">
                          On 2016/02/12 at 22:37:13, rob wrote: &gt; ... &gt; &gt; Blink has ScriptForbiddenScope, but it&#39;s ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 22:52:42 UTC)
                <a href="#msg46">#46</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-45"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-45"
            >On 2016/02/12 at 22:37:13, rob wrote:
&gt; ...
&gt; 
&gt; Blink has ScriptForbiddenScope, but it&#39;s not public.
&gt; I am reluctant to add this restriction now, because of the risk of breaking
functionality in a merge. See <a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a>

It is public, there&#39;s WebScriptForbiddenScope. Please add a TODO to every render
frame observer macro usage with a link to a bug and a comment that it needs one
of those.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg47"
           name="46">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(46)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-46">
                          On 2016/02/12 at 22:52:42, esprehn wrote: &gt; On 2016/02/12 at 22:37:13, rob wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 22:58:00 UTC)
                <a href="#msg47">#47</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-46"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-46"
            >On 2016/02/12 at 22:52:42, esprehn wrote:
&gt; On 2016/02/12 at 22:37:13, rob wrote:
&gt; &gt; ...
&gt; &gt; 
&gt; &gt; Blink has ScriptForbiddenScope, but it&#39;s not public.
&gt; &gt; I am reluctant to add this restriction now, because of the risk of breaking
functionality in a merge. See <a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a>
&gt; 
&gt; It is public, there&#39;s WebScriptForbiddenScope. Please add a TODO to every
render frame observer macro usage with a link to a bug and a comment that it
needs one of those.

esprehn@, I think you&#39;re thinking of WebPluginScriptForbiddenScope, which is
slightly different =/</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg48"
           name="47">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(47)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-47">
                          On 2016/02/12 at 22:58:00, dcheng wrote: &gt; On 2016/02/12 at 22:52:42, esprehn wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 23:14:13 UTC)
                <a href="#msg48">#48</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-47"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-47"
            >On 2016/02/12 at 22:58:00, dcheng wrote:
&gt; On 2016/02/12 at 22:52:42, esprehn wrote:
&gt; &gt; On 2016/02/12 at 22:37:13, rob wrote:
&gt; &gt; &gt; ...
&gt; &gt; &gt; 
&gt; &gt; &gt; Blink has ScriptForbiddenScope, but it&#39;s not public.
&gt; &gt; &gt; I am reluctant to add this restriction now, because of the risk of
breaking functionality in a merge. See
<a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a>
&gt; &gt; 
&gt; &gt; It is public, there&#39;s WebScriptForbiddenScope. Please add a TODO to every
render frame observer macro usage with a link to a bug and a comment that it
needs one of those.
&gt; 
&gt; esprehn@, I think you&#39;re thinking of WebPluginScriptForbiddenScope, which is
slightly different =/

Woops, yeah but pretty easy to add this. :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg49"
           name="48">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(48)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-48">
                          https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc File extensions/renderer/dispatcher.cc (right): https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512 extensions/renderer/dispatcher.cc:512: script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame); On 2016/02/12 22:51:01, Devlin wrote: &gt; On 2016/02/12 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 23:24:49 UTC)
                <a href="#msg49">#49</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-48"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-48"
            ><a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:512:
script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 22:51:01, Devlin wrote:
&gt; On 2016/02/12 22:37:13, robwu wrote:
&gt; &gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; &gt; Would it make sense to have the script injection manager register a
callback
&gt; &gt; &gt; with the frame helper?
&gt; &gt; 
&gt; &gt; I avoided that, because ScriptInjectionManager needs to be notified of every
&gt; &gt; frame, so I optimized for minimal overhead.
&gt; &gt; The callbacks in ExtensionFrameHelper are only used to support
&gt; &gt; chrome.app.window.create, which rarely happens.
&gt; 
&gt; What&#39;s the optimization there?  Just avoiding creating a callback and running
&gt; it?  If that&#39;s all, I&#39;d say let&#39;s do it anyway - base::Callback is designed to
&gt; be fast and lightweight.

This happens (which seems not that expensive):
1. Map RenderFrame to ExtensionFrameHelper
2. Create callback
3. Insert the callback in a vector.
4. Later: Run callback.

But if I go down this route, then for consistency I&#39;d also have to change
DidFinishDocumentLoad to be callback-based. Otherwise there are two things to do
comparable things in the ScriptInjectionManager.

&gt; &gt; &gt; Then, there&#39;s one canonical way to do work here (and we
&gt; &gt; &gt; don&#39;t have *quite* as many lifetime checks)?
&gt; &gt; &gt; 
&gt; &gt; &gt; Also, would that allow us to contain ExtensionFrameHelper&#39;s weakness
&gt; entirely
&gt; &gt; &gt; within itself?  (We generally prefer to just have an internal weak ptr
over
&gt; &gt; &gt; SupportsWeakPtr - there are a few threads on chromium-dev that explain it
&gt; &gt; pretty
&gt; &gt; &gt; well.)
&gt; &gt; 
&gt; &gt; If we follow your suggestion, then yes. An alternative to what we currently
&gt; &gt; have,
&gt; &gt; ContentRendererClient -&gt; Dispatcher -&gt; ExtensionFrameHost
&gt; &gt; is
&gt; &gt; ContentRendererClient -&gt; ExtensionFrameHost -&gt; Dispatcher
&gt; &gt; 
&gt; &gt; but then the following pattern would be repeated 4x (for the two AfterDidXXX
&gt; &gt; notifications, for shell and chrome clients).
&gt; &gt; 
&gt; &gt; ExtensionFrameHelper* frame_helper =
ExtensionFrameHelper::Get(render_frame);
&gt; &gt; if (frame_helper)
&gt; &gt;   frame_helper-&gt;AfterDidXXX(render_frame);
&gt; &gt;   // AfterDidXXX might have invalidated |render_frame| and |this|.
&gt; &gt; 
&gt; &gt; WDYT? Should we trade self-contained WeakPtrFactory for a bit of
duplication?
&gt; 
&gt; Nah, going into dispatcher is good.  It&#39;s what everything else does.  I&#39;d
prefer
&gt; to not expose too much more to the content client.

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.h#newcode111" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.h:111: // This method is not allowed to run
JavaScript code in the frame.
On 2016/02/12 22:51:01, Devlin wrote:
&gt; On 2016/02/12 22:37:13, robwu wrote:
&gt; &gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; &gt; Can we DCHECK this (in general for DidCreateDocumentElement) somewhere in
&gt; the
&gt; &gt; &gt; blink layer? Are we already?
&gt; &gt; 
&gt; &gt; Blink has ScriptForbiddenScope, but it&#39;s not public.
&gt; &gt; I am reluctant to add this restriction now, because of the risk of breaking
&gt; &gt; functionality in a merge. See
&gt; <a href="https://codereview.chromium.org/1642283002/#msg34" rel="nofollow">https://codereview.chromium.org/1642283002/#msg34</a>
&gt; 
&gt; SG.  Can we put an artfully placed TODO somewhere?

I&#39;ll add a comment at the next update to the macros at content/.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg50"
           name="49">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(49)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-49">
                          https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc File extensions/renderer/dispatcher.cc (right): https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512 extensions/renderer/dispatcher.cc:512: script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame); On 2016/02/12 23:24:49, robwu wrote: &gt; On 2016/02/12 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-12 23:42:24 UTC)
                <a href="#msg50">#50</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-49"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-49"
            ><a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/dispatcher.cc#newcode512" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.cc:512:
script_injection_manager_-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 23:24:49, robwu wrote:
&gt; On 2016/02/12 22:51:01, Devlin wrote:
&gt; &gt; On 2016/02/12 22:37:13, robwu wrote:
&gt; &gt; &gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; &gt; &gt; Would it make sense to have the script injection manager register a
&gt; callback
&gt; &gt; &gt; &gt; with the frame helper?
&gt; &gt; &gt; 
&gt; &gt; &gt; I avoided that, because ScriptInjectionManager needs to be notified of
every
&gt; &gt; &gt; frame, so I optimized for minimal overhead.
&gt; &gt; &gt; The callbacks in ExtensionFrameHelper are only used to support
&gt; &gt; &gt; chrome.app.window.create, which rarely happens.
&gt; &gt; 
&gt; &gt; What&#39;s the optimization there?  Just avoiding creating a callback and
running
&gt; &gt; it?  If that&#39;s all, I&#39;d say let&#39;s do it anyway - base::Callback is designed
to
&gt; &gt; be fast and lightweight.
&gt; 
&gt; This happens (which seems not that expensive):
&gt; 1. Map RenderFrame to ExtensionFrameHelper
&gt; 2. Create callback
&gt; 3. Insert the callback in a vector.
&gt; 4. Later: Run callback.
&gt; 
&gt; But if I go down this route, then for consistency I&#39;d also have to change
&gt; DidFinishDocumentLoad to be callback-based. Otherwise there are two things to
do
&gt; comparable things in the ScriptInjectionManager.
&gt; 
&gt; &gt; &gt; &gt; Then, there&#39;s one canonical way to do work here (and we
&gt; &gt; &gt; &gt; don&#39;t have *quite* as many lifetime checks)?
&gt; &gt; &gt; &gt; 
&gt; &gt; &gt; &gt; Also, would that allow us to contain ExtensionFrameHelper&#39;s weakness
&gt; &gt; entirely
&gt; &gt; &gt; &gt; within itself?  (We generally prefer to just have an internal weak ptr
&gt; over
&gt; &gt; &gt; &gt; SupportsWeakPtr - there are a few threads on chromium-dev that explain
it
&gt; &gt; &gt; pretty
&gt; &gt; &gt; &gt; well.)
&gt; &gt; &gt; 
&gt; &gt; &gt; If we follow your suggestion, then yes. An alternative to what we
currently
&gt; &gt; &gt; have,
&gt; &gt; &gt; ContentRendererClient -&gt; Dispatcher -&gt; ExtensionFrameHost
&gt; &gt; &gt; is
&gt; &gt; &gt; ContentRendererClient -&gt; ExtensionFrameHost -&gt; Dispatcher
&gt; &gt; &gt; 
&gt; &gt; &gt; but then the following pattern would be repeated 4x (for the two
AfterDidXXX
&gt; &gt; &gt; notifications, for shell and chrome clients).
&gt; &gt; &gt; 
&gt; &gt; &gt; ExtensionFrameHelper* frame_helper =
&gt; ExtensionFrameHelper::Get(render_frame);
&gt; &gt; &gt; if (frame_helper)
&gt; &gt; &gt;   frame_helper-&gt;AfterDidXXX(render_frame);
&gt; &gt; &gt;   // AfterDidXXX might have invalidated |render_frame| and |this|.
&gt; &gt; &gt; 
&gt; &gt; &gt; WDYT? Should we trade self-contained WeakPtrFactory for a bit of
&gt; duplication?
&gt; &gt; 
&gt; &gt; Nah, going into dispatcher is good.  It&#39;s what everything else does.  I&#39;d
&gt; prefer
&gt; &gt; to not expose too much more to the content client.
&gt; 

That sounds reasonable to me.  If we&#39;re going to start using
ExtensionFrameHelper as an indication of frame liveness, let&#39;s commit to it! :)

(As a result, we *might* be able to clean up a few of the other places in
ScriptInjectionManager, but let&#39;s hold off on those changes.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg51"
           name="50">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(50)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-50">
                          I&#39;ve added some comments to content/ and addressed all review points in patchset 10.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-13 00:28:25 UTC)
                <a href="#msg51">#51</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-50"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-50"
            >I&#39;ve added some comments to content/ and addressed all review points in patchset
10.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg52"
           name="51">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(51)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-51">
                          https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc File chrome/renderer/chrome_content_renderer_client.cc (right): https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393 chrome/renderer/chrome_content_renderer_client.cc:1393: -&gt;AfterDidCreateDocumentElement(render_frame); On 2016/02/12 22:37:13, robwu wrote: &gt; On 2016/02/12 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-16 18:22:32 UTC)
                <a href="#msg52">#52</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-51"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-51"
            ><a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
File chrome/renderer/chrome_content_renderer_client.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome_content_renderer_client.cc#newcode1393" rel="nofollow">https://codereview.chromium.org/1642283002/diff/160001/chrome/renderer/chrome...</a>
chrome/renderer/chrome_content_renderer_client.cc:1393:
-&gt;AfterDidCreateDocumentElement(render_frame);
On 2016/02/12 22:37:13, robwu wrote:
&gt; On 2016/02/12 22:21:56, Devlin wrote:
&gt; &gt; hmm... I&#39;d say we should probably mention that |render_frame| can be invalid
&gt; &gt; after this point (I know it&#39;s mentioned elsewhere, but it&#39;s good to have it
at
&gt; &gt; the main entry points).
&gt; 
&gt; Will do.
&gt; 
&gt; &gt; Unfortunately, there&#39;s also not really a good way of *checking* if the
render
&gt; &gt; frame is alive at this point
&gt; 
&gt; When it is really needed, we can pass a WeakPtr&lt;RenderFrame&gt; from content/.
But
&gt; it&#39;s not needed at the moment.
&gt; 
&gt; &gt; I suppose if we really need to, we could cache
&gt; &gt; the routing id, and then RenderFrame::FromRoutingID() if we need to (or
expose
&gt; &gt; something from the extensions layer but...yuck).  I suppose I&#39;m fine with
&gt; &gt; crossing that bridge when we come to it, but it is kind of a shame.

If it comes to that, I&#39;d rather we just expose a GetWeakPtr on RenderFrame (as
devlin points out, it&#39;s a bit redundant to the routing pair lookup).

For now, documenting up the call stack that &quot;// |frame| may have been deleted.&quot;
(as you&#39;ve done) is probably a best practice.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg53"
           name="52">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(52)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-52">
                          Still waiting on the blink folks&#39; lg to look at the tests in depth, but ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-16 18:37:37 UTC)
                <a href="#msg53">#53</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-52"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-52"
            >Still waiting on the blink folks&#39; lg to look at the tests in depth, but this
generally lg2m.

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/dispatcher.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/di...</a>
File extensions/renderer/dispatcher.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/dispatcher.h#newcode113" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/di...</a>
extensions/renderer/dispatcher.h:113: // These methods may run (untrusted)
JavaScript code in the frame, and
nit: let&#39;s put a newline after line 112.

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
Can we add a pair of bools (did finish doc load, did create doc element) or an
enum to represent the state this frame is in so that we can DCHECK here that
people aren&#39;t adding callbacks that will never be called (or will be called on a
new load)?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg54"
           name="53">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(53)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-53">
                          You need a better change description, you need to explain what you&#39;re doing and why. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 01:43:47 UTC)
                <a href="#msg54">#54</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-53"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-53"
            >You need a better change description, you need to explain what you&#39;re doing and
why.

This also doesn&#39;t match what I wanted, I want to assert that
dispatchDocumentElementAvailable never runs script, you need totally separate
plumbing for extensions which is *specific* to extensions.

You need a new embedder callback like
NotifyExtensionScriptInsertedDocumentElement() and
NotifyExtensionScriptInsertedBody() or whatever might run script. All other
callbacks will be forbidden from running script.

<a href="https://codereview.chromium.org/1642283002/diff/180001/content/public/renderer/content_renderer_client.h" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/content/public/rendere...</a>
File content/public/renderer/content_renderer_client.h (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/content/public/renderer/content_renderer_client.h#newcode309" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/content/public/rendere...</a>
content/public/renderer/content_renderer_client.h:309: // invalidate the frame.
This should be specific to extensions, This should be
NotifyExtensionsAfterDidCreateDocumentElement.

<a href="https://codereview.chromium.org/1642283002/diff/180001/content/public/renderer/content_renderer_client.h#newcode314" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/content/public/rendere...</a>
content/public/renderer/content_renderer_client.h:314: virtual void
AfterDidFinishDocumentLoad(RenderFrame* render_frame) {}
ditto

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
File third_party/WebKit/Source/core/html/PluginDocument.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp#newcode102" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/PluginDocument.cpp:102: if (isStopped())
huh?

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp#newcode113" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/PluginDocument.cpp:113: if (isStopped())
how does inserting the body run script internally?

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp#newcode126" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/PluginDocument.cpp:126: if (isStopped())
huh? What happens inside focus?

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
File third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp#newcode181" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/web/FrameLoaderClientImpl.cpp:181:
RefPtrWillBeRawPtr&lt;WebLocalFrameImpl&gt; protector(m_webFrame.get());
protect(

not protector</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg55"
           name="54">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(54)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-54">
                          On 2016/02/17 01:43:47, esprehn wrote: &gt; You need a better change description, you need to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 23:49:05 UTC)
                <a href="#msg55">#55</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-54"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-54"
            >On 2016/02/17 01:43:47, esprehn wrote:
&gt; You need a better change description, you need to explain what you&#39;re doing
and
&gt; why.

The rationale is in the bug, I initially kept the description obscure because it
was public. Now the CL is private, I&#39;ll add some descriptive message (after
we&#39;ve finially decided on what approach to take. This has changed at least twice
already...).
 
&gt; This also doesn&#39;t match what I wanted, I want to assert that
&gt; dispatchDocumentElementAvailable never runs script, you need totally separate
&gt; plumbing for extensions which is *specific* to extensions.

I separated plumbing for extensions in content/. Regardless of whether the
notification is triggered from Blink or content/, Blink has to account for the
possibility that the document may be destroyed after the document element is
inserted.

&gt; You need a new embedder callback like
&gt; NotifyExtensionScriptInsertedDocumentElement() and
&gt; NotifyExtensionScriptInsertedBody() or whatever might run script. All other
&gt; callbacks will be forbidden from running script.

I tracked down all callees; besides extensions there is another part that could
synchronously run scripts: MojoBindingsController::DidFinishDocumentLoad (from a
cursory look, this seems like a safe &amp; static script). Do you want
ScriptForbiddenScope for document element insertion only, or for both
notifications? Extension-specific callback names only make sense in the former
case.

And in blink::FrameLoaderClientImpl::dispatchDidFinishDocumentLoad ,
RenderFrameImpl is not the only client, so I cannot put ScriptForbiddenScope
here, or SharedWorkers/ServiceWorkers may not function properly. So applying
ScriptForbiddenScope to the FinishDocumentLoad notification is currently not
even practical.

Regarding your other comments, once an untrusted script has been inserted, it
can use mutation events to observe element insertions/focus changes, and remove
the frame in these events.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg56"
           name="55">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(55)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-55">
                          On 2016/02/17 at 23:49:05, rob wrote: &gt; On 2016/02/17 01:43:47, esprehn wrote: &gt; &gt; You ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 00:10:55 UTC)
                <a href="#msg56">#56</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-55"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-55"
            >On 2016/02/17 at 23:49:05, rob wrote:
&gt; On 2016/02/17 01:43:47, esprehn wrote:
&gt; &gt; You need a better change description, you need to explain what you&#39;re doing
and
&gt; &gt; why.
&gt; 
&gt; The rationale is in the bug, I initially kept the description obscure because
it was public. Now the CL is private, I&#39;ll add some descriptive message (after
we&#39;ve finially decided on what approach to take. This has changed at least twice
already...).

I&#39;m not going to lgtm a patch without a good description, people forget all the
time. Please do write one now and change it as you go, your lack of description
is slowing down the codereview. I can&#39;t tell what you&#39;re trying to do.

Bugs are never substitutes for a change description. Please note that security
by obscurity in the change description is also something we don&#39;t do.

&gt;  
&gt; &gt; This also doesn&#39;t match what I wanted, I want to assert that
&gt; &gt; dispatchDocumentElementAvailable never runs script, you need totally
separate
&gt; &gt; plumbing for extensions which is *specific* to extensions.
&gt; 
&gt; I separated plumbing for extensions in content/. Regardless of whether the
notification is triggered from Blink or content/, Blink has to account for the
possibility that the document may be destroyed after the document element is
inserted.

It should be in blink, it needs to be super clear which callbacks in blink run
scripts, all others need to be locked down.

&gt; 
&gt; &gt; You need a new embedder callback like
&gt; &gt; NotifyExtensionScriptInsertedDocumentElement() and
&gt; &gt; NotifyExtensionScriptInsertedBody() or whatever might run script. All other
&gt; &gt; callbacks will be forbidden from running script.
&gt; 
&gt; I tracked down all callees; besides extensions there is another part that
could synchronously run scripts: MojoBindingsController::DidFinishDocumentLoad
(from a cursory look, this seems like a safe &amp; static script). Do you want
ScriptForbiddenScope for document element insertion only, or for both
notifications? Extension-specific callback names only make sense in the former
case.

Is that one author code? What uses Mojo JS bindings? If it&#39;s UA code it should
be marked with AllowUserAgentScript, if it&#39;s not, we need to audit what it&#39;s
doing with mojo in the main world context... 

In general I don&#39;t know what this mojo bindings code is doing, but it doesn&#39;t
seem right.

&gt; 
&gt; And in blink::FrameLoaderClientImpl::dispatchDidFinishDocumentLoad ,
RenderFrameImpl is not the only client, so I cannot put ScriptForbiddenScope
here, or SharedWorkers/ServiceWorkers may not function properly. 

Huh? SharedWorkers and ServiceWorkers don&#39;t have documents, why are they running
DidFinishDocumentLoad and running scripts?

&gt; So applying ScriptForbiddenScope to the FinishDocumentLoad notification is
currently not even practical.
&gt; 
&gt; Regarding your other comments, once an untrusted script has been inserted, it
can use mutation events to observe element insertions/focus changes, and remove
the frame in these events.

Huh? The parser doesn&#39;t fire mutation events, it does run script in a couple
cases though which is handled inside parserAppendChild and parserRemoveChild.
What case are you thinking of?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message   disapproval "
           
           id="msg57"
           name="56">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(56)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-56">
                          sigh, not lgtm, forgot I can&#39;t say it :)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 00:11:17 UTC)
                <a href="#msg57">#57</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-56"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-56"
            >sigh, not lgtm, forgot I can&#39;t say it :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg58"
           name="57">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(57)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-57">
                          Description was changed from ========== Deal with frame removal by content scripts BUG=582008 ========== to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 01:05:31 UTC)
                <a href="#msg58">#58</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-57"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-57"
            >Description was changed from

==========
Deal with frame removal by content scripts

BUG=582008
==========

to

==========
Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
&quot;document element created&quot; and &quot;document loaded&quot; notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=582008
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg59"
           name="58">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(58)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-58">
                          On 2016/02/18 00:10:55, esprehn wrote: &gt; On 2016/02/17 at 23:49:05, rob wrote: &gt; &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 01:20:36 UTC)
                <a href="#msg59">#59</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-58"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-58"
            >On 2016/02/18 00:10:55, esprehn wrote:
&gt; On 2016/02/17 at 23:49:05, rob wrote:
&gt; &gt; On 2016/02/17 01:43:47, esprehn wrote:
&gt; &gt; &gt; You need a better change description, you need to explain what you&#39;re
doing
&gt; and
&gt; &gt; &gt; why.
&gt; &gt; 
&gt; &gt; The rationale is in the bug, I initially kept the description obscure
because
&gt; it was public. Now the CL is private, I&#39;ll add some descriptive message (after
&gt; we&#39;ve finially decided on what approach to take. This has changed at least
twice
&gt; already...).
&gt; 
&gt; I&#39;m not going to lgtm a patch without a good description, people forget all
the
&gt; time. Please do write one now and change it as you go, your lack of
description
&gt; is slowing down the codereview. I can&#39;t tell what you&#39;re trying to do.
&gt; 
&gt; Bugs are never substitutes for a change description. Please note that security
&gt; by obscurity in the change description is also something we don&#39;t do.

Done.

&gt; &gt; &gt; This also doesn&#39;t match what I wanted, I want to assert that
&gt; &gt; &gt; dispatchDocumentElementAvailable never runs script, you need totally
&gt; separate
&gt; &gt; &gt; plumbing for extensions which is *specific* to extensions.
&gt; &gt; 
&gt; &gt; I separated plumbing for extensions in content/. Regardless of whether the
&gt; notification is triggered from Blink or content/, Blink has to account for the
&gt; possibility that the document may be destroyed after the document element is
&gt; inserted.
&gt; 
&gt; It should be in blink, it needs to be super clear which callbacks in blink run
&gt; scripts, all others need to be locked down.&gt; &gt; &gt; 
&gt; &gt; &gt; You need a new embedder callback like
&gt; &gt; &gt; NotifyExtensionScriptInsertedDocumentElement() and
&gt; &gt; &gt; NotifyExtensionScriptInsertedBody() or whatever might run script. All
other
&gt; &gt; &gt; callbacks will be forbidden from running script.
&gt; &gt; 
&gt; &gt; I tracked down all callees; besides extensions there is another part that
&gt; could synchronously run scripts: MojoBindingsController::DidFinishDocumentLoad
&gt; (from a cursory look, this seems like a safe &amp; static script). Do you want
&gt; ScriptForbiddenScope for document element insertion only, or for both
&gt; notifications? Extension-specific callback names only make sense in the former
&gt; case.
&gt; 
&gt; Is that one author code? What uses Mojo JS bindings? If it&#39;s UA code it should
&gt; be marked with AllowUserAgentScript, if it&#39;s not, we need to audit what it&#39;s
&gt; doing with mojo in the main world context... 

Idk, I&#39;ll study the code in more detail or ask the code owner to see what&#39;s
intended.

&gt; In general I don&#39;t know what this mojo bindings code is doing, but it doesn&#39;t
&gt; seem right.
&gt; 
&gt; &gt; 
&gt; &gt; And in blink::FrameLoaderClientImpl::dispatchDidFinishDocumentLoad ,
&gt; RenderFrameImpl is not the only client, so I cannot put ScriptForbiddenScope
&gt; here, or SharedWorkers/ServiceWorkers may not function properly. 
&gt; 
&gt; Huh? SharedWorkers and ServiceWorkers don&#39;t have documents, why are they
running
&gt; DidFinishDocumentLoad and running scripts?

Web workers are implemented as an invisible WebFrame, so it does share dome
logic with frames containing documents.
&gt; 
&gt; &gt; So applying ScriptForbiddenScope to the FinishDocumentLoad notification is
&gt; currently not even practical.
&gt; &gt; 
&gt; &gt; Regarding your other comments, once an untrusted script has been inserted,
it
&gt; can use mutation events to observe element insertions/focus changes, and
remove
&gt; the frame in these events.
&gt;
&gt; Huh? The parser doesn&#39;t fire mutation events, it does run script in a couple
&gt; cases though which is handled inside parserAppendChild and parserRemoveChild.
&gt; What case are you thinking of?

E.g. In PluginDocument, ContainerNode::appendChild fires mutation events at the
end. I also ran unit tests without my Blink patches and observed crashes in the
tests using mutation events.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg60"
           name="59">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(59)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-59">
                          On 2016/02/18 at 01:20:36, rob wrote: &gt; On 2016/02/18 00:10:55, esprehn wrote: &gt; &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 01:35:45 UTC)
                <a href="#msg60">#60</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-59"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-59"
            >On 2016/02/18 at 01:20:36, rob wrote:
&gt; On 2016/02/18 00:10:55, esprehn wrote:
&gt; &gt; On 2016/02/17 at 23:49:05, rob wrote:
&gt; &gt; &gt; On 2016/02/17 01:43:47, esprehn wrote:
&gt; &gt; &gt; &gt; You need a better change description, you need to explain what you&#39;re
doing
&gt; &gt; and
&gt; &gt; &gt; &gt; why.
&gt; &gt; &gt; 
&gt; &gt; &gt; The rationale is in the bug, I initially kept the description obscure
because
&gt; &gt; it was public. Now the CL is private, I&#39;ll add some descriptive message
(after
&gt; &gt; we&#39;ve finially decided on what approach to take. This has changed at least
twice
&gt; &gt; already...).
&gt; &gt; 
&gt; &gt; I&#39;m not going to lgtm a patch without a good description, people forget all
the
&gt; &gt; time. Please do write one now and change it as you go, your lack of
description
&gt; &gt; is slowing down the codereview. I can&#39;t tell what you&#39;re trying to do.
&gt; &gt; 
&gt; &gt; Bugs are never substitutes for a change description. Please note that
security
&gt; &gt; by obscurity in the change description is also something we don&#39;t do.
&gt; 
&gt; Done.
&gt; 
&gt; &gt; &gt; &gt; This also doesn&#39;t match what I wanted, I want to assert that
&gt; &gt; &gt; &gt; dispatchDocumentElementAvailable never runs script, you need totally
&gt; &gt; separate
&gt; &gt; &gt; &gt; plumbing for extensions which is *specific* to extensions.
&gt; &gt; &gt; 
&gt; &gt; &gt; I separated plumbing for extensions in content/. Regardless of whether the
&gt; &gt; notification is triggered from Blink or content/, Blink has to account for
the
&gt; &gt; possibility that the document may be destroyed after the document element is
&gt; &gt; inserted.
&gt; &gt; 
&gt; &gt; It should be in blink, it needs to be super clear which callbacks in blink
run
&gt; &gt; scripts, all others need to be locked down.&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; You need a new embedder callback like
&gt; &gt; &gt; &gt; NotifyExtensionScriptInsertedDocumentElement() and
&gt; &gt; &gt; &gt; NotifyExtensionScriptInsertedBody() or whatever might run script. All
other
&gt; &gt; &gt; &gt; callbacks will be forbidden from running script.
&gt; &gt; &gt; 
&gt; &gt; &gt; I tracked down all callees; besides extensions there is another part that
&gt; &gt; could synchronously run scripts:
MojoBindingsController::DidFinishDocumentLoad
&gt; &gt; (from a cursory look, this seems like a safe &amp; static script). Do you want
&gt; &gt; ScriptForbiddenScope for document element insertion only, or for both
&gt; &gt; notifications? Extension-specific callback names only make sense in the
former
&gt; &gt; case.
&gt; &gt; 
&gt; &gt; Is that one author code? What uses Mojo JS bindings? If it&#39;s UA code it
should
&gt; &gt; be marked with AllowUserAgentScript, if it&#39;s not, we need to audit what it&#39;s
&gt; &gt; doing with mojo in the main world context... 
&gt; 
&gt; Idk, I&#39;ll study the code in more detail or ask the code owner to see what&#39;s
intended.

I&#39;ll follow up on this (I&#39;m prepping an email to send to chromium-mojo@), there
are a lot of existing warts unfortunately.

&gt; 
&gt; &gt; In general I don&#39;t know what this mojo bindings code is doing, but it
doesn&#39;t
&gt; &gt; seem right.
&gt; &gt; 
&gt; &gt; &gt; 
&gt; &gt; &gt; And in blink::FrameLoaderClientImpl::dispatchDidFinishDocumentLoad ,
&gt; &gt; RenderFrameImpl is not the only client, so I cannot put ScriptForbiddenScope
&gt; &gt; here, or SharedWorkers/ServiceWorkers may not function properly. 
&gt; &gt; 
&gt; &gt; Huh? SharedWorkers and ServiceWorkers don&#39;t have documents, why are they
running
&gt; &gt; DidFinishDocumentLoad and running scripts?
&gt; 
&gt; Web workers are implemented as an invisible WebFrame, so it does share dome
logic with frames containing documents.

Yeah, also a known wart: <a href="https://crbug.com/538751" rel="nofollow">https://crbug.com/538751</a> 

&gt; &gt; 
&gt; &gt; &gt; So applying ScriptForbiddenScope to the FinishDocumentLoad notification is
&gt; &gt; currently not even practical.
&gt; &gt; &gt; 
&gt; &gt; &gt; Regarding your other comments, once an untrusted script has been inserted,
it
&gt; &gt; can use mutation events to observe element insertions/focus changes, and
remove
&gt; &gt; the frame in these events.
&gt; &gt;
&gt; &gt; Huh? The parser doesn&#39;t fire mutation events, it does run script in a couple
&gt; &gt; cases though which is handled inside parserAppendChild and
parserRemoveChild.
&gt; &gt; What case are you thinking of?
&gt; 
&gt; E.g. In PluginDocument, ContainerNode::appendChild fires mutation events at
the end. I also ran unit tests without my Blink patches and observed crashes in
the tests using mutation events.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg61"
           name="60">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(60)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-60">
                          This CL is blocked on replies from esprehn and dcheng. esprehn: In comment #55, I ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 22:55:22 UTC)
                <a href="#msg61">#61</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-60"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-60"
            >This CL is blocked on replies from esprehn and dcheng.

esprehn: In comment #55, I asked
&gt; Do you want ScriptForbiddenScope for document element insertion only,
&gt; or for both notifications? Extension-specific callback names only make
&gt; sense in the former case.

I think that the answer is &quot;No&quot;, because Web workers would otherwise break, but
please confirm.

dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously run a
callback that injects a script.
- Is it important to run the callback synchronously (i.e. is it not possible to
use a PostTask)?
- If yes, is the code safe for use with AllowUserAgentScript.
I can also move MojoBindingsController::DidFinishDocumentLoad to the new
AfterDidFinishDocumentLoad (name is subject to change) notification, which
allows scripts to run, and also takes into account that scripts may invalidate
the frame.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg62"
           name="61">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(61)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-61">
                          I&#39;m loooking at the code for DidFinishDocumentLoad for workers, it doesn&#39;t seem to run any ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:02:47 UTC)
                <a href="#msg62">#62</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-61"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-61"
            >I&#39;m loooking at the code for DidFinishDocumentLoad for workers, it doesn&#39;t seem
to run any script sync, what fails here?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg63"
           name="62">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(62)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-62">
                          On 2016/02/19 at 22:55:22, rob wrote: &gt; This CL is blocked on replies from esprehn ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:06:33 UTC)
                <a href="#msg63">#63</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-62"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-62"
            >On 2016/02/19 at 22:55:22, rob wrote:
&gt; This CL is blocked on replies from esprehn and dcheng.
&gt; 
&gt; esprehn: In comment #55, I asked
&gt; &gt; Do you want ScriptForbiddenScope for document element insertion only,
&gt; &gt; or for both notifications? Extension-specific callback names only make
&gt; &gt; sense in the former case.
&gt; 
&gt; I think that the answer is &quot;No&quot;, because Web workers would otherwise break,
but please confirm.
&gt; 
&gt; dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously run a
callback that injects a script.
&gt; - Is it important to run the callback synchronously (i.e. is it not possible
to use a PostTask)?
&gt; - If yes, is the code safe for use with AllowUserAgentScript.
&gt; I can also move MojoBindingsController::DidFinishDocumentLoad to the new
AfterDidFinishDocumentLoad (name is subject to change) notification, which
allows scripts to run, and also takes into account that scripts may invalidate
the frame.

Sorry, I started up writing this mail, but just fixing it for mojo bindings
controller won&#39;t fix all the other instances where this sort of thing breaks. So
I&#39;ve been looking at other violations of this sort, why they need to inject
script, and trying to write up something that covers why code does this today
(usually it&#39;s because it wants to inject script or make something available &#39;as
soon as possible&#39;) and try to explore better solutions for the future.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg64"
           name="63">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(63)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-63">
                          On 2016/02/19 23:02:47, esprehn wrote: &gt; I&#39;m loooking at the code for DidFinishDocumentLoad for workers, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:32:52 UTC)
                <a href="#msg64">#64</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-63"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-63"
            >On 2016/02/19 23:02:47, esprehn wrote:
&gt; I&#39;m loooking at the code for DidFinishDocumentLoad for workers, it doesn&#39;t
seem
&gt; to run any script sync, what fails here?

Thanks for the quick reply!
I took another look, and it seems that you&#39;re probably right (I looked at the
wrong overload).

I&#39;ll try to put a ScriptForbiddenScope around both notifications and cross my
fingers.
Do you insist on using an extension-specific notification name, or is a generic
AfterDidFinishDocumentLoad also fine (with potential non-extension use cases in
mind, e.g. MojoBindingsController)?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg65"
           name="64">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(64)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-64">
                          On 2016/02/19 23:06:33, dcheng wrote: &gt; &gt; dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously run a &gt; callback ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:41:00 UTC)
                <a href="#msg65">#65</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-64"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-64"
            >On 2016/02/19 23:06:33, dcheng wrote:
&gt; &gt; dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously run
a
&gt; callback that injects a script.
&gt; &gt; - Is it important to run the callback synchronously (i.e. is it not possible
&gt; to use a PostTask)?
&gt; &gt; - If yes, is the code safe for use with AllowUserAgentScript.
&gt; &gt; I can also move MojoBindingsController::DidFinishDocumentLoad to the new
&gt; AfterDidFinishDocumentLoad (name is subject to change) notification, which
&gt; allows scripts to run, and also takes into account that scripts may invalidate
&gt; the frame.
&gt; 
&gt; Sorry, I started up writing this mail, but just fixing it for mojo bindings
&gt; controller won&#39;t fix all the other instances where this sort of thing breaks.
So
&gt; I&#39;ve been looking at other violations of this sort, why they need to inject
&gt; script, and trying to write up something that covers why code does this today
&gt; (usually it&#39;s because it wants to inject script or make something available
&#39;as
&gt; soon as possible&#39;) and try to explore better solutions for the future.

When I looked at all derived classes of
RenderFrameObserver::DidFinishDocumentLoad, I didn&#39;t see any other non-extension
use except for MojoBindingsController. So implementing my last suggestion
doesn&#39;t seem like that difficult: I can simply do
RenderFrameObserverTracker&lt;MojoBindingsController&gt;::Get(frame)-&gt;TheLogicOfDidFinishDocumentLoad();
Is that OK, or am I missing something?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg66"
           name="65">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(65)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-65">
                          dcheng@chromium.org changed reviewers: + rockot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:54:24 UTC)
                <a href="#msg66">#66</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-65"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-65"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:rockot@chromium.org">rockot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg67"
           name="66">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(66)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-66">
                          On 2016/02/19 at 23:41:00, rob wrote: &gt; On 2016/02/19 23:06:33, dcheng wrote: &gt; &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 23:54:25 UTC)
                <a href="#msg67">#67</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-66"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-66"
            >On 2016/02/19 at 23:41:00, rob wrote:
&gt; On 2016/02/19 23:06:33, dcheng wrote:
&gt; &gt; &gt; dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously
run a
&gt; &gt; callback that injects a script.
&gt; &gt; &gt; - Is it important to run the callback synchronously (i.e. is it not
possible
&gt; &gt; to use a PostTask)?
&gt; &gt; &gt; - If yes, is the code safe for use with AllowUserAgentScript.
&gt; &gt; &gt; I can also move MojoBindingsController::DidFinishDocumentLoad to the new
&gt; &gt; AfterDidFinishDocumentLoad (name is subject to change) notification, which
&gt; &gt; allows scripts to run, and also takes into account that scripts may
invalidate
&gt; &gt; the frame.
&gt; &gt; 
&gt; &gt; Sorry, I started up writing this mail, but just fixing it for mojo bindings
&gt; &gt; controller won&#39;t fix all the other instances where this sort of thing
breaks. So
&gt; &gt; I&#39;ve been looking at other violations of this sort, why they need to inject
&gt; &gt; script, and trying to write up something that covers why code does this
today
&gt; &gt; (usually it&#39;s because it wants to inject script or make something available
&#39;as
&gt; &gt; soon as possible&#39;) and try to explore better solutions for the future.
&gt; 
&gt; When I looked at all derived classes of
RenderFrameObserver::DidFinishDocumentLoad, I didn&#39;t see any other non-extension
use except for MojoBindingsController. So implementing my last suggestion
doesn&#39;t seem like that difficult: I can simply do
RenderFrameObserverTracker&lt;MojoBindingsController&gt;::Get(frame)-&gt;TheLogicOfDidFinishDocumentLoad();
&gt; Is that OK, or am I missing something?

For DidFinishDocumentLoad(), I think that might be it, but we have similar
problems in many other callbacks. I guess if you only want to address this
particular issue, I believe the answer to both of your questions should be
yes... but rockot@ should confirm.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg68"
           name="67">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(67)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Ken Rockot(use gerrit already)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-67">
                          On 2016/02/19 at 23:54:25, dcheng wrote: &gt; On 2016/02/19 at 23:41:00, rob wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-21 16:03:48 UTC)
                <a href="#msg68">#68</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-67"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-67"
            >On 2016/02/19 at 23:54:25, dcheng wrote:
&gt; On 2016/02/19 at 23:41:00, rob wrote:
&gt; &gt; On 2016/02/19 23:06:33, dcheng wrote:
&gt; &gt; &gt; &gt; dcheng: MojoBindingsController::DidFinishDocumentLoad may synchronously
run a
&gt; &gt; &gt; callback that injects a script.
&gt; &gt; &gt; &gt; - Is it important to run the callback synchronously (i.e. is it not
possible
&gt; &gt; &gt; to use a PostTask)?
&gt; &gt; &gt; &gt; - If yes, is the code safe for use with AllowUserAgentScript.
&gt; &gt; &gt; &gt; I can also move MojoBindingsController::DidFinishDocumentLoad to the new
&gt; &gt; &gt; AfterDidFinishDocumentLoad (name is subject to change) notification, which
&gt; &gt; &gt; allows scripts to run, and also takes into account that scripts may
invalidate
&gt; &gt; &gt; the frame.
&gt; &gt; &gt; 
&gt; &gt; &gt; Sorry, I started up writing this mail, but just fixing it for mojo
bindings
&gt; &gt; &gt; controller won&#39;t fix all the other instances where this sort of thing
breaks. So
&gt; &gt; &gt; I&#39;ve been looking at other violations of this sort, why they need to
inject
&gt; &gt; &gt; script, and trying to write up something that covers why code does this
today
&gt; &gt; &gt; (usually it&#39;s because it wants to inject script or make something
available &#39;as
&gt; &gt; &gt; soon as possible&#39;) and try to explore better solutions for the future.
&gt; &gt; 
&gt; &gt; When I looked at all derived classes of
RenderFrameObserver::DidFinishDocumentLoad, I didn&#39;t see any other non-extension
use except for MojoBindingsController. So implementing my last suggestion
doesn&#39;t seem like that difficult: I can simply do
RenderFrameObserverTracker&lt;MojoBindingsController&gt;::Get(frame)-&gt;TheLogicOfDidFinishDocumentLoad();
&gt; &gt; Is that OK, or am I missing something?
&gt; 
&gt; For DidFinishDocumentLoad(), I think that might be it, but we have similar
problems in many other callbacks. I guess if you only want to address this
particular issue, I believe the answer to both of your questions should be
yes... but rockot@ should confirm.

There&#39;s nothing wrong with moving this logic around as suggested</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg69"
           name="68">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(68)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-68">
                          Thanks for your confirmation rockot@. esprehn: I&#39;ve added ScriptForbiddenScope in FrameLoader (2x) and new Blink ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-22 00:15:02 UTC)
                <a href="#msg69">#69</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-68"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-68"
            >Thanks for your confirmation rockot@.

esprehn: I&#39;ve added ScriptForbiddenScope in FrameLoader (2x) and new Blink
callbacks (runScriptsAtDocumentElementAvailable / runScriptsAtDocumentReady)
that can run scripts. Could you take a look?

content/ and extensions/ were also changed, because I renamed AfterDidXX to
RunScriptsAtDocumentStart/End (because the notification uses a completely
different Blink notification, I didn&#39;t want to couple the naming with the
existing notification, and I also wanted to emphasize that the callback is
intended for logic that runs scripts).

I briefly made this bug public to run the try bots. Some bots are red, but
that&#39;s because I marked the CL private again too soon. Then I made the CL public
until the bot_update steps completed before making the bug private again. All
remaining bots became green, which means that the latest change (introducing
ScriptForbiddenScope) did not knowingly break any functionality
(win_chromium_rel_ng and linux_chromium_rel_ng both cover extension tests and
Blink, so that alone would be sufficient).

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
On 2016/02/16 18:37:37, Devlin wrote:
&gt; Can we add a pair of bools (did finish doc load, did create doc element) or an
&gt; enum to represent the state this frame is in so that we can DCHECK here that
&gt; people aren&#39;t adding callbacks that will never be called

No. The re-entrancy via JavaScript and Blink makes it not possible to assert
things like DCHECK(!did_create_current_document_element_). It might be possible
for the load event, but that is not guaranteed by any contract in Blink.

Because running the scripts now happens in a separate notification, we could
change the implementation to only run the script once per document, but that is
not required for fixing this bug (and a huge undertaking in itself), so I&#39;m not
going to block this CL on that.

&gt; (or will be called on a new load)?

Until there exist a &quot;frame is unloaded&quot; notification from Blink, I cannot really
determine whether this holds. ScriptInjectionManager::RFOHelper attempts to
answer this, but that is in very specific to content scripts and not suitable
for general use.

ScheduleRunAtDocumentStart should be called in a DidCreateDocumentElement
notification (this is clearly documented in the header), and I think that it&#39;s
sufficient for now.

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
File third_party/WebKit/Source/core/html/PluginDocument.cpp (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Source/core/html/PluginDocument.cpp#newcode126" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/third_party/WebKit/Sou...</a>
third_party/WebKit/Source/core/html/PluginDocument.cpp:126: if (isStopped())
On 2016/02/17 01:43:47, esprehn wrote:
&gt; huh? What happens inside focus?

It synchronously dispatches the focus event. A potentially untrusted focus
listener could detach the frame in the focus handler.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg70"
           name="69">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(69)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-69">
                          https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc File extensions/renderer/extension_frame_helper.cc (right): https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158 extensions/renderer/extension_frame_helper.cc:158: document_element_created_callbacks_.push_back(callback); On 2016/02/22 at 00:15:02, robwu wrote: &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-22 00:28:34 UTC)
                <a href="#msg70">#70</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-69"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-69"
            ><a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
On 2016/02/22 at 00:15:02, robwu wrote:
&gt; On 2016/02/16 18:37:37, Devlin wrote:
&gt; &gt; Can we add a pair of bools (did finish doc load, did create doc element) or
an
&gt; &gt; enum to represent the state this frame is in so that we can DCHECK here that
&gt; &gt; people aren&#39;t adding callbacks that will never be called
&gt; 
&gt; No. The re-entrancy via JavaScript and Blink makes it not possible to assert
things like DCHECK(!did_create_current_document_element_). It might be possible
for the load event, but that is not guaranteed by any contract in Blink.
&gt; 
&gt; Because running the scripts now happens in a separate notification, we could
change the implementation to only run the script once per document, but that is
not required for fixing this bug (and a huge undertaking in itself), so I&#39;m not
going to block this CL on that.
&gt; 
&gt; &gt; (or will be called on a new load)?
&gt; 
&gt; Until there exist a &quot;frame is unloaded&quot; notification from Blink, I cannot
really determine whether this holds. ScriptInjectionManager::RFOHelper attempts
to answer this, but that is in very specific to content scripts and not suitable
for general use.

FWIW this already exists in the form of WebFrameClient::frame detached

&gt; 
&gt; ScheduleRunAtDocumentStart should be called in a DidCreateDocumentElement
notification (this is clearly documented in the header), and I think that it&#39;s
sufficient for now.

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
On 2016/02/22 at 00:15:02, robwu wrote:
&gt; On 2016/02/16 18:37:37, Devlin wrote:
&gt; &gt; Can we add a pair of bools (did finish doc load, did create doc element) or
an
&gt; &gt; enum to represent the state this frame is in so that we can DCHECK here that
&gt; &gt; people aren&#39;t adding callbacks that will never be called
&gt; 
&gt; No. The re-entrancy via JavaScript and Blink makes it not possible to assert
things like DCHECK(!did_create_current_document_element_). It might be possible
for the load event, but that is not guaranteed by any contract in Blink.
&gt; 
&gt; Because running the scripts now happens in a separate notification, we could
change the implementation to only run the script once per document, but that is
not required for fixing this bug (and a huge undertaking in itself), so I&#39;m not
going to block this CL on that.
&gt; 
&gt; &gt; (or will be called on a new load)?
&gt; 
&gt; Until there exist a &quot;frame is unloaded&quot; notification from Blink, I cannot
really determine whether this holds. ScriptInjectionManager::RFOHelper attempts
to answer this, but that is in very specific to content scripts and not suitable
for general use.

FWIW this already exists in the form of WebFrameClient::frameDetached

&gt; 
&gt; ScheduleRunAtDocumentStart should be called in a DidCreateDocumentElement
notification (this is clearly documented in the header), and I think that it&#39;s
sufficient for now.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg71"
           name="70">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(70)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-70">
                          https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc File extensions/renderer/extension_frame_helper.cc (right): https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158 extensions/renderer/extension_frame_helper.cc:158: document_element_created_callbacks_.push_back(callback); On 2016/02/22 00:28:34, dcheng wrote: &gt; On 2016/02/22 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-22 00:52:31 UTC)
                <a href="#msg71">#71</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-70"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-70"
            ><a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
File extensions/renderer/extension_frame_helper.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
On 2016/02/22 00:28:34, dcheng wrote:
&gt; On 2016/02/22 at 00:15:02, robwu wrote:
&gt; &gt; On 2016/02/16 18:37:37, Devlin wrote:
&gt; &gt; &gt; Can we add a pair of bools (did finish doc load, did create doc element)
or
&gt; an
&gt; &gt; &gt; enum to represent the state this frame is in so that we can DCHECK here
that
&gt; &gt; &gt; people aren&#39;t adding callbacks that will never be called
&gt; &gt; 
&gt; &gt; No. The re-entrancy via JavaScript and Blink makes it not possible to assert
&gt; things like DCHECK(!did_create_current_document_element_). It might be
possible
&gt; for the load event, but that is not guaranteed by any contract in Blink.
&gt; &gt; 
&gt; &gt; Because running the scripts now happens in a separate notification, we could
&gt; change the implementation to only run the script once per document, but that
is
&gt; not required for fixing this bug (and a huge undertaking in itself), so I&#39;m
not
&gt; going to block this CL on that.
&gt; &gt; 
&gt; &gt; &gt; (or will be called on a new load)?
&gt; &gt; 
&gt; &gt; Until there exist a &quot;frame is unloaded&quot; notification from Blink, I cannot
&gt; really determine whether this holds. ScriptInjectionManager::RFOHelper
attempts
&gt; to answer this, but that is in very specific to content scripts and not
suitable
&gt; for general use.
&gt; 
&gt; FWIW this already exists in the form of WebFrameClient::frameDetached

Is that also called upon navigation? I thought that it&#39;s only for frame removal
and process swaps. By &quot;frame unload&quot;, I&#39;m referring to the event where the
document and script context of a frame become invalid.

&gt; &gt; 
&gt; &gt; ScheduleRunAtDocumentStart should be called in a DidCreateDocumentElement
&gt; notification (this is clearly documented in the header), and I think that it&#39;s
&gt; sufficient for now.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg72"
           name="71">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(71)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-71">
                          On 2016/02/22 at 00:52:31, rob wrote: &gt; https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc &gt; File extensions/renderer/extension_frame_helper.cc (right): &gt; &gt; https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-22 17:51:32 UTC)
                <a href="#msg72">#72</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-71"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-71"
            >On 2016/02/22 at 00:52:31, rob wrote:
&gt;
<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
&gt; File extensions/renderer/extension_frame_helper.cc (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/extension_frame_helper.cc#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/180001/extensions/renderer/ex...</a>
&gt; extensions/renderer/extension_frame_helper.cc:158:
document_element_created_callbacks_.push_back(callback);
&gt; On 2016/02/22 00:28:34, dcheng wrote:
&gt; &gt; On 2016/02/22 at 00:15:02, robwu wrote:
&gt; &gt; &gt; On 2016/02/16 18:37:37, Devlin wrote:
&gt; &gt; &gt; &gt; Can we add a pair of bools (did finish doc load, did create doc element)
or
&gt; &gt; an
&gt; &gt; &gt; &gt; enum to represent the state this frame is in so that we can DCHECK here
that
&gt; &gt; &gt; &gt; people aren&#39;t adding callbacks that will never be called
&gt; &gt; &gt; 
&gt; &gt; &gt; No. The re-entrancy via JavaScript and Blink makes it not possible to
assert
&gt; &gt; things like DCHECK(!did_create_current_document_element_). It might be
possible
&gt; &gt; for the load event, but that is not guaranteed by any contract in Blink.
&gt; &gt; &gt; 
&gt; &gt; &gt; Because running the scripts now happens in a separate notification, we
could
&gt; &gt; change the implementation to only run the script once per document, but that
is
&gt; &gt; not required for fixing this bug (and a huge undertaking in itself), so I&#39;m
not
&gt; &gt; going to block this CL on that.
&gt; &gt; &gt; 
&gt; &gt; &gt; &gt; (or will be called on a new load)?
&gt; &gt; &gt; 
&gt; &gt; &gt; Until there exist a &quot;frame is unloaded&quot; notification from Blink, I cannot
&gt; &gt; really determine whether this holds. ScriptInjectionManager::RFOHelper
attempts
&gt; &gt; to answer this, but that is in very specific to content scripts and not
suitable
&gt; &gt; for general use.
&gt; &gt; 
&gt; &gt; FWIW this already exists in the form of WebFrameClient::frameDetached
&gt; 
&gt; Is that also called upon navigation? I thought that it&#39;s only for frame
removal and process swaps. By &quot;frame unload&quot;, I&#39;m referring to the event where
the document and script context of a frame become invalid.
&gt; 

It&#39;s not, but navigation is less problematic in many ways: for one, it generally
doesn&#39;t cause synchronous destruction of objects. I suppose you could listen to
willReleaseScriptContext() for the latter though.

&gt; &gt; &gt; 
&gt; &gt; &gt; ScheduleRunAtDocumentStart should be called in a DidCreateDocumentElement
&gt; &gt; notification (this is clearly documented in the header), and I think that
it&#39;s
&gt; &gt; sufficient for now.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg73"
           name="72">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(72)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-72">
                          Ping esprehn. I was hoping to get this in the first release of M-49, but ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 16:17:58 UTC)
                <a href="#msg73">#73</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-72"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-72"
            >Ping esprehn.

I was hoping to get this in the first release of M-49, but that starts to look a
bit optimistic.

I&#39;m assuming that you&#39;ll be doing the full review (including the parser
changes). If not, please make clear who is supposed to be reviewing the parser
changes, because these parser changes are independent from the exact way of
calling the callbacks (any method requires the callback to be run before the
parser continues).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg74"
           name="73">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(73)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-73">
                          Ping esprehn.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 20:49:29 UTC)
                <a href="#msg74">#74</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-73"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-73"
            >Ping esprehn.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg75"
           name="74">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(74)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-74">
                          re: parser changes, have we agreed that we keep the design that dispatchDocumentElementAvailable() may invalidate ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 21:48:37 UTC)
                <a href="#msg75">#75</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-74"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-74"
            >re: parser changes, have we agreed that we keep the design that
dispatchDocumentElementAvailable() may invalidate the document?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg76"
           name="75">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(75)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-75">
                          On 2016/02/26 21:48:37, kouhei wrote: &gt; re: parser changes, have we agreed that we keep ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 21:59:24 UTC)
                <a href="#msg76">#76</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-75"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-75"
            >On 2016/02/26 21:48:37, kouhei wrote:
&gt; re: parser changes, have we agreed that we keep the design that
&gt; dispatchDocumentElementAvailable() may invalidate the document?

I haven&#39;t seen any objections to that. The only issue was the ability to run
scripts in the callback, but I separated this in a notification in a
ScriptForbiddenScope, and one without.

I also tried hard to look for alternatives that did not require
dispatchDocumentElementAvailable to invalidate the document, but that is simply
not possible because extensions must run scripts right after the document
element is inserted, before the rest of the document.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg77"
           name="76">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(76)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-76">
                          On 2016/02/26 21:59:24, robwu wrote: &gt; On 2016/02/26 21:48:37, kouhei wrote: &gt; &gt; re: parser ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 23:12:43 UTC)
                <a href="#msg77">#77</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-76"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-76"
            >On 2016/02/26 21:59:24, robwu wrote:
&gt; On 2016/02/26 21:48:37, kouhei wrote:
&gt; &gt; re: parser changes, have we agreed that we keep the design that
&gt; &gt; dispatchDocumentElementAvailable() may invalidate the document?
&gt; 
&gt; I haven&#39;t seen any objections to that. The only issue was the ability to run
&gt; scripts in the callback, but I separated this in a notification in a
&gt; ScriptForbiddenScope, and one without.
&gt; 
&gt; I also tried hard to look for alternatives that did not require
&gt; dispatchDocumentElementAvailable to invalidate the document, but that is
simply
&gt; not possible because extensions must run scripts right after the document
&gt; element is inserted, before the rest of the document.

OK. Please add comments on the parser early returns why its needed.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg78"
           name="77">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(77)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-77">
                          On 2016/02/26 at 21:59:24, rob wrote: &gt; On 2016/02/26 21:48:37, kouhei wrote: &gt; &gt; re: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 23:18:24 UTC)
                <a href="#msg78">#78</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-77"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-77"
            >On 2016/02/26 at 21:59:24, rob wrote:
&gt; On 2016/02/26 21:48:37, kouhei wrote:
&gt; &gt; re: parser changes, have we agreed that we keep the design that
&gt; &gt; dispatchDocumentElementAvailable() may invalidate the document?
&gt; 
&gt; I haven&#39;t seen any objections to that. The only issue was the ability to run
scripts in the callback, but I separated this in a notification in a
ScriptForbiddenScope, and one without.
&gt; 
&gt; I also tried hard to look for alternatives that did not require
dispatchDocumentElementAvailable to invalidate the document, but that is simply
not possible because extensions must run scripts right after the document
element is inserted, before the rest of the document.

I objected, sorry I wasn&#39;t clear, I want the path that runs script and the path
that doesn&#39;t to be totally separate.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg79"
           name="78">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(78)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-78">
                          On 2016/02/26 23:18:24, esprehn wrote: &gt; On 2016/02/26 at 21:59:24, rob wrote: &gt; &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-26 23:34:56 UTC)
                <a href="#msg79">#79</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-78"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-78"
            >On 2016/02/26 23:18:24, esprehn wrote:
&gt; On 2016/02/26 at 21:59:24, rob wrote:
&gt; &gt; On 2016/02/26 21:48:37, kouhei wrote:
&gt; &gt; &gt; re: parser changes, have we agreed that we keep the design that
&gt; &gt; &gt; dispatchDocumentElementAvailable() may invalidate the document?
&gt; &gt; 
&gt; &gt; I haven&#39;t seen any objections to that. The only issue was the ability to run
&gt; scripts in the callback, but I separated this in a notification in a
&gt; ScriptForbiddenScope, and one without.
&gt; &gt; 
&gt; &gt; I also tried hard to look for alternatives that did not require
&gt; dispatchDocumentElementAvailable to invalidate the document, but that is
simply
&gt; not possible because extensions must run scripts right after the document
&gt; element is inserted, before the rest of the document.
&gt; 
&gt; I objected, sorry I wasn&#39;t clear, I want the path that runs script and the
path
&gt; that doesn&#39;t to be totally separate.

This is only for the document element insertion
(FrameLoader::dispatchDocumentElementAvailable), right?
The one for dispatchDidFinishDocumentLoad can&#39;t be moved further without
splitting the FrameLoader::finishedParsing method.

And I hope that you&#39;re already happy with the location of ScriptForbiddenScope?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg80"
           name="79">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(79)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-79">
                          Esprehn: Please take a look. Now the dispatchDocumentElementAvailable notification does not run any scripts at ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-05 01:50:58 UTC)
                <a href="#msg80">#80</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-79"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-79"
            >Esprehn: Please take a look. Now the dispatchDocumentElementAvailable
notification does not run any scripts at all.

kouhei: I added the comments to the early returns.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg81"
           name="80">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(80)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-80">
                          Ping for review. @esprehn @kouhei
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-09 16:54:51 UTC)
                <a href="#msg81">#81</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-80"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-80"
            >Ping for review.
@esprehn
@kouhei</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg82"
           name="81">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(81)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-81">
                          Ping again... Come on, this is a security bug! Why is there no response for ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-14 23:07:49 UTC)
                <a href="#msg82">#82</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-81"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-81"
            >Ping again... Come on, this is a security bug! Why is there no response for two
weeks?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg83"
           name="82">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(82)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-82">
                          lgtm, looks legit.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-15 00:06:52 UTC)
                <a href="#msg83">#83</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-82"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-82"
            >lgtm, looks legit.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg84"
           name="83">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(83)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kouhei (in TOK)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-83">
                          lgtm for html/parser
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-15 00:19:58 UTC)
                <a href="#msg84">#84</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-83"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-83"
            >lgtm for html/parser</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg85"
           name="84">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(84)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-84">
                          I took another quick look, and will look more in-depth tomorrow. https://codereview.chromium.org/1642283002/diff/240001/chrome/browser/extensions/execute_script_apitest.cc File chrome/browser/extensions/execute_script_apitest.cc (right): ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-15 00:53:32 UTC)
                <a href="#msg85">#85</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-84"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-84"
            >I took another quick look, and will look more in-depth tomorrow.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/browser/extensions/execute_script_apitest.cc" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/browser/extensi...</a>
File chrome/browser/extensions/execute_script_apitest.cc (right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/browser/extensions/execute_script_apitest.cc#newcode213" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/browser/extensi...</a>
chrome/browser/extensions/execute_script_apitest.cc:213: ::testing::Range(0,
kNumberOfDestructiveScriptTests));
This effectively adds 108 more browser tests.  That&#39;s, frankly, too many.  I&#39;ll
look at this more closely tomorrow, but we&#39;ll have to find a way to do this
testing more efficiently.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode38" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:38:
&#39;before the main frame\&#39;s content script!&#39;;
nit: indentation

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode9" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:9:
chrome.test.assertTrue(TEST_HOST !== &#39;&#39;,
nit: put TEST_HOST !== &#39;&#39; on the next line to match indentation with the message</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg86"
           name="85">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(85)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-85">
                          https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js File chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js (right): https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode22 chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:22: if (event.data === &#39;toBeRemoved&#39;) Do we expect any other ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-15 16:34:35 UTC)
                <a href="#msg86">#86</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-85"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-85"
            ><a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode22" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:22:
if (event.data === &#39;toBeRemoved&#39;)
Do we expect any other messages?  Can this be an assert?

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode26" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:26:
// Fall back, in case the content script never ran.
If the content script never runs, shouldn&#39;t this be a failure?  Or at least an
asynchronous post to reportFrames?  I&#39;d like to avoid a magic 3 second timeout.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode82" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:82:
doRemove();
I&#39;m not quite sure I understand the reasoning here.  We wait for n event
firings, but if we don&#39;t see n events, we just go ahead anyway?  I&#39;d prefer a
more deterministic test where we can wait for one specific thing, rather than &quot;n
or some time, whichever happens first&quot;.  If we don&#39;t expect n events to occur,
we don&#39;t need that test, right?  (e.g., if we have a test for 2 events and 3
events, but we only ever get 2 events, the 3 event test is just a dup of the 2
event test.)

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:158: var
kTestsPerInstance = 2;
How slow is this if we run all 24 tests in one?

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode163" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:163: var
actualTestCount = parseInt(/count=(\d+)/.exec(location.hash)[1]);
Could we use the URL api (specifically searchParams) here instead of using a
regex?

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode182" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:182: var
url = getTestUrl(page);
Just inline this on line 212</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg87"
           name="86">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(86)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-86">
                          rob@robwu.nl changed reviewers: - haraken@chromium.org, yhirano@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-16 22:03:29 UTC)
                <a href="#msg87">#87</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-86"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-86"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed reviewers:
- <a href="mailto:haraken@chromium.org">haraken@chromium.org</a>, <a href="mailto:yhirano@chromium.org">yhirano@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg88"
           name="87">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(87)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-87">
                          https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js File chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js (right): https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode22 chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:22: if (event.data === &#39;toBeRemoved&#39;) On 2016/03/15 16:34:34, Devlin wrote: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-16 22:03:32 UTC)
                <a href="#msg88">#88</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-87"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-87"
            ><a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode22" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:22:
if (event.data === &#39;toBeRemoved&#39;)
On 2016/03/15 16:34:34, Devlin wrote:
&gt; Do we expect any other messages?  Can this be an assert?

Done.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode26" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:26:
// Fall back, in case the content script never ran.
On 2016/03/15 16:34:35, Devlin wrote:
&gt; If the content script never runs, shouldn&#39;t this be a failure?  Or at least an
&gt; asynchronous post to reportFrames?  I&#39;d like to avoid a magic 3 second
timeout.

This event was too defensive and is not necessary.
If the message never arrives due to some bug, then the test will time out and
someone will spawn a bug report.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode38" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:38:
&#39;before the main frame\&#39;s content script!&#39;;
On 2016/03/15 00:53:32, Devlin wrote:
&gt; nit: indentation

Done.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode82" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:82:
doRemove();
On 2016/03/15 16:34:34, Devlin wrote:
&gt; I&#39;m not quite sure I understand the reasoning here.  We wait for n event
&gt; firings, but if we don&#39;t see n events, we just go ahead anyway?  I&#39;d prefer a
&gt; more deterministic test where we can wait for one specific thing, rather than
&quot;n
&gt; or some time, whichever happens first&quot;.  If we don&#39;t expect n events to occur,
&gt; we don&#39;t need that test, right?  (e.g., if we have a test for 2 events and 3
&gt; events, but we only ever get 2 events, the 3 event test is just a dup of the 2
&gt; event test.)

I replaced the timer with a window.onload notification.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode9" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:9:
chrome.test.assertTrue(TEST_HOST !== &#39;&#39;,
On 2016/03/15 00:53:32, Devlin wrote:
&gt; nit: put TEST_HOST !== &#39;&#39; on the next line to match indentation with the
message

Done.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:158: var
kTestsPerInstance = 2;
On 2016/03/15 16:34:35, Devlin wrote:
&gt; How slow is this if we run all 24 tests in one?

About 25 seconds. I&#39;ve now disabled 6x12 DOM mutation tests at document_end
(saving about 70 seconds) and used 3 buckets instead of 12 (which reduces the
overhead of starting tests).

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode163" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:163: var
actualTestCount = parseInt(/count=(\d+)/.exec(location.hash)[1]);
On 2016/03/15 16:34:35, Devlin wrote:
&gt; Could we use the URL api (specifically searchParams) here instead of using a
&gt; regex?

Done.

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode182" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:182: var
url = getTestUrl(page);
On 2016/03/15 16:34:35, Devlin wrote:
&gt; Just inline this on line 212

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg89"
           name="88">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(88)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-88">
                          Looks like this breaks webkit tests. :/ https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js File chrome/test/data/extensions/api_test/executescript/destructive/test.js (right): https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode158 chrome/test/data/extensions/api_test/executescript/destructive/test.js:158: var kTestsPerInstance ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-17 16:59:02 UTC)
                <a href="#msg89">#89</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-88"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-88"
            >Looks like this breaks webkit tests. :/

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:158: var
kTestsPerInstance = 2;
On 2016/03/16 22:03:32, robwu wrote:
&gt; On 2016/03/15 16:34:35, Devlin wrote:
&gt; &gt; How slow is this if we run all 24 tests in one?
&gt; 
&gt; About 25 seconds. I&#39;ve now disabled 6x12 DOM mutation tests at document_end
&gt; (saving about 70 seconds) and used 3 buckets instead of 12 (which reduces the
&gt; overhead of starting tests).

Hmm... if it&#39;s only 25 seconds, I wonder if we can just run them all in one
bucket (especially with removing the dom mutation doc end ones).  Even in the
latest patch set, it&#39;s still a bunch of added browser tests, and I&#39;d love to get
it down to &lt;10 added in this patch.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg90"
           name="89">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(89)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-89">
                          I&#39;ve replaced DidCreateDocumentElement with RunScriptsAtDocumentStart in MojoBindingsController to fix the crash in the WebKit tests ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-17 22:20:40 UTC)
                <a href="#msg90">#90</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-89"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-89"
            >I&#39;ve replaced DidCreateDocumentElement with RunScriptsAtDocumentStart in
MojoBindingsController to fix the crash in the WebKit tests - now all tests are
green.

For future reference, this was the stack trace leading to the crash in
V8PerIsolateData.cpp:47

#0 0x0000007d4c0e base::debug::StackTrace::StackTrace()
#1 0x000003b03a6d blink::beforeCallEnteredCallback()
#2 0x000001ce5f0d v8::internal::Isolate::FireBeforeCallEnteredCallback()
#3 0x000001a3a97a v8::Function::NewInstance()
#4 0x000003b0c40e blink::V8ScriptRunner::instantiateObject()
#5 0x000003afc9eb blink::V8ObjectConstructor::newInstance()
#6 0x000003afd60e blink::V8PerContextData::createWrapperFromCacheSlowCase()
#7 0x000003ae4cff blink::V8PerContextData::createWrapperFromCache()
#8 0x000003ae4296 blink::V8DOMWrapper::createWrapper()
#9 0x000003ac5f35 blink::ScriptWrappable::wrap()
#10 0x0000021ec7d2 blink::toV8()
#11 0x00000565bfdf WebCoreTestSupport::createInternalsObject()
#12 0x00000565c07d WebCoreTestSupport::injectInternalsObject()
#13 0x00000565beb2 blink::WebTestingSupport::injectInternalsObject()
#14 0x0000005e06b9 content::BlinkTestRunner::DidClearWindowObject()
#15 0x000004ec6bef content::RenderFrameImpl::didClearWindowObject()
#16 0x0000021e0185
blink::FrameLoaderClientImpl::dispatchDidClearWindowObjectInMainWorld()
#17 0x0000034b1b01 blink::FrameLoader::dispatchDidClearWindowObjectInMainWorld()
#18 0x000003a9e9e6 blink::ScriptController::windowProxy()
#19 0x00000336662f blink::LocalFrame::windowProxy()
#20 0x000003ad8591 blink::toV8ContextEvenIfDetached()
#21 0x000003ad8430 blink::toV8Context()
#22 0x000003aacc02 blink::ScriptState::forWorld()
#23 0x000003aacb75 blink::ScriptState::forMainWorld()
#24 0x00000216c09d blink::WebLocalFrameImpl::mainWorldScriptContext()
#25 0x00000216c129 blink::WebLocalFrameImpl::mainWorldScriptContext()
#26 0x0000051a5d34 content::MojoBindingsController::CreateContextState()
#27 0x0000051a6015 content::MojoBindingsController::DidCreateDocumentElement()
#28 0x000004ec701a content::RenderFrameImpl::didCreateDocumentElement()
#29 0x0000021e03d2 blink::FrameLoaderClientImpl::documentElementAvailable()

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode158" rel="nofollow">https://codereview.chromium.org/1642283002/diff/240001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:158: var
kTestsPerInstance = 2;
On 2016/03/17 16:59:02, Devlin wrote:
&gt; On 2016/03/16 22:03:32, robwu wrote:
&gt; &gt; On 2016/03/15 16:34:35, Devlin wrote:
&gt; &gt; &gt; How slow is this if we run all 24 tests in one?
&gt; &gt; 
&gt; &gt; About 25 seconds. I&#39;ve now disabled 6x12 DOM mutation tests at document_end
&gt; &gt; (saving about 70 seconds) and used 3 buckets instead of 12 (which reduces
the
&gt; &gt; overhead of starting tests).
&gt; 
&gt; Hmm... if it&#39;s only 25 seconds, I wonder if we can just run them all in one
&gt; bucket (especially with removing the dom mutation doc end ones).  Even in the
&gt; latest patch set, it&#39;s still a bunch of added browser tests, and I&#39;d love to
get
&gt; it down to &lt;10 added in this patch.

I&#39;ve decreased it to 1 bucket, but kept the test splitting logic in case the
bucket ever becomes too slow for a bot (and e.g. cause flaky timeouts).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg91"
           name="90">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(90)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-90">
                          awesome, extensions lgtm. https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js File chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js (right): https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode78 chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:78: if (performance.timing.loadEventEnd &gt; 0) nit: while ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 16:46:10 UTC)
                <a href="#msg91">#91</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-90"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-90"
            >awesome, extensions lgtm.

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
File
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode78" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:78:
if (performance.timing.loadEventEnd &gt; 0)
nit: while this works, I think it&#39;d be clearer to use document.readyState ===
&#39;complete&#39;.

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode164" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:164: var
filteredTests =
nit: I&#39;m fine with leaving in most of the structure for breaking these tests up,
but can we add a quick assert here that this will run all the tests?  e.g.
assertEq(kTestsPerBucket, allTests.length).  We can easily take it out if we
adjust to have more bucketed tests.

At the same time, please add a note explaining why this is all there (in case we
need to split the tests for timing reasons).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg92"
           name="91">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(91)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-91">
                          rob@robwu.nl changed reviewers: + sky@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 19:25:36 UTC)
                <a href="#msg92">#92</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-91"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-91"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed reviewers:
+ <a href="mailto:sky@chromium.org">sky@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg93"
           name="92">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(92)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-92">
                          sky: Please rs lg chrome/renderer/chrome_content_renderer_client.{h,cc} https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js File chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js (right): https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode78 chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:78: if (performance.timing.loadEventEnd &gt; 0) ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 19:25:38 UTC)
                <a href="#msg93">#93</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-92"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-92"
            >sky: Please rs lg chrome/renderer/chrome_content_renderer_client.{h,cc}

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
File
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js#newcode78" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/remove_self.js:78:
if (performance.timing.loadEventEnd &gt; 0)
On 2016/03/18 16:46:10, Devlin wrote:
&gt; nit: while this works, I think it&#39;d be clearer to use document.readyState ===
&gt; &#39;complete&#39;.

Done.

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/test.js" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
File chrome/test/data/extensions/api_test/executescript/destructive/test.js
(right):

<a href="https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/extensions/api_test/executescript/destructive/test.js#newcode164" rel="nofollow">https://codereview.chromium.org/1642283002/diff/300001/chrome/test/data/exten...</a>
chrome/test/data/extensions/api_test/executescript/destructive/test.js:164: var
filteredTests =
On 2016/03/18 16:46:10, Devlin wrote:
&gt; nit: I&#39;m fine with leaving in most of the structure for breaking these tests
up,
&gt; but can we add a quick assert here that this will run all the tests?  e.g.
&gt; assertEq(kTestsPerBucket, allTests.length).  We can easily take it out if we
&gt; adjust to have more bucketed tests.

I&#39;ve added an assertion that still holds even if the number of buckets changes.

&gt; At the same time, please add a note explaining why this is all there (in case
we
&gt; need to split the tests for timing reasons).

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg94"
           name="93">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(93)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>sky</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-93">
                          LGTM
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 20:11:40 UTC)
                <a href="#msg94">#94</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-93"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-93"
            >LGTM</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg95"
           name="94">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(94)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-94">
                          The CQ bit was checked by rob@robwu.nl
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 21:45:39 UTC)
                <a href="#msg95">#95</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-94"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-94"
            >The CQ bit was checked by <a href="mailto:rob@robwu.nl">rob@robwu.nl</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg96"
           name="95">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(95)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-95">
                          The patchset sent to the CQ was uploaded after l-g-t-m from nick@chromium.org, esprehn@chromium.org, kouhei@chromium.org, rdevlin.cronin@chromium.org ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 21:45:40 UTC)
                <a href="#msg96">#96</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-95"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-95"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:nick@chromium.org">nick@chromium.org</a>,
<a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a>, <a href="mailto:kouhei@chromium.org">kouhei@chromium.org</a>, <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1642283002/#ps320001" rel="nofollow">https://codereview.chromium.org/1642283002/#ps320001</a>
(title: &quot;Last nits&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg97"
           name="96">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(96)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-96">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1642283002/320001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1642283002/320001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-18 21:46:03 UTC)
                <a href="#msg97">#97</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-96"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-96"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1642283002/320001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1642283002/320001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1642283002/320001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1642283002/320001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg98"
           name="97">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(97)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-97">
                          Description was changed from ========== Deal with frame removal by content scripts Blink and the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-19 01:05:09 UTC)
                <a href="#msg98">#98</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-97"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-97"
            >Description was changed from

==========
Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
&quot;document element created&quot; and &quot;document loaded&quot; notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=582008
==========

to

==========
Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
&quot;document element created&quot; and &quot;document loaded&quot; notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=582008
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg99"
           name="98">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(98)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-98">
                          Committed patchset #17 (id:320001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-19 01:05:12 UTC)
                <a href="#msg99">#99</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-98"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-98"
            >Committed patchset #17 (id:320001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg100"
           name="99">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(99)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-99">
                          Description was changed from ========== Deal with frame removal by content scripts Blink and the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-19 01:06:24 UTC)
                <a href="#msg100">#100</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-99"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-99"
            >Description was changed from

==========
Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
&quot;document element created&quot; and &quot;document loaded&quot; notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=582008
==========

to

==========
Deal with frame removal by content scripts

Blink and the RenderFrame implementations are currently not prepared to deal
with frame detachments in their callbacks. Consequently, extension code
(content scripts, chrome.app.window.create) that run arbitrary code in the
&quot;document element created&quot; and &quot;document loaded&quot; notifications may result in
unexpected invalidation of memory, resulting in a UAF.

This patch fixes the bug by moving all code that runs untrusted code from
observers to dedicated callbacks, which are only run at a safe point.
All document parsers in Blink have been modified to make sure that they still
work even when the document creation is interrupted by frame removal.

An extensive set of tests for all different kinds of documents, frame removal
methods (e.g. synchronously / in mutation events / ...) and injection points
(document start/end) have been added to avoid regressions.

BUG=582008

Committed: <a href="https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb" rel="nofollow">https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb</a>
Cr-Commit-Position: refs/heads/master@{#382162}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg101"
           name="100">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(100)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-100">
                          Patchset 17 (id:??) landed as https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb Cr-Commit-Position: refs/heads/master@{#382162}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 9 months ago
		(2016-03-19 01:06:26 UTC)
                <a href="#msg101">#101</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-100"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-100"
            >Patchset 17 (id:??) landed as
<a href="https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb" rel="nofollow">https://crrev.com/43ea0649d4b70fdcf3e9fa5c03aee1bbba0b04bb</a>
Cr-Commit-Position: refs/heads/master@{#382162}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 101)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 101)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(101)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(101)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 101;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1642283002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1642283002: Deal with frame removal by content scripts
     (Closed) </b><br/>
      Created 4 years, 10 months ago by robwu<br/>
      Modified 4 years, 9 months ago<br/>
      Reviewers: esprehn, dcheng, kouhei (in TOK), nasko, ncarter (slow), Devlin, Ken Rockot(use gerrit already), sky<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 66
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
