<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>73c09dd8067250734511d955d8f792b41c7213f0 - platform/external/dhcpcd - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/external/dhcpcd/%2B/73c09dd8067250734511d955d8f792b41c7213f0">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/platform/external/">external</a> / <a class="Breadcrumbs-crumb" href="/platform/external/dhcpcd/">dhcpcd</a> / <span class="Breadcrumbs-crumb">73c09dd8067250734511d955d8f792b41c7213f0</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>73c09dd8067250734511d955d8f792b41c7213f0</td><td><span>[<a href="/platform/external/dhcpcd/+log/73c09dd8067250734511d955d8f792b41c7213f0">log</a>]</span> <span>[<a href="/platform/external/dhcpcd/+archive/73c09dd8067250734511d955d8f792b41c7213f0.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Erik Kline &lt;ek@google.com&gt;</td><td>Sat Nov 15 04:24:40 2014 +0900</td></tr><tr><th class="Metadata-title">committer</th><td>Natalie Silvanovich &lt;natashenka@google.com&gt;</td><td>Fri Mar 06 15:33:36 2015 -0800</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/">5cc48473d65059c53a1262f271d626541aea850e</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0%5E">b82be17488382132602e33e1a64829e7e5358f0f</a> <span>[<a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Fun with buffer overrruns.

In get_option(): don&#39;t read past the end of the option buffer.

Also add a small unittest to verify sane behaviour for the above.
The dhcpcd code is not easily refactored into a library, nor is it
entirely possible to include some header files directly since some
structures use C++ reserved keywords (&quot;new&quot;) for variable names.

In print_option(): use of snprintf() returns the length that
/would/ have been written.  Add checks that the output buffer
is not overrun when printing.

This fixes CVE-2014-7912 and CVE-2014-7913

Bug: 18356137
Bug: 18356135
Change-Id: <a href="https://android-review.googlesource.com/#/q/I0f907b8a952208749226ba034a416d773e068f8a">I0f907b8a952208749226ba034a416d773e068f8a</a>
</pre><ul class="DiffTree"><li><a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/Android.mk">Android.mk</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0%5E%21/#F0">diff</a>]</span></li><li><a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcp.c">dhcp.c</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0%5E%21/#F1">diff</a>]</span></li><li><a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd_test.cpp">dhcpcd_test.cpp</a><span class="DiffTree-action DiffTree-action--add">[Added - <a href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0%5E%21/#F2">diff</a>]</span></li></ul><div class="DiffSummary">3 files changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: 5cc48473d65059c53a1262f271d626541aea850e</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - Android.mk"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/Android.mk">Android.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CleanSpec.mk"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/CleanSpec.mk">CleanSpec.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - MODULE_LICENSE_BSD_LIKE"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/MODULE_LICENSE_BSD_LIKE">MODULE_LICENSE_BSD_LIKE</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - Makefile"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/Makefile">Makefile</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - Makefile.inc"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/Makefile.inc">Makefile.inc</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NOTICE"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/NOTICE">NOTICE</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - README"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/README">README</a></li><li class="FileList-item FileList-item--executableFile" title="Executable file - android.conf"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/android.conf">android.conf</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - arp.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/arp.c">arp.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - arp.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/arp.h">arp.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bind.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/bind.c">bind.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bind.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/bind.h">bind.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bpf-filter.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/bpf-filter.h">bpf-filter.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - bpf.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/bpf.c">bpf.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - common.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/common.c">common.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - common.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/common.h">common.h</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - compat/"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/compat/">compat/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - config.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/config.h">config.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - config.mk"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/config.mk">config.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - configure.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/configure.c">configure.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - configure.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/configure.h">configure.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - control.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/control.c">control.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - control.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/control.h">control.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - defs.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/defs.h">defs.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcp.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcp.c">dhcp.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcp.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcp.h">dhcp.h</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - dhcpcd-hooks/"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd-hooks/">dhcpcd-hooks/</a></li><li class="FileList-item FileList-item--executableFile" title="Executable file - dhcpcd-run-hooks"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd-run-hooks">dhcpcd-run-hooks</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd-run-hooks.8"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd-run-hooks.8">dhcpcd-run-hooks.8</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd-run-hooks.8.in"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd-run-hooks.8.in">dhcpcd-run-hooks.8.in</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd-run-hooks.in"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd-run-hooks.in">dhcpcd-run-hooks.in</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.8"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.8">dhcpcd.8</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.8.in"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.8.in">dhcpcd.8.in</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.c">dhcpcd.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.conf"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.conf">dhcpcd.conf</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.conf.5"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.conf.5">dhcpcd.conf.5</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.conf.5.in"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.conf.5.in">dhcpcd.conf.5.in</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd.h">dhcpcd.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - dhcpcd_test.cpp"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/dhcpcd_test.cpp">dhcpcd_test.cpp</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - duid.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/duid.c">duid.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - duid.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/duid.h">duid.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - eloop.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/eloop.c">eloop.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - eloop.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/eloop.h">eloop.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-bsd.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-bsd.c">if-bsd.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-linux-wireless.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-linux-wireless.c">if-linux-wireless.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-linux.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-linux.c">if-linux.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-options.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-options.c">if-options.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-options.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-options.h">if-options.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-pref.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-pref.c">if-pref.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - if-pref.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/if-pref.h">if-pref.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ifaddrs.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ifaddrs.c">ifaddrs.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ifaddrs.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ifaddrs.h">ifaddrs.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ipv4ll.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ipv4ll.c">ipv4ll.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ipv4ll.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ipv4ll.h">ipv4ll.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ipv6rs.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ipv6rs.c">ipv6rs.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - ipv6rs.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/ipv6rs.h">ipv6rs.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - lpf.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/lpf.c">lpf.c</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - mk/"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/mk/">mk/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/net.c">net.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - net.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/net.h">net.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - platform-bsd.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/platform-bsd.c">platform-bsd.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - platform-linux.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/platform-linux.c">platform-linux.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - platform.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/platform.h">platform.h</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - showlease.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/showlease.c">showlease.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - signals.c"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/signals.c">signals.c</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - signals.h"><a class="FileList-itemLink" href="/platform/external/dhcpcd/+/73c09dd8067250734511d955d8f792b41c7213f0/signals.h">signals.h</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>