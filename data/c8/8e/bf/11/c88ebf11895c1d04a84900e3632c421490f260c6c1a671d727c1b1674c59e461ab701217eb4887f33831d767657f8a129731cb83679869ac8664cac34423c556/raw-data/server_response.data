<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='PHAR related Bug #77586 - RDF' href='rss/bug.php?id=77586'>
        <link rel='alternate' type='application/rss+xml' title='PHAR related Bug #77586 - RSS 2.0' href='rss/bug.php?id=77586&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Sec Bug #77586 :: phar_tar_writeheaders_int() buffer overflow</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=77586">Sec Bug</a>&nbsp;#77586</th>
            <td id="summary" colspan="5">phar_tar_writeheaders_int() buffer overflow</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2019-02-08 11:16 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2019-03-04 07:34 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>jordy &#x61;&#116; simplyhacker &#x64;&#111;&#x74; com</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=bishop">bishop</a> (<a href="https://people.php.net/bishop">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=PHAR+related">PHAR related</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>7.1.26</td>
            <th class="details">OS:</th>
            <td>Any</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><em>None</em></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=77586&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=77586&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=77586&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1549624593">&nbsp;</a><strong>[2019-02-08 11:16 UTC] jordy &#x61;&#116; simplyhacker &#x64;&#111;&#x74; com</strong>
<pre class='note'>Description:
------------
A bufferoverflow has been found in the phar_tar_writeheaders_int() function.

As you can see on the following page.
<a href="https://github.com/php/php-src/blob/master/ext/phar/tar.c#L767" rel="nofollow">https://github.com/php/php-src/blob/master/ext/phar/tar.c#L767</a>

it does a strncpy to header-&gt;linkname from entry-&gt;link with the size of entry-&gt;link.

As you can see in <a href="https://github.com/php/php-src/blob/master/ext/phar/tar.h#L66" rel="nofollow">https://github.com/php/php-src/blob/master/ext/phar/tar.h#L66</a> , header-&gt;linkname is a char of the size 100. Once entry-&gt;link contains a value that's bigger than 100 it will overflow the _tar_header structure.

This can be fixed by setting the size argument of strncpy to sizeof(header-&gt;linkname) for example:

strncpy(header.linkname, entry-&gt;link, strlen(header-&gt;linkname);

Kind Regards,

Jordy Zomer


Test script:
---------------
None yet.

Expected result:
----------------
None

Actual result:
--------------
None

</pre>
</div><h2>Patches</h2>
<a href="patch-display.php?bug_id=77586&amp;patch=issue-77586-buff-overflow&amp;revision=latest" >issue-77586-buff-overflow</a>
(last revision 2019-02-13 05:17 UTC by bishop@php.net)
<br><a href="patch-display.php?bug_id=77586&amp;patch=issue-77586-buff-overflow.patch&amp;revision=latest"  style="background-color: yellow; text-decoration: line-through;" >issue-77586-buff-overflow.patch</a>
(last revision 2019-02-11 21:16 UTC by bishop@php.net)
<br><a href="patch-display.php?bug_id=77586&amp;patch=phar_tar_writeheaders.patch&amp;revision=latest"  style="background-color: yellow; text-decoration: line-through;" >phar_tar_writeheaders.patch</a>
(last revision 2019-02-08 11:16 UTC by jordy &#x61;&#116; simplyhacker &#x64;&#111;&#x74; com)
<br><p><a href='patch-add.php?bug_id=77586'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=77586'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_log' ><a name="1549764055">&nbsp;</a><strong>[2019-02-10 02:00 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: bishop</span>
</div></div></div><div class='comment type_log' ><a name="1549908965">&nbsp;</a><strong>[2019-02-11 18:16 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Package: *Compression related</span>
<span class="added">+Package: PHAR related</span>
</div></div></div><div class='comment type_log' ><a name="1549916596">&nbsp;</a><strong>[2019-02-11 20:23 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Analyzed</span>
</div></div></div><div class='comment type_comment' ><a name="1549917947">&nbsp;</a><strong>[2019-02-11 20:45 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>Phar traverses the if (entry-&gt;link) condition only when the entry is a symlink. <a href='bug.php?id=65332'>Bug 65332</a>, however, prevents that from occurring.
</pre>
</div><div class='comment type_log' ><a name="1549919524">&nbsp;</a><strong>[2019-02-11 21:12 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Analyzed</span>
<span class="added">+Status: Verified</span>
</div></div></div><div class='comment type_patch' ><a name="1549919797">&nbsp;</a><strong>[2019-02-11 21:16 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>The following patch has been added/updated:

Patch Name: issue-77586-buff-overflow.patch
Revision:   1549919797
URL:        <a href="https://bugs.php.net/patch-display.php?bug=77586&amp;patch=issue-77586-buff-overflow.patch&amp;revision=1549919797" rel="nofollow">https://bugs.php.net/patch-display.php?bug=77586&amp;patch=issue-77586-buff-overflow.patch&amp;revision=1549919797</a>
</pre>
</div><div class='comment type_comment' ><a name="1549920042">&nbsp;</a><strong>[2019-02-11 21:20 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>Unified diff against PHP-7.1 attached.
</pre>
</div><div class='comment type_comment' ><a name="1549983574">&nbsp;</a><strong>[2019-02-12 14:59 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>Classifying as LOW severity, because of aforementioned <a href='bug.php?id=65332'>bug 65332</a>, under the criterion:

&gt; This issue allows theoretical compromise of security, but practical attack is usually impossible...

<a href="https://wiki.php.net/security#low_severity" rel="nofollow">https://wiki.php.net/security#low_severity</a>
</pre>
</div><div class='comment type_log' ><a name="1549983677">&nbsp;</a><strong>[2019-02-12 15:01 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Verified</span>
<span class="added">+Status: Feedback</span>
</div></div></div><div class='comment type_comment' ><a name="1549983677">&nbsp;</a><strong>[2019-02-12 15:01 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>OP, please review patch and provide any additional comments before final merge.
</pre>
</div><div class='comment type_patch' ><a name="1550035076">&nbsp;</a><strong>[2019-02-13 05:17 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>The following patch has been added/updated:

Patch Name: issue-77586-buff-overflow
Revision:   1550035076
URL:        <a href="https://bugs.php.net/patch-display.php?bug=77586&amp;patch=issue-77586-buff-overflow&amp;revision=1550035076" rel="nofollow">https://bugs.php.net/patch-display.php?bug=77586&amp;patch=issue-77586-buff-overflow&amp;revision=1550035076</a>
</pre>
</div><div class='comment type_log' ><a name="1550045793">&nbsp;</a><strong>[2019-02-13 08:16 UTC] jordy &#x61;&#116; simplyhacker &#x64;&#111;&#x74; com</strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Feedback</span>
<span class="added">+Status: Assigned</span>
</div></div></div><div class='comment type_comment' ><a name="1550045793">&nbsp;</a><strong>[2019-02-13 08:16 UTC] jordy &#x61;&#116; simplyhacker &#x64;&#111;&#x74; com</strong>
<pre class='note'>Hey Bishop,

It looks like I don't have access to the patch.

Can you give me access or comment it?

Kind Regards,

Jordy
</pre>
</div><div class='comment type_comment' ><a name="1550079014">&nbsp;</a><strong>[2019-02-13 17:30 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>Bishop, you can provide the patch as *secret* gist[1] which is
quite customary for security patches.

[1] &lt;<a href="https://gist.github.com/" rel="nofollow">https://gist.github.com/</a>&gt;
</pre>
</div><div class='comment type_log' ><a name="1550082125">&nbsp;</a><strong>[2019-02-13 18:22 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Feedback</span>
</div></div></div><div class='comment type_comment' ><a name="1550082125">&nbsp;</a><strong>[2019-02-13 18:22 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>Ack, @cmb. I had already emailed the patch to the OP, but will use a different approach for future sec bug.
</pre>
</div><div class='comment type_comment' ><a name="1550982124">&nbsp;</a><strong>[2019-02-24 04:22 UTC] php-bugs &#x61;&#116; lists &#x64;&#111;&#x74; php &#x64;&#111;&#x74; net</strong>
<pre class='note'>No feedback was provided. The bug is being suspended because
we assume that you are no longer experiencing the problem.
If this is not the case and you are able to provide the
information that was requested earlier, please do so and
change the status of the bug back to &quot;Re-Opened&quot;. Thank you.
</pre>
</div><div class='comment type_log' ><a name="1551681061">&nbsp;</a><strong>[2019-03-04 06:31 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: No Feedback</span>
<span class="added">+Status: Open</span>
</div></div></div><div class='comment type_log' ><a name="1551684895">&nbsp;</a><strong>[2019-03-04 07:34 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-PHP Version: master-Git-2019-02-08 (Git)</span>
<span class="added">+PHP Version: 7.1.26</span>
</div></div></div><div class='comment type_svn' ><a name="1551684932">&nbsp;</a><strong>[2019-03-04 07:35 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=e0f5d62bd6690169998474b62f92a8c5ddf0e699" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=e0f5d62bd6690169998474b62f92a8c5ddf0e699</a>
Log: Fix <a href='bug.php?id=77586'>bug #77586</a> - phar_tar_writeheaders_int() buffer overflow
</pre>
</div><div class='comment type_log' ><a name="1551684932">&nbsp;</a><strong>[2019-03-04 07:35 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_related' ><a name="1556521799">&nbsp;</a><strong>[2019-04-29 07:09 UTC] <a href="//people.php.net/bishop">bishop@php.net</a></strong>
<pre class='note'>Related To: <a href='bug.php?id=77919'>Bug #77919</a>
</pre>
</div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
