<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1887553002: Make sure binding security checks don&#39;t pass if the frame is remote. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '9f83c617d0480e265dd7db3ca63d1103';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1887553002%252526ust%25253D1608687368840886%252526usg%25253DAFQjCNEkBV9G44JbONsukg3w2Qc5e1O9fw%26service%3Dah">Sign out</a>

</div>
<div class="counter">(207)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1887553002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1887553002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1887553002</a>:
    Make sure binding security checks don&#39;t pass if the frame is remote.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 8 months ago by <a href="/user/dcheng" onMouseOver="M_showUserInfoPopup(this)">dcheng</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 8 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/haraken" onMouseOver="M_showUserInfoPopup(this)">haraken</a></span>, <span class='approval'><a href="/user/Charlie%20Reis" onMouseOver="M_showUserInfoPopup(this)">Charlie Reis</a></span>, <span class='approval'><a href="/user/esprehn" onMouseOver="M_showUserInfoPopup(this)">esprehn</a></span>, <span class='approval'><a href="/user/ncarter%20(slow)" onMouseOver="M_showUserInfoPopup(this)">ncarter (slow)</a></span>, <span class='approval'><a href="/user/Yuki" onMouseOver="M_showUserInfoPopup(this)">Yuki</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            blink-reviews, blink-reviews-bindings_chromium.org, chromium-reviews, creis+watch_chromium.org, darin-cc_chromium.org, esprehn, jam, nasko+codewatch_chromium.org, ncarter (slow), site-isolation-reviews_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Make sure binding security checks don't pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is not that simple. There are several
instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1], the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames.
This means that SecurityOrigin's canAccess check will pass… but this
ends up violating many assumptions in Blink that passing the security
check implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=601629">601629</a>
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation

Committed: <a href="https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e">https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e</a>
Cr-Commit-Position: refs/heads/master@{#387087}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1887553002/#ps1"
       onclick="M_toggleSectionForPS('1887553002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1887553002/#ps20001"
       onclick="M_toggleSectionForPS('1887553002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : .
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 11
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1887553002/#ps40001"
       onclick="M_toggleSectionForPS('1887553002', '40001')"
       class="toggled-section ">
      Patch Set 3
      : address comments / add more comments
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 4
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-50004-pointer"
       href="/1887553002/#ps50004"
       onclick="M_toggleSectionForPS('1887553002', '50004')"
       class="toggled-section ">
      Patch Set 4
      : Test fixes for --site-per-process and more periods.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 2
      
    </div>
  

  <div id="ps-50004"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1887553002/#ps60001"
       onclick="M_toggleSectionForPS('1887553002', '60001')"
       class="toggled-section opentriangle">
      Patch Set 5
      : .
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 2
      
    </div>
  

  <div id="ps-60001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 8 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1887553002_60001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1887553002/60001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+85 lines, -3 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1887553002/patch/60001/70001">
            content/browser/frame_host/render_frame_host_manager_browsertest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1887553002/diff2/1:60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1887553002/diff2/20001:60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1887553002/diff2/40001:60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1887553002/diff2/50004:60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+71 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          <b>
            2 comments
            
            
          </b>
        </td>
        <td>
          <a href="/download/issue1887553002_60001_70001.diff"
             title="Download patch for content/browser/frame_host/render_frame_host_manager_browsertest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1887553002/patch/60001/70002">
            third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1887553002/diff/60001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1887553002/diff2/1:60001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1887553002/diff2/20001:60001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1887553002/diff2/40001:60001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp"
             title="Delta from patch set 3">3</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+10 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1887553002_60001_70002.diff"
             title="Download patch for third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1887553002/patch/60001/70003">
            third_party/WebKit/Source/core/frame/DOMWindow.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1887553002/diff/60001/third_party/WebKit/Source/core/frame/DOMWindow.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1887553002/diff2/1:60001/third_party/WebKit/Source/core/frame/DOMWindow.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1887553002/diff2/20001:60001/third_party/WebKit/Source/core/frame/DOMWindow.cpp"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1887553002_60001_70003.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/DOMWindow.cpp">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 60001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 39 (15 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 39)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 39)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(39)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(39)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 03:35:02 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

BUG=601629
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 03:42:40 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this simply won&#39;t be true. One example:

1. [Window 1] navigates to a.com, which has a b.com subframe.
2. a.com in [Window 1] opens a new window, [Window 2].
3. [Window 2] navigates to c.com, which also a b.com subframe.
4. The navigation in [Window 2] causes a process swap, so [Window 1]
   and [Window 2] are now in separate processes.
5. Without out-of-process iframes, all the frames in a page are in
   the same process.
6. Thus, b.com in [Window 1] cannot script b.com in [Window 2], even
   though they are same origin.

Note that this has always been true in Chrome, so there&#39;s no behavior
change.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 03:59:23 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this simply won&#39;t be true. One example:

1. [Window 1] navigates to a.com, which has a b.com subframe.
2. a.com in [Window 1] opens a new window, [Window 2].
3. [Window 2] navigates to c.com, which also a b.com subframe.
4. The navigation in [Window 2] causes a process swap, so [Window 1]
   and [Window 2] are now in separate processes.
5. Without out-of-process iframes, all the frames in a page are in
   the same process.
6. Thus, b.com in [Window 1] cannot script b.com in [Window 2], even
   though they are same origin.

Note that this has always been true in Chrome, so there&#39;s no behavior
change.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. [Window 1] opens [Window 2].
2. [Window 2] is navigated cross-process (say a.com to b.com).
3. 

Note that this has always been true in Chrome, so there&#39;s no behavior
change.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:10:26 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. [Window 1] opens [Window 2].
2. [Window 2] is navigated cross-process (say a.com to b.com).
3. 

Note that this has always been true in Chrome, so there&#39;s no behavior
change.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! Normally, they should be able to script each other, but since
the frames are in two different processes, we need to fail the
security checks to prevent bad casts from happening.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:11:46 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! Normally, they should be able to script each other, but since
the frames are in two different processes, we need to fail the
security checks to prevent bad casts from happening.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! Normally, they should be able to script each other… but since
the frames are in two different processes, we need to fail the
security checks to avoid violating the assumptions that the frames
will be local.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          dcheng@chromium.org changed reviewers: + creis@chromium.org, haraken@chromium.org, yukishiino@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:18:35 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:creis@chromium.org">creis@chromium.org</a>, <a href="mailto:haraken@chromium.org">haraken@chromium.org</a>, <a href="mailto:yukishiino@chromium.org">yukishiino@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:19:49 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! Normally, they should be able to script each other… but since
the frames are in two different processes, we need to fail the
security checks to avoid violating the assumptions that the frames
will be local.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will fail… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          Here&#39;s one possible mitigation. One thing I&#39;m worried about is perf: I believe we try ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:27:36 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >Here&#39;s one possible mitigation. One thing I&#39;m worried about is perf: I believe
we try to avoid virtual calls as much as possible, and this adds an additional
one to this code path.

Some possible alternatives:
- Add a bit to SecurityOrigin to indicate if it originated from a remote frame,
and update canAccess() to check that bit.
- Always give remote frames a unique origin. Might have complications in terms
of origin replication and persisting things like isSecureContext().
- One that didn&#39;t work was setting a special security token for remote frames.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:28:18 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will fail… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will pass… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          LGTM https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp File third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp (left): https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp#oldcode53 third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp:53: if (isOriginAccessibleFromDOMWindow(targetFrameOrigin, accessingWindow)) isOriginAccessibleFromDOMWindow has already been heavy, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 04:43:20 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >LGTM

<a href="https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp (left):

<a href="https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp#oldcode53" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp:53: if
(isOriginAccessibleFromDOMWindow(targetFrameOrigin, accessingWindow))

isOriginAccessibleFromDOMWindow has already been heavy, so I don&#39;t think this
change affects performance.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Yuki</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          I&#39;m not sure if this is the right fix or not. If the both subframes ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 05:48:53 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >I&#39;m not sure if this is the right fix or not.  If the both subframes are b.com,
then, should they be considered as the same origin?  Why should we treat them as
cross origin?

Reading the spec, it seems saying nothing about the structure of frames or
parent-child relationship.

<a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" rel="nofollow">https://html.spec.whatwg.org/multipage/browsers.html#concept-origin</a>
----
For Document objects,
  If the Document&#39;s address&#39;s scheme is a network scheme
    A copy of the Document&#39;s address&#39;s origin.

Two origins, A and B, are said to be same origin if the following algorithm
returns true:
  2. If A and B are both tuple origins and their schemes, hosts, and port are
identical, then return true.
----

Then, both of b.com subframes are same origin, aren&#39;t they?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          On 2016/04/13 at 05:48:53, yukishiino wrote: &gt; I&#39;m not sure if this is the right ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:18:09 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >On 2016/04/13 at 05:48:53, yukishiino wrote:
&gt; I&#39;m not sure if this is the right fix or not.  If the both subframes are
b.com, then, should they be considered as the same origin?  Why should we treat
them as cross origin?
&gt; 
&gt; Reading the spec, it seems saying nothing about the structure of frames or
parent-child relationship.
&gt; 
&gt; <a href="https://html.spec.whatwg.org/multipage/browsers.html#concept-origin" rel="nofollow">https://html.spec.whatwg.org/multipage/browsers.html#concept-origin</a>
&gt; ----
&gt; For Document objects,
&gt;   If the Document&#39;s address&#39;s scheme is a network scheme
&gt;     A copy of the Document&#39;s address&#39;s origin.
&gt; 
&gt; Two origins, A and B, are said to be same origin if the following algorithm
returns true:
&gt;   2. If A and B are both tuple origins and their schemes, hosts, and port are
identical, then return true.
&gt; ----
&gt; 
&gt; Then, both of b.com subframes are same origin, aren&#39;t they?

They are same origin... but due to the underlying details of how we allocate
frames to processes, it&#39;s quite easy to end up with cases where we have same
origin frames in a &quot;unit of related browsing contexts&quot; that are hosted in
different processes.

If we allow these frames to pass the security checks for each other, then they
should be able to synchronously script each other and access properties like
window.document, but they cannot, because the other frame is cross-process.
Thus, we must fail the security checks and treat them as if they were
cross-process.

For what it&#39;s worth, this isn&#39;t a new problem: it&#39;s just that this was not
exposed before, due to the swappedout:// abstraction we used to use. Rather than
using an actual RemoteFrame and mirroring the entire frame tree structure, we
would navigate a LocalFrame to a special URL called swappedout://. Since the
frame tree wasn&#39;t replicated, it wasn&#39;t possible for these subframes to reach
each other previously. We removed the swappedout:// abstraction in M49,
switching to RemoteFrame, which exposed this bug.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          Also, it looks like this is failing an assert so I need to figure out ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:18:31 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >Also, it looks like this is failing an assert so I need to figure out what&#39;s
going on. I&#39;ll upload a new patch in a bit.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          Thanks for the quick fix! Some nits on the test. Also, it looks like we&#39;re ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:18:33 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >Thanks for the quick fix!

Some nits on the test.  Also, it looks like we&#39;re still crashing?

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2622" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2622: //
When two frames are same-origin but cross-process; they should behave as if
nit: Comma rather than semicolon.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2635" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2635:
EXPECT_TRUE(orig_site_instance.get() != NULL);
nit: nullptr

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2653" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2653: //
Clear the opener.
This block is unnecessary, given how the test works.

It only matters when doing a window.open() (to about:blank) and then doing a
renderer-initiated cross-site navigation.  Instead, this test is doing a
browser-initiated cross-site navigation on line 2662, which will go cross
process whether the opener is null or not.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2661" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2661: // Do
a cross-site navigation that winds up same-site
nit: End with period, and mention that it ends up in a different process.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2667" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2667: // Now
navigate the new tab to a different site.
Looks like a stale comment?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc File content/browser/frame_host/render_frame_host_manager_browsertest.cc (right): https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2622 content/browser/frame_host/render_frame_host_manager_browsertest.cc:2622: // When two frames are same-origin but cross-process; they ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:33:30 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            ><a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2622" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2622: //
When two frames are same-origin but cross-process; they should behave as if
On 2016/04/13 at 06:18:32, Charlie Reis wrote:
&gt; nit: Comma rather than semicolon.

Done.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2635" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2635:
EXPECT_TRUE(orig_site_instance.get() != NULL);
On 2016/04/13 at 06:18:33, Charlie Reis wrote:
&gt; nit: nullptr

Changed this EXPECT_NE as well.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2661" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2661: // Do
a cross-site navigation that winds up same-site
On 2016/04/13 at 06:18:33, Charlie Reis wrote:
&gt; nit: End with period, and mention that it ends up in a different process.

Done.

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2667" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2667: // Now
navigate the new tab to a different site.
On 2016/04/13 at 06:18:33, Charlie Reis wrote:
&gt; Looks like a stale comment?

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc File content/browser/frame_host/render_frame_host_manager_browsertest.cc (right): https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2653 content/browser/frame_host/render_frame_host_manager_browsertest.cc:2653: // Clear the opener. On 2016/04/13 at 06:18:33, Charlie ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:33:49 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            ><a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2653" rel="nofollow">https://codereview.chromium.org/1887553002/diff/20001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2653: //
Clear the opener.
On 2016/04/13 at 06:18:33, Charlie Reis wrote:
&gt; This block is unnecessary, given how the test works.
&gt; 
&gt; It only matters when doing a window.open() (to about:blank) and then doing a
renderer-initiated cross-site navigation.  Instead, this test is doing a
browser-initiated cross-site navigation on line 2662, which will go cross
process whether the opener is null or not.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          esprehn@chromium.org changed reviewers: + esprehn@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:45:54 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a> changed reviewers:
+ <a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          Doesn&#39;t this break the web if those are RemoteFrames? I&#39;m pretty sure you can reach ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 06:45:55 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >Doesn&#39;t this break the web if those are RemoteFrames? I&#39;m pretty sure you can
reach across the frame tree of the opened window to get to the other b.com
subframe.

Why are there RemoteFrame instances when OOPIF is disabled?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Yuki</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          Thanks for the explanation and adding comments. Since this is a workaround to avoid crashes ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 07:08:12 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >Thanks for the explanation and adding comments.  Since this is a workaround to
avoid crashes and not a true fix (ideally we should allow the same-origin
inter-frame communication), I think it&#39;d be better to put TODO comments.

LGTM.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          On 2016/04/13 at 06:45:55, esprehn wrote: &gt; Doesn&#39;t this break the web if those are ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 07:59:57 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >On 2016/04/13 at 06:45:55, esprehn wrote:
&gt; Doesn&#39;t this break the web if those are RemoteFrames? I&#39;m pretty sure you can
reach across the frame tree of the opened window to get to the other b.com
subframe.
&gt; 

Yes. But it&#39;s also worth noting that this case has never worked in Chrome.

&gt; Why are there RemoteFrame instances when OOPIF is disabled?

There have always been instances where we swap processes on navigation. Until we
developed OOPIF, we used a different idiom to implement it completely in the
embedder, so WebKit/Blink had no knowledge of it. It used a placeholder page
called swappedout:// to represent the concept of a remote frame. Blink provided
some basic hooks that the embedder could override to make things appear to work:
for example, to intercept things like postMessage and deliver it to the actual
process hosting the window.

┌───────────── PROCESS 1 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││    a.com    │------&gt;│    a.com    ││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘

and after a cross-process navigation, it&#39;d look like this:

┌───────────── PROCESS 1 ─────────────┐    ┌───────────── PROCESS 2
─────────────┐
│┌─────────────┐       ┌─────────────┐│    │┌─────────────┐      
┌─────────────┐│
││    a.com    │------&gt;│swappedout://││    ││swappedout://│------&gt;│    b.com   
││
│└─────────────┘ opens └─────────────┘│    │└─────────────┘ opens
└─────────────┘│
└─────────────────────────────────────┘   
└─────────────────────────────────────┘

Of particular note here: there was no frame tree replication between [PROCESS 1]
and [PROCESS 2], so a.com would never see any subframes in b.com, and similarly,
b.com would never see any subframes in a.com.

When we added OOPIF, we ended up having two ways of representing a window that
is in another process: the legacy swappedout:// idiom and the new RemoteFrame
idiom. This led to quite a bit of complexity in the embedder to support both
idioms. In M49, we removed the old swappedout:// code path and replaced it with
the new RemoteFrame code path, so it now the cross-process navigation case looks
like this:

┌───────────── PROCESS 1 ─────────────┐    ┌───────────── PROCESS 2
─────────────┐
│┌─────────────┐       ┌─────────────┐│    │┌─────────────┐      
┌─────────────┐│
││    a.com    │------&gt;│ b.com remote││    ││ a.com remote│------&gt;│    b.com   
││
│└─────────────┘ opens └─────────────┘│    │└─────────────┘ opens
└─────────────┘│
└─────────────────────────────────────┘   
└─────────────────────────────────────┘

Since OOPIF replicates frame trees, this means that subframes in a.com and b.com
are now visible to each other, even across the process separation.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          On 2016/04/13 at 07:59:57, dcheng wrote: &gt; On 2016/04/13 at 06:45:55, esprehn wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 08:02:58 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >On 2016/04/13 at 07:59:57, dcheng wrote:
&gt; On 2016/04/13 at 06:45:55, esprehn wrote:
&gt; &gt; Doesn&#39;t this break the web if those are RemoteFrames? I&#39;m pretty sure you
can reach across the frame tree of the opened window to get to the other b.com
subframe.
&gt; &gt; 
&gt; 
&gt; Yes. But it&#39;s also worth noting that this case has never worked in Chrome.
&gt; 
&gt; &gt; Why are there RemoteFrame instances when OOPIF is disabled?
&gt; 
&gt; There have always been instances where we swap processes on navigation. Until
we developed OOPIF, we used a different idiom to implement it completely in the
embedder, so WebKit/Blink had no knowledge of it. It used a placeholder page
called swappedout:// to represent the concept of a remote frame. Blink provided
some basic hooks that the embedder could override to make things appear to work:
for example, to intercept things like postMessage and deliver it to the actual
process hosting the window.
&gt; 
&gt; ┌───────────── PROCESS 1 ─────────────┐
&gt; │┌─────────────┐       ┌─────────────┐│
&gt; ││    a.com    │------&gt;│    a.com    ││
&gt; │└─────────────┘ opens └─────────────┘│
&gt; └─────────────────────────────────────┘
&gt; 
&gt; and after a cross-process navigation, it&#39;d look like this:
&gt; 
&gt; ┌───────────── PROCESS 1 ─────────────┐    ┌───────────── PROCESS 2
─────────────┐
&gt; │┌─────────────┐       ┌─────────────┐│    │┌─────────────┐      
┌─────────────┐│
&gt; ││    a.com    │------&gt;│swappedout://││    ││swappedout://│------&gt;│    b.com  
 ││
&gt; │└─────────────┘ opens └─────────────┘│    │└─────────────┘ opens
└─────────────┘│
&gt; └─────────────────────────────────────┘   
└─────────────────────────────────────┘
&gt; 
&gt; Of particular note here: there was no frame tree replication between [PROCESS
1] and [PROCESS 2], so a.com would never see any subframes in b.com, and
similarly, b.com would never see any subframes in a.com.
&gt; 
&gt; When we added OOPIF, we ended up having two ways of representing a window that
is in another process: the legacy swappedout:// idiom and the new RemoteFrame
idiom. This led to quite a bit of complexity in the embedder to support both
idioms. In M49, we removed the old swappedout:// code path and replaced it with
the new RemoteFrame code path, so it now the cross-process navigation case looks
like this:
&gt; 
&gt; ┌───────────── PROCESS 1 ─────────────┐    ┌───────────── PROCESS 2
─────────────┐
&gt; │┌─────────────┐       ┌─────────────┐│    │┌─────────────┐      
┌─────────────┐│
&gt; ││    a.com    │------&gt;│ b.com remote││    ││ a.com remote│------&gt;│    b.com  
 ││
&gt; │└─────────────┘ opens └─────────────┘│    │└─────────────┘ opens
└─────────────┘│
&gt; └─────────────────────────────────────┘   
└─────────────────────────────────────┘
&gt; 
&gt; Since OOPIF replicates frame trees, this means that subframes in a.com and
b.com are now visible to each other, even across the process separation.

Rewrapped to make it slightly more readable in the deprecated UI:

┌───────────── PROCESS 1 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││    a.com    │------&gt;│    a.com    ││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘

and after a cross-process navigation, it&#39;d look like this with the old way,
using swappedout://

┌───────────── PROCESS 1 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││    a.com    │------&gt;│swappedout://││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘
┌───────────── PROCESS 2 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││swappedout://│------&gt;│    a.com    ││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘

New way, with RemoteFrame:

┌───────────── PROCESS 1 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││    a.com    │------&gt;│b.com remote ││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘
┌───────────── PROCESS 2 ─────────────┐
│┌─────────────┐       ┌─────────────┐│
││a.com remote │------&gt;│    a.com    ││
│└─────────────┘ opens └─────────────┘│
└─────────────────────────────────────┘</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          On 2016/04/13 06:45:55, esprehn wrote: &gt; Doesn&#39;t this break the web if those are RemoteFrames? ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 16:45:57 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            >On 2016/04/13 06:45:55, esprehn wrote:
&gt; Doesn&#39;t this break the web if those are RemoteFrames? I&#39;m pretty sure you can
&gt; reach across the frame tree of the opened window to get to the other b.com
&gt; subframe.
&gt; 
&gt; Why are there RemoteFrame instances when OOPIF is disabled?

Daniel&#39;s answer is correct, but this also applies to main frames, as the test
shows.

Since Chrome launched, we&#39;ve made browser-initiated cross-site navigations go
cross-process, but renderer-initiated cross-site navigations usually don&#39;t. 
This was to preserve compatibility in cases that a cross-site iframe opens a
popup (e.g., OAuth), etc.  It&#39;s explained in the following doc and paper:
<a href="https://www.chromium.org/developers/design-documents/process-models" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models</a>
<a href="http://www.charlesreis.com/research/publications/eurosys-2009.pdf" rel="nofollow">http://www.charlesreis.com/research/publications/eurosys-2009.pdf</a>

As a result, you could have two windows on site A, go cross-process in the
second one to site B (by typing in the omnibox), and then click a link in both
to site C.  They&#39;ll be same-site but different processes.  Yes, this breaks a
possible script relationship, but it&#39;s unlikely to matter in practice relative
to the OAuth case.  (We decided it was a good tradeoff because the user
initiated the navigation to B, basically leaving the previous context behind. 
You can almost view that as creating a new unit of related browsing contexts /
BrowsingInstance.  Maybe we can formalize that concept.)

As Daniel mentions, this wasn&#39;t a problem to Blink before RemoteFrames, because
the origin of the cross-process window looked like swappedout://.  With
RemoteFrames, we replicate the origin and it looks like it should pass the
check.

Full --site-per-process mode would eliminate this possibility, but most
realistic modes (even those with OOPIFs) still have it.  It&#39;s worth noting that
TDI actually depends on this ability a bit more to avoid process inversions
(where main frames would frequently end up in the subframe process).

(Note: I&#39;ll post this explanation to the bug as well.)

<a href="https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2677" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2677:
&quot;accessing a cross-origin frame.&quot;));
Note: We won&#39;t get the security error in --site-per-process, right?  In that
case, the frame always ends up in the correct process.  I would suggest skipping
this check if AreAllSitesIsolatedForTesting() returns true (or maybe checking
for the correct result).

<a href="https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp (right):

<a href="https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp#newcode56" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp:56: // processes.
See <a href="https://crbug.com/601629" rel="nofollow">https://crbug.com/601629</a>
nit: End with period, here and below (as you did in DOMWindow).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          &gt; &gt; Why are there RemoteFrame instances when OOPIF is disabled? &gt; Daniel&#39;s answer is ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 17:13:01 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >&gt; &gt; Why are there RemoteFrame instances when OOPIF is disabled?

&gt; Daniel&#39;s answer is correct, but this also applies to main frames, as the test
shows.

FWIW, if you can think of a more concise way to explain this, I think it&#39;d be
nice to add to the CL description. I mainly focused on the subframe case, since
that was easier to explain without writing a novel. =)

<a href="https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2677" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2677:
&quot;accessing a cross-origin frame.&quot;));
On 2016/04/13 at 16:45:56, Charlie Reis wrote:
&gt; Note: We won&#39;t get the security error in --site-per-process, right?  In that
case, the frame always ends up in the correct process.  I would suggest skipping
this check if AreAllSitesIsolatedForTesting() returns true (or maybe checking
for the correct result).

Done.

<a href="https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp (right):

<a href="https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp#newcode56" rel="nofollow">https://codereview.chromium.org/1887553002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/bindings/core/v8/BindingSecurity.cpp:56: // processes.
See <a href="https://crbug.com/601629" rel="nofollow">https://crbug.com/601629</a>
On 2016/04/13 at 16:45:56, Charlie Reis wrote:
&gt; nit: End with period, here and below (as you did in DOMWindow).

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          On 2016/04/13 17:13:01, dcheng wrote: &gt; FWIW, if you can think of a more concise ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 17:43:25 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >On 2016/04/13 17:13:01, dcheng wrote:
&gt; FWIW, if you can think of a more concise way to explain this, I think it&#39;d be
&gt; nice to add to the CL description. I mainly focused on the subframe case,
since
&gt; that was easier to explain without writing a novel. =)

The subframe case is intuitive, but Elliot&#39;s right that we don&#39;t have
RemoteFrames for subframes in default Chrome.  I think the two b.com subframes
just can&#39;t find each other in your example.  (Confirmed by testing-- we don&#39;t
crash there.)

Might I suggest:

1. Navigate to a.com.
2. a.com opens a new window.
3. Navigate the new window to b.com via the omnibox.
4. Click a link in both windows to c.com.

Because browser-initiated navigations go cross-process but renderer-initiated
navigations do not (see
<a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>),
the two c.com windows will end up in different processes.

Both windows have the same origin but see each other as RemoteFrames. This means
that the access check will pass… but this ends up violating many assumptions in
blink that passing the security check implies a local frame.

<a href="https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2666" rel="nofollow">https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2666: //
SecurityError.
nit: , unless we&#39;re in --site-per-process mode.

(Or just move this comment into the else branch below.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          &gt; The subframe case is intuitive, but Elliot&#39;s right that we don&#39;t have RemoteFrames for ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:07:04 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >&gt; The subframe case is intuitive, but Elliot&#39;s right that we don&#39;t have
RemoteFrames for subframes in default Chrome.  I think the two b.com subframes
just can&#39;t find each other in your example.  (Confirmed by testing-- we don&#39;t
crash there.)

The current explanation should still be accurate in default Chrome. We still
mirror frame trees, and thus, RemoteFrames are still involved (for main frames
and subframes).

<a href="https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2666" rel="nofollow">https://codereview.chromium.org/1887553002/diff/50004/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2666: //
SecurityError.
On 2016/04/13 at 17:43:25, Charlie Reis wrote:
&gt; nit: , unless we&#39;re in --site-per-process mode.
&gt; 
&gt; (Or just move this comment into the else branch below.)

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:16:26 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold.

1. Navigate to a.com, which has a b.com subframe.
2. a.com opens a new window.
3. Navigate the new window to c.com, with a b.com subframe.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will pass… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1] the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames. This means
that the access check will pass… but this ends up violating many assumptions in
blink that passing the security check implies a local frame.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will pass… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:21:10 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is never that simple. There are
several instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1] the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames. This means
that the access check will pass… but this ends up violating many assumptions in
blink that passing the security check implies a local frame.

When OOPIF is disabled, both subframes are in the same process as
their respective main frames. However, both subframes have the origin
b.com! This means that the access check will pass… but this ends up
violating many assumptions in blink that passing the security check
implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is not that simple. There are several
instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1], the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames.
This means that SecurityOrigin&#39;s canAccess check will pass… but this
ends up violating many assumptions in Blink that passing the security
check implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          Updated the comment: in fact, we don&#39;t currently replicate the frame tree in default Chrome ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:21:59 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-27"
            >Updated the comment: in fact, we don&#39;t currently replicate the frame tree in
default Chrome (and probably won&#39;t do so until we reduce memory usage for remote
v8 contexts).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Charlie Reis</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          Thanks! content/ and CL description LGTM.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:25:28 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-28"
            >Thanks!  content/ and CL description LGTM.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-29">
                          nick@chromium.org changed reviewers: + nick@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:29:16 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-29"
            ><a href="mailto:nick@chromium.org">nick@chromium.org</a> changed reviewers:
+ <a href="mailto:nick@chromium.org">nick@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg31"
           name="30">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(30)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>ncarter (slow)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-30">
                          lgtm https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc File content/browser/frame_host/render_frame_host_manager_browsertest.cc (right): https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2688 content/browser/frame_host/render_frame_host_manager_browsertest.cc:2688: } The test looks good. There is some ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 18:29:17 UTC)
                <a href="#msg31">#31</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-30"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-30"
            >lgtm

<a href="https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2688" rel="nofollow">https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2688: }
The test looks good.

There is some risk that as our oopif logic evolves, this test gets updated and
stops exercising the interesting case, since the conditions that cause RFHM to
produce this situation are a combination of bugs (as in the blob case),
heuristics (as in tdi), and policies (no oopifs in default chrome).

Hopefully we&#39;ll remember to avoid that, but I wonder: if it&#39;s possible to set up
a blink unittest test that creates a local and a remote frame with the same
origin, might that be worthwhile too, since it would be less brittle?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg32"
           name="31">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(31)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-31">
                          lgtm
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 19:42:23 UTC)
                <a href="#msg32">#32</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-31"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-31"
            >lgtm</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg33"
           name="32">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(32)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-32">
                          The CQ bit was checked by dcheng@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 19:43:17 UTC)
                <a href="#msg33">#33</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-32"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-32"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg34"
           name="33">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(33)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-33">
                          The patchset sent to the CQ was uploaded after l-g-t-m from haraken@chromium.org, yukishiino@chromium.org Link to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 19:43:17 UTC)
                <a href="#msg34">#34</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-33"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-33"
            >The patchset sent to the CQ was uploaded after l-g-t-m from
<a href="mailto:haraken@chromium.org">haraken@chromium.org</a>, <a href="mailto:yukishiino@chromium.org">yukishiino@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1887553002/#ps60001" rel="nofollow">https://codereview.chromium.org/1887553002/#ps60001</a>
(title: &quot;.&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg35"
           name="34">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(34)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-34">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1887553002/60001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1887553002/60001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 19:43:38 UTC)
                <a href="#msg35">#35</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-34"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-34"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1887553002/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1887553002/60001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1887553002/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1887553002/60001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg36"
           name="35">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(35)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-35">
                          https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc File content/browser/frame_host/render_frame_host_manager_browsertest.cc (right): https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2688 content/browser/frame_host/render_frame_host_manager_browsertest.cc:2688: } On 2016/04/13 at 18:29:17, ncarter wrote: &gt; The ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 19:44:58 UTC)
                <a href="#msg36">#36</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-35"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-35"
            ><a href="https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc" rel="nofollow">https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_h...</a>
File content/browser/frame_host/render_frame_host_manager_browsertest.cc
(right):

<a href="https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_host/render_frame_host_manager_browsertest.cc#newcode2688" rel="nofollow">https://codereview.chromium.org/1887553002/diff/60001/content/browser/frame_h...</a>
content/browser/frame_host/render_frame_host_manager_browsertest.cc:2688: }
On 2016/04/13 at 18:29:17, ncarter wrote:
&gt; The test looks good.
&gt; 
&gt; There is some risk that as our oopif logic evolves, this test gets updated and
stops exercising the interesting case, since the conditions that cause RFHM to
produce this situation are a combination of bugs (as in the blob case),
heuristics (as in tdi), and policies (no oopifs in default chrome).
&gt; 
&gt; Hopefully we&#39;ll remember to avoid that, but I wonder: if it&#39;s possible to set
up a blink unittest test that creates a local and a remote frame with the same
origin, might that be worthwhile too, since it would be less brittle?

Oops, forgot to reply to this comment.

We could, but since this behavior is ultimately controlled wholly by the
embedder, I&#39;d prefer to keep the test there, so we don&#39;t end up with unit tests
in Blink that exercise states that the embedder will never actually reach.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg37"
           name="36">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(36)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-36">
                          Committed patchset #5 (id:60001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 21:08:30 UTC)
                <a href="#msg37">#37</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-36"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-36"
            >Committed patchset #5 (id:60001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg38"
           name="37">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(37)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-37">
                          Description was changed from ========== Make sure binding security checks don&#39;t pass if the frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 21:11:31 UTC)
                <a href="#msg38">#38</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-37"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-37"
            >Description was changed from

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is not that simple. There are several
instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1], the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames.
This means that SecurityOrigin&#39;s canAccess check will pass… but this
ends up violating many assumptions in Blink that passing the security
check implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation
==========

to

==========
Make sure binding security checks don&#39;t pass if the frame is remote.

Blink assumes that remote frames will always fail the security origin
check. Unfortunately, reality is not that simple. There are several
instances where this assumption fails to hold. For example:

  1. Navigate to a.com.
  2. a.com opens a new window.
  3. Navigate the new window to b.com via the omnibox.
  4. Click a link to c.com in both windows.

Because browser-initiated navigations go cross-process but
renderer-initiated navigations do not [1], the two c.com windows will
end up in different renderer processes.

Both windows have the same origin but see each other as RemoteFrames.
This means that SecurityOrigin&#39;s canAccess check will pass… but this
ends up violating many assumptions in Blink that passing the security
check implies a local frame.

[1] <a href="https://www.chromium.org/developers/design-documents/process-models#Caveats" rel="nofollow">https://www.chromium.org/developers/design-documents/process-models#Caveats</a>

BUG=601629
CQ_INCLUDE_TRYBOTS=tryserver.chromium.linux:linux_site_isolation

Committed: <a href="https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e" rel="nofollow">https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e</a>
Cr-Commit-Position: refs/heads/master@{#387087}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg39"
           name="38">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(38)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-38">
                          Patchset 5 (id:??) landed as https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e Cr-Commit-Position: refs/heads/master@{#387087}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 8 months ago
		(2016-04-13 21:11:33 UTC)
                <a href="#msg39">#39</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-38"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-38"
            >Patchset 5 (id:??) landed as
<a href="https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e" rel="nofollow">https://crrev.com/f23b8e77a83a5aafabf64acf723cf2ac02c5cf0e</a>
Cr-Commit-Position: refs/heads/master@{#387087}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 39)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 39)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(39)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(39)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 39;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1887553002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1887553002: Make sure binding security checks don&#39;t pass if the frame is remote.
     (Closed) </b><br/>
      Created 4 years, 8 months ago by dcheng<br/>
      Modified 4 years, 8 months ago<br/>
      Reviewers: Charlie Reis, esprehn, haraken, ncarter (slow), Yuki<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 19
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
