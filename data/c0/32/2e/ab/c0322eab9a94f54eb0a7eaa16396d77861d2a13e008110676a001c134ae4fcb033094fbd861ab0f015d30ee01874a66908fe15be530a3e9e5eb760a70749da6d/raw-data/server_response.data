<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/nova/+bug/1492961/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1492961 “Security Group Rules not effective immediately” : Bugs : OpenStack Compute (nova)</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1492961" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1492961/bug.atom" title="Bug 1492961 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="Exact version of Nova/OpenStack you are running:

devstack@dev0:~/devstack$ git log -1
commit 28247f3511b2eedfc740cf822f04dc8cb1ae7b08
Merge: 9d113a2 03a19bc
Author: Jenkins &lt;...&gt;
Date:   Fri Jul 31 20:12:34 2015 +0000

    Merge &quot;ceilometer: add tempest option to test events&quot; into stable/kilo
devstack@dev0:~/devstack$ cd -
/opt/stack/nova
devstack@dev0:/opt/stack/nova$ git log -1
commit 90e1eacee8da05bed2b061b8df5fc4fbf5057bb2
Author: Alan Pevec &lt;...&gt;
Date:   Tue Jul 28 21:25:51 2015 +0200

..." />
      <meta property="og:description" content="Exact version of Nova/OpenStack you are running:

devstack@dev0:~/devstack$ git log -1
commit 28247f3511b2eedfc740cf822f04dc8cb1ae7b08
Merge: 9d113a2 03a19bc
Author: Jenkins &lt;...&gt;
Date:   Fri Jul 31 20:12:34 2015 +0000

    Merge &quot;ceilometer: add tempest option to test events&quot; into stable/kilo
devstack@dev0:~/devstack$ cd -
/opt/stack/nova
devstack@dev0:/opt/stack/nova$ git log -1
commit 90e1eacee8da05bed2b061b8df5fc4fbf5057bb2
Author: Alan Pevec &lt;...&gt;
Date:   Tue Jul 28 21:25:51 2015 +0200

..." />
    

    
    
      <meta property="og:title" content="Bug #1492961 “Security Group Rules not effective immediately” : Bugs : OpenStack Compute (nova)" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1492961" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["api", "api-ref", "availability-zones", "cells", "ceph", "cinder", "compute", "conductor", "config", "console", "cyborg", "db", "doc", "ec2", "evacuate", "fault-injection", "gate-failure", "glance", "hyper-v", "i18n", "image-cache", "in-stable-liberty", "in-stable-newton", "in-stable-ocata", "ironic", "kilo-backport-potential", "liberty-backport-potential", "libvirt", "live-migration", "low-hanging-fruit", "lxc", "metadata", "mitaka-backport-potential", "needs-attention", "needs-functional-test", "needs.openstack-version", "network", "neutron", "newton-backport-potential", "nfs", "notifications", "nova-manage", "nova-network", "numa", "ocata-backport-potential", "openstack-version.grizzly", "openstack-version.havana", "openstack-version.icehouse", "openstack-version.juno", "openstack-version.kilo", "openstack-version.liberty", "openstack-version.mitaka", "openstack-version.newton", "openstack-version.ocata", "openstack-version.pike", "ops", "oslo", "pci", "performance", "pike-backport-potential", "placement", "policy", "postgresql", "powervm", "privsep", "queens-backport-potential", "quotas", "race-condition", "reboot", "rebuild", "rescue", "resize", "resource-tracker", "rootwrap", "s390x", "scheduler", "security", "security-groups", "serviceability", "shared-storage", "shelve", "snapshot", "stacktrace", "stein-rc-potential", "testing", "train-rc-potential", "unified-objects", "upgrade", "ussuri-backport-potential", "ussuri-rc-potential", "vgpu", "victoria-rc-potential", "vmware", "volumes", "wallaby-rc-potential", "xen", "xena-rc-potential", "xenserver", "zvm"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/nova/+bug/1492961/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/nova"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/324577028/nova64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/nova">OpenStack Compute (nova)</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/nova">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/nova">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/nova">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/nova">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/nova">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/nova">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    Security Group Rules not effective immediately
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1492961 reported by
      <a href="https://launchpad.net/~sreesiv" class="sprite person">Sreekumar S</a>
      <time title="2015-09-07 08:47:40 UTC" datetime="2015-09-07T08:47:40.549710+00:00">on 2015-09-07</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          

          
          <span class="bug-duplicate-details ellipsis single-line wide">
            <span class="sprite info"></span>
            This bug report is a duplicate of:&nbsp;
                <a href="/bugs/1491307" id="duplicate-of-warning-link-bugtasks" title="[OSSA 2015-021] secgroup rules doesn't work for instance immediately (CVE-2015-7713)">Bug #1491307: [OSSA 2015-021] secgroup rules doesn't work for instance immediately (CVE-2015-7713).</a>
          </span>
          
          

          <a id="change-duplicate-bug-bugtasks" href="+duplicate" title="Edit or remove linked duplicate bug" class="sprite edit action-icon standalone change-duplicate-bug">Edit</a>
          <a id="remove-duplicate-bug-bugtasks" href="+duplicate" title="Remove linked duplicate bug" class="sprite remove action-icon standalone remove-duplicate-bug">Remove</a>
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">260</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 2 people</span>
    </div>
  



    <table id="affected-software" class="duplicate listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary1901755">
    <td>
      
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1901755">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/nova">OpenStack Compute (nova)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/nova/+bug/1492961/+editstatus" style="float: left" class="value statusNEW">New</a>
          <a href="https://bugs.launchpad.net/nova/+bug/1492961/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1901755">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~sreesiv">Sreekumar S</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/nova/+bug/1492961/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>Exact version of Nova/OpenStack you are running:</p>
<p>devstack@<wbr />dev0:~/<wbr />devstack$ git log -1<br />
commit 28247f3511b2eed<wbr />fc740cf822f04dc<wbr />8cb1ae7b08<br />
Merge: 9d113a2 03a19bc<br />
Author: Jenkins &lt;email address hidden&gt;<br />
Date:   Fri Jul 31 20:12:34 2015 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Merge &quot;ceilometer: add tempest option to test events&quot; into stable/kilo<br />
devstack@<wbr />dev0:~/<wbr />devstack$ cd -<br />
/opt/stack/nova<br />
devstack@<wbr />dev0:/opt/<wbr />stack/nova$ git log -1<br />
commit 90e1eacee8da05b<wbr />ed2b061b8df5fc4<wbr />fbf5057bb2<br />
Author: Alan Pevec &lt;email address hidden&gt;<br />
Date:   Tue Jul 28 21:25:51 2015 +0200</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Bump stable/kilo next version to 2015.1.2</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I180de9d4f1f4ae<wbr />385682ce40a3a69<wbr />5eb3acc4c43<br />
devstack@<wbr />dev0:/opt/<wbr />stack/nova$</p>
<p>Summary:<br />
After editing sec group to add/remove rules, those changes are not reflected on the instances immediately. The changes take effect only after one of the instance&#x27;s security group is removed and added back. Once this is done, all the instances where the particular security group is associated is updated with the new rules. Now the iptables routing rules get updated as well.</p>
<p>Reproduce steps (CLI):<br />
-- ./stack.sh with nova-network configured.<br />
-- Once the services are running, and horizon starts responding; Launch 2 instances from Horizon.<br />
&nbsp;&nbsp;&nbsp;These instances will have default sec group associated to them<br />
-- Associate Floating IP to both of these instances...<br />
devstack@<wbr />dev0:~/<wbr />devstack$ nova list<br />
+------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+--<wbr />-----+-<wbr />-------<wbr />+------<wbr />------+<wbr />-------<wbr />------+<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+<br />
| ID                                   | Name  | Status | Task State | Power State | Networks                       |<br />
+------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+--<wbr />-----+-<wbr />-------<wbr />+------<wbr />------+<wbr />-------<wbr />------+<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+<br />
| 7cf44867-<wbr />42f4-44de-<wbr />aba5-019113d526<wbr />12 | test0 | ACTIVE | -          | Running     | private=172.31.1.2, 10.0.2.249 |<br />
| 0696c57e-<wbr />7704-4d51-<wbr />a3f2-6270499460<wbr />52 | test1 | ACTIVE | -          | Running     | private=172.31.1.3, 10.0.2.250 |<br />
+------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+--<wbr />-----+-<wbr />-------<wbr />+------<wbr />------+<wbr />-------<wbr />------+<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />----+</p>
<p>-- From another node on the external network ping both the node on the FIPs. Ping will not go through...<br />
-- Allow ICMP from all IPs...<br />
devstack@<wbr />dev0:~/<wbr />devstack$ nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+<br />
| IP Protocol | From Port | To Port | IP Range  | Source Group |<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+<br />
| icmp        | -1        | -1      | 0.0.0.0/0 |              |<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+<br />
devstack@<wbr />dev0:~/<wbr />devstack$ nova secgroup-list-rules 1<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+<br />
| IP Protocol | From Port | To Port | IP Range  | Source Group |<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+<br />
| icmp        | -1        | -1      | 0.0.0.0/0 |              |<br />
+------<wbr />-------<wbr />+------<wbr />-----+-<wbr />-------<wbr />-+-----<wbr />------+<wbr />-------<wbr />-------<wbr />+</p>
<p>-- Ping again, still will not go through!!!</p>
<p>-- Remove the default group from one of the instances... Now the other node will start pinging, because now the new rule is applied to all instances.<br />
nova remove-secgroup &quot;0696c57e-<wbr />7704-4d51-<wbr />a3f2-6270499460<wbr />52&quot; default</p>
<p>-- Add  back the the default group to the instance, whose sec group was removed in the first place. Now that node starts pinging as well.<br />
nova add-secgroup &quot;0696c57e-<wbr />7704-4d51-<wbr />a3f2-6270499460<wbr />52&quot; default</p>
<p>-- Same is the case with deletion of rules from sec group as well. Once you delete the ping allow rule, it will still allow pings until &#x27;one of the instances is re-associated&#x27; with the sec group. This seems quite dangerous!!!</p>
<p>This bug is seen with both the CLI and Horizon Webapp with devstack running nova-network. I haven&#x27;t checked the issue with nova-network on a multi node setup, although it should most probably be there as well.<br />
&nbsp;&nbsp;&nbsp;&nbsp;But I do have checked whether the same issue happens with neutron, in both devstack, and a 3 node (controller, network, compute1) setup as mentioned in the official installation guide for Kilo. In neutron the rules are immediately reflected.</p>
<p>Expected result: The new rules should be updated in iptables immediately after the sec group rules are modified and saved. All the instances associated to a sec group should immediately get affected by a rule change in that group. The admin/user need not have to manually detach and reattach the sec group to the instance.</p>
<p>Actual result: The modified rules don&#x27;t immediately take effect.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="official-tag" href="/nova/+bugs?field.tag=network">network</a>
            <a class="official-tag" href="/nova/+bugs?field.tag=security">security</a>
          </span>
          
          <a href="+edit" title="Edit tags" id="tags-trigger" class="sprite edit action-icon">Edit</a>
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~sreesiv" class="sprite person">Sreekumar S (sreesiv)</a>
    
    <time title="2015-09-07 08:52:58 UTC" datetime="2015-09-07T08:52:58.435982+00:00">on 2015-09-07</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in nova: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Sreekumar S (sreesiv)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~sreesiv" class="sprite person">Sreekumar S (sreesiv)</a>
    
    <time title="2015-09-07 09:20:42 UTC" datetime="2015-09-07T09:20:42.238466+00:00">on 2015-09-07</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/nova/+bug/1492961/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/nova/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/nova/+bug/1492961/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    
    
      <li class="bug-duplicate-details"><a id="change-duplicate-bug" title="Edit or remove linked duplicate bug" class="sprite edit change-duplicate-bug" href="https://bugs.launchpad.net/nova/+bug/1492961/+duplicate"></a>
      <span id="mark-duplicate-text">Duplicate of
        
          
            <a href="/bugs/1491307" id="duplicate-of" style="margin-right: 4px" title="[OSSA 2015-021] secgroup rules doesn't work for instance immediately (CVE-2015-7713)">bug #1491307</a>
            
          

          
        
      </span>


      <a id="remove-duplicate-bug" href="+duplicate" title="Remove linked duplicate bug" class="sprite remove action-icon remove-duplicate-bug" style="float: right;">Remove</a>

      </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/nova/+bug/1492961/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/nova/+bug/1492961/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/nova/+bug/1492961/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  
  


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"bug_is_private": false, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1492961", "web_link": "https://bugs.launchpad.net/bugs/1492961", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1492961, "private": false, "information_type": "Public Security", "name": null, "title": "Security Group Rules not effective immediately", "description": "Exact version of Nova/OpenStack you are running:\n\ndevstack@dev0:~/devstack$ git log -1\ncommit 28247f3511b2eedfc740cf822f04dc8cb1ae7b08\nMerge: 9d113a2 03a19bc\nAuthor: Jenkins \u003cemail address hidden\u003e\nDate:   Fri Jul 31 20:12:34 2015 +0000\n\n    Merge \"ceilometer: add tempest option to test events\" into stable/kilo\ndevstack@dev0:~/devstack$ cd -\n/opt/stack/nova\ndevstack@dev0:/opt/stack/nova$ git log -1\ncommit 90e1eacee8da05bed2b061b8df5fc4fbf5057bb2\nAuthor: Alan Pevec \u003cemail address hidden\u003e\nDate:   Tue Jul 28 21:25:51 2015 +0200\n\n    Bump stable/kilo next version to 2015.1.2\n\n    Change-Id: I180de9d4f1f4ae385682ce40a3a695eb3acc4c43\ndevstack@dev0:/opt/stack/nova$\n\nSummary:\nAfter editing sec group to add/remove rules, those changes are not reflected on the instances immediately. The changes take effect only after one of the instance's security group is removed and added back. Once this is done, all the instances where the particular security group is associated is updated with the new rules. Now the iptables routing rules get updated as well.\n\nReproduce steps (CLI):\n-- ./stack.sh with nova-network configured.\n-- Once the services are running, and horizon starts responding; Launch 2 instances from Horizon. \n   These instances will have default sec group associated to them\n-- Associate Floating IP to both of these instances...\ndevstack@dev0:~/devstack$ nova list\n+--------------------------------------+-------+--------+------------+-------------+--------------------------------+\n| ID                                   | Name  | Status | Task State | Power State | Networks                       |\n+--------------------------------------+-------+--------+------------+-------------+--------------------------------+\n| 7cf44867-42f4-44de-aba5-019113d52612 | test0 | ACTIVE | -          | Running     | private=172.31.1.2, 10.0.2.249 |\n| 0696c57e-7704-4d51-a3f2-627049946052 | test1 | ACTIVE | -          | Running     | private=172.31.1.3, 10.0.2.250 |\n+--------------------------------------+-------+--------+------------+-------------+--------------------------------+\n\n-- From another node on the external network ping both the node on the FIPs. Ping will not go through...\n-- Allow ICMP from all IPs...\ndevstack@dev0:~/devstack$ nova secgroup-add-rule default icmp -1 -1 0.0.0.0/0\n+-------------+-----------+---------+-----------+--------------+\n| IP Protocol | From Port | To Port | IP Range  | Source Group |\n+-------------+-----------+---------+-----------+--------------+\n| icmp        | -1        | -1      | 0.0.0.0/0 |              |\n+-------------+-----------+---------+-----------+--------------+\ndevstack@dev0:~/devstack$ nova secgroup-list-rules 1\n+-------------+-----------+---------+-----------+--------------+\n| IP Protocol | From Port | To Port | IP Range  | Source Group |\n+-------------+-----------+---------+-----------+--------------+\n| icmp        | -1        | -1      | 0.0.0.0/0 |              |\n+-------------+-----------+---------+-----------+--------------+\n\n-- Ping again, still will not go through!!!\n\n-- Remove the default group from one of the instances... Now the other node will start pinging, because now the new rule is applied to all instances.\nnova remove-secgroup \"0696c57e-7704-4d51-a3f2-627049946052\" default\n\n-- Add  back the the default group to the instance, whose sec group was removed in the first place. Now that node starts pinging as well.\nnova add-secgroup \"0696c57e-7704-4d51-a3f2-627049946052\" default\n\n-- Same is the case with deletion of rules from sec group as well. Once you delete the ping allow rule, it will still allow pings until 'one of the instances is re-associated' with the sec group. This seems quite dangerous!!!\n\n\nThis bug is seen with both the CLI and Horizon Webapp with devstack running nova-network. I haven't checked the issue with nova-network on a multi node setup, although it should most probably be there as well.\n    But I do have checked whether the same issue happens with neutron, in both devstack, and a 3 node (controller, network, compute1) setup as mentioned in the official installation guide for Kilo. In neutron the rules are immediately reflected.\n\nExpected result: The new rules should be updated in iptables immediately after the sec group rules are modified and saved. All the instances associated to a sec group should immediately get affected by a rule change in that group. The admin/user need not have to manually detach and reattach the sec group to the instance.\n\nActual result: The modified rules don't immediately take effect.", "owner_link": "https://bugs.launchpad.net/api/devel/~sreesiv", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/bug_tasks", "duplicate_of_link": "https://bugs.launchpad.net/api/devel/bugs/1491307", "date_created": "2015-09-07T08:47:40.549710+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/subscriptions", "date_last_updated": "2015-09-07T13:40:18.690288+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 260, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/attachments", "security_related": true, "latest_patch_uploaded": null, "tags": ["network", "security"], "date_last_message": "2015-09-07T08:47:40.549710+00:00", "number_of_duplicates": 0, "message_count": 1, "users_affected_count": 2, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/users_unaffected", "users_affected_count_with_dupes": 2, "other_users_affected_count_with_dupes": 2, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1492961/linked_merge_proposals", "http_etag": "\"7b5e518d6ddb62e919d9d1e6d7cd4793e5033d0d-b58f5f7eee469d38237c8135754a03978571a28c\""}, "total_comments_and_activity": 3, "related_features": {}, "information_type_data": {"PUBLIC": {"is_private": false, "name": "Public", "order": 0, "description": "Everyone can see this information.\n", "value": "PUBLIC", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"is_private": true, "name": "Private Security", "order": 2, "description": "Only the security group can see this information.\n ", "value": "PRIVATESECURITY", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"is_private": false, "name": "Public Security", "order": 1, "description": "Everyone can see this security related information.\n", "value": "PUBLICSECURITY", "description_css_class": "choice-description"}, "USERDATA": {"is_private": true, "name": "Private", "order": 3, "description": "Only shared with users permitted to see private user information.\n", "value": "USERDATA", "description_css_class": "choice-description"}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/nova/+bug/1492961", "web_link": "https://bugs.launchpad.net/nova/+bug/1492961", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1492961", "milestone_link": null, "status": "New", "importance": "Undecided", "assignee_link": "https://bugs.launchpad.net/api/devel/~sreesiv", "bug_target_display_name": "OpenStack Compute (nova)", "bug_target_name": "nova", "bug_watch_link": null, "date_assigned": "2015-09-07T08:52:58.726612+00:00", "date_created": "2015-09-07T08:47:40.549710+00:00", "date_confirmed": null, "date_incomplete": null, "date_in_progress": null, "date_closed": null, "date_left_new": null, "date_triaged": null, "date_fix_committed": null, "date_fix_released": null, "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~sreesiv", "target_link": "https://bugs.launchpad.net/api/devel/nova", "title": "Bug #1492961 in OpenStack Compute (nova): \"Security Group Rules not effective immediately\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/nova/+bug/1492961/related_tasks", "is_complete": false, "http_etag": "\"431d8571104551de43dc467461173b5d3c00faf1-b5d96d73594f7b0d585b4bb46375cfbe7650d247\""}, "bugtask_data": {"1901755": {"delete_link": "https://bugs.launchpad.net/nova/+bug/1492961/+delete", "bug_title": "Security Group Rules not effective immediately", "user_can_unassign": false, "importance_value": "Undecided", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary1901755", "target_is_product": true, "user_can_edit_milestone": false, "prefix": "nova", "bugtask_path": "/nova/+bug/1492961", "id": 1901755, "milestone_value": null, "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task1901755", "targetname": "OpenStack Compute (nova)", "assignee_is_team": false, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": "sreesiv", "status_value": "New"}}, "subscribers_portlet_url_data": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1492961", "web_link": "https://bugs.launchpad.net/bugs/1492961"}, "initial_comment_batch_offset": 41, "first visible_recent_comment": -40};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 53 queries/external actions issued in 0.86 seconds

    Features: {'app.maintenance_message': None, 'hard_timeout': '9000', 'js.yui_version': None, 'app.mainsite_only.canonical_url': None, 'baselayout.careers_link.disabled': None, 'bugs.affected_count_includes_dupes.disabled': None, 'visible_render_time': None, 'profiling.enabled': None, 'bugs.nominations.bug_supervisors_can_target': 'on'}

    r0d8de2b

    -->

</html>

