<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1996773002: Sanitize https:// URLs before sending them to PAC scripts. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '83d3be554f39b50b0db9e9a0a2631766';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1996773002%252526ust%25253D1608695601921338%252526usg%25253DAFQjCNHkWHaHzNTjydy_80quU_rS6NW-KA%26service%3Dah">Sign out</a>

</div>
<div class="counter">(756)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1996773002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1996773002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1996773002</a>:
    Sanitize https:// URLs before sending them to PAC scripts.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 7 months ago by <a href="/user/eroman" onMouseOver="M_showUserInfoPopup(this)">eroman</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 7 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/mmenke" onMouseOver="M_showUserInfoPopup(this)">mmenke</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, cbentzel+watch_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Sanitize https:// URLs before sending them to PAC scripts.

This additionally strips the path and query components for https:// URL (embedded identity and reference fragment were already being stripped).

For debugging purposes this behavior can be disabled with the command line flag --unsafe-pac-url.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=593759">593759</a>
<a href="mailto:R=mmenke@chromium.org">R=mmenke@chromium.org</a>

Committed: <a href="https://chromium.googlesource.com/chromium/src/+/81357b39c643fc746517fd6ce5cb2076b7ddc3f4">https://chromium.googlesource.com/chromium/src/+/81357b39c643fc746517fd6ce5cb2076b7ddc3f4</a>
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1996773002/#ps1"
       onclick="M_toggleSectionForPS('1996773002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1996773002/#ps20001"
       onclick="M_toggleSectionForPS('1996773002', '20001')"
       class="toggled-section ">
      Patch Set 2
      :  
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 9
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1996773002/#ps40001"
       onclick="M_toggleSectionForPS('1996773002', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Addressed Matt&#39;s feedback
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 12
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1996773002/#ps60001"
       onclick="M_toggleSectionForPS('1996773002', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Address Matt&#39;s comments
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1996773002/#ps80001"
       onclick="M_toggleSectionForPS('1996773002', '80001')"
       class="toggled-section opentriangle">
      Patch Set 5
      : another ftp test with path
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-80001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 7 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1996773002_80001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1996773002/80001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+285 lines, -4 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90001">
            chrome/browser/net/proxy_service_factory.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/chrome/browser/net/proxy_service_factory.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1996773002/diff2/1:80001/chrome/browser/net/proxy_service_factory.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1996773002/diff2/20001:80001/chrome/browser/net/proxy_service_factory.cc"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+5 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90001.diff"
             title="Download patch for chrome/browser/net/proxy_service_factory.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90003">
            chrome/common/chrome_switches.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/chrome/common/chrome_switches.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1996773002/diff2/1:80001/chrome/common/chrome_switches.h"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90003.diff"
             title="Download patch for chrome/common/chrome_switches.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90002">
            chrome/common/chrome_switches.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/chrome/common/chrome_switches.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+5 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90002.diff"
             title="Download patch for chrome/common/chrome_switches.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90005">
            net/proxy/proxy_service.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/net/proxy/proxy_service.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1996773002/diff2/1:80001/net/proxy/proxy_service.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1996773002/diff2/20001:80001/net/proxy/proxy_service.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1996773002/diff2/40001:80001/net/proxy/proxy_service.h"
             title="Delta from patch set 3">3</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+27 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90005.diff"
             title="Download patch for net/proxy/proxy_service.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90004">
            net/proxy/proxy_service.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/net/proxy/proxy_service.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1996773002/diff2/1:80001/net/proxy/proxy_service.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1996773002/diff2/20001:80001/net/proxy/proxy_service.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1996773002/diff2/40001:80001/net/proxy/proxy_service.cc"
             title="Delta from patch set 3">3</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+27 lines, -4 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90004.diff"
             title="Download patch for net/proxy/proxy_service.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1996773002/patch/80001/90006">
            net/proxy/proxy_service_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1996773002/diff/80001/net/proxy/proxy_service_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1996773002/diff2/1:80001/net/proxy/proxy_service_unittest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1996773002/diff2/20001:80001/net/proxy/proxy_service_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1996773002/diff2/40001:80001/net/proxy/proxy_service_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1996773002/diff2/60001:80001/net/proxy/proxy_service_unittest.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+220 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1996773002_80001_90006.diff"
             title="Download patch for net/proxy/proxy_service_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 80001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 21 (8 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 21)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 21)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(21)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(21)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          eroman@chromium.org changed reviewers: + mmenke@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 22:04:23 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:eroman@chromium.org">eroman@chromium.org</a> changed reviewers:
+ <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 22:04:24 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          Quick comments. Haven&#39;t reviewed the tests, but I&#39;m paranoid enough that I think that one ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 22:33:24 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >Quick comments.  Haven&#39;t reviewed the tests, but I&#39;m paranoid enough that I
think that one of the tests that actually uses a PAC script should check that
the URLs it gets really are sanitized.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc</a>
File net/proxy/proxy_service.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode364" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:364: }
An alternative approach would be to do:

if (policy == SanitizeUrlForPacScriptPolicy::SAFE &amp;&amp; 
url.SchemeIsCryptographic()) {
  return url.GetOrigin();
}

GURL::Replacements replacements;
...

Nice thing about that approach is it emphasizes this is indeed just an origin. 
Downside is it de-emphasizes just what the differences are between the two
paths.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode1074" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:1074: SanitizeUrlForPacScript(raw_url,
sanitize_url_for_pac_script_policy_);
Should we only do this when we create the PacRequest?  Seems weird to call it
SanitizeForPac, and then send it to TryToCompleteSynchronously, which doesn&#39;t
actually run a PAC script.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h</a>
File net/proxy/proxy_service.h (right):

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode69" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:69: NET_EXPORT GURL SanitizeUrlForPacScript(const
GURL&amp; url,
Do you need to include gurl.h when returning a GURL?

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode70" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:70: SanitizeUrlForPacScriptPolicy policy);
Not a big fan of bonus enums and methods hanging out in a class&#39;s header file. 
Can we just move these into ProxyService?

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode494" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:494: SanitizeUrlForPacScriptPolicy::SAFE;
nit:  Seems weird to me to mix inline simple initialization with initialization
in the constructor.  I&#39;m fine with either pattern, just don&#39;t like
mixing-and-matching.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Thanks for the feedback Matt! &gt; but I&#39;m paranoid enough that I think that one ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 23:26:05 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Thanks for the feedback Matt!

&gt; but I&#39;m paranoid enough that I think that one of the tests
&gt; that actually uses a PAC script should check that
&gt; the URLs it gets really are sanitized.

A full functional test for proxy resolving is a pretty involved, and we don&#39;t
really have an existing framework for that.

There are several more layers of goop around proxy resolving if we wanted to
measure final delivery to a PAC script.

  - MultiThreadedProxyResolver wrapping a platform implementation
Or
  - TracingProxyResolverV8 wrapping v8 proxy resolver
Or
  - Mojo proxy resolver wrapping either an in-process implementation or
out-of-process forwarder.

Because we instantiate all these different modes (chrome side and embedder side)
the biggest bang for your buck is testing the interface between ProxyService --&gt;
ProxyResolver.

You do have a valid point though. Minimally I will do some manual tests.

I would like a better story for end-to-end tests in the future.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc</a>
File net/proxy/proxy_service.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode364" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:364: }
On 2016/05/19 22:33:23, mmenke wrote:
&gt; An alternative approach would be to do:
&gt; 
&gt; if (policy == SanitizeUrlForPacScriptPolicy::SAFE &amp;&amp; 
&gt; url.SchemeIsCryptographic()) {
&gt;   return url.GetOrigin();
&gt; }
&gt; 
&gt; GURL::Replacements replacements;
&gt; ...
&gt; 
&gt; Nice thing about that approach is it emphasizes this is indeed just an origin.

&gt; Downside is it de-emphasizes just what the differences are between the two
&gt; paths.

I added a TODO to explore that, will follow-up.

There are some differences I would like to better understand between the two
approaches -- GetOrigin() short circuits on non-standard URL schemes and
completely clears the URL. I am not sure if that would come into play here, but
would like to play it safe by using the existing pattern of code.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode1074" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:1074: SanitizeUrlForPacScript(raw_url,
sanitize_url_for_pac_script_policy_);
On 2016/05/19 22:33:23, mmenke wrote:
&gt; Should we only do this when we create the PacRequest?  Seems weird to call it
&gt; SanitizeForPac, and then send it to TryToCompleteSynchronously, which doesn&#39;t
&gt; actually run a PAC script.

I hope to merge this CL to M52 so don&#39;t want to change the existing code
organization too much.

I have ideas on improving this but will not be tackling them here.

(There are several refactoring opportunities around layering issues in this file
-- too many PAC concepts leak into ProxyService. Also the distinction between
ProxyService, ProxyConfigService, and ProxyResolver is not great.)

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h</a>
File net/proxy/proxy_service.h (right):

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode69" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:69: NET_EXPORT GURL SanitizeUrlForPacScript(const
GURL&amp; url,
On 2016/05/19 22:33:23, mmenke wrote:
&gt; Do you need to include gurl.h when returning a GURL?

Done.

<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode70" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:70: SanitizeUrlForPacScriptPolicy policy);
On 2016/05/19 22:33:24, mmenke wrote:
&gt; Not a big fan of bonus enums and methods hanging out in a class&#39;s header file.

&gt; Can we just move these into ProxyService?

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          On 2016/05/19 23:26:05, eroman wrote: &gt; Thanks for the feedback Matt! &gt; &gt; &gt; but ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 23:29:48 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >On 2016/05/19 23:26:05, eroman wrote:
&gt; Thanks for the feedback Matt!
&gt; 
&gt; &gt; but I&#39;m paranoid enough that I think that one of the tests
&gt; &gt; that actually uses a PAC script should check that
&gt; &gt; the URLs it gets really are sanitized.
&gt; 
&gt; A full functional test for proxy resolving is a pretty involved, and we don&#39;t
&gt; really have an existing framework for that.
&gt; 
&gt; There are several more layers of goop around proxy resolving if we wanted to
&gt; measure final delivery to a PAC script.
&gt; 
&gt;   - MultiThreadedProxyResolver wrapping a platform implementation
&gt; Or
&gt;   - TracingProxyResolverV8 wrapping v8 proxy resolver
&gt; Or
&gt;   - Mojo proxy resolver wrapping either an in-process implementation or
&gt; out-of-process forwarder.
&gt; 
&gt; Because we instantiate all these different modes (chrome side and embedder
side)
&gt; the biggest bang for your buck is testing the interface between ProxyService
--&gt;
&gt; ProxyResolver.

I&#39;d be fine with just a TracingProxyResolverV8 test that uses a PAC script that
returns a different value based on whether the URL has any bonus bits attached,
or similar.  I agree that it would be great if we had something more unity, too,
but I think a full on integration test is good enough, for now.

&gt; You do have a valid point though. Minimally I will do some manual tests.
&gt; 
&gt; I would like a better story for end-to-end tests in the future.
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc</a>
&gt; File net/proxy/proxy_service.cc (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode364" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; net/proxy/proxy_service.cc:364: }
&gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; An alternative approach would be to do:
&gt; &gt; 
&gt; &gt; if (policy == SanitizeUrlForPacScriptPolicy::SAFE &amp;&amp; 
&gt; &gt; url.SchemeIsCryptographic()) {
&gt; &gt;   return url.GetOrigin();
&gt; &gt; }
&gt; &gt; 
&gt; &gt; GURL::Replacements replacements;
&gt; &gt; ...
&gt; &gt; 
&gt; &gt; Nice thing about that approach is it emphasizes this is indeed just an
origin.
&gt; 
&gt; &gt; Downside is it de-emphasizes just what the differences are between the two
&gt; &gt; paths.
&gt; 
&gt; I added a TODO to explore that, will follow-up.
&gt; 
&gt; There are some differences I would like to better understand between the two
&gt; approaches -- GetOrigin() short circuits on non-standard URL schemes and
&gt; completely clears the URL. I am not sure if that would come into play here,
but
&gt; would like to play it safe by using the existing pattern of code.
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode1074" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; net/proxy/proxy_service.cc:1074: SanitizeUrlForPacScript(raw_url,
&gt; sanitize_url_for_pac_script_policy_);
&gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; Should we only do this when we create the PacRequest?  Seems weird to call
it
&gt; &gt; SanitizeForPac, and then send it to TryToCompleteSynchronously, which
doesn&#39;t
&gt; &gt; actually run a PAC script.
&gt; 
&gt; I hope to merge this CL to M52 so don&#39;t want to change the existing code
&gt; organization too much.
&gt; 
&gt; I have ideas on improving this but will not be tackling them here.
&gt; 
&gt; (There are several refactoring opportunities around layering issues in this
file
&gt; -- too many PAC concepts leak into ProxyService. Also the distinction between
&gt; ProxyService, ProxyConfigService, and ProxyResolver is not great.)
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h</a>
&gt; File net/proxy/proxy_service.h (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode69" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; net/proxy/proxy_service.h:69: NET_EXPORT GURL SanitizeUrlForPacScript(const
&gt; GURL&amp; url,
&gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; Do you need to include gurl.h when returning a GURL?
&gt; 
&gt; Done.
&gt; 
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode70" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; net/proxy/proxy_service.h:70: SanitizeUrlForPacScriptPolicy policy);
&gt; On 2016/05/19 22:33:24, mmenke wrote:
&gt; &gt; Not a big fan of bonus enums and methods hanging out in a class&#39;s header
file.
&gt; 
&gt; &gt; Can we just move these into ProxyService?
&gt; 
&gt; Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          On 2016/05/19 23:29:48, mmenke wrote: &gt; On 2016/05/19 23:26:05, eroman wrote: &gt; &gt; Thanks for ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-19 23:30:17 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >On 2016/05/19 23:29:48, mmenke wrote:
&gt; On 2016/05/19 23:26:05, eroman wrote:
&gt; &gt; Thanks for the feedback Matt!
&gt; &gt; 
&gt; &gt; &gt; but I&#39;m paranoid enough that I think that one of the tests
&gt; &gt; &gt; that actually uses a PAC script should check that
&gt; &gt; &gt; the URLs it gets really are sanitized.
&gt; &gt; 
&gt; &gt; A full functional test for proxy resolving is a pretty involved, and we
don&#39;t
&gt; &gt; really have an existing framework for that.
&gt; &gt; 
&gt; &gt; There are several more layers of goop around proxy resolving if we wanted to
&gt; &gt; measure final delivery to a PAC script.
&gt; &gt; 
&gt; &gt;   - MultiThreadedProxyResolver wrapping a platform implementation
&gt; &gt; Or
&gt; &gt;   - TracingProxyResolverV8 wrapping v8 proxy resolver
&gt; &gt; Or
&gt; &gt;   - Mojo proxy resolver wrapping either an in-process implementation or
&gt; &gt; out-of-process forwarder.
&gt; &gt; 
&gt; &gt; Because we instantiate all these different modes (chrome side and embedder
&gt; side)
&gt; &gt; the biggest bang for your buck is testing the interface between ProxyService
&gt; --&gt;
&gt; &gt; ProxyResolver.
&gt; 
&gt; I&#39;d be fine with just a TracingProxyResolverV8 test that uses a PAC script
that
&gt; returns a different value based on whether the URL has any bonus bits
attached,
&gt; or similar.  I agree that it would be great if we had something more unity,
too,
&gt; but I think a full on integration test is good enough, for now.

Erm...unity = unit-y

&gt; 
&gt; &gt; You do have a valid point though. Minimally I will do some manual tests.
&gt; &gt; 
&gt; &gt; I would like a better story for end-to-end tests in the future.
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc</a>
&gt; &gt; File net/proxy/proxy_service.cc (right):
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode364" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; &gt; net/proxy/proxy_service.cc:364: }
&gt; &gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; &gt; An alternative approach would be to do:
&gt; &gt; &gt; 
&gt; &gt; &gt; if (policy == SanitizeUrlForPacScriptPolicy::SAFE &amp;&amp; 
&gt; &gt; &gt; url.SchemeIsCryptographic()) {
&gt; &gt; &gt;   return url.GetOrigin();
&gt; &gt; &gt; }
&gt; &gt; &gt; 
&gt; &gt; &gt; GURL::Replacements replacements;
&gt; &gt; &gt; ...
&gt; &gt; &gt; 
&gt; &gt; &gt; Nice thing about that approach is it emphasizes this is indeed just an
&gt; origin.
&gt; &gt; 
&gt; &gt; &gt; Downside is it de-emphasizes just what the differences are between the two
&gt; &gt; &gt; paths.
&gt; &gt; 
&gt; &gt; I added a TODO to explore that, will follow-up.
&gt; &gt; 
&gt; &gt; There are some differences I would like to better understand between the two
&gt; &gt; approaches -- GetOrigin() short circuits on non-standard URL schemes and
&gt; &gt; completely clears the URL. I am not sure if that would come into play here,
&gt; but
&gt; &gt; would like to play it safe by using the existing pattern of code.
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.cc#newcode1074" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; &gt; net/proxy/proxy_service.cc:1074: SanitizeUrlForPacScript(raw_url,
&gt; &gt; sanitize_url_for_pac_script_policy_);
&gt; &gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; &gt; Should we only do this when we create the PacRequest?  Seems weird to call
&gt; it
&gt; &gt; &gt; SanitizeForPac, and then send it to TryToCompleteSynchronously, which
&gt; doesn&#39;t
&gt; &gt; &gt; actually run a PAC script.
&gt; &gt; 
&gt; &gt; I hope to merge this CL to M52 so don&#39;t want to change the existing code
&gt; &gt; organization too much.
&gt; &gt; 
&gt; &gt; I have ideas on improving this but will not be tackling them here.
&gt; &gt; 
&gt; &gt; (There are several refactoring opportunities around layering issues in this
&gt; file
&gt; &gt; -- too many PAC concepts leak into ProxyService. Also the distinction
between
&gt; &gt; ProxyService, ProxyConfigService, and ProxyResolver is not great.)
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h</a>
&gt; &gt; File net/proxy/proxy_service.h (right):
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode69" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; &gt; net/proxy/proxy_service.h:69: NET_EXPORT GURL SanitizeUrlForPacScript(const
&gt; &gt; GURL&amp; url,
&gt; &gt; On 2016/05/19 22:33:23, mmenke wrote:
&gt; &gt; &gt; Do you need to include gurl.h when returning a GURL?
&gt; &gt; 
&gt; &gt; Done.
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service.h#newcode70" rel="nofollow">https://codereview.chromium.org/1996773002/diff/20001/net/proxy/proxy_service...</a>
&gt; &gt; net/proxy/proxy_service.h:70: SanitizeUrlForPacScriptPolicy policy);
&gt; &gt; On 2016/05/19 22:33:24, mmenke wrote:
&gt; &gt; &gt; Not a big fan of bonus enums and methods hanging out in a class&#39;s header
&gt; file.
&gt; &gt; 
&gt; &gt; &gt; Can we just move these into ProxyService?
&gt; &gt; 
&gt; &gt; Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          LGTM. A couple minor suggestions. https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc File net/proxy/proxy_service.cc (right): https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc#newcode1566 net/proxy/proxy_service.cc:1566: DCHECK(url.is_valid()); optional: Suggest a ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-20 17:40:23 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >LGTM.  A couple minor suggestions.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc</a>
File net/proxy/proxy_service.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc#newcode1566" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:1566: DCHECK(url.is_valid());
optional:  Suggest a blank line between input sanity checks and function logic.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h</a>
File net/proxy/proxy_service.h (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h#newcode326" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:326: NET_EXPORT static GURL SanitizeUrl(const GURL&amp;
url, SanitizeUrlPolicy policy);
Should this be NET_EXPORT_PRIVATE?  Not really concerned about external use,
just not sure we really expect it.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
File net/proxy/proxy_service_unittest.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3485" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3485: TEST_F(ProxyServiceTest,
SanitizeUrlsBeforeResolving) {
Didn&#39;t realize you had this sort of test as well, yesterday - just assumed that
ProxyService::SanitizeUrl&#39;s existence as a public method meant you were only
testing at that level.

Could consider making it private / moving it to an anonymous namespace, and make
all tests go through the ConfigService, so you&#39;re only testing its public
interface, rather than its implementation details.  Could either add a helper
method, or just put the request2 / request3 in a loop.  Up to you, I just have a
personal preference to avoid adding to the public API just for tests if it can
reasonably be avoided, and think this is little enough boilerplate that it falls
into that category.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3593" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3593: &quot;ftp://foo:bar@example.com/&quot;,
&quot;ftp://example.com/&quot;,
Seems like we should have a test with an FTP URL with a path.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3661" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3661:
&quot;https://example.com/foo/bar/baz?hello&quot;, &quot;https://example.com/&quot;,
Suggest no path on this one (Well...a path of &quot;/&quot;, to be technical).  Next test
checks path + query.  While GURL no doubt has plenty of testing, feel that no
path here gives us marginally more test coverage here.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3673" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3673: },
Suggest also having a wss test.  Could add a ws test above as well, though I&#39;m
less concerned about that.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc File net/proxy/proxy_service.cc (right): https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc#newcode1566 net/proxy/proxy_service.cc:1566: DCHECK(url.is_valid()); On 2016/05/20 17:40:23, mmenke wrote: &gt; optional: Suggest ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-20 21:23:53 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            ><a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc</a>
File net/proxy/proxy_service.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.cc#newcode1566" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.cc:1566: DCHECK(url.is_valid());
On 2016/05/20 17:40:23, mmenke wrote:
&gt; optional:  Suggest a blank line between input sanity checks and function
logic.

Done.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h</a>
File net/proxy/proxy_service.h (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service.h#newcode326" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service.h:326: NET_EXPORT static GURL SanitizeUrl(const GURL&amp;
url, SanitizeUrlPolicy policy);
On 2016/05/20 17:40:23, mmenke wrote:
&gt; Should this be NET_EXPORT_PRIVATE?  Not really concerned about external use,
&gt; just not sure we really expect it.

No longer applicable, as I moved the function to be internal-only.

That said, I am not a fan of NET_EXPORT_PRIVATE for the reasons given in
<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=552248" rel="nofollow">https://bugs.chromium.org/p/chromium/issues/detail?id=552248</a>

(My pessimistic view is that its value erodes with time as consumers invariably
depend on it, making it little more than a confusing out-of-date comment).

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
File net/proxy/proxy_service_unittest.cc (right):

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3485" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3485: TEST_F(ProxyServiceTest,
SanitizeUrlsBeforeResolving) {
On 2016/05/20 17:40:23, mmenke wrote:
&gt; Didn&#39;t realize you had this sort of test as well, yesterday - just assumed
that
&gt; ProxyService::SanitizeUrl&#39;s existence as a public method meant you were only
&gt; testing at that level.
&gt; 
&gt; Could consider making it private / moving it to an anonymous namespace, and
make
&gt; all tests go through the ConfigService, so you&#39;re only testing its public
&gt; interface, rather than its implementation details.  Could either add a helper
&gt; method, or just put the request2 / request3 in a loop.  Up to you, I just have
a
&gt; personal preference to avoid adding to the public API just for tests if it can
&gt; reasonably be avoided, and think this is little enough boilerplate that it
falls
&gt; into that category.

Done.
I agree that is a better approach.
All of the testing is now going through ProxyService.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3593" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3593: &quot;ftp://foo:bar@example.com/&quot;,
&quot;ftp://example.com/&quot;,
On 2016/05/20 17:40:23, mmenke wrote:
&gt; Seems like we should have a test with an FTP URL with a path.

Done.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3661" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3661:
&quot;https://example.com/foo/bar/baz?hello&quot;, &quot;https://example.com/&quot;,
On 2016/05/20 17:40:23, mmenke wrote:
&gt; Suggest no path on this one (Well...a path of &quot;/&quot;, to be technical).  Next
test
&gt; checks path + query.  While GURL no doubt has plenty of testing, feel that no
&gt; path here gives us marginally more test coverage here.

Done.

<a href="https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service_unittest.cc#newcode3673" rel="nofollow">https://codereview.chromium.org/1996773002/diff/40001/net/proxy/proxy_service...</a>
net/proxy/proxy_service_unittest.cc:3673: },
On 2016/05/20 17:40:23, mmenke wrote:
&gt; Suggest also having a wss test.  Could add a ws test above as well, though I&#39;m
&gt; less concerned about that.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          The CQ bit was checked by eroman@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-20 21:24:45 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >The CQ bit was checked by <a href="mailto:eroman@chromium.org">eroman@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          The patchset sent to the CQ was uploaded after l-g-t-m from mmenke@chromium.org Link to the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-20 21:24:45 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1996773002/#ps80001" rel="nofollow">https://codereview.chromium.org/1996773002/#ps80001</a>
(title: &quot;another ftp test with path&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1996773002/80001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-20 21:25:11 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1996773002/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1996773002/80001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 00:23:46 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          Try jobs failed on following builders: linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/233285)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 00:23:49 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >Try jobs failed on following builders:
  linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/233285" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          The CQ bit was checked by eroman@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 19:47:19 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >The CQ bit was checked by <a href="mailto:eroman@chromium.org">eroman@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1996773002/80001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 19:47:23 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1996773002/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1996773002/80001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1996773002/80001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 22:18:40 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          Try jobs failed on following builders: linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/233448)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 22:18:41 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >Try jobs failed on following builders:
  linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/233448" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          Description was changed from ========== Sanitize https:// URLs before sending them to PAC scripts. This ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 23:05:09 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-17"
            >Description was changed from

==========
Sanitize https:// URLs before sending them to PAC scripts.

This additionally strips the path and query components for https:// URL
(embedded identity and reference fragment were already being stripped).

For debugging purposes this behavior can be disabled with the command line flag
--unsafe-pac-url.

BUG=593759
==========

to

==========
Sanitize https:// URLs before sending them to PAC scripts.

This additionally strips the path and query components for https:// URL
(embedded identity and reference fragment were already being stripped).

For debugging purposes this behavior can be disabled with the command line flag
--unsafe-pac-url.

BUG=593759
<a href="mailto:R=mmenke@chromium.org">R=mmenke@chromium.org</a>

Committed: <a href="https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4" rel="nofollow">https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4</a>
Cr-Commit-Position: refs/heads/master@{#395266}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          Patchset 5 (id:??) landed as https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4 Cr-Commit-Position: refs/heads/master@{#395266}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 23:05:10 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-18"
            >Patchset 5 (id:??) landed as
<a href="https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4" rel="nofollow">https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4</a>
Cr-Commit-Position: refs/heads/master@{#395266}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          Description was changed from ========== Sanitize https:// URLs before sending them to PAC scripts. This ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 23:05:53 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-19"
            >Description was changed from

==========
Sanitize https:// URLs before sending them to PAC scripts.

This additionally strips the path and query components for https:// URL
(embedded identity and reference fragment were already being stripped).

For debugging purposes this behavior can be disabled with the command line flag
--unsafe-pac-url.

BUG=593759
<a href="mailto:R=mmenke@chromium.org">R=mmenke@chromium.org</a>

Committed: <a href="https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4" rel="nofollow">https://crrev.com/81357b39c643fc746517fd6ce5cb2076b7ddc3f4</a>
Cr-Commit-Position: refs/heads/master@{#395266}
==========

to

==========
Sanitize https:// URLs before sending them to PAC scripts.

This additionally strips the path and query components for https:// URL
(embedded identity and reference fragment were already being stripped).

For debugging purposes this behavior can be disabled with the command line flag
--unsafe-pac-url.

BUG=593759
<a href="mailto:R=mmenke@chromium.org">R=mmenke@chromium.org</a>

Committed:
<a href="https://chromium.googlesource.com/chromium/src/+/81357b39c643fc746517fd6ce5cb2076b7ddc3f4" rel="nofollow">https://chromium.googlesource.com/chromium/src/+/81357b39c643fc746517fd6ce5cb...</a>
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-20">
                          Committed patchset #5 (id:80001) manually as 81357b39c643fc746517fd6ce5cb2076b7ddc3f4 (presubmit successful).
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 7 months ago
		(2016-05-21 23:05:55 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-20"
            >Committed patchset #5 (id:80001) manually as
81357b39c643fc746517fd6ce5cb2076b7ddc3f4 (presubmit successful).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 21)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 21)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(21)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(21)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 21;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1996773002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1996773002: Sanitize https:// URLs before sending them to PAC scripts.
     (Closed) </b><br/>
      Created 4 years, 7 months ago by eroman<br/>
      Modified 4 years, 7 months ago<br/>
      Reviewers: mmenke<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 21
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
