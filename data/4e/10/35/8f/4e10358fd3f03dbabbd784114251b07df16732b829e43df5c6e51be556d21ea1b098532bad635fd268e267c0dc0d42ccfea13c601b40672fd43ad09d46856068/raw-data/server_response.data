<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions - Sentinel - HashiCorp Discuss</title>
    <meta name="description" content="The following is a security advisory for the Sentinel runtime regarding a parser issue that was fixed in the runtime in late June 2019. The advisory has been released now that all Sentinel integrations have updated to a &amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta7 - https://github.com/discourse/discourse version 436edbb51a15c634e65c0d7cdccdb4ce9aecd8f1">
<link rel="icon" type="image/png" href="https://aws1.discourse-cdn.com/hashicorp/optimized/1X/768b0c508ad4facc44cabe5a30aff4d7f8afa863_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="https://aws1.discourse-cdn.com/hashicorp/optimized/1X/154331ed085112b536f7a0c4c5355c17a57e53c1_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://discuss.hashicorp.com","potentialAction":{"@type":"SearchAction","target":"https://discuss.hashicorp.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="https://discuss.hashicorp.com/opensearch.xml" title="HashiCorp Discuss Search">

      <link href="https://sea2.discourse-cdn.com/hashicorp/stylesheets/desktop_3efd433df85c59aaefb5500dd3bf1fda39cbdf6b.css?__ws=discuss.hashicorp.com" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="https://sea2.discourse-cdn.com/hashicorp/stylesheets/desktop_theme_19_b1232ab7e1a63dce3d47ad01483d60057495aa70.css?__ws=discuss.hashicorp.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="19" data-theme-name="discourse-hashicorp-theme"/>
    


<script src="https://sea2.discourse-cdn.com/hashicorp/theme-javascripts/d50ac3dedd3ea76578c300e5e62bc17c5b4f01d2.js?__ws=discuss.hashicorp.com"></script>
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-36299135-17" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

  <link rel="preload" href="https://aws1.discourse-cdn.com/hashicorp/assets/google-universal-analytics-v3-706f1d28f0a97f67a47515c96189277240ec4940d968955042066d7873fd1fe8.gz.js" as="script">
<script src="https://aws1.discourse-cdn.com/hashicorp/assets/google-universal-analytics-v3-706f1d28f0a97f67a47515c96189277240ec4940d968955042066d7873fd1fe8.gz.js"></script>


        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions&#39;" href="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955.rss" />
    <meta property="og:site_name" content="HashiCorp Discuss" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://aws1.discourse-cdn.com/hashicorp/original/1X/154331ed085112b536f7a0c4c5355c17a57e53c1.png" />
<meta property="og:image" content="https://aws1.discourse-cdn.com/hashicorp/original/1X/154331ed085112b536f7a0c4c5355c17a57e53c1.png" />
<meta property="og:url" content="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955" />
<meta name="twitter:url" content="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955" />
<meta property="og:title" content="SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions" />
<meta name="twitter:title" content="SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions" />
<meta property="og:description" content="The following is a security advisory for the Sentinel runtime regarding a parser issue that was fixed in the runtime in late June 2019. The advisory has been released now that all Sentinel integrations have updated to a version of the runtime that has addressed this issue. See below for more details.  Sentinel Incorrectly Parses Negation In Certain Policy Expressions Vulnerability ID: CVE-2019-19879  Release Date: February 12, 2020  Affected Products/Versions: Previous versions of Sentinel; fixe..." />
<meta name="twitter:description" content="The following is a security advisory for the Sentinel runtime regarding a parser issue that was fixed in the runtime in late June 2019. The advisory has been released now that all Sentinel integrations have updated to a version of the runtime that has addressed this issue. See below for more details.  Sentinel Incorrectly Parses Negation In Certain Policy Expressions Vulnerability ID: CVE-2019-19879  Release Date: February 12, 2020  Affected Products/Versions: Previous versions of Sentinel; fixe..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="1 mins 🕑" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="1 ❤" />
<meta property="article:published_time" content="2020-02-13T23:25:41+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    <!-- Replace icons -->






<script src="https://sea2.discourse-cdn.com/hashicorp/theme-javascripts/350479ec786d3192eb5f22fc034f23a6abba1c60.js?__ws=discuss.hashicorp.com"></script>
    <header>
      <a href="/">
          <img src="https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg" alt="HashiCorp Discuss" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955">SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://discuss.hashicorp.com/c/sentinel/25" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Sentinel</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='HashiCorp'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://discuss.hashicorp.com/u/vancluever'><span itemprop='name'>vancluever</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-13T23:25:41Z' class='post-time'>
                February 13, 2020, 11:25pm
              </time>
              <meta itemprop='dateModified' content='2020-02-13T23:25:41Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><em>The following is a security advisory for the Sentinel runtime regarding a parser issue that was fixed in the runtime in late June 2019. The advisory has been released now that all Sentinel integrations have updated to a version of the runtime that has addressed this issue. See below for more details.</em></p>
<h2>Sentinel Incorrectly Parses Negation In Certain Policy Expressions</h2>
<p>Vulnerability ID: CVE-2019-19879</p>
<p>Release Date: February 12, 2020</p>
<p>Affected Products/Versions: Previous versions of Sentinel; fixed in 0.10.2.</p>
<p>A vulnerability was identified in Sentinel such that, within specifically-constructed policy expressions, negations may not be correctly parsed. This vulnerability affects all previous releases of Sentinel, and was fixed in the 0.10.2 release.</p>
<p>Policies containing expressions utilizing this incorrectly-parsed negation may not have the intended effect, which may have security implications for systems relying on those policies. The impact of successful exploitation of this vulnerability would be very environment-dependent.</p>
<p>This document outlines details about this vulnerability and describes steps for remediation, as well as options to consider if an upgrade is not possible.</p>
<h3>Background</h3>
<p>HashiCorp <a href="https://www.hashicorp.com/sentinel/">Sentinel</a> is an embeddable policy-as-code framework to enable fine-grained, logic-based policy decisions that can be extended to source external information to make decisions.</p>
<p>Policies written in the Sentinel <a href="https://docs.hashicorp.com/sentinel/language/">policy language</a> are parsed and evaluated within the Sentinel runtime, with decisions enforced by the broader system system into which Sentinel is embedded.</p>
<h3>Vulnerability Details</h3>
<p>The Sentinel policy language allows certain operators to be negated with the <code>not</code> token to assist with human readability. Specifically, <code>not</code> can be used in forms such as <code>not contains</code>, <code>not in</code>, and <code>not matches</code>, where in this case they are the equivalent of a negation of the actual unary result (e.g. <code>"foo" not in "foobar"</code> is the same as <code>!("foo" in "foobar")</code>).</p>
<p>As can be seen in <a href="https://docs.hashicorp.com/sentinel/language/spec/#operator-precedence">Operator Precedence</a> in the Sentinel specification, relational operators such as <code>contains</code>, <code>in</code>, and <code>matches</code> sit in the middle of the precedence order, with arithmetic operators and <code>else</code> having higher precedence. <code>else</code> is usually used in these kinds of policies to escape undefined, a handleable error scenario in Sentinel, like so:</p>
<pre><code class="lang-auto">foo else "foo" not in "foobar"
</code></pre>
<p>In these scenarios, an issue in the state machine was causing the not predicate to be ignored, having the opposite effect and effectively making this expression the same as:</p>
<pre><code class="lang-auto">foo else "foo" in "foobar"
</code></pre>
<p>This also applied to scenarios where arithmetic operators were used for operations such as concatenation, as in the following example:</p>
<pre><code class="lang-auto">"foo" + "bar" not in "foobar"
</code></pre>
<p>This issue affects specifically-constructed policy expressions containing operators where a <code>not</code> predicate can be used, which applies to the relational/set operators <code>contains</code>, <code>in</code>, and <code>matches</code>.</p>
<h3>Remediation</h3>
<p>Customers should move to recent versions of HashiCorp enterprise products, as they have incorporated this fix. Specifically, the Sentinel version in which this issue was addressed was included in Vault Enterprise 1.2.0, Terraform Enterprise v201907-1, Consul Enterprise 1.7.0 and Nomad Enterprise 0.10.1.</p>
<p>If using Sentinel through an integration, customers may check that particular product to verify it contains the runtime 0.10.2 or higher:</p>
<ul>
<li>To confirm the runtime version in a Sentinel integration, use the <code>runtime</code> import (introduced in Sentinel 0.6.0) and debug messaging. Forcing a policy failure is usually enough to print debug messages:</li>
</ul>
<pre><code class="lang-auto">import "runtime"

print(runtime.version)

main = false
</code></pre>
<ul>
<li>To confirm the runtime version in the Sentinel Simulator, run the <code>sentinel version</code> CLI command.</li>
</ul>
<p>If upgrade is not possible, customers may consider evaluating their Sentinel policies for the incorrectly-parsed policy construction, and rewriting with a variable as an intermediary:</p>
<pre><code class="lang-auto">foo = foo else "foo"

main = foo not in "foobar"
</code></pre>
<p>Policy authors should confirm that the policy does not change by using <code>sentinel fmt</code>, with a Sentinel CLI version older than 0.10.2, as available at <a href="https://releases.hashicorp.com/sentinel/">https://releases.hashicorp.com/sentinel/</a>.</p>
<p>Additionally, authors should ensure that they apply appropriate testing to all of their policies to assert they are behaving as expected.</p>
<p>Please contact <a href="mailto:support@hashicorp.com">support@hashicorp.com</a> with any questions or <a href="mailto:security@hashicorp.com">security@hashicorp.com</a> to report any security vulnerability or issue.</p>
        </div>

        <meta itemprop='headline' content='SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions'>
          <meta itemprop='keywords' content=''>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="1" />
           <span class='post-likes'>1 Like</span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='HashiCorp'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://discuss.hashicorp.com/u/vancluever'><span itemprop='name'>vancluever</span></a>
            
              closed 
          </span>

          <link itemprop="mainEntityOfPage" href="https://discuss.hashicorp.com/t/security-bulletin-sentinel-incorrectly-parses-negation-in-certain-policy-expressions/5955">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2020-02-13T23:25:57Z' class='post-time'>
                February 13, 2020, 11:25pm
              </time>
              <meta itemprop='dateModified' content='2020-02-13T23:25:57Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          
        </div>

        <meta itemprop='headline' content='SECURITY BULLETIN: Sentinel Incorrectly Parses Negation In Certain Policy Expressions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
