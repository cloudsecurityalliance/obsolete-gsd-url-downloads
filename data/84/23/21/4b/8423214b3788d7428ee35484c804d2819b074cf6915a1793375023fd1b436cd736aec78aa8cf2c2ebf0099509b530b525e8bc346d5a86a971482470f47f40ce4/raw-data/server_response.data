<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='*General Issues Bug #68665 - RDF' href='rss/bug.php?id=68665'>
        <link rel='alternate' type='application/rss+xml' title='*General Issues Bug #68665 - RSS 2.0' href='rss/bug.php?id=68665&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Bug #68665 :: Invalid free</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=68665">Bug</a>&nbsp;#68665</th>
            <td id="summary" colspan="5">Invalid free</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2014-12-28 03:54 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2015-01-06 00:41 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>honey &#x61;&#116; internot &#x64;&#111;&#x74; info</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=ab">ab</a> (<a href="https://people.php.net/ab">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=%2AGeneral+Issues">*General Issues</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>master-Git-2014-12-28 (Git)</td>
            <th class="details">OS:</th>
            <td>Linux Ubuntu 14.04</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><em>None</em></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=68665&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=68665&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=68665&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1419738863">&nbsp;</a><strong>[2014-12-28 03:54 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Description:
------------
Hi,

In /ext/fileinfo/libmagic/apprentice.c, an invalid free occurs:


1173                char mfn[MAXPATHLEN];
[..]
1198                                        efree(mfn);


as an array is not heap allocated, it cannot be freed.


</pre>
</div><h2>Patches</h2>
<a href="patch-display.php?bug_id=68665&amp;patch=php54_68665&amp;revision=latest" >php54_68665</a>
(last revision 2016-12-12 03:01 UTC by 12113362 &#x61;&#116; qq &#x64;&#111;&#x74; com)
<br><p><a href='patch-add.php?bug_id=68665'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=68665'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_comment' ><a name="1419739292">&nbsp;</a><strong>[2014-12-28 04:01 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>And in /Zend/zend_language_scanner.l:


1934                s = Z_STRVAL_P(zendlval);
[..]
1938                efree(s);
</pre>
</div><div class='comment type_svn' ><a name="1419771787">&nbsp;</a><strong>[2014-12-28 13:03 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of ab
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=a72cd07f2983dc43a6bb35209dc4687852e53c09" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=a72cd07f2983dc43a6bb35209dc4687852e53c09</a>
Log: Fixed <a href='bug.php?id=68665'>bug #68665</a> (Invalid free)
</pre>
</div><div class='comment type_log' ><a name="1419771787">&nbsp;</a><strong>[2014-12-28 13:03 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Open</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_log' ><a name="1419772903">&nbsp;</a><strong>[2014-12-28 13:21 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: ab</span>
</div></div></div><div class='comment type_comment' ><a name="1419772903">&nbsp;</a><strong>[2014-12-28 13:21 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>@honey, the first one is a good catch, affects also 5.6. But with the second one - can you provide a test case for that? 

Thanks
</pre>
</div><div class='comment type_comment' ><a name="1419781146">&nbsp;</a><strong>[2014-12-28 15:39 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>@honey, ok, this is fixed. Was reproducable only with big5 in mbstring. Thanks.
</pre>
</div><div class='comment type_comment' ><a name="1419788715">&nbsp;</a><strong>[2014-12-28 17:45 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Did you make a test-case? If so, could you paste it here?

Thanks
</pre>
</div><div class='comment type_comment' ><a name="1419796760">&nbsp;</a><strong>[2014-12-28 19:59 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Yeah, i made it <a href="http://git.php.net/?p=php-src.git;a=blob;t;h=74ff01da332d7e9cf419dbaadec6487c4a78e2ef" rel="nofollow">http://git.php.net/?p=php-src.git;a=blob;t;h=74ff01da332d7e9cf419dbaadec6487c4a78e2ef</a> . However it seems that run-tests.php isn't able to repro this. Namely, it needs the ini not to be passed on command line, but to load a true ini file. But that's another topic about the module loading order. Using the test code and an ini file the latest fix in master should be cleared.

Thanks.
</pre>
</div><div class='comment type_comment' ><a name="1419797908">&nbsp;</a><strong>[2014-12-28 20:18 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Ok, cool.

Should I submit a CVE-ID request to MITRE/oss-security?


Thanks,
</pre>
</div><div class='comment type_comment' ><a name="1419799622">&nbsp;</a><strong>[2014-12-28 20:47 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Hmm, I'd say no. The language scanner one is master only, so shouldn't have been used in any production.

Offtop - I were glad to push with your names as git doesn't accept pure emails for author names. Please post that next time )

Thanks.
</pre>
</div><div class='comment type_comment' ><a name="1419800891">&nbsp;</a><strong>[2014-12-28 21:08 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Ok cool, my name is Joshua Rogers for reference. When I submitted my various bug reports, I don't think it had an option.

Thanks,
</pre>
</div><div class='comment type_comment' ><a name="1419801253">&nbsp;</a><strong>[2014-12-28 21:14 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Also, I'll contact MITRE in private to see if a non-production, master-git-only falls within their scope, just in case.

Thanks again,
</pre>
</div><div class='comment type_comment' ><a name="1419881473">&nbsp;</a><strong>[2014-12-29 19:31 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>OK, so, 

apprentice.c has beeen assigned: CVE-2014-9425


this was MITRE's response regarding that zend_language_scanner.l one:

--


There is currently no CVE ID for this. The practice that we follow is
not the same for every piece of software. For example, in the past we
have assigned CVE IDs for vulnerabilities in FFmpeg that did not
affect any FFmpeg release. The rationale for this is that Google was
incorporating unreleased FFmpeg code into Chrome. In the case of PHP,
we do not know of (for example) current cases in which a Linux
distribution ships packages based on using the PHP master tree at an
arbitrary point in time. Also, we have not seen PHP maintainers
advertise that end users should individually use master. Accordingly,
for PHP, master seems to not directly correspond to a &quot;product,&quot; and
at least some of the bugs are a reflection of the code being in an
indeterminate development state.

--



Thanks,
</pre>
</div><div class='comment type_comment' ><a name="1419919848">&nbsp;</a><strong>[2014-12-30 06:10 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>My bad. It was actually CVE-2014-9426...
</pre>
</div><div class='comment type_comment' ><a name="1419965442">&nbsp;</a><strong>[2014-12-30 18:50 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Ok, see your messages on the OSS security lists :)
</pre>
</div><div class='comment type_comment' ><a name="1420063615">&nbsp;</a><strong>[2014-12-31 22:06 UTC] <a href="//people.php.net/tyrael">tyrael@php.net</a></strong>
<pre class='note'>next time please instead of Bug Type:Bug make sure to use Bug Type: Security and/or drop a mail to security@php.net
Makes it much easier to track security issues for the Release Managers, makes it easier to have a proper fix and for high impact issues we usually prefer to wait for the next release before going public with the bug/fix.
</pre>
</div><div class='comment type_comment' ><a name="1420106853">&nbsp;</a><strong>[2015-01-01 10:07 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Ok, will do(as I've done for 2 just now).

Also @ab, did you make a test-case for the apprentice.c one? A quick look shows it's probably not possible, since it only happens on a CAST() failure, which I don't think is possible to trigger.

Thanks,
</pre>
</div><div class='comment type_comment' ><a name="1420138622">&nbsp;</a><strong>[2015-01-01 18:57 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>@honey, yeah, not that easy to trigger that one as it'd only depend on erealloc() fail. So no tests for that one. And on the other hand, it wloud be only happening when an external magic is used (and that is dangerous by it self) which is not recommended to do.

Thanks.
</pre>
</div><div class='comment type_comment' ><a name="1420142426">&nbsp;</a><strong>[2015-01-01 20:00 UTC] <a href="//people.php.net/nikic">nikic@php.net</a></strong>
<pre class='note'>This can't happen at all, because erealloc() is infallible - it will cause a bailout (longjmp) if it can't perform the allocation.

We probably only keep these checks around to keep the libmagic.patch minimal.
</pre>
</div><div class='comment type_comment' ><a name="1420481577">&nbsp;</a><strong>[2015-01-05 18:12 UTC] <a href="//people.php.net/tyrael">tyrael@php.net</a></strong>
<pre class='note'>so it seems that this wasn't really a bug.
do we wanna send a headsup to mitre to revoke/reclassify the issue?
I don't think that it is plausible that anybody would ever use an erealloc implementation which doesn't bail out on failure but return NULL, so I think that the current score for this is pretty misleading.
</pre>
</div><div class='comment type_comment' ><a name="1420504898">&nbsp;</a><strong>[2015-01-06 00:41 UTC] honey &#x61;&#116; internot &#x64;&#111;&#x74; info</strong>
<pre class='note'>Sure thing, I'll send it through.

Thanks,
</pre>
</div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
