<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1377426 - (CVE-2017-7803) Other CSP rules ignored when specifying sandbox 'allow-scripts'">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1377426">
<meta property="og:description"
      content="RESOLVED (ckerschb) in Core - DOM: Security. Last updated 2018-02-01.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="P1">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1377426 - (CVE-2017-7803) Other CSP rules ignored when specifying sandbox 'allow-scripts'</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1377426&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1377426">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1377426">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/yui.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/global.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/util.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"project\":{\"cf_root_cause\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_a11y_review_project_flag\":\"---\"},\"tracking\":{\"cf_status_firefox95\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox56\":\"fixed\",\"cf_status_firefox55\":\"fixed\",\"cf_tracking_firefox56\":\"+\",\"cf_tracking_firefox_esr52\":\"55+\",\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox54\":\"wontfix\",\"cf_status_firefox94\":\"---\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_tracking_firefox55\":\"+\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr52\":\"fixed\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_status_firefox_esr78\":\"---\"}},\"types\":[\"tracking\"],\"comments\":{\"cf_tracking_firefox55\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox_esr52\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox56\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1377426;
  BUGZILLA.bug_title = '1377426 - (CVE-2017-7803) Other CSP rules ignored when specifying sandbox \'allow-scripts\'';
  BUGZILLA.bug_summary = 'Other CSP rules ignored when specifying sandbox \'allow-scripts\'';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1377426';
  BUGZILLA.bug_keywords = 'sec-moderate',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/field.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/comments.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1377426">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1377426"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1377426 - (CVE-2017-7803) Other CSP rules ignored when specifying sandbox 'allow-scripts'">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="XU97K3Ji09s9q3yasErhPAWaz1J6JK1fwAOsr3KexMkYMOy4SzO5Qk9pzhXraTJPri1mV9htXAIKqbMjhlmdmwtnLoGD68g0odnrl4o91CqhYyOsLI1WamRAjoOrY7PWxDDfPgE0DimmmoDVMRNc9zldLRSnj8xBC5RNAna0KArTKz8IIFzjz23WJSfCLulGwohPmeMEedYTELjE0Fq8rScTFkKgAz6bOA9FUekclZp06LD2llymT1zymoOz1GtV">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1377426" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623203-8MeCy_HRO-YJh5-3Fgf9lqTzZq91N2a2xLbFx6pAMSs">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1377426" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1377426" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1377426">Bug 1377426</a>
          <span class="edit-hide">(CVE-2017-7803)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-06-30 04:30 PDT" data-time="1498822228">4 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2017-07-11 03:55 PDT" data-time="1499770551">4 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">Other CSP rules ignored when specifying sandbox 'allow-scripts'</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            Other CSP rules ignored when specifying sandbox 'allow-scripts'

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: DOM: Security, defect, P1)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=DOM%3A%20Security#DOM%3A%20Security" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">DOM: Security
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: DOM: Security</div>
            <div class="description">Native content-based security features including: Content Security Policy (CSP), Mixed Content Blocker (MCB), and Safe Browsing.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Security&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Security&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=DOM%3A%20Security"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="DOM: Security"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-version"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            55 Branch

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">P1
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;id&quot;:1377426,&quot;cf_status_firefox_esr52&quot;:&quot;fixed&quot;,&quot;priority&quot;:&quot;P1&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;keywords&quot;:[&quot;sec-moderate&quot;],&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;cf_tracking_firefox56&quot;:&quot;+&quot;,&quot;cf_status_firefox55&quot;:&quot;fixed&quot;,&quot;flags&quot;:[{&quot;name&quot;:&quot;sec-bounty&quot;,&quot;status&quot;:&quot;+&quot;},{&quot;status&quot;:&quot;+&quot;,&quot;name&quot;:&quot;in-testsuite&quot;},{&quot;name&quot;:&quot;qe-verify&quot;,&quot;status&quot;:&quot;-&quot;}],&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_status_firefox56&quot;:&quot;fixed&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_tracking_firefox55&quot;:&quot;+&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr52&quot;:&quot;55+&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;mozilla56&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_status_firefox54&quot;:&quot;wontfix&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla56

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox54</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox55</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox56</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr52-dirty">
  <select id="cf_tracking_firefox_esr52" name="cf_tracking_firefox_esr52">
        <option value="55+"
          id="v3130_cf_tracking_firefox_esr52" selected
        >55+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="fixed"
          id="v3137_cf_status_firefox_esr52" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox54</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox54-dirty">
  <select id="cf_status_firefox54" name="cf_status_firefox54">
        <option value="wontfix"
          id="v3047_cf_status_firefox54" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox55</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox55-dirty">
  <select id="cf_tracking_firefox55" name="cf_tracking_firefox55">
        <option value="+"
          id="v3175_cf_tracking_firefox55" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox55-dirty">
  <select id="cf_status_firefox55" name="cf_status_firefox55">
        <option value="fixed"
          id="v3183_cf_status_firefox55" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox56</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox56-dirty">
  <select id="cf_tracking_firefox56" name="cf_tracking_firefox56">
        <option value="+"
          id="v3273_cf_tracking_firefox56" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox56-dirty">
  <select id="cf_status_firefox56" name="cf_status_firefox56">
        <option value="fixed"
          id="v3281_cf_status_firefox56" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: rhys.enniks, Assigned: ckerschb)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_363267" ><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=363267" > <span class="fna">ckerschb</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_597894" ><img src="https://secure.gravatar.com/avatar/af3a0c14a9363631c16fa5a0b44fc45b?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=597894" > <span class="fna">rhys.enniks</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_363267" ><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=363267" > <span class="fna">ckerschb</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="10">10 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">CVE-2017-7788</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - allow-same-origin capability always granted in CSP sandbox directive"
   href="/show_bug.cgi?id=1396320">CVE-2017-7823</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list" id="field-blocked"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Audit use of NullPrincipal::Create() to see if we're missing origin attributes"
   href="/show_bug.cgi?id=1378552">1378552</a>
      </div>

        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1377426&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1377426">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-see_also" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
        ---
        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: sec-moderate, Whiteboard: [domsecurity-active][adv-main55+][adv-esr52.3+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2017-7803

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[domsecurity-active][adv-main55+][adv-esr52.3+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a1490670_1689"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1499266854"
      >sec-bounty</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag-1606839">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1606839-dirty">
      <select id="flag-1606839" name="flag-1606839"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
            <option value="+" selected>+</option>
      </select>
    </td>


  </tr>
          </tbody>
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_75935" ><a class="email " href="/user_profile?user_id=75935" > <span class="fna">RyanVM</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c25"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1500593665"
      >in-testsuite</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_75935" ><a class="email " href="/user_profile?user_id=75935" > <span class="fna">RyanVM</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag-1615348">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1615348-dirty">
      <select id="flag-1615348" name="flag-1615348"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" selected>+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
          </tbody>
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c18"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1500358890"
      >qe-verify</a>
    </td>

    <td class="flag-value">-
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag-1613166">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1613166-dirty">
      <select id="flag-1613166" name="flag-1613166"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
            <option value="-" selected>-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (3 files, 3 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8882535">firefox-csp-bug.zip</a>
        </div>
        <div>
            <a href="#c0" class="attach-time activity-ref"><span class="rel-time" title="2017-06-30 04:30 PDT" data-time="1498822228">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_597894" ><a class="email " href="/user_profile?user_id=597894" > <span class="fna">Rhys</span></a>
</div></span>
        </div>
        <div class="attach-info">1.94 KB,
          application/zip        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8882535&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8883021">bug_1377426_csp_sandbox_allow_scripts.patch</a>
        </div>
        <div>
            <a href="#c2" class="attach-time activity-ref"><span class="rel-time" title="2017-07-03 06:47 PDT" data-time="1499089672">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">2.59 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_1689" ><span class="fn">dveditz</span>
</div>:
              <a href="#a472313_1689"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499294541"
            >
              feedback-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8883021&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8883021&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8883021">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884300">bug_1377426_csp_sandbox_allow_scripts.patch</a>
        </div>
        <div>
            <a href="#c8" class="attach-time activity-ref"><span class="rel-time" title="2017-07-07 07:10 PDT" data-time="1499436657">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">3.10 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_1689" ><span class="fn">dveditz</span>
</div>:
              <a href="#c11"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499436657"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884300&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884300&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8884300">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885125">bug_1377426_csp_sandbox_allow_scripts.patch</a>
        </div>
        <div>
            <a href="#c12" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 23:49 PDT" data-time="1499755770">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">2.94 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_363267" ><span class="fn">ckerschb</span>
</div>:
              <a href="#c12"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499755770"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_580382" ><span class="fn">jcristau</span>
</div>:
              <a href="#c16"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1500284327"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_506302" ><span class="fn">gchang</span>
</div>:
              <a href="#c19"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1500284327"
            >
              approval-mozilla-esr52+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885125&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885125&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8885125">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8888327">esr53_set_csp_uplift.patch</a>
        </div>
        <div>
            <a href="#c21" class="attach-time activity-ref"><span class="rel-time" title="2017-07-20 07:57 PDT" data-time="1500562642">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">7.23 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8888327&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8888327&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8888327">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8888467">esr52_rebased_bug_1073952.patch</a>
        </div>
        <div>
            <a href="#c23" class="attach-time activity-ref"><span class="rel-time" title="2017-07-20 11:49 PDT" data-time="1500576569">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_363267" ><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div></span>
        </div>
        <div class="attach-info">9.95 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_428608" ><span class="fn">freddy</span>
</div>:
              <a href="#c24"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1500576569"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8888467&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8888467&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8888467">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="ZLnvRzYJZU064SlO2AiVNqXatCY8umbZw6gQxuwTcC759lB0">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12439575" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_597894" ><img src="https://secure.gravatar.com/avatar/af3a0c14a9363631c16fa5a0b44fc45b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_597894" ><a class="email " href="/user_profile?user_id=597894" > <span class="fna">Rhys</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-30 04:30 PDT" data-time="1498822228">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8882535"
         class="attachment"
         data-id="8882535" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="firefox-csp-bug.zip">
      <meta itemprop="contentSize" content="1990">
      <meta itemprop="encodingFormat" content="application/zip">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8882535" itemprop="contentUrl">
        <span id="att-8882535-description" itemprop="description">firefox-csp-bug.zip</span></a>
        — <a href="attachment.cgi?id=8882535&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-0" data-comment-id="12439575">User Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.36

Steps to reproduce:

I'm using a CSP rule (provided as a header, not meta tag) on a page or iframe, where the page contains a script, as follows:

Content-Security-Policy: sandbox allow-scripts; script-src 'none';

I tested this in Firefox 54 and the 55 beta on Linux 64 bit.




Actual results:

The script executes.


Expected results:

The script should not execute. If you remove the sandbox flag entirely from the CSP rule the script is blocked by the script-src 'none' rule. 

If you swap the identical sandbox rule to the iframe (if using an iframe) as an attribute on the iframe HTML (rather than via CSP) then the script is correctly blocked. My expectation would be for the behaviour here to be the same regardless of how you specify the sandboxing.

The example may seem contradictory (to specify allow-scripts to only then block all scripts) but I actually noticed this when attempting to both sandbox and limit scripts to a particular domain (rather than block off all scripts) but noticed that any script was being allowed through whenever the sandbox rule was present via CSP.

The scope of this issue may actually be wider than only allowing through scripts. 

I've attached a zip that should hopefully illustrate the basic issue (it includes a node/npm http server wrapper for convenience).</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12439671" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-30 07:12 PDT" data-time="1498831925">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="12439671">Christoph/Freddy, can you take a look?</pre><div class="activity"><div class="change">Group: firefox-core-security &rarr; core-security</div><div class="change">Component: Untriaged &rarr; DOM: Security</div><div class="change">Flags: needinfo?(fbraun)</div><div class="change">Flags: needinfo?(ckerschb)</div><div class="change">Product: Firefox &rarr; Core</div></div></div><div class="change-set" id="a14941_428608"><div class="change" id="aa14941_428608">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_428608" id="a14941_428608"><img src="https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_428608" id="a14941_428608"><a class="email " href="/user_profile?user_id=428608" > <span class="fna">Frederik Braun [:freddy] - vacation (back Nov 1st)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a14941_428608"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a14941_428608">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a14941_428608">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-30 08:39 PDT" data-time="1498837169">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(fbraun)</span></div></div></div><div class="change-set" id="a38790_1689"><div class="change" id="aa38790_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a38790_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a38790_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a38790_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a38790_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a38790_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-30 15:16 PDT" data-time="1498861018">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: core-security &rarr; dom-core-security</div></div></div><div class="change-set" id="c2"><div class="comment" data-id="12444235" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a38790_1689"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a38790_1689"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-03 06:47 PDT" data-time="1499089672">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8883021"
         class="attachment patch obsolete"
         data-id="8883021" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug_1377426_csp_sandbox_allow_scripts.patch">
      <meta itemprop="contentSize" content="2648">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8883021">
          <a class="link" href="attachment.cgi?id=8883021&amp;action=diff">
        <span id="att-8883021-description" itemprop="description">bug_1377426_csp_sandbox_allow_scripts.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8883021&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8883021">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-2" data-comment-id="12444235">Thanks for reporting, that is indeed a problem. Too bad that we have tests (Test 5 and 11 within dom/security/test/csp/test_sandbox.html) but actually not testing that exact scenario.

The problem is two fold:
a) we are resetting the principal to a fresh NullPrincipal (if allow-same-origin is not present) but not setting the CSP on that new NullPrincipal.
b) we just check the sandbox flags from the CSP.
I think we should check the merged sandbox flags of the iframe attribute as well as the CSP.

Dan, what do you think, agreed? Once you are fine with the change I'll flag smaug for the dom/ changes to make sure all three of us agree.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div><div class="change">
        <a href="/attachment.cgi?id=8883021&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8883021</a> -
        Flags: review?(dveditz)</div></div></div><div class="change-set" id="a267464_363267"><div class="change" id="aa267464_363267">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a267464_363267"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_363267" id="a267464_363267"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a267464_363267"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a267464_363267">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a267464_363267">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-03 06:48 PDT" data-time="1499089692">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; ckerschb</div><div class="change">Status: UNCONFIRMED &rarr; ASSIGNED</div><div class="change">Ever confirmed: true</div><div class="change">Priority: -- &rarr; P1</div><div class="change">Whiteboard: [domsecurity-active]</div></div></div><div class="change-set" id="a444626_1689"><div class="change" id="aa444626_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a444626_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a444626_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a444626_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a444626_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a444626_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 08:00 PDT" data-time="1499266854">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty?</div></div></div><div class="change-set" id="c3"><div class="comment" data-id="12449752" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a444626_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a444626_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 15:27 PDT" data-time="1499293664">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12449752">I half agree. Definitely need to set the CSP on the new principal! I'm ambivalent about the second check. If there were sandbox flags from elsewhere (which could only be an &lt;iframe&gt; sandbox attribute, right?) wouldn't they already be applied, and the null principal created if necessary? It probably doesn't hurt much to do it your way, but you're guaranteed to always create _two_ null principals for every iframe SANDBOXED_ORIGIN, even when the majority have no CSP. Or at least no CSP sandbox directives; I suppose you wouldn't reach this point if there were no CSP at all.

If you're in an iframe SANDBOXED_ORIGIN and already have a null principal then you don't need to create a second one if the CSP is also SANDBOXED_ORIGIN. You'd have to check for that before you merge the sandbox policies so you could leave it always creating the second null principal in that case if you want. Something like

  bool needNewNullPrincipal = (cspSandboxFlags &amp; SANDBOXED_ORIGIN) &amp;&amp; !(mSandboxFlags &amp; SANDBOXED_ORIGIN);
  mSandboxFlags |= cspSandboxFlags;
  if (needNewNullPrincipal) { ... }

My biggest worry about this code predates your patch: the Null principal has no Origin Attributes! A document with a CSP sandbox directive (or in your version of the patch all iframe sandbox docs too!) will escape their container. I think you need to use NullPrincipal::CreateWithInheritedAttributes(principal) instead.

That makes me worry about all the other places in the code that call NullPrincipal::Create() with no attribute arguments. Some are probably internal/chrome things, but I bet at least some are wrong.</pre></div><div class="change-set" id="a471903_1689"><div class="change" id="aa471903_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a471903_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a471903_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a471903_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a471903_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a471903_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 15:35 PDT" data-time="1499294131">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Audit use of NullPrincipal::Create() to see if we're missing origin attributes"
   href="/show_bug.cgi?id=1378552">1378552</a></div></div></div><div class="change-set" id="c4"><div class="comment" data-id="12449780" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a471903_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a471903_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 15:38 PDT" data-time="1499294328">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="12449780">created <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Audit use of NullPrincipal::Create() to see if we're missing origin attributes"
   href="/show_bug.cgi?id=1378552">bug 1378552</a> to audit other uses of NullPrincipal::Create().</pre></div><div class="change-set" id="a472313_1689"><div class="change" id="aa472313_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a472313_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a472313_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a472313_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a472313_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 15:42 PDT" data-time="1499294541">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8883021&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8883021</a> -
        Flags: review?(dveditz) &rarr; feedback-</div></div></div><div class="change-set" id="c5"><div class="comment" data-id="12451037" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_597894" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/af3a0c14a9363631c16fa5a0b44fc45b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_597894" id="a472313_1689"><a class="email " href="/user_profile?user_id=597894" > <span class="fna">Rhys</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 03:54 PDT" data-time="1499338447">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12451037">As a slight side-note, we've said a couple of times in these comments about 'merging' the sandbox policies from CSP and the iframe. This might just be me being slightly pedantic with the terminology, but do we agree it should actually be an intersection of the flags rather than a merge?

e.g. if the iframe sets allow-scripts but CSP does not, I'd expect no scripts to be able to run

iframe ['allow-scripts', 'allow-same-origin', 'allow-popups']
CSP ['allow-same-origin']
resultant applied policy ['allow-same-origin']</pre></div><div class="change-set" id="c6"><div class="comment" data-id="12452242" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a472313_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 10:53 PDT" data-time="1499363619">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12452242">Calling this &quot;sec-moderate&quot; as a CSP bypass for now, but it's not one an attacker can force on a site so &quot;bypass&quot; isn't exactly the right word for it.</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a></div></div></div><div class="change-set" id="c7"><div class="comment" data-id="12452406" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_597894" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/af3a0c14a9363631c16fa5a0b44fc45b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_597894" id="a472313_1689"><a class="email " href="/user_profile?user_id=597894" > <span class="fna">Rhys</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 11:47 PDT" data-time="1499366825">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12452406">There is a category of websites where this would probably pose a more serious risk to a user.

If you imagine any scenario where you run a service that facilitates HTML transfer in some way; like a HTML page designer where the attacker can save some HTML against your service (or any variation on that, jsfiddle etc) and create a URL that they can share to someone else. Maybe your service attempts to turn off javascript by sandboxing the attacker-supplied HTML for safety or limit the URLs of scripts and resources to known good URLs/scripts.

By taking advantage of this issue they'd be able to run potentially malicious js in another user's browser.</pre></div><div class="change-set" id="c8"><div class="comment" data-id="12454459" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a472313_1689"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-07 07:10 PDT" data-time="1499436657">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884300"
         class="attachment patch obsolete"
         data-id="8884300" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug_1377426_csp_sandbox_allow_scripts.patch">
      <meta itemprop="contentSize" content="3173">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884300">
          <a class="link" href="attachment.cgi?id=8884300&amp;action=diff">
        <span id="att-8884300-description" itemprop="description">bug_1377426_csp_sandbox_allow_scripts.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8884300&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8884300">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-8" data-comment-id="12454459">(In reply to Daniel Veditz [:dveditz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c3">comment #3</a>)
<span class="quote">&gt; If you're in an iframe SANDBOXED_ORIGIN and already have a null principal
&gt; then you don't need to create a second one if the CSP is also
&gt; SANDBOXED_ORIGIN.</span >

In fact that makes sense to me. Just for the sake of completeness, we wouldn't reach that code if a site has no CSP, so we wouldn't create two null principals for every sandboxed iframe, but I agree with your solution, that makes more sense to only create a new NullPrincipal if necessarily required by CSP.

<span class="quote">&gt; My biggest worry about this code predates your patch: the Null principal has
&gt; no Origin Attributes! A document with a CSP sandbox directive (or in your
&gt; version of the patch all iframe sandbox docs too!) will escape their
&gt; container.</span >

I haven't paid attention to that when writing the patch, but you are absolutely right, we need to fix that too within this patch and propagate OA correctly for that case.

(In reply to Rhys from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c5">comment #5</a>)
<span class="quote">&gt; As a slight side-note, we've said a couple of times in these comments about
&gt; 'merging' the sandbox policies from CSP and the iframe. This might just be
&gt; me being slightly pedantic with the terminology, but do we agree it should
&gt; actually be an intersection of the flags rather than a merge?
&gt; 
&gt; e.g. if the iframe sets allow-scripts but CSP does not, I'd expect no
&gt; scripts to be able to run</span >
&gt;
<span class="quote">&gt; iframe ['allow-scripts', 'allow-same-origin', 'allow-popups']
&gt; CSP ['allow-same-origin']
&gt; resultant applied policy ['allow-same-origin']</span >

At the moment we use an OR operation to merge the flags &gt;&gt; mSandboxFlags |= cspSandboxFlags; &lt;&lt; which means we really 'merge' the flags. I think this is what should be  happening, but that also means that the resultant policy would be ['allow-scripts', 'allow-same-origin', 'allow-popups'].</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8883021&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8883021</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8884300&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8884300</a> -
        Flags: review?(dveditz)</div></div></div><div class="change-set" id="c9"><div class="comment" data-id="12454522" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_597894" id="a472313_1689"><img src="https://secure.gravatar.com/avatar/af3a0c14a9363631c16fa5a0b44fc45b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_597894" id="a472313_1689"><a class="email " href="/user_profile?user_id=597894" > <span class="fna">Rhys</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-07 07:36 PDT" data-time="1499438211">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="12454522">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c8">comment #8</a>)

<span class="quote">&gt; At the moment we use an OR operation to merge the flags &gt;&gt; mSandboxFlags |=
&gt; cspSandboxFlags; &lt;&lt; which means we really 'merge' the flags. I think this is
&gt; what should be  happening, but that also means that the resultant policy
&gt; would be ['allow-scripts', 'allow-same-origin', 'allow-popups'].</span >

If that's the case, doing some local tests that seems to be a different behaviour to Edge and Chrome which appear to require the two policies to agree to apply a loosening flag (I'm trying to track down more info on what's supposed to happen here but not turning up anything useful thus far).</pre></div><div class="change-set" id="a896221_75935"><div class="change" id="aa896221_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a896221_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a896221_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a896221_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a896221_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a896221_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 13:27 PDT" data-time="1499718449">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=isnotempty">status-firefox54</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div></div></div><div class="change-set" id="c10"><div class="comment" data-id="12461561" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a896221_75935"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a896221_75935"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 15:11 PDT" data-time="1499724678">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="12461561"><span class="quote">&gt; &gt; but that also means that the resultant policy
&gt; &gt; would be ['allow-scripts', 'allow-same-origin', 'allow-popups'].
&gt; 
&gt; If that's the case, doing some local tests that seems to be a different
&gt; behaviour to Edge and Chrome which appear to require the two policies to
&gt; agree to apply a loosening flag (I'm trying to track down more info on
&gt; what's supposed to happen here but not turning up anything useful thus far).</span >

All the flags are on by default and the &quot;allow-&quot; directives turn them *off*. So allow-scripts (0) ORd with default SANDBOXED_ORIGIN (0x10) is SANDBOXED_ORIGIN, etc. The resulting merged policy will be what we all expect: unless all policies allow something it stays default blocked. See <a rel="nofollow" href="https://searchfox.org/mozilla-central/rev/5dadcbe55b4ddd1e448c06c77390ff6483aa009b/dom/base/nsContentUtils.cpp#1587">https://searchfox.org/mozilla-central/rev/5dadcbe55b4ddd1e448c06c77390ff6483aa009b/dom/base/nsContentUtils.cpp#1587</a></pre></div><div class="change-set" id="c11"><div class="comment" data-id="12461594" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a896221_75935"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a896221_75935"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 15:26 PDT" data-time="1499725560">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="12461594">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8884300" name="attach_8884300" title="bug_1377426_csp_sandbox_allow_scripts.patch">attachment 8884300</a> <a href="/attachment.cgi?id=8884300&amp;action=edit" title="bug_1377426_csp_sandbox_allow_scripts.patch">[details]</a> <a href="/attachment.cgi?id=8884300&amp;action=diff" title="bug_1377426_csp_sandbox_allow_scripts.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8884300'>[review]</a>
bug_1377426_csp_sandbox_allow_scripts.patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8884300" name="attach_8884300" title="bug_1377426_csp_sandbox_allow_scripts.patch">attachment 8884300</a> <a href="/attachment.cgi?id=8884300&amp;action=edit" title="bug_1377426_csp_sandbox_allow_scripts.patch">[details]</a> <a href="/attachment.cgi?id=8884300&amp;action=diff" title="bug_1377426_csp_sandbox_allow_scripts.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8884300'>[review]</a>:
-----------------------------------------------------------------

r=dveditz

The logic is correct and I'm happy with it. I left some comments that are strictly my opinion about readability -- ignore or not as you wish.

::: dom/base/nsDocument.cpp
&#64;&#64; +2798,1 &#64;&#64;
<span class="quote">&gt;    mSandboxFlags |= cspSandboxFlags;</span >

mSandboxFlags isn't used in the below. Could we move it below the if-block so it doesn't confuse what's going on? Otherwise people will try to figure out why it's relevant here. Could even give it its own comment like &quot;merge the CSP sandbox directives into any pre-existing sandbox flags&quot;

&#64;&#64; +2800,2 &#64;&#64;
<span class="quote">&gt;      // If the new CSP sandbox flags do not have the allow-same-origin flag
&gt;      // reset the document principal to a null principal</span >

Readability nit: do we need both comments now? they're mostly saying the same thing. could re-use this inner comment with some tweaks for the outer comment:

  // If the new CSP sandbox flags do not have the allow-same-origin flag
  // reset the document principal to a null principal, unless the document
  // is a sandboxed iframe and already has a new null principal.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884300&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8884300</a> -
        Flags: review?(dveditz) &rarr; review+</div></div></div><div class="change-set" id="c12"><div class="comment" data-id="12462444" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a896221_75935"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a896221_75935"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 23:49 PDT" data-time="1499755770">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885125"
         class="attachment patch"
         data-id="8885125" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bug_1377426_csp_sandbox_allow_scripts.patch">
      <meta itemprop="contentSize" content="3009">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885125">
          <a class="link" href="attachment.cgi?id=8885125&amp;action=diff">
        <span id="att-8885125-description" itemprop="description">bug_1377426_csp_sandbox_allow_scripts.patch</span></a>
        — <a href="attachment.cgi?id=8885125&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8885125">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-12" data-comment-id="12462444">Thanks Dan. Incorporated your nits. Carrying over r+.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884300&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8884300</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8885125&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8885125</a> -
        Flags: review+</div></div></div><div class="change-set" id="c13"><div class="comment" data-id="12463077" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_277293" id="a896221_75935"><img src="https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_277293" id="a896221_75935"><a class="email disabled" href="/user_profile?user_id=277293" > <span class="fna">Carsten Book [:Tomcat]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 03:55 PDT" data-time="1499770551">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12463077"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/43260cd0305b">https://hg.mozilla.org/mozilla-central/rev/43260cd0305b</a></pre><div class="activity"><div class="change">Status: ASSIGNED &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2017-07-11 03:55 PDT" data-time="1499770551">4 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla56</div></div></div><div class="change-set" id="a966489_1689"><div class="change" id="aa966489_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a966489_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a966489_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a966489_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a966489_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a966489_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 08:58 PDT" data-time="1499788717">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: dom-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="c14"><div class="comment" data-id="12475668" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a966489_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a966489_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-15 09:26 PDT" data-time="1500135997">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="12475668">Please request Beta/ESR52 approval on this when you're comfortable doing so.</pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12478515" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a966489_1689"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a966489_1689"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 02:38 PDT" data-time="1500284327">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12478515">Comment on <span class=""><a href="/attachment.cgi?id=8885125" name="attach_8885125" title="bug_1377426_csp_sandbox_allow_scripts.patch">attachment 8885125</a> <a href="/attachment.cgi?id=8885125&amp;action=edit" title="bug_1377426_csp_sandbox_allow_scripts.patch">[details]</a> <a href="/attachment.cgi?id=8885125&amp;action=diff" title="bug_1377426_csp_sandbox_allow_scripts.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8885125'>[review]</a>
bug_1377426_csp_sandbox_allow_scripts.patch

Approval Request Comment
The problem itself allows to drop CSP enforcement if certain iframe sandbox flags are set as iframe attribute as well as CSP flag. The reason we should consider this for ESR though is that we don't set OA on the new principal which allows to break out of the container - we should fix that.

[Feature/Bug causing the regression]:
I think this problem has been in our codebase since we introduced CSP.

[User impact if declined]:
CSP enforcement might be dropped in certain conditions. E.g. when special sandbox flags are set as an iframe attribute as well as within the shipped CSP.

[Is this code covered by automated tests?]:
Yes

[Has the fix been verified in Nightly?]:
Not yet.

[Needs manual test from QE? If yes, steps to reproduce]:
No (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c0">comment 0</a> if needed)
[List of other uplifts needed for the feature/fix]:
none

[Is the change risky?]:
No, small change that only affects CSP.

[Why is the change risky/not risky?]:
see above

[String changes made/needed]:
No


[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: 
see above

Fix Landed on Version:
55

Risk to taking this patch (and alternatives if risky):
String or UUID changes made by this patch: 
No</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div><div class="change">
        <a href="/attachment.cgi?id=8885125&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8885125</a> -
        Flags: approval-mozilla-esr52?</div><div class="change">
        <a href="/attachment.cgi?id=8885125&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8885125</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c16"><div class="comment" data-id="12478854" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a966489_1689"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_580382" id="a966489_1689"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 05:22 PDT" data-time="1500294153">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12478854">Comment on <span class=""><a href="/attachment.cgi?id=8885125" name="attach_8885125" title="bug_1377426_csp_sandbox_allow_scripts.patch">attachment 8885125</a> <a href="/attachment.cgi?id=8885125&amp;action=edit" title="bug_1377426_csp_sandbox_allow_scripts.patch">[details]</a> <a href="/attachment.cgi?id=8885125&amp;action=diff" title="bug_1377426_csp_sandbox_allow_scripts.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8885125'>[review]</a>
bug_1377426_csp_sandbox_allow_scripts.patch

csp bypass fix, beta55+</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885125&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8885125</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c17"><div class="comment" data-id="12479377" data-no="17"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a966489_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a966489_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 08:18 PDT" data-time="1500304710">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12479377"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/dc00e73c06e1">https://hg.mozilla.org/releases/mozilla-beta/rev/dc00e73c06e1</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a1490670_1689"><div class="change" id="aa1490670_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a1490670_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a1490670_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1490670_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1490670_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a1490670_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 10:34 PDT" data-time="1500312898">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty? &rarr; sec-bounty+</div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12481845" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a1490670_1689"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_488993" id="a1490670_1689"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 23:21 PDT" data-time="1500358890">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12481845">(In reply to Christoph Kerschbaumer [:ckerschb] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c15">comment #15</a>)
<span class="quote">&gt; [Is this code covered by automated tests?]:
&gt; Yes
&gt; 
&gt; [Has the fix been verified in Nightly?]:
&gt; Not yet.
&gt; 
&gt; [Needs manual test from QE? If yes, steps to reproduce]:
&gt; No (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c0">comment 0</a> if needed)</span >

Setting qe-verify- based on Christoph's assessment on manual testing needs and the fact that this fix has automated coverage.</pre><div class="activity"><div class="change">Flags: qe-verify-</div></div></div><div class="change-set" id="a1594651_280903"><div class="change" id="aa1594651_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a1594651_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a1594651_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1594651_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1594651_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a1594651_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-18 15:27 PDT" data-time="1500416879">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2017-7803</div><div class="change">Whiteboard: [domsecurity-active] &rarr; [domsecurity-active][adv-main55+]</div></div></div><div class="change-set" id="c19"><div class="comment" data-id="12485194" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506302" id="a1594651_280903"><img src="https://secure.gravatar.com/avatar/58cce0c47d9c6efb7d83bc34b9d79816?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506302" id="a1594651_280903"><a class="email disabled" href="/user_profile?user_id=506302" > <span class="fna">Gerry Chang [:gchang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-18 19:35 PDT" data-time="1500431759">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12485194">Comment on <span class=""><a href="/attachment.cgi?id=8885125" name="attach_8885125" title="bug_1377426_csp_sandbox_allow_scripts.patch">attachment 8885125</a> <a href="/attachment.cgi?id=8885125&amp;action=edit" title="bug_1377426_csp_sandbox_allow_scripts.patch">[details]</a> <a href="/attachment.cgi?id=8885125&amp;action=diff" title="bug_1377426_csp_sandbox_allow_scripts.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8885125'>[review]</a>
bug_1377426_csp_sandbox_allow_scripts.patch

Fix a security issue. Let's uplift it to ESR52.3.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885125&amp;action=edit"
           title="bug_1377426_csp_sandbox_allow_scripts.patch"
           class=""
        >Attachment #8885125</a> -
        Flags: approval-mozilla-esr52? &rarr; approval-mozilla-esr52+</div></div></div><div class="change-set" id="a1671231_1689"><div class="change" id="aa1671231_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a1671231_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a1671231_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1671231_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1671231_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a1671231_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-19 12:44 PDT" data-time="1500493459">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=isnotempty">tracking-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=isnotempty">tracking-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a></div></div></div><div class="change-set" id="c20"><div class="comment" data-id="12488148" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a1671231_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a1671231_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-19 15:12 PDT" data-time="1500502323">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12488148">I attempted to land this on ESR52 but had to backout because it doesn't have SetCsp there :(. You can use the commit below as a starting point as it already has some rebasing done.
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/79adc16a40b7594052325812b1a8339f6f61d09b">https://hg.mozilla.org/releases/mozilla-esr52/rev/79adc16a40b7594052325812b1a8339f6f61d09b</a></pre><div class="activity"><div class="change">Flags: needinfo?(ckerschb)</div></div></div><div class="change-set" id="c21"><div class="comment" data-id="12490360" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a1671231_1689"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a1671231_1689"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 07:57 PDT" data-time="1500562642">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8888327"
         class="attachment patch obsolete"
         data-id="8888327" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="esr53_set_csp_uplift.patch">
      <meta itemprop="contentSize" content="7408">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8888327">
          <a class="link" href="attachment.cgi?id=8888327&amp;action=diff">
        <span id="att-8888327-description" itemprop="description">esr53_set_csp_uplift.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8888327&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8888327">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-21" data-comment-id="12490360">(In reply to Ryan VanderMeulen [:RyanVM] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Other CSP rules ignored when specifying sandbox 'allow-scripts'"
   href="/show_bug.cgi?id=1377426#c20">comment #20</a>)
<span class="quote">&gt; I attempted to land this on ESR52 but had to backout because it doesn't have
&gt; SetCsp there :(. You can use the commit below as a starting point as it
&gt; already has some rebasing done.
&gt; <a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/">https://hg.mozilla.org/releases/mozilla-esr52/rev/</a>
&gt; 79adc16a40b7594052325812b1a8339f6f61d09b</span >

Ryan, using your rebased patch ^^ as well as also uplifting the SetCSP parts from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">Bug 1073952</a> (within this patch) it seems everything works. I ran a bunch of tests locally including test_sandbox.html -&gt; seems to work. Dunno what kind of commit message we would need for this patch though.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(ckerschb)</span></div></div></div><div class="change-set" id="c22"><div class="comment" data-id="12491152" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a1671231_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a1671231_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 11:09 PDT" data-time="1500574199">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="12491152">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8888327" name="attach_8888327" title="esr53_set_csp_uplift.patch">attachment 8888327</a> <a href="/attachment.cgi?id=8888327&amp;action=edit" title="esr53_set_csp_uplift.patch">[details]</a> <a href="/attachment.cgi?id=8888327&amp;action=diff" title="esr53_set_csp_uplift.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8888327'>[review]</a>
esr53_set_csp_uplift.patch

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8888327" name="attach_8888327" title="esr53_set_csp_uplift.patch">attachment 8888327</a> <a href="/attachment.cgi?id=8888327&amp;action=edit" title="esr53_set_csp_uplift.patch">[details]</a> <a href="/attachment.cgi?id=8888327&amp;action=diff" title="esr53_set_csp_uplift.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8888327'>[review]</a>:
-----------------------------------------------------------------

<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">bug 1073952</a> is nearly the same as this bug (maybe a little less impact). We should really just take all of it. Landing 7 of 8 chunks and then not actually fixing the old problem just looks silly.</pre></div><div class="change-set" id="a1751991_1689"><div class="change" id="aa1751991_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a1751991_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a1751991_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1751991_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1751991_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a1751991_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 11:10 PDT" data-time="1500574219">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">CVE-2017-7788</a></div></div></div><div class="change-set" id="c23"><div class="comment" data-id="12491297" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_363267" id="a1751991_1689"><img src="https://secure.gravatar.com/avatar/72977b89c86da4a19d3cf1d5920ea341?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_363267" id="a1751991_1689"><a class="email " href="/user_profile?user_id=363267" > <span class="fna">Christoph Kerschbaumer [:ckerschb]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 11:49 PDT" data-time="1500576569">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8888467"
         class="attachment patch"
         data-id="8888467" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="esr52_rebased_bug_1073952.patch">
      <meta itemprop="contentSize" content="10190">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8888467">
          <a class="link" href="attachment.cgi?id=8888467&amp;action=diff">
        <span id="att-8888467-description" itemprop="description">esr52_rebased_bug_1073952.patch</span></a>
        — <a href="attachment.cgi?id=8888467&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1377426&attachment=8888467">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-23" data-comment-id="12491297">Freddy, instead of just uplifting the SetCSP bits from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">Bug 1073952</a>, we decided to take that whole patch (modulo tests). Since the patch did not apply completely cleanly I had to manually rebase the patch. Can you take a look and make sure I haven't missed anything? Thanks.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8888327&amp;action=edit"
           title="esr53_set_csp_uplift.patch"
           class=""
        >Attachment #8888327</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8888467&amp;action=edit"
           title="esr52_rebased_bug_1073952.patch"
           class=""
        >Attachment #8888467</a> -
        Flags: review?(fbraun)</div></div></div><div class="change-set" id="c24"><div class="comment" data-id="12491394" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_428608" id="a1751991_1689"><img src="https://secure.gravatar.com/avatar/1f41f3ef916e1c1fc9401cf3212a6708?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_428608" id="a1751991_1689"><a class="email " href="/user_profile?user_id=428608" > <span class="fna">Frederik Braun [:freddy] - vacation (back Nov 1st)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 12:21 PDT" data-time="1500578518">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="12491394">Comment on <span class=""><a href="/attachment.cgi?id=8888467" name="attach_8888467" title="esr52_rebased_bug_1073952.patch">attachment 8888467</a> <a href="/attachment.cgi?id=8888467&amp;action=edit" title="esr52_rebased_bug_1073952.patch">[details]</a> <a href="/attachment.cgi?id=8888467&amp;action=diff" title="esr52_rebased_bug_1073952.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8888467'>[review]</a>
esr52_rebased_bug_1073952.patch

Review of <span class=""><a href="/attachment.cgi?id=8888467" name="attach_8888467" title="esr52_rebased_bug_1073952.patch">attachment 8888467</a> <a href="/attachment.cgi?id=8888467&amp;action=edit" title="esr52_rebased_bug_1073952.patch">[details]</a> <a href="/attachment.cgi?id=8888467&amp;action=diff" title="esr52_rebased_bug_1073952.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1377426&amp;attachment=8888467'>[review]</a>:
-----------------------------------------------------------------

Yep, r+.
Got confused for a second but this is a rebase of <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CSP can be bypassed with &lt;iframe [sandbox] and [srcdoc]&gt;"
   href="/show_bug.cgi?id=1073952">bug 1073952</a> as well as <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Assertion failure: !mCSP (do not destroy an existing CSP), at nsNullPrincipal.cpp:116"
   href="/show_bug.cgi?id=1349517">bug 1349517</a> (a follow up fix that prevented some crashy corner cases).</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8888467&amp;action=edit"
           title="esr52_rebased_bug_1073952.patch"
           class=""
        >Attachment #8888467</a> -
        Flags: review?(fbraun) &rarr; review+</div></div></div><div class="change-set" id="c25"><div class="comment" data-id="12492145" data-no="25"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a1751991_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a1751991_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-20 16:34 PDT" data-time="1500593665">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="12492145"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/c52d8ce8d5df">https://hg.mozilla.org/releases/mozilla-esr52/rev/c52d8ce8d5df</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Flags: in-testsuite+</div></div></div><div class="change-set" id="a2377368_280903"><div class="change" id="aa2377368_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a2377368_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a2377368_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2377368_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2377368_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a2377368_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-27 16:53 PDT" data-time="1501199596">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [domsecurity-active][adv-main55+] &rarr; [domsecurity-active][adv-main55+][adv-esr52.3+]</div></div></div><div class="change-set" id="a5822420_1689"><div class="change" id="aa5822420_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a5822420_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a5822420_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5822420_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5822420_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a5822420_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-05 13:50 PDT" data-time="1504644648">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - allow-same-origin capability always granted in CSP sandbox directive"
   href="/show_bug.cgi?id=1396320">CVE-2017-7823</a></div></div></div><div class="change-set" id="a18710085_1689"><div class="change" id="aa18710085_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a18710085_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a18710085_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a18710085_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a18710085_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1377426#a18710085_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-01 16:45 PST" data-time="1517532313">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1377426&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>