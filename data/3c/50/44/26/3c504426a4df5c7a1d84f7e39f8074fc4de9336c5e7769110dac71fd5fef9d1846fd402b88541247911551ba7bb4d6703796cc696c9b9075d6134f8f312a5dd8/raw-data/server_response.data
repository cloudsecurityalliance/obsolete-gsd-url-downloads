<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 681081 – gpg passphrase cached forever</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=681081&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=681081" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 681081 – gpg passphrase cached forever",  
                             "show_bug.cgi?id=681081" );
        document.title = "Bug 681081 – gpg passphrase cached forever";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 681081 – gpg passphrase cached forever", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_gnome-keyring bz_component_gpg-agent bz_bug_681081 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 681081</p>
</td>
<td id="subtitle">
<p class="subheader">gpg passphrase cached forever</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2012-08-21 06:29:36 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2012-08-21 06:29:36"/>
<input name="longdesclength" type="hidden" value="22"/>
<input name="id" type="hidden" value="681081"/>
<input name="token" type="hidden" value="1626106481-S7fgeYgMUMgjFwhebdt_fVf7JpxJxAadDVU40tvsgug"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=681081"><b>Bug 681081</b></a> -<span class="bz_default_hidden" id="summary_alias_container">
<span id="short_desc_nonedit_display">gpg passphrase cached forever</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">
</td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>gpg passphrase cached forever
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('gpg passphrase cached forever', '');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">gnome-keyring</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Core</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=gnome-keyring" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">gpg-agent</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>3.4.x
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       Linux
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       major
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>---
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard"><span class="fn">GNOME keyring maintainer(s)</span>
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard"><span class="fn">GNOME keyring maintainer(s)</span>
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'gnome-keyring-maint\x40gnome.bugs',
        'gnome-keyring-maint\x40gnome.bugs');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2012-08-02 15:53 UTC by <span class="vcard"><span class="fn">Laurent Bigonville</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2012-08-21 06:29 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">---</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a1">
<td valign="top">
<a href="attachment.cgi?id=220633" title="View the content of the attachment">
<b>schema: Update description for gpg-cache-method</b></a>
<span class="bz_attach_extra_info">
              (1.24 KB,
                patch)

            <br/>
<a href="#attach_220633" title="Go to the comment associated with the attachment">2012-08-08 04:08 UTC</a>,

            <span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=220633&amp;action=edit">Details</a>  |
    <a href="review?bug=681081&amp;attachment=220633">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a2">
<td valign="top">
<a href="attachment.cgi?id=220634" title="View the content of the attachment">
<b><span class="bz_obsolete">gpg-agent: Hook up the TTL cache option</span></b></a>
<span class="bz_attach_extra_info">
              (2.66 KB,
                patch)

            <br/>
<a href="#attach_220634" title="Go to the comment associated with the attachment">2012-08-08 04:08 UTC</a>,

            <span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=220634&amp;action=edit">Details</a>  |
    <a href="review?bug=681081&amp;attachment=220634">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a3">
<td valign="top">
<a href="attachment.cgi?id=220674" title="View the content of the attachment">
<b>gpg-agent: Hook up the TTL cache option</b></a>
<span class="bz_attach_extra_info">
              (3.14 KB,
                patch)

            <br/>
<a href="#attach_220674" title="Go to the comment associated with the attachment">2012-08-08 13:30 UTC</a>,

            <span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=220674&amp;action=edit">Details</a>  |
    <a href="review?bug=681081&amp;attachment=220674">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a4">
<td valign="top">
<a href="attachment.cgi?id=220675" title="View the content of the attachment">
<b>secret-store: Mark a secret item as 'used' when accessed</b></a>
<span class="bz_attach_extra_info">
              (1007 bytes,
                patch)

            <br/>
<a href="#attach_220675" title="Go to the comment associated with the attachment">2012-08-08 13:30 UTC</a>,

            <span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=220675&amp;action=edit">Details</a>  |
    <a href="review?bug=681081&amp;attachment=220675">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Laurent Bigonville</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-02 15:53:56 UTC
        </span>
</div>
<pre class="bz_comment_text">Hi,

The following bug has been reported on the Debian BTS:

=====8&lt;====

At some point gnome-keyring seemed to obey the configuration asking it
to stop caching passphrases after a while.  It no longer does.

$ gsettings list-recursively org.gnome.crypto.cache
org.gnome.crypto.cache gpg-cache-authorize false
org.gnome.crypto.cache gpg-cache-method 'idle'
org.gnome.crypto.cache gpg-cache-ttl 600

Yet I'm never asked for the passphrase again.

=====8&lt;====

An other person has also reported that he saw the same behavior with "org.gnome.crypto.cache gpg-cache-method 'timeout'"

For more information please see <a href="http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=683655">http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=683655</a></pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 04:08:34 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=220633" name="attach_220633" title="schema: Update description for gpg-cache-method">attachment 220633</a> <a href="attachment.cgi?id=220633&amp;action=edit" title="schema: Update description for gpg-cache-method">[details]</a></span> <a href="review?bug=681081&amp;attachment=220633">[review]</a>
schema: Update description for gpg-cache-method

 * Document the various method strings that can be present here</pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 04:08:37 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=220634" name="attach_220634" title="gpg-agent: Hook up the TTL cache option">attachment 220634</a> <a href="attachment.cgi?id=220634&amp;action=edit" title="gpg-agent: Hook up the TTL cache option">[details]</a></span> <a href="review?bug=681081&amp;attachment=220634">[review]</a>
gpg-agent: Hook up the TTL cache option

 * So that when the gsettings gpg-cache-method is 'idle' or 'timeout'
   we use gpg-cache-ttl to control how long the passphrase is cached
   for.
 * This is a regression from 3.3.x</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 04:09:15 UTC
        </span>
</div>
<pre class="bz_comment_text">Would it be possible to try out the above patch and see if it fixes the problem for you?</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Raphael Hertzog</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 12:41:01 UTC
        </span>
</div>
<pre class="bz_comment_text">I tested your patch with the "idle" method but it looks like "idle" is handled like "timeout". It does not reset the cache period everytime that you access the GPG key.

But at least there's again some automatic expiration because after the delay I had to re-enter my passphrase (as expected).

(BTW older versions had an option to require a confirmation before allowing the use of the GPG key, this was a nice option, it would be nice to have it back too)</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Raphael Hertzog</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 13:00:01 UTC
        </span>
</div>
<pre class="bz_comment_text">In fact, reading the code I believe that the passphrase is now always cached for gpg-cache-ttl seconds as soon as gpg-cache-method is different from always. This means that the semantics of gpg-cache-method="session" (the default) changed.

And gpg-cache-ttl defaults to 300 (i.e. a non-zero value) so it affects everybody automatically.

(For reference I applied the patches on top of gnome-keyring 3.4.1 and that's the code I have been reading)</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 13:30:47 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=220674" name="attach_220674" title="gpg-agent: Hook up the TTL cache option">attachment 220674</a> <a href="attachment.cgi?id=220674&amp;action=edit" title="gpg-agent: Hook up the TTL cache option">[details]</a></span> <a href="review?bug=681081&amp;attachment=220674">[review]</a>
gpg-agent: Hook up the TTL cache option

* So that when the gsettings gpg-cache-method is 'idle' or 'timeout'
   we use gpg-cache-ttl to control how long the passphrase is cached
   for.
 * This is a regression from 3.3.x</pre>
</div><div class="bz_comment" id="c7">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c7">Comment 7</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 13:30:56 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=220675" name="attach_220675" title="secret-store: Mark a secret item as 'used' when accessed">attachment 220675</a> <a href="attachment.cgi?id=220675&amp;action=edit" title="secret-store: Mark a secret item as 'used' when accessed">[details]</a></span> <a href="review?bug=681081&amp;attachment=220675">[review]</a>
secret-store: Mark a secret item as 'used' when accessed

* This makes the gpg-agent idle feature work correctly</pre>
</div><div class="bz_comment" id="c8">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c8">Comment 8</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 13:32:12 UTC
        </span>
</div>
<pre class="bz_comment_text">Thank you for the review :)

Indeed, both of those were broken. Could you test the two new attached patches?

Off hand, I believe that the code surrounding these patches hasn't changed that much since 3.4.x and that shouldn't be a problem.</pre>
</div><div class="bz_comment" id="c9">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c9">Comment 9</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Raphael Hertzog</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 14:37:22 UTC
        </span>
</div>
<pre class="bz_comment_text">It seems to work for me with those two patches. I tested the correct behaviour of "idle", "timeout" and "session".

Following the earlier code review, I still wonder what's the point of the gcr_prompt_get_choice_chosen() check since the prompt shown to the user (by GNOME Shell?) has no options at all to allow permanent storage of the passphrase...</pre>
</div><div class="bz_comment" id="c10">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c10">Comment 10</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 14:45:57 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c9">comment #9</a>)
<span class="quote">&gt; Following the earlier code review, I still wonder what's the point of the
&gt; gcr_prompt_get_choice_chosen() check since the prompt shown to the user (by
&gt; GNOME Shell?) has no options at all to allow permanent storage of the
&gt; passphrase...</span>

It does when the 'login' keyring is already unlocked, and thus the daemon is able to store the passphrase permanently in the login keyring.</pre>
</div><div class="bz_comment" id="c11">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c11">Comment 11</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 15:03:10 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c4">comment #4</a>)
<span class="quote">&gt; (BTW older versions had an option to require a confirmation before allowing the
&gt; use of the GPG key, this was a nice option, it would be nice to have it back
&gt; too)</span>

Although it makes one feel good, this doesn't actually add any security. Any application can click the button via X to allow use of the GPG passphrase.</pre>
</div><div class="bz_comment" id="c12">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c12">Comment 12</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Julien Cristau</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 15:11:12 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c11">comment #11</a>)
<span class="quote">&gt; Although it makes one feel good, this doesn't actually add any security. Any
&gt; application can click the button via X to allow use of the GPG passphrase.</span>

Only if you let them use XTEST, AFAIK...</pre>
</div><div class="bz_comment" id="c13">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c13">Comment 13</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 15:58:35 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c12">comment #12</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=681081#c11">comment #11</a>)
&gt; &gt; Although it makes one feel good, this doesn't actually add any security. Any
&gt; &gt; application can click the button via X to allow use of the GPG passphrase.
&gt; 
&gt; Only if you let them use XTEST, AFAIK...</span>

Which is always enabled for accessibility, no? Plus XSendEvent lets an application send an event too. In addition there's no way to securely display the name of the application that wants to access the password (it'll always be gpg). 

All that said, maybe it's not impossible after all... If someone wants to invest time and effort to implement this securely then I'd be willing to review patches. But I'm not really that interested in spending a lot of time for no real security gain, so it needs to actually perform its use case securely.

For example, see <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=525574" title="RESOLVED FIXED - gnome-keyring-daemon does not honor constrained ssh identities">bug #525574</a>. In that case with ssh, it does make sense to implement prompting because of SSH agent forwarding. Although it seems that nobody has had time to actually do it.</pre>
</div><div class="bz_comment" id="c14">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c14">Comment 14</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 15:59:50 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class=""><a href="attachment.cgi?id=220633" name="attach_220633" title="schema: Update description for gpg-cache-method">Attachment 220633</a> <a href="attachment.cgi?id=220633&amp;action=edit" title="schema: Update description for gpg-cache-method">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-keyring/commit/?id=3de11dd">3de11dd</a> - schema: Update description for gpg-cache-method
<span class=""><a href="attachment.cgi?id=220674" name="attach_220674" title="gpg-agent: Hook up the TTL cache option">Attachment 220674</a> <a href="attachment.cgi?id=220674&amp;action=edit" title="gpg-agent: Hook up the TTL cache option">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-keyring/commit/?id=111a132">111a132</a> - gpg-agent: Hook up the TTL cache option
<span class=""><a href="attachment.cgi?id=220675" name="attach_220675" title="secret-store: Mark a secret item as 'used' when accessed">Attachment 220675</a> <a href="attachment.cgi?id=220675&amp;action=edit" title="secret-store: Mark a secret item as 'used' when accessed">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-keyring/commit/?id=979bf3c">979bf3c</a> - secret-store: Mark a secret item as 'used' when accessed</pre>
</div><div class="bz_comment" id="c15">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c15">Comment 15</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Julien Cristau</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-08 16:18:51 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c13">comment #13</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=681081#c12">comment #12</a>)
&gt; &gt; (In reply to <a href="show_bug.cgi?id=681081#c11">comment #11</a>)
&gt; &gt; &gt; Although it makes one feel good, this doesn't actually add any security. Any
&gt; &gt; &gt; application can click the button via X to allow use of the GPG passphrase.
&gt; &gt; 
&gt; &gt; Only if you let them use XTEST, AFAIK...
&gt; 
&gt; Which is always enabled for accessibility, no? Plus XSendEvent lets an
&gt; application send an event too. In addition there's no way to securely display
&gt; the name of the application that wants to access the password (it'll always be
&gt; gpg). 
&gt; </span>
Well you should only enable XTEST if you want random apps to be able to send random keypresses to others.  So no it's not "always enabled".  And most apps ignore events with the send_event bit set.</pre>
</div><div class="bz_comment" id="c16">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c16">Comment 16</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Huzaifa Sidhpurwala (Red Hat Security Response)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-09 05:27:48 UTC
        </span>
</div>
<pre class="bz_comment_text">This issue was assigned CVE-2012-3466 as per:
<a href="http://www.openwall.com/lists/oss-security/2012/08/09/2">http://www.openwall.com/lists/oss-security/2012/08/09/2</a></pre>
</div><div class="bz_comment" id="c17">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c17">Comment 17</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-15 19:48:34 UTC
        </span>
</div>
<pre class="bz_comment_text">Since this is a (low impact) security issue, I've taken a look at which stable releases are affected:

 * 3.4.1
 * 3.4.0

The following releases do not have this issue, although they have a separate non-security issue. The 'idle' setting is not respected, and they act like 'timeout' instead. The reason this is not a security problem is because the erroneous behavior is more strict than the expected behavior.

 * 3.2.2 
 * 3.2.1
 * 3.2.0</pre>
</div><div class="bz_comment" id="c18">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c18">Comment 18</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-15 19:59:31 UTC
        </span>
</div>
<pre class="bz_comment_text">gnome-3-4 branch patches for this issue:

51606f299e5ee9d48096db0a5957efe26cbf7cc3
5dff623470b859e332dbe12afb0dc57b292832d2</pre>
</div><div class="bz_comment" id="c19">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c19">Comment 19</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Huzaifa Sidhpurwala (Red Hat Security Response)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-20 08:30:50 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=681081#c17">comment #17</a>)
<span class="quote">&gt; Since this is a (low impact) security issue, I've taken a look at which stable
&gt; releases are affected:
&gt; 
&gt;  * 3.4.1
&gt;  * 3.4.0
&gt; 
&gt; The following releases do not have this issue, although they have a separate
&gt; non-security issue. The 'idle' setting is not respected, and they act like
&gt; 'timeout' instead. The reason this is not a security problem is because the
&gt; erroneous behavior is more strict than the expected behavior.
&gt; 
&gt;  * 3.2.2 
&gt;  * 3.2.1
&gt;  * 3.2.0</span>

Interestingly, i can see this issue on older versions of gnome-keyring as well.
I am able to reproduce this with gnome-keyring-2.28</pre>
</div><div class="bz_comment" id="c20">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c20">Comment 20</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Stef Walter</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-20 08:32:08 UTC
        </span>
</div>
<pre class="bz_comment_text">Could you please include specifics of how you see this issue in 2.28. gnome-keyring had no gpg-agent, seahorse had the agent at that point. Are you sure you're using the right settings? I think these settings used to be controlled through the seahorse settings.</pre>
</div><div class="bz_comment" id="c21">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=681081#c21">Comment 21</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Huzaifa Sidhpurwala (Red Hat Security Response)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-21 06:29:36 UTC
        </span>
</div>
<pre class="bz_comment_text">Hi Stef,

Looks like false alarm, cache-ttl is in minutes, i thought it was in seconds :)</pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=gnome-keyring">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=681081&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=681081" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=681081&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626106481-c4I5w4gEjw7VLRZLM6bTsHSFk5OdrY8rhlpLRvsfits"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>