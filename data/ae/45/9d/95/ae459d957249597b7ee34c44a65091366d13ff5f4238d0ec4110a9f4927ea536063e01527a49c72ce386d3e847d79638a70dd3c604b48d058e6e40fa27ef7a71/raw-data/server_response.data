<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="/bitrix/cache/css/s1/amonitoring/page_301e0515e9d3ba85666684946cf99eda/page_301e0515e9d3ba85666684946cf99eda_v1.css?15888514211100" type="text/css"  rel="stylesheet" />
<link href="/bitrix/cache/css/s1/amonitoring/template_2ce4d1bd7d3f721aeb2eaec43452af7a/template_2ce4d1bd7d3f721aeb2eaec43452af7a_v1.css?1588850961765" type="text/css"  data-template-style="true" rel="stylesheet" />
<script type="text/javascript">var _ba = _ba || []; _ba.push(["aid", "32b028ed9c27d643ac9e6fdca71a7c6b"]); _ba.push(["host", "amonitoring.ru"]); (function() {var ba = document.createElement("script"); ba.type = "text/javascript"; ba.async = true;ba.src = (document.location.protocol == "https:" ? "https://" : "http://") + "bitrix.info/ba.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ba, s);})();</script>


    <title>Third Steam Windows Client vulnerability, but not 0day</title>    <meta content="Описание" name="description">
    <meta content="Ключевые слова" name="keywords">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/bootstrap.css">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/owl.carousel.css">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/style.css">
    <link rel="icon" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <!--[if lt IE 9]><script src="/bitrix/templates/amonitoring/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/js/fancybox/jquery.fancybox.css">
    <script src="/bitrix/templates/amonitoring/js/jquery.min.js"></script>
            <script>
            var onloadCallback = function() {
                mysitekey = '6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP';
                grecaptcha.render('captcha_footer', {
                    'sitekey' : mysitekey
                });
                grecaptcha.render('captcha_feedback', {
                    'sitekey' : mysitekey
                });
            };
        </script>
            <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
    </head>
<body>
<header class="header">
    <div class="container">
        <div class="header-table full">
            <div class="header-cell header-open hidden-md hidden-lg">
                <a href="#" class="nav-open icon icon-nav-open"></a>
            </div>
            <div class="header-cell header-logo">
                <div class="header-logo-table">
                    <div class="header-logo-cell">
                        <a href="/">
                            <img src="/bitrix/templates/amonitoring/img/logo.png" alt="" title="">
                        </a>
                    </div>
                    <div class="header-logo-cell header-title">ПЕРСПЕКТИВНЫЙ<br>МОНИТОРИНГ</div>
                </div>
            </div>
            <div class="header-cell header-incident hidden-xs hidden-sm">
                <a href="/incident/" class="button full">Сообщить об инциденте</a>
            </div>
            <div class="header-cell header-search hidden-xs hidden-sm">
    <form action="/search/" class="clearfix">
        <div class="header-search-input-outer">
            <input type="text" value="" name="q" placeholder="Поиск" class="header-search-input full">
            <button type="submit" class="header-search-submit icon icon-search">Найти</button>
        </div>
    </form>
</div>            <div class="header-cell header-contacts hidden-xs hidden-sm">
                <div class="header-social">
                    <a href="https://www.facebook.com/advancedmonitoring/" class="icon icon-social icon-fb"></a>
                    <a href="https://twitter.com/am_rnd" class="icon icon-social icon-tw"></a>
                    <a href="https://habrahabr.ru/company/pm/" class="icon icon-social icon-habr"></a>
                    <a href="https://t.me/pm_public" class="icon icon-social icon-tele"></a>
                    <a href="https://www.linkedin.com/company/advanced-monitoring" class="icon icon-social icon-in"></a>
                </div>
                <div class="header-phone">
                    <span class="icon icon-phone"></span> <a href="tel:+74957376197">+7 495 737-61-97</a>
                </div>
                <div class="header-mail">
                    <span class="icon icon-mail"></span> <a href="mailto:info@amonitoring.ru">info@amonitoring.ru</a>
                </div>
            </div>
        </div>
        <nav class="nav">
            <div class="nav-inner">
                

    <ul class="nav-level-1">
			<li><a href="/about/">Компания</a></li>
		
			<li><a href="/news/">Новости</a></li>
		
			<li><a href="/service/">Услуги</a></li>
		
			<li><a href="/product/">Продукты</a></li>
		
			<li><a href="/article/" class="selected">Статьи</a></li>
		
			<li><a href="/vacancy/">Карьера</a></li>
		
			<li><a href="/contact/">Контакты</a></li>
		

</ul>
                <div class="hidden-md hidden-lg">
                    <div class="nav-block header-incident">
                        <a href="#" class="button full">Сообщить об инциденте</a>
                    </div>
                    <div class="nav-bottom">
                        <div class="nav-block header-search">
                            <form action="#" class="clearfix">
                                <div class="header-search-input-outer">
                                    <input type="text" value="" placeholder="Поиск" class="header-search-input full">
                                    <button type="submit" class="header-search-submit icon icon-search-white">Найти</button>
                                </div>
                            </form>
                        </div>
                        <div class="nav-block header-contacts">
                            <div class="header-social">
                                <a href="https://www.facebook.com/advancedmonitoring/" class="icon icon-social icon-fb"></a>
                                <a href="https://twitter.com/am_rnd" class="icon icon-social icon-tw"></a>
                                <a href="https://habrahabr.ru/company/pm/" class="icon icon-social icon-habr"></a>
                                <a href="https://t.me/pm_public" class="icon icon-social icon-tele"></a>
                                <a href="https://www.linkedin.com/company/advanced-monitoring" class="icon icon-social icon-in"></a>
                            </div>
                            <div class="header-phone">
                                <span class="icon icon-phone"></span> <a href="tel:+74957376197">+7 495 737-61-97</a>
                            </div>
                            <div class="header-mail">
                                <span class="icon icon-mail"></span> <a href="mailto:info@amonitoring.ru">info@amonitoring.ru</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>
    <div class="content">
        <div class="container">
                            <h1 class="main-h1" style="visibility: hidden"></h1>
                            <main class="main">
	<input id="next_page" type="hidden" value="2">

<link href="/bitrix/css/main/font-awesome.css?151119204028777" type="text/css" rel="stylesheet" />
<div class="path" style="visibility: hidden">
				<a href="/" class="path-item">Отзывы</a>
				<a href="/article/" class="path-item">Статьи</a>
				<span class="path-item"> &gt; <a href="">Third Steam Windows Client vulnerability, but not 0day</a></span><div style="clear:both"></div></div><article class="new new-single clearfix">
    <div class="new-image">
        <img src="/upload/iblock/e75/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="block">
    </div>
    <div class="new-header">
        <div class="new-date">01.10.2019 09:20:00</div>
        <h1 class="new-title">Third Steam Windows Client vulnerability, but not 0day</h1>
    </div>
    <div class="new-info">
        <div class="new-text text">
            <h2>Previously on Privilege Escalation</h2>
<p>
	 Not long ago I posted about two vulnerabilities in Steam: <a href="/article/steamclient-0day/">CVE-2019-14743</a>&nbsp;and <a href="/article/onemore_steam_eop_0day/">CVE-2019-15316</a>. There was quite a story about how I tried to report them and didn’t succeed, how I’ve been banned, and how it took a public disclosure and community support to achieve results. Valve made it look like they’ve apologized and unbanned me at HackerOne, so I’ve decided to report another vulnerability with this service. On third time (<del>insert obvious Half-Life 3 joke here</del>) it went rather well.
</p>
<p style="text-align: center;">
 <img width="589" alt="1.png" src="/upload/medialibrary/24d/1.png" height="204" title="1.png"><br>
</p>
<h2> <b>Vulnerability Description&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </b> </h2>
<p>
	 Vulnerability allows creating files with partially controlled content (or adding partially controlled content to files that already exist). Vulnerable service version is 5.31.28.21 (data from SteamService.exe file). First, I’ll describe how to use the vulnerability, then the possible impact.<br>
</p>
<p>
</p>
<h2>
Step 1. Environment </h2>
<p>
	 It’s necessary to close Steam application and stop “Steam Client Service”, if they’re launched. More often non-administrator users are not allowed to start and stop any service. But for this specific service Valve sets the rules, which allow every user to start and stop it.
</p>
<p>
	 Then create a directory in any user-controlled space (“C:\test”, for example). It’s needed to copy files Steam.exe and steamclient.dll from original Steam directory ("C:\Program Files (x86)\Steam" by default) to created directory. Create empty subdirectory “logs” (“C:\test\logs”).
</p>
<p>
	 Now edit the registry: in "HKLM\Software\wow6432node\valve\steam" branch change the value of “InstallPath” parameter to “C:\test\1\..”. Usually users without administrative privileges cannot write to HKLM branches, but not in this case. During installation Valve sets “Full Control” permissions for “Users” group on their registry branches, which allows any user perform any action with them.
</p>
<h2>
Step 2. Little test </h2>
<p>
	 Let’s launch “Steam Client Service”. After it stops (it’ll happen automatically after a few seconds) check the contents of “C:\test\logs” directory – we will find there a file named “service_log.txt”. The content of the file will be something like this:
</p>
<p>
	 08/27/19 13:45:01 : ERROR: SteamService: Invalid file signature C:\test\1\..\bin\SteamService.dll
</p>
<p>
	 Note that path “C:\test\1\..” equals to “C:\test”, so Windows used second path for the job, but the first one was written to log. Let’s remove “service_log.txt” and move on.
</p>
<h2>
Step 3. Adding more text </h2>
<p>
	 Interesting fact: when OS Windows interacts with paths which contain “\..”, it automatically simplifies such paths. Without any checks for in-between directories.
</p>
<p>
	 For example, path “C:\1\&lt;test&gt;\..” will be transformed to “C:\1” despite the fact that symbols “&lt;” and “&gt;” are not allowed in directory names.
</p>
<p>
	 At Step 1 we wrote a path to registry, now let’s add newline symbols to it. It could be done with writing a simple code, but it is also possible to do with regedit interface. You can open "HKLM\Software\wow6432node\valve\steam" registry branch and then select “Modify binary data..” in “InstallPath” parameter’s context menu. A hex-editor-like window will appear where you can make needed changes.
</p>
<p style="text-align: center;">
 <img width="599" alt="2.png" src="/upload/medialibrary/de3/2.png" height="318" title="2.png">
</p>
<p>
	 Let’s make another service test run and check the results of our actions.
</p>
<p style="text-align: center;">
 <img width="624" alt="3.png" src="/upload/medialibrary/a8a/3.png" height="153" title="3.png">
</p>
<p>
	 Delete “service_log.txt” once again after test.
</p>
<h2>
Step 4. Redirect created file </h2>
<p>
	 Users without administrative permissions cannot create symbolic links from one file to another. But there’s a trick – you can combine another types of links which are available for users without administrative privileges to achieve result close to file-to-file symlink.
</p>
<p>
	 First let’s create NTFS reparse point (sometimes called NTFS mount point) from “C:\test\logs” directory to “\RPC Control\”. “\RPC Control\” is not a regular directory, it can’t be viewed in explorer. It’s system object directory, which stores, for example, named mutexes, events and other similar objects. It’s not clear, why redirection with NTFS reparse point works with it, most likely because similar abstractions are used for directories in filesystem and object directories. It is possible to create symlink from object directory to file without administrative permissions. Let’s create symlink “\RPC Control\service_log.txt” &lt;-&gt; “C:\Path\to\file”.
</p>
<p>
	 As a result any call to "C:\test\logs\service_log.txt" will be redirected to file “C:\path\to\file”. To create such a redirect there are two requirements – directory, where reparse point is being created, should be empty and available for user to write into it. First requirement is the reason why we deleted “service_logs.txt” after each test. Second requirement is fulfilled with creation of initial folder in user-controlled space.
</p>
<p>
	 There is specific utility to create such a pairs of symlinks – CreateSymlink, which is available on GitHub (<a href="https://github.com/googleprojectzero/symboliclink-testing-tools/">https://github.com/googleprojectzero/symboliclink-testing-tools/</a>). Usage: CreateSymlink.exe &lt;from&gt; &lt;to&gt;.
</p>
<p>
	 In our case it is CreateSymlink.exe “C:\test\logs\service_log.txt” “C:\path\to\file”.
</p>
<p>
	 Putting it all together we get that at the start of “Steam Client Service” a file will be created at path, that was chosen at symlink creation. This file will contain input that we control (except first and last string). If we create symlink to existing file, content will be written to it’s end.&nbsp;All this action will be perfored by Steam Client Service as NT AUTHORITY\SYSTEM.
</p>
<h2>
Impact </h2>
<p>
	 Now I shall tell about possible outcome in the order of its severity beginning with less important.
</p>
<h3>
1. DoS </h3>
<p>
	 If symlink destination is "C:\Windows\System32\config\SAM" or "C:\Windows\System32\config\SECURITY", it’s unlikely that OS starts after next reboot.
</p>
<h3>
2. Redirection of user in the internet </h3>
<p>
	 Let’s set symlink destination to "C:\Windows\system32\drivers\etc\hosts" and add there a string like "127.0.0.1 google.com".
</p>
 Result:<br>
 <br>
 <img width="1024" alt="4.png" src="/upload/medialibrary/4f3/4.png" height="587" title="4.png"><br>
<h3>3. Horizontal EoP </h3>
<p>
	 Horizontal escalation of privilege is such an action that allows us to act not like a higher privileged user, but a same privileged user with access to different objects than us, for example, other user’s data.
</p>
<p>
	 Let’s set symlink destination to "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\run.bat" and add there a string like "start C:\test\1.exe".
</p>
<p>
	 All files from "C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp" directory are executed by users at their login. That way one user could force another to execute arbitrary code. Every string in .bat file will be executed line by line. The first and the last string will not do anything, but injected "start C:\test\1.exe" will be run.
</p>
<p>
	 There is a thing with injecting such command – symbols “\” will be revised during path normalization, so for it to work correctly it is needed to add a few “\..” to path in the “InstallPath”.
</p>
<h3>
4. Vertical EoP </h3>
<p>
	 Vertical escalation of privilege is a common privilege escalation, for example from user without admin permissions to NT AUTHORITY\SYSTEM.
</p>
<p>
	 Quite often you can find software that executes text scripts with high privileges. We can add commands to such scripts and execute our code with higher privileges. I did not find such scripts in clean OS, so I cannot easily demonstrate an exploit like this. But I can point out .bat files that are created by NVIDIA and VmWare or logon-scripts for OS in domain.
</p>
<p>
	 In addition, creation of xml-files and ini-files with corrupted formats could be checked for privilege escalation. Sadly, there are too many options – creating tasks in TaskSheduler, working with .manifest, loading other libraries and many other. I think that what I’ve already described is enough to understand the possible impacts of the vulnerability.
</p>
<h2>
Timeline </h2>
<p>
	 For completion, I’ll give a boring timeline for this vulnerability.
</p>
<p>
	 Aug 26 – found vulnerability.
</p>
<p>
	 Aug 27 – unbanned at h1, published the report.
</p>
<p>
 <b>Sep 12 – fix released.</b>
</p>
<h2>
Conclusions </h2>
<p>
	 This is where I finish posts on Steam research – 3 vulnerabilities that were found during rather superficial analysis is already a big deal. To dig deeper I need more time and aspiration. Sadly, Valve’s attitude and HackerOne employees’ incompetence are very strong barriers.
</p>
<p>
	 Once more I want to thank all the readers, who helped make Steam more secure. I thank Valve for yet fixing the vulnerabilities and disproving my conspiracy theories. I thank HackerOne for providing the platform despite the fact that mostly they just interfered in delivering vulnerability information to Valve.
</p>
<h2>About author</h2>
<p>
	 Vasily Kravets, Lead Expert
</p>
<p>
 <a href="mailto:xi-tauw@xi-tauw.info">mailto:xi-tauw@xi-tauw.info</a>
</p>
<p>
 <a href="mailto:Vasily.Kravets@amonitoring.ru">mailto:Vasily.Kravets@amonitoring.ru</a>
</p>
<p>
 <a href="https://twitter.com/PsiDragon">https://twitter.com/PsiDragon</a>
</p>
<p>
 <a href="https://t.me/xitauw">https://t.me/xitauw</a>
</p>        </div>
        <div class="new-tags tags"> Теги:
            <div class="tags-inner">
                                                    <a href="/article/?tag=steam">steam</a>
                                        <a href="/article/?tag=public disclosure">public disclosure</a>
                                        <a href="/article/?tag=уязвимость">уязвимость</a>
                                        <a href="/article/?tag=повышение привилегий">повышение привилегий</a>
                                        <a href="/article/?tag=eop">eop</a>
                                        <a href="/article/?tag=lpe">lpe</a>
                                </div>
        </div>
                    <script src="//yastatic.net/es5-shims/0.0.2/es5-shims.min.js"></script>
            <script src="//yastatic.net/share2/share.js"></script>
            <div class="social">Поделиться статьей в:
                <div class="ya-share2 social-inner" style="visibility: hidden; position: relative; bottom: 5px;" data-services="facebook,twitter,telegram,linkedin"></div>
            </div>
                </div>
</article>
    <div class="new-extra">
        <div class="new-extra-title">Рекомендуемые статьи</div>
        <div class="owl-carousel">
                            <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/9ad/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="">
                        </div>
                                                <div class="new-date">20.08.2019</div>
                        <div class="new-title">One more Steam Windows Client Local Privilege Escalation 0day</div>
                        <div class="new-link">
                            <a href="/article/onemore_steam_eop_0day/">Читать</a>
                        </div>
                    </div>
                </div>
                                <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/828/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="">
                        </div>
                                                <div class="new-date">07.08.2019 09:44:00</div>
                        <div class="new-title">Steam Windows Client Local Privilege Escalation 0day</div>
                        <div class="new-link">
                            <a href="/article/steamclient-0day/">Читать</a>
                        </div>
                    </div>
                </div>
                                <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/960/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="">
                        </div>
                                                <div class="new-date">29.05.2019</div>
                        <div class="new-title">Анализ поверхности атаки для банков и организаций кредитно-финансовой сферы</div>
                        <div class="new-link">
                            <a href="/article/attack-surface/">Читать</a>
                        </div>
                    </div>
                </div>
                        </div>
    </div>
    <script>
    $(document).ready(function () {
        $(".main-h1").before($(".path"));
    });
    $(window).load(function () {
        $(".ya-share2__badge").each(function () {
            $(this).remove();
        });
        $(".ya-share2__title").each(function () {
            $(this).remove();
        });
        $(".ya-share2__item_service_facebook").children().eq(0).addClass("icon icon-social icon-fb");
        $(".ya-share2__item_service_twitter").children().eq(0).addClass("icon icon-social icon-tw");
        $(".ya-share2__item_service_telegram").children().eq(0).addClass("icon icon-social icon-tele");
        $(".ya-share2__item_service_linkedin").children().eq(0).addClass("icon icon-social icon-in");

        $(".ya-share2").css("visibility","visible");
    });
</script>
            </main>
        </div>
    </div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-4">
                        <div class="footer-block">
                            <div class="footer-title">
                                <a href="/about/">О нас</a>
                            </div>
                            <div class="footer-content">
                                <ul>
                                    <li><a href="/about/">Компания</a></li>
                                    <li><a href="/vacancy/">Вакансии</a></li>
                                    <li><a href="/contact/">Контакты</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="footer-block">
                            <div class="footer-title">
                                <a href="#">Услуги</a>
                            </div>
                            <div class="footer-content">
                                <ul>
                                    <li><a href="/service/security-operation-center/">Центр мониторинга компьютерных атак</a></li>
                                    <li><a href="/service/snort/">Разработка правил Snort IDS</a></li>
                                    <li><a href="/service/secure-development/">Внедрение процедур безопасной разработки ПО</a></li>
                                    <li><a href="/service/forensics/">Расследование компьютерных инцидентов</a></li>
                                    <li><a href="/service/compliance/">Соответствие требованиям по ИБ</a></li>
                                    <li><a href="/service/security-analysis/">Анализ защищённости</a></li>
                                    <li><a href="/service/pentest/">Пентесты</a></li>
                                    <li><a href="/service/incident-management/">Управление инцидентами ИБ</a></li>
                                    <li><a href="/service/gossopka/">ГосСОПКА</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 footer-feedback-outer">
                <div class="footer-block">
                    <div class="footer-feedback-title footer-title">
                        <a href="#">Написать нам</a>
                    </div>
                    <div class="footer-content">
                        <div class="footer-feedback">
                            <form action="#" id="feedback">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="footer-feedback-field clearfix">
                                            <div class="footer-feedback-field-title">Имя</div>
                                            <div class="footer-feedback-field-input">
                                                <input type="text" value="" class="input full">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="footer-feedback-field clearfix">
                                            <div class="footer-feedback-field-title">Email</div>
                                            <div class="footer-feedback-field-input">
                                                <input type="email" value="" class="input full">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="footer-feedback-field clearfix">
                                    <div class="footer-feedback-field-title">Письмо</div>
                                    <div class="footer-feedback-field-input">
                                        <textarea class="input full" rows="5"></textarea>
                                    </div>
                                </div>
                                <div style="overflow:hidden">
                                <div style="float: right" id="captcha_footer" class="footer-feedback-field footer-feedback-capcha" data-sitekey="6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP"></div>
                                </div>
                                    <div class="footer-feedback-field footer-feedback-submit">
                                    <input type="submit" value="Отправить" class="button">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <span class="icon icon-stepup"></span> 2021        </div>
    </div>
</footer>
<div class="popup-overlay" id="popup-question">
    <div class="popup-table">
        <div class="popup-cell">
            <div class="popup">
                <a href="#" class="popup-x popup-close icon icon-close" title="Закрыть"></a>
                <div class="popup-content">
                    <form action="#" class="ajax">
                        <div class="form-field">
                            <input type="text" class="input full" placeholder="Как к вам обращаться?" name="name">
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <input type="text" class="input full" placeholder="Адрес электронной почты или телефон*" name="phone_email">
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <textarea class="input full" rows="8" placeholder="Ваш вопрос, запрос или пожелание связаться с вами" name="message"></textarea>
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <div class="form-field-text">
                                <div class="form-field-nospam">*Мы не спамим и не подписываем на рассылку</div>
                                <div>Быстро ответим только с 9 до 18 по Москве.<br>В противном случае &mdash; на следующий день.</div>
                            </div>
                        </div>
                        <div id="captcha_feedback" class="form-field" data-sitekey="6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP"></div>
                        <div class="form-field">
                            <input type="submit" class="button button-black" value="Отправить">
                        </div>
                    </form>
                    <div class="form-message text" style="display: none">
                        <p>Сообщение отправлено.</p>
                        <p>Спасибо, мы с вами обязательно свяжемся.</p>
                        <p>
                            <a href="#" class="popup-close button button-black">OK</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function initMap() {
        var line = [];
        var uluru = {lat: 55.800312, lng: 37.565437};
        var map = new google.maps.Map(document.getElementById('map1'), {
            zoom: 15,
            center: uluru
        });
        var marker = new google.maps.Marker({
            position: uluru,
            map: map
        });

        function route(flightPlanCoordinates, color) {
            for (var i=0; i<line.length; i++)
            {
                line[i].setMap(null); //or line[i].setVisible(false);
            }
            var route = new google.maps.Polyline({
                path: flightPlanCoordinates,
                geodesic: true,
                strokeColor: color,
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            line.push(route);
            route.setMap(map);
        }

        $(".contact_how").click(function () {
            switch ($(this).attr("id")){
                case("howAuto"):
                    var routePath = [
                        {lng: 37.555160438890596, lat:55.790646376051114},
                        {lng: 37.55754224049581, lat:55.79213336802756},
                        {lng: 37.5574778674795, lat:55.79219985821376},
                        {lng: 37.557654893274446, lat:55.79269853092611},
                        {lng: 37.55806795346278, lat:55.79307630902726},
                        {lng: 37.55888334500328, lat:55.79332412944713},
                        {lng: 37.55950561749472, lat:55.79371701225159},
                        {lng: 37.558904802675436, lat:55.79391647430447},
                        {lng: 37.5589799045278, lat:55.795203886511004},
                        {lng: 37.56795994030967, lat:55.798068678610754},
                        {lng: 37.56521335827845, lat:55.800878870271184}
                    ];
                    route(routePath, "#33cc00");
                    break;
                case("howTtk"):
                    var routePath = [
                        {lng:37.56551316706945, lat:55.80095569108},
                        {lng:37.568345579789266, lat:55.798036719495435},
                        {lng:37.56862452952684, lat:55.79746256879981},
                        {lng:37.568967852280764, lat:55.794283433130126},
                        {lng:37.56965449778857, lat:55.79075344106749},
                        {lng:37.57149985759082, lat:55.789749994268504},
                        {lng:37.574182153905035, lat:55.791617909044625},
                        {lng:37.57531941052734, lat:55.79183551573765},
                        {lng:37.57808745023072, lat:55.79198058618807},
                        {lng:37.57971823331173, lat:55.79201685370956},
                        {lng:37.5828939687854, lat:55.792282814550326},
                        {lng:37.58583366986572, lat:55.79216192348803},
                        {lng:37.58808672543823, lat:55.792246547271205}
                    ];
                    route(routePath, "#006cff");
                    break;
                case("howTransport"):
                    var routePath = [
                        {lat: 55.79057753175389, lng: 37.556452261444086},
                        {lat: 55.79132708087788, lng: 37.556344973083455},
                        {lat: 55.792034303463, lng: 37.557439314361524},
                        {lat: 55.79247555547622, lng: 37.55849074029541},
                        {lat: 55.793031646752226, lng: 37.56089399957274},
                        {lat: 55.79318880152918, lng: 37.5609261860809},
                        {lat: 55.79397456589992, lng: 37.559027182098355},
                        {lat: 55.795171314881316, lng: 37.55909155511475},
                        {lat: 55.79804215302112, lng: 37.56817887925712},
                        {lat: 55.80092486504567, lng: 37.565378653045606}
                    ];
                    route(routePath,  "#ff0000");
                    break;
            }
        });
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjS_0Yj5L1FNuflX6m5EkY0LFL2iNs6oA&callback=initMap">
</script>
<script src="/bitrix/templates/amonitoring/js/jquery.mobile.custom.min.js"></script>
<script src="/bitrix/templates/amonitoring/js/jquery.maskedinput.min.js"></script>
<script src="/bitrix/templates/amonitoring/js/owl.carousel.min.js"></script>
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
<script src="/bitrix/templates/amonitoring/js/fancybox/jquery.fancybox.pack.js"></script>
<script src="/bitrix/templates/amonitoring/js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter15525343 = new Ya.Metrika({
                    id:15525343,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/15525343" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>