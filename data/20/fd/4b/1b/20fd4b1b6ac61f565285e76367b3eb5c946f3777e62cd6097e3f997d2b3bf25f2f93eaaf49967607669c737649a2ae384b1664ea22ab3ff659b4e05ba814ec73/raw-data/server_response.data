<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 1158910 &ndash; VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use /usr/bin/safe-{rm,rmdir}</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://bugzilla.suse.com/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=1158910&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=1158910">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=1158910">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=1158910">



    
    <link href="skins/standard/global.css?1411227340"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="skins/standard/global.css?1411227340" rel="stylesheet"
            type="text/css" ><link href="skins/standard/show_bug.css?1416528352" rel="stylesheet"
            type="text/css" ><link href="extensions/Voting/web/style.css?1411227348" rel="stylesheet"
            type="text/css" ><!--[if lte IE 7]>
      


      <link href="skins/standard/IE-fixes.css?1411227340" rel="stylesheet"
            type="text/css" >
<![endif]-->

    <link href="skins/contrib/SUSE/global.css?1411227340" rel="stylesheet"
            type="text/css" 
          title="SUSE">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1411227335"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1411227333"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1411227329"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1411227329"></script><script type="text/javascript" src="js/yui/json/json-min.js?1411227333"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1411227334"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1411227335"></script><script type="text/javascript" src="js/global.js?1411227336"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 1158910 – VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use \/usr\/bin\/safe-{rm,rmdir}",  
                             "show_bug.cgi?id=1158910" );
        document.title = "Bug 1158910 – VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use \/usr\/bin\/safe-{rm,rmdir}";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 1158910 – VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use \/usr\/bin\/safe-{rm,rmdir}", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1411227336"></script><script type="text/javascript" src="js/field.js?1414105521"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" ><link href="extensions/Testopia/css/testopia.css" rel="stylesheet" type="text/css">
    <link href="extensions/Testopia/extjs/examples/ux/css/RowEditor.css" rel="stylesheet" type="text/css"  />
    <script type="text/javascript">
        Testopia_user = {login: "", id: 0};
        DEFAULT_CASE_STATUS = 'CONFIRMED';
    </script>
  </head>



  <body onload=""
        class="bugzilla-suse-com bz_bug bz_status_RESOLVED bz_product_SUSE_Security_Incidents bz_component_Incidents bz_bug_1158910 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<!--div id="tmp_warning_wnd" style="
    position:fixed; 
    color:red; 
    font-size:20px; 
    top:50px; 
    left:10%; 
    right:10%; 
    padding:1em;
    background-color:#ffffff;
    border:3px solid red;
    z-index:9999;
    text-align:center;">
  This Bugzilla is for TESTING ONLY. All new bugs and comments WILL BE LOST. Use <a href="https://bugzilla.suse.com">bugzilla.suse.com</a> instead.
  <button style="
      background:none;
      border:0;
      box-shadow:none;
      color:red;
      text-shadow:none;
      position:absolute;
      right:0;
      top:0;" onclick="document.getElementById('tmp_warning_wnd').style.display='none';">[X]</button>
</div-->

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1158910</p>
    </td>

    <td id="subtitle">
      <p class="subheader">VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use /usr/bin/safe-{rm,rmdir}</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2020-07-09 14:32:12 UTC</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <!--a id="login_link_top" href="show_bug.cgi?id=1158910&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a-->
  <a id="login_link_top" href="show_bug.cgi?id=1158910&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1158910" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
</div> 

<div id="bugzilla-body">

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2020-07-09 14:32:12">
  <input type="hidden" name="longdesclength" value="76">
  <input type="hidden" name="id" value="1158910">
  <input type="hidden" name="token" value="1635630449-s1SWUmRxg3xaJffzYdocs6-s5ibLrE7TUI50kKouq9o">
<div class="bz_alias_short_desc_container edit_form">
        <strike>
     <a href="show_bug.cgi?id=1158910"><b>Bug&nbsp;1158910</b></a> -<span id="summary_alias_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2020-8017</span>) 
      <span id="short_desc_nonedit_display">VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use /usr/bin/safe-{rm,rmdir}</span></strike>
     </span>  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">(CVE-2020-8017)
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=glossary.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td><span title="VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use /usr/bin/safe-{rm,rmdir}">VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no long...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('VUL-0: CVE-2020-8017: texlive-filesystem: race condition on cron job, no longer use \/usr\/bin\/safe-{rm,rmdir}', 'CVE-2020-8017');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=status_resolution_matrix.html">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>

          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
      </tr>

    
    
    
    <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >SUSE Security Incidents</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=SUSE Security Incidents"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Incidents</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=glossary.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=glossary.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">Other
       Other
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority">
          <a href="page.cgi?id=glossary.html#priority">Priority</a></label>:
      </th>
      <td>P3 - Medium
        <label for="severity">
          <b>Severity</b></label>:
       Normal
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=glossary.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>unspecified
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=glossary.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">

    <label for="qa_contact" accesskey="q">

  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#qa_contact"
  >QA Contact:</a>
</label>
</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-team\x40suse.de',
        'security-team\x40suse.de');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=glossary.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=glossary.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">
        <span title="CVSSv2:NVD:CVE-2020-8017:3.3:(AV:L/AC:M/Au:N/C:N/I:P/A:P) CVSSv3.1:NVD:CVE-2020-8017:6.3:(AV:L/AC:H/PR:L/UI:N/S:U/C:N/I:H/A:H)">CVSSv2:NVD:CVE-2020-8017:3.3:(AV:L/AC...
        </span>  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    <a class="bz_bug_link 
          bz_status_IN_PROGRESS "
   title="IN_PROGRESS"
   href="show_bug.cgi?id=1159103">1159103</a> 
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=1158910&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=1158910">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2019-12-10 12:37 UTC by <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2020-07-09 14:32 UTC 
      (<a href="show_activity.cgi?id=1158910">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>7 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="atoptsoglou">atoptsoglou</option>
                <option value="jsegitz">jsegitz</option>
                <option value="malte.kraus">malte.kraus</option>
                <option value="marina.latini">marina.latini</option>
                <option value="matthias.gerstner">matthias.gerstner</option>
                <option value="security-team">security-team</option>
                <option value="werner">werner</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=glossary.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_foundby">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_foundby"
  >Found By:</a>

</th>
  <td class="field_value "
      id="field_container_cf_foundby"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_nts_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_nts_priority"
  >Services Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_nts_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_biz_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_biz_priority"
  >Business Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_biz_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_blocker">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_blocker"
  >Blocker:</a>

</th>
  <td class="field_value "
      id="field_container_cf_blocker"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_marketing_qa_status">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_marketing_qa_status"
  >Marketing QA Status:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_marketing_qa_status"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_it_deployment">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_it_deployment"
  >IT Deployment:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_it_deployment"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         <ul>
    <li><a href="tr_new_case.cgi?product=SUSE%20Security%20Incidents&bug=1158910">Create test case</a></li>
</ul><ul>
  <li><a href="enter_bug.cgi?cloned_bug_id=1158910">Clone This Bug</a></li>
</ul>
                <tr>
      <th class="field_label">
        <label>Flags:</label>
      </th>
      <td><span title="Dr. Werner Fink">werner</span>:
      SHIP_STOPPER?<br>
      </td>
    </tr>

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td valign="top">
            <a href="attachment.cgi?id=832111"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">texlive.cron</span></b></a>

          <span class="bz_attach_extra_info">
              (2.13 KB,
                text/plain)

            <br>
            <a href="#attach_832111"
               title="Go to the comment associated with the attachment">2020-03-06 12:30 UTC</a>,

            <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
          </span>
        </td>


        <td valign="top">
          <a href="attachment.cgi?id=832111&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (1)
            <a id="view_all" href="attachment.cgi?bugid=1158910&amp;action=viewall&amp;hide_obsolete=1">View All</a>
        </span>
        <a href="attachment.cgi?bugid=1158910&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=1158910&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1411227336" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-10 12:37:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >As noted in <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED"
   href="show_bug.cgi?id=1150556">bug 1150556</a>, the use of safe-rm and safe-rmdir in
/etc/cron.daily/suse-texlive is not completely race free. Since the root user
is accessing files owned by an unprivileged user here more caution is
necessary.

I discussed with the bugowners of aaa_base (of which safe-rm and safe-rmdir
are a part of) and they don't want to improve these utilities but instead drop
them. Therefore we need to find a fix in texlive-filesystem, which is one of
the last packages in Tumbleweed that uses them anyways.

I'm seeing two promising approaches here:

1) run the deletion code as the 'mktex' user. This can be achieved by using
   the `setpriv` program. The cron job could restart itself running as
   'mktex'.
2) the cleanup logic could be moved into systemd-tmpfiles (see config files in
   /usr/lib/tmpfiles.d). I don't know whether it is flexible enough to do what
   the cron job is currently doing.

The older codestreams SLE-12:Update and SLE-15:Update are also affected by
this and fixes should be backported.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-11 12:12:41 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I have here a problem as group mktex is not allowed to do the job

 su -g mktex - nobody
 nobody&#64;noether:~&gt; id
 uid=65534(nobody) gid=487(mktex) groups=487(mktex)
 nobody&#64;noether:~&gt; ll /var/cache/texmf/fonts/tfm/
 total 0
 -rw-rw-r-- 1 root mktex 0 Dec 11 13:05 xyz
 nobody&#64;noether:~&gt; rm /var/cache/texmf/fonts/tfm/xyz
 rm: cannot remove '/var/cache/texmf/fonts/tfm/xyz': Operation not permitted
 nobody&#64;noether:~&gt; ll /var/cache/texmf/fonts/tfm/ -d
 drwxrwxr-t 2 root mktex 17 Dec 11 13:05 /var/cache/texmf/fonts/tfm/

...the sticky bit breaks this!</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-12 10:31:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Dr. Werner Fink from <a href="show_bug.cgi?id=1158910#c1">comment #1</a>)
<span class="quote">&gt; I have here a problem as group mktex is not allowed to do the job
&gt; [...]
&gt; ...the sticky bit breaks this!</span >

I see. That is unfortunate and complicates things. Which component is creating these files in the first place?

I see only two approaches left:

1) try to change the creation of these files in a way that they're also owned by 'mktex', then fix the ownership once during package update (which again is a security sensitive operation)
2) try the systemd-tmpfiles route, I think it operates as root but uses a safe file access algorithm to delete files owned by unprivileged users.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-13 14:22:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >As normal user creates their file below ~/.config/texmf/ there is no need to run any suid program, I simply use rm(1) now for the files root write and creates.
And only user root switch over to user nobody and group mktex</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-13 14:50:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an autogenerated message for OBS integration:
This bug (1158910) was mentioned in
<a href="https://build.opensuse.org/request/show/756829">https://build.opensuse.org/request/show/756829</a> Factory / texlive-filesystem</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 11:20:31 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a href="show_bug.cgi?id=1158910#c3">comment #3</a>)
<span class="quote">&gt; As normal user creates their file below ~/.config/texmf/ there is no need to
&gt; run any suid program, I simply use rm(1) now for the files root write and
&gt; creates.</span >

Thank you for working on this!

<span class="quote">&gt; And only user root switch over to user nobody and group mktex</span >

This part still seems to be missing. suse-texlive now uses rm instead of
safe-rm, but still operates as root on /var/cache/texmf/fonts. Are you still
working on this?</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 11:36:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1158910#c5">comment #5</a>)
<span class="quote">&gt; (In reply to <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a href="show_bug.cgi?id=1158910#c3">comment #3</a>)
&gt; &gt; As normal user creates their file below ~/.config/texmf/ there is no need to
&gt; &gt; run any suid program, I simply use rm(1) now for the files root write and
&gt; &gt; creates.
&gt; 
&gt; Thank you for working on this!
&gt; 
&gt; &gt; And only user root switch over to user nobody and group mktex
&gt; 
&gt; This part still seems to be missing. suse-texlive now uses rm instead of
&gt; safe-rm, but still operates as root on /var/cache/texmf/fonts. Are you still
&gt; working on this?</span >

Only root uses /var/cache/texmf/fonts and for this root switch to nobody:mktex, all other users do use their ~/.cache/texmf/fonts/ ... this is the default configuration.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 11:38:49 UTC
        </span>
      </div>



<pre class="bz_comment_text" >To see this run

  mktexpk cmr8

as user and as root, then do

  find /var/cache/texmf/fonts -ls

as well as user

  find ~/.cache/texmf/fonts -ls</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 12:46:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a href="show_bug.cgi?id=1158910#c7">comment #7</a>)
<span class="quote">&gt; To see this run
&gt; 
&gt;   mktexpk cmr8
&gt; 
&gt; as user and as root, then do
&gt; 
&gt;   find /var/cache/texmf/fonts -ls
&gt; 
&gt; as well as user
&gt; 
&gt;   find ~/.cache/texmf/fonts -ls</span >

Ah you mean the files are only *created* by nobody:mktex. But they're still
deleted by root.

This still leaves open a privilege escalation. If the mktex group is
compromised then arbitrary files can be deleted when the cron job is executed.

Can you please also do the deletion as nobody:mktex?</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 13:03:11 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1158910#c8">comment #8</a>)
<span class="quote">&gt; (In reply to <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a href="show_bug.cgi?id=1158910#c7">comment #7</a>)
&gt; &gt; To see this run
&gt; &gt; 
&gt; &gt;   mktexpk cmr8
&gt; &gt; 
&gt; &gt; as user and as root, then do
&gt; &gt; 
&gt; &gt;   find /var/cache/texmf/fonts -ls
&gt; &gt; 
&gt; &gt; as well as user
&gt; &gt; 
&gt; &gt;   find ~/.cache/texmf/fonts -ls
&gt; 
&gt; Ah you mean the files are only *created* by nobody:mktex. But they're still
&gt; deleted by root.
&gt; 
&gt; This still leaves open a privilege escalation. If the mktex group is
&gt; compromised then arbitrary files can be deleted when the cron job is
&gt; executed.
&gt; 
&gt; Can you please also do the deletion as nobody:mktex?</span >

You have to nobody or root, as all directories are sticky by default. The group mktex is simply not enough ... run the commands I've shown and see</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 14:22:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a href="show_bug.cgi?id=1158910#c9">comment #9</a>)
<span class="quote">&gt; You have to nobody or root, as all directories are sticky by default. The
&gt; group mktex is simply not enough ... run the commands I've shown and see</span >

Ah right the thing with the sticky bit. Anyways there remains a symlink attack
vector the way this is currently done. If you really need to have root
permissions to remove files in there then you need to use a program that is
prepared to handle such that, like `tmpwatch` or `systemd-tmpfiles`.

Why are there files owned by root beneath /var/cache/texmf/fonts in the first
place? It seems something is off there, too. It's not symmetric. Whatever
user:group combination is creating these files should also delete them. Then
there's no trouble with sticky bits and no trouble with security.

Looking more closely at texlive-filesystem the following additional problems
appear:

a) when freshly installed /var/cache/texmf/fonts/ls-R (and others) are owned by
  root:mktex. The source of this is in the spec file:

<span class="quote">&gt;  %post
&gt;  %fillup_only -n texlive
&gt;  # the ls-R file (empty at package time)
&gt;  for dir in	%{_texmfconfdir}	\
&gt;  		%{_fontcache}		\
&gt;  		%{_texmfvardir}		\
&gt;  		%{_texmfvardir}/dist	\
&gt;  		%{_texmfvardir}/main
&gt;  do
&gt;      test ! -e ${dir}/ls-R || continue
&gt;      echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \
&gt;      ${dir}/ls-R
&gt;      chown root:%{texgrp} ${dir}/ls-R || :
&gt;      chmod 0664 ${dir}/ls-R || :
&gt;  done</span >

  This echo line opens up a symlink attack. If for example you try the
  following:

<span class="quote">&gt;  root# rm /var/cache/texmf/fonts/ls-R
&gt;  nobody# ln -s /var/cache/texmf/fonts/ls-R
&gt;  root# zypper in -f texlive-filesystem
&gt;  [...]
&gt;  root# ls -lh /root/ls-R
&gt;  -rw-rw-r-- 1 root mktex 67 18. Dez 15:17 /root/ls-R</span >

b) When newly creating ls-R files then they're not owned by root:mktex but by
   nobody:mktex:

<span class="quote">&gt;  root# rm /var/cache/texmf/fonts/ls-R
&gt;  root# mktexlsr
&gt;  root# ls -lh /var/cache/texmf/fonts/ls-R
&gt;  -rw-rw-r-- 1 nobody mktex 217 18. Dez 15:19 /var/cache/texmf/fonts/ls-R</span >

   So there is some disagreement between what the packaging does (spec file)
   and what mktexlsr does when the files aren't existing yet.

   If the files would be owned by nobody:mktex in the first place then there
   would be no trouble deleting them safely.

c) This generally raises the question why those directories have a sticky
   directory in the first place. They're not writable by other, so it's not
   actually public directories. Maybe they should not a sticky bit at all and
   be owned by nobody:mktex?</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 17:40:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1158910#c10">comment #10</a>)

Deja vu, every few years the same discussion with security ;}

<span class="quote">&gt; 
&gt; a) when freshly installed /var/cache/texmf/fonts/ls-R (and others) are owned
&gt; by
&gt;   root:mktex. The source of this is in the spec file:
&gt; 
&gt; &gt;  %post
&gt; &gt;  %fillup_only -n texlive
&gt; &gt;  # the ls-R file (empty at package time)
&gt; &gt;  for dir in	%{_texmfconfdir}	\
&gt; &gt;  		%{_fontcache}		\
&gt; &gt;  		%{_texmfvardir}		\
&gt; &gt;  		%{_texmfvardir}/dist	\
&gt; &gt;  		%{_texmfvardir}/main
&gt; &gt;  do
&gt; &gt;      test ! -e ${dir}/ls-R || continue
&gt; &gt;      echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \
&gt; &gt;      ${dir}/ls-R
&gt; &gt;      chown root:%{texgrp} ${dir}/ls-R || :
&gt; &gt;      chmod 0664 ${dir}/ls-R || :
&gt; &gt;  done</span >

On a fresh installation there is normally no /var/cache/texmf/fonts/
on update there is always a /var/cache/texmf/fonts/ls-R which will be
always overwritten by mktexlsr

<span class="quote">&gt;   This echo line opens up a symlink attack. If for example you try the
&gt;   following:
&gt; 
&gt; &gt;  root# rm /var/cache/texmf/fonts/ls-R</span >

Root can do anything right, but normally mktexlsr is used
and this overwrites  *always* the already *existing* file

<span class="quote">&gt; &gt;  nobody# ln -s /var/cache/texmf/fonts/ls-R</span >

And how have you become nobody ... only root can do, right?
If you are root you can do anything.

<span class="quote">&gt; &gt;  root# zypper in -f texlive-filesystem
&gt; &gt;  [...]
&gt; &gt;  root# ls -lh /root/ls-R
&gt; &gt;  -rw-rw-r-- 1 root mktex 67 18. Dez 15:17 /root/ls-R
&gt; 
&gt; b) When newly creating ls-R files then they're not owned by root:mktex but by
&gt;    nobody:mktex:</span >

Yes, as said ls-R will never removed, but only overwritten. the ownership
is for the fonts only.

<span class="quote">&gt; &gt;  root# rm /var/cache/texmf/fonts/ls-R
&gt; &gt;  root# mktexlsr
&gt; &gt;  root# ls -lh /var/cache/texmf/fonts/ls-R
&gt; &gt;  -rw-rw-r-- 1 nobody mktex 217 18. Dez 15:19 /var/cache/texmf/fonts/ls-R
&gt; 
&gt;    So there is some disagreement between what the packaging does (spec file)
&gt;    and what mktexlsr does when the files aren't existing yet.
&gt; 
&gt;    If the files would be owned by nobody:mktex in the first place then there
&gt;    would be no trouble deleting them safely.
&gt; 
&gt; c) This generally raises the question why those directories have a sticky
&gt;    directory in the first place. They're not writable by other, so it's not
&gt;    actually public directories. Maybe they should not a sticky bit at all and
&gt;    be owned by nobody:mktex?</span >

In the current configuration it is NOT public, but you could it configure as
public, yes. For this /etc/texmf/web2c/mktex.cnf is used together with
/usr/share/texmf/web2c/mktex.opt to do the various jobs for root and all
other users.  To allow all users you could indead make /var/cache/texmf/fonts/
writable for every user by runnging

  chmod a+w /var/cache/texmf/fonts/

hence there exists a predefined sticky bit to hold the now tmeporary directory
secure.  And as ls-R is owned by root(:mktex) only root can overwrite this
file (with mktexlsr!)  but indeed root should never rmeove it.</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-18 19:34:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Forgotten one other methode ... add TeX users to the group mktex, then also the varfonts option will allow those users to write below /var/cache/texmf/fonts/.

The reason for a) all user method and b) group mktex method allows to reduce the required amount of disk space at font generation. Otherwise all fonts will generated below the personal ~/.cache/texm/fonts/ directory for every user them self.</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-19 07:50:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Using mktemp might avoid symlink attacks from root to root

&#64;&#64; -42,6 +42,8 &#64;&#64;
 Requires(pre):  /usr/sbin/groupadd
 Requires(post): %fillup_prereq
 Requires(post): permissions
+Requires(post): /usr/bin/mktemp
+Requires(post): /usr/bin/mv
 Requires(pre):  /usr/bin/perl
 Requires(pre):  /usr/bin/clear
 Requires(pre):  /usr/bin/dialog
&#64;&#64; -351,6 +353,7 &#64;&#64;
 %post
 %fillup_only -n texlive
 # the ls-R file (empty at package time)
+error=0
 for dir in     %{_texmfconfdir}        \
                %{_fontcache}           \
                %{_texmfvardir}         \
&#64;&#64; -358,10 +361,16 &#64;&#64;
                %{_texmfvardir}/main
 do
     test ! -e ${dir}/ls-R || continue
+    tmp=$(mktemp ${dir}/ls-R.XXXXXX) || error=1
+    test $error = 0 || continue
+    mv ${tmp} ${dir}/ls-R || error=1
+    test $error = 0 || continue
+    chown root:%{texgrp} ${dir}/ls-R || error=1
+    test $error = 0 || continue
+    chmod 0664 ${dir}/ls-R || error=1
+    test $error = 0 || continue
     echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \
     ${dir}/ls-R
-    chown root:%{texgrp} ${dir}/ls-R || :
-    chmod 0664 ${dir}/ls-R || :
 done
 %if %{defined set_permissions}
 %set_permissions %{_texmfconfdir}/ls-R
&#64;&#64; -386,6 +395,7 &#64;&#64;
 mkdir -p /var/run/texlive
 &gt; /var/run/texlive/run-mktexlsr
 &gt; /var/run/texlive/run-update
+test $error = 0 || exit 1</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-19 09:20:07 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an autogenerated message for OBS integration:
This bug (1158910) was mentioned in
<a href="https://build.opensuse.org/request/show/758097">https://build.opensuse.org/request/show/758097</a> Factory / texlive-filesystem</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-19 12:19:13 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Dr. Werner Fink from <a href="show_bug.cgi?id=1158910#c11">comment #11</a>)

<span class="quote">&gt; Deja vu, every few years the same discussion with security ;}</span >

Well maybe the discussion was never quite finished, hence we still have the same problems ;)
 
<span class="quote">&gt; On a fresh installation there is normally no /var/cache/texmf/fonts/
&gt; on update there is always a /var/cache/texmf/fonts/ls-R which will be
&gt; always overwritten by mktexlsr
&gt; 
&gt; &gt;   This echo line opens up a symlink attack. If for example you try the
&gt; &gt;   following:
&gt; &gt; 
&gt; &gt; &gt;  root# rm /var/cache/texmf/fonts/ls-R
&gt; 
&gt; Root can do anything right, but normally mktexlsr is used
&gt; and this overwrites  *always* the already *existing* file</span >

This is just a simulation, an attacker can use the race condition, because firs the fonts directory is created with the sticky bit and only afterwards the ls-R file is created (on a fresh installation).
 
<span class="quote">&gt; &gt; &gt;  nobody# ln -s /var/cache/texmf/fonts/ls-R
&gt; 
&gt; And how have you become nobody ... only root can do, right?
&gt; If you are root you can do anything.</span >

This is just another simulation of a compromised nobody account.
 
<span class="quote">&gt; &gt; b) When newly creating ls-R files then they're not owned by root:mktex but by
&gt; &gt;    nobody:mktex:
&gt; 
&gt; Yes, as said ls-R will never removed, but only overwritten. the ownership
&gt; is for the fonts only.</span >

But why then this change in behaviour between newly created files (even if they're never supposed to be newly created this way) and overwritten files? Why not have this file owned by nobody:mktex in the first place?
 
<span class="quote">&gt; In the current configuration it is NOT public, but you could it configure as
&gt; public, yes.</span >

So the sticky bit is a preparation in case an Admin wants to make it public. Understood.

<span class="quote">&gt;      test ! -e ${dir}/ls-R || continue
&gt; +    tmp=$(mktemp ${dir}/ls-R.XXXXXX) || error=1
&gt; +    test $error = 0 || continue
&gt; +    mv ${tmp} ${dir}/ls-R || error=1
&gt; +    test $error = 0 || continue
&gt; +    chown root:%{texgrp} ${dir}/ls-R || error=1
&gt; +    test $error = 0 || continue
&gt; +    chmod 0664 ${dir}/ls-R || error=1
&gt; +    test $error = 0 || continue
&gt;      echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \
&gt;      ${dir}/ls-R
&gt; -    chown root:%{texgrp} ${dir}/ls-R || :
&gt; -    chmod 0664 ${dir}/ls-R || :</span >

I'm not sure this will actually fix the attack surface. I'll leave this to
jsegitz who has just recently been hunting down such attacks in %pre/%post
sections, but he didn't catch this particular one.

We'll actually need a separate bug for this spec file part. That was just a
by-catch. In this bug here may main concern is still the cron job recursively
deleting outdated files in /var/cache/texmf with race conditions involved.</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-19 13:26:25 UTC
        </span>
      </div>



<pre class="bz_comment_text" ><span class="quote">&gt; 
&gt; This is just a simulation, an attacker can use the race condition, because
&gt; firs the fonts directory is created with the sticky bit and only afterwards
&gt; the ls-R file is created (on a fresh installation).
&gt;  
&gt; &gt; &gt; &gt;  nobody# ln -s /var/cache/texmf/fonts/ls-R
&gt; &gt; 
&gt; &gt; And how have you become nobody ... only root can do, right?
&gt; &gt; If you are root you can do anything.
&gt; 
&gt; This is just another simulation of a compromised nobody account.</span >

Fact is that tools like mktexlsr do always overwrite existing ls-R
files.  And yes one of them is a symlink from below /usr/share/texmf/
while possible be mounted r/o whereas the targets of this link is
located at /var/lib/texmf/main/ls-R.
  
<span class="quote">&gt; &gt; &gt; b) When newly creating ls-R files then they're not owned by root:mktex but by
&gt; &gt; &gt;    nobody:mktex:
&gt; &gt; 
&gt; &gt; Yes, as said ls-R will never removed, but only overwritten. the ownership
&gt; &gt; is for the fonts only.
&gt; 
&gt; But why then this change in behaviour between newly created files (even if
&gt; they're never supposed to be newly created this way) and overwritten files?
&gt; Why not have this file owned by nobody:mktex in the first place?</span >

As only members of the group mktex or root its self can overwrite the ls-R
database file, e.g. on creation of new font files an updateing the ls-R
file afterwards.

<span class="quote">&gt;  
&gt; &gt; In the current configuration it is NOT public, but you could it configure as
&gt; &gt; public, yes.
&gt; 
&gt; So the sticky bit is a preparation in case an Admin wants to make it public.
&gt; Understood.</span >

Exactly, suppose that there are members of the mktex group which are working
on a larger TeX projects like books with a third party fonts.  Clearly those
members have to be reliable workers. The advantage is, that the different
resolutions of the fonts are not located in on several personal chach fonts
but only once below /var/cache/texmf/fonts/

And if the admin trust *all* members of a institution/department then he/she
can do the chmod a+w on /var/cache/texmf/fonts/

<span class="quote">&gt; 
&gt; &gt;      test ! -e ${dir}/ls-R || continue
&gt; &gt; +    tmp=$(mktemp ${dir}/ls-R.XXXXXX) || error=1
&gt; &gt; +    test $error = 0 || continue
&gt; &gt; +    mv ${tmp} ${dir}/ls-R || error=1
&gt; &gt; +    test $error = 0 || continue
&gt; &gt; +    chown root:%{texgrp} ${dir}/ls-R || error=1
&gt; &gt; +    test $error = 0 || continue
&gt; &gt; +    chmod 0664 ${dir}/ls-R || error=1
&gt; &gt; +    test $error = 0 || continue
&gt; &gt;      echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \
&gt; &gt;      ${dir}/ls-R
&gt; &gt; -    chown root:%{texgrp} ${dir}/ls-R || :
&gt; &gt; -    chmod 0664 ${dir}/ls-R || :
&gt; 
&gt; I'm not sure this will actually fix the attack surface. I'll leave this to
&gt; jsegitz who has just recently been hunting down such attacks in %pre/%post
&gt; sections, but he didn't catch this particular one.
&gt; 
&gt; We'll actually need a separate bug for this spec file part. That was just a
&gt; by-catch. In this bug here may main concern is still the cron job recursively
&gt; deleting outdated files in /var/cache/texmf with race conditions involved.</span ></pre>
    </div><div id="c19" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-20 14:42:19 UTC
        </span>
      </div>



<pre class="bz_comment_text" >For cases where ls-R got delete and was recreated with nobody:mktex there's a race window if an attacker (nobody and group mktex) can get in between the stat and the mv. It's really hard to win though

But I'm wondering as Matthias if it's not easier to just have all these files and directories owned by nobody from the beginning and then operate with these privileges there. You basically do that with your public binary and the asymmetry between the packaged files and possible configurations after administrative changes makes this more complex.</pre>
    </div><div id="c21" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2019-12-23 13:36:30 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So I've split-off <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740">bug 1159740</a> for separate discussion of the spec file race
condition, dirs with sticky bits and inconsistent ls-R ownership.

Coming back to the original cron job race condition. The exploit in <span class=""><a href="attachment.cgi?id=826677" name="attach_826677" title="">attachment
826677</a> <a href="attachment.cgi?id=826677&amp;action=edit" title="">[details]</a></span> demonstrates how a compromised member of the mktex group can cause
arbitrary files to be deleted. It can be used like this:

```
root# zypper in texlive-filesystem
root# zypper in --no-recommends texlive-kpathsea-bin

root# # this will attempt to get /etc/raw deleted
root# su -g mktex nobody /path/to/texlive_cron_race.sh

root# # in a second terminal simply repeatedly run the cron job until the
root# # exploit succeeds.
root# /etc/cron.d/suse-texlive
```

The race condition can be won every two to three times on my test system. This
is the attack vector that needs to be fixed in this bug.</pre>
    </div><div id="c22" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-10 14:10:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an autogenerated message for OBS integration:
This bug (1158910) was mentioned in
<a href="https://build.opensuse.org/request/show/762831">https://build.opensuse.org/request/show/762831</a> Factory / texlive-filesystem</pre>
    </div><div id="c23" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-13 13:21:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please test if SR#762831 and SR#763971 do fix this bug</pre>
    </div><div id="c24" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-16 13:23:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Ping! Any news on my question?</pre>
    </div><div id="c25" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-21 11:46:43 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Sorry for the late reply, I was loaded with other topics recently.

The changes in SR#762831 look promising. Directories are now owned by nobody:mktex, the deletion logic runs using setpriv under nobody:mktex. safe-rm and safe-rmdir is no longer used. I think this adresses this bug here. Thank you!

Not sure about SR#763971 which got superseded a couple of times and doesn't seem to contain anything related to this bug.

Can you backport the changes to SLE-12 and SLE-15?</pre>
    </div><div id="c27" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-30 11:27:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Thank you for working on the safe-rm* removal. From my point of view this bug is finished. I'm reassigning to security-team since they are tracking this finding on the reactive security side, so it's left for them to close the bug.

I'm decoupling this bug from the cron-job audit, it's no longer a blocker there.</pre>
    </div><div id="c28" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-01-31 10:33:59 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Back to me as not fixed ... the owner ship has to be root:mktex for /var/cache/texmf/fonts/ font cache tree ... compare with <a href="http://bugzilla.opensuse.org/show_bug.cgi?id=1159740">boo#1159740</a></pre>
    </div><div id="c30" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-19 14:10:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Changes affecting this bug have been commented on in <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740">bug 1159740</a>. The current
changes are still not fixing the problem at hand.

In accordance with out new security policy [1], I'm setting a latest
publication date for this issue - fixed or not - based on the creation date of
this bug:

Internal CRD: 2020-03-09 or earlier

[1]: <a href="https://en.opensuse.org/openSUSE:Security_disclosure_policy">https://en.opensuse.org/openSUSE:Security_disclosure_policy</a></pre>
    </div><div id="c31" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c31">Comment 31</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-25 12:04:15 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The issue in the cron job is tracked as CVE-2020-8017</pre>
    </div><div id="c32" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c32">Comment 32</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-25 12:46:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to  <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740#c37">bug 1159740 comment 37</a>)
<span class="quote">&gt; See latest submit requests for texlive and texlive-filesystem</span >

So there you changed things in the spec file, but not the cron job?

The cron job as quoted in <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740#c33">bug 1159740 comment 33</a> is at the root of the problem
here, because it still uses dynamics that allows the mktex user to trick root
into deleting privileged files.

The `setpriv --reuid $uid` needs to be changed to `setpriv --reuid mktex`, the
UID lookup logic be removed, the sticky bit directories again be owned by
the unprivileged user.

I've lost track of your many submissions but you had this basically in IBS
sr#209865, only using the nobody user.</pre>
    </div><div id="c33" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c33">Comment 33</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-25 13:14:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matthias Gerstner from <a href="show_bug.cgi?id=1158910#c32">comment #32</a>)
<span class="quote">&gt; (In reply to  <a href="mailto:werner&#64;suse.com">werner&#64;suse.com</a> from <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740#c37">bug 1159740 comment 37</a>)
&gt; &gt; See latest submit requests for texlive and texlive-filesystem
&gt; 
&gt; So there you changed things in the spec file, but not the cron job?
&gt; 
&gt; The cron job as quoted in <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - VUL-0: CVE-2020-8016: texlive-filesystem: sticky bit for dirs like /var/lib/texmf/fonts, race condition in spec file"
   href="show_bug.cgi?id=1159740#c33">bug 1159740 comment 33</a> is at the root of the
&gt; problem
&gt; here, because it still uses dynamics that allows the mktex user to trick root
&gt; into deleting privileged files.
&gt; 
&gt; The `setpriv --reuid $uid` needs to be changed to `setpriv --reuid mktex`,
&gt; the
&gt; UID lookup logic be removed, the sticky bit directories again be owned by
&gt; the unprivileged user.
&gt; 
&gt; I've lost track of your many submissions but you had this basically in IBS
&gt; sr#209865, only using the nobody user.</span >

See <span class=""><a href="attachment.cgi?id=831040" name="attach_831040" title="texlive-filesystem.spec">attachment #831040</a> <a href="attachment.cgi?id=831040&amp;action=edit" title="texlive-filesystem.spec">[details]</a></span> for spec file .... btw. it is regardless if ls-R belongs to user root or user mktex.    The mktex utilities like mktexlsr do not and never had executed as user root but as user mktex (former user nobody) within group mktex due to the utility /usr/lib/mktex/public (for source see <span class=""><a href="attachment.cgi?id=831047" name="attach_831047" title="the public.c which does execute the mktexlsr">attachment #831047</a> <a href="attachment.cgi?id=831047&amp;action=edit" title="the public.c which does execute the mktexlsr">[details]</a></span>) since 2010 ... and before 2010 there was a patch for mktexlsr to use su to switch to user nobody before doing the final ``ls -R`` command

```
 id uid=0(root) gid=0(root) groups=0(root)
 ll /var/cache/texmf/fonts/ls-R
 lrwxrwxrwx 1 mktex mktex 15 Feb 25 12:58 /var/cache/texmf/fonts/ls-R -&gt; /etc/hosts.test
  mktexlsr 
 warning: kpathsea: /var/cache/texmf/fonts/ls-R: No usable entries in ls-R.
 warning: kpathsea: See the manual for how to generate ls-R. 
 warning: kpathsea: /var/cache/texmf/fonts/ls-R: No usable entries in ls-R.
 warning: kpathsea: See the manual for how to generate ls-R.
 mktexlsr: Updating /etc/texmf/ls-R... 
 mktexlsr: Updating /var/lib/texmf/main/ls-R... 
 mktexlsr: /etc/hosts.test: no write permission, skipping...
 mktexlsr: Updating /var/lib/texmf/ls-R... 
 mktexlsr: Done.
```</pre>
    </div><div id="c34" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c34">Comment 34</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-25 15:18:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Dr. Werner Fink from <a href="show_bug.cgi?id=1158910#c33">comment #33</a>)
<span class="quote">&gt; The mktex utilities like mktexlsr do not and never had executed as user root but as user mktex</span >

The issue isn't mktexlsr. %post and %pre run as root. Anything you do there without special precautions like setpriv will run as root and can be problematic if it operates on assumptions that can be broken by unprivileged users (e.g. chown'ing a file that might not be what you think it is).

I prepared a safe version in 
home:jsegitz:branches:Publishing:TeXLive/texlive-filesystem
Basically it just separates the creation of the ls-R file in /var/cache/texmf/fonts/ and keeps the remaining logic.

With the correct entries in the permission.d entries that reflect the ownership of /var/cache/texmf/fonts/ls-R it also removes the warnings you saw</pre>
    </div><div id="c35" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-26 09:52:14 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Johannes Segitz from <a href="show_bug.cgi?id=1158910#c34">comment #34</a>)

<span class="quote">&gt; I prepared a safe version in 
&gt; home:jsegitz:branches:Publishing:TeXLive/texlive-filesystem
&gt; Basically it just separates the creation of the ls-R file in
&gt; /var/cache/texmf/fonts/ and keeps the remaining logic.</span >

OK ... with this I'd like to suggest something like the following

```
error=0
user=
for dir in      %{_texmfconfdir}        \
                %{_fontcache}           \
                %{_texmfvardir}         \
                %{_texmfvardir}/dist    \
                %{_texmfvardir}/main
do
    test &quot;$dir&quot; = %{_fontcache} &amp;&amp; user=%{texusr} || user=root
    setpriv --reuid $user --regid mktex --init-groups /bin/sh -ec &quot;     
        tmp=\$(mktemp ${dir}/ls-R.XXXXXX)
        chmod 0664 \${tmp}
        echo '%% ls-R -- filename database for kpathsea; do not change this line.' &gt; \${tmp}
        mv \${tmp} ${dir}/ls-R&quot; || error=1
done
```

Does the same job, only the setpriv is used for each ls-R once wit the help of a string command list for /bin/sh ... at least it does work here as the ``mv`` command will overwrite even symbolic links or simply fail if it can not do this.</pre>
    </div><div id="c36" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-27 09:52:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Dr. Werner Fink from <a href="show_bug.cgi?id=1158910#c35">comment #35</a>)
yes, that is a secure solution and also more elegant since it avoids extracting the special case of %{_fontcache}.</pre>
    </div><div id="c37" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-27 17:12:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2020:0520-1: An update that contains security fixes can now be installed.

Category: security (moderate)
Bug References: 1150556,1155381,1158910,1159740
CVE References: 
Sources used:
SUSE Linux Enterprise Software Development Kit 12-SP5 (src):    texlive-filesystem-2013.74-16.5.1
SUSE Linux Enterprise Software Development Kit 12-SP4 (src):    texlive-filesystem-2013.74-16.5.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c38" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-02-27 17:14:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2020:0519-1: An update that contains security fixes can now be installed.

Category: security (moderate)
Bug References: 1150556,1155381,1158910,1159740
CVE References: 
Sources used:
SUSE Linux Enterprise Module for Desktop Applications 15-SP1 (src):    texlive-filesystem-2017.135-9.5.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c40" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-05 10:32:17 UTC
        </span>
      </div>



<pre class="bz_comment_text" >When can I submit to Tumbleweed/Factory</pre>
    </div><div id="c41" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c41">Comment 41</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-06 09:15:22 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Dr. Werner Fink from <a href="show_bug.cgi?id=1158910#c40">comment #40</a>)
The spec file can be submitted right away. I need to have another look at the cron job, I'll comment in <a href="http://bugzilla.suse.com/show_bug.cgi?id=1159740">bsc#1159740</a></pre>
    </div><div id="c42" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c42">Comment 42</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-06 09:18:50 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Johannes Segitz from <a href="show_bug.cgi?id=1158910#c41">comment #41</a>)
sorry, I switched the bugs since we had the final discussion for the spec file here. So the spec file is fine and I'll comment here once I had a final look at the cron-job</pre>
    </div><div id="c43" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c43">Comment 43</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-06 12:19:34 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I agree with the assessment of Matthias. Can you please go back to the logic submitted in sr#209865 and change setpriv to use mktex instaed of nobody? With that it would be fine to submit to Factory too.</pre>
    </div><div id="c44" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c44">Comment 44</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-06 12:30:21 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Created <span class="bz_obsolete"><a href="attachment.cgi?id=832111" name="attach_832111" title="texlive.cron">attachment 832111</a> <a href="attachment.cgi?id=832111&amp;action=edit" title="texlive.cron">[details]</a></span>
texlive.cron

(In reply to Johannes Segitz from <a href="show_bug.cgi?id=1158910#c43">comment #43</a>)
<span class="quote">&gt; I agree with the assessment of Matthias. Can you please go back to the logic
&gt; submitted in sr#209865 and change setpriv to use mktex instaed of nobody?
&gt; With that it would be fine to submit to Factory too.</span >

Ah?  I use mktex resp. the user how has created the files and this is what I've already committed</pre>
    </div><div id="c45" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c45">Comment 45</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-11 10:38:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Yes, I've seen that, but you also have the logic that first looks for the uids used and then iterates over all of them, calling setpriv with reuid 0 at one point. 

I couldn't find a way to misuse that though in the current setup, although I would prefer a less complex solution. So from my POV we're done here, please submit to Factory. Matthias will ensure that the current cron job is whitelisted accordingly.</pre>
    </div><div id="c64" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c64">Comment 64</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-23 17:00:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an autogenerated message for OBS integration:
This bug (1158910) was mentioned in
<a href="https://build.opensuse.org/request/show/787537">https://build.opensuse.org/request/show/787537</a> Factory / texlive-filesystem</pre>
    </div><div id="c65" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c65">Comment 65</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-03-23 20:45:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >openSUSE-SU-2020:0368-1: An update that contains security fixes can now be installed.

Category: security (moderate)
Bug References: 1150556,1155381,1158910,1159740
CVE References: 
Sources used:
openSUSE Leap 15.1 (src):    texlive-filesystem-2017.135-lp151.8.3.1</pre>
    </div><div id="c69" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c69">Comment 69</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Dr. Werner Fink</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-05-29 14:41:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >done</pre>
    </div><div id="c71" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c71">Comment 71</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-06-09 22:34:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2020:1580-1: An update that fixes two vulnerabilities is now available.

Category: security (moderate)
Bug References: 1158910,1159740
CVE References: CVE-2020-8016,CVE-2020-8017
Sources used:
SUSE Linux Enterprise Module for Desktop Applications 15-SP1 (src):    texlive-2017.20170520-11.13.2, texlive-filesystem-2017.135-9.12.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c72" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c72">Comment 72</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-06-09 22:35:11 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2020:1581-1: An update that solves two vulnerabilities and has one errata is now available.

Category: security (moderate)
Bug References: 1138793,1158910,1159740
CVE References: CVE-2020-8016,CVE-2020-8017
Sources used:
SUSE Linux Enterprise Software Development Kit 12-SP5 (src):    texlive-2013.20130620-22.8.2, texlive-filesystem-2013.74-16.12.1
SUSE Linux Enterprise Software Development Kit 12-SP4 (src):    texlive-2013.20130620-22.8.2, texlive-filesystem-2013.74-16.12.1
SUSE Linux Enterprise Server 12-SP5 (src):    texlive-2013.20130620-22.8.2
SUSE Linux Enterprise Server 12-SP4 (src):    texlive-2013.20130620-22.8.2

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c73" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c73">Comment 73</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-06-13 07:17:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >openSUSE-SU-2020:0804-1: An update that fixes two vulnerabilities is now available.

Category: security (moderate)
Bug References: 1158910,1159740
CVE References: CVE-2020-8016,CVE-2020-8017
Sources used:
openSUSE Leap 15.1 (src):    texlive-2017.20170520-lp151.12.3.1, texlive-filesystem-2017.135-lp151.8.6.1</pre>
    </div><div id="c74" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c74">Comment 74</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-07-08 13:25:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2020:1580-2: An update that fixes two vulnerabilities is now available.

Category: security (moderate)
Bug References: 1158910,1159740
CVE References: CVE-2020-8016,CVE-2020-8017
Sources used:
SUSE Linux Enterprise Module for Desktop Applications 15-SP2 (src):    texlive-filesystem-2017.135-9.12.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c75" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1158910#c75">Comment 75</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexandros Toptsoglou</span>
</span>
        </span>

        <span class="bz_comment_time">
          2020-07-09 14:32:12 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Done</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=1158910">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=1158910">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=1158910">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <!--a id="login_link_bottom" href="show_bug.cgi?id=1158910&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a-->
  <a id="login_link_bottom" href="show_bug.cgi?id=1158910&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1158910" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
  </li>

  
    


  <form id="testopia_helper_frm"></form><ul class="links">
    <li>Legal: </li>
    <li><a href="http://en.opensuse.org/Terms_of_site">openSUSE</a></li>
    <li><a href="https://www.suse.com/company/legal/">SUSE</a></li>
  </ul>
</ul>

  <div class="outro"></div>
</div>


</body>
</html>