<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - FTP shutdown response buffer overflow - CVE-2018-1000300</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>FTP shutdown response buffer overflow</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="ftp-shutdown-response-buffer-overflow">FTP shutdown response buffer overflow</h1>
<p>Project curl Security Advisory, May 16th 2018 - <a href="https://curl.se/docs/CVE-2018-1000300.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>curl might overflow a heap based memory buffer when closing down an FTP connection with very long server command replies.</p>
<p>When doing FTP transfers, curl keeps a spare &quot;closure handle&quot; around internally that will be used when an FTP connection gets shut down since the original curl easy handle is then already removed.</p>
<p>FTP server response data that gets cached from the original transfer might then be larger than the default buffer size (16 KB) allocated in the &quot;closure handle&quot;, which can lead to a buffer overwrite. The contents and size of that overwrite is controllable by the server.</p>
<p>This situation was detected by an assert() in the code, but that was of course only preventing bad stuff in debug builds. This bug is very unlikely to trigger with non-malicious servers.</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This bug was introduced in April 2017 in <a href="https://github.com/curl/curl/commit/e40e9d7f0decc79">this commit</a> when we introduced the use of increased buffer sizes for FTP.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2018-1000300 to this issue.</p>
<p>CWE-122: Heap-based Buffer Overflow</p>
<p>Severity: High</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: curl <a href="vuln-7.54.1.html">7.54.1</a> to and including curl <a href="vuln-7.59.0.html">7.59.0</a></li>
<li>Not affected versions: curl &lt; <a href="vuln-7.54.1.html">7.54.1</a> and curl &gt;= <a href="vuln-7.60.0.html">7.60.0</a></li>
</ul>
<p>libcurl is used by many applications, but not always advertised as such.</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>In curl version <a href="vuln-7.60.0.html">7.60.0</a>, curl will return an error if this situation happens.</p>
<p>A <a href="https://curl.se/CVE-2018-1000300.patch">patch for CVE-2018-1000300</a> is available.</p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade curl to version <a href="vuln-7.60.0.html">7.60.0</a></p>
<p>B - Apply the patch to your version and rebuild</p>
<p>C - Avoing using FTP</p>
<h2 id="time-line">TIME LINE</h2>
<p>It was reported to the curl project on March 22, 2018</p>
<p>We contacted distros@openwall on May 7, 2018.</p>
<p>curl <a href="vuln-7.60.0.html">7.60.0</a> was released on May 16 2018, coordinated with the publication of this advisory.</p>
<h2 id="credits">CREDITS</h2>
<p>Detected by Dario Weisser. Patch by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
