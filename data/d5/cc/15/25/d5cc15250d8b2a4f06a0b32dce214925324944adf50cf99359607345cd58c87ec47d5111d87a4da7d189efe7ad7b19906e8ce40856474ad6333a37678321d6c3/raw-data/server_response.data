<!DOCTYPE html>
<html lang="en">
<head>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92665328-1"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-92665328-1');
    </script>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>[CVE-2017-5623] OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing</title>
<meta name="name" content="CVE-2017-5623">
<meta name="description" content="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing">
<meta name="image" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@alephsecurity">
<meta name="twitter:creator" content="@alephsecurity">
<meta name="twitter:title" content="CVE-2017-5623">
<meta name="twitter:url" content="https://alephsecurity.com/vulns/aleph-2017005">
<meta name="twitter:description" content="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing">
<meta name="twitter:image:src" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta property="og:site_name" content="">
<meta property="og:title" content="CVE-2017-5623">
<meta property="og:type" content="article">
<meta property="og:description" content="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing">
<meta property="og:url" content="https://alephsecurity.com/vulns/aleph-2017005">
<meta property="article:published_time" content="2017-03-19T00:00:00+00:00">
<meta property="article:author" content="https://alephsecurity.com">
<meta property="og:image" content="https://alephsecurity.com/assets/img/logo-black.png">
<link rel="icon" href="/favicon.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700">
<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: "none",
      tex2jax: {preview: "none"},
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG: { linebreaks: { automatic: true } }
    });
    </script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
<div class="wrapper">
<div class="page__back">
<a href="/">&lt;-- <span class="smallogo">א</span></a>
</div>
<div class="page">
<div class="advisory">
<div class="advisory__title">
<h1>OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing</h1>
</div>
<div class="advisory__subtitle">
Aleph Research Advisory
</div>
<div class="advisory__meta">
<p></p>
</div>
<h2>Identifier</h2>
<div class="cve-moderate"><span class="" title="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing"><a href="/vulns/aleph-2017005">CVE-2017-5623</a></span></div>
<h2>Severity</h2>
Moderate
<h2>Products</h2>
<div class="numberedlistnoalternative">
<ol>
<li><p>OnePlus 3T</p>
</li>
<li><p>OnePlus 3</p>
</li>
</ol>
</div>
<h2>Vulnerable Version</h2>
<p>OxygenOS 4.0.3 and below</p>
<h2>Mitigation</h2>
<p>Upgrade to OxygenOS 4.1.</p>
<h2>Summary</h2>
<div class="advisory__content" ?>
<p>A physical attacker (or one with authorized-ADB access, e.g. PC malware) can change the ‘boot mode’ of a locked OnePlus 3/3T device, by rebooting into <code class="language-plaintext highlighter-rouge">fastboot</code> and issuing the <code class="language-plaintext highlighter-rouge">fastboot oem boot_mode {rf/wlan/ftm/normal}</code> command. The vulnerability may allow the attacker to elevate his privileges &amp; exfiltrate modem-related information, in contradiction to the fact that locked bootloaders MUST NOT allow any security-sensitive operation to be run.</p>
</div>
<h2>Technical Details</h2>
<div class="advisory__content" ?>
<p>Similarly to <span class="cve-high" title="Google Nexus 6/6P Custom Boot Modes USB Configs Override"><a href="/vulns/aleph-2016002">CVE-2016-8467</a></span>, the attacker can change the boot mode of the device by issuing the <code class="language-plaintext highlighter-rouge">fastboot oem boot_mode {rf/wlan/ftm/normal}</code> command. For example:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;</span><span class="w"> </span>fastboot oem boot_mode wlan
<span class="c">...
</span><span class="go">OKAY
[ 0.034s] finished. total time: 0.036s
</span></code></pre></div></div>
<p>Beyond the intended functionalities of the special boot modes (which could be problematic on their own, however, we did not investigate them), such a boot mode change causes the bootloader to load the platform in an non-secure configuration – <code class="language-plaintext highlighter-rouge">adb</code> access is now available (without requiring host-authorization, albeit <code class="language-plaintext highlighter-rouge">userdata</code> is unmounted) together with <code class="language-plaintext highlighter-rouge">permissive</code>-mode SELinux. This can be seen by the output of the <code class="language-plaintext highlighter-rouge">getenforce</code> command:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;</span><span class="w"> </span>adb <span class="nt">-d</span> shell
<span class="gp">OnePlus3:/ $</span><span class="w"> </span>getenforce
<span class="go">Permissive
</span><span class="gp">OnePlus3:/ $</span><span class="w">
</span></code></pre></div></div>
<p>With <code class="language-plaintext highlighter-rouge">permissive</code>-mode SELinux, the attacker could bypass security controls normally enforced by SELinux. For example, we’ve managed to change the USB configuration, so that sensitive USB interfaces are now enabled (e.g. the modem’s <code class="language-plaintext highlighter-rouge">diag</code> and <code class="language-plaintext highlighter-rouge">AT</code> interfaces):</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">OnePlus3:/ $</span><span class="w"> </span>setprop sys.usb.config diag,acm_smd,acm_tty,rmnet_bam,mass_storage,adb
<span class="gp">OnePlus3:/ $</span><span class="w">
</span></code></pre></div></div>
<p>The command above enables the following USB interfaces:
<img src="/assets/img/CVE20175623USBInterfaces.png" alt="Enabled USB interfaces" />
The <code class="language-plaintext highlighter-rouge">Qualcomm HS-USB MDM Modem</code> interface is the <code class="language-plaintext highlighter-rouge">AT</code> interface of the device’s modem:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="go">ATI
Manufacturer: QUALCOMM INCORPORATED
Model: 4112
Revision: MPSS.TH.2.0.c1.9-00078-M8996FAAAANAZM-1.81324.1  1  [Dec 15 2016 20:00:00]
SVN: 01
IMEI: [...]
+GCAP: +CGSM

OK
</span></code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">Qualcomm HS-USB Diagnostics</code> interface is the modem’s diagnostics interface, and as explained thoroughly in the <a href="/2017/01/05/attacking-android-custom-bootmodes/">Nexus 6/6P blog post</a>, allows the attacker to modify modem-related configurations, and exfltrate sensitive information.</p>
<p>The vulnerability is rated with <strong>Moderate</strong> severity only (as opposed to <strong>High</strong> severity <span class="cve-high" title="Google Nexus 6/6P Custom Boot Modes USB Configs Override"><a href="/vulns/aleph-2016002">CVE-2016-8467</a></span>) because after the boot mode change, the platform does not continue with its normal boot process – it will perpetually display a notification to the user (although the victim may notice it too late, if at all):
<img src="/assets/img/CVE20175623Notification.png" alt="Boot Mode Change Notification" /></p>
<p>It should be noted that <span class="cve-high" title="Google Nexus 6/6P Custom Boot Modes USB Configs Override"><a href="/vulns/aleph-2016002">CVE-2016-8467</a></span> did not enable ADB nor set SELinux to <code class="language-plaintext highlighter-rouge">permissive</code> mode.</p>
<p>OxygenOS 4.1.0 has mitigated the issue by removing the <code class="language-plaintext highlighter-rouge">fastboot oem boot_mode</code> command from its bootloader:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">&gt;</span><span class="w"> </span>fastboot oem boot_mode
<span class="c">...
</span><span class="go">FAILED (remote: unknown command)
finished. total time: 0.023s
</span></code></pre></div></div>
</div>
<h2>Timeline</h2>
<div class="list"><ul><li><div class="list__date"><span>19-Mar-17<span></div>: Public disclosure.</li><li><div class="list__date"><span>16-Mar-17<span></div>: Patch available.</li><li><div class="list__date"><span>01-Mar-17<span></div>: Added as <span class="cve-moderate" title="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing"><a href="/vulns/aleph-2017005">ALEPH-2017005</a></span>.</li><li><div class="list__date"><span>29-Jan-17<span></div>: <span class="cve-moderate" title="OnePlus 3/3T OxygenOS Unauthorized Boot Mode Changing"><a href="/vulns/aleph-2017005">CVE-2017-5623</a></span> assigned.</li><li><div class="list__date"><span>25-Jan-17<span></div>: CVE ID requested.</li></ul></div>
<h2>Posts</h2>
<div class="pagelist__narrow"><ul> <li onclick="javscript:document.location.href='/2017/01/05/attacking-android-custom-bootmodes/'"> <a href="/2017/01/05/attacking-android-custom-bootmodes/">Attacking Nexus 6/6P Custom Boot Modes </a> <div class="pagelist__subtitle">By <a href="/authors/roeeh">Roee Hay</a> & <a href="/authors/goberman">Michael Goberman</a>, <div class="pagelist__date"><span>05-Jan 2017</span></div></div></li> </ul></div>
<h2>Credit</h2>
<div class="list">
<ul>
<li>
<a href="/authors/roeeh">Roee Hay</a> (<a href="https://twitter.com/roeehay">@roeehay</a>) of Aleph Research, HCL Technologies
</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
