<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1267183003: Hide requests in an extension from other extensions -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '48ee3c7d4f9dfba182a05c3441d5e4bc';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1267183003%252526ust%25253D1608713731200720%252526usg%25253DAFQjCNE-tQ-17HdQjr6yooQeWIUfQulQ6w%26service%3Dah">Sign out</a>

</div>
<div class="counter">(203)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1267183003">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1267183003/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1267183003</a>:
    Hide requests in an extension from other extensions  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            5 years, 4 months ago by <a href="/user/robwu" onMouseOver="M_showUserInfoPopup(this)">robwu</a>
          </div>
          <div><b>Modified:</b><br/>
            5 years, 4 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <a href="/user/Fady%20Samuel" onMouseOver="M_showUserInfoPopup(this)">Fady Samuel</a>, <a href="/user/Devlin" onMouseOver="M_showUserInfoPopup(this)">Devlin</a>, <a href="/user/battre" onMouseOver="M_showUserInfoPopup(this)">battre</a>, <a href="/user/lazyboy" onMouseOver="M_showUserInfoPopup(this)">lazyboy</a>, <span class='approval'>*<a href="/user/not%20at%20google%20-%20send%20to%20devlin" onMouseOver="M_showUserInfoPopup(this)">not at google - send to devlin</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, chromium-apps-reviews_chromium.org, extensions-reviews_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Hide requests in an extension from other extensions

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=510802">510802</a>
Committed: <a href="https://crrev.com/86154b409eed6ea7f9177f6bf576e76533ab2f7b">https://crrev.com/86154b409eed6ea7f9177f6bf576e76533ab2f7b</a>
Cr-Commit-Position: refs/heads/master@{#341939}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1267183003/#ps1"
       onclick="M_toggleSectionForPS('1267183003', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1267183003/#ps20001"
       onclick="M_toggleSectionForPS('1267183003', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Fix tests, add TODO for ExtensionWebRequestEventRouter::OnEventHandled
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 18
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1267183003/#ps40001"
       onclick="M_toggleSectionForPS('1267183003', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Update tests (processed review comments #8).
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 7
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1267183003/#ps60001"
       onclick="M_toggleSectionForPS('1267183003', '60001')"
       class="toggled-section opentriangle">
      Patch Set 4
      : Update comment in operator&lt;, remove blank line, OOPIF-friendly test
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 3
      
    </div>
  

  <div id="ps-60001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 5 years, 4 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1267183003_60001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1267183003/60001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+210 lines, -16 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70001">
            chrome/browser/extensions/api/web_request/web_request_apitest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/browser/extensions/api/web_request/web_request_apitest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/browser/extensions/api/web_request/web_request_apitest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/browser/extensions/api/web_request/web_request_apitest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1267183003/diff2/40001:60001/chrome/browser/extensions/api/web_request/web_request_apitest.cc"
             title="Delta from patch set 3">3</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+65 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70001.diff"
             title="Download patch for chrome/browser/extensions/api/web_request/web_request_apitest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70002">
            chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+17 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70002.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70003">
            chrome/test/data/extensions/api_test/webrequest_extensions/app/manifest.json
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/manifest.json">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/manifest.json"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/app/manifest.json"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+3 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70003.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/app/manifest.json">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70004">
            chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+18 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70004.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70005">
            chrome/test/data/extensions/api_test/webrequest_extensions/extension/contentscript.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/contentscript.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/contentscript.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/contentscript.js"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+21 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70005.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/extension/contentscript.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70006">
            chrome/test/data/extensions/api_test/webrequest_extensions/extension/frame.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/frame.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/frame.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/frame.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70006.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/extension/frame.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70007">
            chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+16 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70007.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70008">
            chrome/test/data/extensions/api_test/webrequest_extensions/extension/manifest.json
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/manifest.json">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/manifest.json"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/manifest.json"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+15 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70008.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/extension/manifest.json">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70009">
            chrome/test/data/extensions/api_test/webrequest_extensions/main/background.js
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/background.js">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/background.js"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/background.js"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+25 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70009.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/main/background.js">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A +</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70010">
            chrome/test/data/extensions/api_test/webrequest_extensions/main/manifest.json
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/manifest.json">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/manifest.json"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/chrome/test/data/extensions/api_test/webrequest_extensions/main/manifest.json"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+7 lines, -6 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70010.diff"
             title="Download patch for chrome/test/data/extensions/api_test/webrequest_extensions/main/manifest.json">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1267183003/patch/60001/70011">
            extensions/browser/api/web_request/web_request_api.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1267183003/diff2/1:60001/extensions/browser/api/web_request/web_request_api.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1267183003/diff2/20001:60001/extensions/browser/api/web_request/web_request_api.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1267183003/diff2/40001:60001/extensions/browser/api/web_request/web_request_api.cc"
             title="Delta from patch set 3">3</a>
        
        </td>
        
          <td style="white-space: nowrap">5 chunks</td>
          <td style="white-space: nowrap">+22 lines, -7 lines</td>
        
        <td style="white-space: nowrap">
          <b>
            3 comments
            
            
          </b>
        </td>
        <td>
          <a href="/download/issue1267183003_60001_70011.diff"
             title="Download patch for extensions/browser/api/web_request/web_request_api.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 60001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 24 (8 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          rob@robwu.nl changed reviewers: + battre@chromium.org, fsamuel@chromium.org, kalman@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 11:37:29 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed reviewers:
+ <a href="mailto:battre@chromium.org">battre@chromium.org</a>, <a href="mailto:fsamuel@chromium.org">fsamuel@chromium.org</a>, <a href="mailto:kalman@chromium.org">kalman@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          rob@robwu.nl changed required reviewers: + kalman@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 11:37:29 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ><a href="mailto:rob@robwu.nl">rob@robwu.nl</a> changed required reviewers:
+ <a href="mailto:kalman@chromium.org">kalman@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          Dominic: Please review my logic. Ben: Please review perform the OWNER review. Fady: I have ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 11:37:30 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >Dominic: Please review my logic.

Ben: Please review perform the OWNER review.

Fady: I have added a TODO in ExtensionWebRequestEventRouter::OnEventHandled.
Could you check whether the TODO is warranted, and if so pick it up? If I&#39;m not
mistaken, the issue was introduced with
<a href="https://codereview.chromium.org/864893003" rel="nofollow">https://codereview.chromium.org/864893003</a>.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Fady Samuel</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          fsamuel@chromium.org changed reviewers: + lazyboy@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 14:40:57 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            ><a href="mailto:fsamuel@chromium.org">fsamuel@chromium.org</a> changed reviewers:
+ <a href="mailto:lazyboy@chromium.org">lazyboy@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Fady Samuel</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          I no longer work on &lt;webview&gt;. Passing along to Istiaque! Thanks!
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 14:40:57 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >I no longer work on &lt;webview&gt;. Passing along to Istiaque! Thanks!</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>lazyboy</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          FYI, before I can review, can you provide me access to crbug.com/510802. I don&#39;t have ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 15:59:26 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >FYI, before I can review, can you provide me access to crbug.com/510802. I don&#39;t
have much context w/o looking at the bug.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js#newcode6" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js:6:
var baseUrl = &#39;http://example.com:&#39; + config.testServer.port;
nit: Indent 2 spaces in this CL.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          On 2015/08/04 15:59:26, lazyboy wrote: &gt; FYI, before I can review, can you provide me ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 16:18:15 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >On 2015/08/04 15:59:26, lazyboy wrote:
&gt; FYI, before I can review, can you provide me access to crbug.com/510802. I
don&#39;t
&gt; have much context w/o looking at the bug.

Thanks Istiaque for your input, but you don&#39;t need to fully review this CL
(battre@/kalman@ are better suited for that. I only asked Fady because of a
potential flaw that I found while developing this patch (see below).

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode1250" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1250: // takes the webview
ID into account, which is not set on |listener|.
Fady / Istiaque: This new TODO item is completely unrelated to the patch itself.
I added you to this ticket because I was wondering whether 1) this item is in
fact a real problem, and 2) if it is, whether you&#39;ll fix the issue.

In retrospect I should have created a new ticket to avoid confusion, but
hindsight is 20/20.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>not at google - send to devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          Thanks for doing this. https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right): https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode330 chrome/browser/extensions/api/web_request/web_request_apitest.cc:330: ExtensionTestMessageListener listener_extension(&quot;extension_done&quot;, false); could you ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 20:27:02 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >Thanks for doing this.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode330" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:330:
ExtensionTestMessageListener listener_extension(&quot;extension_done&quot;, false);
could you standardise on camelcase vs underscores?

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode337" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:337: // Perform
some network activity in an app and another extension.
1. The app and extension do slightly different things. They both fire XHR but
the extension is the one which triggers the navigation which ultimately
completes the test. This way of finishing the test seems arbitrary to me
actually; it&#39;s interesting to use the webRequest API to trigger it, but it would
be simpler to use extension messaging to communicate.

2. As I mentioned, it would be good to also have a test for a website that hosts
an extension&#39;s (web accessible of course) iframe, since that should bypass the
process ID check.

3. It would be good to test what functionality is supposed to work; intercepting
requests from yourself. It should be pretty straightforward to modify the &quot;main&quot;
extension to do an XHR before continuing with its test assertion.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js#newcode1" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js:1:
// Copyright (c) 2015 The Chromium Authors. All rights reserved.
(c) is not needed

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js#newcode6" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js:6:
var baseUrl = &#39;http://example.com:&#39; + config.testServer.port;
On 2015/08/04 15:59:26, lazyboy wrote:
&gt; nit: Indent 2 spaces in this CL.

yep, here and the JS in the other files as well.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js#newcode19" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js:19:
chrome.test.sendMessage(&#39;extension_done&#39;);
good practice to remove listener after this.

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:454: // of find() without
specifying the process ID of the extension.
Huh, funky. Where does this actually make a difference? I *would* rather we be
principled and set the process ID everywhere, unless there is a good reason not
to.

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode1483" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1483: if
(is_request_from_extension &amp;&amp;
Comment this (&quot;allow requests from the extension&quot;), because it&#39;s subtle.

Also note that this won&#39;t work for iframes right now, but once site isolation is
in place, it will. I am fine with this behavior, but consider testing that.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right): https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode330 chrome/browser/extensions/api/web_request/web_request_apitest.cc:330: ExtensionTestMessageListener listener_extension(&quot;extension_done&quot;, false); On 2015/08/04 20:27:02, kalman wrote: &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 21:57:24 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            ><a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode330" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:330:
ExtensionTestMessageListener listener_extension(&quot;extension_done&quot;, false);
On 2015/08/04 20:27:02, kalman wrote:
&gt; could you standardise on camelcase vs underscores?

Done.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode337" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:337: // Perform
some network activity in an app and another extension.
On 2015/08/04 20:27:02, kalman wrote:
&gt; 1. The app and extension do slightly different things. They both fire XHR but
&gt; the extension is the one which triggers the navigation which ultimately
&gt; completes the test. This way of finishing the test seems arbitrary to me
&gt; actually; it&#39;s interesting to use the webRequest API to trigger it, but it
would
&gt; be simpler to use extension messaging to communicate.

Good point, done.

&gt; 
&gt; 2. As I mentioned, it would be good to also have a test for a website that
hosts
&gt; an extension&#39;s (web accessible of course) iframe, since that should bypass the
&gt; process ID check.

Done (with a content script).

&gt; 
&gt; 3. It would be good to test what functionality is supposed to work;
intercepting
&gt; requests from yourself. It should be pretty straightforward to modify the
&quot;main&quot;
&gt; extension to do an XHR before continuing with its test assertion.

This is already covered by other tests (e.g. BackgroundXhrTest.TlsClientAuth and
BackgroundXhrTest.HttpAuth).

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js#newcode1" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js:1:
// Copyright (c) 2015 The Chromium Authors. All rights reserved.
On 2015/08/04 20:27:02, kalman wrote:
&gt; (c) is not needed

Done.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js#newcode6" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/app/background.js:6:
var baseUrl = &#39;http://example.com:&#39; + config.testServer.port;
On 2015/08/04 20:27:02, kalman wrote:
&gt; On 2015/08/04 15:59:26, lazyboy wrote:
&gt; &gt; nit: Indent 2 spaces in this CL.
&gt; 
&gt; yep, here and the JS in the other files as well.

Done.

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js#newcode19" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/extension/background.js:19:
chrome.test.sendMessage(&#39;extension_done&#39;);
On 2015/08/04 20:27:02, kalman wrote:
&gt; good practice to remove listener after this.

I&#39;ve removed the tab-load detection from the page, now I&#39;m relying on a message
from the content script.

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:454: // of find() without
specifying the process ID of the extension.
On 2015/08/04 20:27:02, kalman wrote:
&gt; Huh, funky. Where does this actually make a difference? I *would* rather we be
&gt; principled and set the process ID everywhere, unless there is a good reason
not
&gt; to.

WebRequestAPI::OnListenerRemoved doesn&#39;t provide any information about the
reason for event removal. I don&#39;t want to rely on the process ID for removal, to
avoid getting bit by the following scenario:
1. Extension unloads.
2. OnListenerRemoved is called.
3. Meanwhile the extension process is gone.
4. The browser process tries to look up the process ID for the given extension
ID, but doesn&#39;t find any.

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode1483" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1483: if
(is_request_from_extension &amp;&amp;
On 2015/08/04 20:27:02, kalman wrote:
&gt; Comment this (&quot;allow requests from the extension&quot;), because it&#39;s subtle.
&gt; 
&gt; Also note that this won&#39;t work for iframes right now, but once site isolation
is
&gt; in place, it will. I am fine with this behavior, but consider testing that.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>not at google - send to devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          kalman@chromium.org changed reviewers: + rdevlin.cronin@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 23:12:02 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            ><a href="mailto:kalman@chromium.org">kalman@chromium.org</a> changed reviewers:
+ <a href="mailto:rdevlin.cronin@chromium.org">rdevlin.cronin@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>not at google - send to devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          lgtm https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc File extensions/browser/api/web_request/web_request_api.cc (right): https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454 extensions/browser/api/web_request/web_request_api.cc:454: // of find() without specifying the process ID ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 23:12:03 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >lgtm

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:454: // of find() without
specifying the process ID of the extension.
On 2015/08/04 21:57:24, robwu wrote:
&gt; On 2015/08/04 20:27:02, kalman wrote:
&gt; &gt; Huh, funky. Where does this actually make a difference? I *would* rather we
be
&gt; &gt; principled and set the process ID everywhere, unless there is a good reason
&gt; not
&gt; &gt; to.
&gt; 
&gt; WebRequestAPI::OnListenerRemoved doesn&#39;t provide any information about the
&gt; reason for event removal. I don&#39;t want to rely on the process ID for removal,
to
&gt; avoid getting bit by the following scenario:
&gt; 1. Extension unloads.
&gt; 2. OnListenerRemoved is called.
&gt; 3. Meanwhile the extension process is gone.
&gt; 4. The browser process tries to look up the process ID for the given extension
&gt; ID, but doesn&#39;t find any.

Makes sense that you&#39;re guarding against a bug here. The way the comment is
phrased makes it sound like an optimisation. Perhaps fix it up a bit.

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode362" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:362: 
extra blank line

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode377" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:377: //
extension.
+rdcronin

Like I mentioned this will change with site isolation, and this test will
probably start failing for that as well. Devlin could you double check this?

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js#newcode16" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js:16:
x.send();
For the record, the ideal test factoring would probably have been to use a
TestExtensionDir from the C++ then manufacture the app, extension, and extension
iframe. This pattern of send XHR, wait for response, check there was response,
notify success is pretty common.

but no point rewriting things for that.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right): https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode377 chrome/browser/extensions/api/web_request/web_request_apitest.cc:377: // extension. On 2015/08/04 23:12:03, kalman wrote: &gt; +rdcronin ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-04 23:19:20 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            ><a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode377" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:377: //
extension.
On 2015/08/04 23:12:03, kalman wrote:
&gt; +rdcronin
&gt; 
&gt; Like I mentioned this will change with site isolation, and this test will
&gt; probably start failing for that as well. Devlin could you double check this?

Yeah, this looks like it will (or at least should) fail. Can we have two
different versions of this check, one for site isolation and one without? 
Should be sufficient just to check the commandline for the presence of the
site-per-process flag.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          The CQ bit was checked by rob@robwu.nl
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 12:51:14 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >The CQ bit was checked by <a href="mailto:rob@robwu.nl">rob@robwu.nl</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          The patchset sent to the CQ was uploaded after l-g-t-m from kalman@chromium.org Link to the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 12:51:14 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:kalman@chromium.org">kalman@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1267183003/#ps60001" rel="nofollow">https://codereview.chromium.org/1267183003/#ps60001</a>
(title: &quot;Update comment in operator&lt;, remove blank line, OOPIF-friendly test&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1267183003/60001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 12:51:40 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1267183003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1267183003/60001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>battre</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc File extensions/browser/api/web_request/web_request_api.cc (right): https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc#newcode1485 extensions/browser/api/web_request/web_request_api.cc:1485: // content scripts, or extension pages in non-extension processes. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 13:49:47 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            ><a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc#newcode1485" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1485: // content scripts,
or extension pages in non-extension processes.
Also extensions can be hosted in the same process. Would these be filtered?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc File extensions/browser/api/web_request/web_request_api.cc (right): https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454 extensions/browser/api/web_request/web_request_api.cc:454: // of find() without specifying the process ID of ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 16:38:09 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/web_request/web_request_api.cc#newcode454" rel="nofollow">https://codereview.chromium.org/1267183003/diff/20001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:454: // of find() without
specifying the process ID of the extension.
On 2015/08/04 23:12:02, kalman wrote:
&gt; On 2015/08/04 21:57:24, robwu wrote:
&gt; &gt; On 2015/08/04 20:27:02, kalman wrote:
&gt; &gt; &gt; Huh, funky. Where does this actually make a difference? I *would* rather
we
&gt; be
&gt; &gt; &gt; principled and set the process ID everywhere, unless there is a good
reason
&gt; &gt; not
&gt; &gt; &gt; to.
&gt; &gt; 
&gt; &gt; WebRequestAPI::OnListenerRemoved doesn&#39;t provide any information about the
&gt; &gt; reason for event removal. I don&#39;t want to rely on the process ID for
removal,
&gt; to
&gt; &gt; avoid getting bit by the following scenario:
&gt; &gt; 1. Extension unloads.
&gt; &gt; 2. OnListenerRemoved is called.
&gt; &gt; 3. Meanwhile the extension process is gone.
&gt; &gt; 4. The browser process tries to look up the process ID for the given
extension
&gt; &gt; ID, but doesn&#39;t find any.
&gt; 
&gt; Makes sense that you&#39;re guarding against a bug here. The way the comment is
&gt; phrased makes it sound like an optimisation. Perhaps fix it up a bit.

Done.

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
File chrome/browser/extensions/api/web_request/web_request_apitest.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode362" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:362: 
On 2015/08/04 23:12:03, kalman wrote:
&gt; extra blank line

Done.

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensions/api/web_request/web_request_apitest.cc#newcode377" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/browser/extensio...</a>
chrome/browser/extensions/api/web_request/web_request_apitest.cc:377: //
extension.
On 2015/08/04 23:19:20, Devlin wrote:
&gt; On 2015/08/04 23:12:03, kalman wrote:
&gt; &gt; +rdcronin
&gt; &gt; 
&gt; &gt; Like I mentioned this will change with site isolation, and this test will
&gt; &gt; probably start failing for that as well. Devlin could you double check this?
&gt; 
&gt; Yeah, this looks like it will (or at least should) fail. Can we have two
&gt; different versions of this check, one for site isolation and one without? 
&gt; Should be sufficient just to check the commandline for the presence of the
&gt; site-per-process flag.

Done (and ran the test locally, with and without --site-per-process flag).

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extens...</a>
File
chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js
(right):

<a href="https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js#newcode16" rel="nofollow">https://codereview.chromium.org/1267183003/diff/40001/chrome/test/data/extens...</a>
chrome/test/data/extensions/api_test/webrequest_extensions/extension/framescript.js:16:
x.send();
On 2015/08/04 23:12:03, kalman wrote:
&gt; For the record, the ideal test factoring would probably have been to use a
&gt; TestExtensionDir from the C++ then manufacture the app, extension, and
extension
&gt; iframe. This pattern of send XHR, wait for response, check there was response,
&gt; notify success is pretty common.
&gt; 
&gt; but no point rewriting things for that.

Good to know for the future. I&#39;ll keep the current CL as is though.

<a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc#newcode1485" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1485: // content scripts,
or extension pages in non-extension processes.
On 2015/08/05 13:49:46, battre wrote:
&gt; Also extensions can be hosted in the same process. Would these be filtered?

You mean another extension within some webRequest extension?
With site isolation: Yes.
Without site isolation: No, but the frame cannot be embedded anyway unless the
page is in web_accessible_resources.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>not at google - send to devlin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc File extensions/browser/api/web_request/web_request_api.cc (right): https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc#newcode1485 extensions/browser/api/web_request/web_request_api.cc:1485: // content scripts, or extension pages in non-extension processes. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 16:49:59 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            ><a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
File extensions/browser/api/web_request/web_request_api.cc (right):

<a href="https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/web_request/web_request_api.cc#newcode1485" rel="nofollow">https://codereview.chromium.org/1267183003/diff/60001/extensions/browser/api/...</a>
extensions/browser/api/web_request/web_request_api.cc:1485: // content scripts,
or extension pages in non-extension processes.
On 2015/08/05 16:38:09, robwu wrote:
&gt; On 2015/08/05 13:49:46, battre wrote:
&gt; &gt; Also extensions can be hosted in the same process. Would these be filtered?
&gt; 
&gt; You mean another extension within some webRequest extension?
&gt; With site isolation: Yes.
&gt; Without site isolation: No, but the frame cannot be embedded anyway unless the
&gt; page is in web_accessible_resources.

I think the question is can extensions share a render process host ID?

I had always assumed that an RPH is an abstraction of a process, so the process
manager infrastructure can choose to host two RPHs in the same OS process but
that&#39;s an implementation detail.

However come to think of it I&#39;ve never actually asked anybody that question.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 18:53:36 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          Try jobs failed on following builders: mac_chromium_10.10_rel_ng on tryserver.chromium.mac (JOB_TIMED_OUT, http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_10.10_rel_ng/builds/2197)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 18:53:36 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >Try jobs failed on following builders:
  mac_chromium_10.10_rel_ng on tryserver.chromium.mac (JOB_TIMED_OUT,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_10.10_rel_ng/builds/2197" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_10.1...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>robwu</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          The CQ bit was checked by rob@robwu.nl
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 18:55:40 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >The CQ bit was checked by <a href="mailto:rob@robwu.nl">rob@robwu.nl</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1267183003/60001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 18:57:05 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1267183003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1267183003/60001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1267183003/60001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          Committed patchset #4 (id:60001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 19:30:18 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-22"
            >Committed patchset #4 (id:60001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-23">
                          Patchset 4 (id:??) landed as https://crrev.com/86154b409eed6ea7f9177f6bf576e76533ab2f7b Cr-Commit-Position: refs/heads/master@{#341939}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 4 months ago
		(2015-08-05 19:30:52 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-23"
            >Patchset 4 (id:??) landed as
<a href="https://crrev.com/86154b409eed6ea7f9177f6bf576e76533ab2f7b" rel="nofollow">https://crrev.com/86154b409eed6ea7f9177f6bf576e76533ab2f7b</a>
Cr-Commit-Position: refs/heads/master@{#341939}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 24;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1267183003;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1267183003: Hide requests in an extension from other extensions
     (Closed) </b><br/>
      Created 5 years, 4 months ago by robwu<br/>
      Modified 5 years, 4 months ago<br/>
      Reviewers: battre, not at google - send to devlin, Fady Samuel, lazyboy, Devlin<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 28
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
