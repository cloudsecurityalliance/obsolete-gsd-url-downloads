<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1830858 “TOCTOU vulnerability in _get_ignore_dom (report.py...” : Bugs : apport package : Ubuntu</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1830858" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1830858/bug.atom" title="Bug 1830858 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="Dear Ubuntu Security Team,

I would like to report a privilege escalation vulnerability in Apport. The vulnerability is a TOCTOU which enables me to trick Apport into reading any file on the system and including it in a crash report file.

I have attached a proof-of-concept which triggers the vulnerability. I have tested it on an up-to-date Ubuntu 18.04. Run it as follows:

bunzip2 PoC.tar.bz2
tar -xf PoC.tar
cd PoC
make
./gencrashreport /etc/shadow

At this point the following file has been ..." />
      <meta property="og:description" content="Dear Ubuntu Security Team,

I would like to report a privilege escalation vulnerability in Apport. The vulnerability is a TOCTOU which enables me to trick Apport into reading any file on the system and including it in a crash report file.

I have attached a proof-of-concept which triggers the vulnerability. I have tested it on an up-to-date Ubuntu 18.04. Run it as follows:

bunzip2 PoC.tar.bz2
tar -xf PoC.tar
cd PoC
make
./gencrashreport /etc/shadow

At this point the following file has been ..." />
    

    
    
      <meta property="og:title" content="Bug #1830858 “TOCTOU vulnerability in _get_ignore_dom (report.py...” : Bugs : apport package : Ubuntu" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1830858" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["a11y", "appstream", "bionic", "bisect-done", "bitesize", "cherry-pick", "community-security", "desktop-file", "disco", "dist-upgrade", "focal", "ftbfs", "groovy", "hirsute", "hw-specific", "impish", "jammy", "kernel-bug", "manpage", "metabug", "multiarch", "needs-bisect", "needs-design", "needs-packaging", "needs-reassignment", "package-conflict", "packaging", "patch", "patch-accepted-debian", "patch-accepted-upstream", "patch-forwarded-debian", "patch-forwarded-upstream", "patch-needswork", "patch-rejected", "patch-rejected-debian", "patch-rejected-upstream", "performing-bisect", "py2-removal", "qt4-removal", "regression-proposed", "regression-release", "regression-update", "string-fix", "suspend-resume", "systemd-boot", "testcase", "touch", "unmetdeps", "upgrade-software-version", "verification-done-bionic", "verification-done-focal", "verification-done-groovy", "verification-done-hirsute", "verification-done-impish", "verification-done-xenial", "verification-failed-bionic", "verification-failed-groovy", "verification-failed-impish", "verification-failed-xenial", "verification-needed-bionic", "verification-needed-focal", "verification-needed-groovy", "verification-needed-hirsute", "verification-needed-impish", "verification-needed-trusty", "verification-needed-xenial", "wayland", "xenial"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/ubuntu"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/49558155/64_logo.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/ubuntu">Ubuntu</a><br /><a href="https://launchpad.net/ubuntu/+source/apport">apport package</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/ubuntu/+source/apport">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/ubuntu/+source/apport">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/ubuntu/+source/apport">Bugs</a></li>
      
      
    
    
      
      
      <li class="specifications disabled-tab"><span>Blueprints</span></li>
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/ubuntu/+source/apport">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/ubuntu/+source/apport">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    TOCTOU vulnerability in _get_ignore_dom (report.py)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1830858 reported by
      <a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev</a>
      <time title="2019-05-29 08:13:32 UTC" datetime="2019-05-29T08:13:32.850078+00:00">on 2019-05-29</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">258</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr id="tasksummary2511074">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/apport/+bug/1830858/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2511074">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/apport">Apport</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/apport/+bug/1830858/+editstatus" style="float: left" class="value statusFIXCOMMITTED">Fix Committed</a>
          <a href="https://bugs.launchpad.net/apport/+bug/1830858/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2511074">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2511074">
     <td colspan="7"><form action="/apport/+bug/1830858/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/apport">Apport</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2019-07-02 11:57:01 UTC" datetime="2019-07-02T11:57:01.948694+00:00">2019-07-02</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2019-07-22 11:35:01 UTC" datetime="2019-07-22T11:35:01.066173+00:00">2019-07-22</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2019-07-22 11:35:01 UTC" datetime="2019-07-22T11:35:01.066173+00:00">2019-07-22</time>
      </td>
    </tr>
    
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="apport.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="apport.target.option.package" name="apport.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="apport.target.distribution" name="apport.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="apport.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="apport.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="apport.target.package"
                         name="apport.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;apport.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('apport.target.package');
              var select_menu = Y.DOM.byId('apport.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-apport-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a package", "show_remove_button": false, "selected_value": null, "step_title": "Search by name", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "DistributionPackage", "input_element": "apport.target.package", "show_widget_id": "show-widget-apport-target-package", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-apport-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="apport.target.option.product" name="apport.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="apport" id="apport.target.product"
                         name="apport.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;apport.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('apport.target.product');
              var select_menu = Y.DOM.byId('apport.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-apport-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a project", "show_remove_button": false, "selected_value": "apport", "step_title": "Search", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "Product", "input_element": "apport.target.product", "show_widget_id": "show-widget-apport-target-product", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-apport-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="apport.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="apport.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="apport.status" name="apport.status" size="1" >
<option selected="selected" value="Fix Committed">Fix Committed</option>
</select>
</div>
<input name="apport.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="apport.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="apport.assignee.assign_to_nobody" name="apport.assignee.option" value="apport.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="apport.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="apport.assignee.assign_to_me" name="apport.assignee.option" value="apport.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="apport.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="apport.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="apport.comment_on_change" name="apport.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr class="highlight" id="tasksummary2501245">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2501245">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/ubuntu/+source/apport" title="Latest release: 2.20.11-0ubuntu72, uploaded to main on 2021-10-27 12:57:09.314067+00:00 by Brian Murray (brian-murray), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)">apport (Ubuntu)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2501245">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2501245">
     <td colspan="7"><form action="/ubuntu/+source/apport/+bug/1830858/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/+source/apport">apport (Ubuntu)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2019-05-29 08:13:32 UTC" datetime="2019-05-29T08:13:32.850078+00:00">2019-05-29</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2019-07-09 00:03:02 UTC" datetime="2019-07-09T00:03:02.064651+00:00">2019-07-09</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2019-07-09 00:03:02 UTC" datetime="2019-07-09T00:03:02.064651+00:00">2019-07-09</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2019-07-09 00:03:02 UTC" datetime="2019-07-09T00:03:02.064651+00:00">2019-07-09</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu_apport.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu_apport.target.option.package" name="ubuntu_apport.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu_apport.target.distribution" name="ubuntu_apport.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu_apport.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu_apport.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="apport" id="ubuntu_apport.target.package"
                         name="ubuntu_apport.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_apport.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_apport.target.package');
              var select_menu = Y.DOM.byId('ubuntu_apport.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_apport-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a package", "show_remove_button": false, "selected_value": "apport", "step_title": "Search by name", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "DistributionPackage", "input_element": "ubuntu_apport.target.package", "show_widget_id": "show-widget-ubuntu_apport-target-package", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ubuntu_apport-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu_apport.target.option.product" name="ubuntu_apport.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu_apport.target.product"
                         name="ubuntu_apport.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_apport.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_apport.target.product');
              var select_menu = Y.DOM.byId('ubuntu_apport.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_apport-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a project", "show_remove_button": false, "selected_value": null, "step_title": "Search", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "Product", "input_element": "ubuntu_apport.target.product", "show_widget_id": "show-widget-ubuntu_apport-target-product", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ubuntu_apport-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_apport.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_apport.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_apport.status" name="ubuntu_apport.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ubuntu_apport.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_apport.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ubuntu_apport.assignee.assign_to_nobody" name="ubuntu_apport.assignee.option" value="ubuntu_apport.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_apport.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_apport.assignee.assign_to_me" name="ubuntu_apport.assignee.option" value="ubuntu_apport.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_apport.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_apport.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_apport.comment_on_change" name="ubuntu_apport.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>Dear Ubuntu Security Team,</p>
<p>I would like to report a privilege escalation vulnerability in Apport. The vulnerability is a TOCTOU which enables me to trick Apport into reading any file on the system and including it in a crash report file.</p>
<p>I have attached a proof-of-concept which triggers the vulnerability. I have tested it on an up-to-date Ubuntu 18.04. Run it as follows:</p>
<p>bunzip2 PoC.tar.bz2<br />
tar -xf PoC.tar<br />
cd PoC<br />
make<br />
./gencrashreport /etc/shadow</p>
<p>At this point the following file has been created:</p>
<p>/var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash</p>
<p>You can use the apport-unpack tool to decompress this file. If you look at the contents of the CoreDump file then you will see that it contains the contents of /etc/shadow (or whichever other file you passed on the command line of gencrashreport).</p>
<p>The bug has a couple of mitigations:</p>
<p>1. My PoC does not work if a file named /var/crash/.lock already exists and is owned by root. This file will only exist if Apport has previously generated a crash report. Based on an informal survey of my own 4 computers (yes - maybe I don&#x27;t need that many), it usually does not exist (unless the computer is used for security research).</p>
<p>2. The generated crash report file, /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash, is only readable by root and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if you create a file named /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.upload, but that is not a huge security concern because it wouldn&#x27;t be of much benefit to an attacker. However, I have found some integer overflow vulnerabilities in whoopsie (which I will report separately). If those overflows can be exploited to gain code execution in whoopsie, then this will enable an attacker to read the contents of the crash report file.</p>
<p>To improve the effectiveness of the first mitigation, I would recommend that you make sure that /var/crash/.lock is created (and owned by root) by the Ubuntu installer and/or whoopsie when it starts up. It does not fix the root cause though, which I will describe next.</p>
<p>This is the source location of the TOCTOU vulnerability:</p>
<p><a rel="nofollow" href="https://git.launchpad.net/ubuntu/+source/apport/tree/apport/report.py?h=applied/ubuntu/bionic-devel&amp;id=2fc8fb446c78e950d643bf49bb7d4a0dc3b05429#n962">https:/<wbr />/git.launchpad.<wbr />net/ubuntu/<wbr />+source/<wbr />apport/<wbr />tree/apport/<wbr />report.<wbr />py?h=applied/<wbr />ubuntu/<wbr />bionic-<wbr />devel&amp;id=<wbr />2fc8fb446c78e95<wbr />0d643bf49bb7d4a<wbr />0dc3b05429#<wbr />n962</a></p>
<p>Apport allows the user to place a file in their home directory named `~/.apport-<wbr />ignore.<wbr />xml`. The call to os.access() on line 962 is intended to check that this file belongs to the correct user. But on line 967, the file is read again using xml.dom.<wbr />minidom.<wbr />parse. This creates a window of opportunity for an attacker to replace the file with a symlink. The symlink does not need to point to a valid XML file, because there is a try-except around the call to the parser, so if the file is invalid then Apport just ignores it and continues. However, the contents of the file still ends up in Apport&#x27;s heap.</p>
<p>Here&#x27;s a summary of how the PoC works:</p>
<p>1. Start a /bin/sleep and kill it with a SIGSEGV.<br />
2. Apport starts up to generate a crash report for /bin/sleep<br />
3. Replace ~/.apport-<wbr />ignore.<wbr />xml with a symlink at exactly the right moment, so that Apport loads a forbidden file into memory.<br />
4. Wait until Apport drops privileges so that we can kill it with a SIGTRAP.<br />
5. A second Apport starts up to generate a crash report for the first Apport.<br />
6. The second Apport writes out a crash report for the first, containing a copy of the forbidden file in the core dump.</p>
<p>Apport tries quite hard to not run recursively on itself, so I had to jump through a few hoops to make the PoC work:</p>
<p>1. Apport sets a lock on /var/crash/.lock, using lockf. But locks created by lockf are only &quot;advisory&quot;. If I own the file, then I can replace it with a different file, thereby deactivating the lock. This is why my PoC only works if /var/crash/.lock doesn&#x27;t already exist. I need to create it before Apport does, so that I can maintain ownership of it.</p>
<p>2. Apport has signal handlers for most of the core-generating signals, like SIGSEGV. But it doesn&#x27;t have a handler for SIGTRAP, so that&#x27;s what my PoC uses.</p>
<p>3. Apport is started with an RLIMIT_CORE value of 1, which is another recursion detection mechanism (see <a rel="nofollow" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/498525/comments/3">https:/<wbr />/bugs.launchpad<wbr />.net/ubuntu/<wbr />+source/<wbr />linux/+<wbr />bug/498525/<wbr />comments/<wbr />3</a>). But it is possible for another process to change it to zero, using prlimit.</p>
<p>As I mentioned earlier, I have also found a few other vulnerabilities in whoopsie and Apport. I will file them as separate bugs and include a link to this issue.</p>
<p>Please let me know when you have fixed the vulnerability, so that I can coordinate my disclosure with yours. For reference, here is a link to Semmle&#x27;s vulnerability disclosure policy: <a rel="nofollow" href="https://lgtm.com/security#disclosure_policy">https:/<wbr />/lgtm.com/<wbr />security#<wbr />disclosure_<wbr />policy</a></p>
<p>Thank you,</p>
<p>Kevin Backhouse</p>
<p>Semmle Security Research Team</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          <a href="+edit" title="Add tags" id="tags-trigger" class="sprite add">Add tags</a>
          
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          

            <div id="bug-branches">
              <h2>Related branches</h2>

              
                

 

 <div class="buglink-summary">

  <a href="https://code.launchpad.net/~alexmurray/apport/apport" class="sprite branch">lp:~alexmurray/apport/apport</a>
  
  
  <div class="reviews">
    

  <div>
    

  <img src="/@@/merge-proposal-icon" />
  <a href="https://code.launchpad.net/~alexmurray/apport/apport/+merge/369843" title="">Merged</a>
  
  into
  
    <a href="https://code.launchpad.net/~apport-hackers/apport/trunk">lp:apport</a>
  
  
    
      at
      <a href="https://bazaar.launchpad.net/~apport-hackers/apport/trunk/revision/3254">
        revision 3254
      </a>
    
  


  </div>
  

  

<dl class="reviews">
  
  <dd id="review-apport-hackers">
    <a href="https://launchpad.net/~apport-hackers" class="sprite team">Apport upstream developers</a>:

    <span class="votePENDING">Pending</span>
    
    requested
    <time title="2019-07-09 02:13:38 UTC" datetime="2019-07-09T02:13:38.199276+00:00">2019-07-09</time>
  </dd>
  <dd class="popup-diff mp-369843">
    Diff: <a href="https://code.launchpad.net/~alexmurray/apport/apport/+merge/369843/+preview-diff/877427/+files/preview.diff" class="diff-link">32 lines (+13/-3)</a><div class="collapsible"><span>1 file modified</span><div>apport/report.py (+13/-3)</div></div>
    <a class="api-ref hidden" href="/~alexmurray/apport/apport/+merge/369843/+preview-diff/877427">api</a>
  </dd>

</dl>





  </div>
</div>



              
              
                

 

 <div class="buglink-summary">

  <a href="https://code.launchpad.net/~ubuntu-core-dev/ubuntu/eoan/apport/ubuntu" class="sprite branch">lp:~ubuntu-core-dev/ubuntu/eoan/apport/ubuntu</a>
  
  
</div>



              
              
                

 

 <div class="buglink-summary">

  <a href="https://code.launchpad.net/~apport-hackers/apport/trunk" class="sprite branch">lp:apport</a>
  
  
</div>



              
            </div>
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2019-7307" title="Apport before versions 2.14.1-0ubuntu...">2019-7307</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdeslaur" class="sprite person">Marc Deslauriers (mdeslaur)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-05-29T11:54:19.056899+00:00" title="2019-05-29 11:54:19 UTC">on 2019-05-29</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks for reporting this issue, and for the great description and reproducer. We will investigate it shortly and will assign a CVE number. Thanks!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks for reporting this issue, and for the great description and reproducer. We will investigate it shortly and will assign a CVE number. Thanks!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-05-31T05:49:33.425729+00:00" title="2019-05-31 05:49:33 UTC">on 2019-05-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have assigned CVE-2019-7307 for this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have assigned CVE-2019-7307 for this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-05-31T05:52:38.945809+00:00" title="2019-05-31 05:52:38 UTC">on 2019-05-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Kevin, how should we attribute this? &#x27;Kevin Backhouse&#x27; / &#x27;Kevin Backhouse from Semmle Security Research Team&#x27; / &#x27;Semmle Security Research Team&#x27; or something else?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Kevin, how should we attribute this? 'Kevin Backhouse' / 'Kevin Backhouse from Semmle Security Research Team' / 'Semmle Security Research Team' or something else?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev (kbackhouse2000)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-05-31T07:33:01+00:00" title="2019-05-31 07:33:01 UTC">on 2019-05-31</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/apport/+bug/1830858/comments/5">
                <strong>Re: [Bug 1830858] Re: TOCTOU vulnerability in _get_ignore_dom (report.py)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/comments/5/+download">Download full text</a> (5.7 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Wow, that was quick! &quot;Kevin Backhouse of Semmle Security Research Team&quot;,<br />
please.</p>
<p>Thanks,</p>
<p>Kev</p>
<p>On Fri, May 31, 2019, 07:00 Alex Murray &lt;email address hidden&gt; wrote:</p>
<p><span class="foldable-quoted">&gt; Kevin, how should we attribute this? &#x27;Kevin Backhouse&#x27; / &#x27;Kevin<br />
&gt; Backhouse from Semmle Security Research Team&#x27; / &#x27;Semmle Security<br />
&gt; Research Team&#x27; or something else?<br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1830858">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1830858</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   TOCTOU vulnerability in _get_ignore_dom (report.py)<br />
&gt;<br />
&gt; Status in apport package in Ubuntu:<br />
&gt;   New<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   Dear Ubuntu Security Team,<br />
&gt;<br />
&gt;   I would like to report a privilege escalation vulnerability in Apport.<br />
&gt;   The vulnerability is a TOCTOU which enables me to trick Apport into<br />
&gt;   reading any file on the system and including it in a crash report<br />
&gt;   file.<br />
&gt;<br />
&gt;   I have attached a proof-of-concept which triggers the vulnerability. I<br />
&gt;   have tested it on an up-to-date Ubuntu 18.04. Run it as follows:<br />
&gt;<br />
&gt;   bunzip2 PoC.tar.bz2<br />
&gt;   tar -xf PoC.tar<br />
&gt;   cd PoC<br />
&gt;   make<br />
&gt;   ./gencrashreport /etc/shadow<br />
&gt;<br />
&gt;   At this point the following file has been created:<br />
&gt;<br />
&gt;   /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash<br />
&gt;<br />
&gt;   You can use the apport-unpack tool to decompress this file. If you<br />
&gt;   look at the contents of the CoreDump file then you will see that it<br />
&gt;   contains the contents of /etc/shadow (or whichever other file you<br />
&gt;   passed on the command line of gencrashreport).<br />
&gt;<br />
&gt;   The bug has a couple of mitigations:<br />
&gt;<br />
&gt;   1. My PoC does not work if a file named /var/crash/.lock already<br />
&gt;   exists and is owned by root. This file will only exist if Apport has<br />
&gt;   previously generated a crash report. Based on an informal survey of my<br />
&gt;   own 4 computers (yes - maybe I don&#x27;t need that many), it usually does<br />
&gt;   not exist (unless the computer is used for security research).<br />
&gt;<br />
&gt;   2. The generated crash report file,<br />
&gt;   /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash, is only readable by root<br />
&gt;   and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if<br />
&gt;   you create a file named /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.upload,<br />
&gt;   but that is not a huge security concern because it wouldn&#x27;t be of much<br />
&gt;   benefit to an attacker. However, I have found some integer overflow<br />
&gt;   vulnerabilities in whoopsie (which I will report separately). If those<br />
&gt;   overflows can be exploited to gain code execution in whoopsie, then<br />
&gt;   this will enable an attacker to read the contents of the crash report<br />
&gt;   file.<br />
&gt;<br />
&gt;   To improve the effectiveness of the first mitigation, I would<br />
&gt;   recommend that you make sure that /var/crash/.lock is created (and<br />
&gt;   owned by root) by the Ubuntu installer and/or whoopsie when it starts<br />
&gt;   up. It does not fix the root cause though, which I will describe next.<br />
&gt;<br />
&gt;   This is the source location of the TOCTOU vulnerability:<br />
&gt;<br />
&gt;<br />
&gt; <a rel="nofollow" href="https://git.launchpad.net/ubuntu/+source/apport/tree/apport/report.py?h=applied/ubuntu">https:/<wbr />/git.launchpad.<wbr />net/ubuntu/<wbr />+source/<wbr />apport/<wbr />tree/apport/<wbr />report.<wbr />py?h=applied/<wbr />ubuntu</a><br />
&gt;   /bionic-<wbr />devel&amp;id=<wbr />2fc8fb446c78e95<wbr />0d643bf49bb7d4a<wbr />0dc3b05429#<wbr />n962<br />
&gt;<br />
&gt;   Apport allows the user to place a file in their home directory named<br />
&gt;   `~/.apport-<wbr />ignore.<wbr />xml`. The call to os.access() on line 962 is<br />
&gt;   intended t...
</span></p></div>
    
    <p>
      <a href="/ubuntu/+source/apport/+bug/1830858/comments/5">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Wow, that was quick! "Kevin Backhouse of Semmle Security Research Team",
please.

Thanks,

Kev

On Fri, May 31, 2019, 07:00 Alex Murray &lt;alex.murray@canonical.com&gt; wrote:

&gt; Kevin, how should we attribute this? 'Kevin Backhouse' / 'Kevin
&gt; Backhouse from Semmle Security Research Team' / 'Semmle Security
&gt; Research Team' or something else?
&gt;
&gt; --
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; https://bugs.launchpad.net/bugs/1830858
&gt;
&gt; Title:
&gt;   TOCTOU vulnerability in _get_ignore_dom (report.py)
&gt;
&gt; Status in apport package in Ubuntu:
&gt;   New
&gt;
&gt; Bug description:
&gt;   Dear Ubuntu Security Team,
&gt;
&gt;   I would like to report a privilege escalation vulnerability in Apport.
&gt;   The vulnerability is a TOCTOU which enables me to trick Apport into
&gt;   reading any file on the system and including it in a crash report
&gt;   file.
&gt;
&gt;   I have attached a proof-of-concept which triggers the vulnerability. I
&gt;   have tested it on an up-to-date Ubuntu 18.04. Run it as follows:
&gt;
&gt;   bunzip2 PoC.tar.bz2
&gt;   tar -xf PoC.tar
&gt;   cd PoC
&gt;   make
&gt;   ./gencrashreport /etc/shadow
&gt;
&gt;   At this point the following file has been created:
&gt;
&gt;   /var/crash/_usr_share_apport_apport.0.crash
&gt;
&gt;   You can use the apport-unpack tool to decompress this file. If you
&gt;   look at the contents of the CoreDump file then you will see that it
&gt;   contains the contents of /etc/shadow (or whichever other file you
&gt;   passed on the command line of gencrashreport).
&gt;
&gt;   The bug has a couple of mitigations:
&gt;
&gt;   1. My PoC does not work if a file named /var/crash/.lock already
&gt;   exists and is owned by root. This file will only exist if Apport has
&gt;   previously generated a crash report. Based on an informal survey of my
&gt;   own 4 computers (yes - maybe I don't need that many), it usually does
&gt;   not exist (unless the computer is used for security research).
&gt;
&gt;   2. The generated crash report file,
&gt;   /var/crash/_usr_share_apport_apport.0.crash, is only readable by root
&gt;   and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if
&gt;   you create a file named /var/crash/_usr_share_apport_apport.0.upload,
&gt;   but that is not a huge security concern because it wouldn't be of much
&gt;   benefit to an attacker. However, I have found some integer overflow
&gt;   vulnerabilities in whoopsie (which I will report separately). If those
&gt;   overflows can be exploited to gain code execution in whoopsie, then
&gt;   this will enable an attacker to read the contents of the crash report
&gt;   file.
&gt;
&gt;   To improve the effectiveness of the first mitigation, I would
&gt;   recommend that you make sure that /var/crash/.lock is created (and
&gt;   owned by root) by the Ubuntu installer and/or whoopsie when it starts
&gt;   up. It does not fix the root cause though, which I will describe next.
&gt;
&gt;   This is the source location of the TOCTOU vulnerability:
&gt;
&gt;
&gt; https://git.launchpad.net/ubuntu/+source/apport/tree/apport/report.py?h=applied/ubuntu
&gt;   /bionic-devel&amp;id=2fc8fb446c78e950d643bf49bb7d4a0dc3b05429#n962
&gt;
&gt;   Apport allows the user to place a file in their home directory named
&gt;   `~/.apport-ignore.xml`. The call to os.access() on line 962 is
&gt;   intended to check that this file belongs to the correct user. But on
&gt;   line 967, the file is read again using xml.dom.minidom.parse. This
&gt;   creates a window of opportunity for an attacker to replace the file
&gt;   with a symlink. The symlink does not need to point to a valid XML
&gt;   file, because there is a try-except around the call to the parser, so
&gt;   if the file is invalid then Apport just ignores it and continues.
&gt;   However, the contents of the file still ends up in Apport's heap.
&gt;
&gt;   Here's a summary of how the PoC works:
&gt;
&gt;   1. Start a /bin/sleep and kill it with a SIGSEGV.
&gt;   2. Apport starts up to generate a crash report for /bin/sleep
&gt;   3. Replace ~/.apport-ignore.xml with a symlink at exactly the right
&gt; moment, so that Apport loads a forbidden file into memory.
&gt;   4. Wait until Apport drops privileges so that we can kill it with a
&gt; SIGTRAP.
&gt;   5. A second Apport starts up to generate a crash report for the first
&gt; Apport.
&gt;   6. The second Apport writes out a crash report for the first, containing
&gt; a copy of the forbidden file in the core dump.
&gt;
&gt;   Apport tries quite hard to not run recursively on itself, so I had to
&gt;   jump through a few hoops to make the PoC work:
&gt;
&gt;   1. Apport sets a lock on /var/crash/.lock, using lockf. But locks
&gt;   created by lockf are only "advisory". If I own the file, then I can
&gt;   replace it with a different file, thereby deactivating the lock. This
&gt;   is why my PoC only works if /var/crash/.lock doesn't already exist. I
&gt;   need to create it before Apport does, so that I can maintain ownership
&gt;   of it.
&gt;
&gt;   2. Apport has signal handlers for most of the core-generating signals,
&gt;   like SIGSEGV. But it doesn't have a handler for SIGTRAP, so that's
&gt;   what my PoC uses.
&gt;
&gt;   3. Apport is started with an RLIMIT_CORE value of 1, which is another
&gt;   recursion detection mechanism (see
&gt;   https://bugs.launchpad.net/ubuntu/+source/linux/+bug/498525/comments/3).
&gt;   But it is possible for another process to change it to zero, using
&gt;   prlimit.
&gt;
&gt;   As I mentioned earlier, I have also found a few other vulnerabilities
&gt;   in whoopsie and Apport. I will file them as separate bugs and include
&gt;   a link to this issue.
&gt;
&gt;   Please let me know when you have fixed the vulnerability, so that I
&gt;   can coordinate my disclosure with yours. For reference, here is a link
&gt;   to Semmle's vulnerability disclosure policy:
&gt;   https://lgtm.com/security#disclosure_policy
&gt;
&gt;   Thank you,
&gt;
&gt;   Kevin Backhouse
&gt;
&gt;   Semmle Security Research Team
&gt;
&gt; To manage notifications about this bug go to:
&gt;
&gt; https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+subscriptions
&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-06-13T12:30:38.972939+00:00" title="2019-06-13 12:30:38 UTC">on 2019-06-13</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Kevin, do you have a preferred disclosure date / time for this? I notice your policy says 90 days after initial report or 30 days after patch availability - I will be working on a patch for this issue and hope to have something together in the next week or so - and so would prefer a CRD in about 3-4 weeks time. How would 9th July suit you as a tentative date for now?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Kevin, do you have a preferred disclosure date / time for this? I notice your policy says 90 days after initial report or 30 days after patch availability - I will be working on a patch for this issue and hope to have something together in the next week or so - and so would prefer a CRD in about 3-4 weeks time. How would 9th July suit you as a tentative date for now?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev (kbackhouse2000)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-06-14T09:28:25+00:00" title="2019-06-14 09:28:25 UTC">on 2019-06-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/comments/7/+download">Download full text</a> (6.5 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Alex,</p>
<p>Yes, 9 July sounds good to me. No problem if it slips to a different day<br />
though: just let me know and I will delay my announcement too. (The 90 day<br />
deadline is really only there for when we&#x27;re dealing with an irresponsible<br />
vendor who cannot be bothered to fix something.) I hope you don&#x27;t mind that<br />
I am planning to write a blog post about the bug (something similar to<br />
<a rel="nofollow" href="https://lgtm.com/blog/facebook_fizz_CVE-2019-3560">https:/<wbr />/lgtm.com/<wbr />blog/facebook_<wbr />fizz_CVE-<wbr />2019-3560</a>). The blog post won&#x27;t<br />
describe the exact details of the exploit though. I usually wait around 1<br />
month before posting the exploit code on<br />
<a rel="nofollow" href="https://github.com/Semmle/SecurityExploits">https:/<wbr />/github.<wbr />com/Semmle/<wbr />SecurityExploit<wbr />s</a>.</p>
<p>Thanks,</p>
<p>Kev</p>
<p>On Thu, Jun 13, 2019 at 1:41 PM Alex Murray &lt;email address hidden&gt;<br />
wrote:</p>
<p><span class="foldable-quoted">&gt; Kevin, do you have a preferred disclosure date / time for this? I notice<br />
&gt; your policy says 90 days after initial report or 30 days after patch<br />
&gt; availability - I will be working on a patch for this issue and hope to<br />
&gt; have something together in the next week or so - and so would prefer a<br />
&gt; CRD in about 3-4 weeks time. How would 9th July suit you as a tentative<br />
&gt; date for now?<br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1830858">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1830858</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   TOCTOU vulnerability in _get_ignore_dom (report.py)<br />
&gt;<br />
&gt; Status in apport package in Ubuntu:<br />
&gt;   New<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   Dear Ubuntu Security Team,<br />
&gt;<br />
&gt;   I would like to report a privilege escalation vulnerability in Apport.<br />
&gt;   The vulnerability is a TOCTOU which enables me to trick Apport into<br />
&gt;   reading any file on the system and including it in a crash report<br />
&gt;   file.<br />
&gt;<br />
&gt;   I have attached a proof-of-concept which triggers the vulnerability. I<br />
&gt;   have tested it on an up-to-date Ubuntu 18.04. Run it as follows:<br />
&gt;<br />
&gt;   bunzip2 PoC.tar.bz2<br />
&gt;   tar -xf PoC.tar<br />
&gt;   cd PoC<br />
&gt;   make<br />
&gt;   ./gencrashreport /etc/shadow<br />
&gt;<br />
&gt;   At this point the following file has been created:<br />
&gt;<br />
&gt;   /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash<br />
&gt;<br />
&gt;   You can use the apport-unpack tool to decompress this file. If you<br />
&gt;   look at the contents of the CoreDump file then you will see that it<br />
&gt;   contains the contents of /etc/shadow (or whichever other file you<br />
&gt;   passed on the command line of gencrashreport).<br />
&gt;<br />
&gt;   The bug has a couple of mitigations:<br />
&gt;<br />
&gt;   1. My PoC does not work if a file named /var/crash/.lock already<br />
&gt;   exists and is owned by root. This file will only exist if Apport has<br />
&gt;   previously generated a crash report. Based on an informal survey of my<br />
&gt;   own 4 computers (yes - maybe I don&#x27;t need that many), it usually does<br />
&gt;   not exist (unless the computer is used for security research).<br />
&gt;<br />
&gt;   2. The generated crash report file,<br />
&gt;   /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.crash, is only readable by root<br />
&gt;   and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if<br />
&gt;   you create a file named /var/crash/<wbr />_usr_share_<wbr />apport_<wbr />apport.<wbr />0.upload,<br />
&gt;   but that is not a huge security concern because it wouldn&#x27;t be of much<br />
&gt;   benefit to an attacker. However, I have found some integer overflow<br />
&gt;   vulnerabilities in whoopsie (which I will report separately). If those<br />
&gt;   overflows can be exploited to gain code execution in whoopsie, then<br />
&gt;   ...
</span></p></div>
    
    <p>
      <a href="/ubuntu/+source/apport/+bug/1830858/comments/7">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Alex,

Yes, 9 July sounds good to me. No problem if it slips to a different day
though: just let me know and I will delay my announcement too. (The 90 day
deadline is really only there for when we're dealing with an irresponsible
vendor who cannot be bothered to fix something.) I hope you don't mind that
I am planning to write a blog post about the bug (something similar to
https://lgtm.com/blog/facebook_fizz_CVE-2019-3560). The blog post won't
describe the exact details of the exploit though. I usually wait around 1
month before posting the exploit code on
https://github.com/Semmle/SecurityExploits.

Thanks,

Kev

On Thu, Jun 13, 2019 at 1:41 PM Alex Murray &lt;alex.murray@canonical.com&gt;
wrote:

&gt; Kevin, do you have a preferred disclosure date / time for this? I notice
&gt; your policy says 90 days after initial report or 30 days after patch
&gt; availability - I will be working on a patch for this issue and hope to
&gt; have something together in the next week or so - and so would prefer a
&gt; CRD in about 3-4 weeks time. How would 9th July suit you as a tentative
&gt; date for now?
&gt;
&gt; --
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; https://bugs.launchpad.net/bugs/1830858
&gt;
&gt; Title:
&gt;   TOCTOU vulnerability in _get_ignore_dom (report.py)
&gt;
&gt; Status in apport package in Ubuntu:
&gt;   New
&gt;
&gt; Bug description:
&gt;   Dear Ubuntu Security Team,
&gt;
&gt;   I would like to report a privilege escalation vulnerability in Apport.
&gt;   The vulnerability is a TOCTOU which enables me to trick Apport into
&gt;   reading any file on the system and including it in a crash report
&gt;   file.
&gt;
&gt;   I have attached a proof-of-concept which triggers the vulnerability. I
&gt;   have tested it on an up-to-date Ubuntu 18.04. Run it as follows:
&gt;
&gt;   bunzip2 PoC.tar.bz2
&gt;   tar -xf PoC.tar
&gt;   cd PoC
&gt;   make
&gt;   ./gencrashreport /etc/shadow
&gt;
&gt;   At this point the following file has been created:
&gt;
&gt;   /var/crash/_usr_share_apport_apport.0.crash
&gt;
&gt;   You can use the apport-unpack tool to decompress this file. If you
&gt;   look at the contents of the CoreDump file then you will see that it
&gt;   contains the contents of /etc/shadow (or whichever other file you
&gt;   passed on the command line of gencrashreport).
&gt;
&gt;   The bug has a couple of mitigations:
&gt;
&gt;   1. My PoC does not work if a file named /var/crash/.lock already
&gt;   exists and is owned by root. This file will only exist if Apport has
&gt;   previously generated a crash report. Based on an informal survey of my
&gt;   own 4 computers (yes - maybe I don't need that many), it usually does
&gt;   not exist (unless the computer is used for security research).
&gt;
&gt;   2. The generated crash report file,
&gt;   /var/crash/_usr_share_apport_apport.0.crash, is only readable by root
&gt;   and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if
&gt;   you create a file named /var/crash/_usr_share_apport_apport.0.upload,
&gt;   but that is not a huge security concern because it wouldn't be of much
&gt;   benefit to an attacker. However, I have found some integer overflow
&gt;   vulnerabilities in whoopsie (which I will report separately). If those
&gt;   overflows can be exploited to gain code execution in whoopsie, then
&gt;   this will enable an attacker to read the contents of the crash report
&gt;   file.
&gt;
&gt;   To improve the effectiveness of the first mitigation, I would
&gt;   recommend that you make sure that /var/crash/.lock is created (and
&gt;   owned by root) by the Ubuntu installer and/or whoopsie when it starts
&gt;   up. It does not fix the root cause though, which I will describe next.
&gt;
&gt;   This is the source location of the TOCTOU vulnerability:
&gt;
&gt;
&gt; https://git.launchpad.net/ubuntu/+source/apport/tree/apport/report.py?h=applied/ubuntu
&gt;   /bionic-devel&amp;id=2fc8fb446c78e950d643bf49bb7d4a0dc3b05429#n962
&gt;
&gt;   Apport allows the user to place a file in their home directory named
&gt;   `~/.apport-ignore.xml`. The call to os.access() on line 962 is
&gt;   intended to check that this file belongs to the correct user. But on
&gt;   line 967, the file is read again using xml.dom.minidom.parse. This
&gt;   creates a window of opportunity for an attacker to replace the file
&gt;   with a symlink. The symlink does not need to point to a valid XML
&gt;   file, because there is a try-except around the call to the parser, so
&gt;   if the file is invalid then Apport just ignores it and continues.
&gt;   However, the contents of the file still ends up in Apport's heap.
&gt;
&gt;   Here's a summary of how the PoC works:
&gt;
&gt;   1. Start a /bin/sleep and kill it with a SIGSEGV.
&gt;   2. Apport starts up to generate a crash report for /bin/sleep
&gt;   3. Replace ~/.apport-ignore.xml with a symlink at exactly the right
&gt; moment, so that Apport loads a forbidden file into memory.
&gt;   4. Wait until Apport drops privileges so that we can kill it with a
&gt; SIGTRAP.
&gt;   5. A second Apport starts up to generate a crash report for the first
&gt; Apport.
&gt;   6. The second Apport writes out a crash report for the first, containing
&gt; a copy of the forbidden file in the core dump.
&gt;
&gt;   Apport tries quite hard to not run recursively on itself, so I had to
&gt;   jump through a few hoops to make the PoC work:
&gt;
&gt;   1. Apport sets a lock on /var/crash/.lock, using lockf. But locks
&gt;   created by lockf are only "advisory". If I own the file, then I can
&gt;   replace it with a different file, thereby deactivating the lock. This
&gt;   is why my PoC only works if /var/crash/.lock doesn't already exist. I
&gt;   need to create it before Apport does, so that I can maintain ownership
&gt;   of it.
&gt;
&gt;   2. Apport has signal handlers for most of the core-generating signals,
&gt;   like SIGSEGV. But it doesn't have a handler for SIGTRAP, so that's
&gt;   what my PoC uses.
&gt;
&gt;   3. Apport is started with an RLIMIT_CORE value of 1, which is another
&gt;   recursion detection mechanism (see
&gt;   https://bugs.launchpad.net/ubuntu/+source/linux/+bug/498525/comments/3).
&gt;   But it is possible for another process to change it to zero, using
&gt;   prlimit.
&gt;
&gt;   As I mentioned earlier, I have also found a few other vulnerabilities
&gt;   in whoopsie and Apport. I will file them as separate bugs and include
&gt;   a link to this issue.
&gt;
&gt;   Please let me know when you have fixed the vulnerability, so that I
&gt;   can coordinate my disclosure with yours. For reference, here is a link
&gt;   to Semmle's vulnerability disclosure policy:
&gt;   https://lgtm.com/security#disclosure_policy
&gt;
&gt;   Thank you,
&gt;
&gt;   Kevin Backhouse
&gt;
&gt;   Semmle Security Research Team
&gt;
&gt; To manage notifications about this bug go to:
&gt;
&gt; https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+subscriptions
&gt;
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-06-15T11:31:49.984810+00:00" title="2019-06-15 11:31:49 UTC">on 2019-06-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>A blog post is fine (assuming it is after the CRD).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">A blog post is fine (assuming it is after the CRD).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev (kbackhouse2000)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-06-18T14:54:28.125892+00:00" title="2019-06-18 14:54:28 UTC">on 2019-06-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Alex,</p>
<p>Will this bug report become publicly visible on 9 July? It just occurred to me that my PoC is attached to this report, so I am wondering if will become publicly visible at the same time as the bug is disclosed.</p>
<p>Thanks,</p>
<p>Kev</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Alex,

Will this bug report become publicly visible on 9 July? It just occurred to me that my PoC is attached to this report, so I am wondering if will become publicly visible at the same time as the bug is disclosed.

Thanks,

Kev</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-07-02T12:15:29.591525+00:00" title="2019-07-02 12:15:29 UTC">on 2019-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Yes we would normally make the bug report public once the CRD is reached - I am happy to remove the PoC attachment though at that time (or you can do it prior if you prefer?)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Yes we would normally make the bug report public once the CRD is reached - I am happy to remove the PoC attachment though at that time (or you can do it prior if you prefer?)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kbackhouse2000" class="sprite person">kev (kbackhouse2000)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-07-02T13:19:43.829228+00:00" title="2019-07-02 13:19:43 UTC">on 2019-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Alex,</p>
<p>It sounds like your normal process is to leave the PoC attached, so let&#x27;s do that.</p>
<p>Thanks,</p>
<p>Kev</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Alex,

It sounds like your normal process is to leave the PoC attached, so let's do that.

Thanks,

Kev</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-07-09T00:02:56.350451+00:00" title="2019-07-09 00:02:56 UTC">on 2019-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This bug was fixed in the package apport - 2.20.1-0ubuntu2.19</p>
<p>---------------<br />
apport (2.20.1-<wbr />0ubuntu2.<wbr />19) xenial-security; urgency=medium</p>
<p>&nbsp;&nbsp;* SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary<br />
&nbsp;&nbsp;&nbsp;&nbsp;files (LP: <a href="/bugs/1830858" class="bug-link">#1830858</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;- apport/report.py: Avoid TOCTOU issue on users ignore file by<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dropping privileges and then opening the file both test for access and<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open the file in a single operation, instead of using access() before<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reading the file which could be abused by a symlink to cause Apport to<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read and embed an arbitrary file in the resulting crash dump.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- CVE-2019-7307</p>
<p>&nbsp;-- Alex Murray &lt;email address hidden&gt;  Thu, 04 Jul 2019 12:05:21 +0930</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This bug was fixed in the package apport - 2.20.1-0ubuntu2.19

---------------
apport (2.20.1-0ubuntu2.19) xenial-security; urgency=medium

  * SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary
    files (LP: #1830858)
    - apport/report.py: Avoid TOCTOU issue on users ignore file by
      dropping privileges and then opening the file both test for access and
      open the file in a single operation, instead of using access() before
      reading the file which could be abused by a symlink to cause Apport to
      read and embed an arbitrary file in the resulting crash dump.
    - CVE-2019-7307

 -- Alex Murray &lt;alex.murray@canonical.com&gt;  Thu, 04 Jul 2019 12:05:21 +0930</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in apport (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-07-09T00:02:57.824239+00:00" title="2019-07-09 00:02:57 UTC">on 2019-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This bug was fixed in the package apport - 2.20.10-0ubuntu13.4</p>
<p>---------------<br />
apport (2.20.10-<wbr />0ubuntu13.<wbr />4) cosmic-security; urgency=medium</p>
<p>&nbsp;&nbsp;* SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary<br />
&nbsp;&nbsp;&nbsp;&nbsp;files (LP: <a href="/bugs/1830858" class="bug-link">#1830858</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;- apport/report.py: Avoid TOCTOU issue on users ignore file by<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dropping privileges and then opening the file both test for access and<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open the file in a single operation, instead of using access() before<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reading the file which could be abused by a symlink to cause Apport to<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read and embed an arbitrary file in the resulting crash dump.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- CVE-2019-7307</p>
<p>&nbsp;-- Alex Murray &lt;email address hidden&gt;  Thu, 04 Jul 2019 12:05:21 +0930</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This bug was fixed in the package apport - 2.20.10-0ubuntu13.4

---------------
apport (2.20.10-0ubuntu13.4) cosmic-security; urgency=medium

  * SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary
    files (LP: #1830858)
    - apport/report.py: Avoid TOCTOU issue on users ignore file by
      dropping privileges and then opening the file both test for access and
      open the file in a single operation, instead of using access() before
      reading the file which could be abused by a symlink to cause Apport to
      read and embed an arbitrary file in the resulting crash dump.
    - CVE-2019-7307

 -- Alex Murray &lt;alex.murray@canonical.com&gt;  Thu, 04 Jul 2019 12:05:21 +0930</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in apport (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/apport/+bug/1830858/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2019-07-09T00:03:00.468665+00:00" title="2019-07-09 00:03:00 UTC">on 2019-07-09</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/apport/+bug/1830858/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This bug was fixed in the package apport - 2.20.9-0ubuntu7.7</p>
<p>---------------<br />
apport (2.20.9-0ubuntu7.7) bionic-security; urgency=medium</p>
<p>&nbsp;&nbsp;* SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary<br />
&nbsp;&nbsp;&nbsp;&nbsp;files (LP: <a href="/bugs/1830858" class="bug-link">#1830858</a>)<br />
&nbsp;&nbsp;&nbsp;&nbsp;- apport/report.py: Avoid TOCTOU issue on users ignore file by<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dropping privileges and then opening the file both test for access and<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;open the file in a single operation, instead of using access() before<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;reading the file which could be abused by a symlink to cause Apport to<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;read and embed an arbitrary file in the resulting crash dump.<br />
&nbsp;&nbsp;&nbsp;&nbsp;- CVE-2019-7307</p>
<p>&nbsp;-- Alex Murray &lt;email address hidden&gt;  Thu, 04 Jul 2019 12:05:21 +0930</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This bug was fixed in the package apport - 2.20.9-0ubuntu7.7

---------------
apport (2.20.9-0ubuntu7.7) bionic-security; urgency=medium

  * SECURITY UPDATE: TOCTOU issue allows local user to read arbitrary
    files (LP: #1830858)
    - apport/report.py: Avoid TOCTOU issue on users ignore file by
      dropping privileges and then opening the file both test for access and
      open the file in a single operation, instead of using access() before
      reading the file which could be abused by a symlink to cause Apport to
      read and embed an arbitrary file in the resulting crash dump.
    - CVE-2019-7307

 -- Alex Murray &lt;alex.murray@canonical.com&gt;  Thu, 04 Jul 2019 12:05:21 +0930</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in apport (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
    
    <time title="2019-07-09 01:32:54 UTC" datetime="2019-07-09T01:32:54.554051+00:00">on 2019-07-09</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~alexmurray" class="sprite person">Alex Murray (alexmurray)</a>
    
    <time title="2019-07-22 11:35:00 UTC" datetime="2019-07-22T11:35:00.865302+00:00">on 2019-07-22</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in apport: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Committed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/ubuntu/+source/apport/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/ubuntu/+source/apport/+bug/1830858/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/ubuntu/+source/apport/+bug/1830858/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/ubuntu/+source/apport/+bug/1830858/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  
  


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"initial_comment_batch_offset": 41, "first visible_recent_comment": -26, "related_features": {}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1830858", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1830858"}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1830858", "web_link": "https://bugs.launchpad.net/bugs/1830858", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1830858, "private": false, "information_type": "Public Security", "name": null, "title": "TOCTOU vulnerability in _get_ignore_dom (report.py)", "description": "Dear Ubuntu Security Team,\n\nI would like to report a privilege escalation vulnerability in Apport. The vulnerability is a TOCTOU which enables me to trick Apport into reading any file on the system and including it in a crash report file.\n\nI have attached a proof-of-concept which triggers the vulnerability. I have tested it on an up-to-date Ubuntu 18.04. Run it as follows:\n\nbunzip2 PoC.tar.bz2\ntar -xf PoC.tar\ncd PoC\nmake\n./gencrashreport /etc/shadow\n\nAt this point the following file has been created:\n\n/var/crash/_usr_share_apport_apport.0.crash\n\nYou can use the apport-unpack tool to decompress this file. If you look at the contents of the CoreDump file then you will see that it contains the contents of /etc/shadow (or whichever other file you passed on the command line of gencrashreport).\n\nThe bug has a couple of mitigations:\n\n1. My PoC does not work if a file named /var/crash/.lock already exists and is owned by root. This file will only exist if Apport has previously generated a crash report. Based on an informal survey of my own 4 computers (yes - maybe I don't need that many), it usually does not exist (unless the computer is used for security research).\n\n2. The generated crash report file, /var/crash/_usr_share_apport_apport.0.crash, is only readable by root and by the whoopsie user. It will be uploaded to daisy.ubuntu.com if you create a file named /var/crash/_usr_share_apport_apport.0.upload, but that is not a huge security concern because it wouldn't be of much benefit to an attacker. However, I have found some integer overflow vulnerabilities in whoopsie (which I will report separately). If those overflows can be exploited to gain code execution in whoopsie, then this will enable an attacker to read the contents of the crash report file.\n\nTo improve the effectiveness of the first mitigation, I would recommend that you make sure that /var/crash/.lock is created (and owned by root) by the Ubuntu installer and/or whoopsie when it starts up. It does not fix the root cause though, which I will describe next.\n\nThis is the source location of the TOCTOU vulnerability:\n\nhttps://git.launchpad.net/ubuntu/+source/apport/tree/apport/report.py?h=applied/ubuntu/bionic-devel\u0026id=2fc8fb446c78e950d643bf49bb7d4a0dc3b05429#n962\n\nApport allows the user to place a file in their home directory named `~/.apport-ignore.xml`. The call to os.access() on line 962 is intended to check that this file belongs to the correct user. But on line 967, the file is read again using xml.dom.minidom.parse. This creates a window of opportunity for an attacker to replace the file with a symlink. The symlink does not need to point to a valid XML file, because there is a try-except around the call to the parser, so if the file is invalid then Apport just ignores it and continues. However, the contents of the file still ends up in Apport's heap.\n\nHere's a summary of how the PoC works:\n\n1. Start a /bin/sleep and kill it with a SIGSEGV.\n2. Apport starts up to generate a crash report for /bin/sleep\n3. Replace ~/.apport-ignore.xml with a symlink at exactly the right moment, so that Apport loads a forbidden file into memory.\n4. Wait until Apport drops privileges so that we can kill it with a SIGTRAP.\n5. A second Apport starts up to generate a crash report for the first Apport.\n6. The second Apport writes out a crash report for the first, containing a copy of the forbidden file in the core dump.\n\nApport tries quite hard to not run recursively on itself, so I had to jump through a few hoops to make the PoC work:\n\n1. Apport sets a lock on /var/crash/.lock, using lockf. But locks created by lockf are only \"advisory\". If I own the file, then I can replace it with a different file, thereby deactivating the lock. This is why my PoC only works if /var/crash/.lock doesn't already exist. I need to create it before Apport does, so that I can maintain ownership of it.\n\n2. Apport has signal handlers for most of the core-generating signals, like SIGSEGV. But it doesn't have a handler for SIGTRAP, so that's what my PoC uses.\n\n3. Apport is started with an RLIMIT_CORE value of 1, which is another recursion detection mechanism (see https://bugs.launchpad.net/ubuntu/+source/linux/+bug/498525/comments/3). But it is possible for another process to change it to zero, using prlimit.\n\nAs I mentioned earlier, I have also found a few other vulnerabilities in whoopsie and Apport. I will file them as separate bugs and include a link to this issue.\n\nPlease let me know when you have fixed the vulnerability, so that I can coordinate my disclosure with yours. For reference, here is a link to Semmle's vulnerability disclosure policy: https://lgtm.com/security#disclosure_policy\n\nThank you,\n\nKevin Backhouse\n\nSemmle Security Research Team", "owner_link": "https://bugs.launchpad.net/api/devel/~kbackhouse2000", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/bug_tasks", "duplicate_of_link": null, "date_created": "2019-05-29T08:13:32.850078+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/subscriptions", "date_last_updated": "2019-07-22T11:35:01.710973+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 258, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/attachments", "security_related": true, "latest_patch_uploaded": null, "tags": [], "date_last_message": "2019-07-09T00:03:00.468665+00:00", "number_of_duplicates": 0, "message_count": 15, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1830858/linked_merge_proposals", "http_etag": "\"d0120701624013764b841dbede30fbc328ee62b2-617c3ed15ea7fab7edcfa701fe155a56e2c33e0c\""}, "bugtask_data": {"2511074": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/apport/+bug/1830858/+delete", "user_can_edit_status": true, "bugtask_path": "/apport/+bug/1830858", "row_id": "tasksummary2511074", "importance_value": "Undecided", "importance_widget_items": "[]", "id": 2511074, "user_can_delete": false, "targetname": "Apport", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "TOCTOU vulnerability in _get_ignore_dom (report.py)", "assignee_value": null, "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task2511074", "target_is_product": true, "assignee_is_team": null, "status_value": "Fix Committed", "user_can_unassign": false, "milestone_value": null, "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "apport"}, "2501245": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858/+delete", "user_can_edit_status": true, "bugtask_path": "/ubuntu/+source/apport/+bug/1830858", "row_id": "tasksummary2501245", "importance_value": "Undecided", "importance_widget_items": "[]", "id": 2501245, "user_can_delete": false, "targetname": "apport (Ubuntu)", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "TOCTOU vulnerability in _get_ignore_dom (report.py)", "assignee_value": null, "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task2501245", "target_is_product": false, "assignee_is_team": null, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": null, "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "ubuntu_apport"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/apport/+bug/1830858", "web_link": "https://bugs.launchpad.net/ubuntu/+source/apport/+bug/1830858", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1830858", "milestone_link": null, "status": "Fix Released", "importance": "Undecided", "assignee_link": null, "bug_target_display_name": "apport (Ubuntu)", "bug_target_name": "apport (Ubuntu)", "bug_watch_link": null, "date_assigned": null, "date_created": "2019-05-29T08:13:32.850078+00:00", "date_confirmed": "2019-07-09T00:03:02.064651+00:00", "date_incomplete": null, "date_in_progress": "2019-07-09T00:03:02.064651+00:00", "date_closed": "2019-07-09T00:03:02.064651+00:00", "date_left_new": "2019-07-09T00:03:02.064651+00:00", "date_triaged": "2019-07-09T00:03:02.064651+00:00", "date_fix_committed": "2019-07-09T00:03:02.064651+00:00", "date_fix_released": "2019-07-09T00:03:02.064651+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~kbackhouse2000", "target_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/apport", "title": "Bug #1830858 in apport (Ubuntu): \"TOCTOU vulnerability in _get_ignore_dom (report.py)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/apport/+bug/1830858/related_tasks", "is_complete": true, "http_etag": "\"3a9ae7e9554593db3472a1dbe71041f4e7be69b9-2e62f55a10c362b20198347768925ac5db81485c\""}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "is_private": false, "order": 0, "name": "Public", "description": "Everyone can see this information.\n", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "is_private": true, "order": 2, "name": "Private Security", "description": "Only the security group can see this information.\n ", "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "is_private": true, "order": 3, "name": "Private", "description": "Only shared with users permitted to see private user information.\n", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "is_private": false, "order": 1, "name": "Public Security", "description": "Everyone can see this security related information.\n", "description_css_class": "choice-description"}}, "total_comments_and_activity": 29};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 93 queries/external actions issued in 0.99 seconds

    Features: {'bugs.nominations.bug_supervisors_can_target': 'on', 'hard_timeout': '9000', 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'app.maintenance_message': None, 'js.yui_version': None, 'disclosure.dsp_picker.enabled': 'on', 'profiling.enabled': None, 'baselayout.careers_link.disabled': None}

    r0d8de2b

    -->

</html>

