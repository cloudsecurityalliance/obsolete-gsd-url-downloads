 <!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0' />
<link rel="profile" href="https://gmpg.org/xfn/11">
<link rel="pingback" href="https://blog.deteact.com/xmlrpc.php">
<title>Bitrix WAF bypass - Deteact - continuous information security services</title>
<style type="text/css">
        /*=====COLOR OPTION=====*/

        /*Color*/
        /*----------------------------------*/
        /*background color*/ 
                  
          body{
            background-color: #ffffff;
          }
                    section.wrapper-slider .slide-pager .cycle-pager-active,
            section.wrapper-slider .slide-pager .cycle-pager-active:visited,
            section.wrapper-slider .slide-pager .cycle-pager-active:hover,
            section.wrapper-slider .slide-pager .cycle-pager-active:focus,
            section.wrapper-slider .slide-pager .cycle-pager-active:active,
            .title-divider,
            .title-divider:visited,
            .block-overlay-hover,
            .block-overlay-hover:visited,
            #gmaptoggle,
            #gmaptoggle:visited,
            .evision-back-to-top,
            .evision-back-to-top:visited,
            .search-form .search-submit,
            .search-form .search-submit:visited,
            .widget_calendar tbody a,
            .widget_calendar tbody a:visited,
            .wrap-portfolio .button.is-checked,
            .button.button-outline:hover, 
            .button.button-outline:focus, 
            .button.button-outline:active,
            .radius-thumb-holder,
            header.wrapper.top-header .controls,
            .radius-thumb-holder:before,
            .radius-thumb-holder:hover:before, 
            .radius-thumb-holder:focus:before, 
            .radius-thumb-holder:active:before,
            #pbCloseBtn:hover:before,
            .slide-pager .cycle-pager-active, 
            .slick-dots .slick-active button,
            .slide-pager span:hover,
            .featurepost .latestpost-footer .moredetail a,
            .featurepost .latestpost-footer .moredetail a:visited,
            #load-wrap,
            .back-tonav,
            .back-tonav:visited,
            .wrap-service .box-container .box-inner:hover .box-content, 
            .wrap-service .box-container .box-inner:focus .box-content,
            .search-holder .search-bg.search-open form,
            .top-header .timer,
            .nav-buttons,
            .widget .widgettitle:after,
            .widget .widget-title:after,
            .widget input.search-submit,
            .widget .search-form .search-submit,
            .widget .search-form .search-submit:focus,
            .main-navigation.sec-main-navigation ul li.current_page_item:before,
            .comments-area input[type="submit"],
            .slider-controls a i,
            .tabs-menu li.current,           
            .tagcloud a:hover,
            .left.contact,
            section.section-wrapper h2:after,            
            .ribbon span,
            .slick-prev:hover:before, 
            .slick-next:hover:before,
            .nav-holder #sec-menu-toggle,
            section.callback-section,
            a.border-btn{
              background-color: #dd3333;
            }

            .widget-title,
            .widgettitle,
            .wrapper-slider,
            .flip-container .front,
            .flip-container .back,            
            a.border-btn,
            .ribbon span::before,
            a.border-btn {
              border-color: #dd3333; 
            }

            section#banner-section {
              border-bottom-color: #dd3333 !important; 
            }

            @media screen and (min-width: 768px){
            .main-navigation .current_page_item > a:after,
            .main-navigation .current-menu-item > a:after,
            .main-navigation .current_page_ancestor > a:after,
            .main-navigation li.active > a:after,
            .main-navigation li.active > a:after,
            .main-navigation li.active > a:after,
            .main-navigation li.current_page_parent a:after {
                background-color: #dd3333;
              }
            }

            .latestpost-footer .moredetail a,
            .latestpost-footer .moredetail a:visited,
            h1 a:hover, h2 a:hover, h3 a:hover, h4 a:hover, h5 a:hover, h6 a:hover,
            .posted-on a:hover, .date a:hover, .cat-links a:hover, .tags-links a:hover, .author a:hover, .comments-link a:hover,
            .edit-link a:hover,
            .edit-link a:focus,            
            .widget li a:hover, .widget li a:focus, .widget li a:active, .widget li a:visited:hover, .widget li a:visited:focus, .widget li a:visited:active,
            .main-navigation a:hover, .main-navigation a:focus, .main-navigation a:active, .main-navigation a:visited:hover, .main-navigation a:visited:focus, .main-navigation a:visited:active,
            .site-branding h1 a:hover,
            .site-branding p a:hover,
            .trade-hub-top-menu ul li a:hover,
            .top-header .noticebar .ticker .slide-item a:hover,
            h2.user-title a span,
            .page-inner-title .entry-header a:hover, .page-inner-title .entry-header a:focus, .page-inner-title .entry-header a:active, .page-inner-title .entry-header a:visited:hover, .page-inner-title .entry-header a:visited:focus, .page-inner-title .entry-header a:visited:active, .page-inner-title .entry-header time:hover, .page-inner-title .entry-header time:focus, .page-inner-title .entry-header time:active, .page-inner-title .entry-header time:visited:hover, .page-inner-title .entry-header time:visited:focus, .page-inner-title .entry-header time:visited:active,
            .wrap-breadcrumb a:hover, .wrap-breadcrumb a:focus, .wrap-breadcrumb a:active,
            body.blog .content-start article:hover h2 a,
            .popular:hover i,
            .comment:hover i,
            .recent:hover i,
            a.blog-meta:hover,
            a.blog-meta:focus,
            a.know-more:hover,
            a.know-more:focus,
            a.border-btn:hover,
            a.border-btn:focus,
            a.border-btn:active,
            .feature-content:hover i{
              color: #dd3333 !important;
            }
                    /*Site identity / logo & tagline*/
            .site-header .wrapper-site-identity .site-branding .site-title a,
            .site-header .wrapper-site-identity .site-title a:visited,
            .site-header .wrapper-site-identity .site-branding .site-description,
            .page-inner-title .entry-header time {
              color: #313131;
            }
         
        /*Primary*/
          html, body, p, button, input, select, textarea, pre, code, kbd, tt, var, samp , .main-navigation a, search-input-holder .search-field,
          .widget{
          font-family: 'Roboto'; /*Lato*/
          }
         
          /*Site identity / logo & tagline*/
          .site-header .wrapper-site-identity .site-title a, .site-header .wrapper-site-identity .site-description {
          font-family: 'Roboto'; /*Lato*/
          }
         
          /*Title*/
          h1, h1 a,
          h2, h2 a,
          h3, h3 a,
          h4, h4 a,
          h5, h5 a,
          h6, h6 a,
          .widget-title h2,
          .widget-title,
          .news-content a{
            font-family: 'Roboto'; /*Lato*/
          }
                </style>
<meta name='robots' content='max-image-preview:large' />

<link rel="canonical" href="https://blog.deteact.com/bitrix-waf-bypass/" />
<meta property="og:locale" content="en_US" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Bitrix WAF bypass - Deteact - continuous information security services" />
<meta property="og:description" content="In Russian: https://blog.deteact.com/ru/bitrix-waf-bypass/ UPD: CVE-2020-13758 assigned Sometimes when exploiting reflected XSS the input parameters get injected directly into the body of the &lt;script&gt; tag. Typically, this means that the exploit is trivial: HTML entity encoding continue reading" />
<meta property="og:url" content="https://blog.deteact.com/bitrix-waf-bypass/" />
<meta property="og:site_name" content="Deteact - continuous information security services" />
<meta property="article:section" content="Research" />
<meta property="article:published_time" content="2020-04-27T09:52:07+00:00" />
<meta property="article:modified_time" content="2020-06-04T11:37:44+00:00" />
<meta property="og:updated_time" content="2020-06-04T11:37:44+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:description" content="In Russian: https://blog.deteact.com/ru/bitrix-waf-bypass/ UPD: CVE-2020-13758 assigned Sometimes when exploiting reflected XSS the input parameters get injected directly into the body of the &lt;script&gt; tag. Typically, this means that the exploit is trivial: HTML entity encoding continue reading" />
<meta name="twitter:title" content="Bitrix WAF bypass - Deteact - continuous information security services" />
<meta name="twitter:image" content="https://lh3.googleusercontent.com/D1OTjA6dfjqWmX-xivhugAN6nbG0rd5NefYQVnLEi2pTeQZCfakUG1M5y_COyt3nOmnJNuUmTsCzF1TZEPxL54JHz-Z-tWV-WmPYRVuVN0WsAZGUTeW6YMOZY3Uku_FLZwHvV4Jo" />
<script type='application/ld+json' class='yoast-schema-graph yoast-schema-graph--main'>{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://blog.deteact.com/#website","url":"https://blog.deteact.com/","name":"Deteact - continuous information security services","potentialAction":{"@type":"SearchAction","target":"https://blog.deteact.com/?s={search_term_string}","query-input":"required name=search_term_string"}},{"@type":"ImageObject","@id":"https://blog.deteact.com/bitrix-waf-bypass/#primaryimage","url":"https://lh3.googleusercontent.com/D1OTjA6dfjqWmX-xivhugAN6nbG0rd5NefYQVnLEi2pTeQZCfakUG1M5y_COyt3nOmnJNuUmTsCzF1TZEPxL54JHz-Z-tWV-WmPYRVuVN0WsAZGUTeW6YMOZY3Uku_FLZwHvV4Jo"},{"@type":"WebPage","@id":"https://blog.deteact.com/bitrix-waf-bypass/#webpage","url":"https://blog.deteact.com/bitrix-waf-bypass/","inLanguage":"en-US","name":"Bitrix WAF bypass - Deteact - continuous information security services","isPartOf":{"@id":"https://blog.deteact.com/#website"},"primaryImageOfPage":{"@id":"https://blog.deteact.com/bitrix-waf-bypass/#primaryimage"},"datePublished":"2020-04-27T09:52:07+00:00","dateModified":"2020-06-04T11:37:44+00:00","author":{"@id":"https://blog.deteact.com/#/schema/person/2cf7aed34c3eb7e8c2bd82142cde80ad"}},{"@type":["Person"],"@id":"https://blog.deteact.com/#/schema/person/2cf7aed34c3eb7e8c2bd82142cde80ad","name":"Roma Ramazanoff","image":{"@type":"ImageObject","@id":"https://blog.deteact.com/#authorlogo","url":"https://secure.gravatar.com/avatar/6204a5bf0c53e057638972b27cc88087?s=96&d=mm&r=g","caption":"Roma Ramazanoff"},"sameAs":[]}]}</script>

<link rel='dns-prefetch' href='//fonts.googleapis.com' />
<link rel='dns-prefetch' href='//s.w.org' />
<link rel="alternate" type="application/rss+xml" title="Deteact - continuous information security services &raquo; Feed" href="https://blog.deteact.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Deteact - continuous information security services &raquo; Comments Feed" href="https://blog.deteact.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Deteact - continuous information security services &raquo; Bitrix WAF bypass Comments Feed" href="https://blog.deteact.com/bitrix-waf-bypass/feed/" />
<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.deteact.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.1"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='crayon-css' href='https://blog.deteact.com/wp-content/plugins/crayon-syntax-highlighter/css/min/crayon.min.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-theme-eclipse-css' href='https://blog.deteact.com/wp-content/plugins/crayon-syntax-highlighter/themes/eclipse/eclipse.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='crayon-font-ubuntu-mono-css' href='https://blog.deteact.com/wp-content/plugins/crayon-syntax-highlighter/fonts/ubuntu-mono.css?ver=_2.7.2_beta' type='text/css' media='all' />
<link rel='stylesheet' id='wp-block-library-css' href='https://blog.deteact.com/wp-includes/css/dist/block-library/style.min.css?ver=5.8.1' type='text/css' media='all' />
<link rel='stylesheet' id='slick-css-css' href='https://blog.deteact.com/wp-content/themes/trade-hub/assets/frameworks/slick/slick.css?ver=3.4.0' type='text/css' media='all' />
<link rel='stylesheet' id='trade-hub-style-css' href='https://blog.deteact.com/wp-content/themes/trade-hub/style.css?ver=5.8.1' type='text/css' media='all' />
<link rel='stylesheet' id='trade-hub-google-fonts-css' href='//fonts.googleapis.com/css?family=Roboto%7CRoboto%7CRoboto&#038;ver=5.8.1' type='text/css' media='all' />
<script type='text/javascript' src='https://blog.deteact.com/wp-includes/js/jquery/jquery.min.js?ver=3.6.0' id='jquery-core-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.3.2' id='jquery-migrate-js'></script>
<script type='text/javascript' id='crayon_js-js-extra'>
/* <![CDATA[ */
var CrayonSyntaxSettings = {"version":"_2.7.2_beta","is_admin":"0","ajaxurl":"https:\/\/blog.deteact.com\/wp-admin\/admin-ajax.php","prefix":"crayon-","setting":"crayon-setting","selected":"crayon-setting-selected","changed":"crayon-setting-changed","special":"crayon-setting-special","orig_value":"data-orig-value","debug":""};
var CrayonSyntaxStrings = {"copy":"Press %s to Copy, %s to Paste","minimize":"Click To Expand Code"};
/* ]]> */
</script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/plugins/crayon-syntax-highlighter/js/min/crayon.min.js?ver=_2.7.2_beta' id='crayon_js-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/js/jquery.sticky.js?ver=1' id='jquery-sticky-js'></script>
<link rel="https://api.w.org/" href="https://blog.deteact.com/wp-json/" /><link rel="alternate" type="application/json" href="https://blog.deteact.com/wp-json/wp/v2/posts/213" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.deteact.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.deteact.com/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 5.8.1" />
<link rel='shortlink' href='https://blog.deteact.com/?p=213' />
<link rel="alternate" type="application/json+oembed" href="https://blog.deteact.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.deteact.com%2Fbitrix-waf-bypass%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://blog.deteact.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.deteact.com%2Fbitrix-waf-bypass%2F&#038;format=xml" />
<style type="text/css">
					.site-title,
			.site-description {
				position: absolute;
				clip: rect(1px, 1px, 1px, 1px);
			}
				</style>
<link rel="icon" href="https://blog.deteact.com/wp-content/uploads/2019/07/DA_Icon-150x150.png" sizes="32x32" />
<link rel="icon" href="https://blog.deteact.com/wp-content/uploads/2019/07/DA_Icon-300x300.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://blog.deteact.com/wp-content/uploads/2019/07/DA_Icon-300x300.png" />
<meta name="msapplication-TileImage" content="https://blog.deteact.com/wp-content/uploads/2019/07/DA_Icon-300x300.png" />
<style type="text/css" id="wp-custom-css">
			code {
  font-family: Consolas,"courier new";
  color: crimson;
  background-color: #f1f1f1;
  padding: 2px;
  font-size: 105%;
}		</style>
</head>
<body class="post-template-default single single-post postid-213 single-format-standard wp-custom-logo evision-right-sidebar alternate group-blog">
<div id="page" class="site clearfix">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<div id="preloader">
<div id="status">&nbsp;</div>
</div>
<header id="masthead" class="wrapper wrap-head site-header">
<div class="container top-header-wrap">
<div class="col-md-4 wrapper wrapper-site-identity">
<div class="site-branding">
<a href="https://blog.deteact.com/" class="custom-logo-link" rel="home"><img width="622" height="124" src="https://blog.deteact.com/wp-content/uploads/2018/09/cropped-logo_new_black.png" class="custom-logo" alt="Deteact &#8211; continuous information security services" srcset="https://blog.deteact.com/wp-content/uploads/2018/09/cropped-logo_new_black.png 622w, https://blog.deteact.com/wp-content/uploads/2018/09/cropped-logo_new_black-300x60.png 300w" sizes="(max-width: 622px) 100vw, 622px" /></a> <p class="site-title"><a href="https://blog.deteact.com/" rel="home">Deteact &#8211; continuous information security services</a></p>
<p class="site-description">Application Security, Penetration Testing, Security Consulting, Vulnerability Management, DDoS Testing, Threat Hunting, Awareness Training, Bug Bounty, Blockchain Security, Security Research</p>
</div>
</div>
<nav class="col-md-8 wrapper wrap-nav">
<div class="container--">
<div class="wrap-inner">
<div class="sec-menu">
<nav id="sec-site-navigation" class="main-navigation sec-main-navigation" role="navigation" aria-label="secondary-menu">
<div class="menu-about-container"><ul id="primary-menu" class="primary-menu"><li id="menu-item-31" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31"><a href="https://deteact.com/">Home</a></li>
<li id="menu-item-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32"><a href="https://blog.deteact.com/about/">About</a></li>
<li id="menu-item-137" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-137"><a href="https://blog.deteact.com/ru">RU</a></li>
</ul></div> </nav>

<div class="nav-holder">
<button id="sec-menu-toggle" class="menu-toggle" aria-controls="secondary-menu" aria-expanded="false"><i class="fa fa-bars"></i></button>
<div id="sec-site-header-menu" class="site-header-menu">
<div class="container">
<div class="row">
<div class="col-xs-12 col-sm-12 col-md-12">
<button id="mobile-menu-toggle-close" class="menu-toggle" aria-controls="secondary-menu"><i class="fa fa-close"></i></button>
</div>
<div class="col-xs-12 col-sm-12 col-md-12 trade-hub-main-nav">
<nav id="sec-site-navigation-mobile" class="main-navigation sec-main-navigation" role="navigation" aria-label="secondary-menu">
<div class="menu-about-container"><ul id="primary-menu-mobile" class="primary-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31"><a href="https://deteact.com/">Home</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32"><a href="https://blog.deteact.com/about/">About</a></li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-137"><a href="https://blog.deteact.com/ru">RU</a></li>
</ul></div> </nav>

</div>
</div>
</div>
</div>

</div>
</div>
<div class="nav-buttons col-md-1">
<div class="button-list">
</div>
</div>
</div>
<div class="search-form-nav" id="top-search">
<form role="search" method="get" class="search-form" action="https://blog.deteact.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form> </div>
</div>
</nav>
</div>
</header>
<div id="content" class="site-content">
<div id="breadcrumb" class="wrapper wrap-breadcrumb"><div class="container"><div role="navigation" aria-label="Breadcrumbs" class="breadcrumb-trail breadcrumbs" itemprop="breadcrumb"><ul class="trail-items" itemscope itemtype="http://schema.org/BreadcrumbList"><meta name="numberOfItems" content="3" /><meta name="itemListOrder" content="Ascending" /><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-begin"><a href="https://blog.deteact.com" rel="home"><span itemprop="name">Home</span></a><meta itemprop="position" content="1" /></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item"><a href="https://blog.deteact.com/category/research/"><span itemprop="name">Research</span></a><meta itemprop="position" content="2" /></li><li itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem" class="trail-item trail-end"><span itemprop="name">Bitrix WAF bypass</span><meta itemprop="position" content="3" /></li></ul></div></div></div>
<div class="container">
<div id="primary" class="content-area">
<main id="main" class="site-main" role="main">
<div class="wrapper page-inner-title">
<div class="container">
<div class="row">
<div class="col-md-12 col-sm-12 col-xs-12">
<header class="entry-header">
<div class="inner-banner-overlay">
<h1 class="entry-title">Bitrix WAF bypass</h1> <header class="entry-header">
<div class="entry-meta entry-inner">
<span class="posted-on">On <a href="https://blog.deteact.com/2020/04/27/" rel="bookmark"><time class="entry-date published" datetime="2020-04-27T09:52:07+00:00">April 27, 2020</time><time class="updated" datetime="2020-06-04T11:37:44+00:00">June 4, 2020</time></a></span><span class="byline"> By <span class="author vcard"><a class="url fn n" href="https://blog.deteact.com/author/r0hack/">r0hack</a></span></span> </div>
</header>
</div>
</header>
</div>
</div>
</div>
</div>
<div class="entry-content">
<div class='image-full'></div>
<p><em>In Russian: <a href="https://blog.deteact.com/ru/bitrix-waf-bypass/">https://blog.deteact.com/ru/bitrix-waf-bypass/</a> </em></p>
<p><em>UPD: <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-13758">CVE-2020-13758</a> assigned</em></p>
<p>Sometimes when exploiting reflected XSS the input parameters get injected directly into the body of the <em>&lt;script&gt;</em> tag. Typically, this means that the exploit is trivial: HTML entity encoding will not prevent it, and many firewalls (including now obsolete Chrome XSS Auditor) won&#8217;t either. But CMS Bitrix has its own built-in proactive filter (WAF) for this case, and it operates similar to XSS Auditor.</p>
<h2><strong>WAF bypass</strong></h2>
<p>While fuzzing one of the Mail.ru services eligible for the Bug Bounty I encountered an entry point where the GET parameter was reflected in the body of <em>&lt;script&gt;&#8230;&lt;/script&gt;</em> tag. But it was not possible to make a simple PoC because the application was built using Bitrix and the WAF module was activated.</p>
<p>Any attempts to insert an interesting code lead to the whole script body being replaced by the placeholder <em>&lt;!— deleted by Bitrix WAF —&gt;</em>.</p>
<p>For testing purposes, we deployed a Bitrix CMS application with WAF module activated and added the following code to one of the pages (/waf-bypass.php):</p>
<figure class="wp-block-image"><img src="https://lh3.googleusercontent.com/D1OTjA6dfjqWmX-xivhugAN6nbG0rd5NefYQVnLEi2pTeQZCfakUG1M5y_COyt3nOmnJNuUmTsCzF1TZEPxL54JHz-Z-tWV-WmPYRVuVN0WsAZGUTeW6YMOZY3Uku_FLZwHvV4Jo" alt="" /></figure>
<p>If a single quote (which terminates the JS string) and an <em>alert</em> call (as well as any other function) are passed to the vulnerable page parameter, the WAF cuts out the entire script:</p>
<figure class="wp-block-image"><img src="https://lh3.googleusercontent.com/wJjvKBUksZoezaYG_g_Eq0BMakibZClddg0xgCRGJB-E5DZHurIrhbPIFhTwzgr5RSmkEbpuRx9Qfl2bspZ4Oay2__grmLYxN8Yp5CMJH7KP9LjmsjsWkzj5WT_JJnIiNofCtych" alt="" /></figure>
<p>However, during the fuzzing we found out that the mitigation does not work when the vulnerable parameter contains a <em>null byte</em> (<em>%00</em>):</p>
<figure class="wp-block-image"><img src="https://lh4.googleusercontent.com/8Prs3ERBTZxajNTOrZX2D-ZJa8TsRnapnmMcAbIDDKYA9Y2_7N5ytjPj3bxOWeiOK_EHoB3l0zmsmkYVoU2a6z9qxGVNcn6IluxSOIlx8TimIISrFSJocq-O6pcQlm8wWrFdzpxy" alt="" /></figure>
<p>Thus, we get a full payload for XSS exploitation:</p>

<div id="crayon-617d6cfc24b0f073444483" class="crayon-syntax crayon-theme-eclipse crayon-font-ubuntu-mono crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover wrap" style=" margin-top: 12px; margin-bottom: 12px; font-size: 17px !important; line-height: 17px !important;">
<div class="crayon-toolbar" data-settings=" mouseover overlay hide delay" style="font-size: 17px !important;height: 25.5px !important; line-height: 25.5px !important;"><span class="crayon-title"></span>
<div class="crayon-tools" style="font-size: 17px !important;height: 25.5px !important; line-height: 25.5px !important;"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div></div></div>
<div class="crayon-info" style="min-height: 23.8px !important; line-height: 23.8px !important;"></div>
<div class="crayon-plain-wrap"><textarea class="crayon-plain print-no" data-settings="dblclick" readonly style="-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 17px !important; line-height: 17px !important;">
/waf-bypass.php?page=BYPASS%00")});alert(1);$(document).ready(function%20(){%2f%2f</textarea></div>
<div class="crayon-main" style="">
<table class="crayon-table">
<tr class="crayon-row">
<td class="crayon-nums " data-settings="hide">
<div class="crayon-nums-content" style="font-size: 17px !important; line-height: 17px !important;"><div class="crayon-num" data-line="crayon-617d6cfc24b0f073444483-1">1</div></div>
</td>
<td class="crayon-code"><div class="crayon-pre" style="font-size: 17px !important; line-height: 17px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-617d6cfc24b0f073444483-1"><span class="crayon-o">/</span><span class="crayon-v">waf</span><span class="crayon-o">-</span><span class="crayon-v">bypass</span><span class="crayon-sy">.</span><span class="crayon-v">php</span><span class="crayon-sy">?</span><span class="crayon-v">page</span><span class="crayon-o">=</span><span class="crayon-v">BYPASS</span><span class="crayon-o">%</span><span class="crayon-cn">00</span>"<span class="crayon-sy">)</span><span class="crayon-sy">}</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-e">alert</span><span class="crayon-sy">(</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-sy">;</span><span class="crayon-sy">$</span><span class="crayon-sy">(</span><span class="crayon-v">document</span><span class="crayon-sy">)</span><span class="crayon-sy">.</span><span class="crayon-e">ready</span><span class="crayon-sy">(</span><span class="crayon-t">function</span><span class="crayon-o">%</span><span class="crayon-cn">20</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-sy">{</span><span class="crayon-o">%</span><span class="crayon-cn">2f</span><span class="crayon-o">%</span><span class="crayon-cn">2f</span></div></div></td>
</tr>
</table>
</div>
</div>

<p>This is what the result looks like on the page:</p>
<figure class="wp-block-image"><img src="https://lh4.googleusercontent.com/n1_VnCBDI-XcGroX2sLpglSlcceyzK2GWdOUeqWarz1BIcCG-BMK5O3XgTAXNC_NOyeQejxQou24PSIkC4rribFVA0VJZs3ScAAsw9PxkDvuWqLbfk9pA1l_-JvqX3UtcZe-84Od" alt="" /></figure>
<figure class="wp-block-image"><img src="https://lh3.googleusercontent.com/W1ox-YBO_NqytFyBZECuN_VsuWaE5JB0h3nYkyg37gnTd55Wf9Mw7sBqkjwPtRFyoE87QxVFWXca-EupXLBUu0oEXZ4BAU9KySINjS447c8ICez-K_RLbjfQWsNp-BkMd-4BKq4D" alt="" /></figure>
<h2><strong>The root cause</strong></h2>

<p>The mitigation is implemented in the post-filtration module to protect against XSS. The module works similarly to the XSS Auditor and tries to find the user input (like GET or POST parameters) in the body of the script tags on the page.</p>
<p>For some reason this module cuts out the null bytes from the input parameter values, so in our case the script tag body can&#8217;t be matched against input parameter value since the body contains \x00, and the parameter value does not.</p>
<p>Vulnerable code line is located in <em>./bitrix/modules/security/classes/general.post_filter.php/post_filter.php </em>where null byte <em>chr(0)</em> is cut out in the <em>addVariable </em>method:</p>
<figure class="wp-block-image"><img src="https://lh3.googleusercontent.com/e_jDQOqCayEQZwx-aNB7mLFWuY-pFY6tnwZocWiALuqRrdaYuTp1_pcVBMdyt9TsaVk4vAxQ0TQpncwBKuxVHV74f-fnh3Z08A9lMjuY9WZx13elqaY1FU1tMSsJtrbSWAXz97kC" alt="" /></figure>
<p>The <em>isDangerBody</em> function tries to find user input in the executable script body, and this is where the original <em>$body</em> value and the array of parameters (with \x00 removed) are passed to the <em>findInArray</em> function:</p>
<figure class="wp-block-image"><img src="https://lh4.googleusercontent.com/k7U6phxUG3TxfXzx3h1lqPUaRUSmY0I3Q68c9dJDA_m8N3xNHqjraZMLXakoCOgF3ceELNB5RheYkIuSYbsP2c9-aIW2AtUAE_NRo4D6RZPGKPAdAYtqBSavdu49rvbJy8slGHRH" alt="" /></figure>
<p>Remember that WAFs are almost always bypassable and the may contain weaknesses and vulnerabilities themselves. You should not rely on third-party mitigation solutions and firewalls, you should build a secure development process and regularly conduct <a href="https://pentest.deteact.com/">penetration testing</a> of applications.</p>
<p>Specifically in this case you can remove the <em>str_replace</em> call from the <em>addVariable</em> function (or to apply the same modification to the <em>$body</em> variable in the <em>isDangerBody</em> function) to correct the weakness in the WAF itself.</p>
</div>
<footer class="entry-footer">
<span class="cat-links">Categories : <a href="https://blog.deteact.com/category/research/bug-bounty/" rel="category tag">Bug Bounty</a> <a href="https://blog.deteact.com/category/research/" rel="category tag">Research</a> <a href="https://blog.deteact.com/category/research/web/" rel="category tag">Web Security</a></span> </footer>
</article>
<nav class="navigation post-navigation" role="navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://blog.deteact.com/common-flaws-of-sms-auth/" rel="prev"><span class="post-navi" aria-hidden="true">PREVIOUS POST</span> <span class="screen-reader-text">Previous post:</span> <span class="post-title">Common flaws of SMS auth</span></a></div><div class="nav-next"><a href="https://blog.deteact.com/gunicorn-http-request-smuggling/" rel="next"><span class="post-navi" aria-hidden="true">NEXT POST</span> <span class="screen-reader-text">Next post:</span> <span class="post-title">HTTP Request Smuggling</span></a></div></div>
</nav>
<div id="comments" class="comments-area">
<div id="respond" class="comment-respond">
<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/bitrix-waf-bypass/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://blog.deteact.com/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><p class="comment-notes"><span id="email-notes">Your email address will not be published.</span> Required fields are marked <span class="required">*</span></p><p class="comment-form-comment"><label for="comment">Comment</label> <textarea id="comment" name="comment" cols="45" rows="8" maxlength="65525" required="required"></textarea></p><p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" maxlength="245" required='required' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="email" value="" size="30" maxlength="100" aria-describedby="email-notes" required='required' /></p>
<p class="comment-form-url"><label for="url">Website</label> <input id="url" name="url" type="url" value="" size="30" maxlength="200" /></p>
<p class="form-submit"><input name="submit" type="submit" id="submit" class="submit" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='213' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="3809d25523" /></p><p style="display: none;"><input type="hidden" id="ak_js" name="ak_js" value="0" /></p></form> </div>
</div>
</main>
</div>
<aside id="secondary" class="widget-area" role="complementary">
<section id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://blog.deteact.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form></section>
<section id="recent-posts-2" class="widget widget_recent_entries">
<h2 class="widget-title">Recent Posts</h2>
<ul>
<li>
<a href="https://blog.deteact.com/east-finance-security-audit/">Security Audit of EAST Finance Protocol</a>
</li>
<li>
<a href="https://blog.deteact.com/top-pentest-company/">Top-10 Penetration Testing Company</a>
</li>
<li>
<a href="https://blog.deteact.com/leap-year-for-deteact/">Leap Year for DeteAct</a>
</li>
<li>
<a href="https://blog.deteact.com/the-standoff-pwned/">We won The Standoff</a>
</li>
<li>
<a href="https://blog.deteact.com/account-takeover-via-idor/">Account Takeover via IDOR</a>
</li>
</ul>
</section><section id="archives-2" class="widget widget_archive"><h2 class="widget-title">Archives</h2>
<ul>
<li><a href='https://blog.deteact.com/2021/10/'>October 2021</a></li>
<li><a href='https://blog.deteact.com/2021/08/'>August 2021</a></li>
<li><a href='https://blog.deteact.com/2020/12/'>December 2020</a></li>
<li><a href='https://blog.deteact.com/2020/11/'>November 2020</a></li>
<li><a href='https://blog.deteact.com/2020/09/'>September 2020</a></li>
<li><a href='https://blog.deteact.com/2020/08/'>August 2020</a></li>
<li><a href='https://blog.deteact.com/2020/07/'>July 2020</a></li>
<li><a href='https://blog.deteact.com/2020/06/'>June 2020</a></li>
<li><a href='https://blog.deteact.com/2020/05/'>May 2020</a></li>
<li><a href='https://blog.deteact.com/2020/04/'>April 2020</a></li>
<li><a href='https://blog.deteact.com/2019/12/'>December 2019</a></li>
<li><a href='https://blog.deteact.com/2019/11/'>November 2019</a></li>
<li><a href='https://blog.deteact.com/2019/10/'>October 2019</a></li>
<li><a href='https://blog.deteact.com/2019/09/'>September 2019</a></li>
<li><a href='https://blog.deteact.com/2019/07/'>July 2019</a></li>
<li><a href='https://blog.deteact.com/2019/06/'>June 2019</a></li>
<li><a href='https://blog.deteact.com/2019/05/'>May 2019</a></li>
<li><a href='https://blog.deteact.com/2019/01/'>January 2019</a></li>
<li><a href='https://blog.deteact.com/2018/08/'>August 2018</a></li>
<li><a href='https://blog.deteact.com/2018/04/'>April 2018</a></li>
</ul>
</section><section id="categories-2" class="widget widget_categories"><h2 class="widget-title">Categories</h2>
<ul>
<li class="cat-item cat-item-26"><a href="https://blog.deteact.com/category/research/application-security/">Application Security</a>
</li>
<li class="cat-item cat-item-10"><a href="https://blog.deteact.com/category/research/bug-bounty/">Bug Bounty</a>
</li>
<li class="cat-item cat-item-3"><a href="https://blog.deteact.com/category/business/">Business</a>
</li>
<li class="cat-item cat-item-25"><a href="https://blog.deteact.com/category/research/ctf/">CTF</a>
</li>
<li class="cat-item cat-item-5"><a href="https://blog.deteact.com/category/business/information/">Information</a>
</li>
<li class="cat-item cat-item-8"><a href="https://blog.deteact.com/category/business/news/">News</a>
</li>
<li class="cat-item cat-item-27"><a href="https://blog.deteact.com/category/business/press-releases/">Press releases</a>
</li>
<li class="cat-item cat-item-6"><a href="https://blog.deteact.com/category/research/">Research</a>
</li>
<li class="cat-item cat-item-4"><a href="https://blog.deteact.com/category/business/services/">Services</a>
</li>
<li class="cat-item cat-item-7"><a href="https://blog.deteact.com/category/research/tools/">Tools</a>
</li>
<li class="cat-item cat-item-1"><a href="https://blog.deteact.com/category/uncategorized/">Uncategorized</a>
</li>
<li class="cat-item cat-item-9"><a href="https://blog.deteact.com/category/research/web/" title="Web application vulnerabilities, secure development.">Web Security</a>
</li>
</ul>
</section></aside>
</div>
</div>
</div>
</section>

<footer class="wrapper wrap-footer">

<section id="colophon" class="wrapper site-footer" role="contentinfo">
<div class="container">
<div class="row">
<div class="xs-12 col-sm-12 col-md-12">
<div class="site-info">
Copyright &copy; All right reserved. </div>
</div>
</div>
</div>
</section>
</footer>

<a id="gotop" class="evision-back-to-top" href="#page"><i class="fa fa-angle-up"></i></a>
</div>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-116279046-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-116279046-2');
</script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/js/modernizr.min.js?ver=2.8.3' id='jquery-modernizr-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/frameworks/jquery.easing/jquery.easing.js?ver=0.3.6' id='jquery-easing-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/frameworks/slick/slick.min.js?ver=1.6.0' id='jquery-slick-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/frameworks/waypoints/jquery.waypoints.min.js?ver=4.0.0' id='jquery-waypoints-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub/assets/js/evision-custom.js?ver=5.8.1' id='trade-hub-custom-js-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-content/themes/trade-hub./assets/js/skip-link-focus-fix.js?ver=20151215' id='trade-hub-skip-link-focus-fix-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-includes/js/comment-reply.min.js?ver=5.8.1' id='comment-reply-js'></script>
<script type='text/javascript' src='https://blog.deteact.com/wp-includes/js/wp-embed.min.js?ver=5.8.1' id='wp-embed-js'></script>
<script async="async" type='text/javascript' src='https://blog.deteact.com/wp-content/plugins/akismet/_inc/form.js?ver=4.1.2' id='akismet-form-js'></script>
</body>
</html>