<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 1182373 &ndash; VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://bugzilla.suse.com/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=1182373&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=1182373">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=1182373">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=1182373">



    
    <link href="skins/standard/global.css?1411227340"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="skins/standard/global.css?1411227340" rel="stylesheet"
            type="text/css" ><link href="skins/standard/show_bug.css?1416528352" rel="stylesheet"
            type="text/css" ><link href="extensions/Voting/web/style.css?1411227348" rel="stylesheet"
            type="text/css" ><!--[if lte IE 7]>
      


      <link href="skins/standard/IE-fixes.css?1411227340" rel="stylesheet"
            type="text/css" >
<![endif]-->

    <link href="skins/contrib/SUSE/global.css?1411227340" rel="stylesheet"
            type="text/css" 
          title="SUSE">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1411227335"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1411227333"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1411227329"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1411227329"></script><script type="text/javascript" src="js/yui/json/json-min.js?1411227333"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1411227334"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1411227335"></script><script type="text/javascript" src="js/global.js?1411227336"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 1182373 – VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root",  
                             "show_bug.cgi?id=1182373" );
        document.title = "Bug 1182373 – VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 1182373 – VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1411227336"></script><script type="text/javascript" src="js/field.js?1414105521"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" ><link href="extensions/Testopia/css/testopia.css" rel="stylesheet" type="text/css">
    <link href="extensions/Testopia/extjs/examples/ux/css/RowEditor.css" rel="stylesheet" type="text/css"  />
    <script type="text/javascript">
        Testopia_user = {login: "", id: 0};
        DEFAULT_CASE_STATUS = 'CONFIRMED';
    </script>
  </head>



  <body onload=""
        class="bugzilla-suse-com bz_bug bz_status_RESOLVED bz_product_SUSE_Security_Incidents bz_component_Audits bz_bug_1182373 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<!--div id="tmp_warning_wnd" style="
    position:fixed; 
    color:red; 
    font-size:20px; 
    top:50px; 
    left:10%; 
    right:10%; 
    padding:1em;
    background-color:#ffffff;
    border:3px solid red;
    z-index:9999;
    text-align:center;">
  This Bugzilla is for TESTING ONLY. All new bugs and comments WILL BE LOST. Use <a href="https://bugzilla.suse.com">bugzilla.suse.com</a> instead.
  <button style="
      background:none;
      border:0;
      box-shadow:none;
      color:red;
      text-shadow:none;
      position:absolute;
      right:0;
      top:0;" onclick="document.getElementById('tmp_warning_wnd').style.display='none';">[X]</button>
</div-->

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1182373</p>
    </td>

    <td id="subtitle">
      <p class="subheader">VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2021-06-22 11:53:00 UTC</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <!--a id="login_link_top" href="show_bug.cgi?id=1182373&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a-->
  <a id="login_link_top" href="show_bug.cgi?id=1182373&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1182373" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
</div> 

<div id="bugzilla-body">

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2021-06-22 11:53:00">
  <input type="hidden" name="longdesclength" value="21">
  <input type="hidden" name="id" value="1182373">
  <input type="hidden" name="token" value="1635630559-YO9FQkW46bDCZJGfMVg00-6NTQ39q6CpcjFVmkBH_sM">
<div class="bz_alias_short_desc_container edit_form">
        <strike>
     <a href="show_bug.cgi?id=1182373"><b>Bug&nbsp;1182373</b></a> -<span id="summary_alias_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2021-25322</span>) 
      <span id="short_desc_nonedit_display">VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root</span></strike>
     </span>  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">(CVE-2021-25322)
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=glossary.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td><span title="VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root">VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used duri...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('VUL-0: CVE-2021-25322: python-HyperKitty: hyperkitty-permissions.sh used during %post allows local privilege escalation from hyperkitty user to root', 'CVE-2021-25322');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=status_resolution_matrix.html">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>

          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
      </tr>

    
    
    
    <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >SUSE Security Incidents</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=SUSE Security Incidents"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Audits</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=glossary.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=glossary.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">Other
       Other
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority">
          <a href="page.cgi?id=glossary.html#priority">Priority</a></label>:
      </th>
      <td>P3 - Medium
        <label for="severity">
          <b>Severity</b></label>:
       Normal
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=glossary.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=glossary.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">

    <label for="qa_contact" accesskey="q">

  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#qa_contact"
  >QA Contact:</a>
</label>
</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-team\x40suse.de',
        'security-team\x40suse.de');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=glossary.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=glossary.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    <a class="bz_bug_link 
          bz_status_IN_PROGRESS "
   title="IN_PROGRESS"
   href="show_bug.cgi?id=1180875">1180875</a> 
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=1182373&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=1182373">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2021-02-17 14:31 UTC by <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2021-06-22 11:53 UTC 
      (<a href="show_activity.cgi?id=1182373">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>10 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="asn">asn</option>
                <option value="daniel.molkentin">daniel.molkentin</option>
                <option value="dimstar">dimstar</option>
                <option value="jsegitz">jsegitz</option>
                <option value="matthias.gerstner">matthias.gerstner</option>
                <option value="mcepl">mcepl</option>
                <option value="mmachova">mmachova</option>
                <option value="mrueckert">mrueckert</option>
                <option value="pgajdos">pgajdos</option>
                <option value="security-team">security-team</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=glossary.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_foundby">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_foundby"
  >Found By:</a>

</th>
  <td class="field_value "
      id="field_container_cf_foundby"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_nts_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_nts_priority"
  >Services Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_nts_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_biz_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_biz_priority"
  >Business Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_biz_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_blocker">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_blocker"
  >Blocker:</a>

</th>
  <td class="field_value "
      id="field_container_cf_blocker"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_marketing_qa_status">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_marketing_qa_status"
  >Marketing QA Status:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_marketing_qa_status"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_it_deployment">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_it_deployment"
  >IT Deployment:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_it_deployment"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         <ul>
    <li><a href="tr_new_case.cgi?product=SUSE%20Security%20Incidents&bug=1182373">Create test case</a></li>
</ul><ul>
  <li><a href="enter_bug.cgi?cloned_bug_id=1182373">Clone This Bug</a></li>
</ul>
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=1182373&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=1182373&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1411227336" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-17 14:31:06 UTC
        </span>
      </div>



<pre class="bz_comment_text" >+++ This bug was initially created as a clone of <a class="bz_bug_link 
          bz_status_IN_PROGRESS "
   title="IN_PROGRESS"
   href="show_bug.cgi?id=1180875">Bug #1180875</a>

We are currently reviewing checked-in scripts and sources in OBS for security
issues.

In python-HyperKitty the script hyperkitty-permissions.sh is installed along
with the package and is also invoked in the %post section of the
HyperKitty-web package.

In particular this script performs recursive ownership changes and ACL
settings as root on user controlled directories in /var/lib/hyperkitty/data,
/var/log/hyperkitty and /srv/www/webapps/mailman/hyperkitty/static/CACHE.

Since these directories are owned by the hyperkitty and/or hyperkitty-admin
users they can stage symlink attacks to pass ownership of arbitrary files in
the system to themselves. A compromised hyperkitty or hyperkitty-admin account
might therefore be able to perform a local root exploit.

Please perform safe operations here. For example:

- only perform the changes in ownership if the ownership does *not* match i.e.
  don't do it unconditionally.
- pass ownership of the root directory last.
- pass switches like -P to setfacl and -h to chown to make it not follow
  symbolic links.
- using `setpriv` or `su` to drop privileges to the owner of the root of the
  directory tree.

If this script is SUSE specific then we will have to assign a SUSE CVE for
this issue. Otherwise please tell us who upstream is.</pre>
    </div><div id="c1" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-17 15:11:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The script is SUSE-specific. IIRC correctly the same script is in postorius.


I wont be able to look into this before next week. If someone else wants to do it feel free to take over.</pre>
    </div><div id="c2" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-18 09:24:18 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:asn&#64;cryptomilk.org">asn&#64;cryptomilk.org</a> from <a href="show_bug.cgi?id=1182373#c1">comment #1</a>)
<span class="quote">&gt; The script is SUSE-specific. IIRC correctly the same script is in postorius.</span >

Indeed. That would have been the next package I would have inspected, because
we work in alphabetical order and it comes right after python-HyperKitty ;-).
I will open a separate bug for that right away.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Marcus Rückert</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-23 14:03:57 UTC
        </span>
      </div>



<pre class="bz_comment_text" >~ » sudo podman images
REPOSITORY                                                         TAG     IMAGE ID      CREATED       SIZE
registry.opensuse.org/opensuse/leap                                latest  95dab51edb8c  39 hours ago  108 MB

~ » sudo podman run -ti --rm 95dab51edb8c bash
0ac89398f97a:/ # zypper in util-linux
Retrieving repository 'Non-OSS Repository' metadata ......................................................................................................[done]
Building repository 'Non-OSS Repository' cache ...........................................................................................................[done]
Retrieving repository 'Main Repository' metadata .........................................................................................................[done]
Building repository 'Main Repository' cache ..............................................................................................................[done]
Retrieving repository 'Main Update Repository' metadata ..................................................................................................[done]
Building repository 'Main Update Repository' cache .......................................................................................................[done]
Retrieving repository 'Update Repository (Non-Oss)' metadata .............................................................................................[done]
Building repository 'Update Repository (Non-Oss)' cache ..................................................................................................[done]
Loading repository data...
Reading installed packages...
'util-linux' is already installed.
No update candidate for 'util-linux-2.33.1-lp152.5.6.1.x86_64'. The highest available version is already installed.
Resolving package dependencies...
Nothing to do.
0ac89398f97a:/ # zypper in shadow
Loading repository data...
Reading installed packages...
'shadow' is already installed.
No update candidate for 'shadow-4.6-lp152.3.80.x86_64'. The highest available version is already installed.
Resolving package dependencies...
Nothing to do.
0ac89398f97a:/ # cat /etc/passwd 
root:x:0:0:root:/root:/bin/bash
0ac89398f97a:/ # groupadd -r foo ; useradd -r -g foo foo
0ac89398f97a:/ # mkdir /home/foo
0ac89398f97a:/ # ln -s /etc/passwd /home/foo/
0ac89398f97a:/ # chown -R /home/foo/
chown: missing operand after '/home/foo/'
Try 'chown --help' for more information.
0ac89398f97a:/ # chown -R foo: /home/foo/                                                                                                                       
0ac89398f97a:/ # find /home/foo/ -ls
  1710289      4 drwxr-xr-x   2  foo      foo          4096 Feb 23 13:55 /home/foo/
  1710291      0 lrwxrwxrwx   1  foo      foo            11 Feb 23 13:55 /home/foo/passwd -&gt; /etc/passwd
0ac89398f97a:/ # ls -ld /etc/passwd
-rw-r--r-- 1 root root 67 Feb 23 13:54 /etc/passwd
0ac89398f97a:/ # cd /home/foo/
0ac89398f97a:/home/foo # touch file1; ln -s file1 link1; chown someuser link1; ls -lh file1
chown: invalid user: 'someuser'
-rw-r--r-- 1 root root 0 Feb 23 13:58 file1
0ac89398f97a:/home/foo # touch file1; ln -s file1 link1; chown foo^Cink1; ls -lh file1                                                                          
0ac89398f97a:/home/foo # chown foo link1 
0ac89398f97a:/home/foo # ls -lh file 
ls: cannot access 'file': No such file or directory
0ac89398f97a:/home/foo # ls -lh file1
-rw-r--r-- 1 foo root 0 Feb 23 13:58 file1
0ac89398f97a:/home/foo # ls -ld link1
lrwxrwxrwx 1 root root 5 Feb 23 13:58 link1 -&gt; file1
0ac89398f97a:/home/foo # 


I see the same behavior in a TW container.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-25 09:18:51 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:mrueckert&#64;suse.com">mrueckert&#64;suse.com</a> from <a href="show_bug.cgi?id=1182373#c3">comment #3</a>)
<span class="quote">&gt; 0ac89398f97a:/ # chown -R foo: /home/foo/
&gt; 0ac89398f97a:/ # find /home/foo/ -ls
&gt;   1710289      4 drwxr-xr-x   2  foo      foo          4096 Feb 23 13:55 /home/foo/
&gt;   1710291      0 lrwxrwxrwx   1  foo      foo            11 Feb 23 13:55 /home/foo/passwd -&gt; /etc/passwd
&gt; 0ac89398f97a:/ # ls -ld /etc/passwd
&gt; -rw-r--r-- 1 root root 67 Feb 23 13:54 /etc/passwd</span >

chown and related utilities indeed do not *intend* to follow symlinks in
recursive operations. But this does not take into account any possible race
conditions that might occur while the recursive operation is taking place.

Even then most standard utilities use safe system call sequences these days
that should prevent any damage from happening when a local user tries to
exploit race conditions.

Because this is a complex area on both, the kernel and the userspace end, it
is best *not* to rely on this operation being safe. Also changing some
seemingly minor aspect of the environment (e.g. the target path listed on the
command line) can quickly change the situation again, so it is error prone.

<span class="quote">&gt; 0ac89398f97a:/ # cd /home/foo/</span >
[...]
<span class="quote">&gt; 0ac89398f97a:/home/foo # touch file1; ln -s file1 link1; chown foo^Cink1; ls -lh file1
&gt; 0ac89398f97a:/home/foo # chown foo link1 </span >
[...]
<span class="quote">&gt; 0ac89398f97a:/home/foo # ls -lh file1
&gt; -rw-r--r-- 1 foo root 0 Feb 23 13:58 file1
&gt; 0ac89398f97a:/home/foo # ls -ld link1
&gt; lrwxrwxrwx 1 root root 5 Feb 23 13:58 link1 -&gt; file1
&gt; 0ac89398f97a:/home/foo # </span >

Here the &quot;exploit&quot; worked. For the link explicitly listed on the command line
`chown` followed the symlink and changed the ownership of &quot;file1&quot; to foo:root.</pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-02-25 09:20:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Since there seems to be some unclarity how to reproduce this I am posting a
simple reproducer for a Tumbleweed live system:

1) install the involved packages

    root# zypper in HyperKitty-web python3-HyperKitty

2) become the hyperkitty-admin user and emulate an attacker:

    root# sudo -u hyperkitty-admin /bin/bash
    hyperkitty-admin$ cd /var/lib/hyperkitty/data
    hyperkitty-admin$ ls -lh
     total 480K
     -rw-rw----+ 1 hyperkitty hyperkitty 480K 25. Feb 09:59 hyperkitty.db
    hyperkitty-admin$ rm hyperkitty.db
    hyperkitty-admin$ ln -s /etc/shadow hyperkitty.db
    hyperkitty-admin$ ls -lh . /etc/shadow
    -rw-r-----  1 root       shadow     1.2K 25. Feb 09:58 /etc/shadow

    .:
    total 0
    lrwxrwxrwx 1 hyperkitty hyperkitty 11 25. Feb 10:03 hyperkitty.db -&gt; /etc/shadow

3) as root run the fix-permissions script (this would also happen during any
   RPM installation/update of the hyperkitty package):

    root# /usr/sbin/hyperkitty-fix-permissions

4) as hyperkitty-admin from step 2) inspect the results:

    hyperkitty-admin$ ls -lh . /etc/shadow
    -rw-rw----  1 hyperkitty hyperkitty 1.2K 25. Feb 09:58 /etc/shadow

    .:
    total 0
    lrwxrwxrwx 1 hyperkitty hyperkitty 11 25. Feb 10:03 hyperkitty.db -&gt; /etc/shadow

So for the hyperkitty-admin we have a pretty simple local root exploit.
Basically the hyperkitty user can do the same. However, hyperkitty is not
allowed to enter /var/lib/hyperkitty, because of these two lines:

    chown   hyperkitty-admin:hyperkitty-admin          ${LIB_DIR}
    chmod   u=rwX,g=rwX,o=                             ${LIB_DIR}

I am not sure if this makes sense at all, to deny hyperkitty access to
${LIB_DIR} but pass ownership ${LIB_DIR}/data to hyperkitty. This only makes
sense if hyperkitty has access to the sub-directory via a chroot or something
similar. If this is the case, then the hyperkitty user can stage the same
attack as described above (although it would still need to escape from the
chroot to make use of the results).</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-01 11:17:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Is there any progress here? What is the current plan?

According to our openSUSE disclosure policy we can keep this private no longer
than 90 days, resulting in a publication of the finding after 2021-05-18.</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-01 11:18:15 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Internal CRD: 2021-05-18 or earlier</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-29 12:11:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So ~3 more weeks until we need to make this public. Do you need further help
with this?</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-19 08:41:15 UTC
        </span>
      </div>



<pre class="bz_comment_text" >CRD has been crossed, publishing the bug.</pre>
    </div><div id="c10" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matej Cepl</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-19 09:17:01 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Isn’t this the same as <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - /var/lib/mailman/archives/mailman: user mailman can't access"
   href="show_bug.cgi?id=1167068">bug 1167068</a>? Wouldn’t the same fix (i.e., don’t run a script, just set rights correctly in %files) help?</pre>
    </div><div id="c11" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-19 10:18:35 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Matej Cepl from <a href="show_bug.cgi?id=1182373#c10">comment #10</a>)
<span class="quote">&gt; Isn’t this the same as <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - /var/lib/mailman/archives/mailman: user mailman can't access"
   href="show_bug.cgi?id=1167068">bug 1167068</a>? Wouldn’t the same fix (i.e., don’t run a
&gt; script, just set rights correctly in %files) help?</span >

I don't think this is the same type of bug. That bug was about a functionality issue, this bug here is about a security issue involved with the hyperkitty-permissions.sh script checked in into the package. This script is attempting to &quot;repair&quot; or enforce certain permissions, and this logic is causing security issues.

It would help to remove the script, of course, but we need an active maintainer to take responsibility for such a choice. Security cannot take over this duty, we can just advise and review.</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-19 16:24:28 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The right thing to do would be to generate the static files during the rpm build process and the script should if needed just fix the permissions to the sqlite database. I might have time to fix this next week but I don't have time before.</pre>
    </div><div id="c13" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-19 16:25:47 UTC
        </span>
      </div>



<pre class="bz_comment_text" >As suse is using this software to run their own mailing list I would expect that you have a maintainer for it.</pre>
    </div><div id="c14" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-20 09:26:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please use CVE-2021-25322 for this</pre>
    </div><div id="c15" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Petr Gajdos</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-20 13:35:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Andreas,

as you volunteered to add this script, I am asking you. Unfortunately I do not use mailman/HyperKitty/postorius, I need to understand why such thing beyond rpm mechanism is needed, in other words, what would happen when this script would not run upon every package installation or upgrade. Could you please advise?</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-25 19:05:10 UTC
        </span>
      </div>



<pre class="bz_comment_text" ><a href="https://build.opensuse.org/request/show/895418">https://build.opensuse.org/request/show/895418</a></pre>
    </div><div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-26 08:09:54 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:asn&#64;cryptomilk.org">asn&#64;cryptomilk.org</a> from <a href="show_bug.cgi?id=1182373#c16">comment #16</a>)
<span class="quote">&gt; <a href="https://build.opensuse.org/request/show/895418">https://build.opensuse.org/request/show/895418</a></span >

Thank you for the submission.

You are still packaging the hyperkitty-permissions.sh script. So this is
intended for end users to invoke?

There are still missing switches to avoid following symlinks e.g. `-h` for
chown. For operations on files below non-root owned directories a privilege
drop to the target user needs to happen to make it fool proof. E.g.:

    # make sure execution aborts if anything goes wrong in-between
    set -e

    # first make sure the root directory ownership is correct
    chown -h hyperkitty-admin ${LIB_DIR}

    # now do the same for DATA_DIR sub-dir which is owned by a different user
    chown -h hyperkitty ${DATA_DIR}

    # perform chmod only as the unprivileged user, because chmod always
    # follows symlinks found in command line arguments
    setpriv --ruid hyperkitty --rgid hyperkitty --init-groups --reset-env chmod u=rwX,g=rwX,o= ${DATA_DIR}</pre>
    </div><div id="c18" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Andreas Schneider</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-26 08:36:52 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The thing is that you can run certain commands to manage the install. E.g. to create the first database (sqlite by default) and do upgrades of the database. It might be possible to get rid of the hyperkitty-admin user, but then we still need the permission script to fix permissions on files.

Also this needs to be tested and I'm testing this on a production system right now.

Also my time is limited, more eyes would help to look into this.</pre>
    </div><div id="c19" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-26 13:10:20 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:asn&#64;cryptomilk.org">asn&#64;cryptomilk.org</a> from <a href="show_bug.cgi?id=1182373#c18">comment #18</a>)
<span class="quote">&gt; The thing is that you can run certain commands to manage the install. E.g.
&gt; to create the first database (sqlite by default) and do upgrades of the
&gt; database. It might be possible to get rid of the hyperkitty-admin user, but
&gt; then we still need the permission script to fix permissions on files.</span >

My remarks are not about getting rid of the hyperkitty-admin user, they are
about performing dangerous operations in a safe way.

Why do permissions have to be &quot;fixed&quot;? I don't fully get that.

When the script makes sure that no service is currently running and already
working on these files (i.e. CWD set to somewhere below /var/lib/hyperkitty)
then an approach could also be to deny access to the the root directory:

    chown root:root /var/lib/hyperkitty
    chmod 700 /var/lib/hyperkitty
    
    # now perform all the &quot;fix&quot; operations below /var/lib/hyperkitty

    # turn ownership of the root back to the desired values
    chown hyperkitty:hyperkitty /var/lib/hyperkitty
    chmod 755 /var/lib/hyperkitty</pre>
    </div><div id="c20" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1182373#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-06-22 11:53:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >The permissions.sh script has been completely removed from Factory and is also
not present in the Leap:15.2 codestream. This bug can be closed.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=1182373">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=1182373">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=1182373">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <!--a id="login_link_bottom" href="show_bug.cgi?id=1182373&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a-->
  <a id="login_link_bottom" href="show_bug.cgi?id=1182373&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1182373" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
  </li>

  
    


  <form id="testopia_helper_frm"></form><ul class="links">
    <li>Legal: </li>
    <li><a href="http://en.opensuse.org/Terms_of_site">openSUSE</a></li>
    <li><a href="https://www.suse.com/company/legal/">SUSE</a></li>
  </ul>
</ul>

  <div class="outro"></div>
</div>


</body>
</html>