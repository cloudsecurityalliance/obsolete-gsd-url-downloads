<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<title>#22793 - grep -E assertion failure with back references - GNU bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="robots" content="noindex, nofollow">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<script type="text/javascript">
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
</script>
</head>
<body>
<h1>GNU bug report logs - 
#22793<br/>
grep -E assertion failure with back references</h1>
<p><a href="bugreport.cgi?bug=22792">Previous</a> <a href="bugreport.cgi?bug=22794">Next</a></p>
<div class="versiongraph"></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=grep">grep</a>;
</p>
</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=santiagorr%40riseup.net">santiagorr &lt;at&gt; riseup.net</a></p>
  <p>Date: Wed, 24 Feb 2016 16:20:02 UTC</p>

<p>Severity: normal</p>
<p></p>
<p>Merged with <a href="bugreport.cgi?bug=32806">32806</a>,
<a href="bugreport.cgi?bug=34238">34238</a>,
<a href="bugreport.cgi?bug=42946">42946</a></p>




</div>

<p>To reply to this bug, email your comments to 22793 AT debbugs.gnu.org.
<p><a href="javascript:toggle_infmessages();">Toggle</a> the display of automated, internal messages from the tracker.</p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=22793;mbox=yes" title="Folder with messages as they arrived at the tracker">mbox folder</a>, <a href="bugreport.cgi?mboxstat=yes;bug=22793" title="Folder with a status summary message at the start">status mbox</a>, <a href="bugreport.cgi?bug=22793;mboxmaint=yes;mbox=yes" title="Folder of messages as sent from the tracker to the maintainers">maintainer mbox</a></p></div>

<div class="infmessage"><hr>
<a name="1"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1456330802 -->
<strong>Report forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Wed, 24 Feb 2016 16:20:02 GMT) <a href="bugreport.cgi?msg=2;bug=22793">Full text</a> and <a href="bugreport.cgi?bug=22793;mbox=yes;msg=2">rfc822 format</a> available.</div>

<div class="infmessage"><hr>
<a name="3"></a>
<!-- request_addr: santiagorr &lt;at&gt; riseup.net -->
<!-- time:1456330802 -->
<strong>Acknowledgement sent</strong>
to <code>santiagorr &lt;at&gt; riseup.net</code>:<br>
New bug report received and forwarded.  Copy sent to <code>bug-grep &lt;at&gt; gnu.org</code>.
 (Wed, 24 Feb 2016 16:20:02 GMT) <a href="bugreport.cgi?bug=22793;msg=4">Full text</a> and <a href="bugreport.cgi?bug=22793;mbox=yes;msg=4">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?msg=5;bug=22793">full text</a>, <a href="bugreport.cgi?mbox=yes;msg=5;bug=22793">mbox</a>):</p>
<pre class="headers">
<b>From:</b> santiagorr &lt;at&gt; riseup.net
<b>To:</b> bug-grep &lt;at&gt; gnu.org
<b>Subject:</b> grep -E assertion failure with back references
<b>Date:</b> Wed, 24 Feb 2016 17:18:54 +0100
</pre>
<pre class="message">Hi,

This is a long standing bug reported to Debian, still present in 2.23.
It was forwarded at some point, but I cannot find any reference, so I&#39;m
reforwarding it.

% echo abc | LANG=C grep -E &#39;(.*)(.*)(.*)\3\2\1&#39;
grep: regexec.c:1401: pop_fail_stack: Assertion `num &gt;= 0&#39; failed.

More info at: <a href="https://bugs.debian.org/186568">https://bugs.debian.org/186568</a>

Regards,

Santiago



</pre>

<div class="infmessage"><hr>
<a name="6"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1456340281 -->
<strong>Information forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Wed, 24 Feb 2016 18:58:01 GMT) <a href="bugreport.cgi?bug=22793;msg=7">Full text</a> and <a href="bugreport.cgi?bug=22793;mbox=yes;msg=7">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="8"></a><a name="msg8"></a><a href="#8">Message #8</a> received at 22793 &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?bug=22793;msg=8">full text</a>, <a href="bugreport.cgi?mbox=yes;msg=8;bug=22793">mbox</a>):</p>
<pre class="headers">
<b>From:</b> Jim Meyering &lt;jim &lt;at&gt; meyering.net&gt;
<b>To:</b> santiagorr &lt;at&gt; riseup.net
<b>Cc:</b> 22793 &lt;at&gt; debbugs.gnu.org
<b>Subject:</b> Re: bug#22793: grep -E assertion failure with back references
<b>Date:</b> Wed, 24 Feb 2016 10:56:38 -0800
</pre>
<pre class="message">forcemerge 21513 22793
thanks

On Wed, Feb 24, 2016 at 8:18 AM,  &lt;santiagorr &lt;at&gt; riseup.net&gt; wrote:
&gt; Hi,
&gt;
&gt; This is a long standing bug reported to Debian, still present in 2.23.
&gt; It was forwarded at some point, but I cannot find any reference, so I&#39;m
&gt; reforwarding it.
&gt;
&gt; % echo abc | LANG=C grep -E &#39;(.*)(.*)(.*)\3\2\1&#39;
&gt; grep: regexec.c:1401: pop_fail_stack: Assertion `num &gt;= 0&#39; failed.
&gt;
&gt; More info at: <a href="https://bugs.debian.org/186568">https://bugs.debian.org/186568</a>

Correct, this was reported some time ago,
both here and in the upstream glibc bugzilla:

  <a href="http://bugs.gnu.org/21513">http://bugs.gnu.org/21513</a>
  <a href="https://sourceware.org/bugzilla/show_bug.cgi?id=18986">https://sourceware.org/bugzilla/show_bug.cgi?id=18986</a>

There is currently an &quot;XFAIL&quot; (expected-to-fail) test in grep&#39;s
test suite that exercises precisely this bug:

  git.savannah.gnu.org/cgit/grep.git/tree/tests/triple-backref



</pre>

<div class="msgreceived"><hr>
<a name="9"></a>
<!-- requester: Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; -->
<!-- request_addr: control &lt;at&gt; debbugs.gnu.org -->
<!-- time:1456342982 -->
<strong>Forcibly Merged <a href="bugreport.cgi?bug=21513">21513</a> <a href="bugreport.cgi?bug=22793">22793</a>.</strong>
Request was from <code>Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;</code>
to <code>control &lt;at&gt; debbugs.gnu.org</code>.
 (Wed, 24 Feb 2016 19:43:02 GMT) <a href="bugreport.cgi?msg=10;bug=22793">Full text</a> and <a href="bugreport.cgi?bug=22793;mbox=yes;msg=10">rfc822 format</a> available.</div>

<div class="infmessage"><hr>
<a name="11"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1456343281 -->
<strong>Information forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Wed, 24 Feb 2016 19:48:01 GMT) <a href="bugreport.cgi?msg=12;bug=22793">Full text</a> and <a href="bugreport.cgi?msg=12;mbox=yes;bug=22793">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="13"></a><a name="msg13"></a><a href="#13">Message #13</a> received at 22793 &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?msg=13;bug=22793">full text</a>, <a href="bugreport.cgi?bug=22793;msg=13;mbox=yes">mbox</a>):</p>
<pre class="headers">
<b>From:</b> Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;
<b>To:</b> Jim Meyering &lt;jim &lt;at&gt; meyering.net&gt;, santiagorr &lt;at&gt; riseup.net
<b>Cc:</b> 22793 &lt;at&gt; debbugs.gnu.org, 186568 &lt;at&gt; bugs.debian.org
<b>Subject:</b> Re: bug#22793: grep -E assertion failure with back references
<b>Date:</b> Wed, 24 Feb 2016 11:46:55 -0800
</pre>
<pre class="message">With recent &#39;grep&#39; you can work around the problem by configuring 
--with-included-regex. That has some other undesirable properties, though.

This is really a glibc bug 
&lt;<a href="https://sourceware.org/bugzilla/show_bug.cgi?id=18986">https://sourceware.org/bugzilla/show_bug.cgi?id=18986</a>&gt; and the glibc 
patch could be applied to the Debian copy of glibc. Here&#39;s the patch:

<a href="http://git.savannah.gnu.org/cgit/gnulib.git/commit/?id=5513b40999149090987a0341c018d05d3eea1272">http://git.savannah.gnu.org/cgit/gnulib.git/commit/?id=5513b40999149090987a0341c018d05d3eea1272</a>

In other words, Debian bug #186568 is really a glibc bug, not a grep 
bug. Can you please fix the Debian bug report accordingly? I&#39;ll CC: this 
message there.



</pre>

<div class="infmessage"><hr>
<a name="14"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1456380782 -->
<strong>Information forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Thu, 25 Feb 2016 06:13:02 GMT) <a href="bugreport.cgi?msg=15;bug=22793">Full text</a> and <a href="bugreport.cgi?bug=22793;msg=15;mbox=yes">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="16"></a><a name="msg16"></a><a href="#16">Message #16</a> received at 22793 &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?bug=22793;msg=16">full text</a>, <a href="bugreport.cgi?msg=16;mbox=yes;bug=22793">mbox</a>):</p>
<pre class="headers">
<b>From:</b> arnold &lt;at&gt; skeeve.com
<b>To:</b> santiagorr &lt;at&gt; riseup.net, jim &lt;at&gt; meyering.net, eggert &lt;at&gt; cs.ucla.edu
<b>Cc:</b> 22793 &lt;at&gt; debbugs.gnu.org, 186568 &lt;at&gt; bugs.debian.org
<b>Subject:</b> Re: bug#22793: grep -E assertion failure with back references
<b>Date:</b> Wed, 24 Feb 2016 23:12:10 -0700
</pre>
<pre class="message">Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; wrote:

&gt; With recent &#39;grep&#39; you can work around the problem by configuring 
&gt; --with-included-regex.

Not so. I did a fresh

	./boostrap
	./configure --with-included-regex
	make

and it still core dumps:

$ echo abc | ./src/grep -E  &#39;(.*)(.*)(.*)\3\2\1&#39;
grep: regexec.c:1413: pop_fail_stack: Assertion `((Idx) (num) &lt; ((Idx) -2))&#39; failed.
Aborted (core dumped)

I looked at it in a debugger fs-&gt;num before the --fs-&gt;num executes looks to
be -1.

Thanks,

Arnold



</pre>

<div class="msgreceived"><hr>
<a name="17"></a>
<!-- requester: Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; -->
<!-- request_addr: control &lt;at&gt; debbugs.gnu.org -->
<!-- time:1456386961 -->
<strong>Disconnected #22793 from all other report(s).</strong>
Request was from <code>Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;</code>
to <code>control &lt;at&gt; debbugs.gnu.org</code>.
 (Thu, 25 Feb 2016 07:56:01 GMT) <a href="bugreport.cgi?msg=18;bug=22793">Full text</a> and <a href="bugreport.cgi?bug=22793;msg=18;mbox=yes">rfc822 format</a> available.</div>

<div class="infmessage"><hr>
<a name="19"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1456387382 -->
<strong>Information forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Thu, 25 Feb 2016 08:03:02 GMT) <a href="bugreport.cgi?bug=22793;msg=20">Full text</a> and <a href="bugreport.cgi?mbox=yes;msg=20;bug=22793">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="21"></a><a name="msg21"></a><a href="#21">Message #21</a> received at 22793 &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?msg=21;bug=22793">full text</a>, <a href="bugreport.cgi?mbox=yes;msg=21;bug=22793">mbox</a>):</p>
<pre class="headers">
<b>From:</b> Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;
<b>To:</b> arnold &lt;at&gt; skeeve.com, santiagorr &lt;at&gt; riseup.net, jim &lt;at&gt; meyering.net
<b>Cc:</b> 22793 &lt;at&gt; debbugs.gnu.org, 186568 &lt;at&gt; bugs.debian.org, 21513 &lt;at&gt; debbugs.gnu.org
<b>Subject:</b> Re: bug#22793: grep -E assertion failure with back references
<b>Date:</b> Thu, 25 Feb 2016 00:01:52 -0800
</pre>
<pre class="message">arnold &lt;at&gt; skeeve.com wrote:
&gt; Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; wrote:
&gt;
&gt;&gt; With recent &#39;grep&#39; you can work around the problem by configuring
&gt;&gt; --with-included-regex.
&gt;
&gt; Not so. I did a fresh
&gt;
&gt; 	./boostrap
&gt; 	./configure --with-included-regex
&gt; 	make
&gt;
&gt; and it still core dumps:
&gt;
&gt; $ echo abc | ./src/grep -E  &#39;(.*)(.*)(.*)\3\2\1&#39;
&gt; grep: regexec.c:1413: pop_fail_stack: Assertion `((Idx) (num) &lt; ((Idx) -2))&#39; failed.
&gt; Aborted (core dumped)
&gt;
&gt; I looked at it in a debugger fs-&gt;num before the --fs-&gt;num executes looks to
&gt; be -1.

Sorry, you&#39;re right. I got confused into thinking that grep Bug#22793 and grep 
Bug#21513 are the same bugs, but they&#39;re not. I have unmerged them.

This is still a glibc bug, not a grep bug; it&#39;s just that we don&#39;t have a fix.

grep Bug#21513 is indeed fixed by configuring --with-included-regex.



</pre>

<div class="infmessage"><hr>
<a name="22"></a>
<!-- request_addr: bug-grep &lt;at&gt; gnu.org -->
<!-- time:1484689081 -->
<strong>Information forwarded</strong>
to <code>bug-grep &lt;at&gt; gnu.org</code>:<br>
<code>bug#22793</code>; Package <code>grep</code>.
 (Tue, 17 Jan 2017 21:38:01 GMT) <a href="bugreport.cgi?bug=22793;msg=23">Full text</a> and <a href="bugreport.cgi?mbox=yes;msg=23;bug=22793">rfc822 format</a> available.</div>

<hr><p class="msgreceived"><a name="24"></a><a name="msg24"></a><a href="#24">Message #24</a> received at 22793 &lt;at&gt; debbugs.gnu.org (<a href="bugreport.cgi?bug=22793;msg=24">full text</a>, <a href="bugreport.cgi?msg=24;mbox=yes;bug=22793">mbox</a>):</p>
<pre class="headers">
<b>From:</b> Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;
<b>To:</b> 22793 &lt;at&gt; debbugs.gnu.org
<b>Cc:</b> Paolo Bonzini &lt;bonzini &lt;at&gt; gnu.org&gt;, arnold &lt;at&gt; skeeve.com, santiagorr &lt;at&gt; riseup.net,
 Jim Meyering &lt;jim &lt;at&gt; meyering.net&gt;
<b>Subject:</b> Re: grep -E assertion failure with back references
<b>Date:</b> Tue, 17 Jan 2017 13:37:12 -0800
</pre>
<pre class="message">&gt; This is still a glibc bug, not a grep bug; it&#39;s just that we don&#39;t have a fix.

I finally got around to finding the correct glibc bug report for this
grep bug. Here it is:

<a href="https://sourceware.org/bugzilla/show_bug.cgi?id=11053">https://sourceware.org/bugzilla/show_bug.cgi?id=11053</a>

I added a comment to the glibc bug, saying that it causes grep Bug#22793
&lt;<a href="https://bugs.gnu.org/22793">https://bugs.gnu.org/22793</a>&gt;.

Paolo Bonzini reported the glibc bug in 2009 and is the current
assignee. I think he&#39;s pretty busy doing other things. It&#39;d be nice if
someone could fix the glibc bug (or at least, fix it in Gnulib), though
I suspect that any fix will not be trivial.




</pre>

<div class="msgreceived"><hr>
<a name="25"></a>
<!-- requester: Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; -->
<!-- request_addr: control &lt;at&gt; debbugs.gnu.org -->
<!-- time:1537651442 -->
<strong>Merged <a href="bugreport.cgi?bug=22793">22793</a> <a href="bugreport.cgi?bug=32806">32806</a>.</strong>
Request was from <code>Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;</code>
to <code>control &lt;at&gt; debbugs.gnu.org</code>.
 (Sat, 22 Sep 2018 21:24:02 GMT) <a href="bugreport.cgi?bug=22793;msg=26">Full text</a> and <a href="bugreport.cgi?bug=22793;mbox=yes;msg=26">rfc822 format</a> available.</div>

<div class="msgreceived"><hr>
<a name="27"></a>
<!-- requester: Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; -->
<!-- request_addr: control &lt;at&gt; debbugs.gnu.org -->
<!-- time:1548904982 -->
<strong>Merged <a href="bugreport.cgi?bug=22793">22793</a> <a href="bugreport.cgi?bug=32806">32806</a> <a href="bugreport.cgi?bug=34238">34238</a>.</strong>
Request was from <code>Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;</code>
to <code>control &lt;at&gt; debbugs.gnu.org</code>.
 (Thu, 31 Jan 2019 03:23:02 GMT) <a href="bugreport.cgi?bug=22793;msg=28">Full text</a> and <a href="bugreport.cgi?msg=28;mbox=yes;bug=22793">rfc822 format</a> available.</div>

<div class="msgreceived"><hr>
<a name="29"></a>
<!-- requester: Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt; -->
<!-- request_addr: control &lt;at&gt; debbugs.gnu.org -->
<!-- time:1600717922 -->
<strong>Merged <a href="bugreport.cgi?bug=22793">22793</a> <a href="bugreport.cgi?bug=32806">32806</a> <a href="bugreport.cgi?bug=34238">34238</a> <a href="bugreport.cgi?bug=42946">42946</a>.</strong>
Request was from <code>Paul Eggert &lt;eggert &lt;at&gt; cs.ucla.edu&gt;</code>
to <code>control &lt;at&gt; debbugs.gnu.org</code>.
 (Mon, 21 Sep 2020 19:52:02 GMT) <a href="bugreport.cgi?bug=22793;msg=30">Full text</a> and <a href="bugreport.cgi?mbox=yes;msg=30;bug=22793">rfc822 format</a> available.</div>

<hr>
<div class="msgreceived">This bug report was last modified 1 year and 39 days ago.</div>

<hr>
<p><a href="bugreport.cgi?bug=22792">Previous</a> <a href="bugreport.cgi?bug=22794">Next</a></p>
<!--
<p class="msgreceived">Send a report that <a href="//debbugs.gnu.org/cgi/bugspam.cgi">this bug log contains spam</a>.</p> -->
<hr>
<P>
<A HREF="//debbugs.gnu.org/">GNU bug tracking system</A><BR>
Copyright (C) 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson.
</ADDRESS>

</body>
</html>
