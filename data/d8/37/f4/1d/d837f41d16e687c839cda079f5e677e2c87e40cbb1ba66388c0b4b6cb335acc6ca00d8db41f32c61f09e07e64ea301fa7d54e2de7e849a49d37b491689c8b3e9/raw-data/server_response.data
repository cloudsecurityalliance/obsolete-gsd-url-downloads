<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1284395 - (CVE-2017-5420) Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1284395">
<meta property="og:description"
      content="RESOLVED (gijskruitbosch+bugs) in Firefox - General. Last updated 2017-05-26.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1284395 - (CVE-2017-5420) Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1284395&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1284395">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1284395">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/yui.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/global.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/util.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"tracking\":{\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox52\":\"fixed\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_status_firefox95\":\"---\"},\"project\":{\"cf_fission_milestone\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_root_cause\":\"---\",\"cf_tracking_firefox_sumo\":\"---\"}},\"types\":[\"tracking\"],\"comments\":{\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1284395;
  BUGZILLA.bug_title = '1284395 - (CVE-2017-5420) Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)';
  BUGZILLA.bug_summary = 'Show about:blank (placeholder \"Search or enter address\" in the URL bar) (spoof)';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1284395';
  BUGZILLA.bug_keywords = 'csectype-spoof, sec-low',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/field.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/comments.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1284395">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1284395"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1284395 - (CVE-2017-5420) Show about:blank (placeholder &amp;quot;Search or enter address&amp;quot; in the URL bar) (spoof)">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="KRdo5BrA7IzmyyDRplcWPQejjJo9uwES328evSXQLVlVlqlL2XK2VRJgPMatQJw0eOS3bV9cmbrl8x7gsbc4R8LlyJNi8QKhGGcNraTAtT7IEDCnNZRLnbarA0ih90ryByGsFmB25crgByGWigNDK0M8VnhuK2x8OYILivOkUBJpBL0yU8jRBrdT3ieVOKjqn7u4T22lX9AiXFAye2QGT7cQSFgbc80Bxm2EAD2SafJNYUTcJ5TbI1mbZk95Y6yt">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1284395" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623006-1fj_bgSwIKctD-edJvbPtNvSCfsQ4sszWljc2WnJaKA">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1284395" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1284395" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1284395">Bug 1284395</a>
          <span class="edit-hide">(CVE-2017-5420)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2016-07-04 22:50 PDT" data-time="1467697847">5 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2016-09-28 07:06 PDT" data-time="1475071564">5 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Firefox :: General, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Firefox" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Firefox
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Firefox</div>
            <div class="description">For bugs in  Firefox Desktop, the Mozilla Foundation's web browser. For Firefox user interface issues in menus, bookmarks, location bar, and preferences. Many Firefox bugs will either be filed here or in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Core">Core</a> product. Bugs for developer tools (F12) should be filed in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=DevTools">DevTools</a> product.  (<a href="https://wiki.mozilla.org/Modules/All#Firefox">more info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Firefox&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Firefox"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Firefox"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Firefox&component=General#General" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">General
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Firefox :: General</div>
            <div class="description">For bugs in Firefox which do not fit into other more specific Firefox components</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Firefox&amp;component=General&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Firefox&amp;component=General&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Firefox&amp;component=General"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Firefox" data-component="General"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-version"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            50 Branch

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_status_firefox52&quot;:&quot;fixed&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;keywords&quot;:[&quot;csectype-spoof&quot;,&quot;sec-low&quot;],&quot;target_milestone&quot;:&quot;Firefox 52&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;flags&quot;:[{&quot;status&quot;:&quot;-&quot;,&quot;name&quot;:&quot;qe-verify&quot;}],&quot;id&quot;:1284395,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;priority&quot;:&quot;--&quot;,&quot;resolution&quot;:&quot;FIXED&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            Firefox 52

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox52</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox52&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox52</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox52-dirty">
  <select id="cf_status_firefox52" name="cf_status_firefox52">
        <option value="fixed"
          id="v2968_cf_status_firefox52" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: qab, Assigned: Gijs)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=159069" > <span class="fna">Gijs</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=550582" > <span class="fna">qab</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_91159" ><img src="https://secure.gravatar.com/avatar/8f56e46f0120d9477f8f320991a2196a?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=91159" > <span class="fna">mossop</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="17">17 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
          <h3 class="module-subtitle" id="module-references-subtitle">
            (Depends on 1 open bug)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Opening an about:blank tab with an explicit NullPrincipal breaks the document"
   href="/show_bug.cgi?id=1315553">1315553</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"
   href="/show_bug.cgi?id=1304492">1304492</a>, <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Changing URL locations while a page is loading temporarily reverts the URL"
   href="/show_bug.cgi?id=1366203">1366203</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1284395&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1284395">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-see_also"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Right-click new tab loses URL information if site is down"
   href="/show_bug.cgi?id=1354796">1354796</a>
      </div>

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: csectype-spoof, sec-low, Whiteboard: [post-critsmash-triage][adv-main52+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2017-5420

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=csectype-spoof&amp;resolution=---">csectype-spoof</a>, 
          <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[post-critsmash-triage][adv-main52+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_455785" ><a class="email " href="/user_profile?user_id=455785" > <span class="fna">kjozwiak</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a20446492_455785"
            class="rel-time-title activity-ref"
            title="5 years ago"
        data-time="1488144339"
      >qe-verify</a>
    </td>

    <td class="flag-value">-
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_455785" ><a class="email " href="/user_profile?user_id=455785" > <span class="fna">kjozwiak</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag-1535922">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1535922-dirty">
      <select id="flag-1535922" name="flag-1535922"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
            <option value="-" selected>-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="This bug must be fixed for Firefox Sync 1.7" for="flag_type-708">blocking-fx-sync1.7</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-708-dirty">
      <select id="flag_type-708" name="flag_type-708"
        title="This bug must be fixed for Firefox Sync 1.7"
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (4 files, 3 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8767847">PoC.html</a>
        </div>
        <div>
            <a href="#c0" class="attach-time activity-ref"><span class="rel-time" title="2016-07-04 22:50 PDT" data-time="1467697847">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div></span>
        </div>
        <div class="attach-info">443 bytes,
          text/html        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8767847&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8767853">New and improved PoC</a>
        </div>
        <div>
            <a href="#c2" class="attach-time activity-ref"><span class="rel-time" title="2016-07-04 23:30 PDT" data-time="1467700243">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div></span>
        </div>
        <div class="attach-info">455 bytes,
          text/html        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8767853&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8768275"
              title="screenshot.png"
              class="lightbox">
              <img src="/extensions/BugModal/web/image.png" width="16" height="16">screenshot.png
            </a>
        </div>
        <div>
            <a href="#c11" class="attach-time activity-ref"><span class="rel-time" title="2016-07-05 20:51 PDT" data-time="1467777082">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div></span>
        </div>
        <div class="attach-info">144.03 KB,
          image/png        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8768275&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8788460">Patch v0.1</a>
        </div>
        <div>
            <a href="#c23" class="attach-time activity-ref"><span class="rel-time" title="2016-09-06 06:56 PDT" data-time="1473170219">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">19.98 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_403756" ><span class="fn">mconley</span>
</div>:
              <a href="#c27"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1473170219"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_20209" ><span class="fn">bzbarsky</span>
</div>:
              <a href="#c25"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1473170219"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8788460&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8788460&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8791412">Patch v0.2</a>
        </div>
        <div>
            <a href="#c33" class="attach-time activity-ref"><span class="rel-time" title="2016-09-14 15:00 PDT" data-time="1473890458">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">23.18 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_403756" ><span class="fn">mconley</span>
</div>:
              <a href="#c34"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1473890458"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8791412&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8791412&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8792848">Patch v0.3</a>
        </div>
        <div>
            <a href="#c43" class="attach-time activity-ref"><span class="rel-time" title="2016-09-20 03:43 PDT" data-time="1474368224">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">24.79 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_446257" ><span class="fn">baku</span>
</div>:
              <a href="#c44"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1474368224"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8792848&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8792848&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8793491">Patch v0.4</a>
        </div>
        <div>
            <a href="#c45" class="attach-time activity-ref"><span class="rel-time" title="2016-09-21 13:46 PDT" data-time="1474490774">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div></span>
        </div>
        <div class="attach-info">26.21 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_446257" ><span class="fn">baku</span>
</div>:
              <a href="#c47"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1474490774"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_403756" ><span class="fn">mconley</span>
</div>:
              <a href="#c50"
                  class="flag-name-status rel-time-title activity-ref"
                  title="5 years ago"
              data-time="1474490774"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8793491&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8793491&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="gSuXgAzVEDDPXWRWnSMKbW8S51413T0A0nruBw9zzOIK33WJ">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="11522476" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-04 22:50 PDT" data-time="1467697847">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8767847"
         class="attachment"
         data-id="8767847" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="PoC.html">
      <meta itemprop="contentSize" content="443">
      <meta itemprop="encodingFormat" content="text/html">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8767847" itemprop="contentUrl">
        <span id="att-8767847-description" itemprop="description">PoC.html</span></a>
        — <a href="attachment.cgi?id=8767847&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-0" data-comment-id="11522476">User Agent: Mozilla/5.0 (Windows NT 6.3; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36

Steps to reproduce:

Open PoC.html and follow instructions


Actual results:

Ended up with completely empty address bar


Expected results:

Main problem I think is the ability to be able to navigate to 'about:home'

So my initial expectation is that about: pages which are

a) Openable by content
b) Have an empty address bar by default

Should not be openable by content.
(So far im only aware of about:home that does this, 'about:newtab' does not meet requirement [a])


Note:

As far as I can tell, this is not a dupe of <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Full URL spoof using javascript URI scheme"
   href="/show_bug.cgi?id=1247968">Bug 1247968</a> (not fixed) or <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) using javascript URI scheme (spoof)"
   href="/show_bug.cgi?id=1228754">Bug 1228754</a> (fixed) but its worth making sure it isn't</pre></div><div class="change-set" id="c1"><div class="comment" data-id="11522478" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-04 22:54 PDT" data-time="1467698079">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="11522478">Works on latest nightly and latest stable</pre></div><div class="change-set" id="c2"><div class="comment" data-id="11522504" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-04 23:30 PDT" data-time="1467700243">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8767853"
         class="attachment"
         data-id="8767853" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="PoC.html">
      <meta itemprop="contentSize" content="455">
      <meta itemprop="encodingFormat" content="text/html">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8767853" itemprop="contentUrl">
        <span id="att-8767853-description" itemprop="description">New and improved PoC</span></a>
        — <a href="attachment.cgi?id=8767853&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-2" data-comment-id="11522504">It does not seem like about:home is needed at all.. So that's not the culprit

This PoC does not need you to manually hit back</pre></div><div class="change-set" id="c3"><div class="comment" data-id="11522783" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 02:23 PDT" data-time="1467710632">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="11522783">So the way this works is, AFAICT:

a) javascript: URL gets opened in a new tab. At this stage, document.location and document.documentURI both reflect the JS URI;
b) the JS URI returns a string of HTML containing a &lt;script&gt; that calls location.reload(). The reload gets triggered and runs the same JS URI again. When the same JS runs after that happens, both |location| and |documentURI are now about:blank (???). Note that this doesn't happen if the JS URI calls location.reload() directly. The indirection via the &quot;return value&quot; of the JS URI is somehow important.
c) the JS URI goes forward to a data: URI and then back from there.
d) now the location bar displays about:blank. That is also the principal of the page. Also, the tab spinner is permanently in the 'busy' state.

FWIW, I get the same results without steps (c) and (d), so a simpler testcase looks something like this:

data:text/html,&lt;a href=&quot;javascript:if(history.length==0){'&lt;script&gt;location.reload()&lt;/script&gt;'}else{document.write('&lt;b&gt;Spoof&lt;/b&gt;');}&quot;&gt;Please-open-in-new-tab.&lt;/a&gt;

I think this is basically an issue in DOM/docshell-land. bz and smaug are both out.

There's a number of strange things here:

1) I'd expect the initial JS URI to load against a page that's inherited the principal of the page from which we clicked the link. That might be something that we need to fix in frontend (for dealing with non-left-content-clicks) if it is fixable at all. Not entirely sure how. Mike, I don't suppose you have any ideas?
2) The location.reload() from the 'response of the js URI seems to be running against an &quot;about:blank&quot; document. I've tried reading the spec, but &quot;Setting the document's address&quot; ( <a rel="nofollow" href="https://html.spec.whatwg.org/multipage/browsers.html#set-the-document%27s-address">https://html.spec.whatwg.org/multipage/browsers.html#set-the-document%27s-address</a> ) has no internal references and so I don't understand at what point that's supposed to apply to the Document we create to process the HTML 'response' from the JS URI. I would argue it should be before script runs on the document, or any other requests to external resources are made... and that doesn't seem like it's happening. Anne, can you elucidate what the spec says we should be doing here?

3) we show a placeholder for about:blank in the location bar. A short-term mitigation would be to just stop doing that for about:blank, but I don't know that the severity of this bug warrants doing that, nor do I think it's really meaningful for users in the first place... Marco, thoughts?</pre><div class="activity"><div class="change">Group: firefox-core-security &rarr; core-security</div><div class="change">Component: Untriaged &rarr; Document Navigation</div><div class="change">Flags: needinfo?(mconley)</div><div class="change">Flags: needinfo?(mak77)</div><div class="change">Flags: needinfo?(annevk)</div><div class="change">Product: Firefox &rarr; Core</div></div></div><div class="change-set" id="c4"><div class="comment" data-id="11522828" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_102998" ><img src="https://secure.gravatar.com/avatar/09bb44ac3625a121017cd98d0a7dc52c?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_102998" ><a class="email " href="/user_profile?user_id=102998" > <span class="fna">Anne (:annevk)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 02:45 PDT" data-time="1467711918">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="11522828">Few things:

1. javascript URLs are defined inline in the navigation algorithm.
2. javascript URLs generate a response and set an override URL for that response. The override URL is that of the browsing context (the one being navigated) its active document.
3. Reload just navigates to the same URL.

So given that, ending up with no URL seems like a bug.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(annevk)</span></div></div></div><div class="change-set" id="c5"><div class="comment" data-id="11522894" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 03:22 PDT" data-time="1467714162">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="11522894">If we do this:

data:text/html,&lt;a href=&quot;javascript:if(history.length==0){'&lt;script&gt;location.reload()&lt;/script&gt;'}else{if(history.length==2){alert(location)}else{location=`<a rel="nofollow" href="https://www.facebook.com/favicon.ico">https://www.facebook.com/favicon.ico</a>`}}&quot;&gt;Please-open-in-new-tab.&lt;/a&gt;

It almost looks like we got the content from facebook, but I can't seem to find any way to read any of it, it looks all frozen. Is there potential in this?

Also, if we do a window.stop() we can fix the infinite loading + some other things and we get a rough PoC of social engineering. (note that in this case the bug where favicon is not refreshed helps a lot to sell it)

data:text/html,&lt;a href=&quot;javascript:if(history.length==0){'&lt;script&gt;location.reload()&lt;/script&gt;'}else{if(history.length==2){document.write(`&lt;b&gt;Password:&lt;/b&gt;&lt;input/type=text&gt;`);window.stop();document.title=`Facebook Login`}else{alert(`Navigate back if its not found`);location=`<a rel="nofollow" href="https://www.facebook.com/temp.ico">https://www.facebook.com/temp.ico</a>`}}&quot;&gt;Please-open-in-new-tab.&lt;/a&gt;

Also side note, sometimes nightly freezes on me when testing this area. Not sure if related, cant repro.</pre></div><div class="change-set" id="c6"><div class="comment" data-id="11522896" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 03:24 PDT" data-time="1467714247">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="11522896">Note: in the above PoC you need to manually navigate back to see full effect.</pre></div><div class="change-set" id="c7"><div class="comment" data-id="11523147" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_240353" ><img src="https://secure.gravatar.com/avatar/0d674a646529b0795088d7a8075fbaea?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_240353" ><a class="email " href="/user_profile?user_id=240353" > <span class="fna">Marco Bonardo [:mak]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 05:39 PDT" data-time="1467722382">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="11523147">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment #3</a>)
<span class="quote">&gt; 3) we show a placeholder for about:blank in the location bar. A short-term
&gt; mitigation would be to just stop doing that for about:blank, but I don't
&gt; know that the severity of this bug warrants doing that, nor do I think it's
&gt; really meaningful for users in the first place... Marco, thoughts?</span >

From an UX point of view, it seems important to me that we give hints to the user about what he can do on a completely empty page.  Honestly I'm not the best person to sign-off on removing the placeholder from about:blank, off-hand I'd say we should not remove it.
Here the problem is that this is not a really empty page, we seem to keep hitting this problem where about:blank is not really about:blank, but I don't know well enough the platform code handling this to be able to tell if there's an easy way to distinguish those cases. I was hoping <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) using javascript URI scheme (spoof)"
   href="/show_bug.cgi?id=1228754">bug 1228754</a> had helped with that.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(mak77)</span></div></div></div><div class="change-set" id="c8"><div class="comment" data-id="11523842" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 09:10 PDT" data-time="1467735041">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="11523842">(In reply to Abdulrahman Alqabandi[test] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c6">comment #6</a>)
<span class="quote">&gt; Note: in the above PoC you need to manually navigate back to see full effect.</span >

All of these still show an empty location bar for me, not one with fb.com in it, when the attacker-controlled page is displayed (rather than facebook.com's actual icon or whatever). Am I misunderstanding how this is supposed to work?</pre><div class="activity"><div class="change">Flags: needinfo?(qab)</div></div></div><div class="change-set" id="c9"><div class="comment" data-id="11523862" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 09:19 PDT" data-time="1467735559">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="11523862">(In reply to Marco Bonardo [::mak] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c7">comment #7</a>)
<span class="quote">&gt; Here the problem is that this is not a really empty page, we seem to keep
&gt; hitting this problem where about:blank is not really about:blank, but I
&gt; don't know well enough the platform code handling this to be able to tell if
&gt; there's an easy way to distinguish those cases. I was hoping <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) using javascript URI scheme (spoof)"
   href="/show_bug.cgi?id=1228754">bug 1228754</a> had
&gt; helped with that.</span >

I think it did help, just with different cases. :-)

AIUI per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c4">comment #4</a> this is just a platform bug. We shouldn't end up with a document that has an about:blank URI and principal.</pre></div><div class="change-set" id="c10"><div class="comment" data-id="11524934" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_403756" ><img src="https://secure.gravatar.com/avatar/4b4985a7acf7db49dfddd7815b55a043?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_403756" ><a class="email " href="/user_profile?user_id=403756" > <span class="fna">Mike Conley (:mconley) (:⚙️)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 14:24 PDT" data-time="1467753870">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="11524934">I'm afraid I'm not likely to be of much use here in the short term. If bz is unavailable, I could go deeper, but he's probably the shortest path to an answer.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(mconley)</span></div></div></div><div class="change-set" id="c11"><div class="comment" data-id="11525975" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-05 20:51 PDT" data-time="1467777082">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8768275"
         class="attachment"
         data-id="8768275" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="screenshot.png">
      <meta itemprop="contentSize" content="147483">
      <meta itemprop="encodingFormat" content="image/png">
      <div class="label">
        Attached image
          <a class="link lightbox" href="attachment.cgi?id=8768275" itemprop="contentUrl">
        <span id="att-8768275-description" itemprop="description">screenshot.png</span></a>
        — <a href="attachment.cgi?id=8768275&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-11" data-comment-id="11525975">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c8">comment #8</a>)
<span class="quote">&gt; (In reply to Abdulrahman Alqabandi[test] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c6">comment #6</a>)
&gt; &gt; Note: in the above PoC you need to manually navigate back to see full effect.
&gt; 
&gt; All of these still show an empty location bar for me, not one with fb.com in
&gt; it, when the attacker-controlled page is displayed (rather than
&gt; facebook.com's actual icon or whatever). Am I misunderstanding how this is
&gt; supposed to work?</span >

Location bar is still empty but (to me at least) it looks like a frozen copy of the content still exists, including the title.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(qab)</span></div></div></div><div class="change-set" id="c12"><div class="comment" data-id="11530723" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-07 07:11 PDT" data-time="1467900678">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="11530723">Boris, any idea what's going on here?</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c13"><div class="comment" data-id="11530833" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" ><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" ><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-07 07:44 PDT" data-time="1467902646">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="11530833">Reading through the last bug with the same results, is it the case that if about:blank has an opener then it will display 'about:blank' visibly? But using the middle mouse button, there is no opener thus the about:blank we end up in is hidden.

I also mentioned that about:blank should always reflect a blank document, and if it has an opener then the location should change from about:blank to the openers url. If no opener exists then you should not be able to perform document.write(). Not sure if that will break anything though.</pre></div><div class="change-set" id="c14"><div class="comment" data-id="11531149" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" ><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" ><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-07 09:18 PDT" data-time="1467908325">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="11531149">(In reply to Abdulrahman Alqabandi[test] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c13">comment #13</a>)
<span class="quote">&gt; Reading through the last bug with the same results, is it the case that if
&gt; about:blank has an opener then it will display 'about:blank' visibly? But
&gt; using the middle mouse button, there is no opener thus the about:blank we
&gt; end up in is hidden.</span >

Yes, this is (1) in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment #3</a>, kind of (ie we should have an opener / inherited principal for the middle/modifier+left mouse click).

But we shouldn't end up in an about:blank in the first place, we should keep the JS URI around, per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c4">comment #4</a> / item (2) in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment #3</a>.

<span class="quote">&gt; I also mentioned that about:blank should always reflect a blank document,
&gt; and if it has an opener then the location should change from about:blank to
&gt; the openers url.</span >

We could consider doing this, but it'd probably require some consensus with other browser makers and would provide &quot;interesting&quot; user behaviour as well (e.g. what if they go to the URL in the URL bar and hit enter? Do we load the opener or the current page? It's kind of bizarre to have a page that doesn't correspond to the URL we show in a direct sense.

<span class="quote">&gt; If no opener exists then you should not be able to perform
&gt; document.write(). Not sure if that will break anything though.</span >

I don't know that we have a way of freezing the DOM. In any case, I would expect that to break the web, just because the web is crazy. Not super-clear how this would work anyway - what happens to data: and javascript: URIs and assigning those to document.location? Well, you say, those aren't about:blank - and now we're back on the initial point: I don't think we should have a document here with an about:blank-only principal that's controlled by the JS URI.</pre></div><div class="change-set" id="a214254_1689"><div class="change" id="aa214254_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a214254_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a214254_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a214254_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a214254_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a214254_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-07 10:21 PDT" data-time="1467912101">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-spoof&amp;resolution=---">csectype-spoof</a>, 
          
            <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="11531399" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_550582" id="a214254_1689"><img src="https://secure.gravatar.com/avatar/1cea46da7dbb1ab6b82e8c1421e4ee70?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_550582" id="a214254_1689"><a class="email " href="/user_profile?user_id=550582" > <span class="fna">Abdulrahman Alqabandi</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-07 10:38 PDT" data-time="1467913102">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="11531399">Shouldn't this be sec-moderate since <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) using javascript URI scheme (spoof)"
   href="/show_bug.cgi?id=1228754">Bug 1228754</a> was also?</pre><div class="activity"><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="a319260_1689"><div class="change" id="aa319260_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a319260_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a319260_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a319260_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a319260_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-08 15:31 PDT" data-time="1468017107">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: core-security &rarr; core-security-release</div><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div></div></div><div class="change-set" id="c16"><div class="comment" data-id="11542334" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 09:24 PDT" data-time="1468340655">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="11542334">In terms of the <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment 3</a> behavior, here's what's going on.

1) The javascript: URL gets opened in a new tab.  Arguably this is already a bug; note that there is no &quot;open in new tab&quot; context menu item for javascript: links, and I don't think we should open them in new tab for modifier-click either.  Anyway, we start loading the javascript: URI via nsDocShell::LoadURIWithOptions.  This does not pass in an &quot;owner&quot; and doesn't say an explicit owner is required, so in the nsIDocShellLoadInfo version of nsDocShell::LoadURI we do:

  inheritOwner = nsContentUtils::LegacyIsCallerChromeOrNativeCode();

In this case that sets inheritOwner to true.  This is a javascript: URI, so does in fact want an inherited principal in general, so we call nsDocShell::GetInheritedPrincipal.  This returns the principal of the document in the newly created tab where we're doing the load, which is a codebase principal for &quot;about:blank&quot;.  We go ahead and run the script against the about:blank document in the new tab and it produces a document in the form of a string return value.

2) When a javascript: URL produces a document, we give it a URL that is the javascript: URL involved.  This is actually NOT what the HTML spec says to do; it says to give it a URL that is the URL of the document the javascript: is running against, iirc.

3) Anyway, now the script does a location.reload() (though I'm not sure _why_ history.length == 0 at this point!).  This performs a history navigation to a javascript: URI.  we have a special case in our history navigation code: when the navigation is to a javascript: URI we will create an about:blank document to run it against.  The reason for that is as follows.  Say I load site A, which loads a javascript: URI which produces a document which then links to site B which is known to do a history.back().  When the history.back() happens, we do NOT want to run the javascript: script against site B!  So in practice we throw our hands up in the air and CreateAboutBlankContentViewer to run the javascript: against.  Note that if we followed the HTML spec here that would amount to throwing our hands up in the air in a different way; we'd simply load the document the javascript: URL had run against and not run the javascript: at all.

4) Anyway, the javascript: runs a second time but this time history.length == 1, so it doesn't return a string.  Instead it navigates to a data: URL and then goes back and runs yet another branch that does a document.write.  As <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment 3</a> points out this part isn't really that relevant.  It's just ending up at about:blank, then doing a document.write.  The spinner is going because we did document.write on an already-loaded document and then didn't document.close().

Anyway, from Gecko's point of view none of this is fundamentally different from this testcase:

  data:text/html,&lt;div onclick=&quot;var w = window.open('about:blank'); w.setTimeout('document.write(&amp;quot;&lt;b&gt;Is this a spoof?&lt;/b&gt;&amp;quot;)', 1000);&quot;&gt;Click me&lt;/div&gt;

This testcase shows &quot;about:blank&quot; in the URL bar, though...  Why doesn't the other?

Responding to the list of &quot;strange things&quot; in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment 3</a>:

<span class="quote">&gt; I'd expect the initial JS URI to load against a page that's
&gt; inherited the principal of the page from which we clicked the link.</span >

Gecko isn't being told anything about any of that.  It's just being told to run a javascript: URL against the newly create tab, which just has an about:blank inside it so far.

<span class="quote">&gt; The location.reload() from the 'response of the js URI seems to be running against an &quot;about:blank&quot; document. </span >

So is the original execution, of course.  Anyway, see above for why this is happening, along with the differences between what we do and what the spec says to do.  In any case, per spec all the reload() would do is load about:blank and not run any more code.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c17"><div class="comment" data-id="11542339" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 09:26 PDT" data-time="1468340799">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="11542339">Oh, and note that the javascript: URL in question _sometimes_ creates a new document (by returning a string) and sometimes does _NOT_.  Which is why the URL is sometimes &quot;javascript:stuff&quot; and sometimes &quot;about:blank&quot;: the latter is when the script execution did not create a new document.</pre></div><div class="change-set" id="c18"><div class="comment" data-id="11542650" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 11:07 PDT" data-time="1468346835">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="11542650">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c16">comment #16</a>)
<span class="quote">&gt; In terms of the <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c3">comment 3</a> behavior, here's what's going on.
&gt; 
&gt; 1) The javascript: URL gets opened in a new tab.  Arguably this is already a
&gt; bug; note that there is no &quot;open in new tab&quot; context menu item for
&gt; javascript: links, and I don't think we should open them in new tab for
&gt; modifier-click either.</span >

I expect we do this because having literally nothing happen when you middle/alt/cmd-click a link is counterintuitive, as is having something happen in the current tab (if you were trying to make sure that didn't happen). It's hard to be consistent with user expectations for js links.

The other thing I noticed is that the context menu determination is made in <a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/nsContextMenu.js#942-951">http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/nsContextMenu.js#942-951</a> .

It doesn't include data: URIs which I imagine would have the same problem (but maybe not because they can't not &quot;return&quot; a document in the same way js URIs can?).

<span class="quote">&gt; Anyway, we start loading the javascript: URI via
&gt; nsDocShell::LoadURIWithOptions.  This does not pass in an &quot;owner&quot; and
&gt; doesn't say an explicit owner is required, so in the nsIDocShellLoadInfo
&gt; version of nsDocShell::LoadURI we do:
&gt; 
&gt;   inheritOwner = nsContentUtils::LegacyIsCallerChromeOrNativeCode();
&gt; 
&gt; In this case that sets inheritOwner to true.</span >

This seems wrong. We should make sure that our chrome-js-based thing that deals with loading web content in tabs/windows based on clicks doesn't trigger 'caller is chrome'... :-\
Is there a &quot;manual&quot; way to avoid doing this?

<span class="quote">&gt;  This is a javascript: URI, so
&gt; does in fact want an inherited principal in general, so we call
&gt; nsDocShell::GetInheritedPrincipal.  This returns the principal of the
&gt; document in the newly created tab where we're doing the load, which is a
&gt; codebase principal for &quot;about:blank&quot;.  We go ahead and run the script
&gt; against the about:blank document in the new tab and it produces a document
&gt; in the form of a string return value.</span >

Is there something chrome JS (which is what's handling the click) can do here to make it inherit the principal of the linking page instead? Pass a principal to loadURI or whatever? Should we manually call createAboutBlankContentViewer (yay xpcom) on the docshell (with the originating page's principal as the argument) and then load the js/data URI? Feels like there should be a better way...

<span class="quote">&gt; 2) When a javascript: URL produces a document, we give it a URL that is the
&gt; javascript: URL involved.  This is actually NOT what the HTML spec says to
&gt; do; it says to give it a URL that is the URL of the document the javascript:
&gt; is running against, iirc.
&gt; 
&gt; 3) Anyway, now the script does a location.reload() (though I'm not sure
&gt; _why_ history.length == 0 at this point!).</span >

Yeah, this might be a separate bug. I'd like to sort out the spoof / security stuff first though - you could accomplish the same branching in other ways, I expect.

<span class="quote">&gt;  This performs a history
&gt; navigation to a javascript: URI.  we have a special case in our history
&gt; navigation code: when the navigation is to a javascript: URI we will create
&gt; an about:blank document to run it against.  The reason for that is as
&gt; follows.  Say I load site A, which loads a javascript: URI which produces a
&gt; document which then links to site B which is known to do a history.back(). 
&gt; When the history.back() happens, we do NOT want to run the javascript:
&gt; script against site B!  So in practice we throw our hands up in the air and
&gt; CreateAboutBlankContentViewer to run the javascript: against.  Note that if
&gt; we followed the HTML spec here that would amount to throwing our hands up in
&gt; the air in a different way; we'd simply load the document the javascript:
&gt; URL had run against and not run the javascript: at all.</span >

Where does this live, and can we make it just create the about:blank viewer and then do nothing? Feels like that wouldn't break anything we care about, I hope... (maybe vainly... the web is weird?)

<span class="quote">&gt; Anyway, from Gecko's point of view none of this is fundamentally different
&gt; from this testcase:
&gt; 
&gt;   data:text/html,&lt;div onclick=&quot;var w = window.open('about:blank');
&gt; w.setTimeout('document.write(&amp;quot;&lt;b&gt;Is this a spoof?&lt;/b&gt;&amp;quot;)',
&gt; 1000);&quot;&gt;Click me&lt;/div&gt;
&gt; 
&gt; This testcase shows &quot;about:blank&quot; in the URL bar, though...  Why doesn't the
&gt; other?</span >

This testcase will have browser.hasContentOpener be true (ie window.opener is non-null), in which case we show about:blank: 

<a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/browser.js#6451">http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/browser/base/content/browser.js#6451</a>

The one from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c0">comment #0</a> / this bug doesn't because the new window is not generated by web content / window.open, but by the browser &quot;manually&quot; opening a new tab/window/whatever and loading the URL in there.

<span class="quote">&gt; &gt; The location.reload() from the 'response of the js URI seems to be running against an &quot;about:blank&quot; document. 
&gt; 
&gt; So is the original execution, of course.  Anyway, see above for why this is
&gt; happening, along with the differences between what we do and what the spec
&gt; says to do.  In any case, per spec all the reload() would do is load
&gt; about:blank and not run any more code.</span >

Right. I think this is identical to what I asked earlier. Is this difficult to do?

Feels like the following could be improved:
1) make browser code tell gecko something that'd set up the right principal to begin with
2) make browser code tell gecko something that'd pass the original tab as 'owner' - maybe? What does that do, and do we want it? (e.g. don't want opening link from mozilla.org to google.com in a new tab give google.com a ref to mozilla.org as 'opener' so it can navigate that tab - maybe it should only happen for inherit_principal URIs, and only if not opening in a different container / private browsing context ?)
3) browser code loading links from the web in tabs shouldn't trigger 'is chrome' caller checks... I think? Maybe I'm being too paranoid?
4) reloading js URIs should just load about:blank
5) can browser code tell gecko something that'd make inherit_principal URIs have a window.opener when opened in a new tab/window that isn't in a different container / pb context?

Because of private browsing / containers, I think (2) and (5) might not necessarily be sufficient/helpful. I'm not sure (3) even makes sense. So I *think* doing both (1) and (4) is our best chance for fixing the spoofing in that we should be able to tell we can't show a clear location bar where remote web content controls the page (and perhaps, in the future, we can show an origin'd thing instead of the string &quot;about:blank&quot;). We need (1) because otherwise, AIUI, we might still not show the right thing if there aren't any location.reload()s or whatever. We need (4) because otherwise the location.reload does something wonky. Is that right? Am I missing something or is my reasoning broken in places (probably!)?</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c19"><div class="comment" data-id="11542706" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 11:30 PDT" data-time="1468348219">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="11542706"><span class="quote">&gt; It doesn't include data: URIs which I imagine would have the same problem </span >

Not entirely, because they just produce a document and don't involve interacting with another one to do so, unlike javascript:.  There are literally zero use cases I can think of for taking a javascript: link in a page and running it against a new about:blank tab....

<span class="quote">&gt; We should make sure that our chrome-js-based thing that deals with loading
&gt; web content in tabs/windows based on clicks doesn't trigger 'caller is chrome'</span >

That's a bit tough.  Also, why would you want that?

Anyway, in this case the only practical impact would be to not inherit the owner, so you can just pass LOAD_FLAGS_DISALLOW_INHERIT_OWNER to accomplish that in this case, I would think.

<span class="quote">&gt; Is there something chrome JS (which is what's handling the click)
&gt; can do here to make it inherit the principal of the linking page instead?</span >

Looks like right now the answer is &quot;no&quot; for the load directly, because nsIDocShell::loadURI is noscript.  We could add another scriptable API on nsIDocShell or nsIWebNavigation that allowed one to do this.

However note that in this case what that would simply make the javascript: not run because its principal would not match that of the about:blank involved so Gecko would disallow its execution.  Maybe that's fine, though.  Again, the use cases for modifier-click on a javascript: URL seem pretty slim to me.

<span class="quote">&gt; Should we manually call createAboutBlankContentViewer (yay xpcom) on
&gt; the docshell (with the originating page's principal as the argument)</span >

That would work, yes.  I agree it's a bit action-at-a-distance.

<span class="quote">&gt; Where does this live, and can we make it just create the about:blank viewer and then do nothing?</span >

Where does which live?  The history traversal to javascript: hack?  That's at <a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/docshell/base/nsDocShell.cpp#12314">http://searchfox.org/mozilla-central/rev/c44d0b1673fef5e0e2e19fa82d6780a74c186151/docshell/base/nsDocShell.cpp#12314</a>

<span class="quote">&gt; maybe vainly... the web is weird?</span >

Indeed.  If we're going to change anything about this stuff, I'd rather we just aligned the URI of the document for the result string of javascript: with the spec and other browsers.

<span class="quote">&gt; This testcase will have browser.hasContentOpener be true (ie window.opener is non-null)</span >

Should that be true for things resulting from modifier-click too?

<span class="quote">&gt; Is this difficult to do?</span >

I assume you mean aligning with the spec in terms of the URL that the javascript: result document has.  Apart from some thinking about security and auditing all our code for places where we check for &quot;javascript&quot; as a URL, probably not that hard, really.  We'd basically have to treat it more as an internal redirect or something in the jschannel (i.e. actually send redirect notifications).  That might have problems; not sure.

<span class="quote">&gt; What does that do, and do we want it?</span >

It [the owner] sets the principal to use for things that inherit principal (javascript: and data:, mostly).  It doesn't involve having a window.opener backref.

<span class="quote">&gt; 4) reloading js URIs should just load about:blank</span >

Again, the right thing here is to never have js URIs as a thing you can &quot;reload&quot;.

<span class="quote">&gt; can browser code tell gecko something that'd make inherit_principal URIs
&gt; have a window.opener when opened in a new tab/window </span >

So basically treat modifier-click as more like &quot;the link had target=_blank&quot;?</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c20"><div class="comment" data-id="11543453" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 15:27 PDT" data-time="1468362425">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="11543453">Preamble in case this is helpful: here are the parameters with which I'm trying to work:
A) user manually typing about:blank in the location bar (proxy for: setting about:blank as their new tab page) should result in an empty location bar
B) any web-controlled about:blank page should not result in an empty location bar

I'm bearing in mind that:
- window.open(...) is one of the cases where web content can control about:blank, but AIUI even besides this bug there are other such cases. That is, it is possible for web content to have a content-controlled toplevel about:blank document without that document having an opener (am I wrong in the latter respect?)
- window.opener can be used for evil, there are non-trivial rules governing when it's set, and per the previous point, it's unreliable as an indicator of whether about:blank is controlled by content (see also <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) using javascript URI scheme (spoof)"
   href="/show_bug.cgi?id=1228754">bug 1228754</a>) so it's not sufficient for determining that such a document exists.


AIUI the problem in this case is that browser code is treating the testcase as (A) when it should be treating it as (B).

The reason for this is that the document principal of the loaded document after the js-triggered location.reload() has the URI of about:blank, the document has no opener, and the document URI (docshell.currentURI / content.document.documentURI) is also about:blank. We need to make sure that one of these things happens:

1) we don't let you open the js URL this way
2) the principal's URI and the document URI should not both be about:blank - both before and after the reload()
3) the principal's URI and the document URI should not both be about:blank before the reload and (i) the reload is disallowed or a no-op; or (ii) the reload results in a non-web-controlled about:blank loading.

1) is hard from my perspective because it's a behaviour change that has UX implications, and not one I feel I could just make unilaterally (whatever we do - Safari does nothing, and Chrome opens about:blank, haven't checked IE/Edge). We'd need to consult UX about what to do and that's a whole general debate about what to do with the js URL, which is ancient (<a class="bz_bug_link
          bz_status_REOPENED"
   title="REOPENED - &quot;open link in new tab&quot; (middle or ctrl click) doesn't work for javascript links"
   href="/show_bug.cgi?id=138198">bug 138198</a>), and I'm worried we'll get stuck in weeds trying to just get anything that's better than the current solution while people try and get The Perfect Thing (whatever that is). So I'd prefer a more short-term fix, but if we think that just removing support is easier I can file a public bug and try to poke UX folks.

I don't know which is easier between 2 and 3 and/or if I'm misunderstanding the problem completely.



(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c19">comment #19</a>)
<span class="quote">&gt; &gt; Is there something chrome JS (which is what's handling the click)
&gt; &gt; can do here to make it inherit the principal of the linking page instead?
&gt; 
&gt; Looks like right now the answer is &quot;no&quot; for the load directly, because
&gt; nsIDocShell::loadURI is noscript.  We could add another scriptable API on
&gt; nsIDocShell or nsIWebNavigation that allowed one to do this.
&gt; 
&gt; However note that in this case what that would simply make the javascript:
&gt; not run because its principal would not match that of the about:blank
&gt; involved so Gecko would disallow its execution.  Maybe that's fine, though. 
&gt; Again, the use cases for modifier-click on a javascript: URL seem pretty
&gt; slim to me.</span >

My suggestion was that the about:blank should have the linking page's principal, and that the JS should inherit principal from that about:blank-with-linking-page's-principal. In which case I'd expect it to &quot;work&quot;. Am I missing something?

And I agree the usecases are slim. If this is a giant engineering project we should come up with a simpler solution. If it's a few lines of code and it fixes this bug, good enough for me.

<span class="quote">&gt; Indeed.  If we're going to change anything about this stuff, I'd rather we
&gt; just aligned the URI of the document for the result string of javascript:
&gt; with the spec and other browsers.</span >

So, to be clear, this is saying the URI of the document of the `&lt;script&gt;location.reload()&lt;/script&gt;` and the result of the reload should all be the javascript: URI?

<span class="quote">&gt; &gt; This testcase will have browser.hasContentOpener be true (ie window.opener is non-null)
&gt; 
&gt; Should that be true for things resulting from modifier-click too?</span >

&quot;It depends&quot;. Likely not for e.g. noreferrer/noopener and maybe others. I don't think we can rely on it exclusively. :-(

<span class="quote">&gt; &gt; Is this difficult to do?
&gt; 
&gt; I assume you mean aligning with the spec in terms of the URL that the
&gt; javascript: result document has.  Apart from some thinking about security
&gt; and auditing all our code for places where we check for &quot;javascript&quot; as a
&gt; URL, probably not that hard, really.  We'd basically have to treat it more
&gt; as an internal redirect or something in the jschannel (i.e. actually send
&gt; redirect notifications).  That might have problems; not sure.</span >

So I'm confused. Looking at clicking the link in:

data:text/html,&lt;a href=&quot;javascript:if(true){'&lt;p&gt;Hi&lt;/p&gt;'}&quot;&gt;click&lt;/a&gt;

the document.documentURI of the resulting tab is already javascript:... (and so the location bar shows the js URI rather than about:blank, as the document's principal is about:blank but the document's URI isn't)

That seems correct per what you're saying / the spec. Right? So do we &quot;just&quot; need to make reload() not work / produce a 'plain' non-web-controlled about:blank / produce a document with a JS URI too? Am I still missing the point?

<span class="quote">&gt; &gt; 4) reloading js URIs should just load about:blank
&gt; 
&gt; Again, the right thing here is to never have js URIs as a thing you can
&gt; &quot;reload&quot;.</span >

What happens in this case, then? location.reload throws an exception? Or something else?

<span class="quote">&gt; &gt; can browser code tell gecko something that'd make inherit_principal URIs
&gt; &gt; have a window.opener when opened in a new tab/window 
&gt; 
&gt; So basically treat modifier-click as more like &quot;the link had target=_blank&quot;?</span >

Well, it'd only work for new tab/window with the same container / private browsing, and I'd probably want to limit it to inherit_principal URIs. With those caveats, yes. Because of the caveats, not sure that fixes the issue fully.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="11543944" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-12 21:18 PDT" data-time="1468383538">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="11543944"><span class="quote">&gt; it is possible for web content to have a content-controlled toplevel
&gt; about:blank document without that document having an opener</span >

Sure.  Consider a page A that window.opens page B (same-origin with A).  Then B does opener.location.href = &quot;about:blank&quot;.

I was going to suggest that we simply check whether the principal URI is &quot;about:blank&quot;.  But of course the whole point of this bug is that this is exactly the situation we end up in, because we execute a web-provided javascript: URI against a browser-created about:blank document.

<span class="quote">&gt; 2) the principal's URI and the document URI should not both be about:blank -
&gt; both before and after the reload()</span >

The reload() call preserves the principal's URI.  So if it's not about:blank before the reload(), it won't be after either.

<span class="quote">&gt; I don't know which is easier between 2 and 3 and/or if I'm misunderstanding the
&gt; problem completely.</span >

I think your understanding of the problem is correct.

Right now, the principal's URI and document URI can both be trivially about:blank before the reload, or indeed without any reload.  Just do this:

  data:text/html,&lt;a href=&quot;javascript:document.write('spoof'); void(0);&quot;&gt;Middle-click me&lt;/a&gt;

Given that, we can aim to fix the pre-reload state principal or the pre-reload state URL.  The reload preserves the former and would preserve the latter if it were not &quot;javascript:&quot;.  In the short term, I expect simply using a non-about:blank principal for the pre-reload state is the simplest thing, but that would need to be done in the frontend...  Longer term... well, longer-term once we changed to follow the spec for URLs resulting from javascript: evaluation the URL will be that of the document the evaluation happened in, so it would be about:blank.  So the principal change is the only one that fixes things here.

<span class="quote">&gt; My suggestion was that the about:blank should have the linking page's principal</span >

That should work, yes.

<span class="quote">&gt; So, to be clear, this is saying the URI of the document of the
&gt; `&lt;script&gt;location.reload()&lt;/script&gt;` and the result of the reload should all be
&gt; the javascript: URI?</span >

No, they should all be &quot;about:blank&quot; per spec.  The only thing it would fix is that the reload() would actually load about:blank and not run any script on it.  But as my example above shows, we don't even need the reload().

<span class="quote">&gt; data:text/html,&lt;a href=&quot;javascript:if(true){'&lt;p&gt;Hi&lt;/p&gt;'}&quot;&gt;click&lt;/a&gt;
&gt; the document.documentURI of the resulting tab is already javascript:</span >

Per spec it shouldn't be.

<span class="quote">&gt; What happens in this case, then?</span >

The spec has no concept of a document with a &quot;javascript:&quot; URI.  There is simply no such thing.  A &quot;javascript:&quot; URI, in the spec, is just something that gets handled in a special hack in the navigation code, and produces a document with some other URI, if it produces a document at all.</pre></div><div class="change-set" id="c22"><div class="comment" data-id="11544375" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-07-13 02:03 PDT" data-time="1468400593">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="11544375">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c21">comment #21</a>)
<span class="quote">&gt; Given that, we can aim to fix the pre-reload state principal or the
&gt; pre-reload state URL.  The reload preserves the former and would preserve
&gt; the latter if it were not &quot;javascript:&quot;.  In the short term, I expect simply
&gt; using a non-about:blank principal for the pre-reload state is the simplest
&gt; thing, but that would need to be done in the frontend...  </span >

I'll try and look at this in the near-ish future, then. Thanks!</pre><div class="activity"><div class="change">Assignee: nobody &rarr; gijskruitbosch+bugs</div><div class="change">Status: UNCONFIRMED &rarr; ASSIGNED</div><div class="change">Component: Document Navigation &rarr; General</div><div class="change">Ever confirmed: true</div><div class="change">Product: Core &rarr; Firefox</div></div></div><div class="change-set" id="c23"><div class="comment" data-id="11688417" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-06 06:56 PDT" data-time="1473170219">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8788460"
         class="attachment patch obsolete"
         data-id="8788460" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aboutblank-viewer.txt">
      <meta itemprop="contentSize" content="20462">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8788460">
          <a class="link" href="attachment.cgi?id=8788460&amp;action=diff">
        <span id="att-8788460-description" itemprop="description">Patch v0.1</span></a> (obsolete)
        — <a href="attachment.cgi?id=8788460&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8788460">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-23" data-comment-id="11688417">I believe this works.

The gist of it is that for content clicks and context menu opening of links, we pass the principal of the page with the link to openLinkIn, and then all the way down into addTab code, and then we use that code to inherit the principal of the linking page into the about:blank viewer we create.

The net result is that we display &quot;about:blank&quot; in the URL bar for the testcase on this bug, when we previously cleared the URL bar.

<a class="bz_bug_link
          bz_status_NEW"
   title="NEW"
   href="/show_bug.cgi?id=1297008">bug 1297008</a> would independently change what we do in these cases to display a/the URI associated with the principal that controls the about:blank viewer, but is orthogonal to this patch.

I'm also not trying to address issues with the 'spinner' in the tab, which I suspect could be dealt with in a non-sec-sensitive bug with non-&quot;malicious&quot;-JS.


I'm not very happy with the complexity the patch adds, but I suspect we might be wanting the principal stuff anyway for things like <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Investigate TriggeringPrincipal for toplevel docshell loads where URL is typed into address bar"
   href="/show_bug.cgi?id=1289097">bug 1289097</a>. I'd be curious if this looks right to you both, Boris and Mike.

NB: in case it wasn't obvious from the patch: the window opening (rather than tab) path ends up calling loadURI to call openLinkIn to open a link in the current tab, and to avoid always creating a new about:blank viewer in that tab, I'm specialcasing the case where this is triggered through window opening to create said new content viewer. I hope this makes sense.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8788460&amp;action=edit"
           title="Patch v0.1"
           class=""
        >Attachment #8788460</a> -
        Flags: review?(mconley)</div><div class="change">
        <a href="/attachment.cgi?id=8788460&amp;action=edit"
           title="Patch v0.1"
           class=""
        >Attachment #8788460</a> -
        Flags: review?(bzbarsky)</div></div></div><div class="change-set" id="c24"><div class="comment" data-id="11688426" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-06 06:58 PDT" data-time="1473170325">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="11688426">Orthogonal: the context menu options to open links in a new tab/window/whatever is not available for javascript: links.

Perhaps a simpler solution would be to make middle/modifier-clicks on such links no-op? Though that feels like it has a UX impact, and could potentially break actual usecases (though they'd be a little byzantine).</pre></div><div class="change-set" id="c25"><div class="comment" data-id="11689149" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-06 10:22 PDT" data-time="1473182536">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="11689149">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>
Patch v0.1

<span class="quote">&gt;+      json.originPrincipal = ownerDoc.nodePrincipal;</span >

How is that supposed to work?  Is the thing being sent not really json?

Modulo that, r=me on the general idea, but I don't know enough about the details of these codepaths to say something intelligent.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8788460&amp;action=edit"
           title="Patch v0.1"
           class=""
        >Attachment #8788460</a> -
        Flags: review?(bzbarsky) &rarr; review+</div></div></div><div class="change-set" id="c26"><div class="comment" data-id="11689245" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-06 10:50 PDT" data-time="1473184254">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="11689245">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>
Patch v0.1

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>:
-----------------------------------------------------------------

::: browser/base/content/content.js
&#64;&#64; +502,5 &#64;&#64;
<span class="quote">&gt;            sm.checkSameOriginURI(docshell.mixedContentChannel.URI, targetURI, false);
&gt;            json.allowMixedContent = true;
&gt;          } catch (e) {}
&gt;        }
&gt; +      json.originPrincipal = ownerDoc.nodePrincipal;</span >

AIUI this is all structured clone stuff for e10s, which should be able to deal with serializing and deserializing nsIURI and nsIPrincipal objects... mconley should be able to confirm?

Separately, I think this assignment might need to be outside (before) this particular if block to cover the 'middle click as paste to navigate' case as well.</pre></div><div class="change-set" id="c27"><div class="comment" data-id="11689792" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_403756" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/4b4985a7acf7db49dfddd7815b55a043?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_403756" id="a319260_1689"><a class="email " href="/user_profile?user_id=403756" > <span class="fna">Mike Conley (:mconley) (:⚙️)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-06 13:33 PDT" data-time="1473193999">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="11689792">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>
Patch v0.1

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>:
-----------------------------------------------------------------

Thanks Gijs. Would it be possible to add a regression test?

(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c26">comment #26</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>
&gt; Patch v0.1
&gt; 
&gt; Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>:
&gt; -----------------------------------------------------------------
&gt; 
&gt; ::: browser/base/content/content.js
&gt; &#64;&#64; +502,5 &#64;&#64;
&gt; &gt;            sm.checkSameOriginURI(docshell.mixedContentChannel.URI, targetURI, false);
&gt; &gt;            json.allowMixedContent = true;
&gt; &gt;          } catch (e) {}
&gt; &gt;        }
&gt; &gt; +      json.originPrincipal = ownerDoc.nodePrincipal;
&gt; 
&gt; AIUI this is all structured clone stuff for e10s, which should be able to
&gt; deal with serializing and deserializing nsIURI and nsIPrincipal objects...
&gt; mconley should be able to confirm?</span >

Yep - billm added this capability in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Allow principals to be sent with the message manager"
   href="/show_bug.cgi?id=1032592">bug 1032592</a>.

::: browser/base/content/tabbrowser.xml
&#64;&#64; +2081,5 &#64;&#64;
<span class="quote">&gt;              var evt = new CustomEvent(&quot;TabOpen&quot;, { bubbles: true, detail });
&gt;              t.dispatchEvent(evt);
&gt;  
&gt; +            if (!usingPreloadedContent &amp;&amp; aOriginPrincipal) {
&gt; +              b.createAboutBlankContentViewer(aOriginPrincipal);</span >

Hrm. Hopefully this new work doesn't burn us on some of our talos tests...

::: toolkit/content/widgets/browser.xml
&#64;&#64; +1043,5 &#64;&#64;
<span class="quote">&gt; +      &lt;method name=&quot;createAboutBlankContentViewer&quot;&gt;
&gt; +        &lt;parameter name=&quot;aPrincipal&quot;/&gt;
&gt; +        &lt;body&gt;
&gt; +          &lt;![CDATA[
&gt; +            this.docShell.createAboutBlankContentViewer(aPrincipal);</span >

We could alternatively use the shared browser-content.js so that both remote and non-remote browsers share the same codepath for this. I don't mind either way, tbh.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8788460&amp;action=edit"
           title="Patch v0.1"
           class=""
        >Attachment #8788460</a> -
        Flags: review?(mconley) &rarr; review+</div></div></div><div class="change-set" id="c28"><div class="comment" data-id="11695624" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-08 08:29 PDT" data-time="1473348577">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="11695624">(In reply to Mike Conley (:mconley) - (Digging through needinfos and reviews) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c27">comment #27</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>
&gt; Patch v0.1
&gt; 
&gt; Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8788460" name="attach_8788460" title="Patch v0.1">attachment 8788460</a> <a href="/attachment.cgi?id=8788460&amp;action=edit" title="Patch v0.1">[details]</a> <a href="/attachment.cgi?id=8788460&amp;action=diff" title="Patch v0.1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8788460'>[review]</a>:
&gt; -----------------------------------------------------------------
&gt; 
&gt; Thanks Gijs. Would it be possible to add a regression test?</span >

Maybe. I'll have a look.

<span class="quote">&gt; (In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c26">comment #26</a>)
&gt; ::: browser/base/content/tabbrowser.xml
&gt; &#64;&#64; +2081,5 &#64;&#64;
&gt; &gt;              var evt = new CustomEvent(&quot;TabOpen&quot;, { bubbles: true, detail });
&gt; &gt;              t.dispatchEvent(evt);
&gt; &gt;  
&gt; &gt; +            if (!usingPreloadedContent &amp;&amp; aOriginPrincipal) {
&gt; &gt; +              b.createAboutBlankContentViewer(aOriginPrincipal);
&gt; 
&gt; Hrm. Hopefully this new work doesn't burn us on some of our talos tests...</span >

I would assume they don't go through the tab opening code path via content clicks.

Of course, where it does impact perf in those cases, this would still be a concern even if talos didn't measure it.

Boris, would it be safe to restrict this &quot;create our own viewer&quot; malarkey to cases where we know the URL is going to inherit, and if so, what's the correct way to determine that?</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c29"><div class="comment" data-id="11696314" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-08 11:27 PDT" data-time="1473359264">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="11696314">You can determine that by checking for the URI_INHERITS_SECURITY_CONTEXT flag.  Though there's some weirdness around about:blank, which does not have that flag but _can_ inherit...

For whether it's safe...  I'm not sure what problem the createAboutBlankContentViewer() call is trying to solve, so can't tell you for sure.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c30"><div class="comment" data-id="11697000" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-08 15:07 PDT" data-time="1473372452">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-30" data-comment-id="11697000">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c29">comment #29</a>)
<span class="quote">&gt; You can determine that by checking for the URI_INHERITS_SECURITY_CONTEXT
&gt; flag.  Though there's some weirdness around about:blank, which does not have
&gt; that flag but _can_ inherit...</span >

Good to know.

<span class="quote">&gt; For whether it's safe...  I'm not sure what problem the
&gt; createAboutBlankContentViewer() call is trying to solve, so can't tell you
&gt; for sure.</span >

Well, this:

(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c22">comment #22</a>)
<span class="quote">&gt; (In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c21">comment #21</a>)
&gt; &gt; Given that, we can aim to fix the pre-reload state principal or the
&gt; &gt; pre-reload state URL.  The reload preserves the former and would preserve
&gt; &gt; the latter if it were not &quot;javascript:&quot;.  In the short term, I expect simply
&gt; &gt; using a non-about:blank principal for the pre-reload state is the simplest
&gt; &gt; thing, but that would need to be done in the frontend...  
&gt; 
&gt; I'll try and look at this in the near-ish future, then. Thanks!</span >

In order to get a non-about:blank principal (for the javascript:foo URI we're loading in the new tab), I'm making the about:blank window (content viewer) inherit the principal of the page on which the user clicks the js:foo link. Does that make sense? The case we're trying to avoid is where js: or data: URIs inherit the principal of the new about:blank tab/window in which they're being opened, AIUI. Is there a better way to accomplish this? (ni for this)

But really, maybe it's worth doing some more digging here. In particular, I suspect (but haven't tested) that one can't currently do the same thing with a data: URI as the testcase here does, given sufficient messings-about (e.g. having the data URI set location.href to a javascript: URI which then does whatever it's doing here, etc.). There are some... odd... specialcases in the JS code here for javascript: URIs going through openLinkIn, which I suspect are from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Strip &quot;javascript:&quot; on paste instead of disallowing javascript: URLs entered into the location bar from inheriting the current page's principal"
   href="/show_bug.cgi?id=1018154">bug 1018154</a>. I'll have to dig into it more next week. :-\</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c31"><div class="comment" data-id="11697489" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-08 19:22 PDT" data-time="1473387721">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="11697489">OK.  So this is specific to the case when we have just opened a new tab, right?

In an ideal world, what we would do is just tell it what principal to use for its about:blank when we create the docshell.  But in practice, the createAboutBlankContentViewer call you have may well be fine, if it happens before we create the initial about:blank.  It's extra work if we do it _after_ that, but it's not really that much work compared to the general work to set up a new docshell...  and if we do care to optimize it we can add some way to hand the principal to the docshell before the initial about:blank is created.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c32"><div class="comment" data-id="11705757" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-13 04:21 PDT" data-time="1473765709">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="11705757">(In reply to Boris Zbarsky [:bz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c31">comment #31</a>)
<span class="quote">&gt; OK.  So this is specific to the case when we have just opened a new tab,
&gt; right?</span >

Well, or a new (private/non-private) window. But more or less &quot;yes&quot;, especially to &quot;have just created / are just creating a new content docshell&quot;.

<span class="quote">&gt; In an ideal world, what we would do is just tell it what principal to use
&gt; for its about:blank when we create the docshell.  But in practice, the
&gt; createAboutBlankContentViewer call you have may well be fine, if it happens
&gt; before we create the initial about:blank.</span >

I... doubt it's before that, but OK.

<span class="quote">&gt;  It's extra work if we do it
&gt; _after_ that, but it's not really that much work compared to the general
&gt; work to set up a new docshell...  and if we do care to optimize it we can
&gt; add some way to hand the principal to the docshell before the initial
&gt; about:blank is created.</span >

Fair. Let's just try how this goes and we can see if anybody (esp. perf test infra) notices anything.

I still need to write a regression test per <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c27">comment #27</a>.</pre></div><div class="change-set" id="c33"><div class="comment" data-id="11711075" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-14 15:00 PDT" data-time="1473890458">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8791412"
         class="attachment patch obsolete"
         data-id="8791412" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aboutblank-viewer.txt">
      <meta itemprop="contentSize" content="23732">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8791412">
          <a class="link" href="attachment.cgi?id=8791412&amp;action=diff">
        <span id="att-8791412-description" itemprop="description">Patch v0.2</span></a> (obsolete)
        — <a href="attachment.cgi?id=8791412&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8791412">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-33" data-comment-id="11711075">Now with test. I also had to declare a variable in tabbrowser.xml that I missed (oops).</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8788460&amp;action=edit"
           title="Patch v0.1"
           class=""
        >Attachment #8788460</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8791412&amp;action=edit"
           title="Patch v0.2"
           class=""
        >Attachment #8791412</a> -
        Flags: review?(mconley)</div></div></div><div class="change-set" id="c34"><div class="comment" data-id="11715872" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_403756" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/4b4985a7acf7db49dfddd7815b55a043?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_403756" id="a319260_1689"><a class="email " href="/user_profile?user_id=403756" > <span class="fna">Mike Conley (:mconley) (:⚙️)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-16 10:49 PDT" data-time="1474048161">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="11715872">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8791412" name="attach_8791412" title="Patch v0.2">attachment 8791412</a> <a href="/attachment.cgi?id=8791412&amp;action=edit" title="Patch v0.2">[details]</a> <a href="/attachment.cgi?id=8791412&amp;action=diff" title="Patch v0.2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8791412'>[review]</a>
Patch v0.2

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8791412" name="attach_8791412" title="Patch v0.2">attachment 8791412</a> <a href="/attachment.cgi?id=8791412&amp;action=edit" title="Patch v0.2">[details]</a> <a href="/attachment.cgi?id=8791412&amp;action=diff" title="Patch v0.2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8791412'>[review]</a>:
-----------------------------------------------------------------

This looks okay to me. And I definitely think it makes sense to be passing the principal around like this anyways - I'm actually surprised we weren't doing that before.

::: browser/base/content/tabbrowser.xml
&#64;&#64; +2098,5 &#64;&#64;
<span class="quote">&gt;              var evt = new CustomEvent(&quot;TabOpen&quot;, { bubbles: true, detail });
&gt;              t.dispatchEvent(evt);
&gt;  
&gt; +            if (!usingPreloadedContent &amp;&amp; aOriginPrincipal) {
&gt; +              b.createAboutBlankContentViewer(aOriginPrincipal);</span >

I wonder if this is going to cause any Talos regressions...

::: browser/base/content/test/general/browser_modifiedclick_inherit_principal.js
&#64;&#64; +3,5 &#64;&#64;
<span class="quote">&gt; +const kURL =
&gt; +  &quot;<a rel="nofollow" href="http://example.com/browser/browser/base/content/test/general/dummy_page.html">http://example.com/browser/browser/base/content/test/general/dummy_page.html</a>&quot;;
&gt; +  &quot;data:text/html,&lt;a href=''&gt;Middle-click me&lt;/a&gt;&quot;;
&gt; +
&gt; +add_task(function* () {</span >

Please add a comment at the top here about what exactly is being tested.

&#64;&#64; +17,5 &#64;&#64;
<span class="quote">&gt; +   yield BrowserTestUtils.synthesizeMouseAtCenter(&quot;a&quot;, {button: 1}, browser);
&gt; +   let newTab = yield newTabPromise;
&gt; +   is(newTab.linkedBrowser.contentPrincipal.origin, &quot;<a rel="nofollow" href="http://example.com">http://example.com</a>&quot;,
&gt; +      &quot;Principal should be for example.com&quot;);
&gt; +   yield BrowserTestUtils.removeTab(newTab);</span >

Should we be testing the URL bar here as well?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8791412&amp;action=edit"
           title="Patch v0.2"
           class=""
        >Attachment #8791412</a> -
        Flags: review?(mconley) &rarr; review+</div></div></div><div class="change-set" id="c35"><div class="comment" data-id="11719170" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 05:28 PDT" data-time="1474288109">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="11719170">(In reply to Mike Conley (:mconley) - (needinfo me!) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c34">comment #34</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8791412" name="attach_8791412" title="Patch v0.2">attachment 8791412</a> <a href="/attachment.cgi?id=8791412&amp;action=edit" title="Patch v0.2">[details]</a> <a href="/attachment.cgi?id=8791412&amp;action=diff" title="Patch v0.2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8791412'>[review]</a>
&gt; Patch v0.2
&gt; 
&gt; Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8791412" name="attach_8791412" title="Patch v0.2">attachment 8791412</a> <a href="/attachment.cgi?id=8791412&amp;action=edit" title="Patch v0.2">[details]</a> <a href="/attachment.cgi?id=8791412&amp;action=diff" title="Patch v0.2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8791412'>[review]</a>:
&gt; -----------------------------------------------------------------
&gt; 
&gt; This looks okay to me. And I definitely think it makes sense to be passing
&gt; the principal around like this anyways - I'm actually surprised we weren't
&gt; doing that before.
&gt; 
&gt; ::: browser/base/content/tabbrowser.xml
&gt; &#64;&#64; +2098,5 &#64;&#64;
&gt; &gt;              var evt = new CustomEvent(&quot;TabOpen&quot;, { bubbles: true, detail });
&gt; &gt;              t.dispatchEvent(evt);
&gt; &gt;  
&gt; &gt; +            if (!usingPreloadedContent &amp;&amp; aOriginPrincipal) {
&gt; &gt; +              b.createAboutBlankContentViewer(aOriginPrincipal);
&gt; 
&gt; I wonder if this is going to cause any Talos regressions...</span >

I don't think so, because all of this is about what happens if code from the Firefox UI opens stuff. It doesn't happen for window.open and so on. So I don't think we'll hit this on Talos. I also don't think the hit will be serious enough to worry about.

remote:   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/6036b8acdab5">https://hg.mozilla.org/integration/mozilla-inbound/rev/6036b8acdab5</a>

I'll CC jmaher in case we do see a talos hit on central and this patch is to blame. There are options to reduce the impact (like only doing this for URIs that inherit the principal (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c30">comment #30</a>)) but that might be tricky to get completely right when it comes to think like URI fixup and so on... so if we can avoid it, I would like not to bother. :-)</pre></div><div class="change-set" id="c36"><div class="comment" data-id="11719555" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 08:09 PDT" data-time="1474297759">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="11719555">So this is getting backed out because of the containers code which means we can't change origin attributes after the docshell has been created.

I'm not so interested in the origin attributes, I'm interested in the principal.

How do I get the same principal with origin attributes that make this code happy?</pre><div class="activity"><div class="change">Flags: needinfo?(amarchesini)</div></div></div><div class="change-set" id="c37"><div class="comment" data-id="11719561" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 08:10 PDT" data-time="1474297832">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="11719561">(In reply to :Gijs Kruitbosch from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c36">comment #36</a>)
<span class="quote">&gt; So this is getting backed out because of the containers code which means we
&gt; can't change origin attributes after the docshell has been created.
&gt; 
&gt; I'm not so interested in the origin attributes, I'm interested in the
&gt; principal.
&gt; 
&gt; How do I get the same principal with origin attributes that make this code
&gt; happy?</span >

Failures:

<a rel="nofollow" href="https://treeherder.mozilla.org/logviewer.html#?job_id=36082765&amp;repo=mozilla-inbound#L3461">https://treeherder.mozilla.org/logviewer.html#?job_id=36082765&amp;repo=mozilla-inbound#L3461</a>

to be very specific: given principal X and principal Y, I want a principal X' that has the same origin usercontextid as Y and is otherwise identical to X.</pre></div><div class="change-set" id="c38"><div class="comment" data-id="11719616" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 08:27 PDT" data-time="1474298871">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="11719616">Is the setup that we have a link in a docshell with user context id A and then we &quot;open link in new tab&quot; it?  Ad the origin principal has user context id A?

If that's the situation, where is another user context id coming from?  Are we creating the new tab with a different user context id than A?</pre></div><div class="change-set" id="c39"><div class="comment" data-id="11719622" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 08:30 PDT" data-time="1474299016">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="11719622">(In reply to Boris Zbarsky [:bz] (TPAC) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c38">comment #38</a>)
<span class="quote">&gt; Is the setup that we have a link in a docshell with user context id A and
&gt; then we &quot;open link in new tab&quot; it?  Ad the origin principal has user context
&gt; id A?
&gt; 
&gt; If that's the situation, where is another user context id coming from?  Are
&gt; we creating the new tab with a different user context id than A?</span >

The latter. Nightly has context menus with &quot;open in a new container tab&quot;, and so that produces a tab with a different user context id (or should, anyway).</pre></div><div class="change-set" id="c40"><div class="comment" data-id="11719648" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a319260_1689"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 08:36 PDT" data-time="1474299405">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="11719648">Backout: <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/97d4dcf688a0">https://hg.mozilla.org/integration/mozilla-inbound/rev/97d4dcf688a0</a></pre></div><div class="change-set" id="c41"><div class="comment" data-id="11719763" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a319260_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a319260_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 09:10 PDT" data-time="1474301414">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="11719763">Ah, I see.

So for codebase principals , you can do nsIScriptSecurityManager.createCodebasePrincipal.  For a nullprincipal you can nsIScriptSecurityManager.nsIScriptSecurityManager.  For system principals, you're out of luck because those have no originattributes anyway.  Expanded principals should never be an origin principal here...</pre></div><div class="change-set" id="c42"><div class="comment" data-id="11721011" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a319260_1689"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a319260_1689"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 15:55 PDT" data-time="1474325700">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="11721011">Merged backout: <a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/6036b8acdab5">https://hg.mozilla.org/mozilla-central/rev/6036b8acdab5</a>

Not sure what that means for status flags in this bug.</pre><div class="activity"><div class="change">Flags: needinfo?(gijskruitbosch+bugs)</div></div></div><div class="change-set" id="a6628785_308534"><div class="change" id="aa6628785_308534">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a6628785_308534"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_308534" id="a6628785_308534"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6628785_308534"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6628785_308534">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a6628785_308534">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-19 16:10 PDT" data-time="1474326632">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gijskruitbosch+bugs)</span></div></div></div><div class="change-set" id="a6662812_159069"><div class="change" id="aa6662812_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6662812_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a6662812_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6662812_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6662812_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a6662812_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-20 01:37 PDT" data-time="1474360659">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(amarchesini)</span></div></div></div><div class="change-set" id="c43"><div class="comment" data-id="11722138" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6662812_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6662812_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-20 03:43 PDT" data-time="1474368224">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8792848"
         class="attachment patch obsolete"
         data-id="8792848" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aboutblank-viewer.txt">
      <meta itemprop="contentSize" content="25390">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8792848">
          <a class="link" href="attachment.cgi?id=8792848&amp;action=diff">
        <span id="att-8792848-description" itemprop="description">Patch v0.3</span></a> (obsolete)
        — <a href="attachment.cgi?id=8792848&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8792848">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-43" data-comment-id="11722138">I verified this avoids a crash. baku, can you sanity-check the utility function in utilityOverlay.js?

(I realize that this means that if you have a null-principal'd origin and you change the usercontextid when opening the link in a new tab, the link will no longer be same-origin. I believe that that would be the case as a result of the different usercontextid already, so I think that's OK.)

Trypush:

remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a6de29bafe59">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=a6de29bafe59</a></pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8791412&amp;action=edit"
           title="Patch v0.2"
           class=""
        >Attachment #8791412</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8792848&amp;action=edit"
           title="Patch v0.3"
           class=""
        >Attachment #8792848</a> -
        Flags: review?(amarchesini)</div></div></div><div class="change-set" id="c44"><div class="comment" data-id="11726122" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a6662812_159069"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a6662812_159069"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-21 09:00 PDT" data-time="1474473656">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="11726122">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8792848" name="attach_8792848" title="Patch v0.3">attachment 8792848</a> <a href="/attachment.cgi?id=8792848&amp;action=edit" title="Patch v0.3">[details]</a> <a href="/attachment.cgi?id=8792848&amp;action=diff" title="Patch v0.3">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8792848'>[review]</a>
Patch v0.3

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8792848" name="attach_8792848" title="Patch v0.3">attachment 8792848</a> <a href="/attachment.cgi?id=8792848&amp;action=edit" title="Patch v0.3">[details]</a> <a href="/attachment.cgi?id=8792848&amp;action=diff" title="Patch v0.3">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8792848'>[review]</a>:
-----------------------------------------------------------------

Sorry for the delay. looks good to me.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8792848&amp;action=edit"
           title="Patch v0.3"
           class=""
        >Attachment #8792848</a> -
        Flags: review?(amarchesini) &rarr; review+</div></div></div><div class="change-set" id="a6788449_159069"><div class="change" id="aa6788449_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a6788449_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6788449_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6788449_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a6788449_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-21 12:31 PDT" data-time="1474486296">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"
   href="/show_bug.cgi?id=1304492">1304492</a></div></div></div><div class="change-set" id="c45"><div class="comment" data-id="11727221" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6788449_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-21 13:46 PDT" data-time="1474490774">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8793491"
         class="attachment patch"
         data-id="8793491" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="aboutblank-viewer.txt">
      <meta itemprop="contentSize" content="26839">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8793491">
          <a class="link" href="attachment.cgi?id=8793491&amp;action=diff">
        <span id="att-8793491-description" itemprop="description">Patch v0.4</span></a>
        — <a href="attachment.cgi?id=8793491&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1284395&attachment=8793491">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-45" data-comment-id="11727221">try is still orange, because it doesn't like opening private browsing windows with links, which have non-0 privateBrowsingIds and so assigning a 0 there makes it... unhappy.

So really, we should copy all the originAttributes from the initial about:blank, I think. That is slightly problematic with the approach in the previous patch which did this in the parent on e10s, which doesn't work because of <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"
   href="/show_bug.cgi?id=1304492">bug 1304492</a>.

Really, if createAboutBlankContentViewer called with the 'wrong' principal is always wrong, it seems there's little point in calling it with such principals, so I've pushed the responsibility for changing those down into the browser implementations with the utility function moving to BrowserUtils and taking a full-on second principal. Principal rather than just the OA so we can easily ask for originSuffix and determine if we need to actually bother to create a second principal.

(We should still fix <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - remote-browser's contentPrincipal initially lies about originAttributes"
   href="/show_bug.cgi?id=1304492">bug 1304492</a>, but that might get hairy and I would prefer not to hold up this change for its sake.)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8792848&amp;action=edit"
           title="Patch v0.3"
           class=""
        >Attachment #8792848</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8793491&amp;action=edit"
           title="Patch v0.4"
           class=""
        >Attachment #8793491</a> -
        Flags: review?(mconley)</div><div class="change">
        <a href="/attachment.cgi?id=8793491&amp;action=edit"
           title="Patch v0.4"
           class=""
        >Attachment #8793491</a> -
        Flags: review?(amarchesini)</div></div></div><div class="change-set" id="c46"><div class="comment" data-id="11727233" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6788449_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-21 13:49 PDT" data-time="1474490981">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-46" data-comment-id="11727233">remote:   <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2dca3eb50711">https://treeherder.mozilla.org/#/jobs?repo=try&amp;revision=2dca3eb50711</a></pre></div><div class="change-set" id="c47"><div class="comment" data-id="11732498" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a6788449_159069"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-23 05:28 PDT" data-time="1474633689">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-47" data-comment-id="11732498">Comment on <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>
Patch v0.4

Review of <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>:
-----------------------------------------------------------------

::: toolkit/modules/BrowserUtils.jsm
&#64;&#64; +88,5 &#64;&#64;
<span class="quote">&gt; +      return principal;
&gt; +    }
&gt; +
&gt; +    // If they're the same, just return the principal as-is.
&gt; +    if (existingPrincipal.originSuffix == principal.originSuffix) {</span >

existingPrincipal.equals(principal)</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8793491&amp;action=edit"
           title="Patch v0.4"
           class=""
        >Attachment #8793491</a> -
        Flags: review?(amarchesini) &rarr; review+</div></div></div><div class="change-set" id="c48"><div class="comment" data-id="11732563" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6788449_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-23 05:59 PDT" data-time="1474635568">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-48" data-comment-id="11732563">(In reply to Andrea Marchesini [:baku] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Show about:blank (placeholder &quot;Search or enter address&quot; in the URL bar) (spoof)"
   href="/show_bug.cgi?id=1284395#c47">comment #47</a>)
<span class="quote">&gt; Comment on <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>
&gt; Patch v0.4
&gt; 
&gt; Review of <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>:
&gt; -----------------------------------------------------------------
&gt; 
&gt; ::: toolkit/modules/BrowserUtils.jsm
&gt; &#64;&#64; +88,5 &#64;&#64;
&gt; &gt; +      return principal;
&gt; &gt; +    }
&gt; &gt; +
&gt; &gt; +    // If they're the same, just return the principal as-is.
&gt; &gt; +    if (existingPrincipal.originSuffix == principal.originSuffix) {
&gt; 
&gt; existingPrincipal.equals(principal)</span >

This wouldn't be the case because their codebases will be different, no? In particular, the &quot;whole point&quot; of this patch is to get the new about:blank viewer that we're creating the inherited principal from example.com, and the existing principal is likely either for null or moz-safe-about:blank or whatever. The check here is if the *origin attributes* are the same - hence checking originSuffix, which AIUI is basically a serialization of the OA.</pre><div class="activity"><div class="change">Flags: needinfo?(amarchesini)</div></div></div><div class="change-set" id="c49"><div class="comment" data-id="11732568" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a6788449_159069"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-23 06:01 PDT" data-time="1474635701">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-49" data-comment-id="11732568"><span class="quote">&gt; &gt; existingPrincipal.equals(principal)</span >

You are right. We must check only the originSuffix. I was confused by 'if they are the same'.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(amarchesini)</span></div></div></div><div class="change-set" id="c50"><div class="comment" data-id="11737392" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_403756" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/4b4985a7acf7db49dfddd7815b55a043?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_403756" id="a6788449_159069"><a class="email " href="/user_profile?user_id=403756" > <span class="fna">Mike Conley (:mconley) (:⚙️)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-26 07:37 PDT" data-time="1474900637">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-50" data-comment-id="11737392">Comment on <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>
Patch v0.4

Review of <span class=""><a href="/attachment.cgi?id=8793491" name="attach_8793491" title="Patch v0.4">attachment 8793491</a> <a href="/attachment.cgi?id=8793491&amp;action=edit" title="Patch v0.4">[details]</a> <a href="/attachment.cgi?id=8793491&amp;action=diff" title="Patch v0.4">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1284395&amp;attachment=8793491'>[review]</a>:
-----------------------------------------------------------------

With baku's issue fixed and my docstring fixed, I think we're good to go here. Thanks Gijs!

::: toolkit/modules/BrowserUtils.jsm
&#64;&#64; +81,5 &#64;&#64;
<span class="quote">&gt;        throw &quot;Load of &quot; + aURL + principalStr + &quot; denied.&quot;;
&gt;      }
&gt;    },
&gt;  
&gt; +  principalWithMatchingOA(principal, existingPrincipal) {</span >

Please add a docstring.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8793491&amp;action=edit"
           title="Patch v0.4"
           class=""
        >Attachment #8793491</a> -
        Flags: review?(mconley) &rarr; review+</div></div></div><div class="change-set" id="c51"><div class="comment" data-id="11739792" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a6788449_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-27 02:03 PDT" data-time="1474967034">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-51" data-comment-id="11739792">remote:   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/a45cfe898352">https://hg.mozilla.org/integration/mozilla-inbound/rev/a45cfe898352</a></pre></div><div class="change-set" id="c52"><div class="comment" data-id="11743610" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_277293" id="a6788449_159069"><img src="https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_277293" id="a6788449_159069"><a class="email disabled" href="/user_profile?user_id=277293" > <span class="fna">Carsten Book [:Tomcat]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-09-28 07:06 PDT" data-time="1475071564">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="11743610"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/a45cfe898352">https://hg.mozilla.org/mozilla-central/rev/a45cfe898352</a></pre><div class="activity"><div class="change">Status: ASSIGNED &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2016-09-28 07:06 PDT" data-time="1475071564">5 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox52&amp;o1=isnotempty">status-firefox52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox52&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; Firefox 52</div></div></div><div class="change-set" id="a11442838_159069"><div class="change" id="aa11442838_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a11442838_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a11442838_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11442838_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11442838_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a11442838_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-11-14 08:24 PST" data-time="1479140685">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Opening an about:blank tab with an explicit NullPrincipal breaks the document"
   href="/show_bug.cgi?id=1315553">1315553</a></div></div></div><div class="change-set" id="a20446492_455785"><div class="change" id="aa20446492_455785">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_455785" id="a20446492_455785"><img src="https://secure.gravatar.com/avatar/f8267efedda3c2e24d5829ef3a9d124e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_455785" id="a20446492_455785"><a class="email " href="/user_profile?user_id=455785" > <span class="fna">Kamil Jozwiak [:kjozwiak]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20446492_455785"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20446492_455785">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a20446492_455785">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-02-26 13:25 PST" data-time="1488144339">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: qe-verify-</div><div class="change">Whiteboard: [post-critsmash-triage]</div></div></div><div class="change-set" id="a20630235_280903"><div class="change" id="aa20630235_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a20630235_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a20630235_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20630235_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20630235_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a20630235_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-02-28 16:28 PST" data-time="1488328082">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [post-critsmash-triage] &rarr; [post-critsmash-triage][adv-main52+]</div></div></div><div class="change-set" id="a20702469_280903"><div class="change" id="aa20702469_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a20702469_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a20702469_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20702469_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20702469_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a20702469_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-03-01 12:31 PST" data-time="1488400316">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2017-5420</div></div></div><div class="change-set" id="a24134556_159069"><div class="change" id="aa24134556_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a24134556_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a24134556_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a24134556_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a24134556_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a24134556_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-04-10 06:53 PDT" data-time="1491832403">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Right-click new tab loses URL information if site is down"
   href="/show_bug.cgi?id=1354796">1354796</a></div></div></div><div class="change-set" id="a24224161_159069"><div class="change" id="aa24224161_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a24224161_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a24224161_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a24224161_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a24224161_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a24224161_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-04-11 07:46 PDT" data-time="1491922008">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">No longer depends on: <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Right-click new tab loses URL information if site is down"
   href="/show_bug.cgi?id=1354796">1354796</a></div></div></div><div class="change-set" id="a24224162_159069"><div class="change" id="aa24224162_159069">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a24224162_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_159069" id="a24224162_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a24224162_159069"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a24224162_159069">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a24224162_159069">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-04-11 07:46 PDT" data-time="1491922009">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Right-click new tab loses URL information if site is down"
   href="/show_bug.cgi?id=1354796">1354796</a></div></div></div><div class="change-set" id="c53"><div class="comment" data-id="12332403" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_159069" id="a24224162_159069"><img src="https://secure.gravatar.com/avatar/66445733c06687eafa2978764675104f?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_159069" id="a24224162_159069"><a class="email " href="/user_profile?user_id=159069" > <span class="fna">:Gijs (he/him)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-05-19 03:27 PDT" data-time="1495189639">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="12332403">Can this be opened up, given it's sec-low and fixed in 52esr?</pre><div class="activity"><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="a27512242_1689"><div class="change" id="aa27512242_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a27512242_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a27512242_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a27512242_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a27512242_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a27512242_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-05-19 09:08 PDT" data-time="1495210089">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div></div></div><div class="change-set" id="a28097055_219124"><div class="change" id="aa28097055_219124">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_219124" id="a28097055_219124"><img src="https://secure.gravatar.com/avatar/d949a35ad3900bd0ee47938b23a0cbee?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_219124" id="a28097055_219124"><a class="email " href="/user_profile?user_id=219124" > <span class="fna">Dão Gottwald [::dao]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a28097055_219124"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a28097055_219124">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1284395#a28097055_219124">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-05-26 03:35 PDT" data-time="1495794902">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - Changing URL locations while a page is loading temporarily reverts the URL"
   href="/show_bug.cgi?id=1366203">1366203</a></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1284395&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>