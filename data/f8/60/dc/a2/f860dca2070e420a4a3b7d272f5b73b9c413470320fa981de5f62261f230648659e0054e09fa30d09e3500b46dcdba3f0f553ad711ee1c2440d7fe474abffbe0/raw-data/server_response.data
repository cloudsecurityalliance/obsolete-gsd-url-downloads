<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
	<title>0000847: Bareos should create its PID files before dropping privileges - Bareos Bug Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/default.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/status_config.php?cache_key=d4fa6b5e3ec731b4ebbeae67b87fdd92" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/dropzone-4.3.0.min.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/bootstrap-3.3.6.min.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/font-awesome-4.6.3.min.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/fonts.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/bootstrap-datetimepicker-4.17.47.min.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/ace.min.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/ace-mantis.css" />
	<link rel="stylesheet" type="text/css" href="https://bugs.bareos.org/css/ace-skins.min.css" />

	<link rel="shortcut icon" href="/custom_images/favicon.ico" type="image/x-icon" />
	<link rel="search" type="application/opensearchdescription+xml" title="Bareos Bug Tracker: full-text search" href="https://bugs.bareos.org/browser_search_plugin.php?type=text"/>
	<link rel="search" type="application/opensearchdescription+xml" title="Bareos Bug Tracker: search by Issue Id" href="https://bugs.bareos.org/browser_search_plugin.php?type=id"/>
	<script type="text/javascript" src="/javascript_config.php?cache_key=d4fa6b5e3ec731b4ebbeae67b87fdd92"></script>
	<script type="text/javascript" src="/javascript_translations.php?cache_key=1e0513ca8d97cc96a7575d998beb890a"></script>
	<script type="text/javascript" src="/js/jquery-2.2.4.min.js"></script>
	<script type="text/javascript" src="/js/dropzone-4.3.0.min.js"></script>
	<script type="text/javascript" src="/js/common.js"></script>
</head>
<body id="view-issue-page" class="skin-3">
<style>
* { font-family: "Open Sans"; } 
h1, h2, h3, h4, h5 { font-family: "Open Sans"; } 
</style>
<div id="navbar" class="navbar navbar-default navbar-collapse navbar-fixed-top noprint"><div id="navbar-container" class="navbar-container"><button id="menu-toggler" type="button" class="navbar-toggle menu-toggler pull-left hidden-lg hidden-md" data-target="#sidebar"><span class="sr-only">Toggle sidebar</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><div class="navbar-header"><a href="/my_view_page.php" class="navbar-brand"><span class="smaller-75"> Bareos Bug Tracker </span></a><button type="button" class="navbar-toggle navbar-toggle-img collapsed pull-right hidden-sm hidden-md hidden-lg" data-toggle="collapse" data-target=".navbar-buttons,.navbar-menu"><span class="sr-only">Toggle user menu</span><i class="ace-icon fa fa-user fa-2x white"></i> </button></div><div class="navbar-buttons navbar-header navbar-collapse collapse"><ul class="nav ace-nav"><li class="grey"><a data-toggle="dropdown" href="#" class="dropdown-toggle"><i class="ace-icon fa fa-user fa-2x white"></i> <span class="user-info">readonly</span><i class="ace-icon fa fa-angle-down"></i></a><ul class="user-menu dropdown-menu dropdown-menu-right dropdown-yellow dropdown-caret dropdown-close"><li><a href="https://bugs.bareos.org/issues_rss.php?"><i class="ace-icon fa fa-rss-square orange"> </i> RSS</a></li><li class="divider"></li><li><a href="/logout_page.php"><i class="ace-icon fa fa-sign-out"> </i> Logout</a></li></ul></li></ul></div></div></div><div class="main-container" id="main-container">
<div id="sidebar" class="sidebar sidebar-fixed responsive compact "><ul class="nav nav-list"><li>
<a href="/my_view_page.php">
<i class="menu-icon fa fa-dashboard"></i> 
<span class="menu-text"> My View </span>
</a>
<b class="arrow"></b>
</li>
<li class="active">
<a href="/view_all_bug_page.php">
<i class="menu-icon fa fa-list-alt"></i> 
<span class="menu-text"> View Issues </span>
</a>
<b class="arrow"></b>
</li>
<li>
<a href="/changelog_page.php">
<i class="menu-icon fa fa-retweet"></i> 
<span class="menu-text"> Change Log </span>
</a>
<b class="arrow"></b>
</li>
<li>
<a href="/plugin.php?page=Source/index">
<i class="menu-icon fa fa-code-fork"></i> 
<span class="menu-text"> Repositories </span>
</a>
<b class="arrow"></b>
</li>
<li>
<a href="/plugin.php?page=Source/search_page">
<i class="menu-icon fa fa-search"></i> 
<span class="menu-text"> Search </span>
</a>
<b class="arrow"></b>
</li>
</ul><div id="sidebar-btn" class="sidebar-toggle sidebar-collapse"><i data-icon2="ace-icon fa fa-angle-double-right" data-icon1="ace-icon fa fa-angle-double-left"
		class="ace-icon fa fa-angle-double-left"></i></div></div><div class="main-content">
<div id="breadcrumbs" class="breadcrumbs noprint">
<ul class="breadcrumb">
 <li><i class="fa fa-user home-icon active"></i> Anonymous </li>
<div class="btn-group btn-corner">
	<a href="/login_page.php?return=%2Fview.php%3Fid%3D847" class="btn btn-primary btn-xs">Login</a>
	<a href="/signup_page.php" class="btn btn-primary btn-xs">Signup for a new account</a>
</div>
</ul>
<div id="nav-search" class="nav-search"><form class="form-search" method="post" action="/jump_to_bug.php"><span class="input-icon"><input type="text" name="bug_id" autocomplete="off" class="nav-search-input" placeholder="Issue #"><i class="ace-icon fa fa-search nav-search-icon"></i></span></form></div>
</div>
  <div class="page-content">
<div class="row">
<div class="col-md-12 col-xs-12"><div class="widget-box widget-color-blue2"><div class="widget-header widget-header-small"><h4 class="widget-title lighter"><i class="ace-icon fa fa-bars"></i>View Issue Details</h4></div><div class="widget-body"><div class="widget-toolbox padding-8 clearfix noprint"><div class="btn-group pull-left"><a class="btn btn-primary btn-white btn-round btn-sm" href="#bugnotes">Jump to Notes</a><a class="btn btn-primary btn-white btn-round btn-sm" href="#history">Jump to History</a></div><div class="btn-group pull-right"></div></div><div class="widget-main no-padding"><div class="table-responsive"><table class="table table-bordered table-condensed"><tfoot><tr class="noprint"><td colspan="6"><div class="btn-group"><div class="pull-left padding-right-8"></div><div class="pull-left padding-right-8"></div><div class="pull-left padding-right-8"></div><div class="pull-left padding-right-2"></div><div class="pull-left padding-right-2"></div><div class="pull-left padding-right-2"></div><div class="pull-left padding-right-2"></div><div class="pull-left padding-right-2"></div></div></td></tr></tfoot><tbody><tr class="bug-header"><th class="bug-id category" width="15%">ID</th><th class="bug-project category" width="20%">Project</th><th class="bug-category category" width="15%">Category</th><th class="bug-view-status category" width="15%">View Status</th><th class="bug-date-submitted category" width="15%">Date Submitted</th><th class="bug-last-modified category" width="20%">Last Update</th></tr><tr class="bug-header-data"><td class="bug-id">0000847</td><td class="bug-project">bareos-core</td><td class="bug-category">[All Projects] General</td><td class="bug-view-status">public</td><td class="bug-date-submitted">2017-08-23 21:50</td><td class="bug-last-modified">2021-09-22 14:52</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="hidden"></tr><tr><th class="bug-reporter category">Reporter</th><td class="bug-reporter">mjo</td><th class="bug-assigned-to category">Assigned To</th><td class="bug-assigned-to"></td><td colspan="2">&#160;</td></tr><tr><th class="bug-priority category">Priority</th><td class="bug-priority">normal</td><th class="bug-severity category">Severity</th><td class="bug-severity">feature</td><th class="bug-reproducibility category">Reproducibility</th><td class="bug-reproducibility">always</td></tr><tr><th class="bug-status category">Status</th><td class="bug-status"><i class="fa fa-square fa-status-box status-30-color"></i> acknowledged</td><th class="bug-resolution category">Resolution</th><td class="bug-resolution">open</td><td colspan="2">&#160;</td></tr><tr><th class="bug-product-version category">Product Version</th><td class="bug-product-version">13.2.4</td><td colspan="4">&#160;</td></tr><tr><th class="bug-fixed-in-version category">Fixed in Version</th><td class="bug-fixed-in-version"></td><td colspan="4">&#160;</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="hidden"></tr><tr><th class="bug-summary category">Summary</th><td class="bug-summary" colspan="5">0000847: Bareos should create its PID files before dropping privileges</td></tr><tr><th class="bug-description category">Description</th><td class="bug-description" colspan="5">(I actually tested this on the ancient 13.2.4, but I reviewed the source on Github to make sure that the report is still relevant.)<br />
<br />
== Summary ==<br />
<br />
The bareos daemons should create their PID files before dropping<br />
privileges. This represents a minor security issue; additional factors<br />
are needed to make it exploitable.<br />
<br />
Daemons affected:<br />
<br />
&#160;&#160;* bareos-dir (src/dird/dird.c)<br />
&#160;&#160;* bareos-fd  (src/filed/filed.c)<br />
&#160;&#160;* bareos-sd  (src/stored/stored.c)<br />
<br />
<br />
== Details ==<br />
<br />
The purpose of the PID file is to hold the PID of the running daemon,<br />
so that later it can be stopped, restarted, or otherwise signalled<br />
(many daemons reload their configurations in response to a SIGHUP).<br />
To fulfil that purpose, the contents of the PID file need to be<br />
trustworthy. If the PID file is writable by a non-root user, then he<br />
can replace its contents with the PID of a root process. Afterwards,<br />
any attempt to signal the PID contained in the PID file will instead<br />
signal a root process chosen by the non-root user (a vulnerability).<br />
<br />
This is commonly exploitable through init scripts that are run as root and<br />
which blindly trust the contents of their PID files. One of the<br />
scripts included with bareos, scripts/bareos-ctl-funcs, makes the same<br />
assumption (although I'm not sure if it's supposed to be run as root):<br />
<br />
&#160;&#160;pid=`head -n 1 ${PIDDIR}/$base.$2.pid`<br />
<br />
<br />
== Exploitation ==<br />
<br />
There is only a risk of exploitation when some other user relies on<br />
the data in the PID file. However, the point of the PID file is to<br />
provide a daemon's PID to other users (mainly root). Therefore any use<br />
of the PID file is suspect.<br />
<br />
An example of a problematic scenario involving an init script would be,<br />
<br />
1. I run &quot;/etc/init.d/bareos-dir start&quot; to start the daemon.<br />
<br />
2. bareos-dir drops to the &quot;bareos&quot; user.<br />
<br />
3. bareos-dir writes its PID file, now owned by the &quot;bareos&quot; user.<br />
<br />
4. Someone compromises the daemon.<br />
<br />
5. The attacker is generally limited in what he can do because the<br />
&#160;&#160;&#160;daemon doesn't run as root. However, he can write &quot;1&quot; into the<br />
&#160;&#160;&#160;PID file, and he does.<br />
<br />
6. I run &quot;/etc/init.d/bareos-dir stop&quot; to stop the daemon while I investigate<br />
&#160;&#160;&#160;the weird behavior resulting from the hack.<br />
<br />
7. The machine reboots, because I killed PID 1 (this is normally restricted<br />
&#160;&#160;&#160;to root).<br />
<br />
<br />
== Resolution == <br />
<br />
The most straightforward way to avoid the problem is to create the PID files as root, before dropping privileges. This does cause one annoyance: you can't remove the PID file after you've dropped privileges. However, that's relatively easy for the init system to handle.</td></tr><tr><th class="bug-tags category">Tags</th><td class="bug-tags" colspan="5">No tags attached.</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="hidden"></tr><tr><th class="bug-custom-field category">bareos-master: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-master: action</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-19.2: impact</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-19.2: action</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-18.2: impact</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-18.2: action</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-17.2: impact</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-17.2: action</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-16.2: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-16.2: action</th><td class="bug-custom-field" colspan="5"></td></tr><tr><th class="bug-custom-field category">bareos-15.2: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-15.2: action</th><td class="bug-custom-field" colspan="5">none</td></tr><tr><th class="bug-custom-field category">bareos-14.2: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-14.2: action</th><td class="bug-custom-field" colspan="5">none</td></tr><tr><th class="bug-custom-field category">bareos-13.2: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-13.2: action</th><td class="bug-custom-field" colspan="5">none</td></tr><tr><th class="bug-custom-field category">bareos-12.4: impact</th><td class="bug-custom-field" colspan="5">yes</td></tr><tr><th class="bug-custom-field category">bareos-12.4: action</th><td class="bug-custom-field" colspan="5">none</td></tr><tr class="spacer"><td colspan="6"></td></tr><tr class="hidden"></tr></tbody></table></div></div></div></div></div>
<div class="col-md-12 col-xs-12">
<a id="attachments"></a>
<a id="bugnotes"></a>
<div class="space-10"></div>

<div id="bugnotes" class="widget-box widget-color-blue2 ">
<div class="widget-header widget-header-small">
	<h4 class="widget-title lighter">
	<i class="ace-icon fa fa-comments"></i>
		Activities	</h4>
	<div class="widget-toolbar">
		<a data-action="collapse" href="#">
			<i class="1 ace-icon fa fa-chevron-up bigger-125"></i>
		</a>
	</div>
	</div>
	<div class="widget-body">
	<div class="widget-main no-padding">
	<div class="table-responsive">
	<table class="table table-bordered table-condensed table-striped">
<tr class="bugnote visible-on-hover-toggle" id="c2741">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=481"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mjo" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2017-09-20 22:17					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c2741" class="lighter" title="Direct link to note">
				~0002741			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	This has been assigned CVE-2017-14610.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4215">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1650"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mschiff" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-08-22 10:58					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4215" class="lighter" title="Direct link to note">
				~0004215			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	This is a security issue with CVE-2017-14610<br />
<br />
Can this bug be closed? I think this is fixed in all current versions of bareos, right?	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4250">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1650"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mschiff" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-06 12:22					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4250" class="lighter" title="Direct link to note">
				~0004250			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	Seems like this issue is NOT resolved yet. Version 20.0.2 is still affected.<br />
<br />
Any ETA we can expect for a fix?<br />
<br />
Thanks!	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4264">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1744"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="bruno-at-bareos" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1744">bruno-at-bareos</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-14 13:53					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">developer</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4264" class="lighter" title="Direct link to note">
				~0004264			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	mschiff actual daily is showing correct rights for pid file here bareos-fd daemon.<br />
<br />
```<br />
ls -lah /var/lib/bareos/bareos-fd.9102.pid<br />
-rw-r-----. 1 root bareos 5 Sep 14 04:19 /var/lib/bareos/bareos-fd.9102.pid<br />
```<br />
<br />
Also all systemd platforms got new services so there's no more script in use.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4265">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1744"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="bruno-at-bareos" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1744">bruno-at-bareos</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-14 14:21					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">developer</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4265" class="lighter" title="Direct link to note">
				~0004265			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	of course using bareos-dir you got a <br />
```-rw-r-----  1 bareos bareos    6 Sep 14 14:14 bareos-dir.9101.pid```<br />
which can be exploited as described by a bareos user<br />
<br />
But as stated before, with systemd control you could put whatever even 1 in this file, systemd will react correctly and use its own pid knowledge.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4266">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1650"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mschiff" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-15 10:22					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4266" class="lighter" title="Direct link to note">
				~0004266			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	OK, this may be a possible workaround for systems using systemd. But other systems are still affected.<br />
<br />
So do you have any ETA when we can expect a security-fix?<br />
<br />
Thanks!	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4271">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1468"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="arogge" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1468">arogge</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-21 16:14					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">developer</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4271" class="lighter" title="Direct link to note">
				~0004271			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	There is no easy way to fix this, as the current implementation requires us to parse the configuration to determine the name and location of the PID file. As the configuration should be read with limited privileges, we need to drop privileges first. Having said that, we will replace the current mechanism in Bareos 21, but I don't think there will be a real fix for the existing versions. We're investigating if we can at least provide a reasonable workaround though.<br />
<br />
While this is a real issue, it is effectively limited to the director and the storage daemon. The file daemon usually runs as root and as such the pid-file gets also written as root.<br />
Also, I have objections when it comes to the CVE's risk assessment. The CVSS that has been set declares it is affecting Confidentiality, Integrity and Availability. While I agree that killing the wrong PID may affect availability, it should not affect confidentiality and integrity and if it does that should be a CVE for the program that has been killed.<br />
Also, as there are no measures in place that will automatically stop or restart the daemons without user interaction, the attack vector will in fact require user interaction.<br />
Last but not least you must be able to act as user &quot;bareos&quot;, which is considered as &quot;High Privilege&quot;.<br />
So my CVSS assessment is CVSS:3.1/AV:L/AC:L/PR:H/UI:R/S:U/C:N/I:N/A:H which results in 4.2 (moderate) and not 7.8 (high) as in the original report.<br />
<br />
If you take a closer look at the availability scores in CVSS, this probably wouldn't even count as an availability issue, as that would require Bareos is being disrupted, while the attack vector is disrupting any other service (but I'm not claiming that).	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4272">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=481"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mjo" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-22 01:19					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4272" class="lighter" title="Direct link to note">
				~0004272			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	I just spent half an hour typing up an in-depth response that was met with an &quot;APPLICATION ERROR #2800 Invalid form security token&quot;, so you'll have to excuse my brevity.<br />
<br />
The security risk is indeed minor (I didn't make up the rating). The remaining difficulty stems from using the same file for two separate purposes that have different security requirements. MIMEDefang had the same issue and fixed it in v2.81 by separating the PID and lock files.<br />
<br />
To fix it:<br />
<br />
1. Use separate PID and lock files.<br />
2. Make the PID file a command-line only argument, and create it as root. Only the init system cares about it, and it's sensitive.<br />
3. Create the lockfile as the &quot;bareos&quot; user. Only Bareos cares about it, and it's not sensitive.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4273">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1468"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="arogge" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1468">arogge</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-22 10:53					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">developer</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4273" class="lighter" title="Direct link to note">
				~0004273			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	Thank you for the quick response and sorry for the application error - the timeout for the CSRF-token in Mantis is a bit short if you're writing something more in-depth.<br />
<br />
We already have PR#928 where we started to do the PID as a command-line only argument. We had not yet considered the splitting of PID and lock file, so thank you for bringing this up. I'll take a look at what you did in MIMEDefang v2.81 to see if we can do it like that in Bareos.<br />
<br />
As you're the reporter of the issue: do you have any idea who we need to contact to update the CVE when we have a fix/workaround in place?	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4274">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=1650"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mschiff" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-22 13:42					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4274" class="lighter" title="Direct link to note">
				~0004274			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	In Gentoo we now use a workaround in the packages: systemd an openrc do not rely on or use the pid file anymore.<br />
<br />
When considering split of pid and lock file: Please also consider, that the directory where files will be written also have to be different or the run directory needs group write permissions and must be group-owned by bareos...<br />
<br />
Good to see progess here, thank you!	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
<tr class="bugnote visible-on-hover-toggle" id="c4275">
		<td class="category">
		<div class="pull-left padding-2"><div class="bugnote-avatar-container-80"><a rel="nofollow" href="https://bugs.bareos.org/view_user_page.php?id=481"><img class="bugnote-avatar-80" src="https://bugs.bareos.org/images/avatar.png" alt="mjo" /></a></div>		</div>
		<div class="pull-left padding-2">
		<p class="no-margin">
			<i class="fa fa-user grey"></i> <a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>		</p>
		<p class="no-margin small lighter">
			<i class="fa fa-clock-o grey"></i> 2021-09-22 14:52					</p>
		<p class="no-margin">
			<span class="label label-sm label-default arrowed-in-right">reporter</span>			&#160;
						<i class="fa fa-link grey"></i>
			<a rel="bookmark" href="view.php?id=847#c4275" class="lighter" title="Direct link to note">
				~0004275			</a>
					</p>
				<div class="clearfix"></div>
		<div class="space-2"></div>
		<div class="btn-group visible-on-hover">
				</div>
		</div>
	</td>
	<td class="bugnote-note bugnote-public">
	Depending on the information you want to update, there's either a web form (MITRE, cveform.mitre.org) or email address (NVD, <a href="mailto:nvd@nist.gov">nvd@nist.gov</a>) that handles it:<br />
<br />
<a href="https://cve.mitre.org/cve/update_cve_records.html">https://cve.mitre.org/cve/update_cve_records.html</a><br />
<br />
The CVE information is synchronized to NVD automatically, but NVD contains additional information like the &quot;high&quot; vulnerability score that can't be fixed with a CVE update.	</td>
</tr>
<tr class="spacer">
	<td colspan="2"></td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>


    <div class="col-md-12 col-xs-12">
        <a id="history"></a>
        <div class="space-10"></div>

<div id="history" class="widget-box widget-color-blue2 ">
<div class="widget-header widget-header-small">
	<h4 class="widget-title lighter">
		<i class="ace-icon fa fa-history"></i>
		Issue History	</h4>
	<div class="widget-toolbar">
		<a data-action="collapse" href="#">
			<i class="1 ace-icon fa fa-chevron-up bigger-125"></i>
		</a>
	</div>
</div>
<div class="widget-body">
<div class="widget-main no-padding">
<div class="table-responsive">
<table class="table table-bordered table-condensed table-hover table-striped">
	<thead>
		<tr>
			<th class="small-caption">
				Date Modified			</th>
			<th class="small-caption">
				Username			</th>
			<th class="small-caption">
				Field			</th>
			<th class="small-caption">
				Change			</th>
		</tr>
	</thead>

	<tbody>
		<tr>
			<td class="small-caption">
				2017-08-23 21:50			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>			</td>
			<td class="small-caption">
				New Issue			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-master: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-16.2: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-15.2: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-15.2: action			</td>
			<td class="small-caption">
				 =&gt; none			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-14.2: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-14.2: action			</td>
			<td class="small-caption">
				 =&gt; none			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-13.2: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-13.2: action			</td>
			<td class="small-caption">
				 =&gt; none			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-12.4: impact			</td>
			<td class="small-caption">
				 =&gt; yes			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				bareos-12.4: action			</td>
			<td class="small-caption">
				 =&gt; none			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				Severity			</td>
			<td class="small-caption">
				minor =&gt; feature			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-08-24 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=6">joergs</a>			</td>
			<td class="small-caption">
				Status			</td>
			<td class="small-caption">
				new =&gt; acknowledged			</td>
		</tr>
		<tr>
			<td class="small-caption">
				2017-09-20 22:17			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>			</td>
			<td class="small-caption">
				Note Added: 0002741			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-08-22 10:58			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>			</td>
			<td class="small-caption">
				Note Added: 0004215			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-06 12:22			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>			</td>
			<td class="small-caption">
				Note Added: 0004250			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-14 13:53			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1744">bruno-at-bareos</a>			</td>
			<td class="small-caption">
				Note Added: 0004264			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-14 14:21			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1744">bruno-at-bareos</a>			</td>
			<td class="small-caption">
				Note Added: 0004265			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-15 10:22			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>			</td>
			<td class="small-caption">
				Note Added: 0004266			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-21 16:14			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1468">arogge</a>			</td>
			<td class="small-caption">
				Note Added: 0004271			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-22 01:19			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>			</td>
			<td class="small-caption">
				Note Added: 0004272			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-22 10:53			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1468">arogge</a>			</td>
			<td class="small-caption">
				Note Added: 0004273			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-22 13:42			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=1650">mschiff</a>			</td>
			<td class="small-caption">
				Note Added: 0004274			</td>
			<td class="small-caption">
							</td>
		</tr>
		<tr>
			<td class="small-caption">
				2021-09-22 14:52			</td>
			<td class="small-caption">
				<a  href="https://bugs.bareos.org/view_user_page.php?id=481">mjo</a>			</td>
			<td class="small-caption">
				Note Added: 0004275			</td>
			<td class="small-caption">
							</td>
		</tr>
	</tbody>
</table>
</div>
</div>
</div>
</div>
</div>

</div>
</div>
</div>
<div class="clearfix"></div>
<div class="space-20"></div>
<div class="footer noprint">
<div class="footer-inner">
<div class="footer-content">
<div class="col-md-6 col-xs-12 no-padding">
<address>
<strong>Powered by <a href="https://www.mantisbt.org" title="bug tracking software">MantisBT </a></strong> <br>
<small>Copyright &copy; 2000 - 2021 MantisBT Team</small><br><small>Contact <a href="mailto:webmaster@bareos.org" title="Contact the webmaster via e-mail.">administrator</a> for assistance</small><br>
</address>
</div>
<div class="col-md-6 col-xs-12">
<div class="pull-right" id="powered-by-mantisbt-logo">
<a href="https://www.mantisbt.org" title="Mantis Bug Tracker: a free and open source web based bug tracking system."><img src="/images/mantis_logo.png" width="102" height="35" alt="Powered by Mantis Bug Tracker: a free and open source web based bug tracking system." /></a>
</div>
</div>
</div>
</div>
</div>
<a class="btn-scroll-up btn btn-sm btn-inverse display" id="btn-scroll-up" href="#">
<i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
</a>
</div>
	<script type="text/javascript" src="/js/bootstrap-3.3.6.min.js"></script>
	<script type="text/javascript" src="/js/moment-with-locales-2.15.2.min.js"></script>
	<script type="text/javascript" src="/js/bootstrap-datetimepicker-4.17.47.min.js"></script>
	<script type="text/javascript" src="/js/typeahead.jquery-1.1.1.min.js"></script>
	<script type="text/javascript" src="/js/list-1.4.1.min.js"></script>
	<script type="text/javascript" src="/js/ace.min.js"></script>
</body>
</html>
