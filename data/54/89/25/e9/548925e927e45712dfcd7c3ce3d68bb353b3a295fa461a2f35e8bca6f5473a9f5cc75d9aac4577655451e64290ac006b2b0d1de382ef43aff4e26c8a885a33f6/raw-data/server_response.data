<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #70976 - RDF' href='rss/bug.php?id=70976'>
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #70976 - RSS 2.0' href='rss/bug.php?id=70976&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Bug #70976 :: Memory Read via gdImageRotateInterpolated Array Index Out of Bounds</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=70976">Bug</a>&nbsp;#70976</th>
            <td id="summary" colspan="5">Memory Read via gdImageRotateInterpolated Array Index Out of Bounds</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2015-11-26 11:16 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2016-02-02 09:31 UTC</td>
            <td rowspan="6">

                <table id="votes">
                    <tr><th class="details">Votes:</th><td>1</td></tr>
                    <tr><th class="details">Avg. Score:</th><td>1.0 &plusmn; 0.0</td></tr>
                    <tr><th class="details">Reproduced:</th><td>0 of 0 (0.0%)</td></tr>
                </table>

            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>emmanuel &#x64;&#111;&#x74; law &#x61;&#116; gmail &#x64;&#111;&#x74; com</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=jpauli">jpauli</a> (<a href="https://people.php.net/jpauli">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=GD+related">GD related</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>5.6.15</td>
            <th class="details">OS:</th>
            <td>*</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-CVEE-2016-1903" target="_blank">CVEE-2016-1903</a></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=70976&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=70976&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=70976&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1448536606">&nbsp;</a><strong>[2015-11-26 11:16 UTC] emmanuel &#x64;&#111;&#x74; law &#x61;&#116; gmail &#x64;&#111;&#x74; com</strong>
<pre class='note'>Description:
------------
This is the function prototype for ImageRotate:

resource imagerotate ( resource $image , float $angle , int $bgd_color [, int $ignore_transparent = 0 ] )


$bgd_color specifies the background color of an image have it has been rotated. This is passed in as an integer that represents an index to the color palette.

There is a lack of validation of $bgd_color. One can pass in a large number that exceeds the color palette array. This reads memory beyond the color palette. Information of the memory leak can then be obtained via the background color after the image has been rotated.

Test script:
---------------
./configure --with-gd


1) Pass in a large $bgd_color:

php -r &quot;imagerotate(imagecreate(1,1),45,0x7ffffff9);&quot;


2) This causes it to crash at gd_interpolation.c:2174  :


Stopped reason: SIGSEGV
0x00000000005fb0b4 in gdImageRotateInterpolated (src=0x7ffff7fb5b38, angle=45, bgcolor=0x7ffffff9) at php-5.6.15/ext/gd/libgd/gd_interpolation.c:2174
2174                            bgcolor =  gdTrueColorAlpha(src-&gt;red[bgcolor], src-&gt;green[bgcolor], src-&gt;blue[bgcolor], src-&gt;alpha[bgcolor]);



gdb-peda$ bt
#0  0x00000000005fb0b4 in gdImageRotateInterpolated (src=0x7ffff7fb5b38, angle=45, bgcolor=0x7ffffff9) at /home/elaw/php-5.6.15/ext/gd/libgd/gd_interpolation.c:2174
#1  0x00000000005d0b73 in zif_imagerotate (ht=0x3, return_value=0x7ffff7fb5810, return_value_ptr=0x7ffff7f80090, this_ptr=0x0, return_value_used=0x0)
    at /home/elaw/php-5.6.15/ext/gd/gd.c:2111
#2  0x0000000000850915 in zend_do_fcall_common_helper_SPEC (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:558
#3  0x000000000085856c in ZEND_DO_FCALL_SPEC_CONST_HANDLER (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:2602
#4  0x000000000084ee1a in execute_ex (execute_data=0x7ffff7f800c8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:363
#5  0x000000000084f806 in zend_execute (op_array=0x7ffff7fb42f8) at /home/elaw/php-5.6.15/Zend/zend_vm_execute.h:388
#6  0x00000000007f6636 in zend_eval_stringl (str=0x106ff80 &quot;imagerotate(imagecreate(1,1),45,2147483641);&quot;, str_len=0x2c, retval_ptr=0x0,
    string_name=0xd46ac4 &quot;Command line code&quot;) at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1077
#7  0x00000000007f68bc in zend_eval_stringl_ex (str=0x106ff80 &quot;imagerotate(imagecreate(1,1),45,2147483641);&quot;, str_len=0x2c, retval_ptr=0x0,
    string_name=0xd46ac4 &quot;Command line code&quot;, handle_exceptions=0x1) at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1124
#8  0x00000000007f6940 in zend_eval_string_ex (str=0x106ff80 &quot;imagerotate(imagecreate(1,1),45,2147483641);&quot;, retval_ptr=0x0, string_name=0xd46ac4 &quot;Command line code&quot;,
    handle_exceptions=0x1) at /home/elaw/php-5.6.15/Zend/zend_execute_API.c:1135
#9  0x000000000092ce99 in do_cli (argc=0x3, argv=0x106ff00) at /home/elaw/php-5.6.15/sapi/cli/php_cli.c:1034
#10 0x000000000092ddc5 in main (argc=0x3, argv=0x106ff00) at /home/elaw/php-5.6.15/sapi/cli/php_cli.c:1378
#11 0x00007ffff6027b45 in __libc_start_main (main=0x92d722 &lt;main&gt;, argc=0x3, argv=0x7fffffffe338, init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;,
    stack_end=0x7fffffffe328) at libc-start.c:287
#12 0x0000000000421409 in _start ()


3) One can see that the color platte only has 256 entries:

gdb-peda$ ptype src
type = struct gdImageStruct {
......
    int red[256];
    int green[256];
    int blue[256];
....


4) Thus we are encountering an array index out of bounds.



5) I've created a full exploit that reads large contiguous chunk of memory. The POC can be obtained from <a href="https://www.dropbox.com/s/bwuivbug62ki4cs/gdImageRotateInterpolated_Array_Index_OOB_MEM_Read.php?dl=0" rel="nofollow">https://www.dropbox.com/s/bwuivbug62ki4cs/gdImageRotateInterpolated_Array_Index_OOB_MEM_Read.php?dl=0</a>


./php gdImageRotateInterpolated_Array_Index_OOB_MEM_Read.php


0c40  01 00 00 00 01 00 00 00  01 00 00 00 01 00 00 00   ........ ........
0c50  01 00 00 00 01 00 00 00  01 00 00 00 01 00 00 9d   ........ .......�
0c60  01 00 00 9d 01 00 00 fd  01 00 00 00 01 00 00 00   ...�...� ........
0c70  01 00 00 ef 01 00 00 00  01 00 00 2f 01 00 00 00   ...�.... .../....
0c80  01 00 00 20 01 00 00 ff  01 00 00 c8 01 00 00 ff   ... ...� ...�...�
0c90  01 00 00 20 01 00 00 ff  01 00 00 c8 01 00 00 ff   ... ...� ...�...�
0ca0  01 00 00 70 01 00 00 ff  01 00 00 60 01 00 00 ff   ...p...� ...`...�
0cb0  01 00 00 08 01 00 00 ff  01 00 00 b0 01 00 00 ff   .......� ...�...�
0cc0  01 00 00 58 01 00 00 ff  01 00 00 88 01 00 00 ff   ...X...� ...�...�
0cd0  01 00 00 30 01 00 00 ff  01 00 00 d8 01 00 00 ff   ...0...� ...�...�
0ce0  01 00 00 80 01 00 00 ff  01 00 00 28 01 00 00 ff   ...�...� ...(...�
0cf0  01 00 00 d0 01 00 00 ff  01 00 00 58 01 00 00 ff   ...�...� ...X...�
0d00  01 00 00 00 01 00 00 ff  01 00 00 a8 01 00 00 ff   .......� ...�...�
0d10  01 00 00 50 01 00 00 ff  01 00 00 f8 01 00 00 ff   ...P...� ...�...�
0d20  01 00 00 a0 01 00 00 ff  01 00 00 d8 01 00 00 ff   ...�...� ...�...�
0d30  01 00 00 80 01 00 00 ff  01 00 00 28 01 00 00 ff   ...�...� ...(...�
0d40  01 00 00 d0 01 00 00 ff  01 00 00 78 01 00 00 ff   ...�...� ...x...�
0d50  01 00 00 20 01 00 00 ff  01 00 00 f0 01 00 00 ff   ... ...� ...�...�
0d60  01 00 00 98 01 00 00 ff  01 00 00 40 01 00 00 ff   ...�...� ...@...�
.....



6) I've attached a patch for ext/gd/libgd/gd_interpolation.c.  For your consideration.


</pre>
</div><h2>Patches</h2>
<p><a href='patch-add.php?bug_id=70976'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=70976'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_comment' ><a name="1448536806">&nbsp;</a><strong>[2015-11-26 11:20 UTC] emmanuel &#x64;&#111;&#x74; law &#x61;&#116; gmail &#x64;&#111;&#x74; com</strong>
<pre class='note'>I dont seem to have permission to upload patch files here. One can get it from :

<a href="https://www.dropbox.com/s/rr5xti66cpt17mn/gd_interpolation.patch?dl=0" rel="nofollow">https://www.dropbox.com/s/rr5xti66cpt17mn/gd_interpolation.patch?dl=0</a>
</pre>
</div><div class='comment type_log' ><a name="1449559431">&nbsp;</a><strong>[2015-12-08 07:23 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: stas</span>
</div></div></div><div class='comment type_log' ><a name="1450781356">&nbsp;</a><strong>[2015-12-22 10:49 UTC] <a href="//people.php.net/jpauli">jpauli@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To: stas</span>
<span class="added">+Assigned To: jpauli</span>
</div></div></div><div class='comment type_comment' ><a name="1450781406">&nbsp;</a><strong>[2015-12-22 10:50 UTC] <a href="//people.php.net/jpauli">jpauli@php.net</a></strong>
<pre class='note'>Thank you for your report.
Your patch has been commited and will be part of next PHP release.
</pre>
</div><div class='comment type_comment' ><a name="1451335734">&nbsp;</a><strong>[2015-12-28 20:48 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>In security repo as 4bb422343f29f06b7081323844d9b52e1a71e4a5
</pre>
</div><div class='comment type_comment' ><a name="1451374030">&nbsp;</a><strong>[2015-12-29 07:27 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Hi,

Thanks for the patch!

It is however incomplete, gdMaxColors apply only to palette image. True colors image can have color values ARGB where the integer representation is bigger that gdMaxColors.

It should be:

 if (bgcolor &lt; 0 || (!im-&gt;trueColor &amp;&amp; bgcolor &gt;= gdMaxColors)) {

I do not have git access right now, it would be nice if you can update the fix accordingly. Thanks!
</pre>
</div><div class='comment type_comment' ><a name="1451374668">&nbsp;</a><strong>[2015-12-29 07:37 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>As I took a 2nd thought about it, getting my memory back about what I did in this implementation, a better patch is to move this check after:

if (src-&gt;trueColor == 0) {
		if (bgcolor &gt;= 0) {
			bgcolor =  gdTrueColorAlpha(src-&gt;red[bgcolor], src-&gt;green[bgcolor], src-&gt;blue[bgcolor], src-&gt;alpha[bgcolor]);
		}
		gdImagePaletteToTrueColor(src);
	}

As this function only accepts truecolor, it converts the image to truecolor prior to any operation.

The check only needs to be bgcolor &lt; 0 then as true color values can be anything &gt; 0.
</pre>
</div><div class='comment type_comment' ><a name="1451375090">&nbsp;</a><strong>[2015-12-29 07:44 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>amended in 2baeb167a08b0186a885208bdc8b5871f1681dc8
</pre>
</div><div class='comment type_comment' ><a name="1451375252">&nbsp;</a><strong>[2015-12-29 07:47 UTC] emmanuel &#x64;&#111;&#x74; law &#x61;&#116; gmail &#x64;&#111;&#x74; com</strong>
<pre class='note'>I don't have permissions to see the commits but the first post by pajoye makes sense. The 2nd however doesn't IMHO. It is still exploitable if we do the check after:
if (src-&gt;trueColor == 0) {
		if (bgcolor &gt;= 0) {
			bgcolor =  gdTrueColorAlpha(src-&gt;red[bgcolor], src-&gt;green[bgcolor], src-&gt;blue[bgcolor], src-&gt;alpha[bgcolor]);
		}
		gdImagePaletteToTrueColor(src);
	}
</pre>
</div><div class='comment type_comment' ><a name="1451375256">&nbsp;</a><strong>[2015-12-29 07:47 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Not sure I got the last comment - if I move the check after using src-&gt;red[bgcolor], won't it be able to access src-&gt;red with invalid bgcolor values?
</pre>
</div><div class='comment type_comment' ><a name="1451375830">&nbsp;</a><strong>[2015-12-29 07:57 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>@emmanuel

You are right. Sorry for the confusion, some coffee is needed :)

the check should be done in this true clause (for palette images), like:
if (bgcolor &lt; 0) {
	return NULL;
}

if (src-&gt;trueColor == 0) {
	if (bgcolor &lt;= gdMaxColors) {
		bgcolor =  gdTrueColorAlpha(src-&gt;red[bgcolor], src-&gt;green[bgcolor], src-&gt;blue[bgcolor], src-&gt;alpha[bgcolor]);
	}
	gdImagePaletteToTrueColor(src);
}
</pre>
</div><div class='comment type_log' ><a name="1452050378">&nbsp;</a><strong>[2016-01-06 03:19 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_comment' ><a name="1452050378">&nbsp;</a><strong>[2016-01-06 03:19 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>The fix for this bug has been committed.

Snapshots of the sources are packaged every three hours; this change
will be in the next snapshot. You can grab the snapshot at
<a href="http://snaps.php.net/" rel="nofollow">http://snaps.php.net/</a>.

 For Windows:

<a href="http://windows.php.net/snapshots/" rel="nofollow">http://windows.php.net/snapshots/</a>
 
Thank you for the report, and for helping us make PHP better.


</pre>
</div><div class='comment type_svn' ><a name="1452051523">&nbsp;</a><strong>[2016-01-06 03:38 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_svn' ><a name="1452062052">&nbsp;</a><strong>[2016-01-06 06:34 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_svn' ><a name="1452062060">&nbsp;</a><strong>[2016-01-06 06:34 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_svn' ><a name="1452062074">&nbsp;</a><strong>[2016-01-06 06:34 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_svn' ><a name="1452062081">&nbsp;</a><strong>[2016-01-06 06:34 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=4bb422343f29f06b7081323844d9b52e1a71e4a5</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_svn' ><a name="1452062106">&nbsp;</a><strong>[2016-01-06 06:35 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=4b8394dd78571826ac66a69dc240c623f31d78f8" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=4b8394dd78571826ac66a69dc240c623f31d78f8</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div><div class='comment type_comment' ><a name="1452604077">&nbsp;</a><strong>[2016-01-12 13:07 UTC] <a href="//people.php.net/remi">remi@php.net</a></strong>
<pre class='note'>In 5.5.31/5.6.17/7.0.2

<a href="https://github.com/php/php-src/commit/4bb422343f29f06b7081323844d9b52e1a71e4a5" rel="nofollow">https://github.com/php/php-src/commit/4bb422343f29f06b7081323844d9b52e1a71e4a5</a>
<a href="https://github.com/php/php-src/commit/2baeb167a08b0186a885208bdc8b5871f1681dc8" rel="nofollow">https://github.com/php/php-src/commit/2baeb167a08b0186a885208bdc8b5871f1681dc8</a>

In next

<a href="https://github.com/php/php-src/commit/aa8d3a8cc612ba87c0497275f58a2317a90fb1c4" rel="nofollow">https://github.com/php/php-src/commit/aa8d3a8cc612ba87c0497275f58a2317a90fb1c4</a>
</pre>
</div><div class='comment type_log' ><a name="1452784498">&nbsp;</a><strong>[2016-01-14 15:14 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Closed</span>
<span class="added">+Status: Re-Opened</span>
</div></div></div><div class='comment type_comment' ><a name="1452784498">&nbsp;</a><strong>[2016-01-14 15:14 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>The patch is wrong and is a BC break.  That will basically break for any true color image with a background color value &gt; 256. gdMaxColors constant should never be used for truecolor images.



The test that should have modified is the one here:

<a href="https://github.com/php/php-src/blob/4bb422343f29f06b7081323844d9b52e1a71e4a5/ext/gd/libgd/gd_interpolation.c#L2165" rel="nofollow">https://github.com/php/php-src/blob/4bb422343f29f06b7081323844d9b52e1a71e4a5/ext/gd/libgd/gd_interpolation.c#L2165</a>

See my last comment here.

I supposed it is already released right?
</pre>
</div><div class='comment type_log' ><a name="1452796010">&nbsp;</a><strong>[2016-01-14 18:26 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Type: Security</span>
<span class="added">+Type: Bug</span>
</div></div></div><div class='comment type_log' ><a name="1453376785">&nbsp;</a><strong>[2016-01-21 11:46 UTC] <a href="//people.php.net/kaplan">kaplan@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-CVE-ID:</span>
<span class="added">+CVE-ID: CVEE-2016-1903</span>
</div></div></div><div class='comment type_log' ><a name="1454405497">&nbsp;</a><strong>[2016-02-02 09:31 UTC] <a href="//people.php.net/jpauli">jpauli@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Re-Opened</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_comment' ><a name="1454405498">&nbsp;</a><strong>[2016-02-02 09:31 UTC] <a href="//people.php.net/jpauli">jpauli@php.net</a></strong>
<pre class='note'>The fix for this bug has been committed.

Snapshots of the sources are packaged every three hours; this change
will be in the next snapshot. You can grab the snapshot at
<a href="http://snaps.php.net/" rel="nofollow">http://snaps.php.net/</a>.

 For Windows:

<a href="http://windows.php.net/snapshots/" rel="nofollow">http://windows.php.net/snapshots/</a>
 
Thank you for the report, and for helping us make PHP better.

BC fixed in 5.5.32 and up
</pre>
</div><div class='comment type_svn' ><a name="1469014461">&nbsp;</a><strong>[2016-07-20 11:34 UTC] <a href="//people.php.net/davey">davey@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=84b8db597ae597abce1977ce64dcf231e71330f9</a>
Log: Fix <a href='bug.php?id=70976'>bug #70976</a>: fix boundary check on gdImageRotateInterpolated
</pre>
</div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
