<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>BIP 0030 - Bitcoin Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"BIP_0030","wgTitle":"BIP 0030","wgCurRevisionId":66842,"wgRevisionId":66842,"wgArticleId":1794,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["BIP"],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"BIP_0030","wgRelevantArticleId":1794,"wgRequestId":"e8d1c79937e7ce340657852f","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"preview":true,"publish":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0ft0puh",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector" />
<script async="" src="/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector" />
<meta name="generator" content="MediaWiki 1.30.0" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Bitcoin Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://en.bitcoin.it/w/api.php?action=rsd" />
<link rel="license" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Bitcoin Wiki Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-BIP_0030 rootpage-BIP_0030 skin-vector action-view"> <div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">BIP 0030</h1>
<div id="bodyContent" class="mw-body-content">
<div id="siteSub" class="noprint">From Bitcoin Wiki</div>
<div id="contentSub"></div>
<div id="jump-to-nav" class="mw-jump">
Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a>
</div>
<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><table class="mbox"><tr>
<td class="mbox-empty-cell"></td>
<td class="mbox-text">
<p><span style="font-size: 100%; font-weight: bold;">This page describes a BIP (Bitcoin Improvement Proposal).</span><br /><span style="font-size: 95%;">Please see <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bips/blob/master/bip-0002.mediawiki">BIP 2</a> for more information about BIPs and creating them. Please do not just create a wiki page.</span><br />
</p>
</td>
</tr>
</table>
<table class="mbox"><tr>
<td class="mbox-empty-cell"></td>
<td class="mbox-text">
<p><span style="font-size: 95%;"><big><b>Please do not modify this page. This is a mirror of the BIP from the source Git repository <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bips/blob/master/bip-0030.mediawiki">here</a>.</b></big></span><br />
</p>
</td>
</tr>
</table>
<pre>
  BIP: 30
  Layer: Consensus (soft fork)
  Title: Duplicate transactions
  Author: Pieter Wuille &lt;pieter.wuille@gmail.com&gt;
  Comments-Summary: No comments yet.
  Comments-URI: https://github.com/bitcoin/bips/wiki/Comments:BIP-0030
  Status: Final
  Type: Standards Track
  Created: 2012-02-22
  License: BSD-2-Clause
</pre>
<div id="toc" class="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Abstract"><span class="tocnumber">1</span> <span class="toctext">Abstract</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Copyright"><span class="tocnumber">2</span> <span class="toctext">Copyright</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Motivation"><span class="tocnumber">3</span> <span class="toctext">Motivation</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Specification"><span class="tocnumber">4</span> <span class="toctext">Specification</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Rationale"><span class="tocnumber">5</span> <span class="toctext">Rationale</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Backward_compatibility"><span class="tocnumber">6</span> <span class="toctext">Backward compatibility</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Implementation"><span class="tocnumber">7</span> <span class="toctext">Implementation</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Acknowledgements"><span class="tocnumber">8</span> <span class="toctext">Acknowledgements</span></a></li>
</ul>
</div>
<h2><span class="mw-headline" id="Abstract">Abstract</span></h2>
<p>This document gives a specification for dealing with duplicate transactions in the block chain, in an attempt to solve certain problems the reference implementation has with them.
</p>
<h2><span class="mw-headline" id="Copyright">Copyright</span></h2>
<p>This BIP is licensed under the 2-clause BSD license.
</p>
<h2><span class="mw-headline" id="Motivation">Motivation</span></h2>
<p>So far, the Bitcoin reference implementation always assumed duplicate transactions (transactions with the same identifier) didn't exist. This is not true; in particular coinbases are easy to duplicate, and by building on duplicate coinbases, duplicate normal transactions are possible as well. Recently, an attack that exploits the reference implementation's dealing with duplicate transactions was described and demonstrated. It allows reverting fully-confirmed transactions to a single confirmation, making them vulnerable to become unspendable entirely. Another attack is possible that allows forking the block chain for a subset of the network.
</p>
<h2><span class="mw-headline" id="Specification">Specification</span></h2>
<p>To counter this problem, the following network rule is introduced:
</p>
<ul><li>Blocks are not allowed to contain a transaction whose identifier matches that of an earlier, not-fully-spent transaction in the same chain.</li></ul>
<p>This rule initially applied to all blocks whose timestamp is after March 15, 2012, 00:00 UTC (testnet: February 20, 2012 00:00 UTC). It was later extended by Commit <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bitcoin/commit/ab91bf39b7c11e9c86bb2043c24f0f377f1cf514">Apply BIP30 checks to all blocks except the two historic violations.</a> to apply to all blocks except the two historic blocks at heights 91842 and 91880 on the main chain that had to be grandfathered in.
</p>
<h2><span class="mw-headline" id="Rationale">Rationale</span></h2>
<p>Whatever solution is used, the following law must be obeyed to guarantee sane behaviour: the set of usable
transactions outputs must not be modified by adding blocks to the chain and removing them again. This happens during
a reorganisation, and the current Bitcoin reference implementation does not obey this law in case the temporarily
added blocks contain a duplicate transaction.
</p><p>There are several potential solutions to this problem:
</p>
<ol><li>Guarantee that all coinbases are unique, making duplicate transactions very hard to create.</li>
<li>Remember previous remaining outputs of a given transaction identifier, in case a new transaction with the same identifier is added.</li>
<li>Only allow duplicate transactions in case the previous instance of the transaction had no spendable outputs left. Removing a block from the chain can then safely reset the removed transaction's outputs to nothing.</li></ol>
<p>The first option is probably the most complete one, as it also guarantees transaction identifiers are unique. However, implementing it requires several changes that need to be accepted throughout the network. Furthermore, it does not prevent duplicate transactions based on earlier duplicate coinbases. The second option is impossible to implement in a forward-compatible way, as it potentially renders currently-invalid blocks valid. In this document we choose for the third option, because it only requires a trivial change.
</p><p>Fully-spent transactions are allowed to be duplicated in order not to hinder pruning at some point in the future. Not allowing any transaction to be duplicated would require evidence to be kept for each transaction ever made.
</p>
<h2><span class="mw-headline" id="Backward_compatibility">Backward compatibility</span></h2>
<p>The addition of this rule only makes some previously-valid blocks invalid. This implies that if the rule is implemented by a supermajority of miners, it is not possible to fork the block chain in a permanent way between nodes with and without the new rule.
</p>
<h2><span class="mw-headline" id="Implementation">Implementation</span></h2>
<p>A patch for the reference client can be found on <a rel="nofollow" class="external free" href="https://github.com/sipa/bitcoin/tree/nooverwritetx">https://github.com/sipa/bitcoin/tree/nooverwritetx</a>
</p><p>This BIP was implemented in Commit <a rel="nofollow" class="external text" href="https://github.com/bitcoin/bitcoin/commit/a206b0ea12eb4606b93323268fc81a4f1f952531">Do not allow overwriting unspent transactions (BIP 30)</a>
There have been additional commits to refine the implementation of this BIP.
</p>
<h2><span class="mw-headline" id="Acknowledgements">Acknowledgements</span></h2>
<p>Thanks to Russell O'Connor for finding and demonstrating this problem, and helping test the patch.
</p>


</div>

</div> <div class="printfooter">
Retrieved from "<a dir="ltr" href="https://en.bitcoin.it/w/index.php?title=BIP_0030&amp;oldid=66842">https://en.bitcoin.it/w/index.php?title=BIP_0030&amp;oldid=66842</a>" </div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="/wiki/Special:Categories" title="Special:Categories">Category</a>: <ul><li><a href="/wiki/Category:BIP" title="Category:BIP">BIP</a></li></ul></div></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-createaccount"><a href="/w/index.php?title=Special:CreateAccount&amp;returnto=BIP+0030" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=BIP+0030" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li id="ca-nstab-main" class="selected"><span><a href="/wiki/BIP_0030" title="View the content page [c]" accesskey="c">Page</a></span></li>
<li id="ca-talk" class="new"><span><a href="/w/index.php?title=Talk:BIP_0030&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
<h3 id="p-views-label">Views</h3>
<ul>
<li id="ca-view" class="selected"><span><a href="/wiki/BIP_0030">Read</a></span></li>
<li id="ca-viewsource"><span><a href="/w/index.php?title=BIP_0030&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
<li id="ca-history" class="collapsible"><span><a href="/w/index.php?title=BIP_0030&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/w/index.php" id="searchform">
<div id="simpleSearch">
<input type="search" name="search" placeholder="Search Bitcoin Wiki" title="Search Bitcoin Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton" /> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="/wiki/Main_Page" title="Visit the main page"></a></div>
<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
<h3 id='p-navigation-label'>Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-Bitcoin-FAQ"><a href="/wiki/Help:FAQ">Bitcoin FAQ</a></li><li id="n-Editing-help"><a href="/wiki/Bitcoin_Wiki:Help">Editing help</a></li><li id="n-Forums"><a href="/wiki/Forums">Forums</a></li><li id="n-Chatrooms"><a href="/wiki/IRC_channels">Chatrooms</a></li><li id="n-Recent-changes"><a href="/wiki/Special:RecentChanges">Recent changes</a></li><li id="n-Page-index"><a href="/wiki/Special:AllPages">Page index</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
<h3 id='p-tb-label'>Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/BIP_0030" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/BIP_0030" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="/w/index.php?title=BIP_0030&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/w/index.php?title=BIP_0030&amp;oldid=66842" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/w/index.php?title=BIP_0030&amp;action=info" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-Sister_projects' aria-labelledby='p-Sister_projects-label'>
<h3 id='p-Sister_projects-label'>Sister projects</h3>
<div class="body">
<ul>
<li id="n-Essays"><a href="/wiki/Bitcoin_Wiki:Essay_main_page">Essays</a></li><li id="n-Source"><a href="/wiki/Bitcoin_Wiki:Source_main_page">Source</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 24 September 2019, at 17:59.</li>
<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="/wiki/Bitcoin_Wiki:Privacy_policy" title="Bitcoin Wiki:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="/wiki/Bitcoin_Wiki:About" title="Bitcoin Wiki:About">About Bitcoin Wiki</a></li>
<li id="footer-places-disclaimer"><a href="/wiki/Bitcoin_Wiki:General_disclaimer" title="Bitcoin Wiki:General disclaimer">Disclaimers</a></li>
</ul>
<ul id="footer-icons" class="noprint">
<li id="footer-poweredbyico">
<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/w/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /w/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.008","walltime":"0.009","ppvisitednodes":{"value":113,"limit":1000000},"ppgeneratednodes":{"value":408,"limit":1000000},"postexpandincludesize":{"value":1901,"limit":2097152},"templateargumentsize":{"value":832,"limit":2097152},"expansiondepth":{"value":5,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    5.279      1 -total"," 61.86%    3.266      1 Template:Bip"," 46.77%    2.469      2 Template:Ambox/message"," 36.46%    1.925      1 Template:BipMoved"]},"cachereport":{"timestamp":"20211030233309","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":41});});</script>
</body>
</html>
