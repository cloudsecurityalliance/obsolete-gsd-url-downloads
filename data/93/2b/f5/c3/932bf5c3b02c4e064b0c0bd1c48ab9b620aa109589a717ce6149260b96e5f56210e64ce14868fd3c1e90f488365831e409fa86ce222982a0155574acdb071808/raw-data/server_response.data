<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#960702 - ethtool -m values change when output is redirected - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=960702&quot;&gt;960702&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:960702@bugs.debian.org">#960702</a><br>
ethtool -m values change when output is redirected</h1>
<div class="versiongraph"><a href="version.cgi?absolute=0;found=linux%2F5.6.7-1;found=linux%2F4.19.118-2;found=linux%2F4.9.210-1;collapse=1;package=src%3Alinux;info=1"><img alt="version graph" src="version.cgi?package=src%3Alinux;height=2;collapse=1;width=2;found=linux%2F5.6.7-1;found=linux%2F4.19.118-2;found=linux%2F4.9.210-1;absolute=0"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?src=linux">src:linux</a>;
Maintainer for <a href="pkgreport.cgi?src=linux">src:linux</a> is <a href="pkgreport.cgi?maint=debian-kernel%40lists.debian.org">Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</a>; </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=bugs%40d6bell.net">&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</a></p>
  <p>Date: Fri, 15 May 2020 15:21:01 UTC</p>

<p>Severity: important</p>
<p>Tags: upstream</p>

<p>Found in versions linux/5.6.7-1, linux/4.19.118-2, linux/4.9.210-1</p>



<p>Forwarded to <a href="https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/">https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/</a></p>
</div>

<p><a href="mailto:960702@bugs.debian.org">Reply</a> or <a href="mailto:960702-subscribe@bugs.debian.org">subscribe</a> to this bug.</p>
<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=960702;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589556063 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Fri, 15 May 2020 15:21:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=2">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; -->
<!-- time:1589556063 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Fri, 15 May 2020 15:21:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=4">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=5">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=5">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20ethtool%20-m%20values%20change%20when%20output%20is%20redirected&amp;In-Reply-To=%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E&amp;References=%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E&amp;body=On%20Fri%2C%2015%20May%202020%2015%3A02%3A43%20%2B0000%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20wrote%3A%0A%3E%20Package%3A%20ethtool%0A%3E%20Version%3A%201%3A4.19-1%0A%3E%20Severity%3A%20important%0A%3E%20I%27m%20facing%20a%20very%20strange%20behavior.%20The%20command%20ethtool%20-m%20%20report%20the%20transceiver%20DOM%20values%20correctly%2C%20but%20when%20the%20command%20output%20is%20redirected%20to%20an%20other%20program%2C%20values%20change%20to%20somthing%20else.%0A%3E%20%0A%3E%20Here%20is%20a%20transcript%3A%0A%3E%20root%40localhost%3A~%23%20ethtool%20-m%20enp10s0%3B%20echo%20-e%20%27nnn%27%3B%20ethtool%20-m%20enp10s0%20%7C%20cat%0A%3E%20%20Identifier%20%3A%200x03%20%28SFP%29%0A%3E%20%20Extended%20identifier%20%3A%200x04%20%28GBIC%2FSFP%20defined%20by%202-wire%20interface%20ID%29%0A%3E%20%20Connector%20%3A%200x07%20%28LC%29%0A%3E%20%20Transceiver%20codes%20%3A%200x10%200x00%200x00%200x00%200x00%200x00%200x00%200x00%200x00%0A%3E%20%20Transceiver%20type%20%3A%2010G%20Ethernet%3A%2010G%20Base-SR%0A%3E%20%20Encoding%20%3A%200x06%20%2864B%2F66B%29%0A%3E%20%20BR%2C%20Nominal%20%3A%2010300MBd%0A%3E%20%20Rate%20identifier%20%3A%200x00%20%28unspecified%29%0A%3E%20%20Length%20%28SMF%2Ckm%29%20%3A%200km%0A%3E%20%20Length%20%28SMF%29%20%3A%200m%0A%3E%20%20Length%20%2850um%29%20%3A%2080m%0A%3E%20%20Length%20%2862.5um%29%20%3A%2020m%0A%3E%20%20Length%20%28Copper%29%20%3A%200m%0A%3E%20%20Length%20%28OM3%29%20%3A%20300m%0A%3E%20%20Laser%20wavelength%20%3A%20850nm%0A%3E%20%20Vendor%20name%20%3A%20Pureoptics%0A%3E%20%20Vendor%20OUI%20%3A%2000%3A00%3A00%0A%3E%20%20Vendor%20PN%20%3A%20EX-SFP-10GE-SR%0A%3E%20%20Vendor%20rev%20%3A%20B4%0A%3E%20%20Option%20values%20%3A%200x00%200x1a%0A%3E%20%20Option%20%3A%20RX_LOS%20implemented%0A%3E%20%20Option%20%3A%20TX_FAULT%20implemented%0A%3E%20%20Option%20%3A%20TX_DISABLE%20implemented%0A%3E%20%20BR%20margin%2C%20max%20%3A%200%25%0A%3E%20%20BR%20margin%2C%20min%20%3A%200%25%0A%3E%20%20Vendor%20SN%20%3A%20M4351243%0A%3E%20%20Date%20code%20%3A%20190515%0A%3E%20%20Optical%20diagnostics%20support%20%3A%20Yes%0A%3E%20%20Laser%20bias%20current%20%3A%2016.480%20mA%0A%3E%20%20Laser%20output%20power%20%3A%203.0768%20mW%20%2F%204.88%20dBm%0A%3E%20%20Receiver%20signal%20average%20optical%20power%20%3A%201.2298%20mW%20%2F%200.90%20dBm%0A%3E%20%20Module%20temperature%20%3A%2048.47%20degrees%20C%20%2F%20119.24%20degrees%20F%0A%3E%20%20Module%20voltage%20%3A%201.2336%20V%0A%3E%20%20Alarm%2Fwarning%20flags%20implemented%20%3A%20Yes%0A%3E%20%20Laser%20bias%20current%20high%20alarm%20%3A%20Off%0A%3E%20%20Laser%20bias%20current%20low%20alarm%20%3A%20Off%0A%3E%20%20Laser%20bias%20current%20high%20warning%20%3A%20Off%0A%3E%20%20Laser%20bias%20current%20low%20warning%20%3A%20Off%0A%3E%20%20Laser%20output%20power%20high%20alarm%20%3A%20Off%0A%3E%20%20Laser%20output%20power%20low%20alarm%20%3A%20Off%0A%3E%20%20Laser%20output%20power%20high%20warning%20%3A%20Off%0A%3E%20%20Laser%20output%20power%20low%20warning%20%3A%20Off%0A%3E%20%20Module%20temperature%20high%20alarm%20%3A%20Off%0A%3E%20%20Module%20temperature%20low%20alarm%20%3A%20Off%0A%3E%20%20Module%20temperature%20high%20warning%20%3A%20Off%0A%3E%20%20Module%20temperature%20low%20warning%20%3A%20Off%0A%3E%20%20Module%20voltage%20high%20alarm%20%3A%20Off%0A%3E%20%20Module%20voltage%20low%20alarm%20%3A%20Off%0A%3E%20%20Module%20voltage%20high%20warning%20%3A%20Off%0A%3E%20%20Module%20voltage%20low%20warning%20%3A%20Off%0A%3E%20%20Laser%20rx%20power%20high%20alarm%20%3A%20Off%0A%3E%20%20Laser%20rx%20power%20low%20alarm%20%3A%20Off%0A%3E%20%20Laser%20rx%20power%20high%20warning%20%3A%20Off%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=bugs%40d6bell.net" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</div>
<div class="header"><span class="headerfield">To:</span> submit@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> ethtool -m values change when output is redirected</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 15 May 2020 15:02:43 +0000</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=960702;msg=5">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Package: ethtool
Version: 1:4.19-1
Severity: important
I&#39;m facing a very strange behavior. The command ethtool -m  report the transceiver DOM values correctly, but when the command output is redirected to an other program, values change to somthing else.

Here is a transcript:
root@localhost:~# ethtool -m enp10s0; echo -e &#39;nnn&#39;; ethtool -m enp10s0 | cat
 Identifier : 0x03 (SFP)
 Extended identifier : 0x04 (GBIC/SFP defined by 2-wire interface ID)
 Connector : 0x07 (LC)
 Transceiver codes : 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
 Transceiver type : 10G Ethernet: 10G Base-SR
 Encoding : 0x06 (64B/66B)
 BR, Nominal : 10300MBd
 Rate identifier : 0x00 (unspecified)
 Length (SMF,km) : 0km
 Length (SMF) : 0m
 Length (50um) : 80m
 Length (62.5um) : 20m
 Length (Copper) : 0m
 Length (OM3) : 300m
 Laser wavelength : 850nm
 Vendor name : Pureoptics
 Vendor OUI : 00:00:00
 Vendor PN : EX-SFP-10GE-SR
 Vendor rev : B4
 Option values : 0x00 0x1a
 Option : RX_LOS implemented
 Option : TX_FAULT implemented
 Option : TX_DISABLE implemented
 BR margin, max : 0%
 BR margin, min : 0%
 Vendor SN : M4351243
 Date code : 190515
 Optical diagnostics support : Yes
 Laser bias current : 16.480 mA
 Laser output power : 3.0768 mW / 4.88 dBm
 Receiver signal average optical power : 1.2298 mW / 0.90 dBm
 Module temperature : 48.47 degrees C / 119.24 degrees F
 Module voltage : 1.2336 V
 Alarm/warning flags implemented : Yes
 Laser bias current high alarm : Off
 Laser bias current low alarm : Off
 Laser bias current high warning : Off
 Laser bias current low warning : Off
 Laser output power high alarm : Off
 Laser output power low alarm : Off
 Laser output power high warning : Off
 Laser output power low warning : Off
 Module temperature high alarm : Off
 Module temperature low alarm : Off
 Module temperature high warning : Off
 Module temperature low warning : Off
 Module voltage high alarm : Off
 Module voltage low alarm : Off
 Module voltage high warning : Off
 Module voltage low warning : Off
 Laser rx power high alarm : Off
 Laser rx power low alarm : Off
 Laser rx power high warning : Off
 Laser rx power low warning : Off
 Laser bias current high alarm threshold : 4.744 mA
 Laser bias current low alarm threshold : 49.896 mA
 Laser bias current high warning threshold : 51.776 mA
 Laser bias current low warning threshold : 50.910 mA
 Laser output power high alarm threshold : 2.5701 mW / 4.10 dBm
 Laser output power low alarm threshold : 0.8224 mW / -0.85 dBm
 Laser output power high warning threshold : 0.8224 mW / -0.85 dBm
 Laser output power low warning threshold : 0.8224 mW / -0.85 dBm
 Module temperature high alarm threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature low alarm threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature high warning threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature low warning threshold : 0.00 degrees C / 32.00 degrees F
 Module voltage high alarm threshold : 0.4356 V
 Module voltage low alarm threshold : 0.0000 V
 Module voltage high warning threshold : 0.0000 V
 Module voltage low warning threshold : 0.0000 V
 Laser rx power high alarm threshold : 0.8224 mW / -0.85 dBm
 Laser rx power low alarm threshold : 0.8224 mW / -0.85 dBm
 Laser rx power high warning threshold : 0.8224 mW / -0.85 dBm
 Laser rx power low warning threshold : 0.8224 mW / -0.85 dBm
 Identifier : 0x03 (SFP)
 Extended identifier : 0x04 (GBIC/SFP defined by 2-wire interface ID)
 Connector : 0x07 (LC)
 Transceiver codes : 0x10 0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
 Transceiver type : 10G Ethernet: 10G Base-SR
 Encoding : 0x06 (64B/66B)
 BR, Nominal : 10300MBd
 Rate identifier : 0x00 (unspecified)
 Length (SMF,km) : 0km
 Length (SMF) : 0m
 Length (50um) : 80m
 Length (62.5um) : 20m
 Length (Copper) : 0m
 Length (OM3) : 300m
 Laser wavelength : 850nm
 Vendor name : Pureoptics
 Vendor OUI : 00:00:00
 Vendor PN : EX-SFP-10GE-SR
 Vendor rev : B4
 Option values : 0x00 0x1a
 Option : RX_LOS implemented
 Option : TX_FAULT implemented
 Option : TX_DISABLE implemented
 BR margin, max : 0%
 BR margin, min : 0%
 Vendor SN : M4351243
 Date code : 190515
 Optical diagnostics support : Yes
 Laser bias current : 16.448 mA
 Laser output power : 0.8224 mW / -0.85 dBm
 Receiver signal average optical power : 0.8224 mW / -0.85 dBm
 Module temperature : 32.12 degrees C / 89.83 degrees F
 Module voltage : 0.8224 V
 Alarm/warning flags implemented : Yes
 Laser bias current high alarm : Off
 Laser bias current low alarm : Off
 Laser bias current high warning : Off
 Laser bias current low warning : Off
 Laser output power high alarm : Off
 Laser output power low alarm : Off
 Laser output power high warning : Off
 Laser output power low warning : Off
 Module temperature high alarm : Off
 Module temperature low alarm : Off
 Module temperature high warning : Off
 Module temperature low warning : Off
 Module voltage high alarm : On
 Module voltage low alarm : Off
 Module voltage high warning : On
 Module voltage low warning : Off
 Laser rx power high alarm : Off
 Laser rx power low alarm : Off
 Laser rx power high warning : Off
 Laser rx power low warning : Off
 Laser bias current high alarm threshold : 4.754 mA
 Laser bias current low alarm threshold : 51.402 mA
 Laser bias current high warning threshold : 56.552 mA
 Laser bias current low warning threshold : 53.964 mA
 Laser output power high alarm threshold : 2.6981 mW / 4.31 dBm
 Laser output power low alarm threshold : 2.9216 mW / 4.66 dBm
 Laser output power high warning threshold : 0.8224 mW / -0.85 dBm
 Laser output power low warning threshold : 0.8224 mW / -0.85 dBm
 Module temperature high alarm threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature low alarm threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature high warning threshold : 0.00 degrees C / 32.00 degrees F
 Module temperature low warning threshold : 0.00 degrees C / 32.00 degrees F
 Module voltage high alarm threshold : 0.4368 V
 Module voltage low alarm threshold : 0.0000 V
 Module voltage high warning threshold : 0.0000 V
 Module voltage low warning threshold : 0.0000 V
 Laser rx power high alarm threshold : 0.8224 mW / -0.85 dBm
 Laser rx power low alarm threshold : 0.8224 mW / -0.85 dBm
 Laser rx power high warning threshold : 0.8224 mW / -0.85 dBm
 Laser rx power low warning threshold : 0.8224 mW / -0.85 dBm
As you can see alsmost all mesuring values (C, V, mA and dBm) change. The values when output is redirected are unreliable which makes it impossible to use in a script. 
I am using Debian GNU/Linux 10 (buster), kernel 4.19.0-9-amd64 #1 SMP Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux and libc6 2.28-10

FYI, I could not reproduce the bug on Debian Stretch (ethtool 1:4.7-1+b1, kernel 4.9.0-11-amd64 and libc6 2.24-11+deb9u4).

--
Yannis Aribaud
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=960702;msg=5">Message part 2</a> (text/html, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589561644 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Fri, 15 May 2020 16:54:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=7">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: Bjørn Mork &lt;bjorn@mork.no&gt; -->
<!-- time:1589561644 -->
<strong>Acknowledgement sent</strong>
to <code>Bjørn Mork &lt;bjorn@mork.no&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Fri, 15 May 2020 16:54:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=9">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="10"></a><a name="msg10"></a><a href="#10">Message #10</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=10">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=10">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%20redirected&amp;body=On%20Fri%2C%2015%20May%202020%2018%3A40%3A34%20%2B0200%20%3D%3Futf-8%3FQ%3FBj%3DC3%3DB8rn_Mork%3F%3D%20%3Cbjorn%40mork.no%3E%20wrote%3A%0A%3E%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20writes%3A%0A%3E%20%0A%3E%20%3E%20Package%3A%20ethtool%0A%3E%20%3E%20Version%3A%201%3A4.19-1%0A%3E%20%3E%20Severity%3A%20important%0A%3E%20%3E%20I%27m%20facing%20a%20very%20strange%20behavior.%20The%20command%20ethtool%20-m%20%20report%20the%20transceiver%20DOM%20values%20correctly%2C%20but%20when%20the%20command%20output%20is%20redirected%20to%20an%20other%20program%2C%20values%20change%20to%20somthing%20else.%0A%3E%20%0A%3E%20AFAICS%2C%20your%20SFP%2B%20is%20reporting%20strange%20values%20in%20either%20case.%20%20I%20do%20not%0A%3E%20think%20any%20of%20these%20are%20correct.%20%20Looking%20at%20the%20non-redirected%20one%3A%0A%3E%20%0A%3E%20%3E%20%20Laser%20output%20power%20%3A%203.0768%20mW%20%2F%204.88%20dBm%0A%3E%20%0A%3E%20This%20is%20insanely%20high.%0A%3E%20%0A%3E%20%3E%20%20Receiver%20signal%20average%20optical%20power%20%3A%201.2298%20mW%20%2F%200.90%20dBm%0A%3E%20%3E%20%20Module%20temperature%20%3A%2048.47%20degrees%20C%20%2F%20119.24%20degrees%20F%0A%3E%20%3E%20%20Module%20voltage%20%3A%201.2336%20V%0A%3E%20%0A%3E%20Should%20be%203.3%20V%0A%3E%20%0A%3E%20%3E%20%20Laser%20bias%20current%20high%20alarm%20threshold%20%3A%204.744%20mA%0A%3E%20%3E%20%20Laser%20bias%20current%20low%20alarm%20threshold%20%3A%2049.896%20mA%0A%3E%20%0A%3E%20Right...%0A%3E%20%0A%3E%20%3E%20%20Laser%20output%20power%20high%20alarm%20threshold%20%3A%202.5701%20mW%20%2F%204.10%20dBm%0A%3E%20%0A%3E%20I%20don%27t%20think%20this%20can%20be%20trusted%20either%2C%20but%20I%20do%20note%20that%20it%20is%20lower%0A%3E%20than%20your%20current%20output.%0A%3E%20%0A%3E%20%3E%20%20Laser%20output%20power%20low%20alarm%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%3E%20%20Laser%20output%20power%20high%20warning%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%3E%20%20Laser%20output%20power%20low%20warning%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%0A%3E%20Strange%20limits.%20%20There%20are%20too%20many%20-0.85%20dBm%20values%20here.%0A%3E%20%0A%3E%20%3E%20%20Module%20temperature%20high%20alarm%20threshold%20%3A%200.00%20degrees%20C%20%2F%2032.00%20degrees%20F%0A%3E%20%3E%20%20Module%20temperature%20low%20alarm%20threshold%20%3A%200.00%20degrees%20C%20%2F%2032.00%20degrees%20F%0A%3E%20%3E%20%20Module%20temperature%20high%20warning%20threshold%20%3A%200.00%20degrees%20C%20%2F%2032.00%20degrees%20F%0A%3E%20%3E%20%20Module%20temperature%20low%20warning%20threshold%20%3A%200.00%20degrees%20C%20%2F%2032.00%20degrees%20F%0A%3E%20%0A%3E%20Makes%20no%20sense%20at%20all.%0A%3E%20%0A%3E%20%3E%20%20Module%20voltage%20high%20alarm%20threshold%20%3A%200.4356%20V%0A%3E%20%3E%20%20Module%20voltage%20low%20alarm%20threshold%20%3A%200.0000%20V%0A%3E%20%3E%20%20Module%20voltage%20high%20warning%20threshold%20%3A%200.0000%20V%0A%3E%20%3E%20%20Module%20voltage%20low%20warning%20threshold%20%3A%200.0000%20V%0A%3E%20%0A%3E%20Makes%20even%20less%20sense.%20%20%0A%3E%20%0A%3E%20%0A%3E%20%3E%20%20Laser%20rx%20power%20high%20alarm%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%3E%20%20Laser%20rx%20power%20low%20alarm%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%3E%20%20Laser%20rx%20power%20high%20warning%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%3E%20%20Laser%20rx%20power%20low%20warning%20threshold%20%3A%200.8224%20mW%20%2F%20-0.85%20dBm%0A%3E%20%0A%3E%20...%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C55adca23e66022801c156cdad9aece90__30555.0910228462%241589556093%24gmane%24org%40rcube.hebserv.net%3E%0A%20%3C87blmprw1p.fsf%40miraculix.mork.no%3E&amp;In-Reply-To=%3C87blmprw1p.fsf%40miraculix.mork.no%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=bjorn%40mork.no" alt="">
<div class="header"><span class="headerfield">From:</span> Bjørn Mork &lt;bjorn@mork.no&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is redirected</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 15 May 2020 18:40:34 +0200</div>
</div>
<pre class="message">&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; writes:

&gt; Package: ethtool
&gt; Version: 1:4.19-1
&gt; Severity: important
&gt; I&#39;m facing a very strange behavior. The command ethtool -m  report the transceiver DOM values correctly, but when the command output is redirected to an other program, values change to somthing else.

AFAICS, your SFP+ is reporting strange values in either case.  I do not
think any of these are correct.  Looking at the non-redirected one:

&gt;  Laser output power : 3.0768 mW / 4.88 dBm

This is insanely high.

&gt;  Receiver signal average optical power : 1.2298 mW / 0.90 dBm
&gt;  Module temperature : 48.47 degrees C / 119.24 degrees F
&gt;  Module voltage : 1.2336 V

Should be 3.3 V

&gt;  Laser bias current high alarm threshold : 4.744 mA
&gt;  Laser bias current low alarm threshold : 49.896 mA

Right...

&gt;  Laser output power high alarm threshold : 2.5701 mW / 4.10 dBm

I don&#39;t think this can be trusted either, but I do note that it is lower
than your current output.

&gt;  Laser output power low alarm threshold : 0.8224 mW / -0.85 dBm
&gt;  Laser output power high warning threshold : 0.8224 mW / -0.85 dBm
&gt;  Laser output power low warning threshold : 0.8224 mW / -0.85 dBm

Strange limits.  There are too many -0.85 dBm values here.

&gt;  Module temperature high alarm threshold : 0.00 degrees C / 32.00 degrees F
&gt;  Module temperature low alarm threshold : 0.00 degrees C / 32.00 degrees F
&gt;  Module temperature high warning threshold : 0.00 degrees C / 32.00 degrees F
&gt;  Module temperature low warning threshold : 0.00 degrees C / 32.00 degrees F

Makes no sense at all.

&gt;  Module voltage high alarm threshold : 0.4356 V
&gt;  Module voltage low alarm threshold : 0.0000 V
&gt;  Module voltage high warning threshold : 0.0000 V
&gt;  Module voltage low warning threshold : 0.0000 V

Makes even less sense.  


&gt;  Laser rx power high alarm threshold : 0.8224 mW / -0.85 dBm
&gt;  Laser rx power low alarm threshold : 0.8224 mW / -0.85 dBm
&gt;  Laser rx power high warning threshold : 0.8224 mW / -0.85 dBm
&gt;  Laser rx power low warning threshold : 0.8224 mW / -0.85 dBm

...



To me it looks like you are just reading arbitrary numbers from the
SFP+.  Try replacing it and see if the results are more reliable.



Bjørn


</pre>

<div class="infmessage"><hr><p>
<a name="11"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589564162 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Fri, 15 May 2020 17:36:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=12">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="13"></a>
<!-- request_addr: &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; -->
<!-- time:1589564163 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Fri, 15 May 2020 17:36:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=14">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="15"></a><a name="msg15"></a><a href="#15">Message #15</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=15">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=15">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%0A%20redirected&amp;References=%3C87blmprw1p.fsf%40miraculix.mork.no%3E%0A%20%3C55adca23e66022801c156cdad9aece90__30555.0910228462%241589556093%24gmane%24org%40rcube.hebserv.net%3E%0A%20%3C59dd792afbc71c5b042eb17c5702463b%40rcube.hebserv.net%3E&amp;In-Reply-To=%3C59dd792afbc71c5b042eb17c5702463b%40rcube.hebserv.net%3E&amp;body=On%20Fri%2C%2015%20May%202020%2017%3A14%3A17%20%2B0000%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20wrote%3A%0A%3E%2015%20mai%202020%2018%3A40%20%22Bj%C3%B8rn%20Mork%22%20%3Cbjorn%40mork.no%3E%20a%20%C3%A9crit%3A%0A%3E%20%0A%3E%20%3E%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20writes%3A%0A%3E%20%3E%20%0A%3E%20%3E%20%5B...%5D%0A%3E%20%3E%0A%3E%20%3E%20To%20me%20it%20looks%20like%20you%20are%20just%20reading%20arbitrary%20numbers%20from%20the%0A%3E%20%3E%20SFP%2B.%20Try%20replacing%20it%20and%20see%20if%20the%20results%20are%20more%20reliable.%0A%3E%20%0A%3E%20I%20will%20try%2C%20but%20I%20am%20seeing%20the%20same%20behavior%20and%20similar%20values%20on%202%20servers%20running%20the%20same%20hardware%20and%20the%20same%20software.%20The%20SFP%2B%20modules%20model%20is%20commonly%20used%20on%20our%20equipements%20%28servers%2C%20routers%2C%20switchs%29%20and%20we%20never%20had%20such%20issues.%0A%3E%20%0A%3E%20Values%20are%20clearly%20unreliable%20but%20not%20random%20at%20all.%20Values%20doesn%27t%20change%20between%20several%20runs%20of%20the%20command%20output%20redirected%20or%20not.%0A%3E%20%0A%3E%20I%20mean%20values%20obviously%20change%20between%20redirected%20output%20and%20non%20redirected%20output%20runs%2C%20but%20not%20much%20between%20several%20runs%20redirected%20and%20neither%20between%20several%20runs%20non%20redirected.%0A%3E%20%0A%3E%20Thus%20even%20if%20the%20values%20provided%20by%20the%20tranceivers%20are%20crazy%2C%20I%20see%20no%20reason%20seeing%20differences%20like%20those%20in%20values%20due%20to%20output%20redirect...%20I%20could%20not%20find%20any%20clue%20in%20the%20source%20code%20of%20ethtool%2C%20but%20I%20am%20no%20good%20developper%20at%20all.%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20%0A%3E%20--%20%0A%3E%20Yannis%20Aribaud%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=bugs%40d6bell.net" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;Bjørn Mork&quot; &lt;bjorn@mork.no&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is
 redirected</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 15 May 2020 17:14:17 +0000</div>
</div>
<pre class="message">15 mai 2020 18:40 &quot;Bjørn Mork&quot; &lt;bjorn@mork.no&gt; a écrit:

&gt; &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; writes:
&gt; 
&gt; [...]
&gt;
&gt; To me it looks like you are just reading arbitrary numbers from the
&gt; SFP+. Try replacing it and see if the results are more reliable.

I will try, but I am seeing the same behavior and similar values on 2 servers running the same hardware and the same software. The SFP+ modules model is commonly used on our equipements (servers, routers, switchs) and we never had such issues.

Values are clearly unreliable but not random at all. Values doesn&#39;t change between several runs of the command output redirected or not.

I mean values obviously change between redirected output and non redirected output runs, but not much between several runs redirected and neither between several runs non redirected.

Thus even if the values provided by the tranceivers are crazy, I see no reason seeing differences like those in values due to output redirect... I could not find any clue in the source code of ethtool, but I am no good developper at all.

Regards,

-- 
Yannis Aribaud


</pre>

<div class="infmessage"><hr><p>
<a name="16"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589585584 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Fri, 15 May 2020 23:33:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=17">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="18"></a>
<!-- request_addr: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- time:1589585584 -->
<strong>Acknowledgement sent</strong>
to <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Fri, 15 May 2020 23:33:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=19">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="20"></a><a name="msg20"></a><a href="#20">Message #20</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=20">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=20">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%20redirected&amp;body=On%20Sat%2C%2016%20May%202020%2000%3A29%3A42%20%2B0100%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%20wrote%3A%0A%3E%20Control%3A%20tag%20-1%20moreinfo%0A%3E%20%0A%3E%20On%20Fri%2C%202020-05-15%20at%2015%3A02%20%2B0000%2C%20Yannis%20Aribaud%20wrote%3A%0A%3E%20%3E%20Package%3A%20ethtool%0A%3E%20%3E%20Version%3A%201%3A4.19-1%0A%3E%20%3E%20Severity%3A%20important%0A%3E%20%3E%20I%27m%20facing%20a%20very%20strange%20behavior.%20The%20command%20ethtool%20-m%20%20report%0A%3E%20%3E%20the%20transceiver%20DOM%20values%20correctly%2C%20but%20when%20the%20command%20output%20is%0A%3E%20%3E%20redirected%20to%20an%20other%20program%2C%20values%20change%20to%20somthing%20else.%0A%3E%20%5B...%5D%0A%3E%20%3E%20As%20you%20can%20see%20alsmost%20all%20mesuring%20values%20%28C%2C%20V%2C%20mA%20and%20dBm%29%20change.%0A%3E%20%3E%20The%20values%20when%20output%20is%20redirected%20are%20unreliable%20which%20makes%20it%0A%3E%20%3E%20impossible%20to%20use%20in%20a%20script.%20%0A%3E%20%0A%3E%20I%20suspect%20that%20ethtool%20is%20actually%20getting%20garbage%20data%20from%20the%0A%3E%20driver.%0A%3E%20%0A%3E%20%3E%20I%20am%20using%20Debian%20GNU%2FLinux%2010%20%28buster%29%2C%20kernel%204.19.0-9-amd64%20%231%20SMP%0A%3E%20%3E%20Debian%204.19.118-2%20%282020-04-29%29%20x86_64%20GNU%2FLinux%20and%20libc6%202.28-10%0A%3E%20%0A%3E%20And%20which%20network%20driver%20are%20you%20using%3F%0A%3E%20%0A%3E%20Ben.%0A%3E%20%0A%3E%20--%20%0A%3E%20Ben%20Hutchings%0A%3E%20It%27s%20easier%20to%20fight%20for%20one%27s%20principles%20than%20to%20live%20up%20to%20them.%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C364080478794eaa0c2e88c803837fcfe1d348a61.camel%40decadent.org.uk%3E&amp;References=%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E%0A%20%3C364080478794eaa0c2e88c803837fcfe1d348a61.camel%40decadent.org.uk%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ben%40decadent.org.uk" alt="">
<div class="header"><span class="headerfield">From:</span> Ben Hutchings &lt;ben@decadent.org.uk&gt;</div>
<div class="header"><span class="headerfield">To:</span> Yannis Aribaud &lt;bugs@d6bell.net&gt;, 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is redirected</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 16 May 2020 00:29:42 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=960702;msg=20">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Control: tag -1 moreinfo

On Fri, 2020-05-15 at 15:02 +0000, Yannis Aribaud wrote:
&gt; Package: ethtool
&gt; Version: 1:4.19-1
&gt; Severity: important
&gt; I&#39;m facing a very strange behavior. The command ethtool -m  report
&gt; the transceiver DOM values correctly, but when the command output is
&gt; redirected to an other program, values change to somthing else.
[...]
&gt; As you can see alsmost all mesuring values (C, V, mA and dBm) change.
&gt; The values when output is redirected are unreliable which makes it
&gt; impossible to use in a script. 

I suspect that ethtool is actually getting garbage data from the
driver.

&gt; I am using Debian GNU/Linux 10 (buster), kernel 4.19.0-9-amd64 #1 SMP
&gt; Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux and libc6 2.28-10

And which network driver are you using?

Ben.

-- 
Ben Hutchings
It&#39;s easier to fight for one&#39;s principles than to live up to them.


</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=960702;filename=signature.asc;msg=20">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="21"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589585584 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;moreinfo&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) moreinfo.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Fri, 15 May 2020 23:33:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=22">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=22">mbox</a>, <a href="#21">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="23"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589727243 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Sun, 17 May 2020 14:54:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=24">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=24">mbox</a>, <a href="#23">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="25"></a>
<!-- request_addr: &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; -->
<!-- time:1589727243 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Sun, 17 May 2020 14:54:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=26">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="27"></a><a name="msg27"></a><a href="#27">Message #27</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=27">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=27">mbox</a>, <a href="mailto:960702@bugs.debian.org?body=On%20Sun%2C%2017%20May%202020%2014%3A41%3A01%20%2B0000%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20wrote%3A%0A%3E%2016%20mai%202020%2001%3A29%20%22Ben%20Hutchings%22%20%3Cben%40decadent.org.uk%3E%20a%20%C3%A9crit%3A%0A%3E%20%0A%3E%20%3E%20Control%3A%20tag%20-1%20moreinfo%0A%3E%20%3E%20%0A%3E%20%3E%20%5B...%5D%0A%3E%20%3E%0A%3E%20%3E%3E%20I%20am%20using%20Debian%20GNU%2FLinux%2010%20%28buster%29%2C%20kernel%204.19.0-9-amd64%20%231%20SMP%0A%3E%20%3E%3E%20Debian%204.19.118-2%20%282020-04-29%29%20x86_64%20GNU%2FLinux%20and%20libc6%202.28-10%0A%3E%20%3E%20%0A%3E%20%3E%20And%20which%20network%20driver%20are%20you%20using%3F%0A%3E%20%0A%3E%20root%40localhost%3A~%23%20ethtool%20-i%20enp10s0%0A%3E%20driver%3A%20mlx4_en%0A%3E%20version%3A%204.0-0%0A%3E%20firmware-version%3A%202.42.5000%0A%3E%20expansion-rom-version%3A%20%0A%3E%20bus-info%3A%200000%3A0a%3A00.0%0A%3E%20supports-statistics%3A%20yes%0A%3E%20supports-test%3A%20yes%0A%3E%20supports-eeprom-access%3A%20no%0A%3E%20supports-register-dump%3A%20no%0A%3E%20supports-priv-flags%3A%20yes%0A%3E%20%0A%3E%20root%40localhost%3A~%23%20modinfo%20mlx4_en%20%0A%3E%20filename%3A%20%20%20%20%20%20%20%2Flib%2Fmodules%2F4.19.0-9-amd64%2Fkernel%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fmlx4_en.ko%0A%3E%20version%3A%20%20%20%20%20%20%20%204.0-0%0A%3E%20license%3A%20%20%20%20%20%20%20%20Dual%20BSD%2FGPL%0A%3E%20description%3A%20%20%20%20Mellanox%20ConnectX%20HCA%20Ethernet%20driver%0A%3E%20author%3A%20%20%20%20%20%20%20%20%20Liran%20Liss%2C%20Yevgeny%20Petrilin%0A%3E%20srcversion%3A%20%20%20%20%205E7CBA2E401F495296DC544%0A%3E%20depends%3A%20%20%20%20%20%20%20%20mlx4_core%2Cdevlink%0A%3E%20retpoline%3A%20%20%20%20%20%20Y%0A%3E%20intree%3A%20%20%20%20%20%20%20%20%20Y%0A%3E%20name%3A%20%20%20%20%20%20%20%20%20%20%20mlx4_en%0A%3E%20vermagic%3A%20%20%20%20%20%20%204.19.0-9-amd64%20SMP%20mod_unload%20modversions%20%0A%3E%20sig_id%3A%20%20%20%20%20%20%20%20%20PKCS%237%0A%3E%20signer%3A%20%20%20%20%20%20%20%20%20Debian%20Secure%20Boot%20CA%0A%3E%20sig_key%3A%20%20%20%20%20%20%20%20A7%3A46%3A8D%3AEF%0A%3E%20sig_hashalgo%3A%20%20%20sha256%0A%3E%20signature%3A%20%20%20%20%20%2027%3A8D%3A17%3A13%3AF5%3A5B%3AEA%3A8E%3ADC%3A88%3A30%3AFD%3A2C%3A89%3A50%3A64%3AE8%3A2A%3AC6%3A7A%3A%0A%3E%20%09%0925%3AF5%3A67%3AA9%3ADB%3A82%3ACD%3A5E%3A46%3A0E%3AF6%3A2A%3A2F%3A3F%3AEF%3A6B%3ABE%3AEF%3A49%3AAA%3A%0A%3E%20%09%0927%3A1D%3A4D%3A95%3A28%3AAA%3A6C%3A88%3A5A%3AB1%3AC7%3A75%3A5F%3AC2%3A78%3A71%3A7F%3A1B%3AFC%3ACC%3A%0A%3E%20%09%09E0%3AF4%3A33%3ADE%3A9E%3A51%3A99%3AC2%3AFE%3AD1%3A2A%3A9B%3AEF%3A17%3A63%3A5C%3A1E%3A29%3A9A%3A4F%3A%0A%3E%20%09%0900%3A56%3A6F%3A3E%3AED%3AC5%3A4A%3A72%3A63%3A8A%3A4C%3AEE%3A33%3AFD%3AFE%3A7C%3A73%3A2B%3AD0%3A0D%3A%0A%3E%20%09%0980%3A80%3AA0%3A91%3A36%3A0D%3A7E%3AB0%3AC2%3AAC%3A2D%3A5C%3AA3%3A55%3ABF%3A03%3A94%3A52%3A64%3A30%3A%0A%3E%20%09%09DF%3A14%3ABC%3AFB%3AAF%3A3B%3A60%3AD3%3A4C%3A02%3A78%3A4D%3A51%3A61%3AD8%3AF2%3AE4%3A02%3A9C%3AD5%3A%0A%3E%20%09%09A4%3A05%3A81%3AD9%3A47%3A92%3A5A%3AC2%3A0D%3AD5%3A00%3A71%3A37%3A85%3A9B%3AF4%3AE5%3A54%3A3F%3A22%3A%0A%3E%20%09%09CD%3A4C%3A67%3A12%3A63%3A15%3AC2%3A1D%3A87%3AC8%3A03%3A3C%3A4E%3A23%3A6C%3AA5%3AF3%3AC6%3A12%3A99%3A%0A%3E%20%09%090E%3AD1%3A40%3AAA%3A47%3A45%3A64%3A0F%3AAB%3AC2%3AE0%3A71%3A64%3A03%3AAD%3A4B%3AF2%3A0C%3A02%3AF3%3A%0A%3E%20%09%09D3%3AD5%3AE4%3A4C%3A26%3A63%3A14%3A93%3A46%3A5F%3A31%3A3B%3A4C%3A9B%3A4B%3A5D%3ACD%3A30%3AC0%3ADF%3A%0A%3E%20%09%0928%3A8A%3A4D%3A9A%3A0E%3AA8%3A5A%3A87%3AF4%3A7F%3ADD%3AF6%3A0E%3AA3%3A3A%3AB2%3A99%3AC0%3A75%3AF9%3A%0A%3E%20%09%0900%3A13%3AB0%3A44%3A06%3AD1%3A1C%3AFE%3A34%3AA1%3A77%3A36%3A2A%3A15%3A29%3AF7%0A%3E%20parm%3A%20%20%20%20%20%20%20%20%20%20%20udp_rss%3AEnable%20RSS%20for%20incoming%20UDP%20traffic%20or%20disabled%20%280%29%20%28uint%29%0A%3E%20parm%3A%20%20%20%20%20%20%20%20%20%20%20pfctx%3APriority%20based%20Flow%20Control%20policy%20on%20TX%5B7%3A0%5D.%20Per%20priority%20bit%20mask%20%28uint%29%0A%3E%20parm%3A%20%20%20%20%20%20%20%20%20%20%20pfcrx%3APriority%20based%20Flow%20Control%20policy%20on%20RX%5B7%3A0%5D.%20Per%20priority%20bit%20mask%20%28uint%29%0A%3E%20parm%3A%20%20%20%20%20%20%20%20%20%20%20inline_thold%3AThreshold%20for%20using%20inline%20data%20%28range%3A%2017-104%2C%20default%3A%20104%29%20%28uint%29%0A%3E%20%0A%3E%20Latest%20firmware%20available%20on%20Mellanox%20website%20for%20this%20NIC%20and%20default%20kernel%20driver.%0A%3E%20%0A%3E%20Regards%2C%0A&amp;In-Reply-To=%3C2109172183b1dbc58d54d30a5974d1a8%40rcube.hebserv.net%3E&amp;References=%3C364080478794eaa0c2e88c803837fcfe1d348a61.camel%40decadent.org.uk%3E%0A%20%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E%0A%20%3C2109172183b1dbc58d54d30a5974d1a8%40rcube.hebserv.net%3E&amp;subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%0A%20redirected">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=bugs%40d6bell.net" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;Ben Hutchings&quot; &lt;ben@decadent.org.uk&gt;, 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is
 redirected</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 17 May 2020 14:41:01 +0000</div>
</div>
<pre class="message">16 mai 2020 01:29 &quot;Ben Hutchings&quot; &lt;ben@decadent.org.uk&gt; a écrit:

&gt; Control: tag -1 moreinfo
&gt; 
&gt; [...]
&gt;
&gt;&gt; I am using Debian GNU/Linux 10 (buster), kernel 4.19.0-9-amd64 #1 SMP
&gt;&gt; Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux and libc6 2.28-10
&gt; 
&gt; And which network driver are you using?

root@localhost:~# ethtool -i enp10s0
driver: mlx4_en
version: 4.0-0
firmware-version: 2.42.5000
expansion-rom-version: 
bus-info: 0000:0a:00.0
supports-statistics: yes
supports-test: yes
supports-eeprom-access: no
supports-register-dump: no
supports-priv-flags: yes

root@localhost:~# modinfo mlx4_en 
filename:       /lib/modules/4.19.0-9-amd64/kernel/drivers/net/ethernet/mellanox/mlx4/mlx4_en.ko
version:        4.0-0
license:        Dual BSD/GPL
description:    Mellanox ConnectX HCA Ethernet driver
author:         Liran Liss, Yevgeny Petrilin
srcversion:     5E7CBA2E401F495296DC544
depends:        mlx4_core,devlink
retpoline:      Y
intree:         Y
name:           mlx4_en
vermagic:       4.19.0-9-amd64 SMP mod_unload modversions 
sig_id:         PKCS#7
signer:         Debian Secure Boot CA
sig_key:        A7:46:8D:EF
sig_hashalgo:   sha256
signature:      27:8D:17:13:F5:5B:EA:8E:DC:88:30:FD:2C:89:50:64:E8:2A:C6:7A:
		25:F5:67:A9:DB:82:CD:5E:46:0E:F6:2A:2F:3F:EF:6B:BE:EF:49:AA:
		27:1D:4D:95:28:AA:6C:88:5A:B1:C7:75:5F:C2:78:71:7F:1B:FC:CC:
		E0:F4:33:DE:9E:51:99:C2:FE:D1:2A:9B:EF:17:63:5C:1E:29:9A:4F:
		00:56:6F:3E:ED:C5:4A:72:63:8A:4C:EE:33:FD:FE:7C:73:2B:D0:0D:
		80:80:A0:91:36:0D:7E:B0:C2:AC:2D:5C:A3:55:BF:03:94:52:64:30:
		DF:14:BC:FB:AF:3B:60:D3:4C:02:78:4D:51:61:D8:F2:E4:02:9C:D5:
		A4:05:81:D9:47:92:5A:C2:0D:D5:00:71:37:85:9B:F4:E5:54:3F:22:
		CD:4C:67:12:63:15:C2:1D:87:C8:03:3C:4E:23:6C:A5:F3:C6:12:99:
		0E:D1:40:AA:47:45:64:0F:AB:C2:E0:71:64:03:AD:4B:F2:0C:02:F3:
		D3:D5:E4:4C:26:63:14:93:46:5F:31:3B:4C:9B:4B:5D:CD:30:C0:DF:
		28:8A:4D:9A:0E:A8:5A:87:F4:7F:DD:F6:0E:A3:3A:B2:99:C0:75:F9:
		00:13:B0:44:06:D1:1C:FE:34:A1:77:36:2A:15:29:F7
parm:           udp_rss:Enable RSS for incoming UDP traffic or disabled (0) (uint)
parm:           pfctx:Priority based Flow Control policy on TX[7:0]. Per priority bit mask (uint)
parm:           pfcrx:Priority based Flow Control policy on RX[7:0]. Per priority bit mask (uint)
parm:           inline_thold:Threshold for using inline data (range: 17-104, default: 104) (uint)

Latest firmware available on Mellanox website for this NIC and default kernel driver.

Regards,

-- 
Yannis Aribaud


</pre>

<div class="infmessage"><hr><p>
<a name="28"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589731563 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>ethtool</code>.
 (Sun, 17 May 2020 16:06:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=29">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=29">mbox</a>, <a href="#28">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="30"></a>
<!-- request_addr: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- time:1589731563 -->
<strong>Acknowledgement sent</strong>
to <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Sun, 17 May 2020 16:06:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=31">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="32"></a><a name="msg32"></a><a href="#32">Message #32</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=32">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=32">mbox</a>, <a href="mailto:960702@bugs.debian.org?In-Reply-To=%3Ca60565c5cdd8ff4ae67ba76e419607c4597159ff.camel%40decadent.org.uk%3E&amp;References=%3C364080478794eaa0c2e88c803837fcfe1d348a61.camel%40decadent.org.uk%3E%0A%09%20%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E%0A%09%20%3C2109172183b1dbc58d54d30a5974d1a8%40rcube.hebserv.net%3E%0A%20%3Ca60565c5cdd8ff4ae67ba76e419607c4597159ff.camel%40decadent.org.uk%3E&amp;body=On%20Sun%2C%2017%20May%202020%2017%3A03%3A55%20%2B0100%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%20wrote%3A%0A%3E%20Control%3A%20tag%20-1%20-%20moreinfo%0A%3E%20Control%3A%20reassign%20-1%20src%3Alinux%0A%3E%20Control%3A%20found%20-1%204.9.210-1%0A%3E%20Control%3A%20found%20-1%204.19.118-2%0A%3E%20Control%3A%20found%20-1%205.6.7-1%0A%3E%20Control%3A%20tag%20-1%20security%0A%3E%20%0A%3E%20On%20Sun%2C%202020-05-17%20at%2014%3A41%20%2B0000%2C%20Yannis%20Aribaud%20wrote%3A%0A%3E%20%3E%2016%20mai%202020%2001%3A29%20%22Ben%20Hutchings%22%20%3Cben%40decadent.org.uk%3E%20a%20%C3%A9crit%3A%0A%3E%20%3E%20%0A%3E%20%3E%20%3E%20Control%3A%20tag%20-1%20moreinfo%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20%3E%20%5B...%5D%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20%3E%20%3E%20I%20am%20using%20Debian%20GNU%2FLinux%2010%20%28buster%29%2C%20kernel%204.19.0-9-amd64%20%231%20SMP%0A%3E%20%3E%20%3E%20%3E%20Debian%204.19.118-2%20%282020-04-29%29%20x86_64%20GNU%2FLinux%20and%20libc6%202.28-10%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20%3E%20And%20which%20network%20driver%20are%20you%20using%3F%0A%3E%20%3E%20%0A%3E%20%3E%20root%40localhost%3A~%23%20ethtool%20-i%20enp10s0%0A%3E%20%3E%20driver%3A%20mlx4_en%0A%3E%20%3E%20version%3A%204.0-0%0A%3E%20%3E%20firmware-version%3A%202.42.5000%0A%3E%20%3E%20expansion-rom-version%3A%20%0A%3E%20%3E%20bus-info%3A%200000%3A0a%3A00.0%0A%3E%20%3E%20supports-statistics%3A%20yes%0A%3E%20%3E%20supports-test%3A%20yes%0A%3E%20%3E%20supports-eeprom-access%3A%20no%0A%3E%20%3E%20supports-register-dump%3A%20no%0A%3E%20%3E%20supports-priv-flags%3A%20yes%0A%3E%20%3E%20%0A%3E%20%3E%20root%40localhost%3A~%23%20modinfo%20mlx4_en%20%0A%3E%20%3E%20filename%3A%20%20%20%20%20%20%20%2Flib%2Fmodules%2F4.19.0-9-amd64%2Fkernel%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fmlx4_en.ko%0A%3E%20%5B...%5D%0A%3E%20%0A%3E%20Right%2C%20this%20turns%20to%20have%20exactly%20the%20bug%20I%20suspected.%20%3A-%2F%0A%3E%20%0A%3E%20Tagged%20security%20because%20this%20is%20leaking%20kernel%20memory.%0A%3E%20%0A%3E%20Ben.%0A%3E%20%0A%3E%20--%20%0A%3E%20Ben%20Hutchings%0A%3E%20Logic%20doesn%27t%20apply%20to%20the%20real%20world.%20-%20Marvin%20Minsky%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%20redirected">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ben%40decadent.org.uk" alt="">
<div class="header"><span class="headerfield">From:</span> Ben Hutchings &lt;ben@decadent.org.uk&gt;</div>
<div class="header"><span class="headerfield">To:</span> Yannis Aribaud &lt;bugs@d6bell.net&gt;, 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is redirected</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 17 May 2020 17:03:55 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=960702;msg=32">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Control: tag -1 - moreinfo
Control: reassign -1 src:linux
Control: found -1 4.9.210-1
Control: found -1 4.19.118-2
Control: found -1 5.6.7-1
Control: tag -1 security

On Sun, 2020-05-17 at 14:41 +0000, Yannis Aribaud wrote:
&gt; 16 mai 2020 01:29 &quot;Ben Hutchings&quot; &lt;ben@decadent.org.uk&gt; a écrit:
&gt; 
&gt; &gt; Control: tag -1 moreinfo
&gt; &gt; 
&gt; &gt; [...]
&gt; &gt; 
&gt; &gt; &gt; I am using Debian GNU/Linux 10 (buster), kernel 4.19.0-9-amd64 #1 SMP
&gt; &gt; &gt; Debian 4.19.118-2 (2020-04-29) x86_64 GNU/Linux and libc6 2.28-10
&gt; &gt; 
&gt; &gt; And which network driver are you using?
&gt; 
&gt; root@localhost:~# ethtool -i enp10s0
&gt; driver: mlx4_en
&gt; version: 4.0-0
&gt; firmware-version: 2.42.5000
&gt; expansion-rom-version: 
&gt; bus-info: 0000:0a:00.0
&gt; supports-statistics: yes
&gt; supports-test: yes
&gt; supports-eeprom-access: no
&gt; supports-register-dump: no
&gt; supports-priv-flags: yes
&gt; 
&gt; root@localhost:~# modinfo mlx4_en 
&gt; filename:       /lib/modules/4.19.0-9-amd64/kernel/drivers/net/ethernet/mellanox/mlx4/mlx4_en.ko
[...]

Right, this turns to have exactly the bug I suspected. :-/

Tagged security because this is leaking kernel memory.

Ben.

-- 
Ben Hutchings
Logic doesn&#39;t apply to the real world. - Marvin Minsky

</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=960702;filename=signature.asc;msg=32">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="33"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731563 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;moreinfo&#39;
            };
-->
<strong>Removed tag(s) moreinfo.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=34">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="35"></a>
<!-- command:package -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731563 -->
<!-- new_data:
$new_data = {
              &#39;package&#39; =&gt; &#39;src:linux&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;package&#39; =&gt; &#39;ethtool&#39;
            };
-->
<strong>Bug reassigned from package &#39;<a href="pkgreport.cgi?package=ethtool">ethtool</a>&#39; to &#39;<a href="pkgreport.cgi?src=linux">src:linux</a>&#39;.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=36">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=36">mbox</a>, <a href="#35">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="37"></a>
<!-- command:found -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731564 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;ethtool/1:4.19-1&#39;
                                  ]
            };
-->
<strong>No longer marked as found in versions ethtool/1:4.19-1.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=38">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=38">mbox</a>, <a href="#37">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="39"></a>
<!-- command:found -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731565 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;linux/4.9.210-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<strong>Marked as found in versions linux/4.9.210-1.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:05 GMT) (<a href="bugreport.cgi?bug=960702;msg=40">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=40">mbox</a>, <a href="#39">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="41"></a>
<!-- command:found -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731566 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;linux/4.9.210-1&#39;,
                                    &#39;linux/4.19.118-2&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;linux/4.9.210-1&#39;
                                  ]
            };
-->
<strong>Marked as found in versions linux/4.19.118-2.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:06 GMT) (<a href="bugreport.cgi?bug=960702;msg=42">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="43"></a>
<!-- command:found -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731567 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;linux/5.6.7-1&#39;,
                                    &#39;linux/4.19.118-2&#39;,
                                    &#39;linux/4.9.210-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;linux/4.9.210-1&#39;,
                                    &#39;linux/4.19.118-2&#39;
                                  ]
            };
-->
<strong>Marked as found in versions linux/5.6.7-1.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:07 GMT) (<a href="bugreport.cgi?bug=960702;msg=44">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="45"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- request_addr: 960702-submit@bugs.debian.org -->
<!-- time:1589731567 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) security.</strong>
Request was from <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>
to <code>960702-submit@bugs.debian.org</code>.
 (Sun, 17 May 2020 16:06:07 GMT) (<a href="bugreport.cgi?bug=960702;msg=46">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=46">mbox</a>, <a href="#45">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="47"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589736242 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>src:linux</code>.
 (Sun, 17 May 2020 17:24:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=48">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=48">mbox</a>, <a href="#47">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="49"></a>
<!-- request_addr: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- time:1589736242 -->
<strong>Acknowledgement sent</strong>
to <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Sun, 17 May 2020 17:24:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=50">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=50">mbox</a>, <a href="#49">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="51"></a><a name="msg51"></a><a href="#51">Message #51</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=51">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=51">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20%5BPATCH%20net%5D%20mlx4%3A%20Fix%20information%20leak%20on%20failure%20to%20read%20module%0A%20EEPROM&amp;In-Reply-To=%3C20200517172053.GA734488%40decadent.org.uk%3E&amp;References=%3C20200517172053.GA734488%40decadent.org.uk%3E&amp;body=On%20Sun%2C%2017%20May%202020%2018%3A20%3A53%20%2B0100%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%20wrote%3A%0A%3E%20mlx4_en_get_module_eeprom%28%29%20returns%200%20even%20if%20it%20fails.%20%20This%20results%0A%3E%20in%20copying%20an%20uninitialised%20%28or%20partly%20initialised%29%20buffer%20back%20to%0A%3E%20user-space.%0A%3E%20%0A%3E%20Change%20it%20so%20that%3A%0A%3E%20%0A%3E%20%2A%20In%20the%20special%20case%20that%20the%20DOM%20turns%20out%20not%20to%20be%20readable%2C%20the%0A%3E%20%20%20remaining%20part%20of%20the%20buffer%20is%20cleared.%20%20This%20should%20avoid%20a%0A%3E%20%20%20regression%20when%20reading%20modules%20with%20this%20problem.%0A%3E%20%0A%3E%20%2A%20In%20other%20error%20cases%2C%20the%20error%20code%20is%20propagated.%0A%3E%20%0A%3E%20Reported-by%3A%20Yannis%20Aribaud%20%3Cbugs%40d6bell.net%3E%0A%3E%20References%3A%20https%3A%2F%2Fbugs.debian.org%2F960702%0A%3E%20Fixes%3A%207202da8b7f71%20%28%22ethtool%2C%20net%2Fmlx4_en%3A%20Cable%20info%2C%20get_module_info%2F...%22%29%0A%3E%20Signed-off-by%3A%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%0A%3E%20---%0A%3E%20This%20is%20compile-tested%20only.%20%20It%20should%20go%20to%20stable%2C%20if%20it%20is%20a%0A%3E%20correct%20fix.%0A%3E%20%0A%3E%20Ben.%0A%3E%20%0A%3E%20%20drivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%20%7C%207%20%2B%2B%2B%2B%2B--%0A%3E%20%201%20file%20changed%2C%205%20insertions%28%2B%29%2C%202%20deletions%28-%29%0A%3E%20%0A%3E%20diff%20--git%20a%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%20b%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0A%3E%20index%208a5ea2543670..6edc3177af1c%20100644%0A%3E%20---%20a%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0A%3E%20%2B%2B%2B%20b%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0A%3E%20%40%40%20-2078%2C14%20%2B2078%2C17%20%40%40%20static%20int%20mlx4_en_get_module_eeprom%28struct%20net_device%20%2Adev%2C%0A%3E%20%20%09%09ret%20%3D%20mlx4_get_module_info%28mdev-%3Edev%2C%20priv-%3Eport%2C%0A%3E%20%20%09%09%09%09%09%20%20%20offset%2C%20ee-%3Elen%20-%20i%2C%20data%20%2B%20i%29%3B%0A%3E%20%20%0A%3E%20-%09%09if%20%28%21ret%29%20%2F%2A%20Done%20reading%20%2A%2F%0A%3E%20%2B%09%09if%20%28%21ret%29%20%7B%0A%3E%20%2B%09%09%09%2F%2A%20DOM%20was%20not%20readable%20after%20all%20%2A%2F%0A%3E%20%2B%09%09%09memset%28data%20%2B%20i%2C%200%2C%20ee-%3Elen%20-%20i%29%3B%0A%3E%20%20%09%09%09return%200%3B%0A%3E%20%2B%09%09%7D%0A%3E%20%20%0A%3E%20%20%09%09if%20%28ret%20%3C%200%29%20%7B%0A%3E%20%20%09%09%09en_err%28priv%2C%0A%3E%20%20%09%09%09%20%20%20%20%20%20%20%22mlx4_get_module_info%20i%28%25d%29%20offset%28%25d%29%20bytes_to_read%28%25d%29%20-%20FAILED%20%280x%25x%29%5Cn%22%2C%0A%3E%20%20%09%09%09%20%20%20%20%20%20%20i%2C%20offset%2C%20ee-%3Elen%20-%20i%2C%20ret%29%3B%0A%3E%20-%09%09%09return%200%3B%0A%3E%20%2B%09%09%09return%20ret%3B%0A%3E%20%20%09%09%7D%0A%3E%20%20%0A%3E%20%20%09%09i%20%2B%3D%20ret%3B%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ben%40decadent.org.uk" alt="">
<div class="header"><span class="headerfield">From:</span> Ben Hutchings &lt;ben@decadent.org.uk&gt;</div>
<div class="header"><span class="headerfield">To:</span> Tariq Toukan &lt;tariqt@mellanox.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 960702@bugs.debian.org, netdev@vger.kernel.org</div>
<div class="header"><span class="headerfield">Subject:</span> [PATCH net] mlx4: Fix information leak on failure to read module
 EEPROM</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 17 May 2020 18:20:53 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=960702;msg=51">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">mlx4_en_get_module_eeprom() returns 0 even if it fails.  This results
in copying an uninitialised (or partly initialised) buffer back to
user-space.

Change it so that:

* In the special case that the DOM turns out not to be readable, the
  remaining part of the buffer is cleared.  This should avoid a
  regression when reading modules with this problem.

* In other error cases, the error code is propagated.

Reported-by: Yannis Aribaud &lt;bugs@d6bell.net&gt;
References: <a href="https://bugs.debian.org/960702">https://bugs.debian.org/960702</a>
Fixes: 7202da8b7f71 (&quot;ethtool, net/mlx4_en: Cable info, get_module_info/...&quot;)
Signed-off-by: Ben Hutchings &lt;ben@decadent.org.uk&gt;
---
This is compile-tested only.  It should go to stable, if it is a
correct fix.

Ben.

 drivers/net/ethernet/mellanox/mlx4/en_ethtool.c | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c b/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
index 8a5ea2543670..6edc3177af1c 100644
--- a/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
+++ b/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
@@ -2078,14 +2078,17 @@ static int mlx4_en_get_module_eeprom(struct net_device *dev,
 		ret = mlx4_get_module_info(mdev-&gt;dev, priv-&gt;port,
 					   offset, ee-&gt;len - i, data + i);
 
-		if (!ret) /* Done reading */
+		if (!ret) {
+			/* DOM was not readable after all */
+			memset(data + i, 0, ee-&gt;len - i);
 			return 0;
+		}
 
 		if (ret &lt; 0) {
 			en_err(priv,
 			       &quot;mlx4_get_module_info i(%d) offset(%d) bytes_to_read(%d) - FAILED (0x%x)\n&quot;,
 			       i, offset, ee-&gt;len - i, ret);
-			return 0;
+			return ret;
 		}
 
 		i += ret;
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=960702;filename=signature.asc;msg=51">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="52"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;benh@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1589738222 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;patch upstream security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<strong>Added tag(s) upstream and patch.</strong>
Request was from <code>Ben Hutchings &lt;benh@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sun, 17 May 2020 17:57:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=53">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=53">mbox</a>, <a href="#52">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="54"></a>
<!-- command:forwarded -->
<!-- requester: Ben Hutchings &lt;benh@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1589738223 -->
<!-- new_data:
$new_data = {
              &#39;forwarded&#39; =&gt; &#39;<a href="https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/">https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/</a>&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;forwarded&#39; =&gt; &#39;&#39;
            };
-->
<strong>Set Bug forwarded-to-address to &#39;<a href="https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/">https://lore.kernel.org/netdev/20200517172053.GA734488@decadent.org.uk/T/</a>&#39;.</strong>
Request was from <code>Ben Hutchings &lt;benh@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sun, 17 May 2020 17:57:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=55">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=55">mbox</a>, <a href="#54">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="56"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589796542 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>src:linux</code>.
 (Mon, 18 May 2020 10:09:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=57">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=57">mbox</a>, <a href="#56">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="58"></a>
<!-- request_addr: &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt; -->
<!-- time:1589796542 -->
<strong>Acknowledgement sent</strong>
to <code>&quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Mon, 18 May 2020 10:09:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=59">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=59">mbox</a>, <a href="#58">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="60"></a><a name="msg60"></a><a href="#60">Message #60</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=60">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=60">mbox</a>, <a href="mailto:960702@bugs.debian.org?In-Reply-To=%3C75da53f5ad74249840040ba0d930fbb9%40rcube.hebserv.net%3E&amp;References=%3Ca60565c5cdd8ff4ae67ba76e419607c4597159ff.camel%40decadent.org.uk%3E%0A%20%3C364080478794eaa0c2e88c803837fcfe1d348a61.camel%40decadent.org.uk%3E%0A%20%3C55adca23e66022801c156cdad9aece90%40rcube.hebserv.net%3E%0A%20%3C2109172183b1dbc58d54d30a5974d1a8%40rcube.hebserv.net%3E%0A%20%3C75da53f5ad74249840040ba0d930fbb9%40rcube.hebserv.net%3E&amp;body=On%20Mon%2C%2018%20May%202020%2009%3A55%3A10%20%2B0000%20%22Yannis%20Aribaud%22%20%3Cbugs%40d6bell.net%3E%20wrote%3A%0A%3E%2017%20mai%202020%2018%3A04%20%22Ben%20Hutchings%22%20%3Cben%40decadent.org.uk%3E%20a%20%C3%A9crit%3A%0A%3E%20%0A%3E%20%3E%20%5B...%5D%0A%3E%20%0A%3E%20Just%20in%20case%20that%20could%20be%20usefull.%20We%20change%20the%20transceiver%20for%20an%20other%20model%20also%20known%20to%20work%20correctly.%0A%3E%20%0A%3E%20root%40localhost%3A~%23%20ethtool%20-m%20enp10s0%20%0A%3E%20%09Identifier%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x03%20%28SFP%29%0A%3E%20%09Extended%20identifier%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x04%20%28GBIC%2FSFP%20defined%20by%202-wire%20interface%20ID%29%0A%3E%20%09Connector%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x07%20%28LC%29%0A%3E%20%09Transceiver%20codes%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x10%200x00%200x00%200x00%200x40%200x00%200x0c%200x00%200x00%0A%3E%20%09Transceiver%20type%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%2010G%20Ethernet%3A%2010G%20Base-SR%0A%3E%20%09Transceiver%20type%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20FC%3A%20short%20distance%20%28S%29%0A%3E%20%09Transceiver%20type%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20FC%3A%20Multimode%2C%2062.5um%20%28M6%29%0A%3E%20%09Transceiver%20type%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20FC%3A%20Multimode%2C%2050um%20%28M5%29%0A%3E%20%09Encoding%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x06%20%2864B%2F66B%29%0A%3E%20%09BR%2C%20Nominal%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%2010300MBd%0A%3E%20%09Rate%20identifier%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x00%20%28unspecified%29%0A%3E%20%09Length%20%28SMF%2Ckm%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200km%0A%3E%20%09Length%20%28SMF%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200m%0A%3E%20%09Length%20%2850um%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20300m%0A%3E%20%09Length%20%2862.5um%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20150m%0A%3E%20%09Length%20%28Copper%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200m%0A%3E%20%09Length%20%28OM3%29%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200m%0A%3E%20%09Laser%20wavelength%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20850nm%0A%3E%20%09Vendor%20name%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20FiberStore%0A%3E%20%09Vendor%20OUI%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%2000%3A90%3A65%0A%3E%20%09Vendor%20PN%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20SFP-10GSR-85%0A%3E%20%09Vendor%20rev%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20A%0A%3E%20%09Option%20values%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200x00%200x1a%0A%3E%20%09Option%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20RX_LOS%20implemented%0A%3E%20%09Option%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20TX_FAULT%20implemented%0A%3E%20%09Option%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20TX_DISABLE%20implemented%0A%3E%20%09BR%20margin%2C%20max%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200%25%0A%3E%20%09BR%20margin%2C%20min%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%200%25%0A%3E%20%09Vendor%20SN%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20N3612030002%0A%3E%20%09Date%20code%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20161203%0A%3E%20%09Optical%20diagnostics%20support%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Yes%0A%3E%20%09Laser%20bias%20current%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%2016.480%20mA%0A%3E%20%09Laser%20output%20power%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%203.0768%20mW%20%2F%204.88%20dBm%0A%3E%20%09Receiver%20signal%20average%20optical%20power%20%20%20%20%20%3A%201.2298%20mW%20%2F%200.90%20dBm%0A%3E%20%09Module%20temperature%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%2048.47%20degrees%20C%20%2F%20119.24%20degrees%20F%0A%3E%20%09Module%20voltage%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%201.2336%20V%0A%3E%20%09Alarm%2Fwarning%20flags%20implemented%20%20%20%20%20%20%20%20%20%20%20%3A%20Yes%0A%3E%20%09Laser%20bias%20current%20high%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20bias%20current%20low%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20bias%20current%20high%20warning%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20bias%20current%20low%20warning%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20output%20power%20high%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20output%20power%20low%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20output%20power%20high%20warning%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Laser%20output%20power%20low%20warning%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20temperature%20high%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20temperature%20low%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20temperature%20high%20warning%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20temperature%20low%20warning%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20voltage%20high%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20voltage%20low%20alarm%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20voltage%20high%20warning%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A%3E%20%09Module%20voltage%20low%20warning%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%3A%20Off%0A&amp;subject=Re%3A%20Bug%23960702%3A%20ethtool%20-m%20values%20change%20when%20output%20is%0A%20redirected">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=bugs%40d6bell.net" alt="">
<div class="header"><span class="headerfield">From:</span> &quot;Yannis Aribaud&quot; &lt;bugs@d6bell.net&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;Ben Hutchings&quot; &lt;ben@decadent.org.uk&gt;, 960702@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#960702: ethtool -m values change when output is
 redirected</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 18 May 2020 09:55:10 +0000</div>
</div>
<pre class="message">17 mai 2020 18:04 &quot;Ben Hutchings&quot; &lt;ben@decadent.org.uk&gt; a écrit:

&gt; [...]

Just in case that could be usefull. We change the transceiver for an other model also known to work correctly.

root@localhost:~# ethtool -m enp10s0 
	Identifier                                : 0x03 (SFP)
	Extended identifier                       : 0x04 (GBIC/SFP defined by 2-wire interface ID)
	Connector                                 : 0x07 (LC)
	Transceiver codes                         : 0x10 0x00 0x00 0x00 0x40 0x00 0x0c 0x00 0x00
	Transceiver type                          : 10G Ethernet: 10G Base-SR
	Transceiver type                          : FC: short distance (S)
	Transceiver type                          : FC: Multimode, 62.5um (M6)
	Transceiver type                          : FC: Multimode, 50um (M5)
	Encoding                                  : 0x06 (64B/66B)
	BR, Nominal                               : 10300MBd
	Rate identifier                           : 0x00 (unspecified)
	Length (SMF,km)                           : 0km
	Length (SMF)                              : 0m
	Length (50um)                             : 300m
	Length (62.5um)                           : 150m
	Length (Copper)                           : 0m
	Length (OM3)                              : 0m
	Laser wavelength                          : 850nm
	Vendor name                               : FiberStore
	Vendor OUI                                : 00:90:65
	Vendor PN                                 : SFP-10GSR-85
	Vendor rev                                : A
	Option values                             : 0x00 0x1a
	Option                                    : RX_LOS implemented
	Option                                    : TX_FAULT implemented
	Option                                    : TX_DISABLE implemented
	BR margin, max                            : 0%
	BR margin, min                            : 0%
	Vendor SN                                 : N3612030002
	Date code                                 : 161203
	Optical diagnostics support               : Yes
	Laser bias current                        : 16.480 mA
	Laser output power                        : 3.0768 mW / 4.88 dBm
	Receiver signal average optical power     : 1.2298 mW / 0.90 dBm
	Module temperature                        : 48.47 degrees C / 119.24 degrees F
	Module voltage                            : 1.2336 V
	Alarm/warning flags implemented           : Yes
	Laser bias current high alarm             : Off
	Laser bias current low alarm              : Off
	Laser bias current high warning           : Off
	Laser bias current low warning            : Off
	Laser output power high alarm             : Off
	Laser output power low alarm              : Off
	Laser output power high warning           : Off
	Laser output power low warning            : Off
	Module temperature high alarm             : Off
	Module temperature low alarm              : Off
	Module temperature high warning           : Off
	Module temperature low warning            : Off
	Module voltage high alarm                 : Off
	Module voltage low alarm                  : Off
	Module voltage high warning               : Off
	Module voltage low warning                : Off
	Laser rx power high alarm                 : Off
	Laser rx power low alarm                  : Off
	Laser rx power high warning               : Off
	Laser rx power low warning                : Off
	Laser bias current high alarm threshold   : 4.744 mA
	Laser bias current low alarm threshold    : 49.896 mA
	Laser bias current high warning threshold : 51.776 mA
	Laser bias current low warning threshold  : 50.910 mA
	Laser output power high alarm threshold   : 2.5701 mW / 4.10 dBm
	Laser output power low alarm threshold    : 0.8224 mW / -0.85 dBm
	Laser output power high warning threshold : 0.8224 mW / -0.85 dBm
	Laser output power low warning threshold  : 0.8224 mW / -0.85 dBm
	Module temperature high alarm threshold   : 0.00 degrees C / 32.00 degrees F
	Module temperature low alarm threshold    : 0.00 degrees C / 32.00 degrees F
	Module temperature high warning threshold : 0.00 degrees C / 32.00 degrees F
	Module temperature low warning threshold  : 0.00 degrees C / 32.00 degrees F
	Module voltage high alarm threshold       : 0.4356 V
	Module voltage low alarm threshold        : 0.0000 V
	Module voltage high warning threshold     : 0.0000 V
	Module voltage low warning threshold      : 0.0000 V
	Laser rx power high alarm threshold       : 0.8224 mW / -0.85 dBm
	Laser rx power low alarm threshold        : 0.8224 mW / -0.85 dBm
	Laser rx power high warning threshold     : 0.8224 mW / -0.85 dBm
	Laser rx power low warning threshold      : 0.8224 mW / -0.85 dBm

If I understood correctly, the driver is unable to read the DOM values correctly and return uninitialized values, which is a security issue (leaking kernel memory).
The fact that reading the DOM fails is an other issue (maybe Mellanox NIC firmware related ?). 

But why are the values changing when output is redirected ? Does it change the variables memory addresses or pointers values ? What mechanism is involved there ?

Best Regards,
-- 
Yannis Aribaud


</pre>

<div class="infmessage"><hr><p>
<a name="61"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589820662 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>src:linux</code>.
 (Mon, 18 May 2020 16:51:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=62">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=62">mbox</a>, <a href="#61">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="63"></a>
<!-- request_addr: Saeed Mahameed &lt;saeedm@mellanox.com&gt; -->
<!-- time:1589820662 -->
<strong>Acknowledgement sent</strong>
to <code>Saeed Mahameed &lt;saeedm@mellanox.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Mon, 18 May 2020 16:51:02 GMT) (<a href="bugreport.cgi?bug=960702;msg=64">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=64">mbox</a>, <a href="#63">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="65"></a><a name="msg65"></a><a href="#65">Message #65</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=65">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=65">mbox</a>, <a href="mailto:960702@bugs.debian.org?body=On%20Mon%2C%2018%20May%202020%2016%3A47%3A05%20%2B0000%20Saeed%20Mahameed%20%3Csaeedm%40mellanox.com%3E%20wrote%3A%0A%3E%20On%20Sun%2C%202020-05-17%20at%2018%3A20%20%2B0100%2C%20Ben%20Hutchings%20wrote%3A%0D%0A%3E%20%3E%20mlx4_en_get_module_eeprom%28%29%20returns%200%20even%20if%20it%20fails.%20%20This%20results%0D%0A%3E%20%3E%20in%20copying%20an%20uninitialised%20%28or%20partly%20initialised%29%20buffer%20back%20to%0D%0A%3E%20%3E%20user-space.%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20Change%20it%20so%20that%3A%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20%2A%20In%20the%20special%20case%20that%20the%20DOM%20turns%20out%20not%20to%20be%20readable%2C%20the%0D%0A%3E%20%3E%20%20%20remaining%20part%20of%20the%20buffer%20is%20cleared.%20%20This%20should%20avoid%20a%0D%0A%3E%20%3E%20%20%20regression%20when%20reading%20modules%20with%20this%20problem.%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20%2A%20In%20other%20error%20cases%2C%20the%20error%20code%20is%20propagated.%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20Reported-by%3A%20Yannis%20Aribaud%20%3Cbugs%40d6bell.net%3E%0D%0A%3E%20%3E%20References%3A%20https%3A%2F%2Fbugs.debian.org%2F960702%0D%0A%3E%20%3E%20Fixes%3A%207202da8b7f71%20%28%22ethtool%2C%20net%2Fmlx4_en%3A%20Cable%20info%2C%0D%0A%3E%20%3E%20get_module_info%2F...%22%29%0D%0A%3E%20%3E%20Signed-off-by%3A%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%0D%0A%3E%20%3E%20---%0D%0A%3E%20%3E%20This%20is%20compile-tested%20only.%20%20It%20should%20go%20to%20stable%2C%20if%20it%20is%20a%0D%0A%3E%20%3E%20correct%20fix.%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20Ben.%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20%20drivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%20%7C%207%20%2B%2B%2B%2B%2B--%0D%0A%3E%20%3E%20%201%20file%20changed%2C%205%20insertions%28%2B%29%2C%202%20deletions%28-%29%0D%0A%3E%20%3E%20%0D%0A%3E%20%3E%20diff%20--git%20a%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0D%0A%3E%20%3E%20b%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0D%0A%3E%20%3E%20index%208a5ea2543670..6edc3177af1c%20100644%0D%0A%3E%20%3E%20---%20a%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0D%0A%3E%20%3E%20%2B%2B%2B%20b%2Fdrivers%2Fnet%2Fethernet%2Fmellanox%2Fmlx4%2Fen_ethtool.c%0D%0A%3E%20%3E%20%40%40%20-2078%2C14%20%2B2078%2C17%20%40%40%20static%20int%20mlx4_en_get_module_eeprom%28struct%0D%0A%3E%20%3E%20net_device%20%2Adev%2C%0D%0A%3E%20%3E%20%20%09%09ret%20%3D%20mlx4_get_module_info%28mdev-%3Edev%2C%20priv-%3Eport%2C%0D%0A%3E%20%3E%20%20%09%09%09%09%09%20%20%20offset%2C%20ee-%3Elen%20-%20i%2C%20data%20%2B%0D%0A%3E%20%3E%20i%29%3B%0D%0A%3E%20%3E%20%20%0D%0A%3E%20%0D%0A%3E%20I%20am%20not%20sure%20i%20see%20the%20issue%20in%20here%2C%20and%20why%20we%20need%20the%20partial%0D%0A%3E%20memset%20%3F%0D%0A%3E%20first%20thing%20in%20this%20function%20we%20do%3A%0D%0A%3E%20memset%28data%2C%200%2C%20ee-%3Elen%29%3B%0D%0A%3E%20%0D%0A%3E%20and%20then%20mlx4_get_module_info%28%29%20will%20only%20copy%20valid%20data%20only%20on%0D%0A%3E%20success.%0D%0A%3E%20%0D%0A%3E%20%0D%0A%3E%20%3E%20-%09%09if%20%28%21ret%29%20%2F%2A%20Done%20reading%20%2A%2F%0D%0A%3E%20%3E%20%2B%09%09if%20%28%21ret%29%20%7B%0D%0A%3E%20%3E%20%2B%09%09%09%2F%2A%20DOM%20was%20not%20readable%20after%20all%20%2A%2F%0D%0A%3E%20%0D%0A%3E%20actually%20if%20mlx4_get_module_info%28%29%20%20returns%20any%20non-negative%20value%20it%0D%0A%3E%20means%20how%20much%20data%20was%20read%2C%20so%20if%20it%20returns%200%2C%20it%20means%20that%20this%0D%0A%3E%20was%20the%20last%20iteration%20and%20we%20are%20done%20reading%20the%20eeprom..%20%0D%0A%3E%20%0D%0A%3E%20so%20i%20would%20remove%20the%20above%20comment%20and%20the%20memset%20below%20is%20redundant%0D%0A%3E%20since%20we%20already%20memset%20the%20whole%20buffer%20before%20the%20while%20loop.%0D%0A%3E%20%0D%0A%3E%20%3E%20%2B%09%09%09memset%28data%20%2B%20i%2C%200%2C%20ee-%3Elen%20-%20i%29%3B%0D%0A&amp;In-Reply-To=%3C40aaf07aa7463c0fc6ca89aab36c622bfb789ba4.camel%40mellanox.com%3E&amp;References=%3C20200517172053.GA734488%40decadent.org.uk%3E%0A%20%3C40aaf07aa7463c0fc6ca89aab36c622bfb789ba4.camel%40mellanox.com%3E&amp;subject=Re%3A%20%5BPATCH%20net%5D%20mlx4%3A%20Fix%20information%20leak%20on%20failure%20to%20read%20module%0A%20EEPROM">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=saeedm%40mellanox.com" alt="">
<div class="header"><span class="headerfield">From:</span> Saeed Mahameed &lt;saeedm@mellanox.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;ben@decadent.org.uk&quot; &lt;ben@decadent.org.uk&gt;, Tariq Toukan
	&lt;tariqt@mellanox.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> &quot;960702@bugs.debian.org&quot; &lt;960702@bugs.debian.org&gt;,
	&quot;netdev@vger.kernel.org&quot; &lt;netdev@vger.kernel.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [PATCH net] mlx4: Fix information leak on failure to read module
 EEPROM</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 18 May 2020 16:47:05 +0000</div>
</div>
<pre class="message">On Sun, 2020-05-17 at 18:20 +0100, Ben Hutchings wrote:
&gt; mlx4_en_get_module_eeprom() returns 0 even if it fails.  This results
&gt; in copying an uninitialised (or partly initialised) buffer back to
&gt; user-space.
&gt; 
&gt; Change it so that:
&gt; 
&gt; * In the special case that the DOM turns out not to be readable, the
&gt;   remaining part of the buffer is cleared.  This should avoid a
&gt;   regression when reading modules with this problem.
&gt; 
&gt; * In other error cases, the error code is propagated.
&gt; 
&gt; Reported-by: Yannis Aribaud &lt;bugs@d6bell.net&gt;
&gt; References: <a href="https://bugs.debian.org/960702">https://bugs.debian.org/960702</a>
&gt; Fixes: 7202da8b7f71 (&quot;ethtool, net/mlx4_en: Cable info,
&gt; get_module_info/...&quot;)
&gt; Signed-off-by: Ben Hutchings &lt;ben@decadent.org.uk&gt;
&gt; ---
&gt; This is compile-tested only.  It should go to stable, if it is a
&gt; correct fix.
&gt; 
&gt; Ben.
&gt; 
&gt;  drivers/net/ethernet/mellanox/mlx4/en_ethtool.c | 7 +++++--
&gt;  1 file changed, 5 insertions(+), 2 deletions(-)
&gt; 
&gt; diff --git a/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
&gt; b/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
&gt; index 8a5ea2543670..6edc3177af1c 100644
&gt; --- a/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
&gt; +++ b/drivers/net/ethernet/mellanox/mlx4/en_ethtool.c
&gt; @@ -2078,14 +2078,17 @@ static int mlx4_en_get_module_eeprom(struct
&gt; net_device *dev,
&gt;  		ret = mlx4_get_module_info(mdev-&gt;dev, priv-&gt;port,
&gt;  					   offset, ee-&gt;len - i, data +
&gt; i);
&gt;  

I am not sure i see the issue in here, and why we need the partial
memset ?
first thing in this function we do:
memset(data, 0, ee-&gt;len);

and then mlx4_get_module_info() will only copy valid data only on
success.


&gt; -		if (!ret) /* Done reading */
&gt; +		if (!ret) {
&gt; +			/* DOM was not readable after all */

actually if mlx4_get_module_info()  returns any non-negative value it
means how much data was read, so if it returns 0, it means that this
was the last iteration and we are done reading the eeprom.. 

so i would remove the above comment and the memset below is redundant
since we already memset the whole buffer before the while loop.

&gt; +			memset(data + i, 0, ee-&gt;len - i);
&gt;  			return 0;
&gt; +		}
&gt;  
&gt;  		if (ret &lt; 0) {
&gt;  			en_err(priv,
&gt;  			       &quot;mlx4_get_module_info i(%d) offset(%d)
&gt; bytes_to_read(%d) - FAILED (0x%x)\n&quot;,
&gt;  			       i, offset, ee-&gt;len - i, ret);
&gt; -			return 0;
&gt; +			return ret;

I think returning error in here was the actual solution for your
problem. you can verify by looking in the kernel log and verify you see
the log message.

&gt;  		}
&gt;  
&gt;  		i += ret;
</pre>

<div class="infmessage"><hr><p>
<a name="66"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt; -->
<!-- time:1589826064 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>:<br>
<code>Bug#960702</code>; Package <code>src:linux</code>.
 (Mon, 18 May 2020 18:21:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=67">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=67">mbox</a>, <a href="#66">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="68"></a>
<!-- request_addr: Ben Hutchings &lt;ben@decadent.org.uk&gt; -->
<!-- time:1589826064 -->
<strong>Acknowledgement sent</strong>
to <code>Ben Hutchings &lt;ben@decadent.org.uk&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Kernel Team &lt;debian-kernel@lists.debian.org&gt;</code>.
 (Mon, 18 May 2020 18:21:04 GMT) (<a href="bugreport.cgi?bug=960702;msg=69">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=69">mbox</a>, <a href="#68">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="70"></a><a name="msg70"></a><a href="#70">Message #70</a> received at 960702@bugs.debian.org (<a href="bugreport.cgi?bug=960702;msg=70">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=70">mbox</a>, <a href="mailto:960702@bugs.debian.org?subject=Re%3A%20%5BPATCH%20net%5D%20mlx4%3A%20Fix%20information%20leak%20on%20failure%20to%20read%0A%20module%20EEPROM&amp;body=On%20Mon%2C%2018%20May%202020%2019%3A16%3A22%20%2B0100%20Ben%20Hutchings%20%3Cben%40decadent.org.uk%3E%20wrote%3A%0A%3E%20On%20Mon%2C%202020-05-18%20at%2016%3A47%20%2B0000%2C%20Saeed%20Mahameed%20wrote%3A%0A%3E%20%3E%20On%20Sun%2C%202020-05-17%20at%2018%3A20%20%2B0100%2C%20Ben%20Hutchings%20wrote%3A%0A%3E%20%3E%20%3E%20mlx4_en_get_module_eeprom%28%29%20returns%200%20even%20if%20it%20fails.%20%20This%20results%0A%3E%20%3E%20%3E%20in%20copying%20an%20uninitialised%20%28or%20partly%20initialised%29%20buffer%20back%20to%0A%3E%20%3E%20%3E%20user-space.%0A%3E%20%5B...%5D%0A%3E%20%3E%20I%20am%20not%20sure%20i%20see%20the%20issue%20in%20here%2C%20and%20why%20we%20need%20the%20partial%0A%3E%20%3E%20memset%20%3F%0A%3E%20%3E%20first%20thing%20in%20this%20function%20we%20do%3A%0A%3E%20%3E%20memset%28data%2C%200%2C%20ee-%3Elen%29%3B%0A%3E%20%3E%20%0A%3E%20%3E%20and%20then%20mlx4_get_module_info%28%29%20will%20only%20copy%20valid%20data%20only%20on%0A%3E%20%3E%20success.%0A%3E%20%0A%3E%20Wow%2C%20sorry%2C%20I%20don%27t%20know%20how%20I%20missed%20that.%20%20So%20this%20is%20not%20the%20bug%20I%0A%3E%20was%20looking%20for.%0A%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20%3E%20-%09%09if%20%28%21ret%29%20%2F%2A%20Done%20reading%20%2A%2F%0A%3E%20%3E%20%3E%20%2B%09%09if%20%28%21ret%29%20%7B%0A%3E%20%3E%20%3E%20%2B%09%09%09%2F%2A%20DOM%20was%20not%20readable%20after%20all%20%2A%2F%0A%3E%20%3E%20%0A%3E%20%3E%20actually%20if%20mlx4_get_module_info%28%29%20%20returns%20any%20non-negative%20value%20it%0A%3E%20%3E%20means%20how%20much%20data%20was%20read%2C%20so%20if%20it%20returns%200%2C%20it%20means%20that%20this%0A%3E%20%3E%20was%20the%20last%20iteration%20and%20we%20are%20done%20reading%20the%20eeprom..%20%0A%3E%20%3E%20%0A%3E%20%3E%20so%20i%20would%20remove%20the%20above%20comment%20and%20the%20memset%20below%20is%20redundant%0A%3E%20%3E%20since%20we%20already%20memset%20the%20whole%20buffer%20before%20the%20while%20loop.%0A%3E%20%0A%3E%20Right.%0A%3E%20%0A%3E%20%3E%20%3E%20%2B%09%09%09memset%28data%20%2B%20i%2C%200%2C%20ee-%3Elen%20-%20i%29%3B%0A%3E%20%3E%20%3E%20%20%09%09%09return%200%3B%0A%3E%20%3E%20%3E%20%2B%09%09%7D%0A%3E%20%3E%20%3E%20%20%0A%3E%20%3E%20%3E%20%20%09%09if%20%28ret%20%3C%200%29%20%7B%0A%3E%20%3E%20%3E%20%20%09%09%09en_err%28priv%2C%0A%3E%20%3E%20%3E%20%20%09%09%09%20%20%20%20%20%20%20%22mlx4_get_module_info%20i%28%25d%29%20offset%28%25d%29%0A%3E%20%3E%20%3E%20bytes_to_read%28%25d%29%20-%20FAILED%20%280x%25x%29%5Cn%22%2C%0A%3E%20%3E%20%3E%20%20%09%09%09%20%20%20%20%20%20%20i%2C%20offset%2C%20ee-%3Elen%20-%20i%2C%20ret%29%3B%0A%3E%20%3E%20%3E%20-%09%09%09return%200%3B%0A%3E%20%3E%20%3E%20%2B%09%09%09return%20ret%3B%0A%3E%20%3E%20%0A%3E%20%3E%20I%20think%20returning%20error%20in%20here%20was%20the%20actual%20solution%20for%20your%0A%3E%20%3E%20problem.%20you%20can%20verify%20by%20looking%20in%20the%20kernel%20log%20and%20verify%20you%20see%0A%3E%20%3E%20the%20log%20message.%0A%3E%20%0A%3E%20The%20original%20bug%20report%20%28https%3A%2F%2Fbugs.debian.org%2F960702%29%20says%20that%0A%3E%20ethtool%20reports%20different%20values%20depending%20on%20whether%20its%20output%20is%0A%3E%20redirected.%20%20Although%20returning%20all-zeroes%20for%20the%20unreadable%20part%0A%3E%20might%20be%20wrong%2C%20it%20doesn%27t%20explain%20that%20behaviour.%0A%3E%20%0A%3E%20Perhaps%20if%20the%20timing%20of%20the%20I%C2%B2C%20reads%20is%20marginal%2C%20varying%20numbers%20of%0A%3E%20bytes%20of%20DOM%20information%20might%20be%20readable%3F%20%20But%20I%20don%27t%20see%20how%0A%3E%20redirection%20of%20ethtool%27s%20output%20would%20affect%20that.%20%20It%20uses%20a%20single%0A%3E%20ioctl%20to%20read%20everything%2C%20and%20the%20kernel%20controls%20timing%20within%20that.%0A%3E%20%0A%3E%20So%20I%20am%20mystified%20about%20what%20is%20going%20on%20here.%20%20Maybe%20there%20is%20a%20bug%20in%0A%3E%20ethtool%2C%20but%20I%27m%20not%20seeing%20it.%0A%3E%20%0A&amp;References=%3C20200517172053.GA734488%40decadent.org.uk%3E%0A%09%20%3C40aaf07aa7463c0fc6ca89aab36c622bfb789ba4.camel%40mellanox.com%3E%0A%20%3C9364a11c93d09de54aea70ab6098f2a654447bd2.camel%40decadent.org.uk%3E&amp;In-Reply-To=%3C9364a11c93d09de54aea70ab6098f2a654447bd2.camel%40decadent.org.uk%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ben%40decadent.org.uk" alt="">
<div class="header"><span class="headerfield">From:</span> Ben Hutchings &lt;ben@decadent.org.uk&gt;</div>
<div class="header"><span class="headerfield">To:</span> Saeed Mahameed &lt;saeedm@mellanox.com&gt;, Tariq Toukan &lt;tariqt@mellanox.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> &quot;960702@bugs.debian.org&quot; &lt;960702@bugs.debian.org&gt;, 
	&quot;netdev@vger.kernel.org&quot;
	 &lt;netdev@vger.kernel.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> Re: [PATCH net] mlx4: Fix information leak on failure to read
 module EEPROM</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 18 May 2020 19:16:22 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=960702;msg=70">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Mon, 2020-05-18 at 16:47 +0000, Saeed Mahameed wrote:
&gt; On Sun, 2020-05-17 at 18:20 +0100, Ben Hutchings wrote:
&gt; &gt; mlx4_en_get_module_eeprom() returns 0 even if it fails.  This results
&gt; &gt; in copying an uninitialised (or partly initialised) buffer back to
&gt; &gt; user-space.
[...]
&gt; I am not sure i see the issue in here, and why we need the partial
&gt; memset ?
&gt; first thing in this function we do:
&gt; memset(data, 0, ee-&gt;len);
&gt; 
&gt; and then mlx4_get_module_info() will only copy valid data only on
&gt; success.

Wow, sorry, I don&#39;t know how I missed that.  So this is not the bug I
was looking for.

&gt; 
&gt; &gt; -		if (!ret) /* Done reading */
&gt; &gt; +		if (!ret) {
&gt; &gt; +			/* DOM was not readable after all */
&gt; 
&gt; actually if mlx4_get_module_info()  returns any non-negative value it
&gt; means how much data was read, so if it returns 0, it means that this
&gt; was the last iteration and we are done reading the eeprom.. 
&gt; 
&gt; so i would remove the above comment and the memset below is redundant
&gt; since we already memset the whole buffer before the while loop.

Right.

&gt; &gt; +			memset(data + i, 0, ee-&gt;len - i);
&gt; &gt;  			return 0;
&gt; &gt; +		}
&gt; &gt;  
&gt; &gt;  		if (ret &lt; 0) {
&gt; &gt;  			en_err(priv,
&gt; &gt;  			       &quot;mlx4_get_module_info i(%d) offset(%d)
&gt; &gt; bytes_to_read(%d) - FAILED (0x%x)\n&quot;,
&gt; &gt;  			       i, offset, ee-&gt;len - i, ret);
&gt; &gt; -			return 0;
&gt; &gt; +			return ret;
&gt; 
&gt; I think returning error in here was the actual solution for your
&gt; problem. you can verify by looking in the kernel log and verify you see
&gt; the log message.

The original bug report (<a href="https://bugs.debian.org/960702">https://bugs.debian.org/960702</a>) says that
ethtool reports different values depending on whether its output is
redirected.  Although returning all-zeroes for the unreadable part
might be wrong, it doesn&#39;t explain that behaviour.

Perhaps if the timing of the I²C reads is marginal, varying numbers of
bytes of DOM information might be readable?  But I don&#39;t see how
redirection of ethtool&#39;s output would affect that.  It uses a single
ioctl to read everything, and the kernel controls timing within that.

So I am mystified about what is going on here.  Maybe there is a bug in
ethtool, but I&#39;m not seeing it.

Ben.

&gt; &gt;  		}
&gt; &gt;  
&gt; &gt;  		i += ret;
-- 
Ben Hutchings
The two most common things in the universe are hydrogen and stupidity.

</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=960702;filename=signature.asc;msg=70">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="71"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;benh@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1589826065 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;patch upstream&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;patch upstream security&#39;
            };
-->
<strong>Removed tag(s) security.</strong>
Request was from <code>Ben Hutchings &lt;benh@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Mon, 18 May 2020 18:21:05 GMT) (<a href="bugreport.cgi?bug=960702;msg=72">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=72">mbox</a>, <a href="#71">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="73"></a>
<!-- command:tag -->
<!-- requester: Ben Hutchings &lt;benh@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1589842263 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;patch upstream&#39;
            };
-->
<strong>Removed tag(s) patch.</strong>
Request was from <code>Ben Hutchings &lt;benh@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Mon, 18 May 2020 22:51:03 GMT) (<a href="bugreport.cgi?bug=960702;msg=74">full text</a>, <a href="bugreport.cgi?bug=960702;mbox=yes;msg=74">mbox</a>, <a href="#73">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=960702">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:36:22 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->buxtehude<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
