<!DOCTYPE html>
<html lang='en'>
<head>
<title>xorg/lib/libXrender - RENDER extension library  (mirrored from https://gitlab.freedesktop.org/xorg/lib/libxrender)</title>
<meta name='generator' content='cgit v1.2.1'/>
<meta name='robots' content='index, nofollow'/>
<link rel='stylesheet' type='text/css' href='https://cgit.freedesktop.org/cgit.css'/>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://cgit.freedesktop.org/xorg/lib/libXrender/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='https://gitlab.freedesktop.org/xorg/lib/libxrender' title='xorg/lib/libXrender Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='https://cgit.freedesktop.org/logo.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a title='xorg/lib/libXrender' href='/xorg/lib/libXrender/'>xorg/lib/libXrender</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='8fad00b0b647ee662ce4737ca15be033b7a21714'/><select name='h' onchange='this.form.submit();'>
<option value='CYGWIN'>CYGWIN</option>
<option value='DAMAGE-XFIXES'>DAMAGE-XFIXES</option>
<option value='IPv6-REVIEW'>IPv6-REVIEW</option>
<option value='XACE-SELINUX'>XACE-SELINUX</option>
<option value='XORG-6_8-branch'>XORG-6_8-branch</option>
<option value='XORG-CURRENT'>XORG-CURRENT</option>
<option value='XORG-RELEASE-1'>XORG-RELEASE-1</option>
<option value='XORG-RELEASE-1-STSF'>XORG-RELEASE-1-STSF</option>
<option value='XORG-RELEASE-1-TM'>XORG-RELEASE-1-TM</option>
<option value='XORG-STABLE'>XORG-STABLE</option>
<option value='XPRINT'>XPRINT</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>RENDER extension library  (mirrored from https://gitlab.freedesktop.org/xorg/lib/libxrender)</td><td class='sub right'>keithp</td></tr></table>
<table class='tabs'><tr><td>
<a href='/xorg/lib/libXrender/'>summary</a><a href='/xorg/lib/libXrender/refs/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>refs</a><a href='/xorg/lib/libXrender/log/'>log</a><a href='/xorg/lib/libXrender/tree/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>tree</a><a class='active' href='/xorg/lib/libXrender/commit/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>commit</a><a href='/xorg/lib/libXrender/diff/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>diff</a></td><td class='form'><form class='right' method='get' action='/xorg/lib/libXrender/log/'>
<input type='hidden' name='id' value='8fad00b0b647ee662ce4737ca15be033b7a21714'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='8fad00b0b647ee662ce4737ca15be033b7a21714'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Tobias Stoeckmann &lt;tobias@stoeckmann.org&gt;</td><td class='right'>2016-09-25 21:42:09 +0200</td></tr>
<tr><th>committer</th><td>Matthieu Herrb &lt;matthieu@herrb.eu&gt;</td><td class='right'>2016-09-25 22:14:27 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='sha1'><a href='/xorg/lib/libXrender/commit/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>8fad00b0b647ee662ce4737ca15be033b7a21714</a> (<a href='/xorg/lib/libXrender/patch/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='sha1'><a href='/xorg/lib/libXrender/tree/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>defc41b75d44d03839779cd43a72288efc3ee004</a></td></tr>
<tr><th>parent</th><td colspan='2' class='sha1'><a href='/xorg/lib/libXrender/commit/?id=b2df5bc42f64b45e44dbad61f3386bcb5ec1383d'>b2df5bc42f64b45e44dbad61f3386bcb5ec1383d</a> (<a href='/xorg/lib/libXrender/diff/?id=8fad00b0b647ee662ce4737ca15be033b7a21714&amp;id2=b2df5bc42f64b45e44dbad61f3386bcb5ec1383d'>diff</a>)</td></tr></table>
<div class='commit-subject'>Avoid OOB write in XRenderQueryFilters</div><div class='commit-msg'>The memory for filter names is reserved right after receiving the reply.
After that, filters are iterated and each individual filter name is
stored in that reserved memory.

The individual name lengths are not checked for validity, which means
that a malicious server can reserve less memory than it will write to
during each iteration.

v2: consume remaining bytes in reply buffer on error.

Signed-off-by: Tobias Stoeckmann &lt;tobias@stoeckmann.org&gt;
Reviewed-by: Matthieu Herrb &lt;matthieu@herrb.eu&gt;
</div><div class='diffstat-header'><a href='/xorg/lib/libXrender/diff/?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/xorg/lib/libXrender/diff/src/Filter.c?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>src/Filter.c</a></td><td class='right'>13</td><td class='graph'><table summary='file diffstat' width='13%'><tr><td class='add' style='width: 92.3%;'/><td class='rem' style='width: 7.7%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>1 files changed, 12 insertions, 1 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/src/Filter.c b/src/Filter.c<br/>index edfa572..8d701eb 100644<br/>--- a/<a href='/xorg/lib/libXrender/tree/src/Filter.c?id=b2df5bc42f64b45e44dbad61f3386bcb5ec1383d'>src/Filter.c</a><br/>+++ b/<a href='/xorg/lib/libXrender/tree/src/Filter.c?id=8fad00b0b647ee662ce4737ca15be033b7a21714'>src/Filter.c</a></div><div class='hunk'>@@ -38,7 +38,7 @@ XRenderQueryFilters (Display *dpy, Drawable drawable)</div><div class='ctx'>     char			*name;</div><div class='ctx'>     char			len;</div><div class='ctx'>     int				i;</div><div class='del'>-    unsigned long		nbytes, nbytesAlias, nbytesName;</div><div class='add'>+    unsigned long		nbytes, nbytesAlias, nbytesName, reply_left;</div><div class='ctx'> </div><div class='ctx'>     if (!RenderHasExtension (info))</div><div class='ctx'> 	return NULL;</div><div class='hunk'>@@ -114,6 +114,7 @@ XRenderQueryFilters (Display *dpy, Drawable drawable)</div><div class='ctx'>      * Read the filter aliases</div><div class='ctx'>      */</div><div class='ctx'>     _XRead16Pad (dpy, filters-&gt;alias, 2 * rep.numAliases);</div><div class='add'>+    reply_left = 8 + rep.length - 2 * rep.numAliases;;</div><div class='ctx'> </div><div class='ctx'>     /*</div><div class='ctx'>      * Read the filter names</div><div class='hunk'>@@ -122,9 +123,19 @@ XRenderQueryFilters (Display *dpy, Drawable drawable)</div><div class='ctx'>     {</div><div class='ctx'> 	int	l;</div><div class='ctx'> 	_XRead (dpy, &amp;len, 1);</div><div class='add'>+	reply_left--;</div><div class='ctx'> 	l = len &amp; 0xff;</div><div class='add'>+	if ((unsigned long)l + 1 &gt; nbytesName) {</div><div class='add'>+            _XEatDataWords(dpy, reply_left);</div><div class='add'>+	    Xfree(filters);</div><div class='add'>+	    UnlockDisplay (dpy);</div><div class='add'>+	    SyncHandle ();</div><div class='add'>+	    return NULL;</div><div class='add'>+	}</div><div class='add'>+	nbytesName -= l + 1;</div><div class='ctx'> 	filters-&gt;filter[i] = name;</div><div class='ctx'> 	_XRead (dpy, name, l);</div><div class='add'>+        reply_left -= l;</div><div class='ctx'> 	name[l] = '\0';</div><div class='ctx'> 	name += l + 1;</div><div class='ctx'>     }</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit v1.2.1</a> (<a href='https://git-scm.com/'>git 2.18.0</a>) at 2021-10-30 22:00:20 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
