<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>d44e5bde18a41beda39d49189bef7f2ba7c8f3cb - platform/frameworks/base - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/frameworks/base/%2B/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/">frameworks</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/base/">base</a> / <span class="Breadcrumbs-crumb">d44e5bde18a41beda39d49189bef7f2ba7c8f3cb</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>d44e5bde18a41beda39d49189bef7f2ba7c8f3cb</td><td><span>[<a href="/platform/frameworks/base/+log/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb">log</a>]</span> <span>[<a href="/platform/frameworks/base/+archive/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Leon Scroggins III &lt;scroggo@google.com&gt;</td><td>Wed Mar 11 13:12:06 2015 -0400</td></tr><tr><th class="Metadata-title">committer</th><td>The Android Automerger &lt;android-build@google.com&gt;</td><td>Thu Jul 09 14:04:55 2015 -0700</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/">bf01666ec8db5fae35664bb8fd25a75e9eb91a95</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb%5E">0e40462e11d27eb859b829b112cecb8c6f0d7afb</a> <span>[<a href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Make Bitmap_createFromParcel check the color count. DO NOT MERGE

When reading from the parcel, if the number of colors is invalid, early
exit.

Add two more checks: setInfo must return true, and Parcel::readInplace
must return non-NULL. The former ensures that the previously read values
(width, height, etc) were valid, and the latter checks that the Parcel
had enough data even if the number of colors was reasonable.

Also use an auto-deleter to handle deletion of the SkBitmap.

Cherry pick from change-Id: <a href="https://android-review.googlesource.com/#/q/Icbd562d6d1f131a723724883fd31822d337cf5a6">Icbd562d6d1f131a723724883fd31822d337cf5a6</a>

BUG=19666945

Change-Id: <a href="https://android-review.googlesource.com/#/q/Iab0d218c41ae0c39606e333e44cda078eef32291">Iab0d218c41ae0c39606e333e44cda078eef32291</a>
</pre><ul class="DiffTree"><li><a href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/core/jni/android/graphics/Bitmap.cpp">core/jni/android/graphics/Bitmap.cpp</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb%5E%21/#F0">diff</a>]</span></li></ul><div class="DiffSummary">1 file changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: bf01666ec8db5fae35664bb8fd25a75e9eb91a95</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - Android.mk"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/Android.mk">Android.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CleanSpec.mk"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/CleanSpec.mk">CleanSpec.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - MODULE_LICENSE_APACHE2"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/MODULE_LICENSE_APACHE2">MODULE_LICENSE_APACHE2</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NOTICE"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/NOTICE">NOTICE</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - api/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/api/">api/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cmds/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/cmds/">cmds/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - core/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/core/">core/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - data/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/data/">data/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - docs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/docs/">docs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - drm/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/drm/">drm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - graphics/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/graphics/">graphics/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - include/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/include/">include/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - keystore/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/keystore/">keystore/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - libs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/libs/">libs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - location/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/location/">location/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - media/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/media/">media/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - native/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/native/">native/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - nfc-extras/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/nfc-extras/">nfc-extras/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - obex/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/obex/">obex/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - opengl/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/opengl/">opengl/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - packages/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/packages/">packages/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - policy/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/policy/">policy/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - preloaded-classes"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/preloaded-classes">preloaded-classes</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - rs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/rs/">rs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - samples/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/samples/">samples/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - sax/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/sax/">sax/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - services/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/services/">services/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - telecomm/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/telecomm/">telecomm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - telephony/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/telephony/">telephony/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - test-runner/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/test-runner/">test-runner/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tests/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/tests/">tests/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tools/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/tools/">tools/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - wifi/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/d44e5bde18a41beda39d49189bef7f2ba7c8f3cb/wifi/">wifi/</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>