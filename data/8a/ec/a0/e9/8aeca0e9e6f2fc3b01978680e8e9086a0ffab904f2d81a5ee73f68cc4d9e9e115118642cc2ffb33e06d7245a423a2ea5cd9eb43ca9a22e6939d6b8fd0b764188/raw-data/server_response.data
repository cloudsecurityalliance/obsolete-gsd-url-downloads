<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #72558 - RDF' href='rss/bug.php?id=72558'>
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #72558 - RSS 2.0' href='rss/bug.php?id=72558&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Sec Bug #72558 :: Integer overflow error within _gdContributionsAlloc()</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=72558">Sec Bug</a>&nbsp;#72558</th>
            <td id="summary" colspan="5">Integer overflow error within _gdContributionsAlloc()</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2016-07-07 14:00 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2016-07-19 07:54 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>cmb@php.net</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=stas">stas</a> (<a href="https://people.php.net/stas">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=GD+related">GD related</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>5.6.23</td>
            <th class="details">OS:</th>
            <td>*</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-6207" target="_blank">2016-6207</a></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=72558&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=72558&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=72558&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1467900040">&nbsp;</a><strong>[2016-07-07 14:00 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>Description:
------------
Secunia Research at Flexera Software has reported a vulnerability
in LibGD, which can be exploited by malicious people to cause a
DoS (Denial of Service). The vulnerability is caused due to an
integer overflow error within the &quot;_gdContributionsAlloc()&quot;
function (gd_interpolation.c) and can be exploited to cause an
out-of-bounds memory write access.

This DOS vulnerability would not actually affect PHP, if
memory_limit is set to a reasonable value. Nonetheless, the issue
should be fixed, of course.

A respective patch has already been provided for libgd and will be
deployed with libgd-2.2.3. The attached patch fixes this
vulnerability in PHP's bundled libgd, and should probably go into
PHP 5.6+.

There has not yet been assigned a CVE for this issue, but Secunia
Research might do that (not yet decided).

As I have prepared the patch in advance, the PHPT and the commit
message might have to be adapted to match the actual ticket
number.

Test script:
---------------
See the supplied PHPT in the attached patch.


</pre>
</div><h2>Patches</h2>
<a href="patch-display.php?bug_id=72558&amp;patch=fix-72558&amp;revision=latest" >fix-72558</a>
(last revision 2016-07-07 14:00 UTC by cmb)
<br><p><a href='patch-add.php?bug_id=72558'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=72558'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_comment' ><a name="1467903914">&nbsp;</a><strong>[2016-07-07 15:05 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Should go in 5.5+

Also mainly causes ddos by either a crash under certain circumstances (out of bounds writes) but more likely an out of memory in case someone passes invalid inputs from the outside (see test).
</pre>
</div><div class='comment type_comment' ><a name="1467975541">&nbsp;</a><strong>[2016-07-08 10:59 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>I wanted to verify that the supplied patch can be applied to
PHP-5.5 without conflicts. It does, but the PHPT fails (because
there is no error/warning output). I've found that
imagesetinterpolation() apparently doesn't work before PHP 5.6,
and that `imagescale($im, 0x15555556, 1, IMG_BELL)` has to be used
instead. However, that causes a segfault. I'll investigate.
</pre>
</div><div class='comment type_comment' ><a name="1467977957">&nbsp;</a><strong>[2016-07-08 11:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>I think it may be easier to release 2
2.3 and backport gd_interpolation.c altogether, adding the news entries for.what it fixes.
</pre>
</div><div class='comment type_comment' ><a name="1467977959">&nbsp;</a><strong>[2016-07-08 11:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>I think it may be easier to release 2
2.3 and backport gd_interpolation.c altogether, adding the news entries for.what it fixes.
</pre>
</div><div class='comment type_log' ><a name="1468384691">&nbsp;</a><strong>[2016-07-13 04:38 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: pajoye</span>
</div></div></div><div class='comment type_log' ><a name="1468413045">&nbsp;</a><strong>[2016-07-13 12:30 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-CVE-ID:</span>
<span class="added">+CVE-ID: 2016-6207</span>
</div></div></div><div class='comment type_comment' ><a name="1468413045">&nbsp;</a><strong>[2016-07-13 12:30 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>I will upload an updated patch later once it has been validated by secunia.

Added cve # too
</pre>
</div><div class='comment type_comment' ><a name="1468414136">&nbsp;</a><strong>[2016-07-13 12:48 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>&gt; I think it may be easier to release 2.2.3 and backport
&gt; gd_interpolation.c altogether, [â€¦]

That would, however, not affect external libgd builds, and *might*
cause a segfault with PHP 5.5.
</pre>
</div><div class='comment type_comment' ><a name="1468416698">&nbsp;</a><strong>[2016-07-13 13:31 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>I sent the patch to the secunia thread.

Only additiona are the two overflow checks before gdMalloc in th3 contrib parts.

If the patch ia applied (for 2.2.3) why external gd should be a problem? Same for 55.5 if RMs apply it
</pre>
</div><div class='comment type_comment' ><a name="1468798944">&nbsp;</a><strong>[2016-07-17 23:42 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Could you please send the patch to me too? Thanks.
</pre>
</div><div class='comment type_comment' ><a name="1468826308">&nbsp;</a><strong>[2016-07-18 07:18 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Fix in security repo as d1a491acf31cf6d2ba65cc7c46fe963a510cd91f
</pre>
</div><div class='comment type_log' ><a name="1468911601">&nbsp;</a><strong>[2016-07-19 07:00 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To: pajoye</span>
<span class="added">+Assigned To: stas</span>
</div></div></div><div class='comment type_comment' ><a name="1468911601">&nbsp;</a><strong>[2016-07-19 07:00 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>@stas I let you merge from the security repository. Thanks for taking care of all these things :)
</pre>
</div><div class='comment type_log' ><a name="1468914859">&nbsp;</a><strong>[2016-07-19 07:54 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_comment' ><a name="1468914859">&nbsp;</a><strong>[2016-07-19 07:54 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>The fix for this bug has been committed.

Snapshots of the sources are packaged every three hours; this change
will be in the next snapshot. You can grab the snapshot at
<a href="http://snaps.php.net/" rel="nofollow">http://snaps.php.net/</a>.

 For Windows:

<a href="http://windows.php.net/snapshots/" rel="nofollow">http://windows.php.net/snapshots/</a>
 
Thank you for the report, and for helping us make PHP better.


</pre>
</div><div class='comment type_svn' ><a name="1468918315">&nbsp;</a><strong>[2016-07-19 08:51 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1468918507">&nbsp;</a><strong>[2016-07-19 08:55 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1468918648">&nbsp;</a><strong>[2016-07-19 08:57 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1468918649">&nbsp;</a><strong>[2016-07-19 08:57 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1468918686">&nbsp;</a><strong>[2016-07-19 08:58 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1468920911">&nbsp;</a><strong>[2016-07-19 09:35 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1468920981">&nbsp;</a><strong>[2016-07-19 09:36 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1468931760">&nbsp;</a><strong>[2016-07-19 12:36 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1468951160">&nbsp;</a><strong>[2016-07-19 17:59 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=cc06543112c28680af5978b5fa63f987361a8d85" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=cc06543112c28680af5978b5fa63f987361a8d85</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1468951161">&nbsp;</a><strong>[2016-07-19 17:59 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=522253bc9bb517dbd7782399c3bdaed1bbd92b8d" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=522253bc9bb517dbd7782399c3bdaed1bbd92b8d</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1469060870">&nbsp;</a><strong>[2016-07-21 00:27 UTC] <a href="//people.php.net/tyrael">tyrael@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=d57041cf2a273b6854e25e15a4261eb706a078bd" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=d57041cf2a273b6854e25e15a4261eb706a078bd</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1469060871">&nbsp;</a><strong>[2016-07-21 00:27 UTC] <a href="//people.php.net/tyrael">tyrael@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=8fa9d1ce28f3a894b104979df30d0b65e0f21107" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=8fa9d1ce28f3a894b104979df30d0b65e0f21107</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1476699052">&nbsp;</a><strong>[2016-10-17 10:10 UTC] <a href="//people.php.net/bwoebi">bwoebi@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=48e76abadd17a090259db77f3294d870fbc31ba5</a>
Log: improve fix #72558, free contribRow as well
</pre>
</div><div class='comment type_svn' ><a name="1476699053">&nbsp;</a><strong>[2016-10-17 10:10 UTC] <a href="//people.php.net/bwoebi">bwoebi@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=75211491936ab23281e7d6d45a1fd78076571d0c</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div><div class='comment type_svn' ><a name="1476699054">&nbsp;</a><strong>[2016-10-17 10:10 UTC] <a href="//people.php.net/bwoebi">bwoebi@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of pierre.php@gmail.com
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=df0951508920d3e8400c99d058fa213397b752f8</a>
Log: improve fix #72558, while (u&amp;gt;=0) with unsigned int will always be true
</pre>
</div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
