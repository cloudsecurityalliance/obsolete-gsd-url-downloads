<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                      "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
  <head>
    <title>Bug 1184161 &ndash; VUL-0: CVE-2021-25317: cups: ownership of /var/log/cups could allow privilege escalation from lp user to root via symlink attacks</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<link rel="Top" href="https://bugzilla.suse.com/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="showdependencytree.cgi?id=1184161&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="showdependencygraph.cgi?id=1184161">

      <link rel="Show" title="Bug Activity"
            href="show_activity.cgi?id=1184161">
      <link rel="Show" title="Printer-Friendly Version"
            href="show_bug.cgi?format=multiple&amp;id=1184161">



    
    <link href="skins/standard/global.css?1411227340"
          rel="alternate stylesheet" 
          title="Classic"><link href="js/yui/assets/skins/sam/autocomplete.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="js/yui/assets/skins/sam/calendar.css?1411227331" rel="stylesheet"
            type="text/css" ><link href="skins/standard/global.css?1411227340" rel="stylesheet"
            type="text/css" ><link href="skins/standard/show_bug.css?1416528352" rel="stylesheet"
            type="text/css" ><link href="extensions/Voting/web/style.css?1411227348" rel="stylesheet"
            type="text/css" ><!--[if lte IE 7]>
      


      <link href="skins/standard/IE-fixes.css?1411227340" rel="stylesheet"
            type="text/css" >
<![endif]-->

    <link href="skins/contrib/SUSE/global.css?1411227340" rel="stylesheet"
            type="text/css" 
          title="SUSE">

    

    

    
<script type="text/javascript" src="js/yui/yahoo-dom-event/yahoo-dom-event.js?1411227335"></script><script type="text/javascript" src="js/yui/cookie/cookie-min.js?1411227333"></script><script type="text/javascript" src="js/yui/datasource/datasource-min.js?1411227329"></script><script type="text/javascript" src="js/yui/connection/connection-min.js?1411227329"></script><script type="text/javascript" src="js/yui/json/json-min.js?1411227333"></script><script type="text/javascript" src="js/yui/autocomplete/autocomplete-min.js?1411227334"></script><script type="text/javascript" src="js/yui/calendar/calendar-min.js?1411227335"></script><script type="text/javascript" src="js/global.js?1411227336"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 1184161 – VUL-0: CVE-2021-25317: cups: ownership of \/var\/log\/cups could allow privilege escalation from lp user to root via symlink attacks",  
                             "show_bug.cgi?id=1184161" );
        document.title = "Bug 1184161 – VUL-0: CVE-2021-25317: cups: ownership of \/var\/log\/cups could allow privilege escalation from lp user to root via symlink attacks";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 1184161 – VUL-0: CVE-2021-25317: cups: ownership of \/var\/log\/cups could allow privilege escalation from lp user to root via symlink attacks", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script type="text/javascript" src="js/util.js?1411227336"></script><script type="text/javascript" src="js/field.js?1414105521"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico" ><link href="extensions/Testopia/css/testopia.css" rel="stylesheet" type="text/css">
    <link href="extensions/Testopia/extjs/examples/ux/css/RowEditor.css" rel="stylesheet" type="text/css"  />
    <script type="text/javascript">
        Testopia_user = {login: "", id: 0};
        DEFAULT_CASE_STATUS = 'CONFIRMED';
    </script>
  </head>



  <body onload=""
        class="bugzilla-suse-com bz_bug bz_status_IN_PROGRESS bz_product_SUSE_Security_Incidents bz_component_Incidents bz_bug_1184161 yui-skin-sam">



<div id="header">
<div id="banner">
  </div>

<!--div id="tmp_warning_wnd" style="
    position:fixed; 
    color:red; 
    font-size:20px; 
    top:50px; 
    left:10%; 
    right:10%; 
    padding:1em;
    background-color:#ffffff;
    border:3px solid red;
    z-index:9999;
    text-align:center;">
  This Bugzilla is for TESTING ONLY. All new bugs and comments WILL BE LOST. Use <a href="https://bugzilla.suse.com">bugzilla.suse.com</a> instead.
  <button style="
      background:none;
      border:0;
      box-shadow:none;
      color:red;
      text-shadow:none;
      position:absolute;
      right:0;
      top:0;" onclick="document.getElementById('tmp_warning_wnd').style.display='none';">[X]</button>
</div-->

<table border="0" cellspacing="0" cellpadding="0" id="titles">
<tr>
    <td id="title">
      <p>Bugzilla &ndash; Bug&nbsp;1184161</p>
    </td>

    <td id="subtitle">
      <p class="subheader">VUL-0: CVE-2021-25317: cups: ownership of /var/log/cups could allow privilege escalation from lp user to root via symlink attacks</p>
    </td>

    <td id="information">
      <p class="header_addl_info">Last modified: 2021-05-11 09:08:51 UTC</p>
    </td>
</tr>
</table>

<table id="lang_links_container" cellpadding="0" cellspacing="0"
       class="bz_default_hidden"><tr><td>
</td></tr></table>
<ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <!--a id="login_link_top" href="show_bug.cgi?id=1184161&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a-->
  <a id="login_link_top" href="show_bug.cgi?id=1184161&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1184161" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_top"
        onsubmit="return check_mini_login_fields( '_top' );"
  >
    <input id="Bugzilla_login_top" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_top')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_top" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_top')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_top">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_top');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_top');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>
<li id="forgot_container_top">
  <span class="separator">| </span>
  <a id="forgot_link_top" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
</div> 

<div id="bugzilla-body">

<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>
<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2021-05-11 09:08:51">
  <input type="hidden" name="longdesclength" value="44">
  <input type="hidden" name="id" value="1184161">
  <input type="hidden" name="token" value="1635630579-6kWK0qAt7Pp6TCMSgg67xUpe4x-MOTvSDdbwD17UMr8">
<div class="bz_alias_short_desc_container edit_form">
     <a href="show_bug.cgi?id=1184161"><b>Bug&nbsp;1184161</b></a> -<span id="summary_alias_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2021-25317</span>) 
      <span id="short_desc_nonedit_display">VUL-0: CVE-2021-25317: cups: ownership of /var/log/cups could allow privilege escalation from lp user to root via symlink attacks</span>
     </span>  
       
    <div id="summary_alias_input">
      <table id="summary"> 
        <tr>
            <td colspan="2">(CVE-2021-25317)
          </td>
        </tr>
        
        <tr><th class="field_label "
    id="field_label_short_desc">

    <label for="short_desc" accesskey="s">

  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=glossary.html#short_desc"
  >Summary:</a>
</label>
</th>
          <td><span title="VUL-0: CVE-2021-25317: cups: ownership of /var/log/cups could allow privilege escalation from lp user to root via symlink attacks">VUL-0: CVE-2021-25317: cups: ownership of /var/log/cups could allow privilege...
        </span>
          </td>
        </tr>
      </table>
    </div>
  </div>
  <script type="text/javascript">
    hideAliasAndSummary('VUL-0: CVE-2021-25317: cups: ownership of \/var\/log\/cups could allow privilege escalation from lp user to root via symlink attacks', 'CVE-2021-25317');
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=status_resolution_matrix.html">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">IN_PROGRESS
      </span>
    </td>
  </tr>

          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
      </tr>

    
    
    
    <tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >SUSE Security Incidents</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=glossary.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Novell Products</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=SUSE Security Incidents"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Incidents</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">

    <label for="version">

  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=glossary.html#version"
  >Version:</a>
</label>
</th>
        <td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">

    <label for="rep_platform" accesskey="h">

  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=glossary.html#rep_platform"
  >Hardware:</a>
</label>
</th>
      <td class="field_value">Other
       Other
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label for="priority">
          <a href="page.cgi?id=glossary.html#priority">Priority</a></label>:
      </th>
      <td>P3 - Medium
        <label for="severity">
          <b>Severity</b></label>:
       Normal
      </td>
    </tr>

      <tr>
        <th class="field_label">
          <label for="target_milestone">
            <a href="page.cgi?id=glossary.html#target_milestone">
            Target&nbsp;Milestone</a></label>:
        </th><td>---
  </td>
      </tr>            
          
          <tr>
      <th class="field_label">
        <a href="page.cgi?id=glossary.html#assigned_to">Assigned To</a>:
      </th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">

    <label for="qa_contact" accesskey="q">

  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#qa_contact"
  >QA Contact:</a>
</label>
</th>
      <td><span class="vcard"><span class="fn">Security Team bot</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-team\x40suse.de',
        'security-team\x40suse.de');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">

    <label for="bug_file_loc" accesskey="u">

  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=glossary.html#bug_file_loc"
  >URL:</a>
</label>
</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
  
    <tr><th class="field_label "
    id="field_label_status_whiteboard">

    <label for="status_whiteboard" accesskey="w">

  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=glossary.html#status_whiteboard"
  >Whiteboard:</a>
</label>
</th><td colspan="2">
        <span title="CVSSv3.1:SUSE:CVE-2021-25317:5.3:(AV:L/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:L)">CVSSv3.1:SUSE:CVE-2021-25317:5.3:(AV:...
        </span>  
  </td>
    </tr>
  
    <tr>
      <th class="field_label">
        <label for="keywords" accesskey="k">
          <a href="describekeywords.cgi"><u>K</u>eywords</a></label>:
      </th>
      <td class="field_value" colspan="2">
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=glossary.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>
    
  </td>
  </tr>
  
  <tr>
    <th>&nbsp;</th>
  
    <td colspan="2" align="left" id="show_dependency_tree_or_graph">
      Show dependency <a href="showdependencytree.cgi?id=1184161&amp;hide_resolved=1">tree</a>
  
        /&nbsp;<a href="showdependencygraph.cgi?id=1184161">graph</a>
    </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table cellpadding="3" cellspacing="1">
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2021-03-30 11:32 UTC by <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2021-05-11 09:08 UTC 
      (<a href="show_activity.cgi?id=1184161">History</a>)
    </td>
  
  </tr>
         <tr>
      <th class="field_label">
        <label for="newcc" accesskey="a">CC List:</label>
      </th>
      <td>7 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5">
                <option value="atoptsoglou">atoptsoglou</option>
                <option value="gianluca.gabrielli">gianluca.gabrielli</option>
                <option value="jsegitz">jsegitz</option>
                <option value="jsmeix">jsmeix</option>
                <option value="martin.wilck">martin.wilck</option>
                <option value="matthias.gerstner">matthias.gerstner</option>
                <option value="security-team">security-team</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=glossary.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" ></td>
    </tr> 
         <tr><th class="field_label "
    id="field_label_cf_foundby">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_foundby"
  >Found By:</a>

</th>
  <td class="field_value "
      id="field_container_cf_foundby"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_nts_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_nts_priority"
  >Services Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_nts_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_biz_priority">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_biz_priority"
  >Business Priority:</a>

</th>
  <td class="field_value "
      id="field_container_cf_biz_priority"  colspan="2"></td>
    </tr>
    <tr><th class="field_label "
    id="field_label_cf_blocker">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_blocker"
  >Blocker:</a>

</th>
  <td class="field_value "
      id="field_container_cf_blocker"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_marketing_qa_status">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_marketing_qa_status"
  >Marketing QA Status:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_marketing_qa_status"  colspan="2">---</td>
    </tr>
    <tr><th class="field_label  bz_hidden_field"
    id="field_label_cf_it_deployment">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=glossary.html#cf_it_deployment"
  >IT Deployment:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_it_deployment"  colspan="2">---</td>
    </tr>
         <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
         <ul>
    <li><a href="tr_new_case.cgi?product=SUSE%20Security%20Incidents&bug=1184161">Create test case</a></li>
</ul><ul>
  <li><a href="enter_bug.cgi?cloned_bug_id=1184161">Clone This Bug</a></li>
</ul>
                

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts" cellspacing="0" cellpadding="0"><tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table" cellspacing="0" cellpadding="4">
  <tr id="a0">
    <th colspan="2" align="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="2">
        <a href="attachment.cgi?bugid=1184161&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=1184161&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1411227336" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>




<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table" cellpadding="0" cellspacing="0"><tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-03-30 11:32:56 UTC
        </span>
      </div>



<pre class="bz_comment_text" >I noticed that on Tumbleweed (and probably all other maintained cups
codestreams) the /var/log/cups directory is packaged as follows:

drwxr-xr-x 2 lp lp 4096 24. Mär 16:47 /var/log/cups/

This means the 'lp' user can perform arbitrary writes in this directory. The
cups daemon is running as root, however, potentially creating log files in
this directory.

A simple reproducer is as follows:

```
root# sudo -u lp /bin/bash
lp$ cd /var/log/cups
lp$ rm -f *
lp$ for log in error access page; do ln -s /root/${log}_log; done
lp$ exit
root# cupsctl --debug-logging
```

Interestingly, as a side effect of enabling cups logging, the ownership of
/var/log/cups is changed. After the reproducer we get:

drwxr-xr-x 2 root lp 4.0K 30. Mär 13:27 /var/log/cups/

The reason for this is cups itself in scheduler/log.c with the following
invocation:

```
cupsdCheckPermissions(CUPS_LOGDIR, NULL, log_dir_perm, RunUser, Group, 1, -1);
```

This function makes sure that the log directory is owned by the RunUser and
Group that cups is configured for. This can be too late already, however. Also
after package updates of cups-config the original packaging permissions are
reinstated.

Other distributions like Arch, Debian and Gentoo package /var/log/cups with
root:root ownership. Only Fedora suffers from the same issue as we do. So we
might need to report this to them as well, although they should be protected
by their SELinux configuration.</pre>
    </div><div id="c3" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-03-31 08:31:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to <a href="mailto:jsmeix&#64;suse.com">jsmeix&#64;suse.com</a> from <a href="show_bug.cgi?id=1184161#c1">comment #1</a>)
<span class="quote">&gt; I am a noob with symlink attacks.
&gt; Could you provide a complete reproducer that actually does something
&gt; what only root can do after privilege escalation from lp to root
&gt; e.g. how lp could do &quot;head -n1 /etc/shadow&quot; or something like that.</span >

The reproducer in <a href="show_bug.cgi?id=1184161#c0">comment 0</a> should lead to empty files being created like
/root/error_log. If not very familiar with when e.g. the access_log is
filled with something by cupsd, this would probably the most interesting
vector, more kind of a denial-of-service by writing garbage to system files.

Since cups has a locally accessible web interface a local attacker could also
influence the content of log files in some ways, so some sort of privilege
escalation could also become possible.

It is not super serious but we should fix it anyway.

<span class="quote">&gt; permissions are set there as is.
&gt; I guess there is (or was?) some special reason for it
&gt; because otherwise no special permissions would be set.</span >

Probably rather &quot;was&quot;. The security issue is only with the write permission
for the lp user. So if there is no process running as 'lp' that needs to write
there then there should be no issue. Since all other distributions except
Fedora don't package with lp write permissions and since cupsd *itself* is
&quot;fixing&quot; these permissions for /var/log/cups during runtime I don't think
there is a big risk for breaking anything.

<span class="quote">&gt; -----------------------------------------------------------
&gt; # osc cat DISCONTINUED:openSUSE:10.3:Update cups cups.spec
&gt; ...
&gt; %files libs
&gt; %defattr(-,root,root)
&gt; %{_bindir}/cups-config
&gt; #%dir %attr(0755,lp,lp) %{_sysconfdir}/cups/
&gt; %dir %attr(0710,lp,lp) %{_var}/spool/cups
&gt; %dir %attr(1770,lp,lp) %{_var}/spool/cups/tmp
&gt; %dir %attr(0755,lp,lp) %{_var}/log/cups/
&gt; -----------------------------------------------------------</span >

The write permission for lop for /spool/cups and /etc/cups is no longer there,
which is good. Only for /var/log/cups and for the /var/spool/cups/tmp sticky
bit directory. Hopefully cupsd does not create fixed paths in the latter, but
at least symlink protection from the kernel would be kicking in here, because
it is world-writable.

<span class="quote">&gt; I will contact the Red Hat CUPS maintainer via personal mail.
&gt; Perhaps he knows more about the reason for such kind of
&gt; special permission settings.
&gt; 
&gt; If needed we can also contact the CUPS author via personal mail
&gt; to find out what the nowadays right way is.</span >

Yes thanks for investigating.</pre>
    </div><div id="c4" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-07 10:20:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Some tests with latest CUPS 2.3.3 from OBS Printing project:

I tested normal printing with

# rm -r /var/log/cups
# mkdir /var/log/cups
# ls -ld /var/log/cups
drwxr-xr-x 2 root root 4096 Apr  7 11:40 /var/log/cups

and for me it still works well - in particular the usual
log messages from filters and backends appear in
/var/log/cups/error_log as expected because filters and
backends should write log messages to the inherited stderr
file descriptor and not try to append them directly to
/var/log/cups/error_log (via fopen on their own).

How cupsd itself creates /var/log/cups

# rm -r /var/log/cups
# systemctl start cups.service
# ls -ld /var/log/cups
drwxr-xr-x 2 root lp 4096 Apr  7 11:57 /var/log/cups

I think it is best to package /var/log/cups in the RPM
with same owner:group and permissions as cupsd creates it.

I don't know the reason why cupsd sets group 'lp'
(cf. above plain printing also works for me with group 'root')
but I guess there is a reason why the configure --with-cups-group=lp
setting is used there i.e. why group 'lp' needs read permissions.

We configure cups with (excerpts):
--with-cups-user=lp --with-cups-group=lp --with-system-groups=root
cf. our whole RPM cups.spec file at
<a href="https://build.opensuse.org/package/view_file/Printing/cups/cups.spec?expand=1">https://build.opensuse.org/package/view_file/Printing/cups/cups.spec?expand=1</a></pre>
    </div><div id="c5" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-07 12:20:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Yes, using the permissions that cupsd sets makes the most sense, since it
overrides them anyway sooner or later during runtime. Giving the lp group read
access there seems reasonable to me.

Please backport this change also for maintained cups codestreams. I will see
to it that a SUSE-CVE is assigned for this issue.</pre>
    </div><div id="c6" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Segitz</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-07 14:07:39 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Please use CVE-2021-25317 to track this</pre>
    </div><div id="c7" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-08 10:54:14 UTC
        </span>
      </div>



<pre class="bz_comment_text" >How cupsd in latest CUPS 2.3.3 from OBS Printing project
creates directories:

drwxr-xr-x 2 root lp ... /etc/cups/ppd
drwx--x--- 3 root lp ... /var/spool/cups
drwxrwx--T 2 root lp ... /var/spool/cups/tmp
drwxr-xr-x 2 root lp ... /var/log/cups
drwxrwx--- 3 root lp ... /var/cache/cups

How we create those directories in our RPM cups.spec file:

%dir %attr(755,root,lp) %{_sysconfdir}/cups/ppd
%dir %attr(0710,root,lp) %{_var}/spool/cups
%dir %attr(1770,root,lp) %{_var}/spool/cups/tmp
%dir %attr(0755,lp,lp) %{_var}/log/cups/
%dir %attr(0775,lp,lp) %{_var}/cache/cups

which results

drwxr-xr-x 2 root lp ... /etc/cups/ppd
drwx--x--- 3 root lp ... /var/spool/cups
drwxrwx--T 2 root lp ... /var/spool/cups/tmp
drwxr-xr-x 2 lp lp   ... /var/log/cups
drwxrwxr-x 2 lp lp   ... /var/cache/cups

so /var/log/cups and /var/cache/cups need to be adjusted
according to how cupsd creates them.



Regarding other directories that we create with special
owner group and permission settings in our cups.spec file:

%dir %attr(700,root,lp) %{_sysconfdir}/cups/ssl
%dir %attr(0775,root,ntadmin) %{_datadir}/cups/drivers
%dir %attr(0755,root,lp) /etc/cups

Those directories are not created by cupsd.


Regarding /etc/cups

cupsd cannot start if there is no /etc/cups
because cupsd needs a /etc/cups/cupsd.conf file
and without it cupsd aborts with
-------------------------------------------------------------------
# journalctl -xe

... linux-h9wr cupsd[8150]:
 Unable to open &quot;/etc/cups/cupsd.conf&quot; - No such file or directory
... linux-h9wr systemd[1]: cups.service:
 Main process exited, code=exited, status=1/FAILURE
... linux-h9wr systemd[1]: Failed to start CUPS Scheduler.
-------------------------------------------------------------------

I think

drwxr-xr-x 6 root lp ... /etc/cups

is OK.


Regarding /usr/share/cups/drivers

I don't know the reason for the 'ntadmin' group
(at least there is such a group in /etc/group)
so I hope

drwxrwxr-x 2 root ntadmin ... /usr/share/cups/drivers

is OK.


Regarding /etc/cups/ssl:

When it is missing
------------------------------------------------------------
# lpstat -E -p
lpstat: Bad file descriptor
------------------------------------------------------------
so we need to create it.

For me it works as follows
(cf. <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED NORESPONSE"
   href="show_bug.cgi?id=1108444#c2">https://bugzilla.suse.com/show_bug.cgi?id=1108444#c2</a>)
------------------------------------------------------------
linux-h9wr:~ # mkdir -m 700 /etc/cups/ssl

linux-h9wr:~ # lpstat -E -p
printer ps is idle.  enabled since Mon Mar 29 12:35:42 2021

linux-h9wr:~ # ls -ld /etc/cups/ssl
drwx------ 2 root root ... /etc/cups/ssl

linux-h9wr:~ # ls -l /etc/cups/ssl/*
-rw-r--r-- 1 root root ... /etc/cups/ssl/linux-h9wr.crt
-rw-r--r-- 1 root root ... /etc/cups/ssl/linux-h9wr.key
------------------------------------------------------------

In contrast we create it in our RPM as

drwx------ 2 root lp ... /etc/cups/ssl

with files in it like

-rw-r--r-- 1 root root ... /etc/cups/ssl/linux-h9wr.crt
-rw-r--r-- 1 root root ... /etc/cups/ssl/linux-h9wr.key

I think it does not make sense to create a directory
with group 'lp' but without any group permissions
so I think we should create /etc/cups/ssl as

%dir %attr(700,root,root) %{_sysconfdir}/cups/ssl</pre>
    </div><div id="c8" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-08 10:55:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >We now involved RedHat who also has the same issue in their packaging. We are
currently negotiating a publication date for the finding. They seem to like a
later date for this (latest date according to our policy is 2021-06-28).

Please don't leak any information about this into OBS (including Factory)
until the to-be-established publication date is reached. For IBS this means
that updates can be submitted and processed but cannot be released before the
publication date is reached.

In updates please add the CVE number found in the bug summary to the changes
file for reference.</pre>
    </div><div id="c9" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-12 08:26:04 UTC
        </span>
      </div>



<pre class="bz_comment_text" >How things are on SLE15 with CUPS 2.2.7:

How we create directories via RPM:

drwxr-xr-x 2 root lp 4096 Apr  6  2020 /etc/cups/ppd
drwxrwxr-x 2 lp   lp 4096 Apr  6  2020 /var/cache/cups
drwxr-xr-x 2 lp   lp 4096 Apr  6  2020 /var/log/cups
drwx--x--- 3 root lp 4096 Feb 24 11:51 /var/spool/cups
drwxrwx--T 2 root lp 4096 Apr  6  2020 /var/spool/cups/tmp

drwx------ 2 root lp 4096 Apr  6  2020 /etc/cups/ssl/

How cupsd creates them:

drwxr-xr-x 2 root lp 4096 Apr 12 10:16 /etc/cups/ppd
drwxrwx--- 3 root lp 4096 Apr 12 10:17 /var/cache/cups
drwxr-xr-x 2 root lp 4096 Apr 12 10:17 /var/log/cups
drwx--x--- 3 root lp 4096 Apr 12 10:16 /var/spool/cups
drwxrwx--T 2 root lp 4096 Apr 12 10:16 /var/spool/cups/tmp

# lpstat -E -p
also works on SLE15 with CUPS 2.2.7 with
drwx------ 2 root root 4096 Apr 12 10:22 /etc/cups/ssl</pre>
    </div><div id="c12" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-12 11:29:46 UTC
        </span>
      </div>



<pre class="bz_comment_text" >How things are on SLE12 with CUPS 1.7.5:

How we create directories via RPM:

drwxr-xr-x 2 root lp 4096 Feb 27  2019 /etc/cups/ppd
drwx--x--- 3 root lp 4096 Feb 25 10:10 /var/spool/cups
drwxrwx--T 2 root lp 4096 Feb 27  2019 /var/spool/cups/tmp
drwxr-xr-x 2 lp lp 4096 Feb 27  2019 /var/log/cups
drwxrwxr-x 2 lp lp 4096 Feb 27  2019 /var/cache/cups

drwx------ 2 root lp 4096 Feb 27  2019 /etc/cups/ssl

How cupsd creates them:

drwxr-xr-x 2 root lp 4096 Apr 12 13:22 /etc/cups/ppd
drwx--x--- 3 root lp 4096 Apr 12 13:22 /var/spool/cups
drwxrwx--T 2 root lp 4096 Apr 12 13:22 /var/spool/cups/tmp
drwxr-xr-x 2 root lp 4096 Apr 12 13:21 /var/log/cups
drwxrwxr-x 3 root lp 4096 Apr 12 13:22 /var/cache/cups

# lpstat -E -p
also works on SLE12 with CUPS 1.7.5 with

# mkdir -m 700 /etc/cups/ssl
drwx------ 2 root root 4096 Apr 12 13:22 /etc/cups/ssl

where cupsd creates files in /etc/cups/ssl like
-rw------- 1 root lp 1241 Apr 12 13:22 server.crt
-rw------- 1 root lp 1704 Apr 12 13:22 server.key</pre>
    </div><div id="c16" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-13 06:55:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >How things are on SLE11 with CUPS 1.3.9:

How we create directories via RPM:

drwxr-xr-x 2 root lp 4096 May 27  2015 /etc/cups/ppd
drwx--x--- 3 root lp 4096 Jun  9  2020 /var/spool/cups
drwxrwx--T 2 root lp 4096 May 27  2015 /var/spool/cups/tmp
drwxr-xr-x 2 lp lp 4096 May 27  2015 /var/log/cups
drwxrwxr-x 2 lp lp 4096 May 27  2015 /var/cache/cups

drwx------ 2 root lp 4096 May 27  2015 /etc/cups/ssl

How cupsd creates them:

drwxr-xr-x 2 root lp 4096 Apr 13 08:46 /etc/cups/ppd
drwx--x--- 3 root lp 4096 Apr 13 08:46 /var/spool/cups
drwxrwx--T 2 root lp 4096 Apr 13 08:46 /var/spool/cups/tmp
drwxr-xr-x 2 root lp 4096 Apr 13 08:46 /var/log/cups

cupsd does not create /var/cache/cups

# lpstat -E -p
also works on SLE11 with CUPS 1.3.9 with

# mkdir -m 700 /etc/cups/ssl
drwx------ 2 root root 4096 Apr 13 08:48 /etc/cups/ssl

where cupsd creates files in /etc/cups/ssl like
-rw------- 1 root lp 1013 Apr 13 08:48 server.crt
-rw------- 1 root lp  887 Apr 13 08:48 server.key</pre>
    </div><div id="c17" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-13 07:21:38 UTC
        </span>
      </div>



<pre class="bz_comment_text" >On SLE11 with CUPS 1.3.9
cupsd does not create /var/cache/cups
but it creates /etc/cups/yes instead

drwxrwxr-x 3 root lp 4096 Apr 13 09:05 /etc/cups/yes

because on SLE11 cups.spec contains

configure ... --with-cachedir

instead of what we have in SLE12 and later

configure ... --with-cachedir=/var/cache/cups

cf. in cups.changes
-------------------------------------------------------------------
Wed Jan 27 14:43:37 CET 2010 - <a href="mailto:jsmeix&#64;suse.de">jsmeix&#64;suse.de</a>
...
- Added the explicite path to '--with-cachedir=/var/cache/cups'
  in cups.spec to avoid that the fallback value 'yes' results
  the cache directory '/etc/cups/yes/'.
-------------------------------------------------------------------

Because this issue here is not about /var/cache/cups
and because the right owner group and permissions are set 
by cupsd for /etc/cups/yes and it works this way in SLE11
I will not introduce a not needed change here for SLE11.</pre>
    </div><div id="c20" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-13 11:25:32 UTC
        </span>
      </div>



<pre class="bz_comment_text" >How things are on SLE10 with CUPS 1.1.23:

How the directories are after SL10-SP4 installation
(in SLE10 cupsd gets started by default so cupsd
 is already running after SL10-SP4 installation):

drwxr-xr-x 2 lp lp 48 2010-11-09 11:14 /etc/cups/ppd
drwx--x--- 3 lp lp 72 2021-04-13 12:39 /var/spool/cups
drwxrwx--T 2 lp lp 48 2010-11-09 11:14 /var/spool/cups/tmp
drwxr-xr-x 2 lp lp 80 2021-04-13 12:45 /var/log/cups
drwx------ 2 lp lp 48 2010-11-09 11:14 /etc/cups/ssl

/var/cache/cups: No such file or directory
/etc/cups/yes: No such file or directory

Neither the CUPS 1.1.23 sources contain any 'cache.*dir'
nor does the SLE10 cups.spec file contain 'cache'
so /var/cache/cups (or /etc/cups/yes) do not matter.

cupsd does not create any of the other directories
and things fail if those directories are missing like

# lpadmin -p testy -v file:///dev/null \
 -P /usr/share/cups/model/Postscript.ppd.gz -E
lpadmin: Unable to create temporary file: No such file or directory

and after creating a 'testy' queue

# echo hello | lp -d testy
lp: unable to create temporary file &quot;/var/spool/cups/tmp/60757b13d6839&quot;
 - No such file or directory

Furthermore in SLE10 cupsd runs as user 'lp'

# ps auxw
USER  PID %CPU %MEM   VSZ  RSS TTY STAT START TIME COMMAND
lp   9507  0.0  0.4 24508 4652 ?   Ss   12:49 0:00 /usr/sbin/cupsd

according to /etc/cups/cupsd.conf

User lp
Group lp
RunAsUser Yes

So owner group lp:lp of those directories look right on SLE10.

Cf.
<a href="https://en.opensuse.org/SDB:CUPS_in_a_Nutshell">https://en.opensuse.org/SDB:CUPS_in_a_Nutshell</a>
that reads (excerpts):
----------------------------------------------------------------
Configuration of the print queues on a CUPS &lt;= 1.5 server

...

Up to SUSE LINUX 10.1 we provided CUPS 1.1 and
since openSUSE 10.2 we provide CUPS 1.2 which is
not fully backward compatible with CUPS 1.1.

Therefore in case of an update it is recommended
not to use an outdated cupsd.conf from a CUPS 1.1
installation before but to start from scratch with the
original cupsd.conf from our CUPS 1.2 (or later) RPM.

For example RunAsUser is no longer supported
so that since openSUSE 10.2 / CUPS 1.2 the cupsd runs as root
and therefore we are back to its default &quot;basic authentication&quot;
via system users and system passwords (in /etc/shadow)
so that it works again to authenticate as &quot;root&quot;
and use the usual root system password. 
----------------------------------------------------------------

I will not change how cupsd runs on SLE10 and accordingly
I will not introduce changes of those directories for SLE10.</pre>
    </div><div id="c21" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexandros Toptsoglou</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-13 11:34:39 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SLE10 is EOL</pre>
    </div><div id="c27" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Matthias Gerstner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-15 10:32:26 UTC
        </span>
      </div>



<pre class="bz_comment_text" >So RedHat security pointed out the following constraint which changes the
assessment of the issue (excerpt from mail exchange):

<span class="quote">&gt; &gt; cupsdCheckLogFile() calls cupsFileOpen(), which calls cups_open().
&gt; &gt; [these functions are defined in file.c and log.c]
&gt; &gt;  
&gt; &gt; cups_open() verify that the file is not a symlink, via lstat (see the
&gt; &gt; code below), and sets `errno` to EPERM :</span >

indeed I did not catch that. This changes the assessment of the issue.
The check is only made after the fact, however. So while no content will
be written to the target file it will still be created for root:root
with mode 0644.

So this could influence other components in the system that are looking
for state files like /etc/setuid-debug. Or it could be used to
pre-create configuration files that normally should be readable only by
root. Another issue could be a denial-of-service attack against cupsd
itself by pointing the symlink to some device file that blocks during
open(). Furthermore kernel logic could be triggered that normally cannot
be triggered by non-root users, by opening arbitrary device files,
proc files or sysfs files etc.</pre>
    </div><div id="c29" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-15 11:58:27 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Therefore my RPM changelog text is intentionally somewhat vague
about what the actual security issue is (&quot;could lead to&quot;):
-------------------------------------------------------------------
- When cupsd creates directories with specific owner group
  and permissions (usually owner is 'root' and group matches
  &quot;configure --with-cups-group=lp&quot;) specify same owner group and
  permissions in the RPM spec file to ensure those directories
  are installed by RPM with the right settings because if those
  directories were installed by RPM with different settings then
  cupsd would use them as is and not adjust its specific owner
  group and permissions which could lead to privilege escalation
  from 'lp' user to 'root' via symlink attacks e.g. if owner is
  falsely 'lp' instead of 'root' CVE-2021-25317 (<a href="http://bugzilla.suse.com/show_bug.cgi?id=1184161">bsc#1184161</a>)
-------------------------------------------------------------------

My personal main intent behind the fix is to
clean up or old mess in our cups.spec file
how we let rpm create those directories versus
how cupsd itself creates those directories.

A security issue like privilege escalation of the 'lp' user
is of secondary importance for me here because noone must
ever let arbitrary (untrusted) users access his cupsd, cf.
&quot;It is crucial to limit access to CUPS to trusted users&quot; in
<a href="https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings">https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings</a></pre>
    </div><div id="c30" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c30">Comment 30</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Martin Wilck</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-15 15:23:08 UTC
        </span>
      </div>



<pre class="bz_comment_text" >(In reply to Johannes Meixner from <a href="show_bug.cgi?id=1184161#c29">comment #29</a>)

<span class="quote">&gt; A security issue like privilege escalation of the 'lp' user
&gt; is of secondary importance for me here because noone must
&gt; ever let arbitrary (untrusted) users access his cupsd, cf.
&gt; &quot;It is crucial to limit access to CUPS to trusted users&quot; in
&gt; <a href="https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings">https://en.opensuse.org/SDB:CUPS_and_SANE_Firewall_settings</a></span >

Fair enough, but was the concern abuse of cups via it's own network sockets?
I had imagined someone obtaining shell access because of an entirely unrelated vulnerability (e.g. in a web server). This person could then run print jobs locally and possibly exploit the privilege escalation.</pre>
    </div><div id="c35" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c35">Comment 35</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-30 10:22:23 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2021:1453-1: An update that fixes one vulnerability is now available.

Category: security (important)
Bug References: 1184161
CVE References: CVE-2021-25317
JIRA References: 
Sources used:
SUSE OpenStack Cloud Crowbar 9 (src):    cups-1.7.5-20.36.1
SUSE OpenStack Cloud Crowbar 8 (src):    cups-1.7.5-20.36.1
SUSE OpenStack Cloud 9 (src):    cups-1.7.5-20.36.1
SUSE OpenStack Cloud 8 (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Software Development Kit 12-SP5 (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server for SAP 12-SP4 (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server for SAP 12-SP3 (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP5 (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP4-LTSS (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP3-LTSS (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP3-BCL (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP2-LTSS-SAP (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP2-LTSS-ERICSSON (src):    cups-1.7.5-20.36.1
SUSE Linux Enterprise Server 12-SP2-BCL (src):    cups-1.7.5-20.36.1
HPE Helion Openstack 8 (src):    cups-1.7.5-20.36.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c36" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c36">Comment 36</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-30 10:23:33 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2021:14712-1: An update that fixes one vulnerability is now available.

Category: security (important)
Bug References: 1184161
CVE References: CVE-2021-25317
JIRA References: 
Sources used:
SUSE Linux Enterprise Server 11-SP4-LTSS (src):    cups-1.3.9-8.46.56.18.1
SUSE Linux Enterprise Point of Sale 11-SP3 (src):    cups-1.3.9-8.46.56.18.1
SUSE Linux Enterprise Debuginfo 11-SP4 (src):    cups-1.3.9-8.46.56.18.1
SUSE Linux Enterprise Debuginfo 11-SP3 (src):    cups-1.3.9-8.46.56.18.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c37" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c37">Comment 37</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-04-30 10:24:58 UTC
        </span>
      </div>



<pre class="bz_comment_text" >SUSE-SU-2021:1454-1: An update that fixes one vulnerability is now available.

Category: security (important)
Bug References: 1184161
CVE References: CVE-2021-25317
JIRA References: 
Sources used:
SUSE Manager Server 4.0 (src):    cups-2.2.7-3.26.1
SUSE Manager Retail Branch Server 4.0 (src):    cups-2.2.7-3.26.1
SUSE Manager Proxy 4.0 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Server for SAP 15-SP1 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Server for SAP 15 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Server 15-SP1-LTSS (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Server 15-SP1-BCL (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Server 15-LTSS (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Module for Development Tools 15-SP3 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Module for Development Tools 15-SP2 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Module for Basesystem 15-SP3 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise Module for Basesystem 15-SP2 (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise High Performance Computing 15-SP1-LTSS (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise High Performance Computing 15-SP1-ESPOS (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise High Performance Computing 15-LTSS (src):    cups-2.2.7-3.26.1
SUSE Linux Enterprise High Performance Computing 15-ESPOS (src):    cups-2.2.7-3.26.1
SUSE Enterprise Storage 6 (src):    cups-2.2.7-3.26.1
SUSE CaaS Platform 4.0 (src):    cups-2.2.7-3.26.1

NOTE: This line indicates an update has been released for the listed product(s). At times this might be only a partial fix. If you have questions please reach out to maintenance coordination.</pre>
    </div><div id="c38" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c38">Comment 38</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Swamp Workflow Management</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-01 01:15:42 UTC
        </span>
      </div>



<pre class="bz_comment_text" >openSUSE-SU-2021:0638-1: An update that fixes one vulnerability is now available.

Category: security (important)
Bug References: 1184161
CVE References: CVE-2021-25317
JIRA References: 
Sources used:
openSUSE Leap 15.2 (src):    cups-2.2.7-lp152.9.9.1</pre>
    </div><div id="c39" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c39">Comment 39</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-03 08:37:00 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Fixed for openSUSE Factory / Tumbleweed:
-----------------------------------------------------------------
# osc submitrequest -m 'Fixed CVE-2021-25317 (<a href="http://bugzilla.suse.com/show_bug.cgi?id=1184161">bsc#1184161</a>)' \
 home:jsmeix:branches:Printing cups Printing cups

created request id 889938


# osc request accept -m 'Fixed CVE-2021-25317 (<a href="http://bugzilla.suse.com/show_bug.cgi?id=1184161">bsc#1184161</a>)' \
 889938

Result of change request state: ok
openSUSE:Factory 
Forward this submit to it? ([y]/n)y
Fixed CVE-2021-25317 (<a href="http://bugzilla.suse.com/show_bug.cgi?id=1184161">bsc#1184161</a>)
(forwarded request 889938 from jsmeix)
New request # 889939
-----------------------------------------------------------------</pre>
    </div><div id="c40" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c40">Comment 40</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">OBSbugzilla Bot</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-03 09:10:03 UTC
        </span>
      </div>



<pre class="bz_comment_text" >This is an autogenerated message for OBS integration:
This bug (1184161) was mentioned in
<a href="https://build.opensuse.org/request/show/889939">https://build.opensuse.org/request/show/889939</a> Factory / cups</pre>
    </div><div id="c41" class="bz_comment">

      <div class="bz_comment_head">



        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=1184161#c41">Comment 41</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Johannes Meixner</span>
</span>
        </span>

        <span class="bz_comment_time">
          2021-05-10 12:06:02 UTC
        </span>
      </div>



<pre class="bz_comment_text" >Matthias Gerstner

I have a question that could be related to this issue here:

I got a OBS submitrequest for the package cups in Printing
where the '%defattr(-,root,root)' settings in cups.spec
should be removed because they
&quot;are obsolete at least since SLE12&quot;
cf.
<a href="https://build.opensuse.org/request/show/886970">https://build.opensuse.org/request/show/886970</a>

I failed to find documentation about &quot;defattr is obsolete&quot;
(I guess '%defattr(-,root,root)' is used by default)
but
my main point is if it isn't better for security
to explicitly specify '%defattr(-,root,root)'
compared to rely on whatever default?</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=1184161">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=1184161">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=1184161">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>        


<div class="navigation">
  
  <i><font color="#777777">First</font></i>
  <i><font color="#777777">Last</font></i>
  <i><font color="#777777">Prev</font></i>
  <i><font color="#777777">Next</font></i>
  &nbsp;&nbsp;
  <i><font color="#777777">This bug is not in your last
    search results.</font></i>
</div>

<br>
</div>



<div id="footer">
  <div class="intro"></div>




<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>

  <li>
        <span class="separator">| </span>
        <a href="docs/en/html/bug_page.html" target="_blank">Help</a>
      </li>
    

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <!--a id="login_link_bottom" href="show_bug.cgi?id=1184161&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a-->
  <a id="login_link_bottom" href="show_bug.cgi?id=1184161&amp;GoAheadAndLogIn=1">Log In</a>


  <form action="show_bug.cgi?id=1184161" method="POST" 
        class="mini_login bz_default_hidden"
        id="mini_login_bottom"
        onsubmit="return check_mini_login_fields( '_bottom' );"
  >
    <input id="Bugzilla_login_bottom" 
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input class="bz_password" 
           id="Bugzilla_password_bottom" 
           name="Bugzilla_password"
           type="password"
           title="Password"
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text" 
           id="Bugzilla_password_dummy_bottom" value="password"
           title="Password"
           onfocus="mini_login_on_focus('_bottom')"
    >
    <input type="submit" name="GoAheadAndLogIn" value="Log in" 
            id="log_in_bottom">
    <script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>
<li id="forgot_container_bottom">
  <span class="separator">| </span>
  <a id="forgot_link_bottom" href="https://idp-portal.suse.com/univention/self-service/#page=passwordreset">Forgot Password</a>
</li>
</ul>
  </li>

  
    


  <form id="testopia_helper_frm"></form><ul class="links">
    <li>Legal: </li>
    <li><a href="http://en.opensuse.org/Terms_of_site">openSUSE</a></li>
    <li><a href="https://www.suse.com/company/legal/">SUSE</a></li>
  </ul>
</ul>

  <div class="outro"></div>
</div>


</body>
</html>