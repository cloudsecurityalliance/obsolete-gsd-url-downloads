<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1374047 - (CVE-2017-7800) WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1374047">
<meta property="og:description"
      content="RESOLVED (amarchesini) in Core - DOM: Core &amp; HTML. Last updated 2019-03-13.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1374047 - (CVE-2017-7800) WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1374047&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1374047">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1374047">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/yui.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/global.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/util.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"project\":{\"cf_fission_milestone\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_root_cause\":\"---\"},\"tracking\":{\"cf_status_firefox54\":\"wontfix\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox56\":\"+\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_status_firefox_esr52\":\"fixed\",\"cf_tracking_firefox55\":\"+\",\"cf_status_firefox_esr91\":\"---\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_status_firefox56\":\"fixed\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_status_firefox55\":\"fixed\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox_esr52\":\"55+\",\"cf_status_firefox93\":\"---\",\"cf_status_firefox95\":\"---\",\"cf_tracking_firefox_esr78\":\"---\"}},\"types\":[\"tracking\"],\"comments\":{\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr52\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox55\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox56\":{\"?\":\"[Tracking Requested - why for this release]:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1374047;
  BUGZILLA.bug_title = '1374047 - (CVE-2017-7800) WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()';
  BUGZILLA.bug_summary = 'WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1374047';
  BUGZILLA.bug_keywords = 'crash, csectype-uaf, sec-critical, testcase',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/field.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/comments.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1374047">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1374047"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1374047 - (CVE-2017-7800) WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="PxRwYxOxwtULGQBecwG03UAIMvf8sgqtr4tZpVO4QwVgaCnGcsxEuTqOcmYPnn3BohhP7SWrOCMcKYfAJeFWuAmFZC27MS116WHhzg7xxfDCg2ybkIuGE41NHpHVfzoiQZMnMhbnVEOAAFFpcJ9w8vMnC0tW2FpLQD5KA9HNkj1py14BJw6hpQFhT1jfY93gaLvDLBvVd1u32DSsMjilVWI7FGKTRAa6ygF66djcP1h4Ufo6AHZRYd8eQH7UVS4q">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1374047" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623199-cFCwvarUbtnFR4SNKH6BD0adyV3pxdSTnApGwjM-X3k">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1374047" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1374047" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1374047">Bug 1374047</a>
          <span class="edit-hide">(CVE-2017-7800)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-06-18 03:51 PDT" data-time="1497783095">4 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2017-07-10 18:46 PDT" data-time="1499737589">4 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">Web<wbr>Socket - Use After Free in Web<wbr>Socket<wbr>Impl::Disconnect<wbr>Internal()</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: DOM: Core &amp; HTML, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">DOM: Core &amp; HTML
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: DOM: Core &amp; HTML</div>
            <div class="description">Issues in DOM tree <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org</a> & HTML <a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org</a> that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="DOM: Core &amp; HTML"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-version"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            54 Branch

        </span>
    </div>

  
</div>

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            All

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            critical

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;priority&quot;:&quot;--&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_status_firefox55&quot;:&quot;fixed&quot;,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;id&quot;:1374047,&quot;cf_status_firefox56&quot;:&quot;fixed&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr52&quot;:&quot;55+&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;mozilla56&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox54&quot;:&quot;wontfix&quot;,&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;keywords&quot;:[&quot;crash&quot;,&quot;csectype-uaf&quot;,&quot;sec-critical&quot;,&quot;testcase&quot;],&quot;flags&quot;:[{&quot;status&quot;:&quot;+&quot;,&quot;name&quot;:&quot;sec-bounty&quot;},{&quot;name&quot;:&quot;qe-verify&quot;,&quot;status&quot;:&quot;-&quot;}],&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;cf_tracking_firefox55&quot;:&quot;+&quot;,&quot;cf_status_firefox_esr52&quot;:&quot;fixed&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_tracking_firefox56&quot;:&quot;+&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla56

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox54</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox55</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox56</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr52-dirty">
  <select id="cf_tracking_firefox_esr52" name="cf_tracking_firefox_esr52">
        <option value="55+"
          id="v3130_cf_tracking_firefox_esr52" selected
        >55+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="fixed"
          id="v3137_cf_status_firefox_esr52" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox54</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox54-dirty">
  <select id="cf_status_firefox54" name="cf_status_firefox54">
        <option value="wontfix"
          id="v3047_cf_status_firefox54" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox55</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox55-dirty">
  <select id="cf_tracking_firefox55" name="cf_tracking_firefox55">
        <option value="+"
          id="v3175_cf_tracking_firefox55" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox55-dirty">
  <select id="cf_status_firefox55" name="cf_status_firefox55">
        <option value="fixed"
          id="v3183_cf_status_firefox55" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox56</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox56-dirty">
  <select id="cf_tracking_firefox56" name="cf_tracking_firefox56">
        <option value="+"
          id="v3273_cf_tracking_firefox56" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox56-dirty">
  <select id="cf_status_firefox56" name="cf_status_firefox56">
        <option value="fixed"
          id="v3281_cf_status_firefox56" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: loobenyang, Assigned: baku)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_446257" ><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=446257" > <span class="fna">baku</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_506912" ><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=506912" > <span class="fna">loobenyang</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_434964" ><img src="https://secure.gravatar.com/avatar/331afc283e18d6d28cb7ebb11b2cf5bb?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=434964" > <span class="fna">hsinyi</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="11">11 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list edit-show" id="field-dependson" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-see_also" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
        ---
        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (4 keywords, Whiteboard: [adv-main55+][adv-esr52.3+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2017-7800

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=crash&amp;resolution=---">crash</a>, 
          <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a>, 
          <a href="/buglist.cgi?keywords=sec-critical&amp;resolution=---">sec-critical</a>, 
          <a href="/buglist.cgi?keywords=testcase&amp;resolution=---">testcase</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[adv-main55+][adv-esr52.3+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a2529844_1689"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1497891105"
      >sec-bounty</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag-1599945">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1599945-dirty">
      <select id="flag-1599945" name="flag-1599945"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
            <option value="+" selected>+</option>
      </select>
    </td>


  </tr>
          </tbody>
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c19"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1500013321"
      >qe-verify</a>
    </td>

    <td class="flag-value">-
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag-1611616">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1611616-dirty">
      <select id="flag-1611616" name="flag-1611616"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
            <option value="-" selected>-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (4 files, 1 obsolete file)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8878874">UAF_DisconnectInternal_Repro.js</a>
        </div>
        <div>
            <a href="#c0" class="attach-time activity-ref"><span class="rel-time" title="2017-06-18 03:51 PDT" data-time="1497783095">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div></span>
        </div>
        <div class="attach-info">1.09 KB,
          application/javascript        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8878874&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8879063">UAF_DisconnectInternal_POC_EIP_41414141.js</a>
        </div>
        <div>
            <a href="#c2" class="attach-time activity-ref"><span class="rel-time" title="2017-06-19 02:34 PDT" data-time="1497864868">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div></span>
        </div>
        <div class="attach-info">1.89 KB,
          text/plain        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8879063&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8879832">websocket.patch</a>
        </div>
        <div>
            <a href="#c4" class="attach-time activity-ref"><span class="rel-time" title="2017-06-20 23:18 PDT" data-time="1498025925">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_446257" ><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.64 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_39966" ><span class="fn">smaug</span>
</div>:
              <a href="#c5"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1498025925"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_280903" ><span class="fn">abillings</span>
</div>:
              <a href="#c9"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1498044114"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8879832&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8879832&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1374047&attachment=8879832">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885156">websocket.patch</a>
        </div>
        <div>
            <a href="#c14" class="attach-time activity-ref"><span class="rel-time" title="2017-07-11 01:56 PDT" data-time="1499763384">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_446257" ><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.69 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_580382" ><span class="fn">jcristau</span>
</div>:
              <a href="#c16"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499763567"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_580382" ><span class="fn">jcristau</span>
</div>:
              <a href="#c16"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499763567"
            >
              approval-mozilla-esr52+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885156&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885156&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1374047&attachment=8885156">Splinter Review</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8888118">UAF_DisconnectInternal_POC_EIP_41414141_2.js</a>
        </div>
        <div>
            <a href="#c22" class="attach-time activity-ref"><span class="rel-time" title="2017-07-19 18:21 PDT" data-time="1500513705">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div></span>
        </div>
        <div class="attach-info">1.68 KB,
          text/plain        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8888118&amp;action=edit">Details</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="sBUJzHSAHglPqMATJMUlAOshn1UqxAPaKjKm4ptEbBPuQs5H">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12407575" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506912" ><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-18 03:51 PDT" data-time="1497783095">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8878874"
         class="attachment"
         data-id="8878874" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="UAF_DisconnectInternal_Repro.js">
      <meta itemprop="contentSize" content="1118">
      <meta itemprop="encodingFormat" content="application/javascript">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8878874" itemprop="contentUrl">
        <span id="att-8878874-description" itemprop="description">UAF_DisconnectInternal_Repro.js</span></a>
        — <a href="attachment.cgi?id=8878874&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-0" data-comment-id="12407575">Reproduction test case (whole server code in attached file UAF_DisconnectInternal_Repro.js):

	Main page code:
		&lt;script&gt;
		var worker0 = new Worker(&quot;worker0.js&quot;);
		setTimeout(function(){ worker0.terminate();}, 200);
		setTimeout(function(){location.reload()},200);
		&lt;/script&gt;
	Worker code:
		new WebSocket(&quot;ws://localhost:12345/&quot;, &quot;wsm1-protocol&quot;);;
		
Steps to reproduce: 
	1. Run server side script UAF_DisconnectInternal_Repro.js with Node.js (node UAF_DisconnectInternal_Repro.js).
	2. Enter <a rel="nofollow" href="http://localhost:12345">http://localhost:12345</a> in Firefox browser.

Firefox version: 54.0 (32-bit)
OS: Windows 10

Stack trace:


	(16a8.30b4): Access violation - code c0000005 (!!! second chance !!!)
	eax=00000000 ebx=18d77028 ecx=18d77028 edx=e5e5e5e5 esi=67d4b030 edi=18d76f80
	eip=65f98e0c esp=0117f1cc ebp=0117f1cc iopl=0         nv up ei ng nz na po nc
	cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00010282
	xul!mozilla::RefPtrTraits&lt;mozilla::EditTransactionBase&gt;::Release [inlined in xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef+0x12]:
	65f98e0c 8b02            mov     eax,dword ptr [edx]  ds:002b:e5e5e5e5=????????
	0:000&gt; !analyze -v
	*******************************************************************************
	*                                                                             *
	*                        Exception Analysis                                   *
	*                                                                             *
	*******************************************************************************


	FAULTING_IP: 
	xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef+12 [c:\builds\moz2_slave\m-rel-w32-00000000000000000000\build\src\obj-firefox\dist\include\mozilla\refptr.h &#64; 65]
	65f98e0c 8b02            mov     eax,dword ptr [edx]

	EXCEPTION_RECORD:  (.exr -1)
	ExceptionAddress: 65f98e0c (xul!mozilla::RefPtrTraits&lt;mozilla::EditTransactionBase&gt;::Release)
	   ExceptionCode: c0000005 (Access violation)
	  ExceptionFlags: 00000000
	NumberParameters: 2
	   Parameter[0]: 00000000
	   Parameter[1]: e5e5e5e5
	Attempt to read from address e5e5e5e5

	FAULTING_THREAD:  000030b4

	PROCESS_NAME:  firefox.exe

	ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.

	EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.

	EXCEPTION_CODE_STR:  c0000005

	EXCEPTION_PARAMETER1:  00000000

	EXCEPTION_PARAMETER2:  e5e5e5e5

	FOLLOWUP_IP: 
	xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef+12 [c:\builds\moz2_slave\m-rel-w32-00000000000000000000\build\src\obj-firefox\dist\include\mozilla\refptr.h &#64; 65]
	65f98e0c 8b02            mov     eax,dword ptr [edx]

	READ_ADDRESS:  e5e5e5e5 

	WATSON_BKT_PROCSTAMP:  59399e7c

	WATSON_BKT_PROCVER:  54.0.0.6368

	PROCESS_VER_PRODUCT:  Firefox

	WATSON_BKT_MODULE:  xul.dll

	WATSON_BKT_MODSTAMP:  5939a290

	WATSON_BKT_MODOFFSET:  88e0c

	WATSON_BKT_MODVER:  54.0.0.6368

	MODULE_VER_PRODUCT:  Firefox

	BUILD_VERSION_STRING:  10.0.15063.296 (WinBuild.160101.0800)

	MODLIST_WITH_TSCHKSUM_HASH:  6677a630c80a09dae24ad5f75ef967a3823bc5ff

	MODLIST_SHA1_HASH:  d474cec995c2004a6ffece945bcd0a3e7837f453

	NTGLOBALFLAG:  70

	PROCESS_BAM_CURRENT_THROTTLED: 0

	PROCESS_BAM_PREVIOUS_THROTTLED: 0

	APPLICATION_VERIFIER_FLAGS:  0

	PRODUCT_TYPE:  1

	SUITE_MASK:  784

	DUMP_TYPE:  fe

	ANALYSIS_SESSION_TIME:  06-18-2017 22:32:19.0170

	ANALYSIS_VERSION: 10.0.15063.400 x86fre

	THREAD_ATTRIBUTES: 
	OS_LOCALE:  ENA

	PROBLEM_CLASSES: 

		ID:     [0n292]
		Type:   [&#64;ACCESS_VIOLATION]
		Class:  Addendum
		Scope:  BUCKET_ID
		Name:   Omit
		Data:   Omit
		PID:    [Unspecified]
		TID:    [0x30b4]
		Frame:  [0] : xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef

		ID:     [0n264]
		Type:   [INVALID_POINTER_READ]
		Class:  Primary
		Scope:  DEFAULT_BUCKET_ID (Failure Bucket ID prefix)
				BUCKET_ID
		Name:   Add
		Data:   Omit
		PID:    [Unspecified]
		TID:    [0x30b4]
		Frame:  [0] : xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef

		ID:     [0n94]
		Type:   [FILL_PATTERN]
		Class:  Addendum
		Scope:  DEFAULT_BUCKET_ID (Failure Bucket ID prefix)
				BUCKET_ID
		Name:   Add
		Data:   Add
				String: [e5e5e5e5]
		PID:    [0x16a8]
		TID:    [0x30b4]
		Frame:  [0] : xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef

	BUGCHECK_STR:  APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5

	DEFAULT_BUCKET_ID:  INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5

	PRIMARY_PROBLEM_CLASS:  APPLICATION_FAULT

	LAST_CONTROL_TRANSFER:  from 66cb658b to 65f98e0c

	STACK_TEXT:  
	0117f1cc 66cb658b 00000000 00000000 16daeee0 xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef+0x12
	0117f1fc 66cba1d4 6620c149 15ac8ec0 15ac8ef4 xul!mozilla::dom::WebSocketImpl::DisconnectInternal+0x4b
	0117f200 6620c149 15ac8ec0 15ac8ef4 00000000 xul!mozilla::dom::`anonymous namespace'::DisconnectInternalRunnable::MainThreadRun+0x8
	0117f214 6620c109 16daeee0 13981380 139813b4 xul!mozilla::dom::workers::WorkerMainThreadRunnable::Run+0x15
	0117f23c 6620c08d 0117f26c 6620c109 180ec050 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76
	0117f244 6620c109 180ec050 0b1f5864 180ec060 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe
	0117f26c 6620c08d 0117f2e4 6601f80e 180ec060 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76
	0117f274 6601f80e 180ec060 03127170 03127160 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe
	0117f2e4 66020701 03104200 00000000 0117f317 xul!nsThread::ProcessNextEvent+0x213
	0117f318 66068ea0 03125060 60944f31 0b1f5860 xul!mozilla::ipc::MessagePump::Run+0x72
	0117f350 66068e6f 03104200 00000001 0b1f5800 xul!MessageLoop::RunHandler+0x20
	0117f370 662d19d8 0b1f7640 00000000 0117f390 xul!MessageLoop::Run+0x19
	0117f380 662d1767 0b1f5860 0b1f7640 0117f3a4 xul!nsBaseAppShell::Run+0x34
	0117f390 662d171c 0b1f5860 0117f6f5 0c30a440 xul!nsAppShell::Run+0x26
	0117f3a4 66505f9e 0b1f7640 0117f5f8 0117f610 xul!nsAppStartup::Run+0x22
	0117f598 665069d0 03103050 0117f740 00000001 xul!XREMain::XRE_mainRun+0xa92
	0117f5d4 6658b805 00000000 0117f610 0017f740 xul!XREMain::XRE_main+0x37b
	0117f700 6658b7c7 0117f740 0117fa84 01321bdd xul!XRE_main+0x39
	0117f70c 01321bdd 00000001 03103050 0117f740 xul!mozilla::BootstrapImpl::XRE_main+0x11
	0117fa84 01325b7f 00000001 fe615d08 01718b50 firefox!wmain+0x65d
	0117facc 73b48744 00ee0000 73b48720 7b9e292a firefox!__scrt_common_main_seh+0xf9
	0117fae0 770a587d 00ee0000 7f378ec4 00000000 KERNEL32!BaseThreadInitThunk+0x24
	0117fb28 770a584d ffffffff 770c6344 00000000 ntdll!__RtlUserThreadStart+0x2f
	0117fb38 00000000 01325bf5 00ee0000 00000000 ntdll!_RtlUserThreadStart+0x1b


	THREAD_SHA1_HASH_MOD_FUNC:  c69ed9af77e0e3ae8946fbf3e674aa21f178e624

	THREAD_SHA1_HASH_MOD_FUNC_OFFSET:  b2a6a3a18b4b25d90fe64452661d0eb068d1731a

	THREAD_SHA1_HASH_MOD:  1e517827cf137402b6881f2d4a04f0647425c5be

	FAULT_INSTR_CODE:  ff52028b

	FAULTING_SOURCE_LINE:  c:\builds\moz2_slave\m-rel-w32-00000000000000000000\build\src\obj-firefox\dist\include\mozilla\refptr.h

	FAULTING_SOURCE_FILE:  c:\builds\moz2_slave\m-rel-w32-00000000000000000000\build\src\obj-firefox\dist\include\mozilla\refptr.h

	FAULTING_SOURCE_LINE_NUMBER:  65

	SYMBOL_STACK_INDEX:  0

	SYMBOL_NAME:  xul!RefPtr&lt;mozilla::EditTransactionBase&gt;::assign_assuming_AddRef+12

	FOLLOWUP_NAME:  MachineOwner

	MODULE_NAME: xul

	IMAGE_NAME:  xul.dll

	DEBUG_FLR_IMAGE_TIMESTAMP:  5939a290

	STACK_COMMAND:  ~0s ; kb

	FAILURE_BUCKET_ID:  INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_c0000005_xul.dll!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef

	BUCKET_ID:  APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_xul!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef+12

	FAILURE_EXCEPTION_CODE:  c0000005

	FAILURE_IMAGE_NAME:  xul.dll

	BUCKET_ID_IMAGE_STR:  xul.dll

	FAILURE_MODULE_NAME:  xul

	BUCKET_ID_MODULE_STR:  xul

	FAILURE_FUNCTION_NAME:  RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef

	BUCKET_ID_FUNCTION_STR:  RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef

	BUCKET_ID_OFFSET:  12

	BUCKET_ID_MODTIMEDATESTAMP:  5939a290

	BUCKET_ID_MODCHECKSUM:  31298a4

	BUCKET_ID_MODVER_STR:  54.0.0.6368

	BUCKET_ID_PREFIX_STR:  APPLICATION_FAULT_INVALID_POINTER_READ_FILL_PATTERN_e5e5e5e5_

	FAILURE_PROBLEM_CLASS:  APPLICATION_FAULT

	FAILURE_SYMBOL_NAME:  xul.dll!RefPtr_mozilla::EditTransactionBase_::assign_assuming_AddRef

	WATSON_STAGEONE_URL:  <a rel="nofollow" href="http://watson.microsoft.com/StageOne/firefox.exe/54.0.0.6368/59399e7c/xul.dll/54.0.0.6368/5939a290/c0000005/00088e0c.htm?Retriage=1">http://watson.microsoft.com/StageOne/firefox.exe/54.0.0.6368/59399e7c/xul.dll/54.0.0.6368/5939a290/c0000005/00088e0c.htm?Retriage=1</a>

	TARGET_TIME:  2017-06-18T10:33:04.000Z

	OSBUILD:  15063

	OSSERVICEPACK:  296

	SERVICEPACK_NUMBER: 0

	OS_REVISION: 0

	OSPLATFORM_TYPE:  x86

	OSNAME:  Windows 10

	OSEDITION:  Windows 10 WinNt SingleUserTS Personal

	USER_LCID:  0

	OSBUILD_TIMESTAMP:  unknown_date

	BUILDDATESTAMP_STR:  160101.0800

	BUILDLAB_STR:  WinBuild

	BUILDOSVER_STR:  10.0.15063.296

	ANALYSIS_SESSION_ELAPSED_TIME:  104d4

	ANALYSIS_SOURCE:  UM

	FAILURE_ID_HASH_STRING:  um:invalid_pointer_read_fill_pattern_e5e5e5e5_c0000005_xul.dll!refptr_mozilla::edittransactionbase_::assign_assuming_addref

	FAILURE_ID_HASH:  {6bdf5e90-d575-dd3a-0b53-74c46bf9fa98}

	Followup:     MachineOwner
	---------

Variable shows the WebSocketImpl object had been freed:

	0:000&gt; dt this
	Local var &#64; edi Type mozilla::dom::WebSocketImpl*
	   +0x000 __VFN_table : 0xe5e5e5e5 
	   +0x004 __VFN_table : 0xe5e5e5e5 
	   +0x008 __VFN_table : 0xe5e5e5e5 
	   +0x00c __VFN_table : 0xe5e5e5e5 
	   +0x010 mProxy           : 0xe5e5e5e5 nsWeakReference
	   +0x014 __VFN_table : 0xe5e5e5e5 
	   +0x018 __VFN_table : 0xe5e5e5e5 
	   +0x01c mRefCnt          : mozilla::ThreadSafeAutoRefCnt
	   +0x020 mWebSocket       : RefPtr&lt;mozilla::dom::WebSocket&gt;
	   +0x024 mChannel         : nsCOMPtr&lt;nsIWebSocketChannel&gt;
	   +0x028 mIsServerSide    : ffffffffffffffe5
	   +0x029 mSecure          : ffffffffffffffe5
	   +0x02a mOnCloseScheduled : ffffffffffffffe5
	   +0x02b mFailed          : ffffffffffffffe5
	   +0x02c mDisconnectingOrDisconnected : ffffffffffffffe5
	   +0x02d mCloseEventWasClean : ffffffffffffffe5
	   +0x030 mCloseEventReason : nsString
	   +0x03c mCloseEventCode  : 0xe5e5
	   +0x040 mAsciiHost       : nsCString
	   +0x04c mPort            : 0xe5e5e5e5
	   +0x050 mResource        : nsCString
	   +0x05c mUTF16Origin     : nsString
	   +0x068 mURI             : nsCString
	   +0x074 mRequestedProtocolList : nsCString
	   +0x080 mOriginDocument  : nsCOMPtr&lt;nsIWeakReference&gt;
	   +0x084 mScriptFile      : nsCString
	   +0x090 mScriptLine      : 0xe5e5e5e5
	   +0x094 mScriptColumn    : 0xe5e5e5e5
	   +0x098 mInnerWindowID   : 0xe5e5e5e5`e5e5e5e5
	   +0x0a0 mWorkerPrivate   : 0xe5e5e5e5 mozilla::dom::workers::WorkerPrivate
	   +0x0a4 mWorkerHolder    : nsAutoPtr&lt;mozilla::dom::workers::WorkerHolder&gt;
	   +0x0a8 mWeakLoadGroup   : nsCOMPtr&lt;nsIWeakReference&gt;
	   +0x0ac mIsMainThread    : ffffffffffffffe5
	   +0x0b0 mMutex           : mozilla::Mutex
	   +0x0b4 mWorkerShuttingDown : ffffffffffffffe5
	   +0x0b8 mService         : RefPtr&lt;mozilla::net::WebSocketEventService&gt;</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12407975" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506912" ><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-18 16:12 PDT" data-time="1497827542">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="12407975">Ran the same test case in local built Linux ASAN build, it did report a Use After Free:

Firefox version: 56.0a1 (2017-06-17) (64-bit)

=================================================================
==2917==ERROR: AddressSanitizer: heap-use-after-free on address 0x6130000d0388 at pc 0x7f8911403be3 bp 0x7fffcedacf50 sp 0x7fffcedacf48
READ of size 8 at 0x6130000d0388 thread T0 (Web Content)
    #0 0x7f8911403be2 in assign_assuming_AddRef /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/nsCOMPtr.h:329:27
    #1 0x7f8911403be2 in operator= /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/nsCOMPtr.h:600
    #2 0x7f8911403be2 in mozilla::dom::WebSocketImpl::DisconnectInternal() /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:666
    #3 0x7f891147b96f in mozilla::dom::(anonymous namespace)::DisconnectInternalRunnable::MainThreadRun() /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:597:5
    #4 0x7f8914b01c04 in mozilla::dom::workers::WorkerMainThreadRunnable::Run() /home/thecoder/OpenSrc/firefox/dom/workers/WorkerRunnable.cpp:608:20
    #5 0x7f890e173712 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:190:15
    #6 0x7f890e17324f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:74:7
    #7 0x7f890e173712 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:190:15
    #8 0x7f890e17324f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:74:7
    #9 0x7f890e157a9f in mozilla::SchedulerGroup::Runnable::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/SchedulerGroup.cpp:368:14
    #10 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #11 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #12 0x7f890f22bc91 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/thecoder/OpenSrc/firefox/ipc/glue/MessagePump.cpp:96:21
    #13 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #14 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #15 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #16 0x7f89151319ff in nsBaseAppShell::Run() /home/thecoder/OpenSrc/firefox/widget/nsBaseAppShell.cpp:156:3
    #17 0x7f8919da4eb7 in XRE_RunAppShell() /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:896:12
    #18 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #19 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #20 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #21 0x7f8919da4404 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:712:7
    #22 0x4f6255 in content_process_main /home/thecoder/OpenSrc/firefox/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19
    #23 0x4f6255 in main /home/thecoder/OpenSrc/firefox/browser/app/nsBrowserApp.cpp:286
    #24 0x7f892b1ba82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)
    #25 0x41da58 in _start (/home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/bin/firefox+0x41da58)

0x6130000d0388 is located 264 bytes inside of 336-byte region [0x6130000d0280,0x6130000d03d0)
freed by thread T0 (Web Content) here:
    #0 0x4bef80 in __interceptor_cfree.localalias.0 /home/thecoder/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:45
    #1 0x7f8911400172 in operator delete /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/mozilla/mozalloc.h:218:12
    #2 0x7f8911400172 in Release /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:259
    #3 0x7f8911400172 in non-virtual thunk to mozilla::dom::WebSocketImpl::Release() /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:259
    #4 0x7f890e33b4dc in ~nsCOMPtr_base /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/nsCOMPtr.h:294:7
    #5 0x7f890e33b4dc in mozilla::net::nsLoadGroup::RemoveRequest(nsIRequest*, nsISupports*, nsresult) /home/thecoder/OpenSrc/firefox/netwerk/base/nsLoadGroup.cpp:644
    #6 0x7f8911403952 in mozilla::dom::WebSocketImpl::DisconnectInternal() /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:663:5
    #7 0x7f891147b96f in mozilla::dom::(anonymous namespace)::DisconnectInternalRunnable::MainThreadRun() /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:597:5
    #8 0x7f8914b01c04 in mozilla::dom::workers::WorkerMainThreadRunnable::Run() /home/thecoder/OpenSrc/firefox/dom/workers/WorkerRunnable.cpp:608:20
    #9 0x7f890e173712 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:190:15
    #10 0x7f890e17324f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:74:7
    #11 0x7f890e173712 in mozilla::ThrottledEventQueue::Inner::ExecuteRunnable() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:190:15
    #12 0x7f890e17324f in mozilla::ThrottledEventQueue::Inner::Executor::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/ThrottledEventQueue.cpp:74:7
    #13 0x7f890e157a9f in mozilla::SchedulerGroup::Runnable::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/SchedulerGroup.cpp:368:14
    #14 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #15 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #16 0x7f890f22bc91 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/thecoder/OpenSrc/firefox/ipc/glue/MessagePump.cpp:96:21
    #17 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #18 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #19 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #20 0x7f89151319ff in nsBaseAppShell::Run() /home/thecoder/OpenSrc/firefox/widget/nsBaseAppShell.cpp:156:3
    #21 0x7f8919da4eb7 in XRE_RunAppShell() /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:896:12
    #22 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #23 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #24 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #25 0x7f8919da4404 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:712:7
    #26 0x4f6255 in content_process_main /home/thecoder/OpenSrc/firefox/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19
    #27 0x4f6255 in main /home/thecoder/OpenSrc/firefox/browser/app/nsBrowserApp.cpp:286
    #28 0x7f892b1ba82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)

previously allocated by thread T29 (DOM Worker) here:
    #0 0x4bf108 in __interceptor_malloc /home/thecoder/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52
    #1 0x4f72dd in moz_xmalloc /home/thecoder/OpenSrc/firefox/memory/mozalloc/mozalloc.cpp:83:17
    #2 0x7f8911409473 in operator new /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/mozilla/mozalloc.h:194:12
    #3 0x7f8911409473 in WebSocket /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:945
    #4 0x7f8911409473 in mozilla::dom::WebSocket::ConstructorCommon(mozilla::dom::GlobalObject const&amp;, nsAString const&amp;, mozilla::dom::Sequence&lt;nsString&gt; const&amp;, nsITransportProvider*, nsACString const&amp;, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:1287
    #5 0x7f891140b3fe in mozilla::dom::WebSocket::Constructor(mozilla::dom::GlobalObject const&amp;, nsAString const&amp;, nsAString const&amp;, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/base/WebSocket.cpp:986:10
    #6 0x7f89128b2000 in mozilla::dom::WebSocketBinding::_constructor(JSContext*, unsigned int, JS::Value*) /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dom/bindings/WebSocketBinding.cpp:1073:59
    #7 0x7f891a34790b in CallJSNative /home/thecoder/OpenSrc/firefox/js/src/jscntxtinlines.h:293:15
    #8 0x7f891a34790b in CallJSNativeConstructor /home/thecoder/OpenSrc/firefox/js/src/jscntxtinlines.h:326
    #9 0x7f891a34790b in InternalConstruct(JSContext*, js::AnyConstructArgs const&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:573
    #10 0x7f891a32e4c8 in ConstructFromStack /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:599:12
    #11 0x7f891a32e4c8 in Interpret(JSContext*, js::RunState&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:3059
    #12 0x7f891a315250 in js::RunScript(JSContext*, js::RunState&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:410:12
    #13 0x7f891a3491cb in js::ExecuteKernel(JSContext*, JS::Handle&lt;JSScript*&gt;, JSObject&amp;, JS::Value const&amp;, js::AbstractFramePtr, JS::Value*) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:699:15
    #14 0x7f891a349a49 in js::Execute(JSContext*, JS::Handle&lt;JSScript*&gt;, JSObject&amp;, JS::Value*) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:731:12
    #15 0x7f891acf3543 in Evaluate(JSContext*, js::ScopeKind, JS::Handle&lt;JSObject*&gt;, JS::ReadOnlyCompileOptions const&amp;, JS::SourceBufferHolder&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/thecoder/OpenSrc/firefox/js/src/jsapi.cpp:4719:19
    #16 0x7f891acf3d2f in JS::Evaluate(JSContext*, JS::ReadOnlyCompileOptions const&amp;, JS::SourceBufferHolder&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/thecoder/OpenSrc/firefox/js/src/jsapi.cpp:4784:12
    #17 0x7f8914a44959 in (anonymous namespace)::ScriptExecutorRunnable::WorkerRun(JSContext*, mozilla::dom::workers::WorkerPrivate*) /home/thecoder/OpenSrc/firefox/dom/workers/ScriptLoader.cpp:1969:10
    #18 0x7f8914b00077 in mozilla::dom::workers::WorkerRunnable::Run() /home/thecoder/OpenSrc/firefox/dom/workers/WorkerRunnable.cpp:374:12
    #19 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #20 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #21 0x7f8914af0d17 in mozilla::dom::workers::WorkerPrivate::RunCurrentSyncLoop() /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:5874:7
    #22 0x7f89149f2bb2 in Run /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.h:1644:12
    #23 0x7f89149f2bb2 in (anonymous namespace)::LoadAllScripts(mozilla::dom::workers::WorkerPrivate*, nsTArray&lt;(anonymous namespace)::ScriptLoadInfo&gt;&amp;, bool, mozilla::dom::workers::WorkerScriptType, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/workers/ScriptLoader.cpp:2127
    #24 0x7f89149f24b5 in mozilla::dom::workers::scriptloader::LoadMainScript(mozilla::dom::workers::WorkerPrivate*, nsAString const&amp;, mozilla::dom::workers::WorkerScriptType, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/workers/ScriptLoader.cpp:2245:3
    #25 0x7f8914b10d0d in (anonymous namespace)::CompileScriptRunnable::WorkerRun(JSContext*, mozilla::dom::workers::WorkerPrivate*) /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:586:5
    #26 0x7f8914b00077 in mozilla::dom::workers::WorkerRunnable::Run() /home/thecoder/OpenSrc/firefox/dom/workers/WorkerRunnable.cpp:374:12
    #27 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #28 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #29 0x7f8914aea4f3 in mozilla::dom::workers::WorkerPrivate::DoRunLoop(JSContext*) /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:5118:7
    #30 0x7f8914a36f75 in (anonymous namespace)::WorkerThreadPrimaryRunnable::Run() /home/thecoder/OpenSrc/firefox/dom/workers/RuntimeService.cpp:2916:9
    #31 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #32 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #33 0x7f890f22d296 in mozilla::ipc::MessagePumpForNonMainThreads::Run(base::MessagePump::Delegate*) /home/thecoder/OpenSrc/firefox/ipc/glue/MessagePump.cpp:368:5
    #34 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #35 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #36 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #37 0x7f890e17e7df in nsThread::ThreadFunc(void*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:503:5

Thread T29 (DOM Worker) created by T0 (Web Content) here:
    #0 0x430489 in __interceptor_pthread_create /home/thecoder/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:243
    #1 0x7f892c5c8698 in _PR_CreateThread /home/thecoder/OpenSrc/firefox/nsprpub/pr/src/pthreads/ptthread.c:457:14
    #2 0x7f892c5c82aa in PR_CreateThread /home/thecoder/OpenSrc/firefox/nsprpub/pr/src/pthreads/ptthread.c:548:12
    #3 0x7f890e180897 in nsThread::Init(nsACString const&amp;) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:685:8
    #4 0x7f8914b0eac0 in mozilla::dom::workers::WorkerThread::Create(mozilla::dom::workers::WorkerThreadFriendKey const&amp;) /home/thecoder/OpenSrc/firefox/dom/workers/WorkerThread.cpp:90:7
    #5 0x7f89149e82a4 in mozilla::dom::workers::RuntimeService::ScheduleWorker(mozilla::dom::workers::WorkerPrivate*) /home/thecoder/OpenSrc/firefox/dom/workers/RuntimeService.cpp:1915:14
    #6 0x7f89149e5c8f in mozilla::dom::workers::RuntimeService::RegisterWorker(mozilla::dom::workers::WorkerPrivate*) /home/thecoder/OpenSrc/firefox/dom/workers/RuntimeService.cpp:1742:19
    #7 0x7f8914ae62b6 in mozilla::dom::workers::WorkerPrivate::Constructor(JSContext*, nsAString const&amp;, bool, mozilla::dom::WorkerType, nsAString const&amp;, nsACString const&amp;, mozilla::dom::workers::WorkerLoadInfo*, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:4660:8
    #8 0x7f8914ae5914 in Constructor /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:4577:10
    #9 0x7f8914ae5914 in mozilla::dom::workers::WorkerPrivate::Constructor(mozilla::dom::GlobalObject const&amp;, nsAString const&amp;, mozilla::dom::WorkerOptions const&amp;, mozilla::ErrorResult&amp;) /home/thecoder/OpenSrc/firefox/dom/workers/WorkerPrivate.cpp:4518
    #10 0x7f891294efbe in mozilla::dom::WorkerBinding::_constructor(JSContext*, unsigned int, JS::Value*) /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dom/bindings/WorkerBinding.cpp:973:68
    #11 0x7f891a34790b in CallJSNative /home/thecoder/OpenSrc/firefox/js/src/jscntxtinlines.h:293:15
    #12 0x7f891a34790b in CallJSNativeConstructor /home/thecoder/OpenSrc/firefox/js/src/jscntxtinlines.h:326
    #13 0x7f891a34790b in InternalConstruct(JSContext*, js::AnyConstructArgs const&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:573
    #14 0x7f891a32e4c8 in ConstructFromStack /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:599:12
    #15 0x7f891a32e4c8 in Interpret(JSContext*, js::RunState&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:3059
    #16 0x7f891a315250 in js::RunScript(JSContext*, js::RunState&amp;) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:410:12
    #17 0x7f891a3491cb in js::ExecuteKernel(JSContext*, JS::Handle&lt;JSScript*&gt;, JSObject&amp;, JS::Value const&amp;, js::AbstractFramePtr, JS::Value*) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:699:15
    #18 0x7f891a349a49 in js::Execute(JSContext*, JS::Handle&lt;JSScript*&gt;, JSObject&amp;, JS::Value*) /home/thecoder/OpenSrc/firefox/js/src/vm/Interpreter.cpp:731:12
    #19 0x7f891acf1bca in ExecuteScript(JSContext*, JS::AutoObjectVector&amp;, JS::Handle&lt;JSScript*&gt;, JS::Value*) /home/thecoder/OpenSrc/firefox/js/src/jsapi.cpp:4635:12
    #20 0x7f8911622269 in nsJSUtils::ExecutionContext::CompileAndExec(JS::CompileOptions&amp;, JS::SourceBufferHolder&amp;, JS::MutableHandle&lt;JSScript*&gt;) /home/thecoder/OpenSrc/firefox/dom/base/nsJSUtils.cpp:267:8
    #21 0x7f8914fcaab5 in mozilla::dom::ScriptLoader::EvaluateScript(mozilla::dom::ScriptLoadRequest*) /home/thecoder/OpenSrc/firefox/dom/script/ScriptLoader.cpp:2118:20
    #22 0x7f8914fc669e in mozilla::dom::ScriptLoader::ProcessRequest(mozilla::dom::ScriptLoadRequest*) /home/thecoder/OpenSrc/firefox/dom/script/ScriptLoader.cpp:1722:10
    #23 0x7f8914fabe76 in mozilla::dom::ScriptLoader::ProcessScriptElement(nsIScriptElement*) /home/thecoder/OpenSrc/firefox/dom/script/ScriptLoader.cpp:1424:10
    #24 0x7f8914fa80fc in mozilla::dom::ScriptElement::MaybeProcessScript() /home/thecoder/OpenSrc/firefox/dom/script/ScriptElement.cpp:149:10
    #25 0x7f89105481ed in AttemptToExecute /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/nsIScriptElement.h:225:18
    #26 0x7f89105481ed in nsHtml5TreeOpExecutor::RunScript(nsIContent*) /home/thecoder/OpenSrc/firefox/parser/html/nsHtml5TreeOpExecutor.cpp:698
    #27 0x7f8910541ab4 in nsHtml5TreeOpExecutor::RunFlushLoop() /home/thecoder/OpenSrc/firefox/parser/html/nsHtml5TreeOpExecutor.cpp:499:7
    #28 0x7f891057e2ab in nsHtml5ExecutorFlusher::Run() /home/thecoder/OpenSrc/firefox/parser/html/nsHtml5StreamParser.cpp:129:9
    #29 0x7f890e157a9f in mozilla::SchedulerGroup::Runnable::Run() /home/thecoder/OpenSrc/firefox/xpcom/threads/SchedulerGroup.cpp:368:14
    #30 0x7f890e186586 in nsThread::ProcessNextEvent(bool, bool*) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThread.cpp:1428:7
    #31 0x7f890e193b08 in NS_ProcessNextEvent(nsIThread*, bool) /home/thecoder/OpenSrc/firefox/xpcom/threads/nsThreadUtils.cpp:472:10
    #32 0x7f890f22bc91 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/thecoder/OpenSrc/firefox/ipc/glue/MessagePump.cpp:96:21
    #33 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #34 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #35 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #36 0x7f89151319ff in nsBaseAppShell::Run() /home/thecoder/OpenSrc/firefox/widget/nsBaseAppShell.cpp:156:3
    #37 0x7f8919da4eb7 in XRE_RunAppShell() /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:896:12
    #38 0x7f890f0fca78 in RunInternal /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:318:3
    #39 0x7f890f0fca78 in RunHandler /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:311
    #40 0x7f890f0fca78 in MessageLoop::Run() /home/thecoder/OpenSrc/firefox/ipc/chromium/src/base/message_loop.cc:291
    #41 0x7f8919da4404 in XRE_InitChildProcess(int, char**, XREChildData const*) /home/thecoder/OpenSrc/firefox/toolkit/xre/nsEmbedFunctions.cpp:712:7
    #42 0x4f6255 in content_process_main /home/thecoder/OpenSrc/firefox/browser/app/../../ipc/contentproc/plugin-container.cpp:64:19
    #43 0x4f6255 in main /home/thecoder/OpenSrc/firefox/browser/app/nsBrowserApp.cpp:286
    #44 0x7f892b1ba82f in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x2082f)

SUMMARY: AddressSanitizer: heap-use-after-free /home/thecoder/OpenSrc/firefox/objdir-ff-asan/dist/include/nsCOMPtr.h:329:27 in assign_assuming_AddRef
Shadow bytes around the buggy address:
  0x0c2680012020: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c2680012030: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c2680012040: fd fd fd fd fd fa fa fa fa fa fa fa fa fa fa fa
  0x0c2680012050: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c2680012060: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
=&gt;0x0c2680012070: fd[fd]fd fd fd fd fd fd fd fd fa fa fa fa fa fa
  0x0c2680012080: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c2680012090: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c26800120a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c26800120b0: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa
  0x0c26800120c0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==2917==ABORTING</pre></div><div class="change-set" id="c2"><div class="comment" data-id="12410140" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506912" ><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506912" ><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-19 02:34 PDT" data-time="1497864868">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8879063"
         class="attachment"
         data-id="8879063" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="UAF_DisconnectInternal_POC_EIP_41414141.js">
      <meta itemprop="contentSize" content="1935">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8879063" itemprop="contentUrl">
        <span id="att-8879063-description" itemprop="description">UAF_DisconnectInternal_POC_EIP_41414141.js</span></a>
        — <a href="attachment.cgi?id=8879063&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-2" data-comment-id="12410140">A POC UAF_DisconnectInternal_POC_EIP_41414141.js is attached to demonstrate the clear exploitability by controlling the EIP register.

Firefox Version: 56.0a1 (2017-06-17) (32-bit)
OS: Widows 10 home 64 bit


(740.23a8): Access violation - code c0000005 (!!! second chance !!!)
eax=a1a1a1a1 ebx=1863b750 ecx=1863b750 edx=e5e5e5e5 esi=64136424 edi=1863b6a0
eip=41414141 esp=010fecdc ebp=010fece4 iopl=0         nv up ei ng nz na po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210282
41414141 ??              ???



FAULTING_IP: 
unknown!noop+0
41414141 ??              ???

EXCEPTION_RECORD:  (.exr -1)
ExceptionAddress: 41414141
   ExceptionCode: c0000005 (Access violation)
  ExceptionFlags: 00000000
NumberParameters: 2
   Parameter[0]: 00000008
   Parameter[1]: 41414141
Attempt to execute non-executable address 41414141


0x41414141
xul!mozilla::RefPtrTraits&lt;mozilla::layers::LayersIPCChannel&gt;::Release+0x6
xul!RefPtr&lt;mozilla::layers::LayersIPCChannel&gt;::ConstRemovingRefPtrTraits&lt;mozilla::layers::LayersIPCChannel&gt;::Release+0x6
xul!RefPtr&lt;mozilla::layers::LayersIPCChannel&gt;::assign_assuming_AddRef+0x18
xul!nsCOMPtr&lt;nsIWeakReference&gt;::operator=+0x9
xul!mozilla::dom::WebSocketImpl::DisconnectInternal+0x4b
xul!mozilla::dom::`anonymous namespace'::DisconnectInternalRunnable::MainThreadRun+0x8
xul!mozilla::dom::workers::WorkerMainThreadRunnable::Run+0x15
xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x6c
xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xf
xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x6c
xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xf
xul!nsThread::ProcessNextEvent+0x23a
xul!NS_ProcessNextEvent+0x14
xul!mozilla::ipc::MessagePump::Run+0x7a
xul!MessageLoop::RunInternal+0x8
xul!MessageLoop::RunHandler+0x20
xul!MessageLoop::Run+0x19
xul!nsBaseAppShell::Run+0x34
xul!nsAppShell::Run+0x26</pre></div><div class="change-set" id="a108010_1689"><div class="change" id="aa108010_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a108010_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a108010_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a108010_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a108010_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a108010_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-19 09:51 PDT" data-time="1497891105">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: core-security &rarr; dom-core-security</div><div class="change">Flags: sec-bounty?</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=crash&amp;resolution=---">crash</a>, 
          
            <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a>, 
          
            <a href="/buglist.cgi?keywords=sec-high&amp;resolution=---">sec-high</a>, 
          
            <a href="/buglist.cgi?keywords=testcase&amp;resolution=---">testcase</a></div></div></div><div class="change-set" id="c3"><div class="comment" data-id="12415293" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a108010_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a108010_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-20 11:17 PDT" data-time="1497982644">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12415293">baku: you were recently in this code in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible use after free caused by WebSocket::Send()"
   href="/show_bug.cgi?id=1369913">bug 1369913</a> so this is probably freshest on your mind. This doesn't look like the same issue (Disconnect vs Send).</pre><div class="activity"><div class="change">Flags: needinfo?(amarchesini)</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-high&amp;resolution=---">sec-high</a> &rarr; <a href="/buglist.cgi?keywords=sec-critical&amp;resolution=---">sec-critical</a></div></div></div><div class="change-set" id="a206756_446257"><div class="change" id="aa206756_446257">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a206756_446257"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_446257" id="a206756_446257"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a206756_446257"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a206756_446257">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a206756_446257">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-20 13:17 PDT" data-time="1497989851">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; amarchesini</div><div class="change">Flags: <span class="activity-deleted">needinfo?(amarchesini)</span></div></div></div><div class="change-set" id="c4"><div class="comment" data-id="12416970" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a206756_446257"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a206756_446257"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-20 23:18 PDT" data-time="1498025925">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8879832"
         class="attachment patch obsolete"
         data-id="8879832" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="websocket.patch">
      <meta itemprop="contentSize" content="1678">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8879832">
          <a class="link" href="attachment.cgi?id=8879832&amp;action=diff">
        <span id="att-8879832-description" itemprop="description">websocket.patch</span></a> (obsolete)
        — <a href="attachment.cgi?id=8879832&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1374047&attachment=8879832">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8879832&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8879832</a> -
        Flags: review?(bugs)</div></div></div><div class="change-set" id="c5"><div class="comment" data-id="12417555" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_39966" id="a206756_446257"><img src="https://secure.gravatar.com/avatar/7ba0f00f24191ccef0d14185bd7ca4ca?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_39966" id="a206756_446257"><a class="email " href="/user_profile?user_id=39966" > <span class="fna">Olli Pettay [:smaug]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 04:18 PDT" data-time="1498043908">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12417555">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8879832" name="attach_8879832" title="websocket.patch">attachment 8879832</a> <a href="/attachment.cgi?id=8879832&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8879832&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8879832'>[review]</a>
websocket.patch

The callers of Disconnect() should keep the object alive, but I'm fine with this too since this is super simple to land to branches too.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8879832&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8879832</a> -
        Flags: review?(bugs) &rarr; review+</div></div></div><div class="change-set" id="c6"><div class="comment" data-id="12417561" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a206756_446257"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a206756_446257"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 04:21 PDT" data-time="1498044114">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12417561">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8879832" name="attach_8879832" title="websocket.patch">attachment 8879832</a> <a href="/attachment.cgi?id=8879832&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8879832&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8879832'>[review]</a>
websocket.patch

[Security approval request comment]
How easily could an exploit be constructed based on the patch?

Yes. there is a test included.

Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?

Not particularly. I just keep WebSocketImpl alive before calling DisconnectInternal, instead after.

Which older supported branches are affected by this flaw?

all.

Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?

It's easy to backport.

How likely is this patch to cause regressions; how much testing does it need?

none.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8879832&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8879832</a> -
        Flags: sec-approval?</div></div></div><div class="change-set" id="a282432_280903"><div class="change" id="aa282432_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a282432_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a282432_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a282432_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a282432_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 10:18 PDT" data-time="1498065527">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=isnotempty">status-firefox54</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=isnotempty">tracking-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=isnotempty">tracking-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a></div></div></div><div class="change-set" id="c7"><div class="comment" data-id="12418701" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a282432_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 10:21 PDT" data-time="1498065700">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12418701">(In reply to Andrea Marchesini [:baku] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()"
   href="/show_bug.cgi?id=1374047#c6">comment #6</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8879832" name="attach_8879832" title="websocket.patch">attachment 8879832</a> <a href="/attachment.cgi?id=8879832&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8879832&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8879832'>[review]</a>
&gt; websocket.patch
&gt; 
&gt; [Security approval request comment]
&gt; How easily could an exploit be constructed based on the patch?
&gt; 
&gt; Yes. there is a test included.</span >

This can't be checked in &quot;as is&quot; then.

Security bugs that need sec-approval can't have a test checked in with them as the test will 0day our users. 
We need the test and the fix separated into different patches and I can then sec-approval+ the fix and the test patch can land *after* we *ship* the fix in a final public release (such as Firefox 55).

The question above is more about &quot;is this fix so obvious that checking in the fix points a giant sign as an exploitable security problem.&quot; I'll still need to understand the risk there when the patch is broken up.</pre><div class="activity"><div class="change">Flags: needinfo?(amarchesini)</div></div></div><div class="change-set" id="c8"><div class="comment" data-id="12418718" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a282432_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 10:28 PDT" data-time="1498066119">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="12418718">I see, now that I look at the patch, that there is no test so I guess this is a miscommunication.

I do see a Kungfu Deathgrip and, as Dan pointed out to me, the comment is kind of a give away, &quot;DisconnectInternal() can release the object&quot;.

I'll give sec-approval+ but not for checkin until July 10, in the middle of the current development cycle.</pre><div class="activity"><div class="change">Whiteboard: [checkin on 7/10]</div></div></div><div class="change-set" id="c9"><div class="comment" data-id="12418719" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a282432_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 10:29 PDT" data-time="1498066145">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="12418719">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8879832" name="attach_8879832" title="websocket.patch">attachment 8879832</a> <a href="/attachment.cgi?id=8879832&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8879832&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8879832'>[review]</a>
websocket.patch

Once this goes in, we'll want Beta and ESR52 patches nominated as well.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8879832&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8879832</a> -
        Flags: sec-approval? &rarr; sec-approval+</div></div></div><div class="change-set" id="c10"><div class="comment" data-id="12419751" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a282432_280903"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 15:38 PDT" data-time="1498084728">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="12419751"><span class="quote">&gt; &gt; Yes. there is a test included.
&gt; 
&gt; This can't be checked in &quot;as is&quot; then.</span >

What I meant is that there is a script able to trigger the crash. This script is not included in the patch but it's available from the description of the bug.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(amarchesini)</span></div></div></div><div class="change-set" id="c11"><div class="comment" data-id="12420360" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a282432_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 20:36 PDT" data-time="1498102583">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="12420360">Yes, I see that. The sec-approval questions are about the checkin and patch since the bug won't be opened until after we ship. You have sec-approval+ to check in on July 10 or after.</pre></div><div class="change-set" id="c12"><div class="comment" data-id="12461047" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a282432_280903"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 12:40 PDT" data-time="1499715602">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="12461047"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/bc535203a6eff61f308eb8ddf13afe8268cccb9f">https://hg.mozilla.org/integration/mozilla-inbound/rev/bc535203a6eff61f308eb8ddf13afe8268cccb9f</a>

Note that the attached patch needed rebasing on trunk due to <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Better naming for ProxyReleaseEvent"
   href="/show_bug.cgi?id=1372453">bug 1372453</a>. The patch as-attached applies cleanly to Beta but will require a bit of trivial rebasing for ESR52. Please request Beta and ESR52 approval on the patch when you get a chance.</pre><div class="activity"><div class="change">Flags: needinfo?(amarchesini)</div><div class="change">Whiteboard: <span class="activity-deleted">[checkin on 7/10]</span></div></div></div><div class="change-set" id="c13"><div class="comment" data-id="12462070" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a282432_280903"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 18:46 PDT" data-time="1499737589">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12462070"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/bc535203a6ef">https://hg.mozilla.org/mozilla-central/rev/bc535203a6ef</a></pre><div class="activity"><div class="change">Status: NEW &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2017-07-10 18:46 PDT" data-time="1499737589">4 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla56</div></div></div><div class="change-set" id="c14"><div class="comment" data-id="12462760" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a282432_280903"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 01:56 PDT" data-time="1499763384">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885156"
         class="attachment patch"
         data-id="8885156" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="websocket.patch">
      <meta itemprop="contentSize" content="1732">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885156">
          <a class="link" href="attachment.cgi?id=8885156&amp;action=diff">
        <span id="att-8885156-description" itemprop="description">websocket.patch</span></a>
        — <a href="attachment.cgi?id=8885156&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1374047&attachment=8885156">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-14" data-comment-id="12462760">Patch rebased</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8879832&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8879832</a> -
        Attachment is obsolete: true</div><div class="change">Flags: <span class="activity-deleted">needinfo?(amarchesini)</span></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12462771" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_446257" id="a282432_280903"><img src="https://secure.gravatar.com/avatar/dfb8d0427dd67216b2664131a5c31421?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_446257" id="a282432_280903"><a class="email " href="/user_profile?user_id=446257" > <span class="fna">Andrea Marchesini [:baku]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 01:59 PDT" data-time="1499763567">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12462771">Comment on <span class=""><a href="/attachment.cgi?id=8885156" name="attach_8885156" title="websocket.patch">attachment 8885156</a> <a href="/attachment.cgi?id=8885156&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8885156&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8885156'>[review]</a>
websocket.patch

Approval Request Comment
[Feature/Bug causing the regression]: WebSocket implementation
[User impact if declined]: The WebSocket object can be released before completing the Disconnect() operation. This is a UAF.
[Is this code covered by automated tests?]: no tests. race condition.
[Has the fix been verified in Nightly?]: none
[Needs manual test from QE? If yes, steps to reproduce]: none 
[List of other uplifts needed for the feature/fix]: none
[Is the change risky?]: no.
[Why is the change risky/not risky?]:  The ::Disconnect() method already uses a kungfuDeathGrip but this must be created at the beginning.
[String changes made/needed]: none</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: approval-mozilla-esr52?</div><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="a2005618_1689"><div class="change" id="aa2005618_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2005618_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a2005618_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2005618_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2005618_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a2005618_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 08:58 PDT" data-time="1499788713">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: dom-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="c16"><div class="comment" data-id="12466678" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a2005618_1689"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_580382" id="a2005618_1689"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 05:13 PDT" data-time="1499861629">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12466678">Comment on <span class=""><a href="/attachment.cgi?id=8885156" name="attach_8885156" title="websocket.patch">attachment 8885156</a> <a href="/attachment.cgi?id=8885156&amp;action=edit" title="websocket.patch">[details]</a> <a href="/attachment.cgi?id=8885156&amp;action=diff" title="websocket.patch">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1374047&amp;attachment=8885156'>[review]</a>
websocket.patch

sec-critical, beta55+, esr52.3+</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: <span class="activity-deleted">approval-mozilla-esr52?</span></div><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: approval-mozilla-esr52+</div><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: <span class="activity-deleted">approval-mozilla-beta?</span></div><div class="change">
        <a href="/attachment.cgi?id=8885156&amp;action=edit"
           title="websocket.patch"
           class=""
        >Attachment #8885156</a> -
        Flags: approval-mozilla-beta+</div></div></div><div class="change-set" id="c17"><div class="comment" data-id="12468502" data-no="17"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a2005618_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a2005618_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 14:25 PDT" data-time="1499894704">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12468502"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/a9897f5c997e">https://hg.mozilla.org/releases/mozilla-beta/rev/a9897f5c997e</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12468925" data-no="18"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a2005618_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a2005618_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 16:51 PDT" data-time="1499903491">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12468925"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/0a44ed156da5">https://hg.mozilla.org/releases/mozilla-esr52/rev/0a44ed156da5</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="c19"><div class="comment" data-id="12472885" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a2005618_1689"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_488993" id="a2005618_1689"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-13 23:22 PDT" data-time="1500013321">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12472885">(In reply to Andrea Marchesini [:baku] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()"
   href="/show_bug.cgi?id=1374047#c15">comment #15</a>)
<span class="quote">&gt; [Is this code covered by automated tests?]: no tests. race condition.
&gt; [Has the fix been verified in Nightly?]: none
&gt; [Needs manual test from QE? If yes, steps to reproduce]: none </span >

Setting qe-verify- based on Andrea's assessment on manual testing needs.</pre><div class="activity"><div class="change">Flags: qe-verify-</div></div></div><div class="change-set" id="a2529844_1689"><div class="change" id="aa2529844_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2529844_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a2529844_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2529844_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2529844_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a2529844_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 10:35 PDT" data-time="1500312939">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty? &rarr; sec-bounty+</div></div></div><div class="change-set" id="a2633381_280903"><div class="change" id="aa2633381_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a2633381_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a2633381_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2633381_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2633381_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a2633381_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-18 15:21 PDT" data-time="1500416476">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2017-7800</div><div class="change">Whiteboard: [adv-main55+][adv-esr52.3+]</div></div></div><div class="change-set" id="c20"><div class="comment" data-id="12488389" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2633381_280903"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a2633381_280903"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-19 16:36 PDT" data-time="1500507403">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12488389">(In reply to Looben Yang from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()"
   href="/show_bug.cgi?id=1374047#c2">comment #2</a>)
<span class="quote">&gt; A POC UAF_DisconnectInternal_POC_EIP_41414141.js is attached to demonstrate
&gt; the clear exploitability by controlling the EIP register.
&gt; 
&gt; Firefox Version: 56.0a1 (2017-06-17) (32-bit)
&gt; OS: Widows 10 home 64 bit</span >

I was not able to reproduce any kind of crash, let alone one showing EIP control, with these same conditions (except I'm using Win 10 Pro instead of Home). I also tried 64-bit Firefox builds to no avail.

With the original testcase I had been able to reproduce a UAF-looking crash both 32-bit and 64-bit Firefox 54.0.1 builds.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="12488618" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506912" id="a2633381_280903"><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506912" id="a2633381_280903"><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-19 18:16 PDT" data-time="1500513362">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="12488618">(In reply to Daniel Veditz [:dveditz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()"
   href="/show_bug.cgi?id=1374047#c20">comment #20</a>)
<span class="quote">&gt; (In reply to Looben Yang from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - WebSocket - Use After Free in WebSocketImpl::DisconnectInternal()"
   href="/show_bug.cgi?id=1374047#c2">comment #2</a>)
&gt; &gt; A POC UAF_DisconnectInternal_POC_EIP_41414141.js is attached to demonstrate
&gt; &gt; the clear exploitability by controlling the EIP register.
&gt; &gt; 
&gt; &gt; Firefox Version: 56.0a1 (2017-06-17) (32-bit)
&gt; &gt; OS: Widows 10 home 64 bit
&gt; 
&gt; I was not able to reproduce any kind of crash, let alone one showing EIP
&gt; control, with these same conditions (except I'm using Win 10 Pro instead of
&gt; Home). I also tried 64-bit Firefox builds to no avail.
&gt; 
&gt; With the original testcase I had been able to reproduce a UAF-looking crash
&gt; both 32-bit and 64-bit Firefox 54.0.1 builds.</span ></pre></div><div class="change-set" id="c22"><div class="comment" data-id="12488631" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506912" id="a2633381_280903"><img src="https://secure.gravatar.com/avatar/387b65e77a270f67cd03547039f6b2eb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506912" id="a2633381_280903"><a class="email " href="/user_profile?user_id=506912" > <span class="fna">Looben Yang</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-19 18:21 PDT" data-time="1500513705">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8888118"
         class="attachment"
         data-id="8888118" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="UAF_DisconnectInternal_POC_EIP_41414141_2.js">
      <meta itemprop="contentSize" content="1717">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8888118" itemprop="contentUrl">
        <span id="att-8888118-description" itemprop="description">UAF_DisconnectInternal_POC_EIP_41414141_2.js</span></a>
        — <a href="attachment.cgi?id=8888118&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-22" data-comment-id="12488631">If it's not reproduced, then probably the timeout delay needs some adjustment.
I just simplified the PoC a little bit and attached it as UAF_DisconnectInternal_POC_EIP_41414141_2.js.

It seems a lot easier to reproduced in another machine. Daniel, can you give it a try with this one? 



Firefox Version: 54.0.1 (32-bit)
OS: Widows 10 Pro 64 bit

(6060.2b6c): Access violation - code c0000005 (!!! second chance !!!)
eax=a1a1a1a1 ebx=195676a8 ecx=195676a8 edx=e5e5e5e5 esi=11c6d760 edi=19567600
eip=41414141 esp=00eff29c ebp=00eff2a4 iopl=0         nv up ei ng nz na po nc
cs=0023  ss=002b  ds=002b  es=002b  fs=0053  gs=002b             efl=00210282
41414141 0000            add     byte ptr [eax],al          ds:002b:a1a1a1a1=41
0:000&gt; !analyze -v
*******************************************************************************
*                                                                             *
*                        Exception Analysis                                   *
*                                                                             *
*******************************************************************************

*** ERROR: Symbol file could not be found.  Defaulted to export symbols for C:\WINDOWS\SysWOW64\nvwgf2um.dll - 
GetUrlPageData2 (WinHttp) failed: 12002.

FAULTING_IP: 
unknown!noop+0
41414141 0000            add     byte ptr [eax],al

EXCEPTION_RECORD:  (.exr -1)
ExceptionAddress: 41414141
   ExceptionCode: c0000005 (Access violation)
  ExceptionFlags: 00000000
NumberParameters: 2
   Parameter[0]: 00000008
   Parameter[1]: 41414141
Attempt to execute non-executable address 41414141

FAULTING_THREAD:  00002b6c

PROCESS_NAME:  firefox.exe

ERROR_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.

EXCEPTION_CODE: (NTSTATUS) 0xc0000005 - The instruction at 0x%p referenced memory at 0x%p. The memory could not be %s.

EXCEPTION_PARAMETER1:  00000008

EXCEPTION_PARAMETER2:  41414141

WRITE_ADDRESS:  41414141 

FOLLOWUP_IP: 
unknown!noop+0
41414141 0000            add     byte ptr [eax],al

FAILED_INSTRUCTION_ADDRESS: 
unknown!noop+0
41414141 0000            add     byte ptr [eax],al

NTGLOBALFLAG:  400

APPLICATION_VERIFIER_FLAGS:  0

APP:  firefox.exe

ANALYSIS_VERSION: 10.0.10240.9 x86fre

IP_ON_HEAP:  41414141
The fault address in not in any loaded module, please check your build's rebase
log at &lt;releasedir&gt;\bin\build_logs\timebuild\ntrebase.log for module which may
contain the address if it were loaded.

BUGCHECK_STR:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1

DEFAULT_BUCKET_ID:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1

LAST_CONTROL_TRANSFER:  from 0ff025b0 to 41414141

STACK_TEXT:  
WARNING: Frame IP not in any known module. Following frames may be wrong.
00eff298 0ff025b0 e5e5e5e5 00eff2d4 10bb616e 0x41414141
00eff2a4 10bb616e 00000000 00000000 1e2b7a30 xul!RefPtr&lt;mozilla::dom::StyleSheetList&gt;::assign_assuming_AddRef+0x18
00eff2d4 10bb9dda 101dd28e 1ea744c0 1ea744f4 xul!mozilla::dom::WebSocketImpl::DisconnectInternal+0x4b
00eff2d8 101dd28e 1ea744c0 1ea744f4 00000000 xul!mozilla::dom::`anonymous namespace'::DisconnectInternalRunnable::MainThreadRun+0x8
00eff2ec 100852eb 1e2b7a30 196e89c0 196e89f4 xul!mozilla::dom::workers::WorkerMainThreadRunnable::Run+0x15
00eff314 1008526f 00eff344 100852eb 1f466970 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76
00eff31c 100852eb 1f466970 0b7f5864 1e382670 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe
00eff344 1008526f 00eff3c4 1001be8f 1e382670 xul!mozilla::ThrottledEventQueue::Inner::ExecuteRunnable+0x76
00eff34c 1001be8f 1e382670 02e27170 02e27160 xul!mozilla::ThrottledEventQueue::Inner::Executor::Run+0xe
00eff3c4 1001d5ba 02e04200 00000000 00eff3f7 xul!nsThread::ProcessNextEvent+0x244
00eff3f8 101cb809 02e25060 293a22ed 0b7f5860 xul!mozilla::ipc::MessagePump::Run+0x72
00eff430 101cb7d8 02e04200 00000001 0b7f5800 xul!MessageLoop::RunHandler+0x20
00eff450 100ef8ce 0b7f7640 00000000 00eff470 xul!MessageLoop::Run+0x19
00eff460 100ef65d 0b7f5860 0b7f7640 00eff484 xul!nsBaseAppShell::Run+0x34
00eff470 100ef612 0b7f5860 00eff7d5 0d5ce080 xul!nsAppShell::Run+0x26
00eff484 100eeee6 0b7f7640 00eff6f0 00eff6d8 xul!nsAppStartup::Run+0x22
00eff678 1011dfc1 02e03050 00eff824 00000001 xul!XREMain::XRE_mainRun+0xa92
00eff6b4 1011d93d 02e101c0 02e10220 00eff824 xul!XREMain::XRE_main+0x366
00eff7e4 1011d8ff 00eff824 00effb68 00341bdd xul!XRE_main+0x39
00eff7f0 00341bdd 00000001 02e03050 00eff824 xul!mozilla::BootstrapImpl::XRE_main+0x11
00effb68 00345b3f 00000001 fe1a4498 00fa7560 firefox!wmain+0x65d
00effbb0 77958744 00c1e000 77958720 4de8583d firefox!__scrt_common_main_seh+0xf9
00effbc4 77e6587d 00c1e000 4d87acba 00000000 KERNEL32!BaseThreadInitThunk+0x24
00effc0c 77e6584d ffffffff 77e8632e 00000000 ntdll!__RtlUserThreadStart+0x2f
00effc1c 00000000 00345bb5 00c1e000 00000000 ntdll!_RtlUserThreadStart+0x1b


SYMBOL_STACK_INDEX:  0

SYMBOL_NAME:  unknown!noop+0

FOLLOWUP_NAME:  MachineOwner

MODULE_NAME: unknown

IMAGE_NAME:  unknown.dll

DEBUG_FLR_IMAGE_TIMESTAMP:  0

STACK_COMMAND:  ~0s ; kb

BUCKET_ID:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1_BAD_IP_unknown!noop+0

PRIMARY_PROBLEM_CLASS:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1_BAD_IP_unknown!noop+0

FAILURE_PROBLEM_CLASS:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1

FAILURE_EXCEPTION_CODE:  c0000005

FAILURE_IMAGE_NAME:  unknown.dll

FAILURE_FUNCTION_NAME:  noop

FAILURE_SYMBOL_NAME:  unknown.dll!noop

FAILURE_BUCKET_ID:  SOFTWARE_NX_FAULT_INVALID_FILL_PATTERN_a1a1a1a1_c0000005_unknown.dll!noop

ANALYSIS_SOURCE:  UM

FAILURE_ID_HASH_STRING:  um:software_nx_fault_invalid_fill_pattern_a1a1a1a1_c0000005_unknown.dll!noop

FAILURE_ID_HASH:  {0b68b053-9232-2309-5b3f-b2f98916a7a4}

Followup:     MachineOwner
---------</pre></div><div class="change-set" id="a2888688_280903"><div class="change" id="aa2888688_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a2888688_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a2888688_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2888688_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2888688_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a2888688_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-21 14:16 PDT" data-time="1500671783">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="c23"><div class="comment" data-id="12495483" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2888688_280903"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a2888688_280903"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-21 15:24 PDT" data-time="1500675846">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="12495483">That worked a lot better, especially when I switched to tinderbox builds instead of nightlies so they didn't keep auto-updating. Very reliably crashed executing 0x41414141 in a 32-bit build

<a href="https://crash-stats.mozilla.org/report/index/302daa81-58d5-411f-b463-89e940170721">bp-302daa81-58d5-411f-b463-89e940170721</a>
<a href="https://crash-stats.mozilla.org/report/index/2882dd22-a602-4c21-ae88-6fe020170721">bp-2882dd22-a602-4c21-ae88-6fe020170721</a>

(I have no idea why it thinks the install time was two days ago. I just unzipped it shortly before running the testcase and submitting the crash, and the zip itself was packed on the build date last month).</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div></div></div><div class="change-set" id="a19749280_1689"><div class="change" id="aa19749280_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a19749280_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a19749280_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a19749280_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a19749280_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a19749280_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-01 16:46 PST" data-time="1517532375">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div class="change-set" id="a54701430_1"><div class="change" id="aa54701430_1">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1" id="a54701430_1"><img src="https://secure.gravatar.com/avatar/eaa3c40fff208819d0810fc338eea0aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1" id="a54701430_1"><a class="email " href="/user_profile?user_id=1" > <span class="fna">Nobody; OK to take it and work on it</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a54701430_1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a54701430_1">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1374047#a54701430_1">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2019-03-13 06:42 PDT" data-time="1552484525">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Component: DOM &rarr; DOM: Core &amp; HTML</div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1374047&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>