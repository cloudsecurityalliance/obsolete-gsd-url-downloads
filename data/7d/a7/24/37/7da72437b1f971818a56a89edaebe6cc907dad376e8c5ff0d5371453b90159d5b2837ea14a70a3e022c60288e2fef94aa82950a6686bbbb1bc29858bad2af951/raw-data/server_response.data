<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<link href="/bitrix/cache/css/s1/amonitoring/page_301e0515e9d3ba85666684946cf99eda/page_301e0515e9d3ba85666684946cf99eda_v1.css?15888514211100" type="text/css"  rel="stylesheet" />
<link href="/bitrix/cache/css/s1/amonitoring/template_2ce4d1bd7d3f721aeb2eaec43452af7a/template_2ce4d1bd7d3f721aeb2eaec43452af7a_v1.css?1588850961765" type="text/css"  data-template-style="true" rel="stylesheet" />
<script type="text/javascript">var _ba = _ba || []; _ba.push(["aid", "32b028ed9c27d643ac9e6fdca71a7c6b"]); _ba.push(["host", "amonitoring.ru"]); (function() {var ba = document.createElement("script"); ba.type = "text/javascript"; ba.async = true;ba.src = (document.location.protocol == "https:" ? "https://" : "http://") + "bitrix.info/ba.js";var s = document.getElementsByTagName("script")[0];s.parentNode.insertBefore(ba, s);})();</script>


    <title>Steam Windows Client Local Privilege Escalation 0day</title>    <meta content="Описание" name="description">
    <meta content="Ключевые слова" name="keywords">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/bootstrap.css">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/owl.carousel.css">
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/css/style.css">
    <link rel="icon" href="/favicon.ico">
    <link rel="shortcut icon" href="/favicon.ico">
    <!--[if lt IE 9]><script src="/bitrix/templates/amonitoring/js/html5shiv.js"></script><![endif]-->
    <link rel="stylesheet" href="/bitrix/templates/amonitoring/js/fancybox/jquery.fancybox.css">
    <script src="/bitrix/templates/amonitoring/js/jquery.min.js"></script>
            <script>
            var onloadCallback = function() {
                mysitekey = '6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP';
                grecaptcha.render('captcha_footer', {
                    'sitekey' : mysitekey
                });
                grecaptcha.render('captcha_feedback', {
                    'sitekey' : mysitekey
                });
            };
        </script>
            <script src="https://www.google.com/recaptcha/api.js?onload=onloadCallback&render=explicit" async defer></script>
    </head>
<body>
<header class="header">
    <div class="container">
        <div class="header-table full">
            <div class="header-cell header-open hidden-md hidden-lg">
                <a href="#" class="nav-open icon icon-nav-open"></a>
            </div>
            <div class="header-cell header-logo">
                <div class="header-logo-table">
                    <div class="header-logo-cell">
                        <a href="/">
                            <img src="/bitrix/templates/amonitoring/img/logo.png" alt="" title="">
                        </a>
                    </div>
                    <div class="header-logo-cell header-title">ПЕРСПЕКТИВНЫЙ<br>МОНИТОРИНГ</div>
                </div>
            </div>
            <div class="header-cell header-incident hidden-xs hidden-sm">
                <a href="/incident/" class="button full">Сообщить об инциденте</a>
            </div>
            <div class="header-cell header-search hidden-xs hidden-sm">
    <form action="/search/" class="clearfix">
        <div class="header-search-input-outer">
            <input type="text" value="" name="q" placeholder="Поиск" class="header-search-input full">
            <button type="submit" class="header-search-submit icon icon-search">Найти</button>
        </div>
    </form>
</div>            <div class="header-cell header-contacts hidden-xs hidden-sm">
                <div class="header-social">
                    <a href="https://www.facebook.com/advancedmonitoring/" class="icon icon-social icon-fb"></a>
                    <a href="https://twitter.com/am_rnd" class="icon icon-social icon-tw"></a>
                    <a href="https://habrahabr.ru/company/pm/" class="icon icon-social icon-habr"></a>
                    <a href="https://t.me/pm_public" class="icon icon-social icon-tele"></a>
                    <a href="https://www.linkedin.com/company/advanced-monitoring" class="icon icon-social icon-in"></a>
                </div>
                <div class="header-phone">
                    <span class="icon icon-phone"></span> <a href="tel:+74957376197">+7 495 737-61-97</a>
                </div>
                <div class="header-mail">
                    <span class="icon icon-mail"></span> <a href="mailto:info@amonitoring.ru">info@amonitoring.ru</a>
                </div>
            </div>
        </div>
        <nav class="nav">
            <div class="nav-inner">
                

    <ul class="nav-level-1">
			<li><a href="/about/">Компания</a></li>
		
			<li><a href="/news/">Новости</a></li>
		
			<li><a href="/service/">Услуги</a></li>
		
			<li><a href="/product/">Продукты</a></li>
		
			<li><a href="/article/" class="selected">Статьи</a></li>
		
			<li><a href="/vacancy/">Карьера</a></li>
		
			<li><a href="/contact/">Контакты</a></li>
		

</ul>
                <div class="hidden-md hidden-lg">
                    <div class="nav-block header-incident">
                        <a href="#" class="button full">Сообщить об инциденте</a>
                    </div>
                    <div class="nav-bottom">
                        <div class="nav-block header-search">
                            <form action="#" class="clearfix">
                                <div class="header-search-input-outer">
                                    <input type="text" value="" placeholder="Поиск" class="header-search-input full">
                                    <button type="submit" class="header-search-submit icon icon-search-white">Найти</button>
                                </div>
                            </form>
                        </div>
                        <div class="nav-block header-contacts">
                            <div class="header-social">
                                <a href="https://www.facebook.com/advancedmonitoring/" class="icon icon-social icon-fb"></a>
                                <a href="https://twitter.com/am_rnd" class="icon icon-social icon-tw"></a>
                                <a href="https://habrahabr.ru/company/pm/" class="icon icon-social icon-habr"></a>
                                <a href="https://t.me/pm_public" class="icon icon-social icon-tele"></a>
                                <a href="https://www.linkedin.com/company/advanced-monitoring" class="icon icon-social icon-in"></a>
                            </div>
                            <div class="header-phone">
                                <span class="icon icon-phone"></span> <a href="tel:+74957376197">+7 495 737-61-97</a>
                            </div>
                            <div class="header-mail">
                                <span class="icon icon-mail"></span> <a href="mailto:info@amonitoring.ru">info@amonitoring.ru</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
    </div>
</header>
    <div class="content">
        <div class="container">
                            <h1 class="main-h1" style="visibility: hidden"></h1>
                            <main class="main">
	<input id="next_page" type="hidden" value="2">

<link href="/bitrix/css/main/font-awesome.css?151119204028777" type="text/css" rel="stylesheet" />
<div class="path" style="visibility: hidden">
				<a href="/" class="path-item">Отзывы</a>
				<a href="/article/" class="path-item">Статьи</a>
				<span class="path-item"> &gt; <a href="">Steam Windows Client Local Privilege Escalation 0day</a></span><div style="clear:both"></div></div><article class="new new-single clearfix">
    <div class="new-image">
        <img src="/upload/iblock/828/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="block">
    </div>
    <div class="new-header">
        <div class="new-date">07.08.2019 09:44:00</div>
        <h1 class="new-title">Steam Windows Client Local Privilege Escalation 0day</h1>
    </div>
    <div class="new-info">
        <div class="new-text text">
            <h2>
Introduction </h2>
<p>
	 I have been searching for vulnerabilities for a number of years and I thought I have seen a lot, but there is a part of work that I cannot understand and cannot accept. This is the absolute vendors’ unwillingness to accept information about vulnerabilities and problems. I understand that it is very unpleasant when someone directly shows you that you made a mistake and, most likely, not one. It is difficult to confirm in public sources that there were problems, that the staff did something wrong. However, I don’t understand why a vulnerability report rejected.
</p>
<p>
	 Well, I want to talk about Steam by Valve Software.
</p>
<p style="text-align: center;">
 <a href="https://ru.wikipedia.org/wiki/Steam"><img width="400" alt="steam.png" src="/upload/medialibrary/cef/steam.png" height="400" title="steam.png"></a><br>
</p>
<h2>
Vulnerability </h2>
<p>
	 The vulnerability itself is very simple. Steam installs “Steam Client Service” service for some internal purposes. Let’s check SDDL (<a href="https://habr.com/ru/company/pm/blog/442662/">https://habr.com/ru/company/pm/blog/442662/</a>) of the service:
</p>
<p>
 <i>O:SYG:SYD:(A;;CCLCSWLOCRRC;;;IU)(A;;CCLCSWLOCRRC;;;SU)(A;;CCLCSWRPWPDTLOCRRC;;;SY)(A;;CCDCLCSWRPWPDTLOCRSDRCWDWO;;;BA)(A;;RPWP;;;BU)</i>
</p>
<p>
	 Most interesting part is <i>(A;;RPWP;;;BU)</i>. It means that any user from the group “Users” is permitted to Start and Stop the service.
</p>
<p>
	 Now we examine the service's behavior at start. There is nearly nothing interesting in fact, but some registry operations look strange. Service enumerates subkeys of HKLM\Software\Wow6432Node\Valve\Steam\Apps and sets some security descriptions for each.
</p>
<p style="text-align: center;">
 <img width="1024" alt="steam1.png" src="/upload/medialibrary/0ef/steam1.png" height="307" title="steam1.png"><br>
</p>
<p>
</p>
<p>
	 What is this security description about? I created test key HKLM\Software\Wow6432Node\Valve\Steam\Apps\test and restarted the service (Procmon’s log is above) and checked registry key permissions. Here I found that HKLM\SOFTWARE\Wow6432Node\Valve\Steam has explicit “Full control” for “Users” group, and these permissions inherit for all subkeys and their subkeys. I assumed that RegSetKeySecurity sets same rights, and something interesting would happen if there were a symlink. I created a link from HKLM\SOFTWARE\Wow6432Node\Valve\Steam\Apps\test to HKLM\SOFTWARE\test2 and restarted the service.
</p>
<p style="text-align: center;">
 <img width="944" alt="steam2.png" src="/upload/medialibrary/8ee/steam2.png" height="198" title="steam2.png"><br>
</p>
<p>
	 Steam’s service sets security descriptor for our target-key. Review SDDL for the key (non-interesting data is omitted):
</p>
<p>
 <i>(A;ID;KA;;;BU)(A;OICIIOID;GA;;;BU)</i>
</p>
<p>
	 In other words, it means full (read and write) access to the key for all users. This is the security descriptor the service has set to the key.
</p>
<p>
	 So, now we have a primitive to take control on almost every key in the registry, and it is easy to convert it into a complete EoP (Escalation of Privileges). I choose key HKLM\SYSTEM\ControlSet001\Services\msiserver that corresponds with the service “Windows Installer”, which can be started by any user, same as Steam’s service, but run program as NT AUTHORITY\SYSTEM. After taking control, it is only necessary to change ImagePath value of the HKLM\SYSTEM\ControlSet001\Services\msiserver key and start “Windows Installer” service. The program from ImagePath will be started as NT AUTHORITY\SYSTEM.
</p>
<p>
</p>
<p>
	 Put all things together and we get exploit that allows running any program with the highest possible rights on any Windows computer with Steam installed.
</p>
<h2>
Report to vendor </h2>
<p>
	 I reported this vulnerability to the Valve via HackerOne.
</p>
<p>
	 Here first unexpected obstacle happened – before Valve I had to pass HackerOne’s staff review (because Valve use <b>«Managed by HackerOne»</b> feature on H1). I thought it is easy. How something could went wrong, if I provided a text description and a PoC as an executable file, which spawned an interactive command line console as NT AUTHORITY\SYSTEM? Therefore, I got “not applicable” with cause «Attacks that require the ability to drop files in arbitrary locations on the user's filesystem». I was like “Are you serious? There is no even a single file operation!”.
</p>
<p>
	 I wrote some comments and other H1 member tried to reproduce my steps. After some conversations, he confirmed the report and sent it to the Valve security team. Hooray! Mission accomplished. Or not…?
</p>
<p>
	 Some weeks later, another (third) H1 member marked report as “N\A”. Now there were two causes: «Attacks that require the ability to drop files in arbitrary locations on the user's filesystem» and «Attacks that require physical access to the user’s device». Here I realized that Valve has no interest in EoP vulnerabilities.
</p>
<p>
	 45 days have gone since the initial report, so I want to publicly disclose the vulnerability. I hope this will bring Steam developers to make some security improvements.
</p>
<p>
	 Some stats: vulnerability checked on Windows 8 x64, Windows 8.1 x64 и Windows 10 x64. I do not know how Steam works with version numbers of components, so I just write down versions of files:
</p>
<p>
</p>
<ul>
	<li>
	<p>
		 SteamService.dll (5.16.86.11, signed by Valve 14.06.2019)
	</p>
 </li>
	<li>
	<p>
		 SteamService.exe (5.16.86.11, signed by Valve 14.06.2019)
	</p>
 </li>
</ul>
<h3>Timeline</h3>
<p>
	 June 15 — reported via HackeOne.
</p>
<p>
	 June 16 — marked as “N\A”, due to "Attacks that require the ability to drop files in arbitrary locations on the user's filesystem».
</p>
<p>
	 June 16 — reopened with my comments.
</p>
<p>
	 July 2 — vulnerability confirmed by HackerOne staff and submitted it to the appropriate remediation team for review.
</p>
<p>
	 July 20 — marked as “N\A”, "Attacks that require the ability to drop files in arbitrary locations on the user's filesystem." and "Attacks that require physical access to the user’s device".
</p>
<p>
	 August 7&nbsp;— public disclosure (this paper).
</p>
<h2>
Some speculations </h2>
<p>
	 I am very disappointed. Big serious company speaks pathos words about security importance and, at the same time, makes your computer defenseless. In fact, Steam allows to grant high privileges for every program you run.
</p>
<p>
	 It is rather ironic that a launcher, which is actually designed to run third-party programs on your computer, allows them to silently get a maximum of privileges. Are you sure that a free game made of garbage by an unknown developer will behave honestly? Do you believe that for a 90% discount you will not get a hidden miner? Of course, some of the threats will remain even being run without administrator rights. However, the high rights of malicious programs can significantly increase risks - programs could disable antivirus, use deep and dark places to hide and change almost any file of any user, even stole private data.
</p>
<p>
	 Due to the popularity of Steam, there is a big amount of potential victims. In 2015, Valve reported that there were 125 million active accounts on Steam. Yes, not all Steam users have Windows as OS, but most of them do. Some users have multiple "live" accounts on single machine, however, the scale of the problem is still impressive.
</p>
<p>
	 Oh... What if there is no coincidence and the behavior is insecure by design? What if the Steam is a kind of legal backdoor? It is impossible to convict Valve, but putting all the facts together:
</p>
<p>
	 1)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; There is the vulnerability, which is easy to exploit and reliable works, providing high rights. And it seems like not only one, according to this twitter thread <a href="https://twitter.com/enigma0x3/status/1148031014171811841">https://twitter.com/enigma0x3/status/1148031014171811841</a>.
</p>
<p>
	 2)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It is easy to find the vulnerability. I am not sure that I'm first who has found it, but the first one who wrote about it.
</p>
<p>
	 3)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Valve declined the report about the EoP vulnerability and same ones. Moreover, the scope of incoming reports specially reduced to exclude EoP-reports.
</p>
<p>
	 As for me, it looks like Valve wants these EoP vulnerabilities to be present in the software.
</p>
<p>
	 It does not look good. I do not recall deleting Steam, but you should be aware and careful with it. Valve do not care about your security, so you are the only one who should be.
</p>
<h2>
Bonus </h2>
<p>
	 The thing is that it was decided to expand the timeline because of a quite interesting event which occurred during the preparation of this article:
</p>
<p>
	 July 20 — after the report was rejected, I informed H1, that I would disclose the details of vulnerability publicly after July 30.
</p>
<p>
	 August 2 — one more H1 employee appears in the thread and forbids the disclosure.
</p>
<p>
</p>
<p>
	 This article was ready for publication by July 30 (this date was chosen due to 45 days deadline since initial vulnerability report was sent). So, two weeks after my message, which was sent on July 20, a person appears, who tells me that my report was marked as not applicable, they closed the discussion and wouldn’t offer any explanation to me. Moreover, they didn't want me to disclose the vulnerability. At the same time, there was not even a single word from Valve. No, guys, that's not how it works. You didn’t respect my work, and that's the reason why I won’t respect yours — I see no reason why I shouldn't publish this report. Most likely I’ll be banned at H1 because of it, but it won't make me upset.
</p>
<p>
 <b>UPD</b>
</p>
<p>
	 Yesterday (August 6, 2019) Steam was updated. No, problem is not fixed. File versions: 5.27.59.20 signed at 06 Aug 2019.<br>
</p>
<p>
 <br>
</p>
<p>
 <b>UPD 2</b>
</p>
<p>
	 Aug 7 (after the post) –&nbsp; H1 report was reopened. I got long mail from h1 community team. In short: I need provide more arguments on the vulnerability's importance. Also, there was a line: "Valve is not going to fix something that they have determined to be N/A". After that I realize, that public disclosure was a right desicion.
</p>
<p>
	 Aug 7 – <a href="https://twitter.com/enigma0x3/status/1159103239729471488">Matt Nelson states</a> that his vulnerability is the same as mine. And posts his PoC.
</p>
<p>
</p>
<p>
	 Aug 9 – Steam Beta got update with "Fixed privilege escalation exploit using symbolic links in Windows registry". It seems this fix could be bypassed. Where is my popcorn?
</p>
<p style="text-align: center;">
 <img width="630" alt="steam_update.png" src="/upload/medialibrary/594/steam_update.png" height="445" title="steam_update.png"><br>
</p>
<p>
	 Aug 13 - Steam (main client, not beta) got update with "Fixed privilege escalation exploit using symbolic links in Windows registry". It seems, that there aren't any RegSetKeySecurity calls. Probably fixed.
</p>
<p>
	 Aug 15 - researcher provides a way to bypass latest patch <a href="https://twitter.com/general_nfs/status/1162067274443833344">https://twitter.com/general_nfs/status/1162067274443833344</a>. So, the vulnerability is still actual.<br>
</p>
<h2>About author</h2>
<p>
	 Vasily Kravets, Lead Expert
</p>
<p>
 <a href="mailto:xi-tauw@xi-tauw.info">mailto:xi-tauw@xi-tauw.info</a>
</p>
<p>
 <a href="mailto:Vasily.Kravets@amonitoring.ru">mailto:Vasily.Kravets@amonitoring.ru</a>
</p>
<p>
 <a href="https://twitter.com/PsiDragon">https://twitter.com/PsiDragon</a>
</p>
<p>
 <a href="https://t.me/xitauw">https://t.me/xitauw</a>
</p>        </div>
        <div class="new-tags tags"> Теги:
            <div class="tags-inner">
                                                    <a href="/article/?tag=Steam">Steam</a>
                                        <a href="/article/?tag=0day">0day</a>
                                        <a href="/article/?tag=Privilege escalation">Privilege escalation</a>
                                </div>
        </div>
                    <script src="//yastatic.net/es5-shims/0.0.2/es5-shims.min.js"></script>
            <script src="//yastatic.net/share2/share.js"></script>
            <div class="social">Поделиться статьей в:
                <div class="ya-share2 social-inner" style="visibility: hidden; position: relative; bottom: 5px;" data-services="facebook,twitter,telegram,linkedin"></div>
            </div>
                </div>
</article>
    <div class="new-extra">
        <div class="new-extra-title">Рекомендуемые статьи</div>
        <div class="owl-carousel">
                            <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/960/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="">
                        </div>
                                                <div class="new-date">29.05.2019</div>
                        <div class="new-title">Анализ поверхности атаки для банков и организаций кредитно-финансовой сферы</div>
                        <div class="new-link">
                            <a href="/article/attack-surface/">Читать</a>
                        </div>
                    </div>
                </div>
                                <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/7ac/57f6eb229b4c06aa42ab2e8b2a279d7a.svg" alt="" class="">
                        </div>
                                                <div class="new-date">27.05.2019</div>
                        <div class="new-title">Создание прокси-dll для проверок эксплуатации dll hijack</div>
                        <div class="new-link">
                            <a href="/article/dll-hijack/">Читать</a>
                        </div>
                    </div>
                </div>
                                <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/191/phdays_logo.svg" alt="" class="">
                        </div>
                                                <div class="new-date">24.05.2019</div>
                        <div class="new-title">Выступления на Positive Hack Days 9</div>
                        <div class="new-link">
                            <a href="/article/phdays9/">Читать</a>
                        </div>
                    </div>
                </div>
                                <div>
                    <div class="new-extra-item">
                        <div class="new-extra-item-image">
                            <img src="/upload/iblock/944/a62d2d9039df4829ee6e772fa2be28c2.svg" alt="" class="">
                        </div>
                                                <div class="new-date">15.03.2019</div>
                        <div class="new-title">White paper по пентесту с применением методов социальной инженерии</div>
                        <div class="new-link">
                            <a href="/article/social-pentest-wp/">Читать</a>
                        </div>
                    </div>
                </div>
                        </div>
    </div>
    <script>
    $(document).ready(function () {
        $(".main-h1").before($(".path"));
    });
    $(window).load(function () {
        $(".ya-share2__badge").each(function () {
            $(this).remove();
        });
        $(".ya-share2__title").each(function () {
            $(this).remove();
        });
        $(".ya-share2__item_service_facebook").children().eq(0).addClass("icon icon-social icon-fb");
        $(".ya-share2__item_service_twitter").children().eq(0).addClass("icon icon-social icon-tw");
        $(".ya-share2__item_service_telegram").children().eq(0).addClass("icon icon-social icon-tele");
        $(".ya-share2__item_service_linkedin").children().eq(0).addClass("icon icon-social icon-in");

        $(".ya-share2").css("visibility","visible");
    });
</script>
            </main>
        </div>
    </div>

<footer class="footer">
    <div class="container">
        <div class="row">
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-4">
                        <div class="footer-block">
                            <div class="footer-title">
                                <a href="/about/">О нас</a>
                            </div>
                            <div class="footer-content">
                                <ul>
                                    <li><a href="/about/">Компания</a></li>
                                    <li><a href="/vacancy/">Вакансии</a></li>
                                    <li><a href="/contact/">Контакты</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="footer-block">
                            <div class="footer-title">
                                <a href="#">Услуги</a>
                            </div>
                            <div class="footer-content">
                                <ul>
                                    <li><a href="/service/security-operation-center/">Центр мониторинга компьютерных атак</a></li>
                                    <li><a href="/service/snort/">Разработка правил Snort IDS</a></li>
                                    <li><a href="/service/secure-development/">Внедрение процедур безопасной разработки ПО</a></li>
                                    <li><a href="/service/forensics/">Расследование компьютерных инцидентов</a></li>
                                    <li><a href="/service/compliance/">Соответствие требованиям по ИБ</a></li>
                                    <li><a href="/service/security-analysis/">Анализ защищённости</a></li>
                                    <li><a href="/service/pentest/">Пентесты</a></li>
                                    <li><a href="/service/incident-management/">Управление инцидентами ИБ</a></li>
                                    <li><a href="/service/gossopka/">ГосСОПКА</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6 footer-feedback-outer">
                <div class="footer-block">
                    <div class="footer-feedback-title footer-title">
                        <a href="#">Написать нам</a>
                    </div>
                    <div class="footer-content">
                        <div class="footer-feedback">
                            <form action="#" id="feedback">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="footer-feedback-field clearfix">
                                            <div class="footer-feedback-field-title">Имя</div>
                                            <div class="footer-feedback-field-input">
                                                <input type="text" value="" class="input full">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="footer-feedback-field clearfix">
                                            <div class="footer-feedback-field-title">Email</div>
                                            <div class="footer-feedback-field-input">
                                                <input type="email" value="" class="input full">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="footer-feedback-field clearfix">
                                    <div class="footer-feedback-field-title">Письмо</div>
                                    <div class="footer-feedback-field-input">
                                        <textarea class="input full" rows="5"></textarea>
                                    </div>
                                </div>
                                <div style="overflow:hidden">
                                <div style="float: right" id="captcha_footer" class="footer-feedback-field footer-feedback-capcha" data-sitekey="6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP"></div>
                                </div>
                                    <div class="footer-feedback-field footer-feedback-submit">
                                    <input type="submit" value="Отправить" class="button">
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer-copyright">
            <span class="icon icon-stepup"></span> 2021        </div>
    </div>
</footer>
<div class="popup-overlay" id="popup-question">
    <div class="popup-table">
        <div class="popup-cell">
            <div class="popup">
                <a href="#" class="popup-x popup-close icon icon-close" title="Закрыть"></a>
                <div class="popup-content">
                    <form action="#" class="ajax">
                        <div class="form-field">
                            <input type="text" class="input full" placeholder="Как к вам обращаться?" name="name">
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <input type="text" class="input full" placeholder="Адрес электронной почты или телефон*" name="phone_email">
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <textarea class="input full" rows="8" placeholder="Ваш вопрос, запрос или пожелание связаться с вами" name="message"></textarea>
                            <div class="form-field-error"></div>
                        </div>
                        <div class="form-field">
                            <div class="form-field-text">
                                <div class="form-field-nospam">*Мы не спамим и не подписываем на рассылку</div>
                                <div>Быстро ответим только с 9 до 18 по Москве.<br>В противном случае &mdash; на следующий день.</div>
                            </div>
                        </div>
                        <div id="captcha_feedback" class="form-field" data-sitekey="6LfAmjQUAAAAAOlKkyCSJIr2n3xydI6U33qeRtNP"></div>
                        <div class="form-field">
                            <input type="submit" class="button button-black" value="Отправить">
                        </div>
                    </form>
                    <div class="form-message text" style="display: none">
                        <p>Сообщение отправлено.</p>
                        <p>Спасибо, мы с вами обязательно свяжемся.</p>
                        <p>
                            <a href="#" class="popup-close button button-black">OK</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    function initMap() {
        var line = [];
        var uluru = {lat: 55.800312, lng: 37.565437};
        var map = new google.maps.Map(document.getElementById('map1'), {
            zoom: 15,
            center: uluru
        });
        var marker = new google.maps.Marker({
            position: uluru,
            map: map
        });

        function route(flightPlanCoordinates, color) {
            for (var i=0; i<line.length; i++)
            {
                line[i].setMap(null); //or line[i].setVisible(false);
            }
            var route = new google.maps.Polyline({
                path: flightPlanCoordinates,
                geodesic: true,
                strokeColor: color,
                strokeOpacity: 1.0,
                strokeWeight: 4
            });
            line.push(route);
            route.setMap(map);
        }

        $(".contact_how").click(function () {
            switch ($(this).attr("id")){
                case("howAuto"):
                    var routePath = [
                        {lng: 37.555160438890596, lat:55.790646376051114},
                        {lng: 37.55754224049581, lat:55.79213336802756},
                        {lng: 37.5574778674795, lat:55.79219985821376},
                        {lng: 37.557654893274446, lat:55.79269853092611},
                        {lng: 37.55806795346278, lat:55.79307630902726},
                        {lng: 37.55888334500328, lat:55.79332412944713},
                        {lng: 37.55950561749472, lat:55.79371701225159},
                        {lng: 37.558904802675436, lat:55.79391647430447},
                        {lng: 37.5589799045278, lat:55.795203886511004},
                        {lng: 37.56795994030967, lat:55.798068678610754},
                        {lng: 37.56521335827845, lat:55.800878870271184}
                    ];
                    route(routePath, "#33cc00");
                    break;
                case("howTtk"):
                    var routePath = [
                        {lng:37.56551316706945, lat:55.80095569108},
                        {lng:37.568345579789266, lat:55.798036719495435},
                        {lng:37.56862452952684, lat:55.79746256879981},
                        {lng:37.568967852280764, lat:55.794283433130126},
                        {lng:37.56965449778857, lat:55.79075344106749},
                        {lng:37.57149985759082, lat:55.789749994268504},
                        {lng:37.574182153905035, lat:55.791617909044625},
                        {lng:37.57531941052734, lat:55.79183551573765},
                        {lng:37.57808745023072, lat:55.79198058618807},
                        {lng:37.57971823331173, lat:55.79201685370956},
                        {lng:37.5828939687854, lat:55.792282814550326},
                        {lng:37.58583366986572, lat:55.79216192348803},
                        {lng:37.58808672543823, lat:55.792246547271205}
                    ];
                    route(routePath, "#006cff");
                    break;
                case("howTransport"):
                    var routePath = [
                        {lat: 55.79057753175389, lng: 37.556452261444086},
                        {lat: 55.79132708087788, lng: 37.556344973083455},
                        {lat: 55.792034303463, lng: 37.557439314361524},
                        {lat: 55.79247555547622, lng: 37.55849074029541},
                        {lat: 55.793031646752226, lng: 37.56089399957274},
                        {lat: 55.79318880152918, lng: 37.5609261860809},
                        {lat: 55.79397456589992, lng: 37.559027182098355},
                        {lat: 55.795171314881316, lng: 37.55909155511475},
                        {lat: 55.79804215302112, lng: 37.56817887925712},
                        {lat: 55.80092486504567, lng: 37.565378653045606}
                    ];
                    route(routePath,  "#ff0000");
                    break;
            }
        });
    }
</script>
<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBjS_0Yj5L1FNuflX6m5EkY0LFL2iNs6oA&callback=initMap">
</script>
<script src="/bitrix/templates/amonitoring/js/jquery.mobile.custom.min.js"></script>
<script src="/bitrix/templates/amonitoring/js/jquery.maskedinput.min.js"></script>
<script src="/bitrix/templates/amonitoring/js/owl.carousel.min.js"></script>
<script src="https://api-maps.yandex.ru/2.1/?lang=ru_RU"></script>
<script src="/bitrix/templates/amonitoring/js/fancybox/jquery.fancybox.pack.js"></script>
<script src="/bitrix/templates/amonitoring/js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter15525343 = new Ya.Metrika({
                    id:15525343,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/15525343" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>