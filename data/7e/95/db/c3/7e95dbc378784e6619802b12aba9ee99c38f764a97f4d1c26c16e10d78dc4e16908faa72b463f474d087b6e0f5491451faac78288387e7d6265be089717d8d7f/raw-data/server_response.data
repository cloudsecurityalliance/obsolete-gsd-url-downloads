<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions - Security - HashiCorp Discuss</title>
    <meta name="description" content="Bulletin ID: HCSEC-2021-20 
Affected Products / Versions: Vault and Vault Enterprise 1.4.0 up to 1.7.3; fixed in 1.8.0. 
Publication Date: August 12, 2021 
Summary 
When initializing Vault’s Integrated Storage backend, e&amp;hellip;">
    <meta name="generator" content="Discourse 2.8.0.beta7 - https://github.com/discourse/discourse version 436edbb51a15c634e65c0d7cdccdb4ce9aecd8f1">
<link rel="icon" type="image/png" href="https://aws1.discourse-cdn.com/hashicorp/optimized/1X/768b0c508ad4facc44cabe5a30aff4d7f8afa863_2_32x32.png">
<link rel="apple-touch-icon" type="image/png" href="https://aws1.discourse-cdn.com/hashicorp/optimized/1X/154331ed085112b536f7a0c4c5355c17a57e53c1_2_180x180.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
<link rel="canonical" href="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://discuss.hashicorp.com","potentialAction":{"@type":"SearchAction","target":"https://discuss.hashicorp.com/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="https://discuss.hashicorp.com/opensearch.xml" title="HashiCorp Discuss Search">

      <link href="https://sea2.discourse-cdn.com/hashicorp/stylesheets/desktop_3efd433df85c59aaefb5500dd3bf1fda39cbdf6b.css?__ws=discuss.hashicorp.com" media="all" rel="stylesheet" data-target="desktop"  />
      <link href="https://sea2.discourse-cdn.com/hashicorp/stylesheets/desktop_theme_19_b1232ab7e1a63dce3d47ad01483d60057495aa70.css?__ws=discuss.hashicorp.com" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="19" data-theme-name="discourse-hashicorp-theme"/>
    


<script src="https://sea2.discourse-cdn.com/hashicorp/theme-javascripts/d50ac3dedd3ea76578c300e5e62bc17c5b4f01d2.js?__ws=discuss.hashicorp.com"></script>
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-36299135-17" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

  <link rel="preload" href="https://aws1.discourse-cdn.com/hashicorp/assets/google-universal-analytics-v3-706f1d28f0a97f67a47515c96189277240ec4940d968955042066d7873fd1fe8.gz.js" as="script">
<script src="https://aws1.discourse-cdn.com/hashicorp/assets/google-universal-analytics-v3-706f1d28f0a97f67a47515c96189277240ec4940d968955042066d7873fd1fe8.gz.js"></script>


        <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions&#39;" href="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168.rss" />
    <meta property="og:site_name" content="HashiCorp Discuss" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://aws1.discourse-cdn.com/hashicorp/original/1X/154331ed085112b536f7a0c4c5355c17a57e53c1.png" />
<meta property="og:image" content="https://aws1.discourse-cdn.com/hashicorp/original/1X/154331ed085112b536f7a0c4c5355c17a57e53c1.png" />
<meta property="og:url" content="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168" />
<meta name="twitter:url" content="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168" />
<meta property="og:title" content="HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions" />
<meta name="twitter:title" content="HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions" />
<meta property="og:description" content="Bulletin ID: HCSEC-2021-20  Affected Products / Versions: Vault and Vault Enterprise 1.4.0 up to 1.7.3; fixed in 1.8.0.  Publication Date: August 12, 2021  Summary  When initializing Vault’s Integrated Storage backend, excessively broad filesystem permissions may be set for the underlying Bolt database used by Vault’s Raft implementation. This vulnerability, CVE-2021-38553, was fixed in Vault 1.8.0.  Background  Vault’s Integrated Storage was introduced in Vault 1.4.0, providing a built-in highl..." />
<meta name="twitter:description" content="Bulletin ID: HCSEC-2021-20  Affected Products / Versions: Vault and Vault Enterprise 1.4.0 up to 1.7.3; fixed in 1.8.0.  Publication Date: August 12, 2021  Summary  When initializing Vault’s Integrated Storage backend, excessively broad filesystem permissions may be set for the underlying Bolt database used by Vault’s Raft implementation. This vulnerability, CVE-2021-38553, was fixed in Vault 1.8.0.  Background  Vault’s Integrated Storage was introduced in Vault 1.4.0, providing a built-in highl..." />
<meta property="article:published_time" content="2021-08-12T22:22:05+00:00" />
<meta property="og:ignore_canonical" content="true" />


    
  </head>
  <body class="crawler">
    <!-- Replace icons -->






<script src="https://sea2.discourse-cdn.com/hashicorp/theme-javascripts/350479ec786d3192eb5f22fc034f23a6abba1c60.js?__ws=discuss.hashicorp.com"></script>
    <header>
      <a href="/">
          <img src="https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg" alt="HashiCorp Discuss" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
        <div id="topic-title">
    <h1>
      <a href="/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168">HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions</a>
    </h1>

      <div class="topic-category" itemscope itemtype="http://schema.org/BreadcrumbList">
          <span itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
            <a href="https://discuss.hashicorp.com/c/security/52" class="badge-wrapper bullet" itemprop="item">
              <span class='badge-category-bg' style='background-color: #0088CC'></span>
              <span class='badge-category clear-badge'>
                <span class='category-name' itemprop='name'>Security</span>
              </span>
            </a>
            <meta itemprop="position" content="1" />
          </span>
      </div>

      <div class="topic-category">
        <div class='discourse-tags list-tags'>
            <a href='https://discuss.hashicorp.com/tag/security-vault' class='discourse-tag' rel="tag">security-vault</a>
        </div>
      </div>
  </div>

  


      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='HashiCorp'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://discuss.hashicorp.com/u/jfinnigan'><span itemprop='name'>jfinnigan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-08-12T22:22:05Z' class='post-time'>
                August 12, 2021, 10:22pm
              </time>
              <meta itemprop='dateModified' content='2021-08-12T22:22:05Z'>
          <span itemprop='position'>#1</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><strong>Bulletin ID:</strong> HCSEC-2021-20<br>
<strong>Affected Products / Versions:</strong> Vault and Vault Enterprise 1.4.0 up to 1.7.3; fixed in 1.8.0.<br>
<strong>Publication Date:</strong> August 12, 2021</p>
<p><strong>Summary</strong><br>
When initializing Vault’s Integrated Storage backend, excessively broad filesystem permissions may be set for the underlying Bolt database used by Vault’s Raft implementation. This vulnerability, CVE-2021-38553, was fixed in Vault 1.8.0.</p>
<p><strong>Background</strong><br>
Vault’s <a href="https://www.vaultproject.io/docs/concepts/integrated-storage">Integrated Storage</a> was introduced in Vault 1.4.0, providing a built-in highly available storage backend. As <a href="https://www.vaultproject.io/docs/internals/integrated-storage">documented</a>, the Integrated Storage backend uses the Raft consensus protocol, which uses BoltDB as an underlying datastore.</p>
<p><strong>Details</strong><br>
During initialization of the Integrated Storage backend, Vault creates a database file on disk with potentially excessive filesystem permissions, though these vary depending on the operating system’s umask values. This <code>vault.db</code> file is written to the location configured by the <a href="https://www.vaultproject.io/docs/configuration/storage/raft#path"><code>path</code></a> parameter in Vault’s Raft configuration.</p>
<p>Most Vault environments are unlikely to have significant exposure as a result of this issue:</p>
<ul>
<li>
<p>Only Vault clusters utilizing Integrated Storage are affected.</p>
</li>
<li>
<p>The default system umask on each Vault node will likely cause a less-broad permission to be applied.</p>
</li>
<li>
<p>In the Vault <a href="https://www.vaultproject.io/docs/internals/security#external-threat-overview">security model</a>, storage backends are considered untrusted by design. Barrier encryption is applied before data is written to Vault storage backends including Integrated Storage, guarding against unauthorized access or tampering of data. However, the database file could be deleted, potentially resulting in denial of service.</p>
</li>
<li>
<p>Vault’s <a href="https://learn.hashicorp.com/tutorials/vault/production-hardening">production hardening guide</a> recommends a single tenancy model, which reduces the likelihood of another process or user manipulating the host’s filesystem.</p>
</li>
</ul>
<p><strong>Remediation</strong><br>
Customers using Vault’s Integrated Storage should evaluate the risk associated with this issue in conjunction with the mitigating factors noted above, and consider reviewing and possibly updating filesystem permissions for the <code>vault.db</code> file across their Vault nodes.</p>
<p>New deployments of Vault or Vault Enterprise 1.8.0 or newer will create the Integrated Storage database with more restrictive filesystem permissions by default.</p>
<p><strong>Acknowledgement</strong><br>
This issue was identified by the Vault engineering team.</p>
<p><em>We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <a href="https://hashicorp.com/security" class="inline-onebox">Security at HashiCorp</a>.</em></p>
        </div>

        <meta itemprop='headline' content='HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions'>
          <meta itemprop='keywords' content='security-vault'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>
      <div itemscope itemtype='http://schema.org/DiscussionForumPosting' class='topic-body crawler-post'>
        <div class='crawler-post-meta'>
          <div itemprop='publisher' itemscope itemtype="http://schema.org/Organization">
            <meta itemprop='name' content='HashiCorp'>
              <div itemprop='logo' itemscope itemtype="http://schema.org/ImageObject">
                <meta itemprop='url' content='https://aws1.discourse-cdn.com/hashicorp/original/1X/668e19cbc79e3eaa176133c3679dc30aa57ba474.svg'>
              </div>
          </div>
          <span class="creator" itemprop="author" itemscope itemtype="http://schema.org/Person">
            <a itemprop="url" href='https://discuss.hashicorp.com/u/jfinnigan'><span itemprop='name'>jfinnigan</span></a>
            
          </span>

          <link itemprop="mainEntityOfPage" href="https://discuss.hashicorp.com/t/hcsec-2021-20-vault-s-integrated-storage-backend-database-file-may-have-excessively-broad-permissions/28168">


          <span class="crawler-post-infos">
              <time itemprop='datePublished' datetime='2021-09-02T15:09:08Z' class='post-time'>
                September 2, 2021,  3:09pm
              </time>
              <meta itemprop='dateModified' content='2021-09-02T15:09:08Z'>
          <span itemprop='position'>#2</span>
          </span>
        </div>
        <div class='post' itemprop='articleBody'>
          <p><strong>Update Regarding Risk Scoring</strong></p>
<p>The CVSS score originally published to the NIST <a href="https://nvd.nist.gov/">NVD</a> for this issue was 9.8 (Critical), with a vector string <a href="https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H">CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H</a>.</p>
<p>In contrast, HashiCorp’s internal CVSS scoring was 4.4 (Medium), with a vector string <a href="https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H">CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:U/C:N/I:N/A:H</a>.</p>
<p>Points for consideration regarding this score:</p>
<ul>
<li>To exploit this vulnerability, the attacker requires code execution on the host running the Vault process. For this reason, Attack Vector should be Local, and Privileges Required should be High.</li>
<li>Storage Backends in Vault are <a href="https://www.vaultproject.io/docs/internals/security#external-threat-overview">considered untrusted by design</a>: Vault’s Barrier Encryption uses authenticated encryption for any data persisted to storage backends, including the Bolt database in question. As such, impact to Confidentiality and Integrity should be None (impact to Availability remains High).</li>
</ul>
        </div>

        <meta itemprop='headline' content='HCSEC-2021-20 - Vault’s Integrated Storage Backend Database File May Have Excessively Broad Permissions'>

        <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
           <meta itemprop="interactionType" content="http://schema.org/LikeAction"/>
           <meta itemprop="userInteractionCount" content="0" />
           <span class='post-likes'></span>
         </div>

         <div itemprop="interactionStatistic" itemscope itemtype="http://schema.org/InteractionCounter">
            <meta itemprop="interactionType" content="http://schema.org/CommentAction"/>
            <meta itemprop="userInteractionCount" content="0" />
          </div>

      </div>






    </div>
    <footer class="container wrap">
      <nav class='crawler-nav'>
        <ul>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/' itemprop="url">Home </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/categories' itemprop="url">Categories </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/guidelines' itemprop="url">FAQ/Guidelines </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/tos' itemprop="url">Terms of Service </a>
          </span>
        </li>
        <li itemscope itemtype='http://schema.org/SiteNavigationElement'>
          <span itemprop='name'>
            <a href='/privacy' itemprop="url">Privacy Policy </a>
          </span>
        </li>
        </ul>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
    
  </body>
  
</html>
