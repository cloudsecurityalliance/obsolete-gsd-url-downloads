<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 683060 – Impossible to unlock screen if not using GDM</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=683060&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=683060" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 683060 – Impossible to unlock screen if not using GDM",  
                             "show_bug.cgi?id=683060" );
        document.title = "Bug 683060 – Impossible to unlock screen if not using GDM";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 683060 – Impossible to unlock screen if not using GDM", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_gnome-shell bz_component_lock-screen bz_bug_683060 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 683060</p>
</td>
<td id="subtitle">
<p class="subheader">Impossible to unlock screen if not using GDM</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2012-10-22 15:21:59 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2012-10-22 15:21:59"/>
<input name="longdesclength" type="hidden" value="84"/>
<input name="id" type="hidden" value="683060"/>
<input name="token" type="hidden" value="1626120293-Epo3i1MDuzoRwY0dhBA4QSW4bYB3daeV5e3zXC-pwuA"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=683060"><b>Bug 683060</b></a> -<span class="bz_default_hidden" id="summary_alias_container">
<span id="short_desc_nonedit_display">Impossible to unlock screen if not using GDM</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">
</td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>Impossible to unlock screen if not using GDM
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('Impossible to unlock screen if not using GDM', '');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">gnome-shell</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Core</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=gnome-shell" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">lock-screen</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>3.5.x
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       Linux
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       major
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>---
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard">gnome-shell-maint
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard">gnome-shell-maint
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'gnome-shell-maint\x40gnome.bugs',
        'gnome-shell-maint\x40gnome.bugs');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label for="duplicates">Duplicates</label>:
    </th>
<td class="field_value" colspan="2">
<span id="duplicates"><a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683693" title="RESOLVED DUPLICATE - fall back to gnome-screensaver when a fault occurs">683693</a> <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683757" title="RESOLVED DUPLICATE - Pressing ESC on Lock Screen hides / kills the lock screen, can't do anything anymore.">683757</a>
</span>
      (<a href="buglist.cgi?bug_id=683693,683757">view as bug list</a>)
    </td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2012-08-30 19:23 UTC by <span class="vcard"><span class="fn">Jeremy Bicha</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2012-10-22 15:21 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">3.6</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a1">
<td valign="top">
<a href="attachment.cgi?id=223657" title="View the content of the attachment">
<b><span class="bz_obsolete">ShellUserVerifier: catch DBus errors and report if GDM is not available</span></b></a>
<span class="bz_attach_extra_info">
              (5.04 KB,
                patch)

            <br/>
<a href="#attach_223657" title="Go to the comment associated with the attachment">2012-09-06 14:42 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=223657&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=223657">Review</a>
</td>
</tr>
<tr class="bz_contenttype_image_jpeg" id="a2">
<td valign="top">
<a href="attachment.cgi?id=223934" title="View the content of the attachment">
<b>screenshot</b></a>
<span class="bz_attach_extra_info">
              (659.60 KB,
                image/jpeg)

            <br/>
<a href="#attach_223934" title="Go to the comment associated with the attachment">2012-09-10 17:09 UTC</a>,

            <span class="vcard"><span class="fn">William Jon McCann</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">
             
          </td>
<td valign="top">
<a href="attachment.cgi?id=223934&amp;action=edit">Details</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a3">
<td valign="top">
<a href="attachment.cgi?id=224011" title="View the content of the attachment">
<b><span class="bz_obsolete">Allow the shell to run without the screenshield</span></b></a>
<span class="bz_attach_extra_info">
              (7.07 KB,
                patch)

            <br/>
<a href="#attach_224011" title="Go to the comment associated with the attachment">2012-09-11 11:02 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=224011&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=224011">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a4">
<td valign="top">
<a href="attachment.cgi?id=224226" title="View the content of the attachment">
<b><span class="bz_obsolete">Allow the shell to run without the screenshield</span></b></a>
<span class="bz_attach_extra_info">
              (7.12 KB,
                patch)

            <br/>
<a href="#attach_224226" title="Go to the comment associated with the attachment">2012-09-13 13:49 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=224226&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=224226">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a5">
<td valign="top">
<a href="attachment.cgi?id=224412" title="View the content of the attachment">
<b><span class="bz_obsolete">Allow the shell to run without the screenshield</span></b></a>
<span class="bz_attach_extra_info">
              (9.09 KB,
                patch)

            <br/>
<a href="#attach_224412" title="Go to the comment associated with the attachment">2012-09-15 15:01 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=224412&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=224412">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a6">
<td valign="top">
<a href="attachment.cgi?id=224653" title="View the content of the attachment">
<b>Allow the shell to run without the screenshield</b></a>
<span class="bz_attach_extra_info">
              (8.99 KB,
                patch)

            <br/>
<a href="#attach_224653" title="Go to the comment associated with the attachment">2012-09-18 17:19 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=224653&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=224653">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a7">
<td valign="top">
<a href="attachment.cgi?id=224656" title="View the content of the attachment">
<b>ShellUserVerifier: catch DBus errors and report them to the user</b></a>
<span class="bz_attach_extra_info">
              (7.72 KB,
                patch)

            <br/>
<a href="#attach_224656" title="Go to the comment associated with the attachment">2012-09-18 17:48 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=224656&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=224656">Review</a>
</td>
</tr>
<tr class="bz_contenttype_image_png" id="a8">
<td valign="top">
<a href="attachment.cgi?id=224661" title="View the content of the attachment">
<b>New screenshot</b></a>
<span class="bz_attach_extra_info">
              (297.21 KB,
                image/png)

            <br/>
<a href="#attach_224661" title="Go to the comment associated with the attachment">2012-09-18 18:55 UTC</a>,

            <span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">
             
          </td>
<td valign="top">
<a href="attachment.cgi?id=224661&amp;action=edit">Details</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a9">
<td valign="top">
<a href="attachment.cgi?id=226782" title="View the content of the attachment">
<b><span class="bz_obsolete">screenShield: explicitly load gnome-screensaver in fallback mode.</span></b></a>
<span class="bz_attach_extra_info">
              (1.40 KB,
                patch)

            <br/>
<a href="#attach_226782" title="Go to the comment associated with the attachment">2012-10-18 23:47 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=226782&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226782">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a10">
<td valign="top">
<a href="attachment.cgi?id=226783" title="View the content of the attachment">
<b>Move gnome-screensaver to the fallback session.</b></a>
<span class="bz_attach_extra_info">
              (923 bytes,
                patch)

            <br/>
<a href="#attach_226783" title="Go to the comment associated with the attachment">2012-10-18 23:49 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=226783&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226783">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a11">
<td valign="top">
<a href="attachment.cgi?id=226784" title="View the content of the attachment">
<b>move gnome-screensaver desktop file out of autostart</b></a>
<span class="bz_attach_extra_info">
              (1.28 KB,
                patch)

            <br/>
<a href="#attach_226784" title="Go to the comment associated with the attachment">2012-10-18 23:51 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=226784&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226784">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a12">
<td valign="top">
<a href="attachment.cgi?id=226790" title="View the content of the attachment">
<b><span class="bz_obsolete">screenShield: explicitly load gnome-screensaver in fallback mode.</span></b></a>
<span class="bz_attach_extra_info">
              (1.36 KB,
                patch)

            <br/>
<a href="#attach_226790" title="Go to the comment associated with the attachment">2012-10-19 06:17 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=226790&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226790">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a13">
<td valign="top">
<a href="attachment.cgi?id=226795" title="View the content of the attachment">
<b><span class="bz_obsolete">screenShield: explicitly load gnome-screensaver in fallback mode.</span></b></a>
<span class="bz_attach_extra_info">
              (1.41 KB,
                patch)

            <br/>
<a href="#attach_226795" title="Go to the comment associated with the attachment">2012-10-19 07:19 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=226795&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226795">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a14">
<td valign="top">
<a href="attachment.cgi?id=226796" title="View the content of the attachment">
<b>screenShield: explicitly load gnome-screensaver in fallback mode.</b></a>
<span class="bz_attach_extra_info">
              (1.39 KB,
                patch)

            <br/>
<a href="#attach_226796" title="Go to the comment associated with the attachment">2012-10-19 07:21 UTC</a>,

            <span class="vcard">darkxst
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=226796&amp;action=edit">Details</a>  |
    <a href="review?bug=683060&amp;attachment=226796">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jeremy Bicha</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-30 19:23:28 UTC
        </span>
</div>
<pre class="bz_comment_text">If you have GDM installed but are instead using an alternate display manager like KDM or LightDM, GNOME Shell 3.5.90 works. However, clicking Switch Session does nothing. Worse, clicking Lock Screen (or using Ctrl+Alt+L) locks the screen but there's no way to unlock the screen. This is relatively easy to verify by installing a non-GNOME image (Ubuntu daily, or a Fedora KDE spin, etc.) and installing gnome-shell.

This is a pretty significant regression and critically affects Ubuntu. It currently blocks making any newer versions of GNOME Shell than 3.5.4 available in Ubuntu. There's no good way for distro developers to guarantee that when someone installs gnome-shell that gdm will be registered as the default display manager instead of whatever they were using.

And this affects all display managers that aren't GDM so a hack to blacklist the gnome-shell session would need to be applied to all display managers. Once again, there's no good way to let the user know why they can't choose GNOME Shell from the login screen after they're sure they've installed it. There is long-standing precedent of being able to mix and match display managers with desktop sessions and quite a few users and developers have multiple desktops installed.

Also reported at <a href="https://bugs.launchpad.net/ubuntu/+source/gnome-shell/+bug/1042907">https://bugs.launchpad.net/ubuntu/+source/gnome-shell/+bug/1042907</a> Please see Robert Ancell's comments there.

What I believe should happen: GNOME Shell should fallback to the GNOME 3.4 locking interface (using gnome-screensaver or whatever) if GDM isn't running.</pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-30 19:37:48 UTC
        </span>
</div>
<pre class="bz_comment_text">We already depend on libgdm in several places. Do we need to remove those, too?</pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Colin Walters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-30 20:50:05 UTC
        </span>
</div>
<pre class="bz_comment_text">Until we drop fallback mode, we'll have gnome-screensaver, but falling back forever is pretty unappealing.  You have to understand that GNOME gets a lot of code savings and integration by having gdm reuse gnome-shell.

We could at least say "Lock screen not supported" or something I guess.</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Robert Ancell</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-31 03:53:32 UTC
        </span>
</div>
<pre class="bz_comment_text">Jasper, no there's no problem depending on libgdm, just the issue of the GDM daemon not actually being there. The solution might involve libdgm indicating to GNOME Shell that GDM is not present.

A possible fallback solution is to do a PAM authentication from the gnome-shell process (i.e. the way gnome-screensaver does it now). In that way you can use the same UI but use an alternate authentication mechanism. I don't know how hard that would be to add/support.</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-08-31 04:19:12 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c3">comment #3</a>)
<span class="quote">&gt; Jasper, no there's no problem depending on libgdm, just the issue of the GDM
&gt; daemon not actually being there. The solution might involve libdgm indicating
&gt; to GNOME Shell that GDM is not present.
&gt; 
&gt; A possible fallback solution is to do a PAM authentication from the gnome-shell
&gt; process (i.e. the way gnome-screensaver does it now). In that way you can use
&gt; the same UI but use an alternate authentication mechanism. I don't know how
&gt; hard that would be to add/support.</span>

That would basically involve copying half of the gdm codebase in-tree.</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Olav Vitters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-02 13:54:19 UTC
        </span>
</div>
<pre class="bz_comment_text">Putting as 3.6 blocker. Not to force a particular solution, but to track &amp; ensure GNOME doesn't break under a different DM than GDM.</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-03 07:17:05 UTC
        </span>
</div>
<pre class="bz_comment_text">So, I don't think we want random things around the stack running random PAM modules to do a reauth with. gnome-screensaver just did that. It didn't run as root, either, so it looks like it would just break with random PAM modules that require it.

Ray is against a setuid helper to do the reauth, as that makes us more vulnerable to attacks. A root helper, like GDM/LightDM, should start the PAM authentication process in all cases. That makes the gnome-screensaver reauth approach out of the question, if I understand things correctly.

Does it make sense to make both LightDM and GDM export a common DBus interface that would start a reauth session? libgdm could use that, and that would work for both LightDM and GDM.</pre>
</div><div class="bz_comment" id="c7">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c7">Comment 7</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Aigars Mahinovs</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-04 12:42:55 UTC
        </span>
</div>
<pre class="bz_comment_text">There are at least 7 different ?dm variants in Debian/Ubuntu and there are sure to be more out there. They implement the functionality that was required from a DM since the early days of X. If Gnome can not work with say xdm without changes on the xdm side, then that is a bug of Gnome.

I understand that it is cooler, more modern and safer from the architecture point of view if the DM is the only component handling user authentication, but you must detect at runtime if:

1) there is a DM being used at all (startx and some methods of running terminal sessions do not run any DM at all and are still used quite widely for good reasons);

2) if the DM that is being used supports the 're-auth' feature and/or 'user switch' feature;

If not, then at the very least you must disable those features so as not to break user systems. But the sane would be to implement an alternate code path that works without a supportive DM, just like it did before. For code perspective, it is likely that it would be the simplest to push the relevant code from GDM to libgdm and then call it from there in the Shell.

Sure, it is suboptimal, but you can not depend on the DM being there to catch you.</pre>
</div><div class="bz_comment" id="c8">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c8">Comment 8</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Colin Walters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-04 13:36:45 UTC
        </span>
</div>
<pre class="bz_comment_text">Note that by dropping "screensaver in session", we also drop support for XDCMP deployments.  Probably no one really cares about that though.  Unencrypted authentication is so 1989.</pre>
</div><div class="bz_comment" id="c9">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c9">Comment 9</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Colin Walters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-04 14:09:22 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c6">comment #6</a>)
<span class="quote">&gt; So, I don't think we want random things around the stack running random PAM
&gt; modules to do a reauth with. gnome-screensaver just did that. It didn't run as
&gt; root, either, so it looks like it would just break with random PAM modules that
&gt; require it.
&gt; 
&gt; Ray is against a setuid helper to do the reauth, as that makes us more
&gt; vulnerable to attacks. </span>

Note that ultimately, the way gnome-screensaver works[1] is that for the default case of pam_unix, there's a setuid /usr/sbin/unix_chkpwd program.  

Not saying that this is a sane long-term strategy; just listing the reason it works currently.

[1] Present tense as we still ship it in GNOME for fallback</pre>
</div><div class="bz_comment" id="c10">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c10">Comment 10</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 03:06:42 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c7">comment #7</a>)

<span class="quote">&gt; 
&gt; Sure, it is suboptimal, but you can not depend on the DM being there to catch
&gt; you.</span>

I didn't see a convincing argument that we can't. "Must be able to run with any DM" is not part of the GNOME mission statement. If it helps achieve a better user exerience, we can and should depend on gdm features that are necessary for that experience.

There may be pragmatic reasons for not graceful degradation of the user experience when running under dms, but "implement an alternate code path" for such situations doesn't sound attractive.</pre>
</div><div class="bz_comment" id="c11">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c11">Comment 11</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 03:24:44 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c9">comment #9</a>)
<span class="quote">&gt; Note that ultimately, the way gnome-screensaver works[1] is that for the
&gt; default case of pam_unix, there's a setuid /usr/sbin/unix_chkpwd program.  
&gt; 
&gt; Not saying that this is a sane long-term strategy; just listing the reason it
&gt; works currently.
&gt; 
&gt; [1] Present tense as we still ship it in GNOME for fallback</span>

But if there's a third party PAM module that relies on being root (Ray would have more details here, I've been told there are such things), the screensaver would fail.

(In reply to <a href="show_bug.cgi?id=683060#c7">comment #7</a>)
<span class="quote">&gt; If not, then at the very least you must disable those features so as not to
&gt; break user systems. But the sane would be to implement an alternate code path
&gt; that works without a supportive DM, just like it did before. For code
&gt; perspective, it is likely that it would be the simplest to push the relevant
&gt; code from GDM to libgdm and then call it from there in the Shell.</span>

Again, this will not work, since the PAM worker process relies on being root. We will not use a setuid helper, because it does not guarantee that we start in a controlled environment.

If we want to have a common interface or piece of the stack that KDE/LightDM/GNOME/E/whatever can share that does secure and safe PAM authentication then I'm perfectly OK with that, and we certainly can define such an interface, even if only for LightDM/GNOME in the short term.

Having a broken workaround system for such an edge case is not acceptable to me.</pre>
</div><div class="bz_comment" id="c12">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c12">Comment 12</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Aigars Mahinovs</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 09:24:04 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c11">comment #11</a>)
<span class="quote">&gt; But if there's a third party PAM module that relies on being root (Ray would
&gt; have more details here, I've been told there are such things), the screensaver
&gt; would fail.</span>

If there is such a thing, then it would not have worked before, correct?

On the other hand there is a lot of people using KDM, LightDM and others, a bunch of people using remote terminal logins and a bunch of people doing some weird homegrown stuff and then calling startx.

What this does is breaks a lot of different existing usecases to make one vaguely unspecified usecase work. All because you introduce a braking of well established Linux/X abstraction layers without a proper fallback.

Making everyone else on the planet change their code to make your screensaver code a bit cleaner is not a solution.</pre>
</div><div class="bz_comment" id="c13">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c13">Comment 13</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Emmanuel Touzery</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 11:51:03 UTC
        </span>
</div>
<pre class="bz_comment_text">With regards to ubuntu, I guess making the gnome-shell package conflict with the packages for all the other DMs than GDM and also strictly depend on GDM could solve the problem, without any change to gnome-shell, but surely you already thought about that and I'm missing something.</pre>
</div><div class="bz_comment" id="c14">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c14">Comment 14</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Olav Vitters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 12:45:02 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c12">comment #12</a>)
<span class="quote">&gt; If there is such a thing, then it would not have worked before, correct?</span>

setuid helper and code duplication was already given as answer
 
<span class="quote">&gt; On the other hand there is a lot of people using KDM, LightDM and others, a
&gt; bunch of people using remote terminal logins and a bunch of people doing some
&gt; weird homegrown stuff and then calling startx.</span>

Can you provide clear data on how often those cases are used vs GDM? Seems better to argue with data than guessing.</pre>
</div><div class="bz_comment" id="c15">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c15">Comment 15</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Aigars Mahinovs</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 12:59:48 UTC
        </span>
</div>
<pre class="bz_comment_text">All Ubuntu users have LightDM now by default, same with Xubuntu. KDE users on all distributions have KDM by default. All terminal client installations that I know of use their specific software for login (and that is hundreds of thousands of installations across just schools in Europe). And I also know a couple corporate deployments where they have custom login screens that later run startx.

I agree that the functionality itself is very cool and very clean, but forcing people to use GDM just to use Gnome is not cool. Imagine if KDE and XFCE did the same - a key part of the ?DM is to allow the user a choice between session types.

I am pretty sure that if this bug is not solved upstream, it will have to be solved at the distribution level anyway. It is better to have a single, central legacy workaround hack than 10 slightly different third-party ones.

While making gnome-shell conflict with all other DMs and depend on gdm would work technically, it would force people to replace a key part of their software stack and will cause unusable systems in the scenarios where another DM was chosen for a reason, such as above.</pre>
</div><div class="bz_comment" id="c16">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c16">Comment 16</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Olav Vitters</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 13:07:51 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c15">comment #15</a>)
<span class="quote">&gt; All Ubuntu users have LightDM now by default, same with Xubuntu. KDE users on
&gt; all distributions have KDM by default. All terminal client installations that I
&gt; know of use their specific software for login (and that is hundreds of
&gt; thousands of installations across just schools in Europe). And I also know a
&gt; couple corporate deployments where they have custom login screens that later
&gt; run startx.</span>

Could you expand a bit more?

LightDM need to be worked upon due to Ubuntu, that's clear.

Seems not too interesting that KDE users have KDM. Or XFCE/Xubuntu having LightDM.

Terminal clients: how many use GNOME 3? I thought most didn't support GNOME 3? Does that hardware allow for locking?

Corporate deployments: How many use GNOME 3? How far to they lag behind?</pre>
</div><div class="bz_comment" id="c17">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c17">Comment 17</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 13:09:17 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c12">comment #12</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=683060#c11">comment #11</a>)
&gt; &gt; But if there's a third party PAM module that relies on being root (Ray would
&gt; &gt; have more details here, I've been told there are such things), the screensaver
&gt; &gt; would fail.
&gt; 
&gt; If there is such a thing, then it would not have worked before, correct?</span>

That's exactly what I'm saying. Either there are PAM modules that have setuid helpers (pam_unix), or they just flat out broke when plugged into gnome-screensaver. Again, Ray would have more information.</pre>
</div><div class="bz_comment" id="c18">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c18">Comment 18</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 16:00:56 UTC
        </span>
</div>
<pre class="bz_comment_text">There's one additional solution, which probably makes the most sense; split out the PAM code used in gdm into an auth service, and have gdm, gnome-shell, gnome-screensaver, and polkit (and potentially other parts, like LightDM) all use that service. This would remove the dependency of the gdm daemon from gnome-shell.

Thoughts on this, Robert?</pre>
</div><div class="bz_comment" id="c19">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c19">Comment 19</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 16:18:50 UTC
        </span>
</div>
<pre class="bz_comment_text">By the way, I was told it was the interest of the SSSD project to provide this service over DBus as a replacement for PAM, but it was not implemented for lack of resources.

Still, there is one problem: AFAIK, to refresh credentials correctly, at least for some modules (including kerberos) the reauthentication must run under the session (loginuid, kernel keyring) that it is unlocking.
This means that part of this auth agent must be either starting the PAM session entirely or somehow be started by whoever opens the session. In both cases it makes sense to be part of the display/login manager, and even if splitted it would not solve the startx case.</pre>
</div><div class="bz_comment" id="c20">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c20">Comment 20</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Robert Ancell</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-05 21:54:19 UTC
        </span>
</div>
<pre class="bz_comment_text">Hi Jasper,

I'm against implementing a public PAM interface into the LightDM daemon. This is a design I explored a while ago for GDM then LightDM but I'm uneasy about giving access to a root daemon without being sure what process is accessing it.

The design we have in LightDM is the greeter is solely responsible for authentication for login and screen locking (thus giving a consistent user experience). The safety of this is secured by using a private pipe between the daemon and the greeter process (the same way that GDM does it). The risk is the responsibility of the sysadmin who chooses which greeters are safe enough to get this access (i.e. by installing them). There have been some challenges [1] with doing it this way however.

Unfortunately we can't split the PAM code out of the display manager daemons (as much as I would like to) since we have to hold the process that PAM is authenticating and make it become the session [3].

Using PolicyKit was one idea I had thought about a while ago and it seems on the surface like a good fit. Unlocking is just an action that should have policy such as being able to be overridden by root. The problem is PK by design only has one UI for authentication and I don't know how we could override that in a lock screen (or if it would be safe to be able to).

So in summary, my thoughts are:

- I don't want to add a PAM interface to LightDM given that it has security implications and conflicts with the design for LightDM. Also due to the fact that other DMs will still have the same problem.

- Given we can't remove the PAM code from the display manager daemons (AFAICT) there isn't a good common place to put PAM authentication, but I do think PK is worth investigating if that would be possible / make sense.

- I would encourage you to consider moving the lock screen code into your greeter in the long term (given the problems in [1]) or consider using LightDM :) [4]

--Robert

[1] This relies on session switching to be reliable and and we haven't found to be the case with VT switching. We've been working on using a system compositor (i.e. Wayland) [2] that does the switching and that works well with some bugs requiring to be fixed.

[2] <a href="https://blueprints.launchpad.net/ubuntu/+spec/desktop-q-system-compositor">https://blueprints.launchpad.net/ubuntu/+spec/desktop-q-system-compositor</a>

[3] Since PAM modules like to do things to the process like setenv, setgroups etc

[4] Please, no flames</pre>
</div><div class="bz_comment" id="c21">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c21">Comment 21</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 03:12:10 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c20">comment #20</a>)
<span class="quote">&gt; Unfortunately we can't split the PAM code out of the display manager daemons
&gt; (as much as I would like to) since we have to hold the process that PAM is
&gt; authenticating and make it become the session [3].</span>

The plan Ray and I had was to have a system service that the display managers would call, similar to how PAM auth works in gdm.

The gdm-session-worker runs a PAM conversation, and then forks and execs a session. For reauth, we simply ask the session worker to fork a new worker, start a PAM reauth conversation, and after it confirms, we kill it and we're done. This could be done by a DE-independent piece of code, like SSSD. Communication in GDM right now, is done by a private pipe where we talk peer-to-peer DBus.</pre>
</div><div class="bz_comment" id="c22">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c22">Comment 22</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 12:35:13 UTC
        </span>
</div>
<pre class="bz_comment_text">All of this is obviously entirely out of reach for 3.6. For 3.6, I would suggest that we explore 2 things:

- Make gnome-shell cope with gdm not being available and just disable screen locking functionality in this case

- Make gnome-shell fall back to using gnome-screensaver for locking when the gdm authentication interface is not available</pre>
</div><div class="bz_comment" id="c23">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c23">Comment 23</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 12:36:04 UTC
        </span>
</div>
<pre class="bz_comment_text">I would also suggest that the people who are interested in combining gnome with alternative dms should participate in this exploration.</pre>
</div><div class="bz_comment" id="c24">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c24">Comment 24</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 14:42:02 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=223657" name="attach_223657" title="ShellUserVerifier: catch DBus errors and report if GDM is not available">attachment 223657</a> <a href="attachment.cgi?id=223657&amp;action=edit" title="ShellUserVerifier: catch DBus errors and report if GDM is not available">[details]</a></span> <a href="review?bug=683060&amp;attachment=223657">[review]</a>
ShellUserVerifier: catch DBus errors and report if GDM is not available

Instead of leaving the login or unlock dialogs in an inconsistent state,
report that GDM is not available to the user. For the unlock dialog,
we additionally unlock automatically.

Matthias: is this what you mean by option 1, more or less?</pre>
</div><div class="bz_comment" id="c25">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c25">Comment 25</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 15:32:56 UTC
        </span>
</div>
<pre class="bz_comment_text">More or less, though this doesn't address the situation when gdm is not installed at all, right ? I mean, the import will blow up ?</pre>
</div><div class="bz_comment" id="c26">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c26">Comment 26</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 15:35:27 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c25">comment #25</a>)
<span class="quote">&gt; More or less, though this doesn't address the situation when gdm is not
&gt; installed at all, right ? I mean, the import will blow up ?</span>

Yes, but AFAUI, the gdm package is already split in a daemon and a library part, and there is no problem for gnome-shell to depend on libgdm.</pre>
</div><div class="bz_comment" id="c27">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c27">Comment 27</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Florian Müllner</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-06 15:52:35 UTC
        </span>
</div>
<pre class="bz_comment_text">I agree - we actually started to have a runtime (in the sense of "gdm needs to be installed in order to run the shell", not "we depend on gdm running") dependency on libgdm a bit before the lock screen work.</pre>
</div><div class="bz_comment" id="c28">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c28">Comment 28</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 07:48:31 UTC
        </span>
</div>
<pre class="bz_comment_text">*** <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683693" title="RESOLVED DUPLICATE - fall back to gnome-screensaver when a fault occurs">Bug 683693</a> has been marked as a duplicate of this bug. ***</pre>
</div><div class="bz_comment" id="c29">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c29">Comment 29</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nguyen Thai Ngoc Duy</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 09:32:47 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c22">comment #22</a>)
<span class="quote">&gt; All of this is obviously entirely out of reach for 3.6. For 3.6, I would
&gt; suggest that we explore 2 things:
&gt; 
&gt; - Make gnome-shell cope with gdm not being available and just disable screen
&gt; locking functionality in this case
&gt; 
&gt; - Make gnome-shell fall back to using gnome-screensaver for locking when the
&gt; gdm authentication interface is not available</span>

I think we need one of these options anyway in case gdm becomes broken after the shell is started, or some shell extensions interfere with lockscreen code and the shell can no longer communicate with gdm.

For the latter case, at least make it an option to break through the lock screen. It'd be useful during shell extension development.</pre>
</div><div class="bz_comment" id="c30">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c30">Comment 30</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 09:38:11 UTC
        </span>
</div>
<pre class="bz_comment_text">If gdm becomes broken (in the sense of crashing), the X server will go down, and take the session with it.
As far as shell extensions are concerned, since 3.5.91 they're disabled in the lock screen and unlock dialog, so they should not be a problem.</pre>
</div><div class="bz_comment" id="c31">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c31">Comment 31</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nguyen Thai Ngoc Duy</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 10:07:07 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c30">comment #30</a>)
<span class="quote">&gt; If gdm becomes broken (in the sense of crashing), the X server will go down,
&gt; and take the session with it.</span>

I can kill gdm process while gdm-simple-slave is still running (I don't know which one is talking to gnome-shell though). There could also be bugs in gdm that makes it stop responding to gnome-shell. The same applies to gnome-shell's bugs (that affects certain parts of the shell but not as a whole).

<span class="quote">&gt; As far as shell extensions are concerned, since 3.5.91 they're disabled in the
&gt; lock screen and unlock dialog, so they should not be a problem.</span>

In the context of extension development, the extension can leave some hooks in place when it is asked to be disabled. That can happen before lock screen is on and affect the lock screen.</pre>
</div><div class="bz_comment" id="c32">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c32">Comment 32</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 12:43:51 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c26">comment #26</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=683060#c25">comment #25</a>)
&gt; &gt; More or less, though this doesn't address the situation when gdm is not
&gt; &gt; installed at all, right ? I mean, the import will blow up ?
&gt; 
&gt; Yes, but AFAUI, the gdm package is already split in a daemon and a library
&gt; part, and there is no problem for gnome-shell to depend on libgdm.</span>

Ok, good enough for me.</pre>
</div><div class="bz_comment" id="c33">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c33">Comment 33</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">William Jon McCann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 17:09:45 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=223934" name="attach_223934" title="screenshot">attachment 223934</a> <a href="attachment.cgi?id=223934&amp;action=edit" title="screenshot">[details]</a></span>
screenshot

This is what I get with this patch applied.

I think this is unacceptable for a few reasons.

1. The screen shield indicates that the screen is locked (even has a lock icon) when it is actually not locked. This is a big problem because it is a false sense of security.

2. Locks should never "fail open". If something goes wrong you should never pop open a lock.

3. The notification is unacceptable. It mentions implementation details (is almost entirely details), the "subject" line doesn't fit in the banner size, strange choice of icon, etc.

4. Doesn't seem to differentiate the case where the lock is supposed to work from the case where it fails unexpectedly.


I think there are at least two very different cases. Failure in a compatible OS and failure in an incompatible OS.

Basically, if the correct versions of all subsystems are present (ie. the OS is properly built) then we should consider a failure catastrophic. Basically fail-whale. You should never fail-open in this case. That would be a huge security hole. In GNOME 2 we always failed-closed in this case and we should continue to do that, I think. For the normal user this probably means the system "crashed" and a reboot is necessary - including doing whatever recovery/failsafe stuff the OS provides as needed. For the expert user this means killing and restarting components manually as is typical.

The other case is the one I have when I run jhbuild gnome-shell on top of, say, Fedora 17. Which is exactly the same scenario as running gnome-shell on top of say, Ubuntu. In this case we know that locking is never going to work. So we should act as if locking is disabled. We should not show a lock icon in the screen shield and not respond to control-alt-L or whatever the lock shortcut is. We should remove the Lock item from the user menu. etc.</pre>
</div><div class="bz_comment" id="c34">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c34">Comment 34</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Tom Wijsman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-10 22:50:29 UTC
        </span>
</div>
<pre class="bz_comment_text">Currently experiencing this as well; while I can't reasonably add to this detailed discussion, I'll shortly tell you my experience:

1. Can't start gdm due to DEBUG(+): Lost GDM name on bus

2. Removed gdm from runlevels, I run `startx` conditionally in .bashrc now.

3. Upon trying to type the password, I can _see_ the password and can't press the button to check the password.

4. Pressing ESC at this point just kills the locking screen itself as well, leaving me on a gray-ish shell screen... o_O

Bottom line of the story, I'm experiencing three bugs here disallowing me from locking unless I force `xscreensaver` to kick in, but that leaves my TTY1 wide open because I run `startx` from there.

What also bothers me is that locking no longer shows me my `xscreensaver`, which I'd rather like to see than a static background...

Sad to hear other DMs wouldn't be supported, some people prefer a lightweight Slim or some console based login (better than my .bashrc approach). Although I don't really mind it myself as I'd use gdm; going to try to file a bug for that now as well and then will file a bug for the "ESC kills lock screen" and "where's my sreen saver?" too...

An approach that doesn't require the daemon running sounds nice, as that gives the users freedom (the reason I'm running Gentoo for) and doesn't force you down certain parts of the OS; but feel free to pursue a solution that fits security better, because that on its own is of importance as well, seems the typical advantages / drawbacks weighting. Hope you can find the best of both worlds, thanks for discussing this, couldn't find this bug for a while...</pre>
</div><div class="bz_comment" id="c35">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c35">Comment 35</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-11 11:02:53 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=224011" name="attach_224011" title="Allow the shell to run without the screenshield">attachment 224011</a> <a href="attachment.cgi?id=224011&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224011">[review]</a>
Allow the shell to run without the screenshield

The screenshield requires gdm 3.5, which can be problematic in
jhbuild configurations, or distributions that don't use GDM as the display
manager. Allow transparent fallback to gnome-screensaver in that case.

This is an old patch from the first screen lock iteration, reworked to do
runtime detection of gdm. Requires a new DBus property, 'Version', not yet
merged, and therefore will cause fallback on all testers using GDM from the
distro (including those on Fedora 18).
Also, it uses synchronous DBus at startup to find if the screenshield is
supported. Unfortunately, I'm not sure it's possible to avoid that, without
another mass rework of the various interdependencies between shell components.
I've added a comment and hope that distros not planning to support anything
but gdm (including gnome-ostree) will patch isSupported() to return true without
further checks.</pre>
</div><div class="bz_comment" id="c36">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c36">Comment 36</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jeremy Bicha</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-11 13:38:06 UTC
        </span>
</div>
<pre class="bz_comment_text">I admit that I don't understand the downsides of enabling basic lock support even if the user isn't running GDM. Why though are you recommending distros to remove that support?</pre>
</div><div class="bz_comment" id="c37">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c37">Comment 37</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-11 13:42:58 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c36">comment #36</a>)
<span class="quote">&gt; I admit that I don't understand the downsides of enabling basic lock support
&gt; even if the user isn't running GDM. Why though are you recommending distros to
&gt; remove that support?</span>

1) I'm not disabling basic lock support, I'm disabling integrated lock support in gnome-shell. If you (user, distro) want to have locking without GDM, you can use gnome-screensaver, like 3.4

2) I'm not recommending distros to patch isSupported() to return false, I'm recommending them to return true, so that we avoid useless sync IO in the common case and we give the user the full integrated 3.6 experience.</pre>
</div><div class="bz_comment" id="c38">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c38">Comment 38</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Tom Wijsman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-11 16:23:00 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c35">comment #35</a>)
<span class="quote">&gt; Created an attachment (id=224011) [details] [review]
&gt; Allow the shell to run without the screenshield</span>

This patch doesn't allow me to use the Gnome shell because it simply doesn't appear, I only get to see my background after executing `startx`. When I switch back to TTY1 I see as error that Main.screenShield.connect doesn't exist. I suppose your Fallback doesn't implement that function yet...</pre>
</div><div class="bz_comment" id="c39">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c39">Comment 39</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-13 13:49:35 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=224226" name="attach_224226" title="Allow the shell to run without the screenshield">attachment 224226</a> <a href="attachment.cgi?id=224226&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224226">[review]</a>
Allow the shell to run without the screenshield

The screenshield requires gdm 3.5, which can be problematic in
jhbuild configurations, or distributions that don't use GDM as the display
manager. Allow transparent fallback to gnome-screensaver in that case.</pre>
</div><div class="bz_comment" id="c40">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c40">Comment 40</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-14 00:24:30 UTC
        </span>
</div>
<pre class="bz_comment_text">*** <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683757" title="RESOLVED DUPLICATE - Pressing ESC on Lock Screen hides / kills the lock screen, can't do anything anymore.">Bug 683757</a> has been marked as a duplicate of this bug. ***</pre>
</div><div class="bz_comment" id="c41">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c41">Comment 41</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-15 04:44:35 UTC
        </span>
</div>
<pre class="bz_comment_text">we should get this reviewed and landed for .92 on Monday</pre>
</div><div class="bz_comment" id="c42">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c42">Comment 42</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-15 05:28:17 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=224226" name="attach_224226" title="Allow the shell to run without the screenshield">attachment 224226</a> <a href="attachment.cgi?id=224226&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224226">[review]</a>:

::: js/ui/main.js
@@ +141,3 @@
+    if (UnlockDialog.isSupported()) {
+        screenShield = new ScreenShield.ScreenShield();
+        screenSaverDBus = new ShellDBus.ScreenSaverDBus();

To me, screenSaverDBus should be contained and constructed by the ScreenShield.

(and ExtensionSystemDBus should be contained constructed by the ExtensionSystem, but that's another patch)

::: js/ui/unlockDialog.js
@@ +50,3 @@
+
+        let version = result.deep_unpack()[0].deep_unpack();
+function isSupported() {

I don't understand this. Why are we comparing versions?</pre>
</div><div class="bz_comment" id="c43">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c43">Comment 43</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-15 13:30:58 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c42">comment #42</a>)
<span class="quote">&gt; Review of <span class="bz_obsolete"><a href="attachment.cgi?id=224226" name="attach_224226" title="Allow the shell to run without the screenshield">attachment 224226</a> <a href="attachment.cgi?id=224226&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224226">[review]</a>:
&gt; 
&gt; ::: js/ui/main.js
&gt; @@ +141,3 @@
&gt; +    if (UnlockDialog.isSupported()) {
&gt; +        screenShield = new ScreenShield.ScreenShield();
&gt; +        screenSaverDBus = new ShellDBus.ScreenSaverDBus();
&gt; 
&gt; To me, screenSaverDBus should be contained and constructed by the ScreenShield.
&gt; 
&gt; (and ExtensionSystemDBus should be contained constructed by the
&gt; ExtensionSystem, but that's another patch)
&gt; 
&gt; ::: js/ui/unlockDialog.js
&gt; @@ +50,3 @@
&gt; +
&gt; +        let version = result.deep_unpack()[0].deep_unpack();
&gt; +function isSupported() {
&gt; 
&gt; I don't understand this. Why are we comparing versions?</span>

Because 3.5.4 or less doesn't support OpenReauthenticationChannel, so jhbuild on currently stable distros would fail.
It's true that before 3.5.92 there is no Version property at all, so the actual comparison is moot, but it seemed cleaner to me to have a full Version property and check it, rather than some "ApiVersion" or "IsReauthSupported"</pre>
</div><div class="bz_comment" id="c44">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c44">Comment 44</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-15 15:01:53 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=224412" name="attach_224412" title="Allow the shell to run without the screenshield">attachment 224412</a> <a href="attachment.cgi?id=224412&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224412">[review]</a>
Allow the shell to run without the screenshield

The screenshield requires gdm 3.5, which can be problematic in
jhbuild configurations, or distributions that don't use GDM as the display
manager. Allow transparent fallback to gnome-screensaver in that case.</pre>
</div><div class="bz_comment" id="c45">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c45">Comment 45</a>
</span>
<span class="bz_comment_user">
<span class="vcard">drago01
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 07:14:51 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=224412" name="attach_224412" title="Allow the shell to run without the screenshield">attachment 224412</a> <a href="attachment.cgi?id=224412&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224412">[review]</a>:

::: js/ui/unlockDialog.js
@@ +38,3 @@
+function isSupported() {
+    // DISTROS: please patch this away, it's a awful hack to allow
+    // running without GDM

I hate this ... can't we have a configure option instead of asking distros to patch the code?</pre>
</div><div class="bz_comment" id="c46">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c46">Comment 46</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 14:11:16 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c45">comment #45</a>)
<span class="quote">&gt; Review of <span class="bz_obsolete"><a href="attachment.cgi?id=224412" name="attach_224412" title="Allow the shell to run without the screenshield">attachment 224412</a> <a href="attachment.cgi?id=224412&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224412">[review]</a>:
&gt; 
&gt; ::: js/ui/unlockDialog.js
&gt; @@ +38,3 @@
&gt; +function isSupported() {
&gt; +    // DISTROS: please patch this away, it's a awful hack to allow
&gt; +    // running without GDM
&gt; 
&gt; I hate this ... can't we have a configure option instead of asking distros to
&gt; patch the code?</span>

How is a non-default (thus untested) config option different from a downstream patch? And at least, if it's a patch we don't appear to support it...</pre>
</div><div class="bz_comment" id="c47">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c47">Comment 47</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 17:13:13 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c46">comment #46</a>)

<span class="quote">&gt; How is a non-default (thus untested) config option different from a downstream
&gt; patch? And at least, if it's a patch we don't appear to support it...</span>

Shipping the code in the first place seems to be a pretty clear statement about supporting it...</pre>
</div><div class="bz_comment" id="c48">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c48">Comment 48</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 17:18:20 UTC
        </span>
</div>
<pre class="bz_comment_text">In fact, I was referring to the opposite (a patch or configuration option to remove that code), so yeah, it didn't make much sense in retrospect.
Still, I don't think a configuration option is right. I'll just remove the comment.</pre>
</div><div class="bz_comment" id="c49">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c49">Comment 49</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 17:19:14 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=224653" name="attach_224653" title="Allow the shell to run without the screenshield">attachment 224653</a> <a href="attachment.cgi?id=224653&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224653">[review]</a>
Allow the shell to run without the screenshield

The screenshield requires gdm 3.5, which can be problematic in
jhbuild configurations, or distributions that don't use GDM as the display
manager. Allow transparent fallback to gnome-screensaver in that case.</pre>
</div><div class="bz_comment" id="c50">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c50">Comment 50</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 17:48:44 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=224656" name="attach_224656" title="ShellUserVerifier: catch DBus errors and report them to the user">attachment 224656</a> <a href="attachment.cgi?id=224656&amp;action=edit" title="ShellUserVerifier: catch DBus errors and report them to the user">[details]</a></span> <a href="review?bug=683060&amp;attachment=224656">[review]</a>
ShellUserVerifier: catch DBus errors and report them to the user

Instead of leaving the login or unlock dialogs in an inconsistent state,
catch DBus errors and show an Authentication Error message. The error
details are logged in the session logs.

This one is not strictly necessary if the other one lands, but it
provides a better experience for other errors, IMHO. In particular it
could help for transient GDM failures like those in <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=684172" title="RESOLVED OBSOLETE - Sometimes no password prompt at unlock screen">bug 684172</a>.
Breaks string freeze (new string "Authentication error").</pre>
</div><div class="bz_comment" id="c51">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c51">Comment 51</a>
</span>
<span class="bz_comment_user">
<span class="vcard">drago01
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 17:58:40 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=224653" name="attach_224653" title="Allow the shell to run without the screenshield">attachment 224653</a> <a href="attachment.cgi?id=224653&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224653">[review]</a>:

OK we should go with that one for now. Code looks good.</pre>
</div><div class="bz_comment" id="c52">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c52">Comment 52</a>
</span>
<span class="bz_comment_user">
<span class="vcard">drago01
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 18:00:49 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=224656" name="attach_224656" title="ShellUserVerifier: catch DBus errors and report them to the user">attachment 224656</a> <a href="attachment.cgi?id=224656&amp;action=edit" title="ShellUserVerifier: catch DBus errors and report them to the user">[details]</a></span> <a href="review?bug=683060&amp;attachment=224656">[review]</a>:

Code looks good not sure about the strings though (need i18n approval and maybe a review by the designers).</pre>
</div><div class="bz_comment" id="c53">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c53">Comment 53</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 18:26:25 UTC
        </span>
</div>
<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=224653" name="attach_224653" title="Allow the shell to run without the screenshield">attachment 224653</a> <a href="attachment.cgi?id=224653&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> <a href="review?bug=683060&amp;attachment=224653">[review]</a>
Allow the shell to run without the screenshield

<span class=""><a href="attachment.cgi?id=224653" name="attach_224653" title="Allow the shell to run without the screenshield">Attachment 224653</a> <a href="attachment.cgi?id=224653&amp;action=edit" title="Allow the shell to run without the screenshield">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-shell/commit/?id=de93677">de93677</a> - Allow the shell to run without the screenshield
I'll send a freeze break request for the other patch.</pre>
</div><div class="bz_comment" id="c54">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c54">Comment 54</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 18:55:57 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=224661" name="attach_224661" title="New screenshot">attachment 224661</a> <a href="attachment.cgi?id=224661&amp;action=edit" title="New screenshot">[details]</a></span>
New screenshot</pre>
</div><div class="bz_comment" id="c55">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c55">Comment 55</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Tom Wijsman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 19:52:31 UTC
        </span>
</div>
<pre class="bz_comment_text">This patch worked fine when I was running without gdm, but now that I fixed my gdm this patch broke it for me because it couldn't find a certain function right before the gdb login kicks in so I had to undo this patch. Dunno what the function was called (didn't write it down, can't find it in any logs) but I would advise you to test this patch on gdm as well.</pre>
</div><div class="bz_comment" id="c56">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c56">Comment 56</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 19:59:52 UTC
        </span>
</div>
<pre class="bz_comment_text">This patch is tested in gdm, but you need 3.5.92 for the new Version DBus property.</pre>
</div><div class="bz_comment" id="c57">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c57">Comment 57</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Tom Wijsman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 20:05:32 UTC
        </span>
</div>
<pre class="bz_comment_text">Found it...

gnome-session[2103]: DEBUG(+): GsmDBusClient: obj_path=/org/gnome/SessionManager/Presence interface=org.freedesktop.DBus.Properties method=GetAll     JS ERROR: !!!   Exception was: TypeError: screenShield.showDialog is not a function     JS ERROR: !!!     message = '"screenShield.showDialog is not a function"'     JS ERROR: !!!     fileName = '"/usr/share/gnome-shell/js/ui/main.js"'     JS ERROR: !!!     lineNumber = '94'     JS ERROR: !!!     stack = '"createGDMSession()@/usr/share/gnome-shell/js/ui/main.js:94 ()@/usr/share/gnome-shell/js/ui/sessionMode.js:85 wrapper()@/usr/share/gjs-1.0/lang.js:204 start()@/usr/share/gnome-shell/js/ui/main.js:225 @&lt;main&gt;:1 "' Window manager warning: Log level 32: Execution of main.js threw exception: TypeError: screenShield.showDialog is not a function</pre>
</div><div class="bz_comment" id="c58">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c58">Comment 58</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Tom Wijsman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 20:07:13 UTC
        </span>
</div>
<pre class="bz_comment_text">This looks more like a JS error than a DBus error to me, so you might want to verify... If it is indeed fixed upstream, nvm my previous comment then.</pre>
</div><div class="bz_comment" id="c59">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c59">Comment 59</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 20:13:38 UTC
        </span>
</div>
<pre class="bz_comment_text">It's kind of both... It's a DBus error that triggers ScreenShieldFallback, but that's not prepared to handle a GDM greeter (there is no showDialog() method), so it fails again with a JS error.
Please test again with gdm 3.5.92.</pre>
</div><div class="bz_comment" id="c60">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c60">Comment 60</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthias Clasen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 22:47:32 UTC
        </span>
</div>
<pre class="bz_comment_text">Giovanni, how does the latest patch compare to Jon's concerns in <a href="show_bug.cgi?id=683060#c33">comment 33</a> ?
Also, I was a little confused that the screenshot seems to show just the regular authentication failure ?</pre>
</div><div class="bz_comment" id="c61">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c61">Comment 61</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 23:03:55 UTC
        </span>
</div>
<pre class="bz_comment_text">Well, with the latest patch we fail in a controlled way, and this allows us to keep the screen locked, so we "fail close" if you want.
Also, we now differentiate cases where it's not supported (missing or wrong GDM on the bus) and cases where it failed for bugs, and only show this message in the latter case. I also remove all technical details from the message, leaving just "Authentication error".

I considered invoking the fail whale explicitly, but short of adding another method on the session bus, there is no way at the moment ("crashing" the shell will simply spawn another one), so this seemed the easiest way for 3.6.</pre>
</div><div class="bz_comment" id="c62">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c62">Comment 62</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 23:24:19 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c61">comment #61</a>)
<span class="quote">&gt; Well, with the latest patch we fail in a controlled way, and this allows us to
&gt; keep the screen locked, so we "fail close" if you want.</span>

So if you aren't running GDM and the screen locks, it's impossible to open it back up, or? Should the screen saver pop back up? What's "Authentication error" for?</pre>
</div><div class="bz_comment" id="c63">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c63">Comment 63</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 23:42:04 UTC
        </span>
</div>
<pre class="bz_comment_text">No, if you aren't running GDM we hit the fallback path. This is only for unexpected failures, and yes, in that case there is no way to open it except by going to a VT and killing the shell.</pre>
</div><div class="bz_comment" id="c64">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c64">Comment 64</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Florian Müllner</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-18 23:56:48 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c63">comment #63</a>)
<span class="quote">&gt; in that case there is no way to open it except by going to a VT and killing the shell.</span>

That is not really what the string suggests though - it sounds a lot like "You mistyped your password, try again".
(No better suggestion from my side at this point unfortunately)</pre>
</div><div class="bz_comment" id="c65">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c65">Comment 65</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Giovanni Campagna</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-19 00:00:59 UTC
        </span>
</div>
<pre class="bz_comment_text">Well, the error is from initialization of the conversation, so slowness aside it's shown well before the password is inputted, and that should clarify that it's not a user error.</pre>
</div><div class="bz_comment" id="c66">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c66">Comment 66</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Florian Müllner</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-19 00:02:28 UTC
        </span>
</div>
<pre class="bz_comment_text">Ah, sounds good to me then.</pre>
</div><div class="bz_comment" id="c67">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c67">Comment 67</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Florian Müllner</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-09-19 10:07:12 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class=""><a href="attachment.cgi?id=224656" name="attach_224656" title="ShellUserVerifier: catch DBus errors and report them to the user">Attachment 224656</a> <a href="attachment.cgi?id=224656&amp;action=edit" title="ShellUserVerifier: catch DBus errors and report them to the user">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-shell/commit/?id=10884ef">10884ef</a> - ShellUserVerifier: catch DBus errors and report them to the user

Got string freeze approval, pushing.</pre>
</div><div class="bz_comment" id="c68">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c68">Comment 68</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-18 23:47:25 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=226782" name="attach_226782" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226782</a> <a href="attachment.cgi?id=226782&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226782">[review]</a>
screenShield: explicitly load gnome-screensaver in fallback mode.

When running gnome-shell from lightDM, gnome-screensaver is no
longer auto-loaded. As a result the dbus calls for Lock user etc
will fail.</pre>
</div><div class="bz_comment" id="c69">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c69">Comment 69</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-18 23:49:35 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=226783" name="attach_226783" title="Move gnome-screensaver to the fallback session.">attachment 226783</a> <a href="attachment.cgi?id=226783&amp;action=edit" title="Move gnome-screensaver to the fallback session.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226783">[review]</a>
Move gnome-screensaver to the fallback session.</pre>
</div><div class="bz_comment" id="c70">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c70">Comment 70</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-18 23:51:58 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=226784" name="attach_226784" title="move gnome-screensaver desktop file out of autostart">attachment 226784</a> <a href="attachment.cgi?id=226784&amp;action=edit" title="move gnome-screensaver desktop file out of autostart">[details]</a></span> <a href="review?bug=683060&amp;attachment=226784">[review]</a>
move gnome-screensaver desktop file out of autostart</pre>
</div><div class="bz_comment" id="c71">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c71">Comment 71</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-18 23:54:07 UTC
        </span>
</div>
<pre class="bz_comment_text">When running gnome-shell with lightdm, gnome-screensaver never gets auto-started. As a result the fallback code in screenShield, fails trying to make
dbus calls. 

As was suggested by halfline on IRC, I have moved gnome-screensaver into the fallback session (removing autostart) and made the fallback code in screenshield explicitly launch gnome-screensaver.</pre>
</div><div class="bz_comment" id="c72">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c72">Comment 72</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 06:17:39 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=226790" name="attach_226790" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226790</a> <a href="attachment.cgi?id=226790&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226790">[review]</a>
screenShield: explicitly load gnome-screensaver in fallback mode.

When running gnome-shell from lightDM, gnome-screensaver is no
longer auto-loaded. As a result the dbus calls for Lock user etc
will fail.

This is an alternate patch that uses spawn instead, so it doesnt
depend on the gnome-session changes.</pre>
</div><div class="bz_comment" id="c73">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c73">Comment 73</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 07:19:11 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=226795" name="attach_226795" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226795</a> <a href="attachment.cgi?id=226795&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226795">[review]</a>
screenShield: explicitly load gnome-screensaver in fallback mode.

When running gnome-shell from lightDM, gnome-screensaver is no
longer auto-loaded. As a result the dbus calls for Lock user etc
will fail.

<a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683060" title="RESOLVED FIXED - Impossible to unlock screen if not using GDM">https://bugzilla.gnome.org/show_bug.cgi?id=683060</a>
Bug-Ubuntu: <a href="https://launchpad.net/bugs/1064354">https://launchpad.net/bugs/1064354</a></pre>
</div><div class="bz_comment" id="c74">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c74">Comment 74</a>
</span>
<span class="bz_comment_user">
<span class="vcard">darkxst
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 07:21:17 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=226796" name="attach_226796" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226796</a> <a href="attachment.cgi?id=226796&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226796">[review]</a>
screenShield: explicitly load gnome-screensaver in fallback mode.

When running gnome-shell from lightDM, gnome-screensaver is no
longer auto-loaded. As a result the dbus calls for Lock user etc
will fail.

<a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=683060" title="RESOLVED FIXED - Impossible to unlock screen if not using GDM">https://bugzilla.gnome.org/show_bug.cgi?id=683060</a>
Bug-Ubuntu: <a href="https://launchpad.net/bugs/1064354">https://launchpad.net/bugs/1064354</a></pre>
</div><div class="bz_comment" id="c75">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c75">Comment 75</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:34:13 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=226783" name="attach_226783" title="Move gnome-screensaver to the fallback session.">attachment 226783</a> <a href="attachment.cgi?id=226783&amp;action=edit" title="Move gnome-screensaver to the fallback session.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226783">[review]</a>:

sure</pre>
</div><div class="bz_comment" id="c76">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c76">Comment 76</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:34:46 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=226784" name="attach_226784" title="move gnome-screensaver desktop file out of autostart">attachment 226784</a> <a href="attachment.cgi?id=226784&amp;action=edit" title="move gnome-screensaver desktop file out of autostart">[details]</a></span> <a href="review?bug=683060&amp;attachment=226784">[review]</a>:

looks right</pre>
</div><div class="bz_comment" id="c77">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c77">Comment 77</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:42:18 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=226796" name="attach_226796" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226796</a> <a href="attachment.cgi?id=226796&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226796">[review]</a>:

::: js/ui/screenShield.js
@@ +847,2 @@
     _init: function() {
+        Util.spawn(['gnome-screensaver']);

Probably okay, though:

let app = Shell.AppSystem.get_default().lookup_app('gnome-screensaver.desktop');
app.activate();

might be slightly nicer. hard to say. I guess we don't need app window tracking or startup notification or anything, so maybe not.</pre>
</div><div class="bz_comment" id="c78">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c78">Comment 78</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Jasper St. Pierre (not reading bugmail)</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:46:32 UTC
        </span>
</div>
<pre class="bz_comment_text">Why not just remove the DO_NOT_AUTO_START?</pre>
</div><div class="bz_comment" id="c79">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c79">Comment 79</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:48:38 UTC
        </span>
</div>
<pre class="bz_comment_text">it's not dbus activatable (intentionally)</pre>
</div><div class="bz_comment" id="c80">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c80">Comment 80</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Florian Müllner</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 15:52:23 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=683060#c77">comment #77</a>)
<span class="quote">&gt; Review of <span class=""><a href="attachment.cgi?id=226796" name="attach_226796" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226796</a> <a href="attachment.cgi?id=226796&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226796">[review]</a>:
&gt; 
&gt; ::: js/ui/screenShield.js
&gt; @@ +847,2 @@
&gt;      _init: function() {
&gt; +        Util.spawn(['gnome-screensaver']);
&gt; 
&gt; Probably okay, though:
&gt; 
&gt; let app =
&gt; Shell.AppSystem.get_default().lookup_app('gnome-screensaver.desktop');
&gt; app.activate();
&gt; 
&gt; might be slightly nicer.</span>

That's what <span class="bz_obsolete"><a href="attachment.cgi?id=226782" name="attach_226782" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226782</a> <a href="attachment.cgi?id=226782&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226782">[review]</a> did. We could go with that for master and commit <span class=""><a href="attachment.cgi?id=226796" name="attach_226796" title="screenShield: explicitly load gnome-screensaver in fallback mode.">attachment 226796</a> <a href="attachment.cgi?id=226796&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> <a href="review?bug=683060&amp;attachment=226796">[review]</a> on gnome-3-6 (so we don't require new releases for gnome-screensaver and gnome-session when doing a 3.6.2 release)</pre>
</div><div class="bz_comment" id="c81">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c81">Comment 81</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-19 16:37:32 UTC
        </span>
</div>
<pre class="bz_comment_text">That'd be fine, or we could just use Util.spawn() for both, since it seems just as good here.</pre>
</div><div class="bz_comment" id="c82">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c82">Comment 82</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-22 15:20:14 UTC
        </span>
</div>
<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=226784" name="attach_226784" title="move gnome-screensaver desktop file out of autostart">attachment 226784</a> <a href="attachment.cgi?id=226784&amp;action=edit" title="move gnome-screensaver desktop file out of autostart">[details]</a></span> <a href="review?bug=683060&amp;attachment=226784">[review]</a>
move gnome-screensaver desktop file out of autostart

<span class=""><a href="attachment.cgi?id=226784" name="attach_226784" title="move gnome-screensaver desktop file out of autostart">Attachment 226784</a> <a href="attachment.cgi?id=226784&amp;action=edit" title="move gnome-screensaver desktop file out of autostart">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-shell/commit/?id=1940dc6">1940dc6</a> - move gnome-screensaver desktop file out of autostart</pre>
</div><div class="bz_comment" id="c83">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=683060#c83">Comment 83</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Ray Strode [halfline]</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2012-10-22 15:21:55 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class=""><a href="attachment.cgi?id=226796" name="attach_226796" title="screenShield: explicitly load gnome-screensaver in fallback mode.">Attachment 226796</a> <a href="attachment.cgi?id=226796&amp;action=edit" title="screenShield: explicitly load gnome-screensaver in fallback mode.">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/gnome-shell/commit/?id=418cf62">418cf62</a> - screenShield: explicitly load gnome-screensaver in fallback mode.</pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=gnome-shell">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=683060&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=683060" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=683060&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626120293-8VbRW-VDPM4GilHdqvwz1HD6nmJHm14xPJqW-n7MC6U"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>