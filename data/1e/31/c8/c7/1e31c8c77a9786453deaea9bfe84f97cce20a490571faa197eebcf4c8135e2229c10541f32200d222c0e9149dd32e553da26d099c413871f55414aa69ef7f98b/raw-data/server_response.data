<!DOCTYPE html>
<html lang="en">
  <head>
    <title>70551 &ndash; kernel crash on ath9k under heavy load</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/51af664f3910b417cf7544987d29336d.css" rel="stylesheet" type="text/css">



      

    
<script type="text/javascript" src="data/assets/aae018547291cb399f8ae4d70aa29abc.js"></script>

    <script type="text/javascript">
    <!--
          YAHOO.namespace('bugzilla');
          YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
              if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
              var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
              return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
          };
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }

        
        function unhide_language_selector() {
            $('#lang_links_container').removeClass('bz_default_hidden');
        } 
        $(document).ready(unhide_language_selector);

        // This sets the default parameters for all calendar fields.
        $.datepicker.setDefaults({
            dateFormat: "yy-mm-dd", // this is the YYYY-MM-DD format
            showButtonPanel: true,  // permits to easily select "Today"
            // These 3 parameters are useful for localization.
            firstDay: 0,            // 0 = Sunday, 1 = Monday, etc...
            dayNamesMin: [ "Su", "Mo", "Tu", "We", "Th", "Fr", "Sa" ],
            monthNames: [ "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" ]
        });

        
        var BUGZILLA = {
            param: {
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };


    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "70551 – kernel crash on ath9k under heavy load",
                             "show_bug.cgi?id=70551" );
        document.title = "70551 – kernel crash on ath9k under heavy load";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "70551 – kernel crash on ath9k under heavy load", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/b0e9f412b1f97bb1ae7ecfce91ab62bb.js"></script>

    
    <!--[if lt IE 9]>
      <script>
        document.createElement('header');
        document.createElement('nav');
        document.createElement('main');
        document.createElement('footer');
      </script>
    <![endif]-->

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Kernel.org Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><meta name="robots" content="noarchive">
  </head>

  <body 
        class="bugzilla-kernel-org
                 bz_bug
                 bz_status_CLOSED
                 bz_product_Drivers
                 bz_component_network-wireless
                 bz_bug_70551 yui-skin-sam">

  <header id="header"><div id="banner">
  </div>

    <div id="titles">
      <span id="title">Kernel.org Bugzilla &ndash; Bug&nbsp;70551</span>

        <span id="subtitle" class="subheader">kernel crash on ath9k under heavy load</span>

        <span id="information" class="header_addl_info">Last modified: 2014-12-12 14:50:04 UTC</span>
    </div>


    <nav id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/latest/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=70551&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=70551" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="createaccount.cgi?request_new_password=1"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="email" size="20" id="login_top" required
             type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password"
             type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635622229-_Hu5cbjJZHDQIeMtm3Z_6Rx8kF-jRWERq2a7ymn-SQk">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </nav>
  </header>

  <main role="main" id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2014-12-12 14:50:04">
  <input type="hidden" name="id" value="70551">
  <input type="hidden" name="token" value="1635622229-8B9MCgHlDNewtKNLBN9GGbVX-NoNdiqm28zYn2iLruo">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=70551"><b>Bug&nbsp;70551</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">kernel crash on ath9k under heavy load</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>kernel crash on ath9k under heavy load
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'kernel crash on ath9k under heavy load' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">
        <table>
          <tr id="field_tablerow_status">
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">CLOSED
          CODE_FIX
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr id="field_tablerow_alias"><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr id="field_tablerow_product"><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Drivers

</td>
    </tr>

    
    <tr id="field_tablerow_classification" class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
    
    
    
    <tr id="field_tablerow_component"><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Drivers"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >network-wireless

  (<a href="buglist.cgi?component=network-wireless&amp;product=Drivers&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    
    
    
    <tr id="field_tablerow_rep_platform"><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">i386
        Linux
      </td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          <tr id="field_tablerow_importance">
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P1
       high
      </td>
    </tr>

          <tr id="field_tablerow_assigned_to"><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">drivers_network-wireless&#64;kernel-bugs.osdl.org</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'drivers_network-wireless\x40kernel-bugs.osdl.org',
        '');
    </script>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr id="field_tablerow_bug_file_loc"><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>


    <tr id="field_tablerow_keywords"><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr id="field_tablerow_dependson"><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>

  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>

        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr id="field_tablerow_reported">
    <th class="field_label">
      Reported:
    </th>
    <td>2014-02-13 23:58 UTC by <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
    </td>
  </tr>

  <tr id="field_tablerow_modified">
    <th class="field_label">
      Modified:
    </th>
    <td>2014-12-12 14:50 UTC
      (<a href="show_activity.cgi?id=70551">History</a>)
    </td>

  </tr>
<tr id="field_tablerow_cclist">
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>4
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="ath9k-devel">ath9k-devel</option>
                <option value="linville">linville</option>
                <option value="maxim.stargazer">maxim.stargazer</option>
                <option value="stf_xl">stf_xl</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container',
                               'cc_edit_area',
                               'cc_edit_area_showhide',
                               '',
                               '');
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr id="field_tablerow_see_also"><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr>
<tr>
      <th class="field_label "
    id="field_label_cf_kernel_version">


  <a 
      title="A custom Free Text field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_kernel_version"
  >Kernel Version:</a>

</th>
  <td class="field_value "
      id="field_container_cf_kernel_version" >3.12.9

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_tree">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_tree"
  >Tree:</a>

</th>
  <td class="field_value "
      id="field_container_cf_tree" >Mainline

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_regression">


  <a 
      title="A custom Drop Down field in this installation of Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_regression"
  >Regression:</a>

</th>
  <td class="field_value "
      id="field_container_cf_regression" >No

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_x-xz">
        <td>
            <a href="attachment.cgi?id=126001"
               title="View the content of the attachment">
          <b>tarball with crashtool output for crashes and kernel config
          </b></a>

          <span class="bz_attach_extra_info">
              (52.46 KB,
                application/x-xz)

            <br>
            <a href="#attach_126001"
               title="Go to the comment associated with the attachment">2014-02-13 23:58 UTC</a>,

            <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=126001&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=126151"
               title="View the content of the attachment">
          <b>ath9k_protect_tid_list.patch
          </b></a>

          <span class="bz_attach_extra_info">
              (640 bytes,
                text/plain)

            <br>
            <a href="#attach_126151"
               title="Go to the comment associated with the attachment">2014-02-14 19:52 UTC</a>,

            <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=126151&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=126291"
               title="View the content of the attachment">
          <b>New crash with proposed patch applied
          </b></a>

          <span class="bz_attach_extra_info">
              (70.85 KB,
                text/plain)

            <br>
            <a href="#attach_126291"
               title="Go to the comment associated with the attachment">2014-02-15 22:39 UTC</a>,

            <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=126291&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_text_plain bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=126311"
               title="View the content of the attachment">
          <b>
              <span class="bz_obsolete">mac80211_check_null_skb.patch
              </span>
          </b></a>

          <span class="bz_attach_extra_info">
              (1.17 KB,
                text/plain)

            <br>
            <a href="#attach_126311"
               title="Go to the comment associated with the attachment">2014-02-16 07:40 UTC</a>,

            <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=126311&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=126341"
               title="View the content of the attachment">
          <b>mac80211_check_null_skb_v2.patch
          </b></a>

          <span class="bz_attach_extra_info">
              (1.30 KB,
                text/plain)

            <br>
            <a href="#attach_126341"
               title="Go to the comment associated with the attachment">2014-02-16 17:11 UTC</a>,

            <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=126341&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (1)
        </span>
        <a href="attachment.cgi?bugid=70551&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>

  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script type="text/javascript">
  var replyCommentConfig = {
      quote_replies : "quoted_reply",
      is_insider : 0,
      markdown_fetching_comment : "Fetching comment..."
  };
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-13 23:58:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=126001" name="attach_126001" title="tarball with crashtool output for crashes and kernel config">attachment 126001</a> <a href="attachment.cgi?id=126001&amp;action=edit" title="tarball with crashtool output for crashes and kernel config">[details]</a></span>
tarball with crashtool output for crashes and kernel config

I am experiencing quite frequent kernel crashes on my thinkpad T410 used as a wireless router/home server.
Crashes observed only when Atheros 9380 based miniPCIe card is used (with ath9k driver). They mostly associated with heavy wireless bandwidth use, especially when torrent client with lots of connections runs over wifi.
Distro in use is ArchLinux i686.
Crashes has been observed on the 3.12.x kernels, as well as on the 3.10.29 LTS kernel.
It seems that I can observe this crashes only on the kernels buit by myself, not on the stock ARCH kernels.
I can provide crash tool outputs (bt log ps concatenated into single file) for the several crash instances.
I will also attach config file, which was used to build affected kernels. GCC 4.8.2 has been used.
Please, let me know what useful extra information I can provide.</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 03:18:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">A correction here: now I also have got a crash on 3.10.29 LTS kernel with stock Archlinux config, it wasn't exactly one from repository though (I needed to rebuild it to include debug info).</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 16:33:21 UTC
        </span>

      </div>




<pre class="bz_comment_text">What shows &quot;gdb l *(ath_tx_aggr_sleep+0x62)&quot; command called from crash tool?</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 17:23:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">crash&gt; gdb l *(ath_tx_aggr_sleep+0x62)
No symbol &quot;ath_tx_aggr_sleep&quot; in current context.
gdb: gdb request failed: l *(ath_tx_aggr_sleep+0x62)

Sorry, may be I am doing something wrong?</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 17:34:54 UTC
        </span>

      </div>




<pre class="bz_comment_text">Try to load module first i.e. &quot;mod -s ath9k&quot;. If that will not work, you should point whole path to the module i.e. &quot;mod -s ath9k /usr/src/linux/drivers/net/wireless/ath/ath9k/ath9k.ko&quot;</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 18:48:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">crash&gt; gdb l *(ath_tx_aggr_sleep+0x62)
0xf854f072 is in ath_tx_aggr_sleep (include/linux/list.h:88).
83      in include/linux/list.h</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 19:23:09 UTC
        </span>

      </div>




<pre class="bz_comment_text">Crash happen on one of two list_del's from :

                ath_txq_lock(sc, txq);

                buffered = ath_tid_has_buffered(tid);

                tid-&gt;sched = false;
                list_del(&amp;tid-&gt;list);

                if (ac-&gt;sched) {
                        ac-&gt;sched = false;
                        list_del(&amp;ac-&gt;list);
                }

but we don't know which one. Could you go down on address like:

l *(ath_tx_aggr_sleep+0x61)
l *(ath_tx_aggr_sleep+0x60)
l *(ath_tx_aggr_sleep+0x5f)
...

until command will show up line from ath9k/xmit.c , and provide that info here?</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 19:31:49 UTC
        </span>

      </div>




<pre class="bz_comment_text">0xf854f06e is in ath_tx_aggr_sleep (drivers/net/wireless/ath/ath9k/xmit.c:1470).
1465    in drivers/net/wireless/ath/ath9k/xmit.c</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 19:49:36 UTC
        </span>

      </div>




<pre class="bz_comment_text">Crash is on list_del(&amp;tid-&gt;list), looks like we are trying to delete that entry twice.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-14 19:52:35 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=126151" name="attach_126151" title="ath9k_protect_tid_list.patch">attachment 126151</a> <a href="attachment.cgi?id=126151&amp;action=edit" title="ath9k_protect_tid_list.patch">[details]</a></span>
ath9k_protect_tid_list.patch

Proposed fix. 

Max, please check if it make problem gone.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-15 15:34:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thank you for patch.
Everything looks promising, no crash so far.</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-15 22:39:11 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=126291" name="attach_126291" title="New crash with proposed patch applied">attachment 126291</a> <a href="attachment.cgi?id=126291&amp;action=edit" title="New crash with proposed patch applied">[details]</a></span>
New crash with proposed patch applied

I've got a crash again on the patched kernel. 
In the log:
[ 6335.697678] BUG: unable to handle kernel NULL pointer dereference at 000000ac
[ 6335.697858] IP: [&lt;fefcdc70&gt;] ieee80211_report_used_skb+0x10/0x1e0 [mac80211]
[ 6335.697968] *pde = 00000000 
[ 6335.698004] Oops: 0000 [#1] PREEMPT SMP

crash&gt; gdb l *(ieee80211_report_used_skb+0x10)
0xfefcdc70 is in ieee80211_report_used_skb (net/mac80211/status.c:389).
384     in net/mac80211/status.c

I have attached again output from the crashtool (log, bt, etc.)</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-16 07:38:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">Heh, everyone run linux wireless AP mode on some routers with single cpu, you are doing this on mulit-core SMP machine and hit bugs that nobody else does :-)

This new crash happen because we call ieee80211_free_txskb() with NULL skb. I can see only one place when that can happen, it's on ieee80211_tx_h_unicast_ps_buf() function. You can verify that by checking where the *(invoke_tx_handlers+0x1322) address is. Let me know if it is not in inside ieee80211_tx_h_unicast_ps_buf(), otherwise please continue testing with patch, which I will shortly attach.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-16 07:40:42 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=126311" name="attach_126311" title="mac80211_check_null_skb.patch">attachment 126311</a> <a href="attachment.cgi?id=126311&amp;action=edit" title="mac80211_check_null_skb.patch">[details]</a></span>
mac80211_check_null_skb.patch

Patch for new crash.</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-16 12:31:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thank you for patch, Stanislaw.
I've got a build error now:

net/mac80211/tx.c: In function ‘ieee80211_tx_h_unicast_ps_buf’:
net/mac80211/tx.c:487:4: error: implicit declaration of function ‘spin_lock_irqrestore’ [-Werror=implicit-function-declaration]
    spin_lock_irqrestore(&amp;sta-&gt;ps_tx_buf[ac].lock, flags);
    ^
net/mac80211/tx.c:493:37: error: ‘old’ undeclared (first use in this function)
    ieee80211_free_txskb(&amp;local-&gt;hw, old);
                                     ^
net/mac80211/tx.c:493:37: note: each undeclared identifier is reported only once for each function it appears in
cc1: some warnings being treated as errors

Should I enable implicit function declarations to compile it now?</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-16 17:11:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=126341" name="attach_126341" title="mac80211_check_null_skb_v2.patch">attachment 126341</a> <a href="attachment.cgi?id=126341&amp;action=edit" title="mac80211_check_null_skb_v2.patch">[details]</a></span>
mac80211_check_null_skb_v2.patch

Sorry, I should compile test the patch. This one should be fine.</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-18 20:17:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">Promising performance, 2 days of uptime without crash on the patched kernel.
Thank you once again for your fast response, Stanislaw.</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-19 12:07:44 UTC
        </span>

      </div>




<pre class="bz_comment_text">I'll post patches, I'm quite confident they fixed the problems you reported. If machine will crash again, it will be probably on other place. Thanks.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-26 09:51:41 UTC
        </span>

      </div>




<pre class="bz_comment_text">FYI: for second bug other fix was applied:
&gt;
<span class="quote">&gt; <a href="https://git.kernel.org/cgit/linux/kernel/git/jberg/mac80211.git/commit/?id=1d147bfa64293b2723c4fec50922168658e613ba">https://git.kernel.org/cgit/linux/kernel/git/jberg/mac80211.git/commit/?id=1d147bfa64293b2723c4fec50922168658e613ba</a></span >

Anyway, this bug can be closed.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Max Sydorenko</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-26 13:27:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">No crashes so far, BTW.
In which mainline kernel release those fixes can be expected?</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-02-26 14:28:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">3.14 plus backports to stable/longterm kernels that are not yet end of life i.e. 3.13.y, 3.10.y ...</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=70551#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Stanislaw Gruszka</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2014-12-12 14:49:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">This is fixed.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

    <hr><div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=70551&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr>
      </table>
  </div>

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=70551">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=70551">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=70551">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</main>

    <footer id="footer">
      <div class="intro"></div>

      <nav><ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/latest/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=70551&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=70551" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="createaccount.cgi?request_new_password=1"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="email" size="20" id="login_bottom" required
             type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password"
             type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635622229-_Hu5cbjJZHDQIeMtm3Z_6Rx8kF-jRWERq2a7ymn-SQk">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>
      </nav>

      <div class="outro"></div>
    </footer>

  </body>
</html>