<!DOCTYPE html>
<html lang="en">
  <head>
    <title>101547 &ndash; Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/c60deb3d48830179eae269c9e65a7506.css?1462892334" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1462892331"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "101547 – Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814",
                             "show_bug.cgi?id=101547" );
        document.title = "101547 – Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "101547 – Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1462892334"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico">
  </head>

  <body 
        class="bugs-freedesktop-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_cairo
                 bz_component_general
                 bz_bug_101547 yui-skin-sam">

  <div id="header"><div id="banner">
  </div>

    <div id="titles">
      <span id="title">Bugzilla &ndash; Bug&nbsp;101547</span>

        <span id="subtitle" class="subheader">Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814</span>

        <span id="information" class="header_addl_info">Last modified: 2018-08-25 13:55:15 UTC</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>


</ul>
    </div>
  </div>

  <div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2018-08-25 13:55:15">
  <input type="hidden" name="id" value="101547">
  <input type="hidden" name="token" value="1635619135-ZP12sinHrRJv0AsFs7Lgb3-TB-vyq4OOlmxphaFj06c">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=101547"><b>Bug&nbsp;101547</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'Heap buffer overflow at cairo-truetype-subset.c:1299, CVE-2017-9814' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          MOVED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >cairo

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=cairo"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >general

  (<a href="buglist.cgi?component=general&amp;product=cairo&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>
<td>unspecified
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">All
        All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>medium
       major
      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Chris Wilson</span>
</span>
      </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_qa_contact">


  <a 
      title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#qa_contact"
  >QA Contact:</a>

</th>
      <td><span class="vcard"><span class="fn">cairo-bugs mailing list</span>
</span>
      </td>
    </tr>
    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'chris\x40chris-wilson.co.uk',
        'cairo-bugs\x40cairographics.org');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2017-06-21 18:41 UTC by <span class="vcard"><span class="fn">foca&#64;salesforce.com</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2018-08-25 13:55 UTC
      (<a href="show_activity.cgi?id=101547">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>3 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="fezhang">fezhang</option>
                <option value="prlw1">prlw1</option>
                <option value="qzheng">qzheng</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 
<tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_i915_platform">


  <a 
      title="Intel platforms affected by the bug"
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_i915_platform"
  >i915 platform:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_i915_platform" >

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_i915_features">


  <a 
      title="Features of the i915 driver affected by the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_i915_features"
  >i915 features:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_i915_features" >

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_pdf">
        <td>
            <a href="attachment.cgi?id=132557"
               title="View the content of the attachment">
          <b>Proof of concept</b></a>

          <span class="bz_attach_extra_info">
              (8.09 KB,
                application/pdf)

            <br>
            <a href="#attach_132557"
               title="Go to the comment associated with the attachment">2017-07-07 21:36 UTC</a>,

            <span class="vcard"><span class="fn">foca&#64;salesforce.com</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=132557&amp;action=edit">Details</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=132562"
               title="View the content of the attachment">
          <b>Check cmap size before allocating</b></a>

          <span class="bz_attach_extra_info">
              (915 bytes,
                patch)

            <br>
            <a href="#attach_132562"
               title="Go to the comment associated with the attachment">2017-07-08 00:04 UTC</a>,

            <span class="vcard"><span class="fn">Adrian Johnson</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=132562&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=132562">
      Splinter Review</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=132563"
               title="View the content of the attachment">
          <b>Replace malloc() with _cairo_malloc()</b></a>

          <span class="bz_attach_extra_info">
              (117.11 KB,
                patch)

            <br>
            <a href="#attach_132563"
               title="Go to the comment associated with the attachment">2017-07-08 00:07 UTC</a>,

            <span class="vcard"><span class="fn">Adrian Johnson</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=132563&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=132563">
      Splinter Review</a>
        </td>
      </tr>
      <tr id="a4" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=139088"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Check cmap size before allocating and replace malloc() with _cairo_malloc().</span></b></a>

          <span class="bz_attach_extra_info">
              (145.95 KB,
                patch)

            <br>
            <a href="#attach_139088"
               title="Go to the comment associated with the attachment">2018-04-25 03:17 UTC</a>,

            <span class="vcard"><span class="fn">qzheng</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=139088&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139088">
      Splinter Review</a>
        </td>
      </tr>
      <tr id="a5" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=139090"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">Check cmap size before allocating and replace malloc() with _cairo_malloc().</span></b></a>

          <span class="bz_attach_extra_info">
              (144.28 KB,
                patch)

            <br>
            <a href="#attach_139090"
               title="Go to the comment associated with the attachment">2018-04-25 03:42 UTC</a>,

            <span class="vcard"><span class="fn">qzheng</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=139090&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139090">
      Splinter Review</a>
        </td>
      </tr>
      <tr id="a6" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=139094"
               title="View the content of the attachment">
          <b>Check cmap size before allocating and replace malloc() with _cairo_malloc().</b></a>

          <span class="bz_attach_extra_info">
              (143.90 KB,
                patch)

            <br>
            <a href="#attach_139094"
               title="Go to the comment associated with the attachment">2018-04-25 06:43 UTC</a>,

            <span class="vcard"><span class="fn">qzheng</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=139094&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139094">
      Splinter Review</a>
        </td>
      </tr>
      <tr id="a7" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=139416"
               title="View the content of the attachment">
          <b>Convert boilerplate code to _cairo_malloc</b></a>

          <span class="bz_attach_extra_info">
              (5.64 KB,
                patch)

            <br>
            <a href="#attach_139416"
               title="Go to the comment associated with the attachment">2018-05-08 01:03 UTC</a>,

            <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=139416&amp;action=edit">Details</a>&#x0020; |
    <a href="https://bugs.freedesktop.org/page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139416">
      Splinter Review</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (2)
            <a id="view_all" href="attachment.cgi?bugid=101547&amp;action=viewall&amp;hide_obsolete=1">View All</a>
        </span>
    </td>
  </tr>
</table>
<br>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1462891770" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">foca&#64;salesforce.com</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-06-21 18:41:23 UTC
        </span>

      </div>




<pre class="bz_comment_text">Hi, 

I would like to report the details of this vulnerability in private to follow a responsible disclosure: <a href="https://en.wikipedia.org/wiki/Responsible_disclosure">https://en.wikipedia.org/wiki/Responsible_disclosure</a>

Could you make this ticket private? Is it that possible?

Thank you.</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">foca&#64;salesforce.com</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-07 21:35:37 UTC
        </span>

      </div>




<pre class="bz_comment_text">The CVE-2017-9814 has been assigned to this vulnerability.

There is a read out of bounds bug at cairo-truetype-subset.c:1299:

1293     size = be16_to_cpu (map-&gt;length);
1294     map = malloc (size);
1295     if (unlikely (map == NULL))
1296         return _cairo_error (CAIRO_STATUS_NO_MEMORY);
1297 
1298     status = backend-&gt;load_truetype_table (scaled_font,
1299                                            TT_TAG_cmap, table_offset,
1300                                            (unsigned char *) map,
1301                                            &amp;size);
1302     if (unlikely (status))
1303         goto fail;
1304 
1305     num_segments = be16_to_cpu (map-&gt;segCountX2)/2;

The bug happens because in some scenarios the variable size can have a value of 0 at line 1288. And malloc(0) is not returning NULL as some people could expect: <a href="https://stackoverflow.com/questions/1073157/zero-size-malloc">https://stackoverflow.com/questions/1073157/zero-size-malloc</a>

malloc(0) returns the smallest chunk possible. So the line 1290 with the return is not execute. And the execution continues with an invalid map.

Since the size is 0 the variable map is not initialized correctly at load_trutype_table. So, later when the variable map is accessed previous values from a freed chunk are used. This could allows an attacker to control the variable map.

There is a check performed just after the bug:
1309     if (size &lt; (8 + 4*num_segments)*sizeof(uint16_t))
1310         return CAIRO_INT_STATUS_UNSUPPORTED;

So it’s likely the attacker can't control the variable num_segments, and he can't trigger additional functionality to leverage this.

The solution could be to check for the size, or to use a malloc wrapper that handle the size = 0 case and returns NULL.

This bug was found when using a poppler util, pdftocairo. A PoC is attached. To reproduce the bug use:
pdftocairo -svg PoC.pdf

This vulnerability has been found by Offensive Research at Salesforce.com:
Alberto Garcia (&#64;algillera), Francisco Oca (&#64;francisco_oca) &amp; Suleman Ali (&#64;Salbei_)</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">foca&#64;salesforce.com</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-07 21:36:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=132557" name="attach_132557" title="Proof of concept">attachment 132557</a> <a href="attachment.cgi?id=132557&amp;action=edit" title="Proof of concept">[details]</a></span>
Proof of concept</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Adrian Johnson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-08 00:04:50 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=132562" name="attach_132562" title="Check cmap size before allocating">attachment 132562</a> <a href="attachment.cgi?id=132562&amp;action=edit" title="Check cmap size before allocating">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=132562'>[review]</a>
Check cmap size before allocating

Patch to check the size before allocating cmap table.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Adrian Johnson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-08 00:07:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=132563" name="attach_132563" title="Replace malloc() with _cairo_malloc()">attachment 132563</a> <a href="attachment.cgi?id=132563&amp;action=edit" title="Replace malloc() with _cairo_malloc()">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=132563'>[review]</a>
Replace malloc() with _cairo_malloc()

<span class="quote">&gt; The solution could be to check for the size, or to use a malloc wrapper
&gt; that handle the size = 0 case and returns NULL.</span >

We already have a wrapper that checks size = 0: _cairo_malloc(). It has not been used consistently. The attached patch replaces all calls to malloc() with _cairo_malloc().</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-10 17:08:24 UTC
        </span>

      </div>




<pre class="bz_comment_text">Yes, _cairo_malloc() looks like it should be used more uniformly to avoid this bug.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-07-10 17:10:21 UTC
        </span>

      </div>




<pre class="bz_comment_text">Adrian, will you be landing this patch or is there any additional work needed?</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-09-20 21:32:30 UTC
        </span>

      </div>




<pre class="bz_comment_text">At this point, the patch needs rebased to be landable.  Would anyone have a problem if I went ahead and did so?</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">qzheng</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-04-25 02:37:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Bryce Harrington from <a href="show_bug.cgi?id=101547#c7">comment #7</a>)
<span class="quote">&gt; At this point, the patch needs rebased to be landable.  Would anyone have a
&gt; problem if I went ahead and did so?</span >

This patch has not been landed, am I correct?</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">qzheng</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-04-25 03:17:32 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=139088" name="attach_139088" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">attachment 139088</a> <a href="attachment.cgi?id=139088&amp;action=edit" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139088'>[review]</a>
Check cmap size before allocating and replace malloc() with _cairo_malloc().

Check cmap size before allocating and replace malloc() with _cairo_malloc().</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">qzheng</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-04-25 03:42:57 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=139090" name="attach_139090" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">attachment 139090</a> <a href="attachment.cgi?id=139090&amp;action=edit" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139090'>[review]</a>
Check cmap size before allocating and replace malloc() with _cairo_malloc().</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">qzheng</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-04-25 06:43:02 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=139094" name="attach_139094" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">attachment 139094</a> <a href="attachment.cgi?id=139094&amp;action=edit" title="Check cmap size before allocating and replace malloc() with _cairo_malloc().">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139094'>[review]</a>
Check cmap size before allocating and replace malloc() with _cairo_malloc().</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-05-07 23:42:01 UTC
        </span>

      </div>




<pre class="bz_comment_text">I've gone ahead and rebased and landed Adrian's patch.

To ssh://git.freedesktop.org/git/cairo
   7554822..1998239  master -&gt; master


qzheng's patch demonstrates there are additional malloc()'s worth reviewing as followup work, esp. in boilerplate.  However, the patch includes some s/malloc/_cairo_malloc/ changes that don't look quite right, such as:

-#include &quot;cairo-malloc-private.h&quot;
+#include &quot;cairo-_cairo_malloc-private.h&quot;

Some of the changes to tests and docs may not strictly be needed.  Also, we have cases of malloc(unsigned + number) which won't ever trigger the malloc(0) error; should we still change these cases for consistency, or leave them as is?

I'm going to leave this bug open until at least the mallocs in boilerplate/ have been applied.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Bryce Harrington</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-05-08 01:03:09 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=139416" name="attach_139416" title="Convert boilerplate code to _cairo_malloc">attachment 139416</a> <a href="attachment.cgi?id=139416&amp;action=edit" title="Convert boilerplate code to _cairo_malloc">[details]</a></span> <a href='page.cgi?id=splinter.html&amp;bug=101547&amp;attachment=139416'>[review]</a>
Convert boilerplate code to _cairo_malloc

Here's a shot at converting the remaining malloc()'s in boilerplate/ to use _cairo_malloc.  I notice though that the boilerplate code has its own xmalloc() routine that calls exit() on error; I'm not certain whether or not that should be used here instead of _cairo_malloc?</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=101547#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">GitLab Migration User</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2018-08-25 13:55:15 UTC
        </span>

      </div>




<pre class="bz_comment_text">-- GitLab Migration Automatic Message --

This bug has been migrated to freedesktop.org's GitLab instance and has been closed from further activity.

You can subscribe and participate further through the new bug through this link to our GitLab instance: <a href="https://gitlab.freedesktop.org/cairo/cairo/issues/264">https://gitlab.freedesktop.org/cairo/cairo/issues/264</a>.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=101547">Format For Printing</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>


</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>
<p align="center">
  Use of freedesktop.org services, including Bugzilla, is subject to our <a href="https://www.freedesktop.org/wiki/CodeOfConduct/">Code of Conduct</a>. How we collect and use information is described in our <a href="https://www.freedesktop.org/wiki/PrivacyPolicy">Privacy Policy</a>.
</p>
  </body>
</html>