<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>FreePBX Security Vulnerability SEC-2019-001 - Security - FreePBX Community Forums</title>
    <meta name="description" content="Sangoma was recently made aware of a significant security vulnerability affecting the administrator web interface for current versions of FreePBX and PBXact.  Sangoma has published updated FreePBX and PBXact modules (for&amp;hellip;">
    <meta name="author" content="">
<meta name="generator" content="Discourse 2.3.0.beta2 - https://github.com/discourse/discourse version 667d3a3fd65bb1fb8f0e14f11d27e0625cf60588">
<link rel="icon" type="image/png" href="https://fpbxforums-sangomaus.netdna-ssl.com/uploads/default/original/3X/0/4/047a3ab6d41370c87b4892a74aa2ef2a81b7f623.png">
<link rel="apple-touch-icon" type="image/png" href="https://fpbxforums-sangomaus.netdna-ssl.com/uploads/default/original/3X/a/f/af8e16676881ac8d6bec767b5566e37e86d249c9.png">
<meta name="theme-color" content="#ffffff">
<meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<link rel="canonical" href="https://community.freepbx.org/t/freepbx-security-vulnerability-sec-2019-001/62772" />
<script type="application/ld+json">{"@context":"http://schema.org","@type":"WebSite","url":"https://community.freepbx.org","potentialAction":{"@type":"SearchAction","target":"https://community.freepbx.org/search?q={search_term_string}","query-input":"required name=search_term_string"}}</script>
<link rel="search" type="application/opensearchdescription+xml" href="https://community.freepbx.org/opensearch.xml" title="FreePBX Community Forums Search">

      <link href="//fpbxforums-sangomaus.netdna-ssl.com/stylesheets/desktop_ab4184aa42363e8ee25d2c17988f016d6dd51657.css?__ws=community.freepbx.org" media="all" rel="stylesheet" data-target="desktop" data-theme-id="2"/>
      <link href="//fpbxforums-sangomaus.netdna-ssl.com/stylesheets/desktop_theme_2_e7fcf9ca1e6dcb2de23bee633434fbe5b2dbe773.css?__ws=community.freepbx.org" media="all" rel="stylesheet" data-target="desktop_theme" data-theme-id="2"/>
    <!--<div class="digium-banner" style="
    padding: 10px 0px;
    z-index: 1002;
    width: 100%;
    top: 0;
    left: 0;
    text-align: center;
    background-color: #f6772f;
    font-weight: bold;
    color: white;
">Sangoma Completes Acquisition of Digium: <a href="https://www.sangoma.com/press-releases/?sangoma-completes-acquisition-of-digium">Sangoma Press Release</a>. Community FAQ: <a href="https://wiki.freepbx.org/display/FOP/Sangoma+and+Digium+Join+Together+FAQ">Sangoma and Digium Join Together FAQ</a></div>
<div class="freepbx-nav">
    <a href="http://www.freepbx.org">FreePBX</a> | <a href="http://www.freepbx.org/users/register">Register</a> | <a href="http://issues.freepbx.org">Issues</a> | <a href="http://wiki.freepbx.org">Wiki</a> | <a href="http://portal.schmoozecom.com">Portal</a> | <a href="http://www.freepbx.org/support-and-professional-services">Support</a>
</div>-->
    <meta id="data-ga-universal-analytics" data-tracking-code="UA-1862516-6" data-json="{&quot;cookieDomain&quot;:&quot;auto&quot;}" data-auto-link-domains="">

<link rel='preload' href='//fpbxforums-sangomaus.netdna-ssl.com/assets/google-universal-analytics-f35b4da49411e6f5559073523aab983da483976a3954c79c756f8579f6fbd6ef.js' as='script'/>
<script src='//fpbxforums-sangomaus.netdna-ssl.com/assets/google-universal-analytics-f35b4da49411e6f5559073523aab983da483976a3954c79c756f8579f6fbd6ef.js'></script>

      <link rel="alternate" type="application/rss+xml" title="RSS feed of &#39;FreePBX Security Vulnerability SEC-2019-001&#39;" href="https://community.freepbx.org/t/freepbx-security-vulnerability-sec-2019-001/62772.rss" />
  <meta property="og:site_name" content="FreePBX Community Forums" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:image" content="https://fpbxforums-sangomaus.netdna-ssl.com/uploads/default/original/3X/f/9/f9cda61f46fd4dd3e4bc1599c786ae17d7de5b48.png" />
<meta property="og:image" content="https://fpbxforums-sangomaus.netdna-ssl.com/uploads/default/original/3X/f/9/f9cda61f46fd4dd3e4bc1599c786ae17d7de5b48.png" />
<meta property="og:url" content="https://community.freepbx.org/t/freepbx-security-vulnerability-sec-2019-001/62772" />
<meta name="twitter:url" content="https://community.freepbx.org/t/freepbx-security-vulnerability-sec-2019-001/62772" />
<meta property="og:title" content="FreePBX Security Vulnerability SEC-2019-001" />
<meta name="twitter:title" content="FreePBX Security Vulnerability SEC-2019-001" />
<meta property="og:description" content="Sangoma was recently made aware of a significant security vulnerability affecting the administrator web interface for current versions of FreePBX and PBXact.  Sangoma has published updated FreePBX and PBXact modules (for the ‚Äúframework‚Äù module) to our mirror servers, and they should be available to you now.  Many modern FreePBX systems are set to automatically apply security updates, but we STRONGLY encourage you to check all of your FreePBX systems to make sure that they have updated to the new..." />
<meta name="twitter:description" content="Sangoma was recently made aware of a significant security vulnerability affecting the administrator web interface for current versions of FreePBX and PBXact.  Sangoma has published updated FreePBX and PBXact modules (for the ‚Äúframework‚Äù module) to our mirror servers, and they should be available to you now.  Many modern FreePBX systems are set to automatically apply security updates, but we STRONGLY encourage you to check all of your FreePBX systems to make sure that they have updated to the new..." />
<meta name="twitter:label1" value="Reading time" />
<meta name="twitter:data1" value="2 mins üïë" />
<meta name="twitter:label2" value="Likes" />
<meta name="twitter:data2" value="5 ‚ù§" />
<meta property="article:published_time" content="2019-11-20T20:01:15+00:00" />
<meta property="og:ignore_canonical" content="true" />



    <script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"FreePBX Security Vulnerability SEC-2019-001","mainEntity":{"@type":"Question","name":"FreePBX Security Vulnerability SEC-2019-001","text":"Sangoma was recently made aware of a significant security vulnerability affecting the administrator web interface for current versions of FreePBX and PBXact.  Sangoma has published updated FreePBX and PBXact modules (for the ‚Äúframework‚Äù module) to our mirror servers, and they should be available to &hellip;","upvoteCount":3,"answerCount":0,"dateCreated":"2019-11-20T20:01:15.002Z","author":{"@type":"Person","name":"Jared K  Smith"}}}</script>
  </head>
  <body class="crawler">
    <script src="//fpbxforums-sangomaus.netdna-ssl.com/theme-javascripts/0006d8ec4aaca782f06f02df21c23780e7c8abd9.js?__ws=community.freepbx.org"></script>

<script src="//fpbxforums-sangomaus.netdna-ssl.com/theme-javascripts/26261103473b2dacef35d83f03643fdb9467fc41.js?__ws=community.freepbx.org"></script>
    <header>
      <a href="/">
          <img src="https://fpbxforums-sangomaus.netdna-ssl.com/uploads/default/original/3X/4/b/4b740b09152a108a3bf5c33a077890d59d087619.png" alt="FreePBX Community Forums" id="site-logo" style="max-width: 150px;">
      </a>
    </header>
    <div id="main-outlet" class="wrap">
      <h1>
  <a href="/t/freepbx-security-vulnerability-sec-2019-001/62772">FreePBX Security Vulnerability SEC-2019-001</a>
</h1>

<div id='breadcrumbs'>
    <div id="breadcrumb-0" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
        itemref="breadcrumb-1"
      >
      <a href="/c/freepbx" itemprop="url">
        <span itemprop="title">FreePBX</span>
      </a>
    </div>
    <div id="breadcrumb-1" itemscope itemtype="http://data-vocabulary.org/Breadcrumb"
>
      <a href="/c/freepbx/security" itemprop="url">
        <span itemprop="title">Security</span>
      </a>
    </div>
</div>

    <div class='tags-list' itemscope itemtype='http://schema.org/ItemList'>
        <div itemprop='itemListElement' itemscope itemtype='http://schema.org/ListItem'>
          <meta itemprop='url' content='https://community.freepbx.org/tags/bug'>
          <a href='https://community.freepbx.org/tags/bug' itemprop='item'>
            <span itemprop='name'>bug</span>
          </a>
        </div>
    </div>



  <div class='tags'>
    Tags:

      #&lt;Tag:0x00007f91d8b032b0&gt;
  </div>



<hr>


  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/jsmith'><b itemprop='author'>jsmith</b></a>
          (Jared K  Smith)
            <time itemprop='datePublished' datetime='2019-11-20T20:01:15Z'>
              2019-11-20 20:01:15 UTC
            </time>
        </span>
        <span itemprop='position'>#1</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Sangoma was recently made aware of a significant security vulnerability affecting the administrator web interface for current versions of FreePBX and PBXact.  Sangoma has published updated FreePBX and PBXact modules (for the ‚Äúframework‚Äù module) to our mirror servers, and they should be available to you now.  Many modern FreePBX systems are set to automatically apply security updates, but we <em>STRONGLY</em> encourage you to check all of your FreePBX systems to make sure that they have updated to the new version.  To do this, please go to Admin -&gt; Module Admin and make sure the ‚ÄúFreePBX Framework‚Äù is greater than or equal to one of the following versions:</p>
<p>For FreePBX/PBXact 13: v13.0.197.14<br>
For FreePBX/PBXact 14: v14.0.13.12<br>
For FreePBX/PBXact 15: v15.0.16.27</p>
<p>You may also check the version of the modules from the Linux command-line on your FreePBX/PBXact system by running ‚Äúfwconsole ma list‚Äù and looking at the version of the ‚Äúframework‚Äù module.</p>
<p>While keeping your system up to date is critical in preventing security issues, we also encourage all FreePBX and PBXAct users to follow strong security practices, such as limiting exposure of your FreePBX or PBXact Admin GUI whenever possible.</p>
<p>We would like to publicly thank those who reported this issue to us in a responsible manner.  This responsible disclosure allowed us to prepare updates and make them available before public disclosure of the vulnerability, so that FreePBX users can secure their systems.</p>
<p>More details on the vulnerability are available on the FreePBX wiki at <a href="https://wiki.freepbx.org/display/FOP/2019-11-20+Remote+Admin+Authentication+Bypass" rel="nofollow noopener">https://wiki.freepbx.org/display/FOP/2019-11-20+Remote+Admin+Authentication+Bypass</a></p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:3'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
            <a href="https://community.freepbx.org/t/sec-2019-001/62732/8">Sec-2019-001</a>
            <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/jsmith'><b itemprop='author'>jsmith</b></a>
          (Jared K  Smith)
            pinned 
            <time itemprop='datePublished' datetime='2019-11-20T20:01:59Z'>
              2019-11-20 20:01:59 UTC
            </time>
        </span>
        <span itemprop='position'>#2</span>
      </div>
      <div class='post' itemprop='articleBody'>
        
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/billsimon'><b itemprop='author'>billsimon</b></a>
          (Simon Telephonics)
            <time itemprop='datePublished' datetime='2019-11-20T20:10:54Z'>
              2019-11-20 20:10:54 UTC
            </time>
        </span>
        <span itemprop='position'>#3</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Under what circumstances can intrusion take place, and how can FreePBX administrators tell if their system has already been had?</p>
<p>I‚Äôm not asking for public description of the specific attack vector, but the ‚ÄúMore details‚Äù link lacks actual details.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/mattf'><b itemprop='author'>mattf</b></a>
          (Matthew Fredrickson)
            <meta itemprop='datePublished' content='2019-11-20T20:37:23Z'>
            <time itemprop='dateModified' datetime='2019-11-20T21:41:21Z'>
              2019-11-20 21:41:21 UTC
            </time>
        </span>
        <span itemprop='position'>#4</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Hey Bill,</p>
<p>Due to the concerning nature of the exploit, we‚Äôre trying to keep the details of the attack vector from getting leaked.  It‚Äôs safe to say that if you have a system that has the admin portal exposed to the open internet, you should take precautions to verify that nothing is amiss, such as auditing admin and user accounts and verifying that they are in order (no suspicious new accounts, etc).  Also, it never hurts to reset your upstream SIP provider credentials/password in case you‚Äôre using username/password auth with them.</p>
<p>Finally, it might not hurt to clear the php session tokens and force a login from all users again (depending on how deeply you‚Äôd like to go through this process).</p>
<p>You can do that at an ssh console with the following command:<br>
<code>rm -f /var/lib/php/session/*</code></p>
<p>Hope that helps a bit, and sorry to have to break the bad news.</p>
<p>Matthew Fredrickson</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:1'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/ausip'><b itemprop='author'>ausip</b></a>
          (Paul Mitchener)
            <time itemprop='datePublished' datetime='2019-11-20T20:53:00Z'>
              2019-11-20 20:53:00 UTC
            </time>
        </span>
        <span itemprop='position'>#5</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>HI <a class="mention" href="/u/mattf">@mattf</a></p>
<p>I wasn‚Äôt after specifics, just an idea of what the exploit relates to, which you have explained well enough.</p>
<p>Based on the timing, It sounds like we have fell victim to this exploit. The extension that was compromised had a random password on it that I would not have used. This was a red flag for me. Luckily we caught the exploit before they spent too much on calls to Morroco.</p>
<p>We had already blocked web access to the admin portal. As all extension secrets are visible from the admin UI, I am guessing it‚Äôs probably best that we go and reset all the passwords.</p>
<p>I will also have a look for any new users in the Admin Panel.</p>
<p>Thanks for the explanation.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/FreerPBXer'><b itemprop='author'>FreerPBXer</b></a>
          
            <time itemprop='datePublished' datetime='2019-11-20T21:03:04Z'>
              2019-11-20 21:03:04 UTC
            </time>
        </span>
        <span itemprop='position'>#6</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Is there a way to have the UCP accessible and not the admin portal? If so, can someone post a link with directions?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/jgiebler'><b itemprop='author'>jgiebler</b></a>
          
            <time itemprop='datePublished' datetime='2019-11-20T21:11:36Z'>
              2019-11-20 21:11:36 UTC
            </time>
        </span>
        <span itemprop='position'>#7</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks <a class="mention" href="/u/mattf">@mattf</a></p>
<p>Just to confirm‚Ä¶</p>
<p>If we did not have the Admin Portal (Port 443 on the FreePBX servers in our case) accessible to the open web, we probably didn‚Äôt have anything malicious happen‚Ä¶ unless it came from an inside device with access to port 443 on the FreePBX Servers.</p>
<p>Can you confirm that is a correct understanding?</p>
<p>For us, we only have the Standard SIP ports and the Media Ports Open to the web. The SIP ports are limited to inbound access only from our specific Provider IPs.<br>
Thank you</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/mattf'><b itemprop='author'>mattf</b></a>
          (Matthew Fredrickson)
            <meta itemprop='datePublished' content='2019-11-20T21:29:44Z'>
            <time itemprop='dateModified' datetime='2019-11-20T21:40:35Z'>
              2019-11-20 21:40:35 UTC
            </time>
        </span>
        <span itemprop='position'>#8</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>That is correct.  If you didn‚Äôt have the admin portal accessible on the open web, the only attacker that might be of concern is someone operating inside your network, and for most people that means you‚Äôre safe <img src="//fpbxforums-sangomaus.netdna-ssl.com/images/emoji/twitter/slight_smile.png?v=6" title=":slight_smile:" class="emoji" alt=":slight_smile:"></p>
<p>Matthew Fredrickson</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/jgiebler'><b itemprop='author'>jgiebler</b></a>
          
            <time itemprop='datePublished' datetime='2019-11-20T21:40:48Z'>
              2019-11-20 21:40:48 UTC
            </time>
        </span>
        <span itemprop='position'>#9</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thanks for the quick response <a class="mention" href="/u/mattf">@mattf</a></p>
<p>That is very helpful to have confirmed.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/moussa854'><b itemprop='author'>moussa854</b></a>
          (Moussa)
            <time itemprop='datePublished' datetime='2019-11-20T22:24:57Z'>
              2019-11-20 22:24:57 UTC
            </time>
        </span>
        <span itemprop='position'>#10</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Do you have sensitive information that can be leaked from the UCP? Have you notice any change in passwords? unusual call destinations?</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/cyberdocwi'><b itemprop='author'>cyberdocwi</b></a>
          (Cyberdocwi)
            <time itemprop='datePublished' datetime='2019-11-21T00:56:23Z'>
              2019-11-21 00:56:23 UTC
            </time>
        </span>
        <span itemprop='position'>#11</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>Thank you Sangoma for jumping on this right away.  I can also appreciate the desire to also keep the attack methodology under wraps.</p>
<p>I have taken a look at the Linux side of the logging: secure, messages, that sort of thing, but am wondering if an audit trail exists to tell who accessed and who was denied the login screen.  Is there a simple log file somewhere that I am missing that would show if anyone was able to access via the fault?</p>
<p>Thanks,</p>
<p>Christian</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/moussa854'><b itemprop='author'>moussa854</b></a>
          (Moussa)
            <meta itemprop='datePublished' content='2019-11-21T01:51:05Z'>
            <time itemprop='dateModified' datetime='2019-11-21T01:57:00Z'>
              2019-11-21 01:57:00 UTC
            </time>
        </span>
        <span itemprop='position'>#12</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>I wrote few scripts that pulls the information from the logs. The logs get rotated and the scripts will not help with old incidents.<br>
This one will pull all IPs that accessed the server</p>
<blockquote>
<p>sudo cat  /var/log/httpd/access_log | awk ‚Äò{print $1}‚Äô | sort -n | uniq | sort -nr | head -20</p>
</blockquote>
<p>This one will pull the IPs that get denied</p>
<blockquote>
<p>sudo cat  /var/log/httpd/error_log | grep denied |cut -f 10 -d ‚Äô '| sed ‚Äòs/.{7}$//‚Äô | sort | uniq | sort -nr | more<br>
sudo cat /var/log/secure | grep ‚ÄúFailed password‚Äù | grep -E -o ‚Äú([0-9]{1,3}[.]){3}[0-9]{1,3}‚Äù | cut -f 11 -d ‚Äô '| sort | uniq | tr ‚Äò\n‚Äô ‚Äô ‚Äô | sort -nr<br>
sudo cat /var/log/secure | grep ‚Äúauthentication failures‚Äù |cut -f 16 -d ‚Äô ‚Äô |cut -f 2 -d = | sort | uniq | tr ‚Äò\n‚Äô ‚Äô ‚Äô | sort -nr</p>
</blockquote>
<p>This one will pull the IPs for the endpoints that registered to your server</p>
<blockquote>
<p>sudo cat /var/log/asterisk/full | grep ‚Äú@‚Äù | grep -E -o ‚Äú([0-9]{1,3}[.]){3}[0-9]{1,3}‚Äù | sort | uniq  | sort -nr</p>
</blockquote>
<p>This is how I put them to work. If there is an unusual activity I get an email and I act on it.</p>
<aside class="quote quote-modified" data-post="3" data-topic="59420">
  <div class="title">
    <div class="quote-controls"></div>
    <img alt="" width="20" height="20" src="/letter_avatar_proxy/v3/letter/m/0ea827/40.png" class="avatar">
    <a href="https://community.freepbx.org/t/how-to-monitor-and-set-email-alert-for-unauthorized-access-to-freepbx-centos-server/59420/3?u=moussa854">[HOW-TO] Monitor and Set Email Alert For Unauthorized Access to FreePBX (Centos) Server</a> <a class="badge-wrapper  bullet" href="/c/general-help"><span class="badge-category-bg" style="background-color: #8BC540;"></span><span style="" data-drop-close="true" class="badge-category clear-badge" title="This category is meant as a catch all for things that don" t have their own category when posting please hit the drop down to see if there may be a better place for your post.>General Help</span></a>
  </div>
  <blockquote>
    <a href="https://community.freepbx.org/u/dicko">dicko</a> mentioned in a post that the access_log has the information of who access what and when. Looking around I was able to write this script that will do the purpose of monitoring users‚Äô access by IP. In my situation, I have limited IP that I access the FreePBX from. Hence, this script should do it for me. 
#!/bin/bash
email="<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b4d9cdd1d9d5ddd8f4cdd5dcdbdb9ad7dbd9">[email&#160;protected]</a>"
myips=("IP1"  "IP2" "IP3"  "IP4")
accessip=`sudo cat /var/log/httpd/access_log | awk '{print $1}' | sort -n | uniq | sort -nr | head -20`
deniedip=`sudo‚Ä¶
  </blockquote>
</aside>

<p>logwatch is another way to look at who accessed your server and from where<br>
<aside class="onebox whitelistedgeneric">
  <header class="source">
      <img src="https://a.fsdn.com/con/img/sandiego/logo-180x180.png" class="site-icon" width="180" height="180">
      <a href="https://sourceforge.net/projects/logwatch/" target="_blank" rel="nofollow noopener">SourceForge</a>
  </header>
  <article class="onebox-body">
    

<h3><a href="https://sourceforge.net/projects/logwatch/" target="_blank" rel="nofollow noopener">Logwatch</a></h3>

<p>Download Logwatch for free.  Logwatch is a customizable log analysis system. Logwatch parses through your system's logs and creates a report analyzing areas that you specify.</p>


  </article>
  <div class="onebox-metadata">
    
    
  </div>
  <div style="clear: both"></div>
</aside>
</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:1'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/VoIPTek'><b itemprop='author'>VoIPTek</b></a>
          
            <meta itemprop='datePublished' content='2019-11-21T03:15:46Z'>
            <time itemprop='dateModified' datetime='2019-11-21T03:21:24Z'>
              2019-11-21 03:21:24 UTC
            </time>
        </span>
        <span itemprop='position'>#13</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>While we are getting a little off-topic with this post, I wanted to share my approach to the notification aspect since it was a part of the conversation here.</p>
<p>I use this from within .bashrc and I populate the file ssh_known_ips with you guessed it, the IP‚Äôs we know about, in order to reduce the amount of email.  The server name will get auto-populated.</p>
<p>SSERVER=<code>hostname | perl -p -e 's/(.*?)\..*/$1/'</code><br>
SUBJECT=‚ÄúRoot Login Alert: $SSERVER‚Äù<br>
<a href="/cdn-cgi/l/email-protection#2f61607b666976706a626e6663120a1d1d7c6a616b7b6062766a626e66636f62766a626e6663016c6062">NOTIFY_EMAIL="<span class="__cf_email__" data-cfemail="5300161d17071c1e0a161e121a1f131e0a161e121a1f7d101c1e">[email&#160;protected]</span></a>"</p>
<p>[ -f /ibin/conf/ssh_known_ips ] &amp;&amp; source /ibin/conf/ssh_known_ips</p>
<p>loginip=<code>echo $SSH_CLIENT | awk '{print $1}'</code><br>
authorized=false;<br>
function message {<br>
echo ‚Äú${msgheader}<code>hostname</code>‚Äù<br>
echo ‚Äú----------------------------------------------‚Äù<br>
echo ‚ÄúLogin IP: $loginip‚Äù<br>
echo "Login User: <code>whoami</code>"<br>
echo "Date-Time: <code>date</code>"<br>
echo ‚Äú----------------------------------------------‚Äù<br>
}<br>
for ip in $KNOWN_IPS; do<br>
if [ ‚Äú$loginip‚Äù == ‚Äú$ip‚Äù ]; then<br>
authorized=true;<br>
msgheader=‚ÄúAuthorized Login to Server:‚Äù<br>
fi<br>
done</p>
<p>if [ ! ‚Äú$authorized‚Äù == ‚Äútrue‚Äù ];then<br>
msgheader=‚ÄúUnauthorized Login to Server:‚Äù<br>
message|mail -s ‚Äú$SUBJECT‚Äù ‚Äú$NOTIFY_EMAIL‚Äù <span class="hashtag">#Unauthorized</span><br>
<span class="hashtag">#person</span> logged in‚Ä¶<br>
fi</p>
<p>My IP file format is like this:</p>
<p>KNOWN_IPS="<br>
38.38.38.1 <span class="hashtag">#--</span> My House<br>
48.48.48.2 <span class="hashtag">#--</span> Server XYZ<br>
50.51.52.53 <span class="hashtag">#--</span> Some other IP<br>
"</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>
  <div itemscope itemtype='http://schema.org/DiscussionForumPosting'>
      <div class='creator'>
        <span>
          <a href='/u/jsmith'><b itemprop='author'>jsmith</b></a>
          (Jared K  Smith)
            closed 
            <time itemprop='datePublished' datetime='2019-11-22T10:15:48Z'>
              2019-11-22 10:15:48 UTC
            </time>
        </span>
        <span itemprop='position'>#14</span>
      </div>
      <div class='post' itemprop='articleBody'>
        <p>This topic was automatically closed 31 hours after the last reply. New replies are no longer allowed.</p>
      </div>
      <meta itemprop='interactionCount' content='UserLikes:0'>
      <meta itemprop='interactionCount' content='UserComments:0'>
      <meta itemprop='headline' content='FreePBX Security Vulnerability SEC-2019-001'>
      <hr>
  </div>






    </div>
    <footer class="container">
      <nav class='crawler-nav' itemscope itemtype='http://schema.org/SiteNavigationElement'>
        <a href='/'>Home</a>
        <a href="/categories">Categories</a>
        <a href="/guidelines">FAQ/Guidelines</a>
        <a href="/tos">Terms of Service</a>
        <a href="/privacy">Privacy Policy</a>
      </nav>
      <p class='powered-by-link'>Powered by <a href="https://www.discourse.org">Discourse</a>, best viewed with JavaScript enabled</p>
    </footer>
    
  <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
  
</html>
