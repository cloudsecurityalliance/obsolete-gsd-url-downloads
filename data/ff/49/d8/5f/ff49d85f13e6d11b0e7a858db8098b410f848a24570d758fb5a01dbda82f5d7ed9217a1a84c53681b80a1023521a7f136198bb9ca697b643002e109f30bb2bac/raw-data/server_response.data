<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #67730 - RDF' href='rss/bug.php?id=67730'>
        <link rel='alternate' type='application/rss+xml' title='GD related Bug #67730 - RSS 2.0' href='rss/bug.php?id=67730&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Sec Bug #67730 :: CVE-2014-5120 Null byte injection possible with imagexxx functions</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=67730">Sec Bug</a>&nbsp;#67730</th>
            <td id="summary" colspan="5">CVE-2014-5120 Null byte injection possible with imagexxx functions</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2014-07-31 20:37 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2014-08-19 08:35 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>ryan &#x61;&#116; rmauger &#x64;&#111;&#x74; co &#x64;&#111;&#x74; uk</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=stas">stas</a> (<a href="https://people.php.net/stas">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=GD+related">GD related</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>5.6.0RC2</td>
            <th class="details">OS:</th>
            <td>All</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-5120" target="_blank">2014-5120</a></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=67730&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=67730&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=67730&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1406839026">&nbsp;</a><strong>[2014-07-31 20:37 UTC] ryan &#x61;&#116; rmauger &#x64;&#111;&#x74; co &#x64;&#111;&#x74; uk</strong>
<pre class='note'>Description:
------------
The paths passed to the imagepng, imagejpeg, imagegif, imagewebp and imagewbmp functions are not validated to not contain null bytes, and as such may allow paths to be prematurely terminated by an attacker.

This could be used to overwrite a file in a location other than the intended destination.

The attached patch will check for null bytes in the given path, and return false, raising a warning in the event a null byte is encountered.

Test script:
---------------
phpt tests are included in the patch.


</pre>
</div><h2>Patches</h2>
<a href="patch-display.php?bug_id=67730&amp;patch=gd-null-injection&amp;revision=latest" >gd-null-injection</a>
(last revision 2014-08-04 06:48 UTC by stas@php.net)
<br><p><a href='patch-add.php?bug_id=67730'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=67730'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_patch' ><a name="1407134918">&nbsp;</a><strong>[2014-08-04 06:48 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>The following patch has been added/updated:

Patch Name: gd-null-injection
Revision:   1407134918
URL:        <a href="https://bugs.php.net/patch-display.php?bug=67730&amp;patch=gd-null-injection&amp;revision=1407134918" rel="nofollow">https://bugs.php.net/patch-display.php?bug=67730&amp;patch=gd-null-injection&amp;revision=1407134918</a>
</pre>
</div><div class='comment type_comment' ><a name="1407139654">&nbsp;</a><strong>[2014-08-04 08:07 UTC] ryan &#x61;&#116; rmauger &#x64;&#111;&#x74; co &#x64;&#111;&#x74; uk</strong>
<pre class='note'>Stas, Was the patch I supplied not ok? I seem to be unable to view what you have changed, or even see the patch I uploaded
</pre>
</div><div class='comment type_comment' ><a name="1407140240">&nbsp;</a><strong>[2014-08-04 08:17 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>That was the patch that was supplied, no other patch was attached to the bug before that.
</pre>
</div><div class='comment type_log' ><a name="1407217183">&nbsp;</a><strong>[2014-08-05 05:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: stas</span>
</div></div></div><div class='comment type_comment' ><a name="1407217184">&nbsp;</a><strong>[2014-08-05 05:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Go ahead, 5.4+, not sure Johannes likes it in 5.3 too :)
</pre>
</div><div class='comment type_log' ><a name="1407217186">&nbsp;</a><strong>[2014-08-05 05:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Open</span>
</div></div></div><div class='comment type_comment' ><a name="1407217186">&nbsp;</a><strong>[2014-08-05 05:39 UTC] <a href="//people.php.net/pajoye">pajoye@php.net</a></strong>
<pre class='note'>Go ahead, 5.4+, not sure Johannes likes it in 5.3 too :)
</pre>
</div><div class='comment type_comment' ><a name="1407241251">&nbsp;</a><strong>[2014-08-05 12:20 UTC] <a href="//people.php.net/johannes">johannes@php.net</a></strong>
<pre class='note'>I think the risk of exploiting this is quite small as it requires users to take unverified paths and the attacker can access only images of a specific type to which he also has to know the path (unless error reporting is switched on the attacker can't even distinguish between &quot;file does not exist&quot; and &quot;file is not an image of that type&quot;)

Nonetheless the fix is quite trivial, so adding it to 5.3 looks fine.
</pre>
</div><div class='comment type_comment' ><a name="1407947696">&nbsp;</a><strong>[2014-08-13 16:34 UTC] <a href="//people.php.net/johannes">johannes@php.net</a></strong>
<pre class='note'>Note on 5.3: In 5.3 we already have the check

 94         if (strlen(file) != file_len) {
 95             RETURN_FALSE;
 96         }

The issue was introduced with 5.4 while cleaning up stream usage after safe_mode removal. My previous comment on 5.3 can therefore be ignored.
</pre>
</div><div class='comment type_log' ><a name="1408427278">&nbsp;</a><strong>[2014-08-19 05:47 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-CVE-ID:</span>
<span class="added">+CVE-ID: 2014-5120</span>
</div></div></div><div class='comment type_log' ><a name="1408437329">&nbsp;</a><strong>[2014-08-19 08:35 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Assigned</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_comment' ><a name="1408437329">&nbsp;</a><strong>[2014-08-19 08:35 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>The fix for this bug has been committed.

Snapshots of the sources are packaged every three hours; this change
will be in the next snapshot. You can grab the snapshot at
<a href="http://snaps.php.net/" rel="nofollow">http://snaps.php.net/</a>.

 For Windows:

<a href="http://windows.php.net/snapshots/" rel="nofollow">http://windows.php.net/snapshots/</a>
 
Thank you for the report, and for helping us make PHP better.


</pre>
</div><div class='comment type_comment' ><a name="1408451441">&nbsp;</a><strong>[2014-08-19 12:30 UTC] <a href="//people.php.net/kaplan">kaplan@php.net</a></strong>
<pre class='note'>Fix was done in commit 706aefb78112a44d4932d4c9430c6a898696f51f
</pre>
</div><div class='comment type_svn' ><a name="1408457596">&nbsp;</a><strong>[2014-08-19 14:13 UTC] <a href="//people.php.net/jpauli">jpauli@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=1daa4c0090b7cd8178dcaa96287234c69ac6ca18" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=1daa4c0090b7cd8178dcaa96287234c69ac6ca18</a>
Log: Fix <a href='bug.php?id=67730'>bug #67730</a> - Null byte injection possible with imagexxx functions
</pre>
</div><div class='comment type_svn' ><a name="1409109464">&nbsp;</a><strong>[2014-08-27 03:17 UTC] <a href="//people.php.net/tyrael">tyrael@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=c9da6430d37326e866ccae28aa5a4f835a459071" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=c9da6430d37326e866ccae28aa5a4f835a459071</a>
Log: Fix <a href='bug.php?id=67730'>bug #67730</a> - Null byte injection possible with imagexxx functions
</pre>
</div><div class='comment type_svn' ><a name="1412723606">&nbsp;</a><strong>[2014-10-07 23:13 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src-security.git;a=commit;h=706aefb78112a44d4932d4c9430c6a898696f51f" rel="nofollow">http://git.php.net/?p=php-src-security.git;a=commit;h=706aefb78112a44d4932d4c9430c6a898696f51f</a>
Log: Fix <a href='bug.php?id=67730'>bug #67730</a> - Null byte injection possible with imagexxx functions
</pre>
</div><div class='comment type_svn' ><a name="1412724276">&nbsp;</a><strong>[2014-10-07 23:24 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src-security.git;a=commit;h=706aefb78112a44d4932d4c9430c6a898696f51f" rel="nofollow">http://git.php.net/?p=php-src-security.git;a=commit;h=706aefb78112a44d4932d4c9430c6a898696f51f</a>
Log: Fix <a href='bug.php?id=67730'>bug #67730</a> - Null byte injection possible with imagexxx functions
</pre>
</div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
