<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d - platform/frameworks/av - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/frameworks/av/%2B/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/">frameworks</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/av/">av</a> / <span class="Breadcrumbs-crumb">cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d</td><td><span>[<a href="/platform/frameworks/av/+log/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d">log</a>]</span> <span>[<a href="/platform/frameworks/av/+archive/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Joshua J. Drake &lt;android-open-source@qoop.org&gt;</td><td>Wed Apr 08 23:23:55 2015 -0500</td></tr><tr><th class="Metadata-title">committer</th><td>The Android Automerger &lt;android-build@google.com&gt;</td><td>Thu Jul 09 14:02:59 2015 -0700</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/">2ba382f23813c0a8acc9a206e4f6dd09527731a1</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d%5E">22412164dee9f658272a25833aebe83d05dfe4ff</a> <span>[<a href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Fix several ineffective integer overflow checks

Commit edd4a76 (which addressed bugs 15328708, 15342615, 15342751) added
several integer overflow checks. Unfortunately, those checks fail to take into
account integer promotion rules and are thus themselves subject to an integer
overflow. Cast the sizeof() operator to a uint64_t to force promotion while
multiplying.

Bug: 20139950

(cherry picked from commit e2e812e58e8d2716b00d7d82db99b08d3afb4b32)

Change-Id: <a href="https://android-review.googlesource.com/#/q/I080eb3fa147601f18cedab86e0360406c3963d7b">I080eb3fa147601f18cedab86e0360406c3963d7b</a>
</pre><ul class="DiffTree"><li><a href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/media/libstagefright/SampleTable.cpp">media/libstagefright/SampleTable.cpp</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d%5E%21/#F0">diff</a>]</span></li></ul><div class="DiffSummary">1 file changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: 2ba382f23813c0a8acc9a206e4f6dd09527731a1</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - CleanSpec.mk"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/CleanSpec.mk">CleanSpec.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - MODULE_LICENSE_APACHE2"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/MODULE_LICENSE_APACHE2">MODULE_LICENSE_APACHE2</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NOTICE"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/NOTICE">NOTICE</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - camera/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/camera/">camera/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cmds/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/cmds/">cmds/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - drm/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/drm/">drm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - include/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/include/">include/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - media/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/media/">media/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - services/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/services/">services/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - soundtrigger/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/soundtrigger/">soundtrigger/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tools/"><a class="FileList-itemLink" href="/platform/frameworks/av/+/cf1581c66c2ad8c5b1aaca2e43e350cf5974f46d/tools/">tools/</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>