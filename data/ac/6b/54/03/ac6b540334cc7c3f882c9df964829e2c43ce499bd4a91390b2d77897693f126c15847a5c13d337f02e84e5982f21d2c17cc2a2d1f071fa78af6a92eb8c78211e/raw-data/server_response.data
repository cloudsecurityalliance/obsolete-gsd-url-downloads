<!DOCTYPE html>
<html lang="en">
<head>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92665328-1"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-92665328-1');
    </script>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>[CVE-2017-0433] Google Nexus Synaptics Touchscreen Firmware Injection</title>
<meta name="name" content="CVE-2017-0433">
<meta name="description" content="Google Nexus Synaptics Touchscreen Firmware Injection">
<meta name="image" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@alephsecurity">
<meta name="twitter:creator" content="@alephsecurity">
<meta name="twitter:title" content="CVE-2017-0433">
<meta name="twitter:url" content="https://alephsecurity.com/vulns/aleph-2016001">
<meta name="twitter:description" content="Google Nexus Synaptics Touchscreen Firmware Injection">
<meta name="twitter:image:src" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta property="og:site_name" content="">
<meta property="og:title" content="CVE-2017-0433">
<meta property="og:type" content="article">
<meta property="og:description" content="Google Nexus Synaptics Touchscreen Firmware Injection">
<meta property="og:url" content="https://alephsecurity.com/vulns/aleph-2016001">
<meta property="article:published_time" content="2017-02-06T00:00:00+00:00">
<meta property="article:author" content="https://alephsecurity.com">
<meta property="og:image" content="https://alephsecurity.com/assets/img/logo-black.png">
<link rel="icon" href="/favicon.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700">
<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: "none",
      tex2jax: {preview: "none"},
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG: { linebreaks: { automatic: true } }
    });
    </script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
<div class="wrapper">
<div class="page__back">
<a href="/">&lt;-- <span class="smallogo">א</span></a>
</div>
<div class="page">
<div class="advisory">
<div class="advisory__title">
<h1>Google Nexus Synaptics Touchscreen Firmware Injection</h1>
</div>
<div class="advisory__subtitle">
Aleph Research Advisory
</div>
<div class="advisory__meta">
<p></p>
</div>
<h2>Identifier</h2>
<div class="cve-high"><span class="" title="Google Nexus Synaptics Touchscreen Firmware Injection"><a href="/vulns/aleph-2016001">CVE-2017-0433</a></span></div>
<h2>Severity</h2>
High
<h2>Products</h2>
<div class="numberedlistnoalternative">
<ol>
<li><p>Nexus 6P</p>
</li>
<li><p>Nexus 9</p>
</li>
<li><p>Android One</p>
</li>
<li><p>Pixel</p>
</li>
<li><p>Pixel XL</p>
</li>
</ol>
</div>
<h2>Vulnerable Versions</h2>
<div class="numberedlistnoalternative">
<ol>
<li>
<p>Verified on Nexus 9 6.0.1/MOB30W</p>
</li>
<li>
<p>Verified on Nexus 9 7.0/NRD90M</p>
</li>
</ol>
</div>
<h2>Technical Details</h2>
<div class="advisory__content" ?>
<p>Due to lenient SELinux and DAC policy, vulnerable Synaptics DSX (touchscreen driver) sysfs file entires are exposed to an attacker that executes code within the mediaserver context on Android M 6.0.1 and system_server, bluetooth, nfc contexts on Android N 7.0 (or any other SELinux domain that has target type sysfs with the open and write permissions on file class). These vulnerable sysfs entries allows an attacker to inject a flawed firmware image, through user-space, onto the Synaptics touchscreen controller.</p>
<p>Synaptic’s Touchscreen controllers are built on top of a proprietary 16-bit microcontroller. So no datasheets to help us reverse engineer it. Nevertheless, we could still infer the firmware image layout by peeking into Synaptic’s touchscreen firmware update mechanism inside the kernel. A high level representation:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+----------+--------------------+----------+
|          |                    |          |
| FIRMWARE | ENCRYPTED FIRMWARE | FIRMWARE |
|  HEADER  |         BLOB       |  CONFIG  |
|          |                    |          |
+----------+--------------------+----------+
</code></pre></div></div>
<p>When provided with a firmware image, the update mechanism carves out its “firmware_id” ( a field within the header) and queries the touchscreen controller for its current “firmware_id”. If the former is greater than the latter the firmware is flashed to the controller.</p>
<p>We crafted a flawed firmware image that consists of a higher “firmware_id” and a messed up encrypted firmware blob (we zeroed some bytes within it) and were able to flash it successfully to the controller.</p>
<p>The Synaptic’s controller does not defend against Ciphertext Malleability attacks by using Digital Signatures or Message Authentication Codes.</p>
</div>
<h2>Timeline</h2>
<div class="list"><ul><li><div class="list__date"><span>01-Mar-17<span></div>: Added as <span class="cve-high" title="Google Nexus Synaptics Touchscreen Firmware Injection"><a href="/vulns/aleph-2016001">ALEPH-2016001</a></span>.</li><li><div class="list__date"><span>06-Feb-17<span></div>: Public disclosure.</li></ul></div>
<h2>Credit</h2>
<div class="list">
<ul>
<li>
<a href="https://sagi.io/">Sagi Kedmi</a> (<a href="https://twitter.com/sagikedmi">@sagikedmi</a>)
</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
