<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1659013003: Don&#39;t reset LoadEventProgress if frame unload has already started. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '28352de1a19da21bb7b46e86fe207a72';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1659013003%252526ust%25253D1608724648219554%252526usg%25253DAFQjCNGupOPX85Vb7Sq-TaOTo6yATttQrA%26service%3Dah">Sign out</a>

</div>
<div class="counter">(538)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1659013003">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1659013003/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1659013003</a>:
    Don&#39;t reset LoadEventProgress if frame unload has already started.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 10 months ago by <a href="/user/dcheng" onMouseOver="M_showUserInfoPopup(this)">dcheng</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 10 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/kinuko" onMouseOver="M_showUserInfoPopup(this)">kinuko</a></span>, <span class='approval'><a href="/user/Nate%20Chapin" onMouseOver="M_showUserInfoPopup(this)">Nate Chapin</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            blink-reviews, blink-reviews-dom_chromium.org, chromium-reviews, dglazkov+blink, eae+blinkwatch, rwlbuis, sof
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Disable sub frame loads more reliably in frame detach.

Previously, guarding against attaching a new frame in frame detach
was done by inspecting LoadEventProgress. There are certain
operations, such as document.open(), that can cause LoadEventProgress
to never advance, causing the guard to get skipped.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=577105">577105</a>
Committed: <a href="https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b">https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b</a>
Cr-Commit-Position: refs/heads/master@{#373581}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1659013003/#ps1"
       onclick="M_toggleSectionForPS('1659013003', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1659013003/#ps20001"
       onclick="M_toggleSectionForPS('1659013003', '20001')"
       class="toggled-section ">
      Patch Set 2
      : .
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1659013003/#ps40001"
       onclick="M_toggleSectionForPS('1659013003', '40001')"
       class="toggled-section ">
      Patch Set 3
      : test
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 5
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1659013003/#ps60001"
       onclick="M_toggleSectionForPS('1659013003', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Better fix
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 1
      
    </div>
  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1659013003/#ps80001"
       onclick="M_toggleSectionForPS('1659013003', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Fix unit test and adjust comments.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 2
      
    </div>
  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1659013003/#ps100001"
       onclick="M_toggleSectionForPS('1659013003', '100001')"
       class="toggled-section ">
      Patch Set 6
      : Components fix
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-100001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-120001-pointer"
       href="/1659013003/#ps120001"
       onclick="M_toggleSectionForPS('1659013003', '120001')"
       class="toggled-section opentriangle">
      Patch Set 7
      : One more disabler
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-120001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 10 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1659013003_120001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1659013003/120001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+59 lines, -6 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130002">
            third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+25 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130002.diff"
             title="Download patch for third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130001">
            third_party/WebKit/LayoutTests/fast/frames/open-then-unload-expected.txt
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload-expected.txt">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload-expected.txt"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload-expected.txt"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+11 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130001.diff"
             title="Download patch for third_party/WebKit/LayoutTests/fast/frames/open-then-unload-expected.txt">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130003">
            third_party/WebKit/Source/core/frame/LocalFrame.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/Source/core/frame/LocalFrame.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1659013003/diff2/40001:120001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1659013003/diff2/60001:120001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130003.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/LocalFrame.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130004">
            third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1659013003/diff2/40001:120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1659013003/diff2/60001:120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1659013003/diff2/80001:120001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+10 lines, -6 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130004.diff"
             title="Download patch for third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130005">
            third_party/WebKit/Source/core/loader/FrameLoader.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1659013003/diff2/40001:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1659013003/diff2/60001:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 4">4</a>
        
          <a href="/1659013003/diff2/80001:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 5">5</a>
        
          <a href="/1659013003/diff2/100001:120001/third_party/WebKit/Source/core/loader/FrameLoader.cpp"
             title="Delta from patch set 6">6</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+8 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130005.diff"
             title="Download patch for third_party/WebKit/Source/core/loader/FrameLoader.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1659013003/patch/120001/130006">
            third_party/WebKit/Source/web/WebLocalFrameImpl.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1659013003/diff/120001/third_party/WebKit/Source/web/WebLocalFrameImpl.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1659013003/diff2/1:120001/third_party/WebKit/Source/web/WebLocalFrameImpl.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/1659013003/diff2/20001:120001/third_party/WebKit/Source/web/WebLocalFrameImpl.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/1659013003/diff2/40001:120001/third_party/WebKit/Source/web/WebLocalFrameImpl.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/1659013003/diff2/60001:120001/third_party/WebKit/Source/web/WebLocalFrameImpl.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1659013003_120001_130006.diff"
             title="Download patch for third_party/WebKit/Source/web/WebLocalFrameImpl.cpp">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 120001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 37 (15 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 37)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 37)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(37)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(37)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          Description was changed from ========== Fix BUG=577105 ========== to ========== Don&#39;t reset LoadEventProgress if frame ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 03:06:31 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >Description was changed from

==========
Fix

BUG=577105
==========

to

==========
Don&#39;t reset LoadEventProgress if frame unload has already started.

LoadEventProgress is used to guard against creation of additional
subframes during frame detach. Calling document.open() without ever
calling document.close() results in a situation where
LoadEventProgress is never advanced during frame detach, causing
the logic to guard against subframe loads in detach to be skipped.

BUG=577105
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          dcheng@chromium.org changed reviewers: + japhet@chromium.org, kinuko@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 03:06:31 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:japhet@chromium.org">japhet@chromium.org</a>, <a href="mailto:kinuko@chromium.org">kinuko@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html File third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html (right): https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html#newcode10 third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html:10: window[0].document.open(); At this point, LoadEventProgress gets reset to LoadEventNotRun ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 03:13:29 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            ><a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Layo...</a>
File third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html (right):

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html#newcode10" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Layo...</a>
third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html:10:
window[0].document.open();
At this point, LoadEventProgress gets reset to LoadEventNotRun without my patch.

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html#newcode11" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Layo...</a>
third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html:11:
window[0].document.appendChild(document.createElement(&#39;iframe&#39;));
Right now, our tree looks like this:

[Main frame]
     |
  [Child A] (m_loadEventProgress == LoadEventNotRun)

Since this child frame won&#39;t run unload events, we nest another frame under
Child A:

[Main frame]
     |
  [Child A] (m_loadEventProgress == LoadEventNotRun)
     |
  [Child B] (m_loadEventProgress == LoadEventCompleted)

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html#newcode13" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Layo...</a>
third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html:13:
window[0].document.documentElement.appendChild(document.createElement(&#39;iframe&#39;));
Since Child B&#39;s load event progress is normal, we can use an unload handler to
try to attach a frame to [Child A] as it is navigating.

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html#newcode14" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Layo...</a>
third_party/WebKit/LayoutTests/fast/frames/open-then-unload.html:14:
shouldBe(&#39;1&#39;, &#39;window[0].length&#39;);
If the iframe load is blocked, then window[0].length should remain at 1.

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Source/core/dom/Document.cpp" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/dom/Document.cpp (right):

<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Source/core/dom/Document.cpp#newcode2776" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/dom/Document.cpp:2776: m_loadEventProgress =
UnloadEventHandled;
This was the original fix proposed in the bug. I believe it is insufficient.

1. Page starts XHR that never completes.
2. Navigation starts.
3. Provisional navigation prepares to commit.
4. Unload handlers run. At this point, m_loadEventProgres == UnloadEventHandled.
5. Now XHR abort handlers run.
6. XHR abort handler calls document.open(), which resets m_loadEventProgress to
LoadEventNotRun.
7. Now, XHR abort handler can attach a child frame during frame detach again.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          The CQ bit was checked by dcheng@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 03:13:35 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/40001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/40001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 03:13:54 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/40001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/40001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/40001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/40001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 04:55:28 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 04:55:29 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          Description was changed from ========== Don&#39;t reset LoadEventProgress if frame unload has already started. LoadEventProgress ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 08:41:23 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >Description was changed from

==========
Don&#39;t reset LoadEventProgress if frame unload has already started.

LoadEventProgress is used to guard against creation of additional
subframes during frame detach. Calling document.open() without ever
calling document.close() results in a situation where
LoadEventProgress is never advanced during frame detach, causing
the logic to guard against subframe loads in detach to be skipped.

BUG=577105
==========

to

==========
Disable sub frame loads more reliably in frame detach.

Previously, guarding against attaching a new frame in frame detach
was done by inspecting LoadEventProgress. There are certain
operations, such as document.open(), that can cause LoadEventProgress
to never advance, causing the guard to get skipped.

BUG=577105
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          I found a better (and more reliable way) to do this. We should still probably ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 08:42:17 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >I found a better (and more reliable way) to do this. We should still probably
make the document.open() fixes, but that can be done in a separate bug:
<a href="https://crbug.com/583586" rel="nofollow">https://crbug.com/583586</a>

<a href="https://codereview.chromium.org/1659013003/diff/60001/third_party/WebKit/Source/core/loader/FrameLoader.cpp" rel="nofollow">https://codereview.chromium.org/1659013003/diff/60001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/loader/FrameLoader.cpp (right):

<a href="https://codereview.chromium.org/1659013003/diff/60001/third_party/WebKit/Source/core/loader/FrameLoader.cpp#newcode1047" rel="nofollow">https://codereview.chromium.org/1659013003/diff/60001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/loader/FrameLoader.cpp:1047:
SubframeLoadingDisabler disabler(m_frame-&gt;document());
Here, m_frame-&gt;document() might be null during the commit of the initial empty
page.

The other alternative was to make SubframeLoadingDisabler not stack allocated,
but that gets complicated as well.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          The CQ bit was checked by dcheng@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 08:42:34 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/60001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/60001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 08:42:50 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/60001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/60001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/60001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 09:42:47 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          Dry run: Try jobs failed on following builders: linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/175501)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 09:42:47 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >Dry run: Try jobs failed on following builders:
  linux_chromium_rel_ng on tryserver.chromium.linux (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_rel_ng/builds/175501" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Mariusz Mlynski</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          On 2016/02/03 03:13:29, dcheng wrote: &gt; https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Source/core/dom/Document.cpp#newcode2776 &gt; third_party/WebKit/Source/core/dom/Document.cpp:2776: m_loadEventProgress = &gt; UnloadEventHandled; &gt; This ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 10:21:35 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >On 2016/02/03 03:13:29, dcheng wrote:
&gt;
<a href="https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Source/core/dom/Document.cpp#newcode2776" rel="nofollow">https://codereview.chromium.org/1659013003/diff/40001/third_party/WebKit/Sour...</a>
&gt; third_party/WebKit/Source/core/dom/Document.cpp:2776: m_loadEventProgress =
&gt; UnloadEventHandled;
&gt; This was the original fix proposed in the bug. I believe it is insufficient.
&gt; 
&gt; 1. Page starts XHR that never completes.
&gt; 2. Navigation starts.
&gt; 3. Provisional navigation prepares to commit.
&gt; 4. Unload handlers run. At this point, m_loadEventProgres ==
UnloadEventHandled.
&gt; 5. Now XHR abort handlers run.
&gt; 6. XHR abort handler calls document.open(), which resets m_loadEventProgress
to
&gt; LoadEventNotRun.
&gt; 7. Now, XHR abort handler can attach a child frame during frame detach again.

FWIW, calling document.open() in step #6 would cause the provisional document
loader to be detached (Document::open does
|m_frame-&gt;loader().stopAllLoaders()|), so the navigation started in step #2
would be safely aborted (when DocumentLoader::processData null-checks the
frameLoader later on). It&#39;d assert in Document::detach, though, so I agree it&#39;s
suboptimal.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kinuko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          This looks reasonable to me, but it looks it breaks some test like WebViewTest.AddFrameInCloseURLUnload... where ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 12:23:33 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >This looks reasonable to me, but it looks it breaks some test like
WebViewTest.AddFrameInCloseURLUnload... where we directly call
dispatchUnloadEvent().  Should the test be updated?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          The CQ bit was checked by dcheng@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 22:56:19 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          On 2016/02/03 at 12:23:33, kinuko wrote: &gt; This looks reasonable to me, but it looks ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 22:56:52 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >On 2016/02/03 at 12:23:33, kinuko wrote:
&gt; This looks reasonable to me, but it looks it breaks some test like
WebViewTest.AddFrameInCloseURLUnload... where we directly call
dispatchUnloadEvent().  Should the test be updated?

I updated dispatchUnloadEvent() to also instantiate a SubframeLoadingDisabler,
to keep things consistent between the non-process-swap and the process-swap
case. PTAL.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/80001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/80001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 22:57:13 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/80001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/80001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/80001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:14:56 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          Dry run: Try jobs failed on following builders: linux_chromium_compile_dbg_32_ng on tryserver.chromium.linux (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_compile_dbg_32_ng/builds/153994) mac_chromium_compile_dbg_ng on ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:14:57 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >Dry run: Try jobs failed on following builders:
  linux_chromium_compile_dbg_32_ng on tryserver.chromium.linux (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_compile_dbg_32_ng/builds/153994" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.linux/builders/linux_chromium_...</a>)
  mac_chromium_compile_dbg_ng on tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_compile_dbg_ng/builds/154514" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/mac_chromium_comp...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Nate Chapin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h File third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h (right): https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h#newcode116 third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h:116: explicit SubframeLoadingDisabler(Node* root) Do we have to have constructors ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:25:14 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            ><a href="https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h" rel="nofollow">https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h (right):

<a href="https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h#newcode116" rel="nofollow">https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h:116: explicit
SubframeLoadingDisabler(Node* root)
Do we have to have constructors for both a pointer and a reference? That seems
kind of lame.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          Also uploading a fix for the component build. https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h File third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h (right): https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h#newcode116 third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h:116: explicit ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:33:31 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            >Also uploading a fix for the component build.

<a href="https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h" rel="nofollow">https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h (right):

<a href="https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h#newcode116" rel="nofollow">https://codereview.chromium.org/1659013003/diff/80001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/html/HTMLFrameOwnerElement.h:116: explicit
SubframeLoadingDisabler(Node* root)
On 2016/02/03 at 23:25:14, Nate Chapin wrote:
&gt; Do we have to have constructors for both a pointer and a reference? That seems
kind of lame.

A pre-Oilpan alternative is to just keep the reference constructor. Then we
could do something like:

OwnPtr&lt;SubframeLoadingDisabler&gt; disabler;
if (m_frame-&gt;document())
  disabler.reset(new SubframeLoadingDisabler(*m_frame-&gt;document()));

But this doesn&#39;t work with Oilpan: SubframeLoadingDisabler would have to become
a garbage collected class, but then it references a garbage collected member in
the destructor, and all sorts of complexity.

I just added the pointer version because it is still nice to assert that the
passed in Node* is not null (which is true 99% of the time).

An alternative (which I want to try following up on) is to rearrange
prepareForCommit() to make it so we only take this branch if document is not
null, but that&#39;s a bigger change and harder to merge.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          The CQ bit was checked by dcheng@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:37:11 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/100001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/100001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-03 23:37:59 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/100001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/100001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 02:36:57 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 02:36:58 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          The CQ bit was checked by dcheng@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 08:53:58 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/120001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 08:54:07 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-27"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/120001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 10:24:05 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-28"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-29">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 10:24:06 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-29"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg31"
           name="30">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(30)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>kinuko</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-30">
                          lgtm, though you&#39;d probably want to wait for Nate&#39;s stamp :)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 15:11:35 UTC)
                <a href="#msg31">#31</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-30"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-30"
            >lgtm, though you&#39;d probably want to wait for Nate&#39;s stamp :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg32"
           name="31">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(31)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Nate Chapin</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-31">
                          lgtm
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:08:27 UTC)
                <a href="#msg32">#32</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-31"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-31"
            >lgtm</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg33"
           name="32">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(32)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-32">
                          The CQ bit was checked by dcheng@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:09:59 UTC)
                <a href="#msg33">#33</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-32"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-32"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg34"
           name="33">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(33)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-33">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1659013003/120001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:11:17 UTC)
                <a href="#msg34">#34</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-33"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-33"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1659013003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1659013003/120001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1659013003/120001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg35"
           name="34">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(34)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-34">
                          Committed patchset #7 (id:120001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:17:31 UTC)
                <a href="#msg35">#35</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-34"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-34"
            >Committed patchset #7 (id:120001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg36"
           name="35">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(35)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-35">
                          Description was changed from ========== Disable sub frame loads more reliably in frame detach. Previously, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:18:33 UTC)
                <a href="#msg36">#36</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-35"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-35"
            >Description was changed from

==========
Disable sub frame loads more reliably in frame detach.

Previously, guarding against attaching a new frame in frame detach
was done by inspecting LoadEventProgress. There are certain
operations, such as document.open(), that can cause LoadEventProgress
to never advance, causing the guard to get skipped.

BUG=577105
==========

to

==========
Disable sub frame loads more reliably in frame detach.

Previously, guarding against attaching a new frame in frame detach
was done by inspecting LoadEventProgress. There are certain
operations, such as document.open(), that can cause LoadEventProgress
to never advance, causing the guard to get skipped.

BUG=577105

Committed: <a href="https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b" rel="nofollow">https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b</a>
Cr-Commit-Position: refs/heads/master@{#373581}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg37"
           name="36">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(36)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-36">
                          Patchset 7 (id:??) landed as https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b Cr-Commit-Position: refs/heads/master@{#373581}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-04 19:18:35 UTC)
                <a href="#msg37">#37</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-36"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-36"
            >Patchset 7 (id:??) landed as
<a href="https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b" rel="nofollow">https://crrev.com/a4bcdcb1f8df4f7427e208201501a9d8e41e386b</a>
Cr-Commit-Position: refs/heads/master@{#373581}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 37)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 37)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(37)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(37)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 37;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1659013003;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1659013003: Don&#39;t reset LoadEventProgress if frame unload has already started.
     (Closed) </b><br/>
      Created 4 years, 10 months ago by dcheng<br/>
      Modified 4 years, 10 months ago<br/>
      Reviewers: Nate Chapin, kinuko<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 8
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
