<!DOCTYPE html>
<html lang="en">
  <head>
    <title>276235 &ndash; (CVE-2009-2295) &lt;dev-ml/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/1dee87cdc229fb032852e53a39a3c8b5.css?1635279638" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1635279638"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "276235 – (CVE-2009-2295) \x3cdev-ml\/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})",
                             "show_bug.cgi?id=276235" );
        document.title = "276235 – (CVE-2009-2295) \x3cdev-ml\/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "276235 – (CVE-2009-2295) \x3cdev-ml\/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1635279638"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Gentoo's Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><script language="JavaScript" src="extensions/Gentoo/web/gentoo.js"></script>
  </head>

  <body 
        class="bugs-gentoo-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_Gentoo_Security
                 bz_component_Vulnerabilities
                 bz_bug_276235 yui-skin-sam">
<div id="gentoo-bar">
	<a href="/" title="Go to the Gentoo Bugzilla homepage" class="home-link">
		<img src="extensions/Gentoo/web/gentoo_org.png" alt="Gentoo Websites Logo" />
	</a>

	<div>
		Go to: 
		<a href="https://www.gentoo.org/">Gentoo Home</a>
		<a href="https://www.gentoo.org/support/documentation/">Documentation</a>
		<a href="https://forums.gentoo.org/">Forums</a>
		<a href="https://www.gentoo.org/get-involved/mailing-lists/">Lists</a>
		<a href="/" class="active">Bugs</a>
		<a href="https://planet.gentoo.org/">Planet</a>
		<a href="https://www.gentoo.org/inside-gentoo/stores/">Store</a>
		<a href="https://wiki.gentoo.org/">Wiki</a>
		<strong><a href="https://www.gentoo.org/downloads/">Get Gentoo!</a></strong>
	</div>
</div>

  <div id="header"><div id="banner">
  </div>

    <div id="titles">
      <span id="title">Gentoo's Bugzilla &ndash; Bug&nbsp;276235</span>

        <span id="subtitle" class="subheader">&lt;dev-ml/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})</span>

        <span id="information" class="header_addl_info">Last modified: 2010-06-01 15:44:34 UTC node [gannet]</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=276235&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=276235" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=276235&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635619241-Y9f6W5ITgroSa_3xsK5TbQvR32CfPLTgCaq6OhGlvOE">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body"><!--<div style="border: 1px solid #ebccd1; background-color: #f2dede; color: #a94442; padding: 0.4em; margin-bottom: 0.4em;">critical goes here ...</div>-->
<!--<div id="message">
Bugzilla DB migration completed. Please report issues to Infra team via email via infra@gentoo.org or IRC
</div>-->


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2010-06-01 15:44:34">
  <input type="hidden" name="id" value="276235">
  <input type="hidden" name="token" value="1635619241-3AyJNQdmGWjtdeJNgv8zmkknuFKucNDWykD09jE-5gQ">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=276235"><b>Bug&nbsp;276235</b></a> <span id="summary_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2009-2295</span>)
      - <span id="short_desc_nonedit_display">&lt;dev-ml/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>&lt;dev-ml/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      '\x3cdev-ml\/camlimages-3.0.1 integer overflows (CVE-2009-{2295,2660})' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>CVE-2009-2295
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Gentoo Security

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Gentoo Security"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Vulnerabilities

  (<a href="buglist.cgi?component=Vulnerabilities&amp;product=Gentoo%20Security&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">All
        Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>High
       normal<span id="votes_container">
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=276235#vote_276235">vote</a>)
  </span>
      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Gentoo Security</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security\x40gentoo.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
          <a href="http://www.ocert.org/advisories/ocert-2009-009.html"
             rel="noreferrer"><span title="http://www.ocert.org/advisories/ocert-2009-009.html">http://www.ocert.org/advisories/ocert...
        </span></a>
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>B2 [glsa]  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2009-07-02 13:48 UTC by <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2010-06-01 15:44 UTC
      (<a href="show_activity.cgi?id=276235">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>2 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="ml">ml</option>
                <option value="newt">newt</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 
<tr>
      <th class="field_label "
    id="field_label_cf_stabilisation_atoms">


  <a 
      title="Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_stabilisation_atoms"
  >Package list:</a>

</th>
  <td class="field_value "
      id="field_container_cf_stabilisation_atoms" >
      <div class="uneditable_textarea"></div>

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_runtime_testing_required">


  <a 
      title="Indicate if runtime testing is required for this stabilisation request, or if it is sufficient to stabilised with a build/tests/qa test."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_runtime_testing_required"
  >Runtime testing required:</a>

</th>
  <td class="field_value "
      id="field_container_cf_runtime_testing_required" >---

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=199108"
               title="View the content of the attachment">
          <b>camlimages-3.0.1-CVE-2009-2295.patch</b></a>

          <span class="bz_attach_extra_info">
              (camlimages-3.0.1-CVE-2009-2295.patch,4.25 KB,
                patch)

            <br>
            <a href="#attach_199108"
               title="Go to the comment associated with the attachment">2009-07-25 11:38 UTC</a>,

            <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=199108&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=199108&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain">
        <td>
            <a href="attachment.cgi?id=201702"
               title="View the content of the attachment">
          <b>testsuite for PoC</b></a>

          <span class="bz_attach_extra_info">
              (CVE-2009-2295.tar.gz,433.33 KB,
                text/plain)

            <br>
            <a href="#attach_201702"
               title="Go to the comment associated with the attachment">2009-08-19 12:03 UTC</a>,

            <span class="vcard"><span class="fn">Steffen Joeris</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=201702&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a id="view_all" href="attachment.cgi?bugid=276235&amp;action=viewall">View All</a>
        </span>
        <a href="attachment.cgi?bugid=276235&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=276235&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1635279621" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-02 13:48:04 UTC
        </span>

      </div>




<pre class="bz_comment_text">oCERT #2009-009 CamlImages integer overflows

CamlImages, an open source image processing library, suffers from several integer overflows which may lead to a potentially exploitable heap overflow and result in arbitrary code execution.

The vulnerability is triggered by PNG image parsing, the read_png_file and read_png_file_as_rgb24 functions do not properly validate the width and height of the image. Specific PNG images with large width and height can be crafted to trigger the vulnerability.

Affected version:

CamlImages &lt;= 2.2

Fixed version:

Unfortunately oCERT has been unable to get feedback from CamlImages maintainers and the package seems unmaintained, it's therefore suggested to avoid CamlImages usage on production or any environment where strong security is needed.

Credit: vulnerability report and PoC code received from Tielei Wang &lt;wangtielei [at] icst [dot] pku [dot] edu [dot] cn&gt;, ICST-ERCIS.

CVE: CVE-2009-2295
Timeline:

2009-05-21: vulnerability reported received
2009-05-21: contacted camlimages maintainers
2009-06-30: due to lack of feedback oCERT asks reporter to disclose the issue
2009-07-01: reporter agrees to disclosure
2009-07-02: assigned CVE
2009-07-02: advisory release</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-02 13:55:00 UTC
        </span>

      </div>




<pre class="bz_comment_text">ml: app-text/active-dvi seems to be using this library, so in case of removal, both would have to go. Do you have contact to upstream?</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexis Ballier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-02 14:16:50 UTC
        </span>

      </div>




<pre class="bz_comment_text">There is a new version (3.0.1) at <a href="http://gallium.inria.fr/camlimages/">http://gallium.inria.fr/camlimages/</a> (it seems it has been released a long time ago: 2007-10-11 according to the tarball mtime)
Is it also exploitable?
Considering the timeline I'd suspect it is, but the advisory is about &lt;=2.2.</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-03 07:19:45 UTC
        </span>

      </div>




<pre class="bz_comment_text">The advisory has been updates to reflect that 3.0.1 is also affected. Alexis, I forwarded the reproducer to you. The email to upstream bounced for one of the two authors (Jun.Furuse).</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Legler (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2009-07-05 23:27:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">CVE-2009-2295 (<a href="http://nvd.nist.gov/nvd.cfm?cvename=CVE-2009-2295">http://nvd.nist.gov/nvd.cfm?cvename=CVE-2009-2295</a>):
  Multiple integer overflows in CamlImages 2.2 and earlier might allow
  context-dependent attackers to execute arbitrary code via a crafted
  PNG image with large width and height values that trigger a
  heap-based buffer overflow in the (1) read_png_file or (2)
  read_png_file_as_rgb24 function.

</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexis Ballier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-24 20:52:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">3.0.1 in tree with upstream patches; it checks for oversized images in gif, jpeg and png so maybe there were other vulns. in jpeg &amp; gif readers.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-25 11:38:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=199108" name="attach_199108" title="camlimages-3.0.1-CVE-2009-2295.patch">attachment 199108</a> [<a href="attachment.cgi?id=199108&amp;action=edit" title="camlimages-3.0.1-CVE-2009-2295.patch">details</a>, <a href="attachment.cgi?id=199108&amp;action=diff" title="camlimages-3.0.1-CVE-2009-2295.patch">diff</a>]</span>
camlimages-3.0.1-CVE-2009-2295.patch

Fixes for CVE-2009-2295 and gif/jpeg overflows.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-25 12:25:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">Arches, please test and mark stable:
=dev-ml/camlimages-3.0.1
Target keywords : &quot;ppc x86&quot;</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Markus Meier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-27 22:01:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">this will break it's only reverse-dep app-text/active-dvi-1.7.3:

/usr/bin/ocamlc.opt  -I /usr/lib/ocaml/lablgtk2 -I /usr/lib/ocaml -I /usr/lib/ocaml/site-packages/camlimages -o dvi.cmo -c dvi.ml
/usr/bin/ocamlc.opt  -I /usr/lib/ocaml/lablgtk2 -I /usr/lib/ocaml -I /usr/lib/ocaml/site-packages/camlimages -o drawimage.cmo -c drawimage.ml
File &quot;drawimage.ml&quot;, line 304, characters 8-18:
Unbound value Ps.load_ps
make[2]: *** [drawimage.cmo] Error 2
make[2]: *** Waiting for unfinished jobs....
make[2]: Leaving directory `/var/tmp/portage/app-text/active-dvi-1.7.3/work/advi-1.7.3/src'
make[1]: *** [all] Error 2
make[1]: Leaving directory `/var/tmp/portage/app-text/active-dvi-1.7.3/work/advi-1.7.3/src'
make: *** [all-recursive] Error 1
 * 
 * ERROR: app-text/active-dvi-1.7.3 failed.
 * Call stack:
 *               ebuild.sh, line   49:  Called src_compile
 *             environment, line 2672:  Called die
 * The specific snippet of code:
 *       emake || die &quot;emake failed&quot;;
 *  The die message:
 *   emake failed

[ebuild   R   ] dev-ml/camlimages-3.0.1  USE=&quot;gif gtk jpeg tiff truetype -doc -gs -xpm&quot; 0 kB
[ebuild   R   ] app-text/active-dvi-1.7.3  USE=&quot;ocamlopt -tk&quot; 0 kB

Portage 2.1.6.13 (default/linux/x86/2008.0/desktop, gcc-4.3.2, glibc-2.9_p20081201-r2, 2.6.30.1 i686)
=================================================================
System uname: <a href="mailto:Linux-2.6.30.1-i686-Intel-R-_Core-TM-2_Duo_CPU_T8300_&#64;_2.40GHz-with-glibc2.0">Linux-2.6.30.1-i686-Intel-R-_Core-TM-2_Duo_CPU_T8300_&#64;_2.40GHz-with-glibc2.0</a>
Timestamp of tree: Mon, 27 Jul 2009 21:00:01 +0000
app-shells/bash:     3.2_p39
dev-java/java-config: 2.1.7
dev-lang/python:     2.5.4-r3
dev-python/pycrypto: 2.0.1-r8
dev-util/cmake:      2.6.4
sys-apps/baselayout: 1.12.11.1
sys-apps/sandbox:    1.6-r2
sys-devel/autoconf:  2.13, 2.63-r1
sys-devel/automake:  1.4_p6, 1.5, 1.7.9-r1, 1.9.6-r2, 1.10.2
sys-devel/binutils:  2.18-r3
sys-devel/gcc-config: 1.4.1
sys-devel/libtool:   1.5.26
virtual/os-headers:  2.6.27-r2
ACCEPT_KEYWORDS=&quot;x86&quot;
CBUILD=&quot;i686-pc-linux-gnu&quot;
CFLAGS=&quot;-O2 -march=i686 -pipe&quot;
CHOST=&quot;i686-pc-linux-gnu&quot;
CONFIG_PROTECT=&quot;/etc /usr/kde/3.5/env /usr/kde/3.5/share/config /usr/kde/3.5/shutdown /usr/share/config&quot;
CONFIG_PROTECT_MASK=&quot;/etc/ca-certificates.conf /etc/env.d /etc/env.d/java/ /etc/fonts/fonts.conf /etc/gconf /etc/php/apache2-php5/ext-active/ /etc/php/cgi-php5/ext-active/ /etc/php/cli-php5/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo /etc/texmf/language.dat.d /etc/texmf/language.def.d /etc/texmf/updmap.d /etc/texmf/web2c /etc/udev/rules.d&quot;
CXXFLAGS=&quot;-O2 -march=i686 -pipe&quot;
DISTDIR=&quot;/usr/portage/distfiles&quot;
FEATURES=&quot;collision-protect distlocks fixpackages parallel-fetch protect-owned sandbox sfperms strict test unmerge-orphans userfetch userpriv usersandbox&quot;
GENTOO_MIRRORS=&quot;<a href="http://distfiles.gentoo.org">http://distfiles.gentoo.org</a> <a href="http://distro.ibiblio.org/pub/linux/distributions/gentoo">http://distro.ibiblio.org/pub/linux/distributions/gentoo</a>&quot;
LDFLAGS=&quot;-Wl,-O1&quot;
LINGUAS=&quot;en en_GB de&quot;
MAKEOPTS=&quot;-j2&quot;
PKGDIR=&quot;/mnt/packages&quot;
PORTAGE_CONFIGROOT=&quot;/&quot;
PORTAGE_RSYNC_OPTS=&quot;--recursive --links --safe-links --perms --times --compress --force --whole-file --delete --stats --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages&quot;
PORTAGE_TMPDIR=&quot;/var/tmp&quot;
PORTDIR=&quot;/usr/portage&quot;
SYNC=&quot;rsync://rsync.gentoo.org/gentoo-portage&quot;
USE=&quot;X acl acpi alsa apache2 avahi berkdb bluetooth branding bzip2 cairo cdr cli cracklib crypt cups dbus dri dvd dvdr dvdread eds emboss encode esd evo examples fam firefox fortran gdbm gif gnome gpm gstreamer gtk hal iconv ipv6 isdnlog jpeg kde ldap libnotify mad midi mikmod mp3 mpeg mudflap ncurses nls nptl nptlonly ogg opengl openmp pam pcre pdf perl png ppds pppd python qt3 qt3support qt4 quicktime readline reflection sdl session source spell spl ssl startup-notification svg sysfs tcpd test tiff truetype unicode usb vorbis win32codecs x86 xml xorg xulrunner xv zlib&quot; ALSA_CARDS=&quot;ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1 emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci&quot; ALSA_PCM_PLUGINS=&quot;adpcm alaw asym copy dmix dshare dsnoop empty extplug file hooks iec958 ioplug ladspa lfloat linear meter mmap_emul mulaw multi null plug rate route share shm softvol&quot; APACHE2_MODULES=&quot;actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias&quot; ELIBC=&quot;glibc&quot; INPUT_DEVICES=&quot;keyboard mouse evdev&quot; KERNEL=&quot;linux&quot; LCD_DEVICES=&quot;bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text&quot; LINGUAS=&quot;en en_GB de&quot; USERLAND=&quot;GNU&quot; VIDEO_CARDS=&quot;fbdev glint i810 intel mach64 mga neomagic nv r128 radeon savage sis tdfx trident vesa vga via vmware voodoo&quot;
Unset:  CPPFLAGS, CTARGET, EMERGE_DEFAULT_OPTS, FFLAGS, INSTALL_MASK, LANG, LC_ALL, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, PORTDIR_OVERLAY</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexis Ballier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-27 22:28:23 UTC
        </span>

      </div>




<pre class="bz_comment_text">Its just missing usedeps from advi part; added active-dvi-1.7.3-r1 that fixes that. Please mark it stable together with camlimages 3.0.1 and remove the old active-dvi revision while at it.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Markus Meier</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-07-29 21:18:00 UTC
        </span>

      </div>




<pre class="bz_comment_text">x86 stable</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-08-07 17:21:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">CVE-2009-2660 (<a href="http://nvd.nist.gov/nvd.cfm?cvename=CVE-2009-2660">http://nvd.nist.gov/nvd.cfm?cvename=CVE-2009-2660</a>):
  Multiple integer overflows in CamlImages 2.2 might allow
  context-dependent attackers to execute arbitrary code via images
  containing large width and height values that trigger a heap-based
  buffer overflow, related to (1) crafted GIF files (gifread.c) and (2)
  crafted JPEG files (jpegread.c), a different vulnerability than
  CVE-2009-2295.

</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">nixnut (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-08-09 13:12:28 UTC
        </span>

      </div>




<pre class="bz_comment_text">ppc stable</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Greg Roelofs</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-08-14 20:53:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">The PNG patch appears to be incomplete (rowbytes itself is never checked, unless in libpng; I personally would always include my own, explicit check), and oversized() seems unnecessarily complex (why not check for x and y &lt;= 0 and avoid the explicit &quot;y != 0&quot; in the third clause?  images with zero-dimensions aren't valid, either).  The GIF and JPEG checks appear to depend on third-party data structures and may break in the future if those ever switch to unsigned values (though I imagine that's unlikely).</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robert Buchholz (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2009-08-15 23:49:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=276235#c13">comment #13</a>)
<span class="quote">&gt; The PNG patch appears to be incomplete (rowbytes itself is never checked,
&gt; unless in libpng; I personally would always include my own, explicit check),</span >

I'm not sure I'm following. rowbytes is declared as size_t and libpng's png_get_rowbytes() returns a uint_32, which is an identical type. What else do you want to check?
rowbytes is only used in memory allocations or access in multiplications with height, and that case is checked.


<span class="quote">&gt; and oversized() seems unnecessarily complex (why not check for x and y &lt;= 0 and
&gt; avoid the explicit &quot;y != 0&quot; in the third clause?  images with zero-dimensions
&gt; aren't valid, either). </span >

0 height or width are certainly not errors to cause an overflow message, so the additional case of oversized() returning false for x=0 or y=0 seems sane to me.


<span class="quote">&gt; The GIF and JPEG checks appear to depend on third-party
&gt; data structures and may break in the future if those ever switch to unsigned
&gt; values (though I imagine that's unlikely).</span >

The members of the GifFileType struct and the jpeg_decompress_struct that are accessed are explicitly not marked private. How else should camlimages get access to these values?</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Greg Roelofs</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-08-18 20:36:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=276235#c14">comment #14</a>)
<span class="quote">&gt;&gt; The PNG patch appears to be incomplete (rowbytes itself is never checked,
&gt;&gt; unless in libpng; I personally would always include my own, explicit check),</span >

<span class="quote">&gt; I'm not sure I'm following. rowbytes is declared as size_t and libpng's
&gt; png_get_rowbytes() returns a uint_32, which is an identical type. What
&gt; else do you want to check?  rowbytes is only used in memory allocations
&gt; or access in multiplications with height, and that case is checked.</span >

rowbytes itself is a product, and you never check that.  Consider an RGB
image with w = 1431655766:  rowbytes = 2.  Does libpng catch the overflow?
Maybe so, maybe not, or maybe now but not in the future due to an oversight;
the point is that you're depending on it to do so, and I'm saying that's not
a very good approach to security.  (As you noted, you're using rowbytes in
memory allocations, but none of your rowbytes*h checks will catch the problem.
Oopsie.)

<span class="quote">&gt;&gt; and oversized() seems unnecessarily complex (why not check for x and y &lt;= 0 and
&gt;&gt; avoid the explicit &quot;y != 0&quot; in the third clause?  images with zero-dimensions
&gt;&gt; aren't valid, either).</span >

<span class="quote">&gt; 0 height or width are certainly not errors to cause an overflow message,
&gt; so the additional case of oversized() returning false for x=0 or y=0
&gt; seems sane to me.</span >

The point is simply that zero-dimensioned images serve no valid purpose, and
you can save a few clock cycles by disallowing them:

#define oversized(x, y)    ((x) &lt;= 0 || (y) &lt;= 0 || (x) &gt; INT_MAX / (y))

Cheap optimization, though undoubtedly not measurable...

<span class="quote">&gt;&gt; The GIF and JPEG checks appear to depend on third-party
&gt;&gt; data structures and may break in the future if those ever switch to unsigned
&gt;&gt; values (though I imagine that's unlikely).</span >

<span class="quote">&gt; The members of the GifFileType struct and the jpeg_decompress_struct
&gt; that are accessed are explicitly not marked private. How else should
&gt; camlimages get access to these values?</span >

Simply by copying to your own integer variables.  I'm not claiming you
necessarily gain anything by doing so--nothing in the patch screams at me
&quot;I will break if x is unsigned&quot;--but I have seen other, similar (security)
code depend on the signedness of integers that turned out not to be signed.
You may want to do a quick mini-audit and make sure there are no signed/
unsigned dependencies in nearby code.
</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steffen Joeris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-08-19 12:01:31 UTC
        </span>

      </div>




<pre class="bz_comment_text">Hi
(My first post to gentoo's bugzilla :) )

Just a general remark on this bug, has anyone checked tiffread.c? I can't find any validation checking in there and was wondering, whether it is required.
Also, I am still getting a segmentation fault for the crafted jpeg image that was sent as a PoC via vendor-sec (I can hand that out via private email).
Just wondering, whether someone checked it. I am attaching some code to test it, provided by our camlimages maintainer, maybe it's useful.

Cheers
Steffen</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Steffen Joeris</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2009-08-19 12:03:11 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=201702" name="attach_201702" title="testsuite for PoC">attachment 201702</a> [<a href="attachment.cgi?id=201702&amp;action=edit" title="testsuite for PoC">details</a>]</span>
testsuite for PoC</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Legler (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2009-10-23 10:01:07 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=276235#c16">comment #16</a>)
<span class="quote">&gt; Just a general remark on this bug, has anyone checked tiffread.c?</span >

I think those issues are confirmed now, <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-ml/camlimages-3.0.2 Integer Overflows (CVE-2009-3296)"
   href="show_bug.cgi?id=290222">bug 290222</a>. ;)

</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Legler (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2010-06-01 15:44:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">GLSA 201006-02</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=276235">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=276235">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=276235">Clone This Bug</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=276235&product=Gentoo%20Security">Clone In The Same 
                        Product</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=276235&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=276235" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=276235&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635619241-Y9f6W5ITgroSa_3xsK5TbQvR32CfPLTgCaq6OhGlvOE">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>