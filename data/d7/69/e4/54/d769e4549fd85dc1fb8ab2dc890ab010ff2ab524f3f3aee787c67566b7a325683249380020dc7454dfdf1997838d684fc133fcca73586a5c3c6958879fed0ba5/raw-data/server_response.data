<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1243466 - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1243466">
<meta property="og:description"
      content="RESOLVED (nical.bugzilla) in Core - Graphics: Layers. Last updated 2017-01-05.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="P3">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1243466 - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1243466&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1243466">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1243466">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/yui.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/global.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/util.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"comments\":{\"cf_tracking_firefox46\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox48\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox47\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr45\":{\"?\":\"[Tracking Requested - why for this release]:\"}},\"flags\":{\"project\":{\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_root_cause\":\"---\",\"cf_tracking_firefox_sumo\":\"---\"},\"tracking\":{\"cf_status_firefox94\":\"---\",\"cf_status_firefox46\":\"wontfix\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_tracking_firefox46\":\"-\",\"cf_tracking_firefox48\":\"+\",\"cf_status_firefox_esr45\":\"unaffected\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_e10s\":\"+\",\"cf_status_firefox48\":\"fixed\",\"cf_status_firefox_esr38\":\"unaffected\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_tracking_firefox_esr45\":\"-\",\"cf_tracking_firefox95\":\"---\",\"cf_status_firefox93\":\"---\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox95\":\"---\",\"cf_status_firefox47\":\"fixed\",\"cf_tracking_firefox47\":\"+\"}},\"types\":[\"tracking\"]}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1243466;
  BUGZILLA.bug_title = '1243466 - Heap-use-after-free crash [\x40mozilla::layers::ImageContainer::~ImageContainer]';
  BUGZILLA.bug_summary = 'Heap-use-after-free crash [\x40mozilla::layers::ImageContainer::~ImageContainer]';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1243466';
  BUGZILLA.bug_keywords = 'crash, csectype-uaf, regression, sec-high, testcase',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/field.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/comments.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1243466">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1243466"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1243466 - Heap-use-after-free crash [&amp;#64;mozilla::layers::ImageContainer::~ImageContainer]">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="fGWhmRGftriRQJELBX4KBS50fbw8zC56NJgXlyYs55kDuKJgl0NECge4uqfkyK2B0mOJT6g7TiVNUAOpTZeLbwJP362tUiLaWPy5fKFOfUHLftxnnbwm6MCHWGt2hqfATUrHCJdeSJ9ULd8pyol7QbB5yHtHAvAGANPvgTX8PQjwpvPVWil7XWmjIJlWFT1iHLsNcgpAi3jxMzRX9tqJVXyBtvFCFXojaXjpFCTVvkJEtDP1R6WAVTjeFsUomeiW">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1243466" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635622890-aGwp2Ga_4ie2AfEqZepdlQ2OeMYbItM8AwFQMcJpUoA">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1243466" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1243466" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1243466">Bug 1243466</a>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2016-01-27 10:45 PST" data-time="1453920316">6 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2016-04-04 20:40 PDT" data-time="1459827616">6 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">Heap-use-after-free crash [&#64;mozilla::layers::Image<wbr>Container::~Image<wbr>Container]</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: Graphics: Layers, defect, P3)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=Graphics%3A%20Layers#Graphics%3A%20Layers" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">Graphics: Layers
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: Graphics: Layers</div>
            <div class="description">The graphics subsystem that implements hardware-accelerated (and software) composition of layers of content.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=Graphics%3A%20Layers&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=Graphics%3A%20Layers&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=Graphics%3A%20Layers"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="Graphics: Layers"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-version" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            Trunk

        </span>
    </div>

  
</div>

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            x86_64

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            macOS

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">P3
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            critical

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr45&quot;:&quot;-&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox47&quot;:&quot;+&quot;,&quot;cf_status_firefox47&quot;:&quot;fixed&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;id&quot;:1243466,&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;keywords&quot;:[&quot;crash&quot;,&quot;csectype-uaf&quot;,&quot;regression&quot;,&quot;sec-high&quot;,&quot;testcase&quot;],&quot;cf_tracking_e10s&quot;:&quot;+&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr38&quot;:&quot;unaffected&quot;,&quot;cf_status_firefox48&quot;:&quot;fixed&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;target_milestone&quot;:&quot;mozilla48&quot;,&quot;cf_status_firefox_esr45&quot;:&quot;unaffected&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;flags&quot;:[],&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;priority&quot;:&quot;P3&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox46&quot;:&quot;wontfix&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_tracking_firefox48&quot;:&quot;+&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox46&quot;:&quot;-&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla48

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">e10s</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">---
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox46</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=-">-</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox47</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox47&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox48</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox48&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox48&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr38</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=unaffected">unaffected</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr45</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=equals&amp;v1=-">-</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=unaffected">unaffected</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">e10s</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_e10s-dirty">
  <select id="cf_tracking_e10s" name="cf_tracking_e10s">
        <option value="+"
          id="v1622_cf_tracking_e10s" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox46</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox46-dirty">
  <select id="cf_tracking_firefox46" name="cf_tracking_firefox46">
        <option value="-"
          id="v2557_cf_tracking_firefox46" selected
        >-
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox46-dirty">
  <select id="cf_status_firefox46" name="cf_status_firefox46">
        <option value="wontfix"
          id="v2563_cf_status_firefox46" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox47</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox47-dirty">
  <select id="cf_tracking_firefox47" name="cf_tracking_firefox47">
        <option value="+"
          id="v2603_cf_tracking_firefox47" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox47-dirty">
  <select id="cf_status_firefox47" name="cf_status_firefox47">
        <option value="fixed"
          id="v2610_cf_status_firefox47" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox48</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox48-dirty">
  <select id="cf_tracking_firefox48" name="cf_tracking_firefox48">
        <option value="+"
          id="v2669_cf_tracking_firefox48" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox48-dirty">
  <select id="cf_status_firefox48" name="cf_status_firefox48">
        <option value="fixed"
          id="v2676_cf_status_firefox48" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr38</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr38-dirty">
  <select id="cf_status_firefox_esr38" name="cf_status_firefox_esr38">
        <option value="unaffected"
          id="v2147_cf_status_firefox_esr38" selected
        >unaffected
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr45</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr45-dirty">
  <select id="cf_tracking_firefox_esr45" name="cf_tracking_firefox_esr45">
        <option value="-"
          id="v2527_cf_tracking_firefox_esr45" selected
        >-
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr45-dirty">
  <select id="cf_status_firefox_esr45" name="cf_status_firefox_esr45">
        <option value="unaffected"
          id="v2546_cf_status_firefox_esr45" selected
        >unaffected
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: posidron, Assigned: nical)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_438998" ><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=438998" > <span class="fna">nical</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_368570" ><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">posidron</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_279663" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=279663" > <span class="fna">jimm</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="23">23 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list edit-show" id="field-dependson" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-see_also" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
        ---
        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (5 keywords, Whiteboard: [post-critsmash-triage][adv-main47+][gfx-noted] maybe regressed by 1143575 (fx42))
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
        ---
        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=crash&amp;resolution=---">crash</a>, 
          <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a>, 
          <a href="/buglist.cgi?keywords=regression&amp;resolution=---">regression</a>, 
          <a href="/buglist.cgi?keywords=sec-high&amp;resolution=---">sec-high</a>, 
          <a href="/buglist.cgi?keywords=testcase&amp;resolution=---">testcase</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[post-critsmash-triage][adv-main47+][gfx-noted] maybe regressed by 1143575 (fx42)
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_flags" style="display:none"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field" id="field-cf_crash_signature"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
      <div>
          <a href="https://crash-stats.mozilla.org/signature/?signature=mozilla%3A%3Alayers%3A%3AImageContainer%3A%3A~ImageContainer%28%29" target="_blank" rel="noopener noreferrer">
            [@ mozilla::layers::ImageContainer::~ImageContainer() ]
          </a>
      </div>
    
      <iframe src="https://bugzilla.mozilla.org/page.cgi?id=socorro-lens.html&amp;s=mozilla%3A%3Alayers%3A%3AImageContainer%3A%3A~ImageContainer()" style="border:0; width:300px; height:200px; max-width:600px; max-height:300px; float:left;" id="chart" scrolling="no"></iframe>
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (3 files, 1 obsolete file)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8712775">Testcase</a>
        </div>
        <div>
            <a href="#c1" class="attach-time activity-ref"><span class="rel-time" title="2016-01-27 10:45 PST" data-time="1453920320">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_368570" ><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div></span>
        </div>
        <div class="attach-info">69.90 KB,
          application/java-archive        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8712775&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8736301">Release ImageContainer's ipc resource during media shutdown.</a>
        </div>
        <div>
            <a href="#c8" class="attach-time activity-ref"><span class="rel-time" title="2016-03-30 06:03 PDT" data-time="1459342986">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_438998" ><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div></span>
        </div>
        <div class="attach-info">5.94 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_512198" ><span class="fn">jya</span>
</div>:
              <a href="#c10"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1459417981"
            >
              feedback-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8736301&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8736301&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736301">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8736687">null out ImageContainers during shutdown</a>
        </div>
        <div>
            <a href="#c19" class="attach-time activity-ref"><span class="rel-time" title="2016-03-31 05:58 PDT" data-time="1459429122">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_438998" ><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div></span>
        </div>
        <div class="attach-info">4.86 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_469171" ><span class="fn">jwwang</span>
</div>:
              <a href="#c23"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1459429122"
            >
              review-</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_512198" ><span class="fn">jya</span>
</div>:
              <a href="#c22"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1459429122"
            >
              feedback-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8736687&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8736687&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736687">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8736709">Don't delete an ImageContainerChild if its ImageContainer is still holding on to it</a>
        </div>
        <div>
            <a href="#c21" class="attach-time activity-ref"><span class="rel-time" title="2016-03-31 07:31 PDT" data-time="1459434712">6 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_438998" ><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div></span>
        </div>
        <div class="attach-info">5.35 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_434202" ><span class="fn">sotaro</span>
</div>:
              <a href="#c29"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1459434712"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_538805" ><span class="fn">ritu</span>
</div>:
              <a href="#c43"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1462872922"
            >
              approval-mozilla-beta+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_280903" ><span class="fn">abillings</span>
</div>:
              <a href="#a6841810_280903"
                  class="flag-name-status rel-time-title activity-ref"
                  title="6 years ago"
              data-time="1460630019"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8736709&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8736709&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736709">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="RhvNpKGJyoqiEzbDlusDuaSBxM5HBA2dg9rtREUZXAvylbok">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="11113280" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_368570" ><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_368570" ><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 10:45 PST" data-time="1453920316">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-0" data-comment-id="11113280">The following testcase crashes on en-us.linux-x86_64-asan.tar.bz2 revision 9a1977d9b21b1a4ba1fc5fdaff4240af83088271

See attachment.

Backtrace:

==13625==ERROR: AddressSanitizer: heap-use-after-free on address 0x6060004abf10 at pc 0x7f354fcc82a4 bp 0x7fffe60d4dd0 sp 0x7fffe60d4dc8
READ of size 8 at 0x6060004abf10 thread T0 (Web Content)
    #0 0x7f354fcc82a3 in Lock /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/Mutex.h:69
    #1 0x7f354fcc82a3 in BaseAutoLock /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/Mutex.h:164
    #2 0x7f354fcc82a3 in ForgetImageContainer /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/ImageContainer.cpp:109
    #3 0x7f354fcc82a3 in mozilla::layers::ImageContainer::~ImageContainer() /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/ImageContainer.cpp:151
    #4 0x7f3552cdcfe7 in Release /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/ImageContainer.h:349
    #5 0x7f3552cdcfe7 in AddRefTraitsReleaseHelper /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:362
    #6 0x7f3552cdcfe7 in Release /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:372
    #7 0x7f3552cdcfe7 in ~Mutex /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:56
    #8 0x7f3552cdcfe7 in mozilla::VideoFrameContainer::~VideoFrameContainer() /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/media/VideoFrameContainer.cpp:30
    #9 0x7f35528eb146 in Release /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/media/VideoFrameContainer.h:39
    #10 0x7f35528eb146 in AddRefTraitsReleaseHelper /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:362
    #11 0x7f35528eb146 in Release /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:372
    #12 0x7f35528eb146 in ~RefPtr /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/RefPtr.h:56
    #13 0x7f35528eb146 in mozilla::dom::HTMLMediaElement::~HTMLMediaElement() /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLMediaElement.cpp:2175
    #14 0x7f3552998d6e in ~HTMLVideoElement /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLVideoElement.cpp:51
    #15 0x7f3552998d6e in mozilla::dom::HTMLVideoElement::~HTMLVideoElement() /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLVideoElement.cpp:50
    #16 0x7f354de6ea88 in SnowWhiteKiller::~SnowWhiteKiller() /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/base/nsCycleCollector.cpp:2655
    #17 0x7f354de6e6ae in nsCycleCollector::FreeSnowWhite(bool) /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/base/nsCycleCollector.cpp:2829
    #18 0x7f354f49e0c9 in AsyncFreeSnowWhite::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/js/xpconnect/src/XPCJSRuntime.cpp:151
    #19 0x7f354df8a8df in nsThread::ProcessNextEvent(bool, bool*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsThread.cpp:995
    #20 0x7f354e005bda in NS_ProcessNextEvent(nsIThread*, bool) /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsThreadUtils.cpp:297
    #21 0x7f354e9af939 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessagePump.cpp:95
    #22 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #23 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #24 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #25 0x7f3553d23a17 in nsBaseAppShell::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/widget/nsBaseAppShell.cpp:156
    #26 0x7f3555c6c7a2 in XRE_RunAppShell /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:789
    #27 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #28 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #29 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #30 0x7f3555c6be9a in XRE_InitChildProcess /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:625
    #31 0x48d760 in content_process_main(int, char**) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/app/../contentproc/plugin-container.cpp:237
    #32 0x7f354b839ec4 (/lib/x86_64-linux-gnu/libc.so.6+0x21ec4)

0x6060004abf10 is located 48 bytes inside of 64-byte region [0x6060004abee0,0x6060004abf20)
freed by thread T28 (ImageBridgeChil) here:
    #0 0x474ed1 in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:64
    #1 0x7f354ff36b44 in mozilla::layers::ImageBridgeChild::DeallocPImageContainerChild(mozilla::layers::PImageContainerChild*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/ipc/ImageBridgeChild.cpp:1057
    #2 0x7f354eba4fc7 in mozilla::layers::PImageBridgeChild::DeallocSubtree() /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/ipc/ipdl/PImageBridgeChild.cpp:1132
    #3 0x7f354eba55ea in mozilla::layers::PImageBridgeChild::OnChannelError() /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/ipc/ipdl/PImageBridgeChild.cpp:970
    #4 0x7f354e9aac9d in NotifyMaybeChannelError /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessageChannel.cpp:1864
    #5 0x7f354e9aac9d in mozilla::ipc::MessageChannel::OnNotifyMaybeChannelError() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessageChannel.cpp:1893
    #6 0x7f354e91cdf4 in RunTask /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:364
    #7 0x7f354e91cdf4 in MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:372
    #8 0x7f354e91dea7 in MessageLoop::DoWork() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:459
    #9 0x7f354e91ffc8 in base::MessagePumpDefault::Run(base::MessagePump::Delegate*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_pump_default.cc:34
    #10 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #11 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #12 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #13 0x7f354e933923 in base::Thread::ThreadMain() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/thread.cc:172
    #14 0x7f354e9351dc in ThreadFunc(void*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/platform_thread_posix.cc:36
    #15 0x7f355c4b9181 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x8181)

previously allocated by thread T0 (Web Content) here:
    #0 0x4750d1 in __interceptor_malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:74
    #1 0x48dd7d in moz_xmalloc /builds/slave/m-in-l64-asan-0000000000000000/build/src/memory/mozalloc/mozalloc.cpp:83
    #2 0x7f354fcc7c2f in operator new /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:186
    #3 0x7f354fcc7c2f in mozilla::layers::ImageContainer::ImageContainer(mozilla::layers::ImageContainer::Mode) /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/ImageContainer.cpp:137
    #4 0x7f354fcde1a7 in mozilla::layers::LayerManager::CreateImageContainer(mozilla::layers::ImageContainer::Mode) /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/Layers.cpp:204
    #5 0x7f35528f28c8 in mozilla::dom::HTMLMediaElement::GetVideoFrameContainer() /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLMediaElement.cpp:4030
    #6 0x7f3552b286c7 in mozilla::MediaDecoder::MediaDecoder(mozilla::MediaDecoderOwner*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/media/MediaDecoder.cpp:506
    #7 0x7f3552aa9467 in operator new /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/WebMDecoder.h:17
    #8 0x7f3552aa9467 in InstantiateDecoder /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/media/DecoderTraits.cpp:577
    #9 0x7f3552aa9467 in mozilla::DecoderTraits::CreateDecoder(nsACString_internal const&amp;, mozilla::MediaDecoderOwner*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/media/DecoderTraits.cpp:598
    #10 0x7f35528c9278 in mozilla::dom::HTMLMediaElement::InitializeDecoderForChannel(nsIChannel*, nsIStreamListener**) /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLMediaElement.cpp:2811
    #11 0x7f35528c895d in mozilla::dom::HTMLMediaElement::MediaLoadListener::OnStartRequest(nsIRequest*, nsISupports*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/dom/html/HTMLMediaElement.cpp:393
    #12 0x7f354e0fd20b in nsBaseChannel::OnStartRequest(nsIRequest*, nsISupports*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/netwerk/base/nsBaseChannel.cpp:800
    #13 0x7f354e145c7d in nsInputStreamPump::OnStateStart() /builds/slave/m-in-l64-asan-0000000000000000/build/src/netwerk/base/nsInputStreamPump.cpp:525
    #14 0x7f354e145242 in nsInputStreamPump::OnInputStreamReady(nsIAsyncInputStream*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/netwerk/base/nsInputStreamPump.cpp:427
    #15 0x7f354df45db9 in nsInputStreamReadyEvent::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/io/nsStreamUtils.cpp:94
    #16 0x7f354df8a8df in nsThread::ProcessNextEvent(bool, bool*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/threads/nsThread.cpp:995
    #17 0x7f354e005bda in NS_ProcessNextEvent(nsIThread*, bool) /builds/slave/m-in-l64-asan-0000000000000000/build/src/xpcom/glue/nsThreadUtils.cpp:297
    #18 0x7f354e9af939 in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessagePump.cpp:95
    #19 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #20 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #21 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #22 0x7f3553d23a17 in nsBaseAppShell::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/widget/nsBaseAppShell.cpp:156
    #23 0x7f3555c6c7a2 in XRE_RunAppShell /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:789
    #24 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #25 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #26 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #27 0x7f3555c6be9a in XRE_InitChildProcess /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:625
    #28 0x48d760 in content_process_main(int, char**) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/app/../contentproc/plugin-container.cpp:237
    #29 0x7f354b839ec4 (/lib/x86_64-linux-gnu/libc.so.6+0x21ec4)

Thread T28 (ImageBridgeChil) created by T0 (Web Content) here:
    #0 0x461945 in pthread_create /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_interceptors.cc:175
    #1 0x7f354e933504 in CreateThread /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/platform_thread_posix.cc:135
    #2 0x7f354e933504 in Create /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/platform_thread_posix.cc:146
    #3 0x7f354e933504 in base::Thread::StartWithOptions(base::Thread::Options const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/thread.cc:94
    #4 0x7f354e93333e in base::Thread::Start() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/thread.cc:83
    #5 0x7f354ff32a5d in mozilla::layers::ImageBridgeChild::StartUpInChildProcess(IPC::Channel*, int) /builds/slave/m-in-l64-asan-0000000000000000/build/src/gfx/layers/ipc/ImageBridgeChild.cpp:713
    #6 0x7f354f1b1766 in mozilla::dom::PContentChild::OnMessageReceived(IPC::Message const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/ipc/ipdl/PContentChild.cpp:8427
    #7 0x7f354e9a8a9c in mozilla::ipc::MessageChannel::DispatchAsyncMessage(IPC::Message const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessageChannel.cpp:1461
    #8 0x7f354e9a644c in mozilla::ipc::MessageChannel::DispatchMessage(IPC::Message const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessageChannel.cpp:1381
    #9 0x7f354e9973c2 in mozilla::ipc::MessageChannel::OnMaybeDequeueOne() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessageChannel.cpp:1350
    #10 0x7f354e91cdf4 in RunTask /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:364
    #11 0x7f354e91cdf4 in MessageLoop::DeferOrRunPendingTask(MessageLoop::PendingTask const&amp;) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:372
    #12 0x7f354e91dea7 in MessageLoop::DoWork() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:459
    #13 0x7f354e9b0635 in mozilla::ipc::MessagePumpForChildProcess::Run(base::MessagePump::Delegate*) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/glue/MessagePump.cpp:284
    #14 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #15 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #16 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #17 0x7f3553d23a17 in nsBaseAppShell::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/widget/nsBaseAppShell.cpp:156
    #18 0x7f3555c6c7a2 in XRE_RunAppShell /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:789
    #19 0x7f354e91b97c in RunInternal /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:234
    #20 0x7f354e91b97c in RunHandler /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:227
    #21 0x7f354e91b97c in MessageLoop::Run() /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/chromium/src/base/message_loop.cc:201
    #22 0x7f3555c6be9a in XRE_InitChildProcess /builds/slave/m-in-l64-asan-0000000000000000/build/src/toolkit/xre/nsEmbedFunctions.cpp:625
    #23 0x48d760 in content_process_main(int, char**) /builds/slave/m-in-l64-asan-0000000000000000/build/src/ipc/app/../contentproc/plugin-container.cpp:237
    #24 0x7f354b839ec4 (/lib/x86_64-linux-gnu/libc.so.6+0x21ec4)

SUMMARY: AddressSanitizer: heap-use-after-free /builds/slave/m-in-l64-asan-0000000000000000/build/src/obj-firefox/dist/include/mozilla/Mutex.h:69 Lock
Shadow bytes around the buggy address:
  0x0c0c8008d790: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa
  0x0c0c8008d7a0: fa fa fa fa fa fa fa fa fa fa fa fa fd fd fd fd
  0x0c0c8008d7b0: fd fd fd fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c0c8008d7c0: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa
  0x0c0c8008d7d0: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd
=&gt;0x0c0c8008d7e0: fd fd[fd]fd fa fa fa fa fd fd fd fd fd fd fd fa
  0x0c0c8008d7f0: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa
  0x0c0c8008d800: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd
  0x0c0c8008d810: fd fd fd fa fa fa fa fa fd fd fd fd fd fd fd fa
  0x0c0c8008d820: fa fa fa fa fd fd fd fd fd fd fd fa fa fa fa fa
  0x0c0c8008d830: fd fd fd fd fd fd fd fa fa fa fa fa fd fd fd fd
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Contiguous container OOB:fc
  ASan internal:           fe</pre></div><div class="change-set" id="c1"><div class="comment" data-id="11113281" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_368570" ><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_368570" ><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 10:45 PST" data-time="1453920320">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8712775"
         class="attachment"
         data-id="8712775" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="53641f79206d73c9fc0e78c921a2299531445ede.zip">
      <meta itemprop="contentSize" content="71581">
      <meta itemprop="encodingFormat" content="application/java-archive">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8712775" itemprop="contentUrl">
        <span id="att-8712775-description" itemprop="description">Testcase</span></a>
        — <a href="attachment.cgi?id=8712775&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div></div><div class="change-set" id="a87_368570"><div class="change" id="aa87_368570">
    <table class="layout-table change-head reporter" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_368570" id="a87_368570"><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_368570" id="a87_368570"><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div>
            <span class="user-role">Reporter</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a87_368570"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a87_368570">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a87_368570">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 10:46 PST" data-time="1453920403">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Summary: Stagefright: &rarr; Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]</div></div></div><div class="change-set" id="a299_368570"><div class="change" id="aa299_368570">
    <table class="layout-table change-head reporter" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_368570" id="a299_368570"><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_368570" id="a299_368570"><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div>
            <span class="user-role">Reporter</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a299_368570"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a299_368570">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a299_368570">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 10:50 PST" data-time="1453920615">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-bounds&amp;resolution=---">csectype-bounds</a> &rarr; <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a></div></div></div><div class="change-set" id="a1805_241497"><div class="change" id="aa1805_241497">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_241497" id="a1805_241497"><img src="https://secure.gravatar.com/avatar/b13611d1950fd03a3e1d44195fa6f532?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_241497" id="a1805_241497"><a class="email " href="/user_profile?user_id=241497" > <span class="fna">Josh Matthews [:jdm]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1805_241497"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1805_241497">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a1805_241497">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 11:15 PST" data-time="1453922121">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Component: ImageLib &rarr; Graphics: Layers</div></div></div><div class="change-set" id="c2"><div class="comment" data-id="11113408" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_241497" id="a1805_241497"><img src="https://secure.gravatar.com/avatar/b13611d1950fd03a3e1d44195fa6f532?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_241497" id="a1805_241497"><a class="email " href="/user_profile?user_id=241497" > <span class="fna">Josh Matthews [:jdm]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-27 11:18 PST" data-time="1453922327">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="11113408">Summary - IPC error notification causes PImageContainerChild to be deallocated, but the destructor for the ImageContainer that's stored in the VideoFrameContainer later tries to the use the IPC actor.</pre></div><div class="change-set" id="a72441_456486"><div class="change" id="aa72441_456486">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_456486" id="a72441_456486"><img src="https://secure.gravatar.com/avatar/afff8630fb0a0c0a44853cd700ac0a4d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_456486" id="a72441_456486"><a class="email " href="/user_profile?user_id=456486" > <span class="fna">Milan Sreckovic [:milan] (needinfo for best results)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a72441_456486"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a72441_456486">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a72441_456486">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-28 06:52 PST" data-time="1453992757">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: gfx-core-security</div></div></div><div class="change-set" id="a73975_438998"><div class="change" id="aa73975_438998">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a73975_438998"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_438998" id="a73975_438998"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a73975_438998"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a73975_438998">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a73975_438998">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-01-28 07:18 PST" data-time="1453994291">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; nical.bugzilla</div><div class="change">Whiteboard: [gfx-noted]</div></div></div><div class="change-set" id="a1079894_1689"><div class="change" id="aa1079894_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a1079894_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1079894_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1079894_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a1079894_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-02-08 22:43 PST" data-time="1455000210">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security</span></div></div></div><div class="change-set" id="c3"><div class="comment" data-id="11271683" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a1079894_1689"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-23 10:21 PDT" data-time="1458753675">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="11271683">Nicolas, this sec-high use after free has been sitting around for almost two months. Are you going to have time to look at this or should I look for somebody else to investigate it? Thanks.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=isnotempty">tracking-e10s</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Flags: needinfo?(nical.bugzilla)</div></div></div><div class="change-set" id="c4"><div class="comment" data-id="11278034" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-25 10:18 PDT" data-time="1458926322">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="11278034">I am working on a fix.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(nical.bugzilla)</span></div></div></div><div class="change-set" id="c5"><div class="comment" data-id="11284729" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-29 06:52 PDT" data-time="1459259537">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="11284729">(In reply to Andrew McCreight [:mccr8] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c3">comment #3</a>)
<span class="quote">&gt; Nicolas, this sec-high use after free has been sitting around for almost two
&gt; months. Are you going to have time to look at this or should I look for
&gt; somebody else to investigate it? Thanks.</span >

Actually, this is tricky. This is a shutdown crash where we try to use the ImageBridge after it's been shut down already. The only reliable way to fix this is to make sure that the media element that holds the ImageContainerChild (and other gfx stuff) is destroyed before shutting gfx down.
I have a patch that papers over this specific crash but it's pointless because if we get into this situation we will crash shortly after with another gfx resource being used past gfx shutdown (most likely a TextureClient).

This is also what blocks <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CompositorChild leaks in e10s content process"
   href="/show_bug.cgi?id=1215265">bug 1215265</a>.</pre></div><div class="change-set" id="c6"><div class="comment" data-id="11284735" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-29 06:53 PDT" data-time="1459259631">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="11284735">cc Jean-Yves who helped a lot with fixing the late shutdown of some of the media stuff.</pre></div><div class="change-set" id="c7"><div class="comment" data-id="11285155" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-29 09:26 PDT" data-time="1459268777">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="11285155"><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - CompositorChild leaks in e10s content process"
   href="/show_bug.cgi?id=1215265">Bug 1215265</a> <span class="bz_obsolete"><a href="/attachment.cgi?id=8735902" name="attach_8735902" title="do a cycle collection before shutting down gfx">Attachment 8735902</a> <a href="/attachment.cgi?id=8735902&amp;action=edit" title="do a cycle collection before shutting down gfx">[details]</a> <a href="/attachment.cgi?id=8735902&amp;action=diff" title="do a cycle collection before shutting down gfx">[diff]</a></span> should help with this.</pre></div><div class="change-set" id="c8"><div class="comment" data-id="11287726" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-30 06:03 PDT" data-time="1459342986">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8736301"
         class="attachment patch obsolete"
         data-id="8736301" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="mediashutdown">
      <meta itemprop="contentSize" content="6087">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8736301">
          <a class="link" href="attachment.cgi?id=8736301&amp;action=diff">
        <span id="att-8736301-description" itemprop="description">Release ImageContainer's ipc resource during media shutdown.</span></a> (obsolete)
        — <a href="attachment.cgi?id=8736301&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736301">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-8" data-comment-id="11287726">This is a bit of a shot in the dark. This patch assumes that media shutdown correctly goes through media resources to release all of the textures, and that the only required addition is to release the ImageContainer's IPDL actor as well.
So the patch tries to do that by plugging into ReleaseMediaResources and and calling DetachIPC() on the VideoFrameContainer/ImageContainer. I may be missing places where it should be called (this was mostly driven by grepping around).

I am not sure that this will fix 100% of the problems, but releasing the PImageContainerChild should happen during MediaShutdown and I haven't found code that explicitly does that.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736301&amp;action=edit"
           title="Release ImageContainer's ipc resource during media shutdown."
           class=""
        >Attachment #8736301</a> -
        Flags: review?(jyavenard)</div></div></div><div class="change-set" id="c9"><div class="comment" data-id="11290185" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a1079894_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 01:52 PDT" data-time="1459414354">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="11290185">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>
Release ImageContainer's ipc resource during media shutdown.

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>:
-----------------------------------------------------------------

::: dom/media/MediaDecoder.cpp
&#64;&#64; +653,5 &#64;&#64;
<span class="quote">&gt;    ChangeState(PLAY_STATE_SHUTDOWN);
&gt;  
&gt;    MediaShutdownManager::Instance().Unregister(this);
&gt;  
&gt; +  mVideoFrameContainer-&gt;DetachIPC();</span >

erratum: added a null check for mVideoFrameContainer.

::: dom/media/MediaDecoderStateMachine.cpp
&#64;&#64; +1351,5 &#64;&#64;
<span class="quote">&gt;    }
&gt;  
&gt;    DECODER_LOG(&quot;Shutdown started&quot;);
&gt;  
&gt; +  mVideoFrameContainer-&gt;DetachIPC();</span >

erratum: added a null check for mVideoFrameContainer.</pre></div><div class="change-set" id="c10"><div class="comment" data-id="11290306" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a1079894_1689"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a1079894_1689"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 02:53 PDT" data-time="1459417981">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="11290306">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>
Release ImageContainer's ipc resource during media shutdown.

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>:
-----------------------------------------------------------------

I don't see how that could work.

I believe the VideoFrameContainer is shared across MediaDecoder, MDSM and MediaFormatReader. But those are all accessed on different threads.

First, it seems to me that if you call ImageContainer::DetachIPC(); more than once, you'll end up with a null deref as mIPDLChild is now null.

Shouldn't VideoFrameContainer::mVideoFrameContainer be set to null after a call to VideoFrameContainer::DetachIPC()?

Seconds, this doesn't seem thread safe to me at all. In the event VideoFrameContainer::DetachIPC is called simultaneously between the MediaDecoder, the MDSM or the MediaFormatReader, you end up with a race when accessing VideoFrameContainer::mImageContainer and ImageContainer::mIPDLChild and ImageContainer::mImageClient. If you do clear VideoFrameContainer::mVideoFrameContainer after a call to VideoFrameContainer::DetachIPC() then I believe you should have a monitor protecting this operation.

JW knows the shutdown process and MediaDecoder better than I do. He should be the one reviewing this.

I think the easiest approach would be to only call DetachIPC in the MediaDecoderReader::Shutdown()

::: dom/media/MediaFormatReader.cpp
&#64;&#64; +1639,5 &#64;&#64;
<span class="quote">&gt;  {
&gt;    // Before freeing a video codec, all video buffers needed to be released
&gt;    // even from graphics pipeline.
&gt;    if (mVideoFrameContainer) {
&gt; +    mVideoFrameContainer-&gt;DetachIPC();</span >

We get here when we enter dormant mode. We aren't shutting down per say.

Can we resume once mVideoFrameContainer has been detached?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736301&amp;action=edit"
           title="Release ImageContainer's ipc resource during media shutdown."
           class=""
        >Attachment #8736301</a> -
        Flags: review?(jyavenard) &rarr; feedback-</div></div></div><div class="change-set" id="a5497697_512198"><div class="change" id="aa5497697_512198">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_512198" id="a5497697_512198"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5497697_512198"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5497697_512198">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a5497697_512198">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 02:53 PDT" data-time="1459418013">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736301&amp;action=edit"
           title="Release ImageContainer's ipc resource during media shutdown."
           class=""
        >Attachment #8736301</a> -
        Flags: review?(jwwang)</div></div></div><div class="change-set" id="c11"><div class="comment" data-id="11290329" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5497697_512198"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:05 PDT" data-time="1459418750">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="11290329">(In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c5">comment #5</a>)
<span class="quote">&gt; Actually, this is tricky. This is a shutdown crash where we try to use the
&gt; ImageBridge after it's been shut down already. The only reliable way to fix
&gt; this is to make sure that the media element that holds the
&gt; ImageContainerChild (and other gfx stuff) is destroyed before shutting gfx
&gt; down.</span >

I'm fairly certain this is already the case following <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Media has to be fully shut down before gfx"
   href="/show_bug.cgi?id=1207220">bug 1207220</a>.

gfx is shutdown there:
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/source/xpcom/build/XPCOMInit.cpp#848">https://dxr.mozilla.org/mozilla-central/source/xpcom/build/XPCOMInit.cpp#848</a>

while media is shutdown via the MediaShutdownManager there:
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/source/xpcom/build/XPCOMInit.cpp#840">https://dxr.mozilla.org/mozilla-central/source/xpcom/build/XPCOMInit.cpp#840</a>

this operation observerService-&gt;NotifyObservers is synchronous. It will not exit this loop until the MediaShutdownManager has fully shut down and there's nothing left holding a reference to the image container.

gfx is only shutdown once all the media objects have shutdown.

So I don't think this patch will do anything to address the issue.</pre></div><div class="change-set" id="c12"><div class="comment" data-id="11290353" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5497697_512198"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:20 PDT" data-time="1459419614">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="11290353">(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c10">comment #10</a>)
<span class="quote">&gt; Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>
&gt; Release ImageContainer's ipc resource during media shutdown.
&gt; 
&gt; Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8736301" name="attach_8736301" title="Release ImageContainer's ipc resource during media shutdown.">attachment 8736301</a> <a href="/attachment.cgi?id=8736301&amp;action=edit" title="Release ImageContainer's ipc resource during media shutdown.">[details]</a> <a href="/attachment.cgi?id=8736301&amp;action=diff" title="Release ImageContainer's ipc resource during media shutdown.">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736301'>[review]</a>:
&gt; -----------------------------------------------------------------
&gt; I believe the VideoFrameContainer is shared across MediaDecoder, MDSM and
&gt; MediaFormatReader. But those are all accessed on different threads.</span >

I don't have a good picture of what happens on what threads so yeah, the patch is apparently not good in its current shape. The point I'd want to get to after the threading issues are figured out is for ImageContainer to release its ipdl actor before the end of the media shutdown.

<span class="quote">&gt; 
&gt; First, it seems to me that if you call ImageContainer::DetachIPC(); more
&gt; than once, you'll end up with a null deref as mIPDLChild is now null.</span >

In DetachIPC we null out mImageContainerChild which means IsAsync() will return false the second time.

But it falls down if DetachIPC is called on multiple threads in parallel, obviously. 


<span class="quote">&gt; 
&gt; Shouldn't VideoFrameContainer::mVideoFrameContainer be set to null after a
&gt; call to VideoFrameContainer::DetachIPC()?
&gt; 
&gt; Seconds, this doesn't seem thread safe to me at all. [...] </span >

Ideally we'd call DetachIPC only once no matter on which thread. 

<span class="quote">&gt; I think the easiest approach would be to only call DetachIPC in the
&gt; MediaDecoderReader::Shutdown()</span >

Sounds good to me.

<span class="quote">&gt; [...]
&gt; We get here when we enter dormant mode. We aren't shutting down per say.
&gt; 
&gt; Can we resume once mVideoFrameContainer has been detached?</span >

Ok, this part is bad as well. We can't resume after that. The idea is to call DetachIPC during shutdown only.</pre></div><div class="change-set" id="c13"><div class="comment" data-id="11290370" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5497697_512198"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:40 PDT" data-time="1459420800">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="11290370">(In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c12">comment #12</a>)

<span class="quote">&gt; In DetachIPC we null out mImageContainerChild which means IsAsync() will
&gt; return false the second time.</span >

you mean mImageContainer right?

Ok that's good. But it's still not threadsafe, access to ImageContainer::mImageClient (from ImageContainer::IsAsync()) is done on multiple threads with no monitor.

(assuming you allow VideoFrameContainer::DetachIPC() to be called on any threads as your current patch does)</pre></div><div class="change-set" id="c14"><div class="comment" data-id="11290372" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5497697_512198"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:43 PDT" data-time="1459421001">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="11290372">(In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c12">comment #12</a>)

<span class="quote">&gt; patch is apparently not good in its current shape. The point I'd want to get
&gt; to after the threading issues are figured out is for ImageContainer to
&gt; release its ipdl actor before the end of the media shutdown.</span >

why would the ipdl actor need to be cleared *before* gfx being shutdown or before the end of the media shutdown?

Why can't the gfx clear that when shutting down?

again, there's nothing left of media by the time gfxPlatform::ShutdownLayersIPC(); is called in ShutdownXPCOM</pre></div><div class="change-set" id="c15"><div class="comment" data-id="11290374" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5497697_512198"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:45 PDT" data-time="1459421123">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="11290374">(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c13">comment #13</a>)
<span class="quote">&gt; (In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c12">comment #12</a>)
&gt; 
&gt; &gt; In DetachIPC we null out mImageContainerChild which means IsAsync() will
&gt; &gt; return false the second time.
&gt; 
&gt; you mean mImageContainer right?</span >

Sorry, I meant ImageContainer::mImageClient.</pre></div><div class="change-set" id="c16"><div class="comment" data-id="11290390" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5497697_512198"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 03:53 PDT" data-time="1459421593">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="11290390">(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c14">comment #14</a>)
<span class="quote">&gt; why would the ipdl actor need to be cleared *before* gfx being shutdown or
&gt; before the end of the media shutdown?
&gt; 
&gt; Why can't the gfx clear that when shutting down?</span >

I'll look into that, but generally, it means that the destruction of the IPDLChild can be scheduled concurrently from other threads, since some ImageContainers are still alive past the media shutdown and I don't know for sure on which thread their destructor may run. I would like to avoid breaking the bi-directional reference between ImageContainer and ImageContainerChild concurrently. Actually, maybe the only thing that may hold on to ImageContainers past the media shutdown is cycle collected HTMLMediaElements and we can assume the destructor will only run on the main thread past that point which makes it simpler.

<span class="quote">&gt; 
&gt; again, there's nothing left of media by the time
&gt; gfxPlatform::ShutdownLayersIPC(); is called in ShutdownXPCOM</span >

HTMLMediaElements are cycle collected and they appear to be able to maintain ImageContainers alive past shutdown. If you look at the stack here <a rel="nofollow" href="https://treeherder.mozilla.org/logviewer.html#?job_id=18592065&amp;repo=try">https://treeherder.mozilla.org/logviewer.html#?job_id=18592065&amp;repo=try</a> the HTMLMediaElement ends up being destroyed late during the cycle collector's shutdown.</pre></div><div class="change-set" id="c17"><div class="comment" data-id="11290414" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5497697_512198"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 04:03 PDT" data-time="1459422222">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="11290414">(In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c16">comment #16</a>)

<span class="quote">&gt; HTMLMediaElements are cycle collected and they appear to be able to maintain
&gt; ImageContainers alive past shutdown. If you look at the stack here
&gt; <a rel="nofollow" href="https://treeherder.mozilla.org/logviewer.html#?job_id=18592065&amp;repo=try">https://treeherder.mozilla.org/logviewer.html#?job_id=18592065&amp;repo=try</a> the
&gt; HTMLMediaElement ends up being destroyed late during the cycle collector's
&gt; shutdown.</span >

Then it's the HTMLMediaElement::mVideoFrameContainer that you need to null out. Doing anything in MediaDecoder / MDSM or MediaFormatReader isn't going to help (those aren't cycle collected)</pre></div><div class="change-set" id="c18"><div class="comment" data-id="11290474" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5497697_512198"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5497697_512198"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 04:36 PDT" data-time="1459424184">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="11290474">(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c17">comment #17</a>)
<span class="quote">&gt; Then it's the HTMLMediaElement::mVideoFrameContainer that you need to null
&gt; out. Doing anything in MediaDecoder / MDSM or MediaFormatReader isn't going
&gt; to help (those aren't cycle collected)</span >

Ok, I assumed that they were referring to the same ImageContainers and that it would be enough.

So, to summarize this discussion: the preferred approach is to make sure that all (async) ImageContainers are destroyed/nulled-out when gfx shuts down.
I'll give it another shot with this in mind, any help is very welcome!</pre></div><div class="change-set" id="a5504023_438998"><div class="change" id="aa5504023_438998">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5504023_438998"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_438998" id="a5504023_438998"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5504023_438998"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5504023_438998">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a5504023_438998">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 04:38 PDT" data-time="1459424339">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736301&amp;action=edit"
           title="Release ImageContainer's ipc resource during media shutdown."
           class=""
        >Attachment #8736301</a> -
        Flags: <span class="activity-deleted">review?(jwwang)</span></div></div></div><div class="change-set" id="c19"><div class="comment" data-id="11290600" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5504023_438998"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5504023_438998"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 05:58 PDT" data-time="1459429122">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8736687"
         class="attachment patch"
         data-id="8736687" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="mediaelement-shutdown">
      <meta itemprop="contentSize" content="4972">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8736687">
          <a class="link" href="attachment.cgi?id=8736687&amp;action=diff">
        <span id="att-8736687-description" itemprop="description">null out ImageContainers during shutdown</span></a>
        — <a href="attachment.cgi?id=8736687&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736687">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-19" data-comment-id="11290600">This patch tries to get rid of ImageContainers during shutdown in the hope that none of them will keep a PImageContainerChild past the shutdown. This focuses on HMTLMediaElement and MediaDecoder (the latter can be kept alive by the former and also holds on to a VideoFrameContainer), so there may be other places where this kind of thing needs to be done as well.

All of the added code is run only on the main thread, supposedly at a point where no other media related thread should be able to do things concurrently.

I had to remove the constness of MediaDecoder::mVideoFrameContainer which is not very nice, but the alternatives were:
 - To make it possible to null out VideoFrameContainer::mImageContainer which sounds worse because all of VideoFrameContainer's methids expect mImageContainer to never be null.
 - To make sure MediaDecoder itself gets deleted at this point, but it means removing all HTMLMediaElements from the global table, since the latter needs HTMLMediaElement::mDecoder to not be null, and generally it ends up venturing into more stuff that I don't know at all.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736301&amp;action=edit"
           title="Release ImageContainer's ipc resource during media shutdown."
           class=""
        >Attachment #8736301</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8736687&amp;action=edit"
           title="null out ImageContainers during shutdown"
           class=""
        >Attachment #8736687</a> -
        Flags: review?(jwwang)</div><div class="change">
        <a href="/attachment.cgi?id=8736687&amp;action=edit"
           title="null out ImageContainers during shutdown"
           class=""
        >Attachment #8736687</a> -
        Flags: feedback?(jyavenard)</div></div></div><div class="change-set" id="c20"><div class="comment" data-id="11290637" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5504023_438998"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5504023_438998"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 06:28 PDT" data-time="1459430893">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="11290637">Hm, so there are other things holding on to VideoFrameContainers and triggering the issue (like MediaFormatReader), I'll update the patch as I find them. I can reproduce this very intermittently so it's going to take a while.
Still interested in confirming whether or not this approach is the one you guys want to pursue, though. The risk here is that as soon as someone adds a strong reference to a VideoFrameContainer or an ImageContainer, it can create an intermittent shutdown bug.</pre></div><div class="change-set" id="c21"><div class="comment" data-id="11290779" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5504023_438998"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5504023_438998"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 07:31 PDT" data-time="1459434712">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8736709"
         class="attachment patch"
         data-id="8736709" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="imagecontainerchild-fix">
      <meta itemprop="contentSize" content="5477">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8736709">
          <a class="link" href="attachment.cgi?id=8736709&amp;action=diff">
        <span id="att-8736709-description" itemprop="description">Don't delete an ImageContainerChild if its ImageContainer is still holding on to it</span></a>
        — <a href="attachment.cgi?id=8736709&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1243466&attachment=8736709">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-21" data-comment-id="11290779">Complementary approach (or perhaps alternative). This specifically addresses the crash stack on this bug (trying to destroy the ipdl actor too late). If we do anything else with the actor we'll run into issues, but in theory the only thing that hurts us is the liveness of objects past shutdown so we shouldn't run into them being *used* past shutdown. We'll also have problems if a late ImageContainer is holding on to textures, but Jean-Yves being confident that this is a thing of the past, I am more than happy to believe him!</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: review?(sotaro.ikeda.g)</div></div></div><div class="change-set" id="a5524031_279663"><div class="change" id="aa5524031_279663">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_279663" id="a5524031_279663"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_279663" id="a5524031_279663"><a class="email " href="/user_profile?user_id=279663" > <span class="fna">Jim Mathies [:jimm]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a5524031_279663"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a5524031_279663">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a5524031_279663">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 10:12 PDT" data-time="1459444347">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=isnotempty">tracking-e10s</a>:
          <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_e10s&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">Priority: -- &rarr; P3</div></div></div><div class="change-set" id="c22"><div class="comment" data-id="11292273" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5524031_279663"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 14:37 PDT" data-time="1459460232">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="11292273">Comment on <span class=""><a href="/attachment.cgi?id=8736687" name="attach_8736687" title="null out ImageContainers during shutdown">attachment 8736687</a> <a href="/attachment.cgi?id=8736687&amp;action=edit" title="null out ImageContainers during shutdown">[details]</a> <a href="/attachment.cgi?id=8736687&amp;action=diff" title="null out ImageContainers during shutdown">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736687'>[review]</a>
null out ImageContainers during shutdown

Review of <span class=""><a href="/attachment.cgi?id=8736687" name="attach_8736687" title="null out ImageContainers during shutdown">attachment 8736687</a> <a href="/attachment.cgi?id=8736687&amp;action=edit" title="null out ImageContainers during shutdown">[details]</a> <a href="/attachment.cgi?id=8736687&amp;action=diff" title="null out ImageContainers during shutdown">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736687'>[review]</a>:
-----------------------------------------------------------------

You only need to null the HTMLMediaElement::mVideoFrameContainer from MediaDecoder::FinishShutdown(), no need to loop in a static function. Every HTMLMediaElement own a MediaDecoder, if not mVideoFrameContainer is already null.

But having said that, the issue is in the ImageContainer destructor. It holds a weak reference to an ImageContainerChild (mIPDLChild) and attempts to use it in its destructor even if it has already been destroyed.

Doesn't gfx hold a list of all existing ImageContainer somewhere?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736687&amp;action=edit"
           title="null out ImageContainers during shutdown"
           class=""
        >Attachment #8736687</a> -
        Flags: feedback?(jyavenard) &rarr; feedback-</div></div></div><div class="change-set" id="c23"><div class="comment" data-id="11292539" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_469171" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/72a0065153e63f74281fa53137dcda67?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_469171" id="a5524031_279663"><a class="email " href="/user_profile?user_id=469171" > <span class="fna">JW Wang [:jwwang] [:jw_wang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 16:05 PDT" data-time="1459465529">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="11292539">Comment on <span class=""><a href="/attachment.cgi?id=8736687" name="attach_8736687" title="null out ImageContainers during shutdown">attachment 8736687</a> <a href="/attachment.cgi?id=8736687&amp;action=edit" title="null out ImageContainers during shutdown">[details]</a> <a href="/attachment.cgi?id=8736687&amp;action=diff" title="null out ImageContainers during shutdown">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736687'>[review]</a>
null out ImageContainers during shutdown

Review of <span class=""><a href="/attachment.cgi?id=8736687" name="attach_8736687" title="null out ImageContainers during shutdown">attachment 8736687</a> <a href="/attachment.cgi?id=8736687&amp;action=edit" title="null out ImageContainers during shutdown">[details]</a> <a href="/attachment.cgi?id=8736687&amp;action=diff" title="null out ImageContainers during shutdown">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736687'>[review]</a>:
-----------------------------------------------------------------

::: dom/media/MediaDecoder.cpp
&#64;&#64; +693,5 &#64;&#64;
<span class="quote">&gt;  {
&gt;    MOZ_ASSERT(NS_IsMainThread());
&gt;    mDecoderStateMachine-&gt;BreakCycles();
&gt;    SetStateMachine(nullptr);
&gt; +  mVideoFrameContainer = nullptr;</span >

MediaShutdownManager::Shutdown() ensures all MediaDecoder instances will be deleted before return. It is pointless to nullify the member here since the destructor of MediaDecoder will release the reference.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736687&amp;action=edit"
           title="null out ImageContainers during shutdown"
           class=""
        >Attachment #8736687</a> -
        Flags: review?(jwwang) &rarr; review-</div></div></div><div class="change-set" id="c24"><div class="comment" data-id="11292569" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_469171" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/72a0065153e63f74281fa53137dcda67?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_469171" id="a5524031_279663"><a class="email " href="/user_profile?user_id=469171" > <span class="fna">JW Wang [:jwwang] [:jw_wang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 16:14 PDT" data-time="1459466098">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="11292569">(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c22">comment #22</a>)
<span class="quote">&gt; But having said that, the issue is in the ImageContainer destructor. It
&gt; holds a weak reference to an ImageContainerChild (mIPDLChild) and attempts
&gt; to use it in its destructor even if it has already been destroyed.
&gt; 
&gt; Doesn't gfx hold a list of all existing ImageContainer somewhere?</span >

As jya said, the crash can be fixed if an ImageContainer knows whether mIPDLChild is deleted or not.</pre></div><div class="change-set" id="c25"><div class="comment" data-id="11292589" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_469171" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/72a0065153e63f74281fa53137dcda67?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_469171" id="a5524031_279663"><a class="email " href="/user_profile?user_id=469171" > <span class="fna">JW Wang [:jwwang] [:jw_wang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 16:19 PDT" data-time="1459466361">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="11292589">All the work here is ensuring all VideoFrameContainers are deleted before IPC error happens so we won't access mIPDLChild after it is deleted implicitly by OnNotifyMaybeChannelError(). However, I think the real problem is the poor life cycle management of mIPDLChild.</pre></div><div class="change-set" id="c26"><div class="comment" data-id="11292881" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5524031_279663"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-03-31 19:10 PDT" data-time="1459476624">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="11292881">Couldn't you use a proper weak pointer rather than a raw pointer to detect that the object has been deleted. Xpcom provides such weak pointer nsWeakPtr (similar to std::weak_ptr). 
I'm guessing you used raw pointer to avoid reference cycles</pre></div><div class="change-set" id="c27"><div class="comment" data-id="11293408" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5524031_279663"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-01 02:24 PDT" data-time="1459502679">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="11293408">(In reply to JW Wang [:jwwang] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c23">comment #23</a>)
<span class="quote">&gt; MediaShutdownManager::Shutdown() ensures all MediaDecoder instances will be
&gt; deleted before return. It is pointless to nullify the member here since the
&gt; destructor of MediaDecoder will release the reference.</span >

It probably tries to ensure that, but the reality is that some MediaDecoders are still alive past the shutdown, see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c16">comment 16</a> for example.

(In reply to Jean-Yves Avenard [:jya] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c26">comment #26</a>)
<span class="quote">&gt; Couldn't you use a proper weak pointer rather than a raw pointer to detect
&gt; that the object has been deleted. Xpcom provides such weak pointer nsWeakPtr
&gt; (similar to std::weak_ptr). </span >

As far as I know (correct me if it's changed) our weak pointers are not thread-safe.


OK, I give up about enforcing that PImageContainerChild actors must be deleted before IPDL shuts down. It will bite us as soon as we add a bit of complexity to PImageContainerChild, but <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a> works around this crash and will do for now.</pre></div><div class="change-set" id="c28"><div class="comment" data-id="11293591" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_512198" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/6be4974bfc86cb50db580e5d5e7e78cb?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_512198" id="a5524031_279663"><a class="email " href="/user_profile?user_id=512198" > <span class="fna">Jean-Yves Avenard [:jya]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-01 03:18 PDT" data-time="1459505922">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="11293591">(In reply to Nicolas Silva [:nical] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c27">comment #27</a>)
<span class="quote">&gt; (In reply to JW Wang [:jwwang] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c23">comment #23</a>)
&gt; &gt; MediaShutdownManager::Shutdown() ensures all MediaDecoder instances will be
&gt; &gt; deleted before return. It is pointless to nullify the member here since the
&gt; &gt; destructor of MediaDecoder will release the reference.
&gt; 
&gt; It probably tries to ensure that, but the reality is that some MediaDecoders
&gt; are still alive past the shutdown, see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c16">comment 16</a> for example.</span >

I can well believe that for HTMLMediaElement which are cycle counted.

But not MediaDecoder.</pre></div><div class="change-set" id="c29"><div class="comment" data-id="11297641" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_434202" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/a0c6bcb88fdc08a4e55f4fcf65cf0428?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_434202" id="a5524031_279663"><a class="email " href="/user_profile?user_id=434202" > <span class="fna">Sotaro Ikeda [:sotaro]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-03 18:39 PDT" data-time="1459733977">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="11297641">Comment on <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a>
Don't delete an ImageContainerChild if its ImageContainer is still holding on to it

Review of <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a>:
-----------------------------------------------------------------

The patch looks good.

::: gfx/layers/ImageContainer.cpp
&#64;&#64; +133,3 &#64;&#64;
<span class="quote">&gt;  };
&gt;  
&gt; +void ImageContainer::DeallocActor(PImageContainerChild* aActor)</span >

// nit. It seems nice if the function has a comment that it is static like &quot;/* static */&quot;.

&#64;&#64; +144,5 &#64;&#64;
<span class="quote">&gt; +    actor-&gt;mIPCOpen = false;
&gt; +  }
&gt; +}
&gt; +
&gt; +void ImageContainer::AsyncDestroyActor(PImageContainerChild* aActor)</span >

// nit. It seems nice if the function has a comment that it is static like &quot;/* static */&quot;.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: review?(sotaro.ikeda.g) &rarr; review+</div></div></div><div class="change-set" id="c30"><div class="comment" data-id="11297908" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a5524031_279663"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-04 01:07 PDT" data-time="1459757268">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-30" data-comment-id="11297908"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/e02d45c89add">https://hg.mozilla.org/integration/mozilla-inbound/rev/e02d45c89add</a></pre></div><div class="change-set" id="c31"><div class="comment" data-id="11300704" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a5524031_279663"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a5524031_279663"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-04 20:40 PDT" data-time="1459827616">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="11300704"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/e02d45c89add">https://hg.mozilla.org/mozilla-central/rev/e02d45c89add</a></pre><div class="activity"><div class="change">Status: NEW &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2016-04-04 20:40 PDT" data-time="1459827616">6 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox48&amp;o1=isnotempty">status-firefox48</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox48&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla48</div></div></div><div class="change-set" id="a6493391_1689"><div class="change" id="aa6493391_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6493391_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a6493391_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6493391_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6493391_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a6493391_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-11 15:28 PDT" data-time="1460413707">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: gfx-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="c32"><div class="comment" data-id="11324617" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6493391_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a6493391_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-13 17:00 PDT" data-time="1460592031">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="11324617">[Tracking Requested - why for this release]:
This didn't go through the sec-approval process. What branches are affected? It was reported in Firefox 47 so at least that one needs the fix, but does it affect Firefox 46 or either of the supported ESR branches?</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=isnotempty">status-firefox46</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=isnotempty">status-firefox47</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=isnotempty">status-firefox-esr38</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=isnotempty">status-firefox-esr45</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=isnotempty">tracking-firefox46</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=isnotempty">tracking-firefox-esr45</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Flags: needinfo?(nical.bugzilla)</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=regressionwindow-wanted&amp;resolution=---">regressionwindow-wanted</a></div></div></div><div class="change-set" id="c33"><div class="comment" data-id="11324623" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6493391_1689"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a6493391_1689"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-13 17:02 PDT" data-time="1460592140">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="11324623">We need the sec-approval? flag set on the patch and the template for sec-approval filled out so we can know what we need to do here to avoid exposing ourselves now that this is checked in.</pre></div><div class="change-set" id="a6676657_451704"><div class="change" id="aa6676657_451704">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a6676657_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_451704" id="a6676657_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6676657_451704"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6676657_451704">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a6676657_451704">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-13 18:22 PDT" data-time="1460596973">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=isnotempty">tracking-firefox46</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox47&amp;o1=isnotempty">tracking-firefox47</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox47&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox48&amp;o1=isnotempty">tracking-firefox48</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox48&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c34"><div class="comment" data-id="11325753" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a6676657_451704"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a6676657_451704"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-14 03:33 PDT" data-time="1460630019">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="11325753">Comment on <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a>
Don't delete an ImageContainerChild if its ImageContainer is still holding on to it

[Security approval request comment]
How easily could an exploit be constructed based on the patch?

I don't think an exploit can be constructed easily, if at all (though someone who knows more about this topic could make a more educated statement, here).
The state of the objects involved in this UAF are independent of the web content itself. Web content can cause them to exist, but it can't see them in any form and has no effect on the values they store and on whether or not the destruction of the two objects will happen in the wrong order.
Even if this UAF was systematic, it can only happen during the shutdown of the process (either normal or abnormal shutdown), so one can't repeatedly trigger the bug to enhance the likelihood of something bad happening. Moreover, the two objects are destroyed in the wrong order but no script or other kind of web-served content is run between the destruction of the two objects, so no occasion for web content to attempt to allocate something after one of the objects is destroyed and before the other one uses its memory. And no web content will run after the first object is destroyed at all because the process is already shutting down.


Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?

No.

Which older supported branches are affected by this flaw?

My guess is that this has been theoretically possible since gecko 42, although its likelihood may have fluctuated and if it has I don't know because of what. 

If not all supported branches, which bug introduced the flaw?

My guess is <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Send timestamped images from video decoding to the compositor"
   href="/show_bug.cgi?id=1143575">bug 1143575</a>.

Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?

Not yet. I would confident about an aurora uplift since the patch has been in central for 10 days without causing trouble, I wouldn't uplift/backport it further.

How likely is this patch to cause regressions; how much testing does it need?

Unlikely. Manual testing resources are probably better spent elsewhere. I think that our nightly population is enough testing in this case.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(nical.bugzilla)</span></div><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: sec-approval?</div></div></div><div class="change-set" id="a6735297_1689"><div class="change" id="aa6735297_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6735297_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a6735297_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6735297_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6735297_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a6735297_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-14 10:40 PDT" data-time="1460655613">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8712775&amp;action=edit"
           title="Testcase"
           class=""
        >Attachment #8712775</a> -
        Attachment mime type: application/octet-stream &rarr; application/java-archive</div></div></div><div class="change-set" id="c35"><div class="comment" data-id="11327173" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6735297_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a6735297_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-14 10:51 PDT" data-time="1460656291">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="11327173">Christoph: please verify that this fixes the bug. Since IPC is implicated does this crash require e10s? If so then we don't need to worry about ESR-45</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=isnotempty">status-firefox46</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox46&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=isnotempty">status-firefox-esr38</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr38&amp;o1=equals&amp;v1=unaffected">unaffected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=isnotempty">status-firefox-esr45</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=isnotempty">tracking-firefox46</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=%2B">+</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox46&amp;o1=equals&amp;v1=-">-</a></div><div class="change">Flags: needinfo?(cdiehl)</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=regressionwindow-wanted&amp;resolution=---">regressionwindow-wanted</a> &rarr; <a href="/buglist.cgi?keywords=regression&amp;resolution=---">regression</a></div><div class="change">Whiteboard: [gfx-noted] &rarr; [gfx-noted] maybe regressed by 1143575</div></div></div><div class="change-set" id="a6779488_1689"><div class="change" id="aa6779488_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6779488_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a6779488_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6779488_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6779488_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a6779488_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-14 22:56 PDT" data-time="1460699804">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [gfx-noted] maybe regressed by 1143575 &rarr; [gfx-noted] maybe regressed by 1143575 (fx42)</div></div></div><div class="change-set" id="c36"><div class="comment" data-id="11329102" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a6779488_1689"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a6779488_1689"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-15 02:11 PDT" data-time="1460711487">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="11329102">(In reply to Daniel Veditz [:dveditz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c35">comment #35</a>)
<span class="quote">&gt; Christoph: please verify that this fixes the bug. Since IPC is implicated
&gt; does this crash require e10s? If so then we don't need to worry about ESR-45</span >

Sorry, I say &quot;IPC&quot; when I should be saying &quot;IPDL&quot; and this also applies to non-e10s shutdown.</pre></div><div class="change-set" id="c37"><div class="comment" data-id="11330109" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_368570" id="a6779488_1689"><img src="https://secure.gravatar.com/avatar/9e7272cd8191f064be3b2b7dcd6a8903?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_368570" id="a6779488_1689"><a class="email disabled" href="/user_profile?user_id=368570" > <span class="fna">Christoph Diehl [:posidron]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-15 08:37 PDT" data-time="1460734625">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="11330109">(In reply to Daniel Veditz [:dveditz] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c35">comment #35</a>)
<span class="quote">&gt; Christoph: please verify that this fixes the bug. Since IPC is implicated
&gt; does this crash require e10s? If so then we don't need to worry about ESR-45</span >

It seems so, I have also not seen this anymore on our cluster.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(cdiehl)</span></div></div></div><div class="change-set" id="a6841810_280903"><div class="change" id="aa6841810_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6841810_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a6841810_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6841810_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6841810_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a6841810_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-15 16:15 PDT" data-time="1460762126">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: sec-approval? &rarr; sec-approval+</div></div></div><div class="change-set" id="c38"><div class="comment" data-id="11334056" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_495955" id="a6841810_280903"><img src="https://secure.gravatar.com/avatar/5aa2e382197a147b42d020b6878f8623?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_495955" id="a6841810_280903"><a class="email " href="/user_profile?user_id=495955" > <span class="fna">Sylvestre Ledru [:Sylvestre]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-18 06:39 PDT" data-time="1460986763">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="11334056">Not affecting esr45 if I understood correctly, right?</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=isnotempty">status-firefox-esr45</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr45&amp;o1=equals&amp;v1=unaffected">unaffected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=isnotempty">tracking-firefox-esr45</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr45&amp;o1=equals&amp;v1=-">-</a></div></div></div><div class="change-set" id="a7166319_280903"><div class="change" id="aa7166319_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a7166319_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a7166319_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a7166319_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a7166319_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-19 10:23 PDT" data-time="1461086635">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: needinfo?(nical.bugzilla)</div></div></div><div class="change-set" id="c39"><div class="comment" data-id="11341117" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a7166319_280903"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-04-20 07:23 PDT" data-time="1461162208">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="11341117">(In reply to Sylvestre Ledru [:sylvestre] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c38">comment #38</a>)
<span class="quote">&gt; Not affecting esr45 if I understood correctly, right?</span >

Theoretically it does affect 45. In practice I don't know. I think that the risk of this being exploitable is fairly low (see <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Heap-use-after-free crash [&#64;mozilla::layers::ImageContainer::~ImageContainer]"
   href="/show_bug.cgi?id=1243466#c34">comment 34</a>, although I would be interested to hear what someone more experienced about security than me thinks about that). I Also think that writing and uplifting a patch that applies that far back is riskier than not patching esr 45.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(nical.bugzilla)</span></div></div></div><div class="change-set" id="c40"><div class="comment" data-id="11394336" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_538805" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/9bd092443d615af36b31b04e81ad7806?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_538805" id="a7166319_280903"><a class="email disabled" href="/user_profile?user_id=538805" > <span class="fna">Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-09 13:46 PDT" data-time="1462826774">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="11394336">Hello Nicolas, this is a sec-high issue that affects Fx47. Could you please nominate for uplift to Beta? Thanks!</pre><div class="activity"><div class="change">Flags: needinfo?(nical.bugzilla)</div></div></div><div class="change-set" id="c41"><div class="comment" data-id="11394382" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_456486" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/afff8630fb0a0c0a44853cd700ac0a4d?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_456486" id="a7166319_280903"><a class="email " href="/user_profile?user_id=456486" > <span class="fna">Milan Sreckovic [:milan] (needinfo for best results)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-09 13:55 PDT" data-time="1462827331">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="11394382">Sotaro reviewed this code and Nical is on PTO, may save us a day for Sotaro to nominate and explain.</pre><div class="activity"><div class="change">Flags: needinfo?(sotaro.ikeda.g)</div></div></div><div class="change-set" id="c42"><div class="comment" data-id="11395937" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_438998" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/33545d2334463711ea5db843306e04ab?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_438998" id="a7166319_280903"><a class="email " href="/user_profile?user_id=438998" > <span class="fna">Nicolas Silva [:nical]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-10 02:35 PDT" data-time="1462872922">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="11395937">Comment on <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a>
Don't delete an ImageContainerChild if its ImageContainer is still holding on to it

Approval Request Comment
[Feature/regressing bug #]:
[User impact if declined]: Shutdown use-after-free crashes
[Describe test coverage new/current, TreeHerder]:
[Risks and why]: Not too risky. This patch is touching trickier stuff than what I'm usually happy with uplifting to beta, but it applies cleanly on the branch and has been on central and aurora for a while now without causing any issue, so I feel good about uplifting.
[String/UUID change made/needed]: none.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(sotaro.ikeda.g)</span></div><div class="change">Flags: <span class="activity-deleted">needinfo?(nical.bugzilla)</span></div><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c43"><div class="comment" data-id="11397969" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_538805" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/9bd092443d615af36b31b04e81ad7806?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_538805" id="a7166319_280903"><a class="email disabled" href="/user_profile?user_id=538805" > <span class="fna">Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-10 13:40 PDT" data-time="1462912846">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-43" data-comment-id="11397969">Comment on <span class=""><a href="/attachment.cgi?id=8736709" name="attach_8736709" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">attachment 8736709</a> <a href="/attachment.cgi?id=8736709&amp;action=edit" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[details]</a> <a href="/attachment.cgi?id=8736709&amp;action=diff" title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1243466&amp;attachment=8736709'>[review]</a>
Don't delete an ImageContainerChild if its ImageContainer is still holding on to it

Sec-high, baked in Nightly for a month, Beta47+</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8736709&amp;action=edit"
           title="Don't delete an ImageContainerChild if its ImageContainer is still holding on to it"
           class=""
        >Attachment #8736709</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c44"><div class="comment" data-id="11398244" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a7166319_280903"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a7166319_280903"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-10 14:48 PDT" data-time="1462916888">6 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-44" data-comment-id="11398244"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/39fce55feada">https://hg.mozilla.org/releases/mozilla-beta/rev/39fce55feada</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=isnotempty">status-firefox47</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox47&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a10388912_280903"><div class="change" id="aa10388912_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a10388912_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a10388912_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a10388912_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a10388912_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a10388912_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-26 17:33 PDT" data-time="1464309228">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [gfx-noted] maybe regressed by 1143575 (fx42) &rarr; [adv-main47+][gfx-noted] maybe regressed by 1143575 (fx42)</div></div></div><div class="change-set" id="a10451440_452604"><div class="change" id="aa10451440_452604">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_452604" id="a10451440_452604"><img src="https://secure.gravatar.com/avatar/7bb698c4991c5af83adabe3c3b8ee8aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_452604" id="a10451440_452604"><a class="email disabled" href="/user_profile?user_id=452604" > <span class="fna">Matt Wobensmith [:mwobensmith][:matt:]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a10451440_452604"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a10451440_452604">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a10451440_452604">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2016-05-27 10:55 PDT" data-time="1464371756">6 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [adv-main47+][gfx-noted] maybe regressed by 1143575 (fx42) &rarr; [post-critsmash-triage][adv-main47+][gfx-noted] maybe regressed by 1143575 (fx42)</div></div></div><div class="change-set" id="a29715796_1689"><div class="change" id="aa29715796_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a29715796_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a29715796_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a29715796_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a29715796_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1243466#a29715796_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-01-05 09:08 PST" data-time="1483636112">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1243466&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>