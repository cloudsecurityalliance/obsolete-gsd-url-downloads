<!DOCTYPE html>
<html lang="en">
  <head>
    <title>3596 &ndash; ntpd uses highly predictable transmit timestamps</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

<link href="data/assets/7aa6ea67750936a0368541421bdcd5ee.css" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "3596 – ntpd uses highly predictable transmit timestamps",
                             "show_bug.cgi?id=3596" );
        document.title = "3596 – ntpd uses highly predictable transmit timestamps";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "3596 – ntpd uses highly predictable transmit timestamps", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><link rel="stylesheet" type="text/css" href="extensions/NTP/web/style.css">
  </head>

  <body 
        class="bugs-ntp-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_ntp
                 bz_component_ntpd
                 bz_bug_3596 yui-skin-sam">

  <div id="header"><div id="ntf">
  <div id="ntf-join" class="ntf-button">
    <a class="ntf" href="http://networktimefoundation.org/join" title="">join</a>
  </div>
  <div id="ntf-donate" class="ntf-button">
    <a class="ntf" href="http://networktimefoundation.org/donate" title="">donate</a>
  </div>
  <div id="ntf-links">
    Network Time Foundation: 
           <a class="ntf" href="http://networktimefoundation.org/projects/ntp/" title="Network Time Protocol Project">NTP</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/ptpd/" title="Precision Time Protocol daemon Project">PTPd</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/linuxptp/" title="Linux Precision Time Protocol Project">Linux PTP</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/radclock/" title="Robust Absolute and Difference Clock Project">RADclock</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/gpsd/" title="GPS daemon Project">GPSD</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/timestamp-api/" title="General Timestamp API Project">GT API</a> 
    &bull; <a class="ntf" href="http://networktimefoundation.org/projects/" title="Other Projects">More</a>
  </div>
</div>

    <div id="titles">
      <span id="title">Bugzilla &ndash; Bug&nbsp;3596</span>

        <span id="subtitle" class="subheader">ntpd uses highly predictable transmit timestamps</span>

        <span id="information" class="header_addl_info">Last modified: 2020-11-11 06:43:43 UTC</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=3596&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=3596" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=3596&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635620550-fJjOd-ce-YfF7HqJ8DAjkmF7786UBbshh-tTiaPdtqQ">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body"><div id="message">NTP users are strongly urged to take immediate action to ensure that their NTP daemons are not susceptible to being used in distributed denial-of-service (DDoS) attacks. Please also take this opportunity to defeat denial-of-service attacks by <a title="BCP38 Ingress/Egress filtering" href="http://bcp38.info" target="_blank">implementing Ingress and Egress filtering through BCP38</a>.

<p><code>ntp-4.2.8p15</code> was released on 23 June 2020 and addresses 1 medium-severity issue in ntpd, and provides 13 non-security bugfixes over 4.2.8p14.</p>

<p>Please see the <a title="NTP Security Notice" href="http://support.ntp.org/bin/view/Main/SecurityNotice#Recent_Vulnerabilities" target="_blank">NTP Security Notice</a> for vulnerability and mitigation details.</div>


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2020-11-11 06:43:43">
  <input type="hidden" name="id" value="3596">
  <input type="hidden" name="token" value="1635620550-lM0JnwMpQuF7jnOUt71U0VM88HnKSxeY3S-bCHUKcTM">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=3596"><b>Bug&nbsp;3596</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">ntpd uses highly predictable transmit timestamps</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>ntpd uses highly predictable transmit timestamps
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'ntpd uses highly predictable transmit timestamps' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >ntp

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=ntp"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >ntpd

  (<a href="buglist.cgi?component=ntpd&amp;product=ntp&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr><th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>
<td>4.2.8
  </td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">PC
        All
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P3
       major
      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'stenn\x40ntp.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2019-06-20 02:00 UTC by <span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2020-11-11 06:43 UTC
      (<a href="show_activity.cgi?id=3596">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>2 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="kircherlike">kircherlike</option>
                <option value="mlichvar">mlichvar</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

<tr>
      <th class="field_label">
        <label>Flags:</label>
      </th>
      <td><span title="Harlan Stenn">stenn</span>:
      <span class="nowrap">blocking4.2.8+</span><br>
      </td>
    </tr>

        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>



  <tr class="bz_attach_footer">
    <td colspan="3">
        <a href="attachment.cgi?bugid=3596&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=3596&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2019-06-20 02:00:13 UTC
        </span>

      </div>




<pre class="bz_comment_text"></pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2019-06-20 02:07:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">MIroslav emailed the following to security&#64; :

The discussion about random source port on the NTP WG mailing list
prompted me to try the off-attack on ntpd where the attacker is
predicting transmit timestamps in order to take control of the clock.

It works. I was able to force ntpd using three NTP sources to update
its clock with an arbitrary offset, predicting its transmissions
only from information that it provides as an NTP server.

The main issue here is that the sub-second part of the transmission
timestamps is very stable due to the fixed 1-second timer that ntpd
uses for all its requests, which makes the origin timestamp in server
responses highly predictable. The stability depends on many things
(e.g. CPU load, network load), but in my tests on Linux there were
only about 16 random bits.

In case of a stratum 2 server the attacker can determine the stable
bits of the sub-second part from the reference timestamp, root delay
and response time of the upstream server. In other cases the attacker
can try slowly adjusting the value until the server switches to
another source, indicating the offset was injected, which caused the
original source to be rejected in the source selection. When this
value is known, it is possible to spoof responses from all other
sources that the client is using (which can be determined from the
refid).

In my tests I was sending packets at a rate of about 750000 per
second, iterating over the 16-bit space several times per second. The
client could process less than half of it, which means most of the
genuine responses from the upstream servers were also dropped, so the
attack window wasn't limited to the round trip time.

Only one injected sample is needed to cause a source to be rejected
in the source selection. The clock filter has 8 samples, so 8 samples
need to be injected in a row in order to update the clock. The goal of
the attacker is to have the client one source (assuming default
minclock) with 8 injected samples and all other sources at least one
injected sample each.

In my tests with three sources polled at an 8-second interval (and the
stepout timeout adjusted accordingly) the attack took an hour. With
a 64-second polling interval it took whole night. I didn't try a
longer interval, but I expect it to scale linearly. There are some
optimizations I have not tried to implement, which may reduce the time
significantly.

Here is an ntpd log which shows a clock update reached the panic
threshold:
10.11.160.238 8014 84 reachable
10.5.26.10 8014 84 reachable
10.5.27.10 8014 84 reachable
10.11.160.238 901a 8a sys_peer
0.0.0.0 c615 05 clock_sync
10.5.26.10 901a 8a sys_peer
0.0.0.0 0618 08 no_sys_peer
10.11.160.238 902a 8a sys_peer
0.0.0.0 0628 08 no_sys_peer
10.5.27.10 901a 8a sys_peer
0.0.0.0 0638 08 no_sys_peer
10.5.26.10 902a 8a sys_peer
10.11.160.238 903a 8a sys_peer
10.5.26.10 903a 8a sys_peer
10.11.160.238 944a 8a sys_peer
10.5.27.10 942a 8a sys_peer
0.0.0.0 0648 08 no_sys_peer
10.5.27.10 903a 8a sys_peer
0.0.0.0 0617 07 panic_stop +10000 s; set clock manually within 1000 s.
0.0.0.0 061d 0d kern kernel time sync disabled


I think this is a serious issue that that needs to be fixed as soon as
possible. Random source port might make the attack impractical.
Ideally ntpd would be using fully random transmit timestamps as
recommended in the data minimization draft.

Please let me know if there are any questions. I'll see if I can write
a short article with more details about this vulnerability.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2020-03-03 06:25:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">STAGED for ntp-4.2.8p14</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Harlan Stenn</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2020-03-04 05:00:22 UTC
        </span>

      </div>




<pre class="bz_comment_text">Miroslav, thanks for your report.

Please mark this bug as VERIFIED or REOPENED, as appropriate.

Pearly, thanks for your work on this.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Miroslav Lichvar</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2020-10-22 13:55:09 UTC
        </span>

      </div>




<pre class="bz_comment_text">I did a quick test with ntp-4.2.8p15. I don't see any change in the predictability of the transmit timestamp. In the tcpdump log I see:

          Transmit Timestamp:   3812362068.379084938 (2020/10/22 15:27:48)
          Transmit Timestamp:   3812362070.379091346 (2020/10/22 15:27:50)
          Transmit Timestamp:   3812362072.379084193 (2020/10/22 15:27:52)
          Transmit Timestamp:   3812362074.379087482 (2020/10/22 15:27:54)
          Transmit Timestamp:   3812362076.379122541 (2020/10/22 15:27:56)
          Transmit Timestamp:   3812362078.379117626 (2020/10/22 15:27:58)
          Transmit Timestamp:   3812362134.379101956 (2020/10/22 15:28:54)
          Transmit Timestamp:   3812362202.379112421 (2020/10/22 15:30:02)
          Transmit Timestamp:   3812362268.379094490 (2020/10/22 15:31:08)
          Transmit Timestamp:   3812362336.379094767 (2020/10/22 15:32:16)
          Transmit Timestamp:   3812362405.379097638 (2020/10/22 15:33:25)
          Transmit Timestamp:   3812362473.379107612 (2020/10/22 15:34:33)
          Transmit Timestamp:   3812362540.379067952 (2020/10/22 15:35:40)
          Transmit Timestamp:   3812362609.379100428 (2020/10/22 15:36:49)
          Transmit Timestamp:   3812362677.379106131 (2020/10/22 15:37:57)
          Transmit Timestamp:   3812362743.379096065 (2020/10/22 15:39:03)
          Transmit Timestamp:   3812362811.379123724 (2020/10/22 15:40:11)
          Transmit Timestamp:   3812362880.379128079 (2020/10/22 15:41:20)
          Transmit Timestamp:   3812362948.379094403 (2020/10/22 15:42:28)
          Transmit Timestamp:   3812363014.379084829 (2020/10/22 15:43:34)

The sub-second part of all these transmit timestamps was between .3790841 and .3791281. That's only ~44 microseconds, or ~18 bits that the attacker needs to guess.

I'd reopen the bug, but my bugzilla account doesn't seem to the permissions for that.</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=3596#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">kircher</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2020-11-11 06:43:43 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=3596#c4">comment #4</a>)
<span class="quote">&gt; I did a quick test with ntp-4.2.8p15. I don't see any change in the
&gt; predictability of the transmit timestamp. In the tcpdump log I see:
&gt; 
&gt;           Transmit Timestamp:   3812362068.379084938 (2020/10/22 15:27:48)
&gt;           Transmit Timestamp:   3812362070.379091346 (2020/10/22 15:27:50)
&gt;           Transmit Timestamp:   3812362072.379084193 (2020/10/22 15:27:52)
&gt;           Transmit Timestamp:   3812362074.379087482 (2020/10/22 15:27:54)
&gt;           Transmit Timestamp:   3812362076.379122541 (2020/10/22 15:27:56)
&gt;           Transmit Timestamp:   3812362078.379117626 (2020/10/22 15:27:58)
&gt;           Transmit Timestamp:   3812362134.379101956 (2020/10/22 15:28:54)
&gt;           Transmit Timestamp:   3812362202.379112421 (2020/10/22 15:30:02)
&gt;           Transmit Timestamp:   3812362268.379094490 (2020/10/22 15:31:08)
&gt;           Transmit Timestamp:   3812362336.379094767 (2020/10/22 15:32:16)
&gt;           Transmit Timestamp:   3812362405.379097638 (2020/10/22 15:33:25)
&gt;           Transmit Timestamp:   3812362473.379107612 (2020/10/22 15:34:33)
&gt;           Transmit Timestamp:   3812362540.379067952 (2020/10/22 15:35:40)
&gt;           Transmit Timestamp:   3812362609.379100428 (2020/10/22 15:36:49)
&gt;           Transmit Timestamp:   3812362677.379106131 (2020/10/22 15:37:57)
&gt;           Transmit Timestamp:   3812362743.379096065 (2020/10/22 15:39:03)
&gt;           Transmit Timestamp:   3812362811.379123724 (2020/10/22 15:40:11)
&gt;           Transmit Timestamp:   3812362880.379128079 (2020/10/22 15:41:20)
&gt;           Transmit Timestamp:   3812362948.379094403 (2020/10/22 15:42:28)
&gt;           Transmit Timestamp:   3812363014.379084829 (2020/10/22 15:43:34)
&gt; 
&gt; The sub-second part of all these transmit timestamps was between .3790841 and
&gt; .3791281. That's only ~44 microseconds, or ~18 bits that the attacker needs to
&gt; guess.
&gt; 
&gt; I'd reopen the bug, but my bugzilla account doesn't seem to the permissions for
&gt; that.</span >


We would like to know how many randomization bits and the risk of attack are there for Transmit Timestamp, perhaps you could provide a program that simulates attacks? It can be Python3, shell, or C language code.

For example, we can randomize only the 32 bits of the decimal part of the Transmit Timestamp when sending a packet. I don't know if this can solve the problem of ntp predictability.

Sending a completely randomized 64-bit Transmit Timestamp will make this field invalid.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=3596">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=3596">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=3596">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=3596&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=3596" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=3596&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635620550-fJjOd-ce-YfF7HqJ8DAjkmF7786UBbshh-tTiaPdtqQ">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>