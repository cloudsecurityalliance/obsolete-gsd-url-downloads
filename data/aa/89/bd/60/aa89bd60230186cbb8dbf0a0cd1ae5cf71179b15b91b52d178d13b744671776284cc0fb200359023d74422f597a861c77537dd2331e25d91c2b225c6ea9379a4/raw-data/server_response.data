<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1378207 - (CVE-2017-7820) instanceof operator can bypass Xray and run unprivileged proxy trap">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1378207">
<meta property="og:description"
      content="RESOLVED (gkrizsanits) in Core - XPConnect. Last updated 2018-02-01.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1378207 - (CVE-2017-7820) instanceof operator can bypass Xray and run unprivileged proxy trap</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1378207&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1378207">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1378207">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/yui.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/global.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/util.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"flags\":{\"tracking\":{\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr52\":\"wontfix\",\"cf_tracking_firefox95\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_status_firefox95\":\"---\",\"cf_status_firefox55\":\"wontfix\",\"cf_status_firefox56\":\"fixed\",\"cf_status_firefox93\":\"---\",\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_tracking_firefox56\":\"+\",\"cf_tracking_firefox57\":\"+\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox57\":\"fixed\",\"cf_status_thunderbird_esr78\":\"---\"},\"project\":{\"cf_root_cause\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\",\"cf_fission_milestone\":\"---\"}},\"types\":[\"tracking\"],\"comments\":{\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox56\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox57\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1378207;
  BUGZILLA.bug_title = '1378207 - (CVE-2017-7820) instanceof operator can bypass Xray and run unprivileged proxy trap';
  BUGZILLA.bug_summary = 'instanceof operator can bypass Xray and run unprivileged proxy trap';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1378207';
  BUGZILLA.bug_keywords = 'sec-low',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/field.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/comments.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1378207">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1378207"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1378207 - (CVE-2017-7820) instanceof operator can bypass Xray and run unprivileged proxy trap">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="ef27Td5DIuRHYpfBZ2XywyBJ98l9pZfYjX4Fv9Rvnr2japES5YlpjvJLw9kocA2O43VX1Mq0LIBqVueAWUThlzYLsHifmOfIEk3uboRqmMCkNY1KlfN8C4notzH18DiYYAKfketEaP67WRwKPU0xjTSJ9d6lb5FpfrJLSgriN7e47grXGlnsSVeHo9zwqizhYnaPgr3488qIN0VpYJ6d7mJqOViVSgYqjAingIRoFwSn7EdlmzNcD7bDLg3NpFDx">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1378207" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623207-kVQsUyxIbj9TVtiE0sSXPvZdueTNEznLag0ExQQkNjI">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1378207" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1378207" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1378207">Bug 1378207</a>
          <span class="edit-hide">(CVE-2017-7820)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-07-04 12:10 PDT" data-time="1499195430">4 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2017-08-08 15:17 PDT" data-time="1502230649">4 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">instanceof operator can bypass Xray and run unprivileged proxy trap</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            instanceof operator can bypass Xray and run unprivileged proxy trap

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: XPConnect, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=XPConnect#XPConnect" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">XPConnect
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: XPConnect</div>
            <div class="description">Facilitates calling between JavaScript and XPCOM components.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=XPConnect&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=XPConnect&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=XPConnect"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="XPConnect"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-version" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            unspecified

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;dupe_of&quot;:null,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr52&quot;:&quot;wontfix&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;status&quot;:&quot;RESOLVED&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;target_milestone&quot;:&quot;mozilla57&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox56&quot;:&quot;+&quot;,&quot;keywords&quot;:[&quot;sec-low&quot;],&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;id&quot;:1378207,&quot;cf_status_firefox55&quot;:&quot;wontfix&quot;,&quot;flags&quot;:[{&quot;status&quot;:&quot;-&quot;,&quot;name&quot;:&quot;qe-verify&quot;}],&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox57&quot;:&quot;+&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;priority&quot;:&quot;--&quot;,&quot;cf_status_firefox57&quot;:&quot;fixed&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_status_firefox56&quot;:&quot;fixed&quot;,&quot;cf_webcompat_priority&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">RESOLVED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            RESOLVED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla57

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox55</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox56</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox57</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=fixed">fixed</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="wontfix"
          id="v3142_cf_status_firefox_esr52" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox55</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox55-dirty">
  <select id="cf_status_firefox55" name="cf_status_firefox55">
        <option value="wontfix"
          id="v3184_cf_status_firefox55" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox56</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox56-dirty">
  <select id="cf_tracking_firefox56" name="cf_tracking_firefox56">
        <option value="+"
          id="v3273_cf_tracking_firefox56" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox56-dirty">
  <select id="cf_status_firefox56" name="cf_status_firefox56">
        <option value="fixed"
          id="v3281_cf_status_firefox56" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox57</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox57-dirty">
  <select id="cf_tracking_firefox57" name="cf_tracking_firefox57">
        <option value="+"
          id="v3288_cf_tracking_firefox57" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox57-dirty">
  <select id="cf_status_firefox57" name="cf_status_firefox57">
        <option value="fixed"
          id="v3296_cf_status_firefox57" selected
        >fixed
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: Oriol, Assigned: gkrizsanits)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">gkrizsanits</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_541576" ><img src="https://secure.gravatar.com/avatar/dfa08ecb777cf0cca2acc615dc13741b?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=541576" > <span class="fna">Oriol</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_24295" ><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=24295" > <span class="fna">peterv</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="13">13 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
          <h3 class="module-subtitle" id="module-references-subtitle">
            (Depends on 1 open bug)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Toolbox starts blank when clicking debug button at the first time in about:debugging"
   href="/show_bug.cgi?id=1430711">1430711</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-blocked" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
        ---
        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1378207&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1378207">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-see_also" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
        ---
        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: sec-low, Whiteboard: [adv-main56+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2017-7820

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[adv-main56+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#c42"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1502869587"
      >qe-verify</a>
    </td>

    <td class="flag-value">-
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_488993" ><a class="email " href="/user_profile?user_id=488993" > <span class="fna">avaida</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag-1630248">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1630248-dirty">
      <select id="flag-1630248" name="flag-1630248"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
            <option value="-" selected>-</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag_type-803">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-803-dirty">
      <select id="flag_type-803" name="flag_type-803"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (2 files, 1 obsolete file)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885235">Stop bypassing the Xray layer when walking the prototype chain. v1</a>
        </div>
        <div>
            <a href="#c12" class="attach-time activity-ref"><span class="rel-time" title="2017-07-11 05:19 PDT" data-time="1499775570">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div></span>
        </div>
        <div class="attach-info">2.75 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885235&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885235&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8885235">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885478">Stop bypassing the Xray layer when walking the prototype chain. v2</a>
        </div>
        <div>
            <a href="#c14" class="attach-time activity-ref"><span class="rel-time" title="2017-07-11 15:08 PDT" data-time="1499810894">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div></span>
        </div>
        <div class="attach-info">2.03 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_420273" ><span class="fn">gkrizsanits</span>
</div>:
              <a href="#c15"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499810894"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#c40"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1502438928"
            >
              approval-mozilla-beta+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885478&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885478&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8885478">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8893935">guard for XOW in the sandboxproto. v1</a>
        </div>
        <div>
            <a href="#c30" class="attach-time activity-ref"><span class="rel-time" title="2017-08-04 12:06 PDT" data-time="1501873617">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div></span>
        </div>
        <div class="attach-info">1.53 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_313730" ><span class="fn">bholley</span>
</div>:
              <a href="#c31"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1501873617"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_339062" ><span class="fn">rpl</span>
</div>:
              <a href="#c33"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1502101026"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#a3531326_451704"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1502439168"
            >
              approval-mozilla-beta+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8893935&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8893935&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8893935">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="OopF3svCWkC8qwCZuv4wPUfiCwHfUj39FuAto6YzRFnoLfMb">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12446721" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_541576" ><img src="https://secure.gravatar.com/avatar/dfa08ecb777cf0cca2acc615dc13741b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_541576" ><a class="email " href="/user_profile?user_id=541576" > <span class="fna">Oriol Brufau [:Oriol]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-04 12:10 PDT" data-time="1499195430">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-0" data-comment-id="12446721">Open the web console in a new tab, and run

  var obj, iframe = document.createElement('iframe');
  iframe.onload = function() {
    obj = iframe.contentWindow.eval(`new Proxy({}, {
      getPrototypeOf: function() { alert('proxy trap'); return null; }
    })`);
  };
  document.body.appendChild(iframe);

You can check that obj is an Xray wrapper:

  Cu.isXrayWrapper(obj); // true

Then, run

  obj instanceof Ci.nsIDOMWindow;

The trap runs and the alert is shown!! I think Xray is supposed to avoid this kind of things, e.g. this does not run the trap

  obj instanceof Window;

Since the console uses instanceof to display objects nicely, any page can exploit this to freeze Firefox by running

  var proxy = new Proxy({}, {getPrototypeOf: () =&gt; proxy });
  console.log(Object.create(proxy));

Not sure it's necessary, but since Xray is a security thing and is being bypassed, I am marking this bug as core-security.</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12449973" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" ><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 17:04 PDT" data-time="1499299488">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-1" data-comment-id="12449973">The about:newtab page is privileged (considered part of Firefox UI). Things you try on that page can behave quite differently from things done on an actual web page.</pre><div class="activity"><div class="change">Group: core-security &rarr; dom-core-security</div></div></div><div class="change-set" id="c2"><div class="comment" data-id="12452181" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" ><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" ><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 10:33 PDT" data-time="1499362420">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="12452181">Gabor, could you figure out if something bad is going on here? Thanks.</pre><div class="activity"><div class="change">Component: Security &rarr; XPConnect</div><div class="change">Flags: needinfo?(gkrizsanits)</div></div></div><div class="change-set" id="c3"><div class="comment" data-id="12452185" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" ><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 10:34 PDT" data-time="1499362479">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12452185">Also keep in mind that things done in the web console are executed in a page-privileged sandbox which also can behave differently than code running in the page itself. not sure if that's relevant to this case -- I executed the code using a javascript: url in the addressbar (which should be closer to executing as if it were the page) and it still hung that child process.</pre></div><div class="change-set" id="c4"><div class="comment" data-id="12452333" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_541576" ><img src="https://secure.gravatar.com/avatar/dfa08ecb777cf0cca2acc615dc13741b?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_541576" ><a class="email " href="/user_profile?user_id=541576" > <span class="fna">Oriol Brufau [:Oriol]</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-06 11:27 PDT" data-time="1499365655">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="12452333">Oh, I thought Firefox froze because the console code is privileged, but any webpage can bypass dom.max_script_run_time just with

  var proxy = new Proxy({}, {getPrototypeOf: () =&gt; proxy });
  proxy instanceof Function;

Should I file another bug for this? Is this security sensitive?</pre></div><div class="change-set" id="c5"><div class="comment" data-id="12454875" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" ><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-07 10:09 PDT" data-time="1499447366">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12454875">Bypassing the slow script dialog isn't such a big issue.

The bigger question here is whether chrome can actually trigger a JS proxy trap on a content object over Xrays. Proxy objects are supposed to be opaque over Xrays, so if we're executing a content-defined getPrototypeOf function, we should fix that.</pre></div><div class="change-set" id="c6"><div class="comment" data-id="12459580" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 04:10 PDT" data-time="1499685050">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12459580">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c5">comment #5</a>)
<span class="quote">&gt; The bigger question here is whether chrome can actually trigger a JS proxy
&gt; trap on a content object over Xrays. Proxy objects are supposed to be opaque
&gt; over Xrays, so if we're executing a content-defined getPrototypeOf function,
&gt; we should fix that.</span >

Good news: that's not what's happening, xrays are fine I think.

Bad news: we don't have xrays here at all, which is quite scary. Seems like we don't execute scratchpad code any more in the good old sandbox way but using DebuggerObject::executeInGlobal which seems to be stripping off xrays. I think Eddy worked on worker debugging and there it was important not to use any xpconnect wrappers maybe that is related.

Note: we're stripping off xrays even if we execute system code on an object from content scope (so instead of about:newtab the content is some regular web content) which is a serious concern, and I'm not sure what other wrappers we might stripping off...

Jim, do you know why are we using the Debugger eval for scratchpad and if that can be the reason why we don't have xray in this case? Can that mean that we don't have any security wrappers at all in this setup? (I'll try to test that hopefully today...) Also, where else do we use this eval? This might be a very important problem...</pre><div class="activity"><div class="change">Flags: needinfo?(gkrizsanits) &rarr; needinfo?(jimb)</div></div></div><div class="change-set" id="c7"><div class="comment" data-id="12459772" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 05:39 PDT" data-time="1499690370">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12459772">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c6">comment #6</a>)
<span class="quote">&gt; Bad news: we don't have xrays here at all, which is quite scary. </span >

Ehh... ignore my previous comment the example checked if Cu.isXrayWrapper(obj) is true so it seems like we indeed circumvent xrays here for some reason unintentionally. In non-e10s mode this can be reproduced executing the scratchpad in the browser context (system code) on a regular web page, which is a huge problem. But there can be other issues as well depending on what the underlying problem is. The stack is (I've added a sin(1) call before the alert() in the example):

 thread #1, queue = 'com.apple.main-thread', stop reason = breakpoint 1.1
  * frame #0: 0x000000010a1fc4f3 XUL`js::math_sin(cx=0x000000011ec51000, argc=1, vp=0x000000011f23a708) at jsmath.cpp:905
    frame #1: 0x000000010aa77164 XUL`js::CallJSNative(cx=0x000000011ec51000, native=(XUL`js::math_sin(JSContext*, unsigned int, JS::Value*) at jsmath.cpp:904), args=0x00007fff5fbef320)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&amp;) at jscntxtinlines.h:293
    frame #2: 0x000000010a218287 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbef320, construct=NO_CONSTRUCT) at Interpreter.cpp:470
    frame #3: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbef320) at Interpreter.cpp:515
    frame #4: 0x000000010a21857d XUL`js::CallFromStack(cx=0x000000011ec51000, args=0x00007fff5fbef320) at Interpreter.cpp:521
    frame #5: 0x000000010a20cd29 XUL`Interpret(cx=0x000000011ec51000, state=0x00007fff5fbf0448) at Interpreter.cpp:3060
    frame #6: 0x000000010a201b19 XUL`js::RunScript(cx=0x000000011ec51000, state=0x00007fff5fbf0448) at Interpreter.cpp:410
    frame #7: 0x000000010a218385 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbf0698, construct=NO_CONSTRUCT) at Interpreter.cpp:488
    frame #8: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbf0698) at Interpreter.cpp:515
    frame #9: 0x000000010a2187f6 XUL`js::Call(cx=0x000000011ec51000, fval=JS::HandleValue &#64; 0x00007fff5fbf05c0, thisv=JS::HandleValue &#64; 0x00007fff5fbf05b8, args=0x00007fff5fbf0698, rval=JS::MutableHandleValue &#64; 0x00007fff5fbf05b0) at Interpreter.cpp:534
    frame #10: 0x000000010aa51e69 XUL`js::ScriptedProxyHandler::getPrototype(this=0x000000010ea61580, cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbf07a0, protop=JS::MutableHandleObject &#64; 0x00007fff5fbf0798) const at ScriptedProxyHandler.cpp:202
    frame #11: 0x000000010aa4dc35 XUL`js::Proxy::getPrototype(cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbf07f0, proto=JS::MutableHandleObject &#64; 0x00007fff5fbf07e8) at Proxy.cpp:197
    frame #12: 0x000000010a7eed99 XUL`js::GetPrototype(cx=0x000000011ec51000, obj=JS::HandleObject &#64; 0x00007fff5fbf0840, protop=JS::MutableHandleObject &#64; 0x00007fff5fbf0838) at jsobjinlines.h:188
    frame #13: 0x000000010a7eecd5 XUL`JS_GetPrototype(cx=0x000000011ec51000, obj=JS::HandleObject &#64; 0x00007fff5fbf0888, result=JS::MutableHandleObject &#64; 0x00007fff5fbf0880) at jsapi.cpp:2045
    frame #14: 0x000000010a89f263 XUL`js::GetObjectProto(cx=0x000000011ec51000, obj=Handle&lt;JSObject *&gt; &#64; 0x00007fff5fbf08c0, proto=MutableHandle&lt;JSObject *&gt; &#64; 0x00007fff5fbf08b8) at jsfriendapi.cpp:499
    frame #15: 0x0000000103299717 XUL`FindObjectForHasInstance(cx=0x000000011ec51000, objArg=JS::HandleObject &#64; 0x00007fff5fbf0990, target=JS::MutableHandleObject &#64; 0x00007fff5fbf0988) at XPCJSID.cpp:471
    frame #16: 0x0000000103299383 XUL`xpc::HasInstance(cx=0x000000011ec51000, objArg=JS::HandleObject &#64; 0x00007fff5fbf0a50, iid=0x000000011ece5100, bp=0x00007fff5fbf0bd7) at XPCJSID.cpp:488
    frame #17: 0x0000000103299895 XUL`nsJSIID::HasInstance(this=0x000000011eb7a2e0, wrapper=0x000000012171b040, cx=0x000000011ec51000, (null)=0x0000000122e27670, val=JS::HandleValue &#64; 0x00007fff5fbf0af0, bp=0x00007fff5fbf0bd7, _retval=0x00007fff5fbf0bbf) at XPCJSID.cpp:532
    frame #18: 0x000000010329990c XUL`non-virtual thunk to nsJSIID::HasInstance(this=0x000000011eb7a2e0, wrapper=0x000000012171b040, cx=0x000000011ec51000, (null)=0x0000000122e27670, val=JS::HandleValue &#64; 0x00007fff5fbf0b58, bp=0x00007fff5fbf0bd7, _retval=0x00007fff5fbf0bbf) at XPCJSID.cpp:0
    frame #19: 0x0000000103305dbc XUL`XPC_WN_Helper_HasInstance(cx=0x000000011ec51000, obj=JS::HandleObject &#64; 0x00007fff5fbf0bf0, valp=JS::MutableHandleValue &#64; 0x00007fff5fbf0be8, bp=0x00007fff5fbf270f) at XPCWrappedNativeJSOps.cpp:776
    frame #20: 0x000000010a21a04d XUL`js::HasInstance(cx=0x000000011ec51000, obj=JS::HandleObject &#64; 0x00007fff5fbf0c90, v=JS::HandleValue &#64; 0x00007fff5fbf0c88, bp=0x00007fff5fbf270f) at Interpreter.cpp:777
    frame #21: 0x000000010a214324 XUL`Interpret(cx=0x000000011ec51000, state=0x00007fff5fbf3f90) at Interpreter.cpp:3927
    frame #22: 0x000000010a201b19 XUL`js::RunScript(cx=0x000000011ec51000, state=0x00007fff5fbf3f90) at Interpreter.cpp:410
    frame #23: 0x000000010a219613 XUL`js::ExecuteKernel(cx=0x000000011ec51000, script=JS::HandleScript &#64; 0x00007fff5fbf4050, envChainArg=0x000000011c106fc0, newTargetValue=0x00007fff5fbf4110, evalInFrame=(ptr_ = 0), result=0x00007fff5fbf4490) at Interpreter.cpp:699
    frame #24: 0x000000010ab79408 XUL`EvaluateInEnv(cx=0x000000011ec51000, env=Handle&lt;JSObject *&gt; &#64; 0x00007fff5fbf42b8, frame=(ptr_ = 0), pc=0x0000000000000000, chars=Range&lt;const char16_t&gt; &#64; 0x00007fff5fbf42e0, filename=&quot;Scratchpad/2&quot;, lineno=1, rval=JS::MutableHandleValue &#64; 0x00007fff5fbf42a8) at Debugger.cpp:8175
    frame #25: 0x000000010ab25baf XUL`DebuggerGenericEval(cx=0x000000011ec51000, chars=const mozilla::Range&lt;const char16_t&gt; &#64; 0x00007fff5fbf47f0, bindings=JS::HandleObject &#64; 0x00007fff5fbf4608, options=0x00007fff5fbf4a90, status=0x00007fff5fbf4a84, value=JS::MutableHandleValue &#64; 0x00007fff5fbf4600, dbg=0x000000015ef30800, envArg=JS::HandleObject &#64; 0x00007fff5fbf45f8, iter=0x0000000000000000) at Debugger.cpp:8260
    frame #26: 0x000000010ab351cb XUL`js::DebuggerObject::executeInGlobal(cx=0x000000011ec51000, object=js::HandleDebuggerObject &#64; 0x00007fff5fbf4940, chars=Range&lt;const char16_t&gt; &#64; 0x00007fff5fbf4960, bindings=JS::HandleObject &#64; 0x00007fff5fbf4938, options=0x00007fff5fbf4a90, status=0x00007fff5fbf4a84, value=JS::MutableHandleValue &#64; 0x00007fff5fbf4930) at Debugger.cpp:10892
    frame #27: 0x000000010ab35680 XUL`js::DebuggerObject::executeInGlobalWithBindingsMethod(cx=0x000000011ec51000, argc=3, vp=0x00007fff5fbf4f10) at Debugger.cpp:10011
    frame #28: 0x000000010aa77164 XUL`js::CallJSNative(cx=0x000000011ec51000, native=(XUL`js::DebuggerObject::executeInGlobalWithBindingsMethod(JSContext*, unsigned int, JS::Value*) at Debugger.cpp:9985), args=0x00007fff5fbf4ec0)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&amp;) at jscntxtinlines.h:293
    frame #29: 0x000000010a218287 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbf4ec0, construct=NO_CONSTRUCT) at Interpreter.cpp:470
    frame #30: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbf4ec0) at Interpreter.cpp:515
    frame #31: 0x000000010a2187f6 XUL`js::Call(cx=0x000000011ec51000, fval=JS::HandleValue &#64; 0x00007fff5fbf4e10, thisv=JS::HandleValue &#64; 0x00007fff5fbf4e08, args=0x00007fff5fbf4ec0, rval=JS::MutableHandleValue &#64; 0x00007fff5fbf4e00) at Interpreter.cpp:534
    frame #32: 0x000000010aa5b150 XUL`js::Wrapper::call(this=0x000000010ea60f40, cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbf4eb0, args=0x00007fff5fbf5188) const at Wrapper.cpp:169
    frame #33: 0x000000010aa404cf XUL`js::CrossCompartmentWrapper::call(this=0x000000010ea60f40, cx=0x000000011ec51000, wrapper=JS::HandleObject &#64; 0x00007fff5fbf5040, args=0x00007fff5fbf5188) const at CrossCompartmentWrapper.cpp:359
    frame #34: 0x000000010aa4f9b8 XUL`js::Proxy::call(cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbf50e0, args=0x00007fff5fbf5188) at Proxy.cpp:481
    frame #35: 0x000000010aa50c18 XUL`js::proxy_Call(cx=0x000000011ec51000, argc=3, vp=0x000000011f23a5b0) at Proxy.cpp:741
    frame #36: 0x000000010aa77164 XUL`js::CallJSNative(cx=0x000000011ec51000, native=(XUL`js::proxy_Call(JSContext*, unsigned int, JS::Value*) at Proxy.cpp:737), args=0x00007fff5fbf7560)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&amp;) at jscntxtinlines.h:293
    frame #37: 0x000000010a2180b8 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbf7560, construct=NO_CONSTRUCT) at Interpreter.cpp:452
    frame #38: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbf7560) at Interpreter.cpp:515
    frame #39: 0x000000010a21857d XUL`js::CallFromStack(cx=0x000000011ec51000, args=0x00007fff5fbf7560) at Interpreter.cpp:521
    frame #40: 0x000000010a20cd29 XUL`Interpret(cx=0x000000011ec51000, state=0x00007fff5fbf8688) at Interpreter.cpp:3060
    frame #41: 0x000000010a201b19 XUL`js::RunScript(cx=0x000000011ec51000, state=0x00007fff5fbf8688) at Interpreter.cpp:410
    frame #42: 0x000000010a218385 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbfa990, construct=NO_CONSTRUCT) at Interpreter.cpp:488
    frame #43: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbfa990) at Interpreter.cpp:515
    frame #44: 0x000000010a21857d XUL`js::CallFromStack(cx=0x000000011ec51000, args=0x00007fff5fbfa990) at Interpreter.cpp:521
    frame #45: 0x000000010a20cd29 XUL`Interpret(cx=0x000000011ec51000, state=0x00007fff5fbfbab8) at Interpreter.cpp:3060
    frame #46: 0x000000010a201b19 XUL`js::RunScript(cx=0x000000011ec51000, state=0x00007fff5fbfbab8) at Interpreter.cpp:410
    frame #47: 0x000000010a218385 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbfbce0, construct=NO_CONSTRUCT) at Interpreter.cpp:488
    frame #48: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbfbce0) at Interpreter.cpp:515
    frame #49: 0x000000010a2187f6 XUL`js::Call(cx=0x000000011ec51000, fval=JS::HandleValue &#64; 0x00007fff5fbfbc30, thisv=JS::HandleValue &#64; 0x00007fff5fbfbc28, args=0x00007fff5fbfbce0, rval=JS::MutableHandleValue &#64; 0x00007fff5fbfbc20) at Interpreter.cpp:534
    frame #50: 0x000000010aa5b150 XUL`js::Wrapper::call(this=0x000000010ea60f40, cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbfbcd0, args=0x00007fff5fbfbfa8) const at Wrapper.cpp:169
    frame #51: 0x000000010aa404cf XUL`js::CrossCompartmentWrapper::call(this=0x000000010ea60f40, cx=0x000000011ec51000, wrapper=JS::HandleObject &#64; 0x00007fff5fbfbe60, args=0x00007fff5fbfbfa8) const at CrossCompartmentWrapper.cpp:359
    frame #52: 0x000000010aa4f9b8 XUL`js::Proxy::call(cx=0x000000011ec51000, proxy=JS::HandleObject &#64; 0x00007fff5fbfbf00, args=0x00007fff5fbfbfa8) at Proxy.cpp:481
    frame #53: 0x000000010aa50c18 XUL`js::proxy_Call(cx=0x000000011ec51000, argc=1, vp=0x00007fff5fbfc2f0) at Proxy.cpp:741
    frame #54: 0x000000010aa77164 XUL`js::CallJSNative(cx=0x000000011ec51000, native=(XUL`js::proxy_Call(JSContext*, unsigned int, JS::Value*) at Proxy.cpp:737), args=0x00007fff5fbfc2a0)(JSContext*, unsigned int, JS::Value*), JS::CallArgs const&amp;) at jscntxtinlines.h:293
    frame #55: 0x000000010a2180b8 XUL`js::InternalCallOrConstruct(cx=0x000000011ec51000, args=0x00007fff5fbfc2a0, construct=NO_CONSTRUCT) at Interpreter.cpp:452
    frame #56: 0x000000010a21877d XUL`InternalCall(cx=0x000000011ec51000, args=0x00007fff5fbfc2a0) at Interpreter.cpp:515
    frame #57: 0x000000010a2187f6 XUL`js::Call(cx=0x000000011ec51000, fval=JS::HandleValue &#64; 0x00007fff5fbfc1f0, thisv=JS::HandleValue &#64; 0x00007fff5fbfc1e8, args=0x00007fff5fbfc2a0, rval=JS::MutableHandleValue &#64; 0x00007fff5fbfc1e0) at Interpreter.cpp:534
    frame #58: 0x000000010a7f41ac XUL`JS_CallFunctionValue(cx=0x000000011ec51000, obj=JS::HandleObject &#64; 0x00007fff5fbfc290, fval=JS::HandleValue &#64; 0x00007fff5fbfc288, args=0x00007fff5fbfc648, rval=JS::MutableHandleValue &#64; 0x00007fff5fbfc280) at jsapi.cpp:2889
    frame #59: 0x0000000103ff8fa7 XUL`nsFrameMessageManager::ReceiveMessage(this=0x000000012ed6bd80, aTarget=0x000000012f007590, aTargetFrameLoader=0x000000013400ba80, aTargetClosed=false, aMessage=0x000000012197ec28, aIsSync=false, aCloneData=0x000000012197ec38, aCpows=0x00007fff5fbfcd00, aPrincipal=0x0000000000000000, aRetVal=0x0000000000000000) at nsFrameMessageManager.cpp:1093
    frame #60: 0x0000000103ff7713 XUL`nsFrameMessageManager::ReceiveMessage(this=0x000000012ed6bd80, aTarget=0x000000012f007590, aTargetFrameLoader=0x000000013400ba80, aMessage=0x000000012197ec28, aIsSync=false, aCloneData=0x000000012197ec38, aCpows=0x00007fff5fbfcd00, aPrincipal=0x0000000000000000, aRetVal=0x0000000000000000) at nsFrameMessageManager.cpp:902
    frame #61: 0x0000000103ffe205 XUL`nsSameProcessAsyncMessageBase::ReceiveMessage(this=0x000000012197ec28, aTarget=0x000000012f007590, aTargetFrameLoader=0x000000013400ba80, aManager=0x000000012ed6bd80) at nsFrameMessageManager.cpp:2083
    frame #62: 0x0000000104316c0f XUL`nsAsyncMessageToChild::Run(this=0x000000012197ec00) at nsFrameLoader.cpp:3187
    frame #63: 0x0000000101eb24f3 XUL`nsThread::ProcessNextEvent(this=0x000000010069b400, aMayWait=false, aResult=0x00007fff5fbfd073) at nsThread.cpp:1437
    frame #64: 0x0000000101eae02c XUL`NS_ProcessPendingEvents(aThread=0x000000010069b400, aTimeout=10) at nsThreadUtils.cpp:431
    frame #65: 0x000000010699e21e XUL`nsBaseAppShell::NativeEventCallback(this=0x000000011ef29c50) at nsBaseAppShell.cpp:97
    frame #66: 0x0000000106a3b8a7 XUL`nsAppShell::ProcessGeckoEvents(aInfo=0x000000011ef29c50) at nsAppShell.mm:398
    frame #67: 0x00007fffd4d67321 CoreFoundation`__CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ + 17
    frame #68: 0x00007fffd4d4821d CoreFoundation`__CFRunLoopDoSources0 + 557
    frame #69: 0x00007fffd4d47716 CoreFoundation`__CFRunLoopRun + 934
    frame #70: 0x00007fffd4d47114 CoreFoundation`CFRunLoopRunSpecific + 420
    frame #71: 0x00007fffd42a8ebc HIToolbox`RunCurrentEventLoopInMode + 240
    frame #72: 0x00007fffd42a8cf1 HIToolbox`ReceiveNextEventCommon + 432
    frame #73: 0x00007fffd42a8b26 HIToolbox`_BlockUntilNextEventMatchingListInModeWithFilter + 71
    frame #74: 0x00007fffd2841a54 AppKit`_DPSNextEvent + 1120
    frame #75: 0x00007fffd2fbd7ee AppKit`-[NSApplication(NSEvent) _nextEventMatchingEventMask:untilDate:inMode:dequeue:] + 2796
    frame #76: 0x0000000106a3a3a4 XUL`::-[GeckoNSApplication nextEventMatchingMask:untilDate:inMode:dequeue:](self=0x00000001006ec3e0, _cmd=&quot;nextEventMatchingMask:untilDate:inMode:dequeue:&quot;, mask=18446744073709551615, expiration=4001-01-01 00:00:00 UTC, mode=&quot;kCFRunLoopDefaultMode&quot;, flag=YES) at nsAppShell.mm:130
    frame #77: 0x00007fffd28363db AppKit`-[NSApplication run] + 926
    frame #78: 0x0000000106a3c32c XUL`nsAppShell::Run(this=0x000000011ef29c50) at nsAppShell.mm:672
    frame #79: 0x0000000109bba9bb XUL`nsAppStartup::Run(this=0x000000012020bbf0) at nsAppStartup.cpp:287
    frame #80: 0x0000000109d12513 XUL`XREMain::XRE_mainRun(this=0x00007fff5fbff2d8) at nsAppRunner.cpp:4589
    frame #81: 0x0000000109d13ac9 XUL`XREMain::XRE_main(this=0x00007fff5fbff2d8, argc=5, argv=0x00007fff5fbff960, aConfig=0x00007fff5fbff4a8) at nsAppRunner.cpp:4772
    frame #82: 0x0000000109d1424c XUL`XRE_main(argc=5, argv=0x00007fff5fbff960, aConfig=0x00007fff5fbff4a8) at nsAppRunner.cpp:4867
    frame #83: 0x0000000109d27627 XUL`mozilla::BootstrapImpl::XRE_main(this=0x0000000100613138, argc=5, argv=0x00007fff5fbff960, aConfig=0x00007fff5fbff4a8) at Bootstrap.cpp:45
    frame #84: 0x0000000100001086 firefox`do_main(argc=5, argv=0x00007fff5fbff960, envp=0x00007fff5fbff990) at nsBrowserApp.cpp:237
    frame #85: 0x0000000100000b61 firefox`main(argc=5, argv=0x00007fff5fbff960, envp=0x00007fff5fbff990) at nsBrowserApp.cpp:310
    frame #86: 0x0000000100000a74 firefox`start + 52</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(jimb)</span></div></div></div><div class="change-set" id="c8"><div class="comment" data-id="12460227" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" ><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 08:24 PDT" data-time="1499700257">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-8" data-comment-id="12460227">It's not obvious to me that it's a problem if scratchpad stuff doesn't get XrayWrappers. Users aren't expecting XrayWrappers, they're expecting that their JS will run in the context of the page.</pre></div><div class="change-set" id="c9"><div class="comment" data-id="12460293" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 08:42 PDT" data-time="1499701366">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-9" data-comment-id="12460293">Ok, so here: <a rel="nofollow" href="http://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSID.cpp#465">http://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSID.cpp#465</a>

we're stripping off the xray and then call the js::GetObjectProto on the object directly, which seems like a bug, but with an extra IsProxy check we should be able to fix the problem. Does that sound like an acceptable fix?

What drives me crazy is that if I try the same example from a non-e10s window, and executing the script from browser context on some regular web content, I can still reproduce the issue (in the example then document has to be replaced with content.document ofc). With some debugging it seems like in that case we use permissive OpaqueXrayTraits which makes no sense to me since the script is running under system principal while the proxy object is from a web content scope. Unless  |obj instanceof Ci.nsIDOMWindow;| enters into the compartment of obj. I can't recall how instanceof work for DOM interfaces across scopes, but if that's how they work that would explain why the issue can be reproduced in this case as well.</pre></div><div class="change-set" id="c10"><div class="comment" data-id="12460310" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 08:48 PDT" data-time="1499701696">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-10" data-comment-id="12460310">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c8">comment #8</a>)
<span class="quote">&gt; It's not obvious to me that it's a problem if scratchpad stuff doesn't get
&gt; XrayWrappers. Users aren't expecting XrayWrappers, they're expecting that
&gt; their JS will run in the context of the page.</span >

For scratchpad that might not be a huge problem but we have the same behavior everywhere else I think. So probably it's worth fixing it.</pre></div><div class="change-set" id="c11"><div class="comment" data-id="12460634" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" ><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:30 PDT" data-time="1499707805">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-11" data-comment-id="12460634">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c9">comment #9</a>)
<span class="quote">&gt; Ok, so here:
&gt; <a rel="nofollow" href="http://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSID.cpp#465">http://searchfox.org/mozilla-central/source/js/xpconnect/src/XPCJSID.cpp#465</a>
&gt; 
&gt; we're stripping off the xray and then call the js::GetObjectProto on the
&gt; object directly, which seems like a bug, but with an extra IsProxy check we
&gt; should be able to fix the problem. Does that sound like an acceptable fix?</span >

No, I think the real problem here is that we're bypassing the Xray layer when walking the prototype chain, which is an issue for tricky setPrototypeOf shenanigans as well. I think the correct solution here is to do the prototype walking without unwrapping, and only unwrap in the 'is this a DOM object' part.

<span class="quote">&gt; 
&gt; What drives me crazy is that if I try the same example from a non-e10s
&gt; window, and executing the script from browser context on some regular web
&gt; content, I can still reproduce the issue (in the example then document has
&gt; to be replaced with content.document ofc). With some debugging it seems like
&gt; in that case we use permissive OpaqueXrayTraits which makes no sense to me
&gt; since the script is running under system principal while the proxy object is
&gt; from a web content scope.</span >

That is exactly the wrapper I would expect in this situation. Permissive because it's not a SecurityWrapper, but OpaqueXrayTraits because we don't have any useful JSXrays to Proxy objects.</pre></div><div class="change-set" id="c12"><div class="comment" data-id="12463242" data-no="12"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" ><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" ><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 05:19 PDT" data-time="1499775570">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885235"
         class="attachment patch obsolete"
         data-id="8885235" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="protochain">
      <meta itemprop="contentSize" content="2818">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885235">
          <a class="link" href="attachment.cgi?id=8885235&amp;action=diff">
        <span id="att-8885235-description" itemprop="description">Stop bypassing the Xray layer when walking the prototype chain. v1</span></a> (obsolete)
        — <a href="attachment.cgi?id=8885235&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8885235">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-12" data-comment-id="12463242">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c11">comment #11</a>)
<span class="quote">&gt; (In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c9">comment #9</a>)
&gt; No, I think the real problem here is that we're bypassing the Xray layer
&gt; when walking the prototype chain, which is an issue for tricky
&gt; setPrototypeOf shenanigans as well. I think the correct solution here is to
&gt; do the prototype walking without unwrapping, and only unwrap in the 'is this
&gt; a DOM object' part.</span >

Something like this? The patch is fixing the issue and passes the xpconnect tests. How concerned should we be about landing this patch? Should I land the patch under a separate bug with some vague explanation?

<span class="quote">&gt; 
&gt; &gt; 
&gt; &gt; What drives me crazy is that if I try the same example from a non-e10s
&gt; &gt; window, and executing the script from browser context on some regular web
&gt; &gt; content, I can still reproduce the issue (in the example then document has
&gt; &gt; to be replaced with content.document ofc). With some debugging it seems like
&gt; &gt; in that case we use permissive OpaqueXrayTraits which makes no sense to me
&gt; &gt; since the script is running under system principal while the proxy object is
&gt; &gt; from a web content scope.
&gt; 
&gt; That is exactly the wrapper I would expect in this situation. Permissive
&gt; because it's not a SecurityWrapper, but OpaqueXrayTraits because we don't
&gt; have any useful JSXrays to Proxy objects.</span >

I've got confused about the 'not SecurityWrapper' part. The code |obj instanceof Ci.nsIDOMWindow;| runs in a scope with system principal because of the browser context (so subject principal is system) and the obj is from a content scope (so object principal is content). How can we end up with a non-security wrapper then? What am I missing?</pre><div class="activity"><div class="change">Assignee: nobody &rarr; gkrizsanits</div><div class="change">
        <a href="/attachment.cgi?id=8885235&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v1"
           class=""
        >Attachment #8885235</a> -
        Flags: review?(bobbyholley)</div></div></div><div class="change-set" id="c13"><div class="comment" data-id="12464356" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" ><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 11:01 PDT" data-time="1499796102">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12464356">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c12">comment #12</a>)
<span class="quote">&gt; I've got confused about the 'not SecurityWrapper' part. The code |obj
&gt; instanceof Ci.nsIDOMWindow;| runs in a scope with system principal because
&gt; of the browser context (so subject principal is system) and the obj is from
&gt; a content scope (so object principal is content). How can we end up with a
&gt; non-security wrapper then? What am I missing?</span >

&quot;Security Wrapper&quot; in this context means &quot;Wrapper does not subsume wrappee&quot;, which means that CheckedUnwrap is forbidden, and that we need to prevent data exfiltration. In the case of chrome-&gt;content Xrays, we want to prevent the caller from getting confused, but don't need to worry about protecting sensitive information, since the caller can see it if it wants (via wrappedJSObject).</pre></div><div class="change-set" id="c14"><div class="comment" data-id="12465167" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" ><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" ><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 15:08 PDT" data-time="1499810894">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885478"
         class="attachment patch"
         data-id="8885478" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="Bug-1378207---Stop-bypassing-the-Xray-layer-when-w.patch">
      <meta itemprop="contentSize" content="2076">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885478">
          <a class="link" href="attachment.cgi?id=8885478&amp;action=diff">
        <span id="att-8885478-description" itemprop="description">Stop bypassing the Xray layer when walking the prototype chain. v2</span></a>
        — <a href="attachment.cgi?id=8885478&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8885478">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-14" data-comment-id="12465167">It occurred to me that this could be a bit simpler, and it seemed easier to
write a patch rather than trying to describe in review comments. If you could
still take care of testing/landing after review I'd appreciate it.

MozReview-Commit-ID: AR2Sta2gWRk</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885478&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v2"
           class=""
        >Attachment #8885478</a> -
        Flags: review?(gkrizsanits)</div></div></div><div class="change-set" id="a615465_313730"><div class="change" id="aa615465_313730">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a615465_313730"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_313730" id="a615465_313730"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a615465_313730"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a615465_313730">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a615465_313730">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 15:08 PDT" data-time="1499810895">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885235&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v1"
           class=""
        >Attachment #8885235</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8885235&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v1"
           class=""
        >Attachment #8885235</a> -
        Flags: <span class="activity-deleted">review?(bobbyholley)</span></div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12465882" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a615465_313730"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a615465_313730"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 23:45 PDT" data-time="1499841906">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12465882">Comment on <span class=""><a href="/attachment.cgi?id=8885478" name="attach_8885478" title="Stop bypassing the Xray layer when walking the prototype chain. v2">attachment 8885478</a> <a href="/attachment.cgi?id=8885478&amp;action=edit" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[details]</a> <a href="/attachment.cgi?id=8885478&amp;action=diff" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8885478'>[review]</a>
Stop bypassing the Xray layer when walking the prototype chain. v2

Review of <span class=""><a href="/attachment.cgi?id=8885478" name="attach_8885478" title="Stop bypassing the Xray layer when walking the prototype chain. v2">attachment 8885478</a> <a href="/attachment.cgi?id=8885478&amp;action=edit" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[details]</a> <a href="/attachment.cgi?id=8885478&amp;action=diff" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8885478'>[review]</a>:
-----------------------------------------------------------------

(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c13">comment #13</a>)
<span class="quote">&gt; &quot;Security Wrapper&quot; in this context means &quot;Wrapper does not subsume wrappee&quot;,</span >

Right, sorry, this was a long time ago :)

(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c14">comment #14</a>)
<span class="quote">&gt; It occurred to me that this could be a bit simpler, and it seemed easier to
&gt; write a patch rather than trying to describe in review comments. If you could
&gt; still take care of testing/landing after review I'd appreciate it.</span >

I appreciate it.

::: js/xpconnect/src/XPCJSID.cpp
&#64;&#64; +460,4 &#64;&#64;
<span class="quote">&gt;      RootedObject obj(cx, objArg), proto(cx);
&gt; +    while (true) {
&gt; +        // Try the object, or the wrappee if allowed.
&gt; +        JSObject* o = js::IsWrapper(obj) ? js::CheckedUnwrap(obj, false) : obj;</span >

I think obj is not guaranteed to be non-null here so IsWrapper(obj) can crash. I can replace the |while (true)| with |while (obj)| and test and land it for you, but I'm still not sure how careful we should be about landing it.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885478&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v2"
           class=""
        >Attachment #8885478</a> -
        Flags: review?(gkrizsanits) &rarr; review+</div></div></div><div class="change-set" id="c16"><div class="comment" data-id="12465913" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a615465_313730"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a615465_313730"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 00:06 PDT" data-time="1499843191">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12465913">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c15">comment #15</a>)

<span class="quote">&gt; ::: js/xpconnect/src/XPCJSID.cpp
&gt; &#64;&#64; +460,4 &#64;&#64;
&gt; &gt;      RootedObject obj(cx, objArg), proto(cx);
&gt; &gt; +    while (true) {
&gt; &gt; +        // Try the object, or the wrappee if allowed.
&gt; &gt; +        JSObject* o = js::IsWrapper(obj) ? js::CheckedUnwrap(obj, false) : obj;
&gt; 
&gt; I think obj is not guaranteed to be non-null here so IsWrapper(obj) can
&gt; crash. I can replace the |while (true)| with |while (obj)| and test and land
&gt; it for you, but I'm still not sure how careful we should be about landing it.</span >

Actually the callers guarantee that we don't call this function with null obj, so it's OK as it is.</pre></div><div class="change-set" id="c17"><div class="comment" data-id="12466385" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a615465_313730"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a615465_313730"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 03:04 PDT" data-time="1499853867">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12466385">Hi Daniel, I cannot see any way this bug can be exploited badly. The worst that can happen is that when system code is trying to call instanceof on an object from another scope, it can 1) trigger a function from that other scope 2) that function can lie about the result of instanceof. This all sounds like sec moderate to me but until the bug has an official sec category I don't want to push the patch to try or land it.</pre><div class="activity"><div class="change">Flags: needinfo?(dveditz)</div></div></div><div class="change-set" id="a773473_1689"><div class="change" id="aa773473_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a773473_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a773473_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a773473_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a773473_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-13 11:01 PDT" data-time="1499968903">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dveditz)</span></div><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a></div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12479708" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 09:36 PDT" data-time="1500309367">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12479708">Was backed out because of a failing dt test: <a rel="nofollow" href="https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&amp;revision=5d9a6384bf513139ca33f54825db4f035ebdbdab&amp;filter-resultStatus=testfailed&amp;filter-resultStatus=busted&amp;filter-resultStatus=exception&amp;filter-resultStatus=retry&amp;filter-resultStatus=runnable&amp;filter-resultStatus=success&amp;filter-resultStatus=pending&amp;filter-resultStatus=running&amp;filter-searchStr=windows+M(dt4">https://treeherder.mozilla.org/#/jobs?repo=mozilla-inbound&amp;revision=5d9a6384bf513139ca33f54825db4f035ebdbdab&amp;filter-resultStatus=testfailed&amp;filter-resultStatus=busted&amp;filter-resultStatus=exception&amp;filter-resultStatus=retry&amp;filter-resultStatus=runnable&amp;filter-resultStatus=success&amp;filter-resultStatus=pending&amp;filter-resultStatus=running&amp;filter-searchStr=windows+M(dt4</a>)</pre></div><div class="change-set" id="c19"><div class="comment" data-id="12518545" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-30 09:15 PDT" data-time="1501431309">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12518545">I think we missed the fact that the original code's unwrap does not stop at the window proxy, so for the cross compartment window object case the old and new method differs unintentionally (the old version returns null for the proto of the window the new version identifies the DOM object and returns true for instanceof Ci.nsIDOMWindow, so at first glance seems like a bug in the old version but I'm sure there is a reason why it had to work like this...)

The test is failing here: [1] since .document is a cross origin property access.

A few lines above during the instanceof check, for some reason we don't have a security wrapper around, so we manage to unwrap everything. Based on the exception thrown at [1] I don't know why is that the case, and why there is no security wrapper around, but maybe it's a special sandbox magic that I have not followed evolving for a while.</pre><div class="activity"><div class="change">Flags: needinfo?(bobbyholley)</div></div></div><div class="change-set" id="c20"><div class="comment" data-id="12522823" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 10:44 PDT" data-time="1501523093">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12522823">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c19">comment #19</a>)
<span class="quote">&gt; I think we missed the fact that the original code's unwrap does not stop at
&gt; the window proxy, so for the cross compartment window object case the old
&gt; and new method differs unintentionally</span >

I don't understand - we're also passing stopAtOuter=false to js::CheckedUnwrap in the new version.

 (the old version returns null for the
<span class="quote">&gt; proto of the window the new version identifies the DOM object and returns
&gt; true for instanceof Ci.nsIDOMWindow, so at first glance seems like a bug in
&gt; the old version but I'm sure there is a reason why it had to work like
&gt; this...)
&gt; 
&gt; The test is failing here: [1] since .document is a cross origin property
&gt; access.</span >

The footnote is missing.

<span class="quote">&gt; 
&gt; A few lines above during the instanceof check, for some reason we don't have
&gt; a security wrapper around, so we manage to unwrap everything. Based on the
&gt; exception thrown at [1] I don't know why is that the case, and why there is
&gt; no security wrapper around, but maybe it's a special sandbox magic that I
&gt; have not followed evolving for a while.</span ></pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bobbyholley)</span></div></div></div><div class="change-set" id="c21"><div class="comment" data-id="12522877" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 11:04 PDT" data-time="1501524270">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="12522877">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c20">comment #20</a>)
<span class="quote">&gt; I don't understand - we're also passing stopAtOuter=false to
&gt; js::CheckedUnwrap in the new version.
&gt; </span >
old:
1. unwrap (window proxy too)
2. continue
3. getProto on the unwrapped

new:
1. unwrap + check
2. getProto on the wrapped (window proxy is still on)

<span class="quote">&gt; The footnote is missing.</span >

[1]: <a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/09c065976fd4f18d4ad764d7cb4bbc684bf56714/devtools/server/actors/webextension.js#340">http://searchfox.org/mozilla-central/rev/09c065976fd4f18d4ad764d7cb4bbc684bf56714/devtools/server/actors/webextension.js#340</a></pre></div><div class="change-set" id="c22"><div class="comment" data-id="12522946" data-no="22"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-22" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 11:22 PDT" data-time="1501525352">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="12522946">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c21">comment #21</a>)
<span class="quote">&gt; (In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c20">comment #20</a>)
&gt; &gt; I don't understand - we're also passing stopAtOuter=false to
&gt; &gt; js::CheckedUnwrap in the new version.
&gt; &gt; 
&gt; old:
&gt; 1. unwrap (window proxy too)
&gt; 2. continue
&gt; 3. getProto on the unwrapped
&gt; 
&gt; new:
&gt; 1. unwrap + check
&gt; 2. getProto on the wrapped (window proxy is still on)</span >

Yeah the new behavior seems more correct to me.

(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c19">comment #19</a>)
<span class="quote">&gt; A few lines above during the instanceof check, for some reason we don't have
&gt; a security wrapper around, so we manage to unwrap everything.</span >

There wouldn't be a security wrapper here, because this is chrome code, right?

I'm still unclear as to what exactly is failing and why after reading <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c19">comment 19</a>. Needs more investigation, or at least explanation.</pre><div class="activity"><div class="change">Flags: needinfo?(gkrizsanits)</div></div></div><div class="change-set" id="c23"><div class="comment" data-id="12523056" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 11:46 PDT" data-time="1501526806">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-23" data-comment-id="12523056">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c22">comment #22</a>)
<span class="quote">&gt; (In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c21">comment #21</a>)
&gt; &gt; (In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c20">comment #20</a>)
&gt; &gt; &gt; I don't understand - we're also passing stopAtOuter=false to
&gt; &gt; &gt; js::CheckedUnwrap in the new version.
&gt; &gt; &gt; 
&gt; &gt; old:
&gt; &gt; 1. unwrap (window proxy too)
&gt; &gt; 2. continue
&gt; &gt; 3. getProto on the unwrapped
&gt; &gt; 
&gt; &gt; new:
&gt; &gt; 1. unwrap + check
&gt; &gt; 2. getProto on the wrapped (window proxy is still on)
&gt; 
&gt; Yeah the new behavior seems more correct to me.</span >

For me too but I really needed the confirmation...

<span class="quote">&gt; 
&gt; (In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c19">comment #19</a>)
&gt; &gt; A few lines above during the instanceof check, for some reason we don't have
&gt; &gt; a security wrapper around, so we manage to unwrap everything.
&gt; 
&gt; There wouldn't be a security wrapper here, because this is chrome code,
&gt; right?
&gt; 
&gt; I'm still unclear as to what exactly is failing and why after reading
&gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c19">comment 19</a>. Needs more investigation, or at least explanation.</span >

After global instanceof Ci.nsIDOMWindow returns true with the new patch
we end up calling global.document which throws (cross origin wrapper property access)

I _think_ since this is a web extension debugging test, we have a web extension sandbox with some window in the proto chain... but it's unclear to me too why we have there a security wrapper. I'm not sure if unwrapDebuggerObjectGlobal has any side effects... or it's the sandbox proxy related magic, or it's writeToGlobalPrototype related. I hoped you might know it off the top of your head, but then I will try to debug that part as well (I'm debugging it on windows so it's pretty slow, maybe I'll try to reproduce it on OSX).</pre></div><div class="change-set" id="c24"><div class="comment" data-id="12523136" data-no="24"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-24" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 12:12 PDT" data-time="1501528323">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="12523136">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c23">comment #23</a>)
<span class="quote">&gt; After global instanceof Ci.nsIDOMWindow returns true with the new patch
&gt; we end up calling global.document which throws (cross origin wrapper
&gt; property access)</span >

Yeah, I don't understand why we have a security wrapper here, since we're definitely chrome (we're using Ci after all).

It probably has something to do with the Debugger API. The code appears to be using unsafeDereference, which I _thought_ switched from debugger proxies to regular security wrappers. But I'm fuzzy on those details, so you may want to talk to jimb or someone similar.</pre></div><div class="change-set" id="c25"><div class="comment" data-id="12524910" data-no="25"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-01 01:59 PDT" data-time="1501577988">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="12524910">On a totally unrelated note, your patch does:
JSObject* o = js::IsWrapper(obj) ? js::CheckedUnwrap(obj, false) : obj;
<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">Bug 1371865</a> implies that we should root |o| as well.</pre></div><div class="change-set" id="c26"><div class="comment" data-id="12526260" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-01 10:34 PDT" data-time="1501608886">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-26" data-comment-id="12526260">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c25">comment #25</a>)
<span class="quote">&gt; On a totally unrelated note, your patch does:
&gt; JSObject* o = js::IsWrapper(obj) ? js::CheckedUnwrap(obj, false) : obj;
&gt; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">Bug 1371865</a> implies that we should root |o| as well.</span >

The code in that bug was calling arbitrary virtual methods on the XPCWN within |obj|. We're not doing that here, right?</pre></div><div class="change-set" id="c27"><div class="comment" data-id="12526456" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-01 11:31 PDT" data-time="1501612260">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-27" data-comment-id="12526456">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c26">comment #26</a>)
<span class="quote">&gt; The code in that bug was calling arbitrary virtual methods on the XPCWN
&gt; within |obj|. We're not doing that here, right?</span >

We don't. I'm just curious if there is a reason not to always root for any new code just to be future proof.</pre></div><div class="change-set" id="c28"><div class="comment" data-id="12526486" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-01 11:36 PDT" data-time="1501612610">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-28" data-comment-id="12526486">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c27">comment #27</a>)
<span class="quote">&gt; (In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c26">comment #26</a>)
&gt; &gt; The code in that bug was calling arbitrary virtual methods on the XPCWN
&gt; &gt; within |obj|. We're not doing that here, right?
&gt; 
&gt; We don't. I'm just curious if there is a reason not to always root for any
&gt; new code just to be future proof.</span >

Well, performance, and readability. And we have the static analysis to catch us. But doesn't so much matter, I'm fine with whatever.</pre></div><div class="change-set" id="c29"><div class="comment" data-id="12529647" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-02 09:22 PDT" data-time="1501690924">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="12529647">(In reply to Bobby Holley (:bholley) (busy with Stylo) from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c24">comment #24</a>)
<span class="quote">&gt; (In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c23">comment #23</a>)
&gt; &gt; After global instanceof Ci.nsIDOMWindow returns true with the new patch
&gt; &gt; we end up calling global.document which throws (cross origin wrapper
&gt; &gt; property access)
&gt; 
&gt; Yeah, I don't understand why we have a security wrapper here, since we're
&gt; definitely chrome (we're using Ci after all).
&gt; </span >

So it's a sandbox proxy corner case when the sandbox is content and its proto is system (or just cross origin) and from a system compartment you call sb.document on it. Like:

var sb = new Cu.Sandbox(&quot;<a rel="nofollow" href="http://blah.com">http://blah.com</a>&quot;, {sandboxPrototype: window});
sb.document;

When SandboxProxyHandler::getPropertyDescriptor calls wrappedObject(proxy), it will find an xray on a cross origin wrapper and forwards the JS_GetPropertyDescriptorById to it, which will ofc throw.

Long story short something, somewhere creates a sandbox that does not have permission to access its own proto (which is probably a bug), and since instanceof was buggy for window objects pre-patch this problem was undetected. Now I have to figure out where and what creates this sandbox and probably fix that code, but at least it looks like nothing scary is going on here.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gkrizsanits)</span></div></div></div><div class="change-set" id="c30"><div class="comment" data-id="12537964" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-04 12:06 PDT" data-time="1501873617">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8893935"
         class="attachment patch"
         data-id="8893935" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="xowassandboxproto">
      <meta itemprop="contentSize" content="1566">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8893935">
          <a class="link" href="attachment.cgi?id=8893935&amp;action=diff">
        <span id="att-8893935-description" itemprop="description">guard for XOW in the sandboxproto. v1</span></a>
        — <a href="attachment.cgi?id=8893935&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1378207&attachment=8893935">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-30" data-comment-id="12537964">I don't think we should change anything here, and I do believe too that the new behavior is the correct one. So I just ended up patching this code so that test stops failing. I guess I will talk to Luca about this, but it would be great if you confirmed that the comment makes sense and you agree with this decision first.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: review?(bobbyholley)</div></div></div><div class="change-set" id="c31"><div class="comment" data-id="12537968" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_313730" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/ac57223c49d41049a4917e187b854377?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_313730" id="a773473_1689"><a class="email " href="/user_profile?user_id=313730" > <span class="fna">Bobby Holley (:bholley)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-04 12:08 PDT" data-time="1501873691">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="12537968">Comment on <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>
guard for XOW in the sandboxproto. v1

Review of <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>:
-----------------------------------------------------------------

Sure makes sense to me. Get review from somebody who knows that code though.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: review?(bobbyholley) &rarr; review+</div></div></div><div class="change-set" id="c32"><div class="comment" data-id="12542868" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-07 03:17 PDT" data-time="1502101026">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="12542868">Comment on <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>
guard for XOW in the sandboxproto. v1

Review of <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>:
-----------------------------------------------------------------

Luca, I hope my comment is descriptive enough. I'm not sure what should be the proper solution here since I'm not familiar with this code. But I'm happy to help you with working out a better solution. For the time being there is only one test that is failing because of this code and blocking me from landing an important fix, so is it OK to land this quick fix as it is and do the rest as a follow up?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: review?(lgreco)</div></div></div><div class="change-set" id="c33"><div class="comment" data-id="12543283" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_339062" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/cb15f57474d95eb43c5d903ae3fa34ae?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_339062" id="a773473_1689"><a class="email " href="/user_profile?user_id=339062" > <span class="fna">Luca Greco [:rpl] [:luca] [:lgreco]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-07 06:41 PDT" data-time="1502113281">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="12543283">Comment on <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>
guard for XOW in the sandboxproto. v1

Review of <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>:
-----------------------------------------------------------------

As briefly discussed over IRC I'm ok with landing a quickfix for it first (and then in the meantime investigate where this sandbox is coming from), also if the global is being destroyed then it seems correct to me that we filter it from the ones that we can be considered &quot;debuggable&quot;.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: review?(lgreco) &rarr; review+</div></div></div><div class="change-set" id="c34"><div class="comment" data-id="12546109" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-08 04:46 PDT" data-time="1502192795">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="12546109"><a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/a76755db1f3c804e8a08c1f0365db417acc5cf77">https://hg.mozilla.org/integration/mozilla-inbound/rev/a76755db1f3c804e8a08c1f0365db417acc5cf77</a>
<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207">Bug 1378207</a> - Handle sandboxes with XOW protos in WebExtensionChildActor. r=rpl

<a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/3e06cba872427866b195b98c51bca5883f166011">https://hg.mozilla.org/integration/mozilla-inbound/rev/3e06cba872427866b195b98c51bca5883f166011</a>
<a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207">Bug 1378207</a> - Stop bypassing the Xray layer when walking the prototype chain. r=krizsa</pre></div><div class="change-set" id="c35"><div class="comment" data-id="12548430" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a773473_1689"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-08 15:17 PDT" data-time="1502230649">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="12548430"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/a76755db1f3c">https://hg.mozilla.org/mozilla-central/rev/a76755db1f3c</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/3e06cba87242">https://hg.mozilla.org/mozilla-central/rev/3e06cba87242</a></pre><div class="activity"><div class="change">Status: NEW &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2017-08-08 15:17 PDT" data-time="1502230649">4 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=isnotempty">status-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox57&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla57</div></div></div><div class="change-set" id="c36"><div class="comment" data-id="12556488" data-no="36"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-36" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a773473_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-36"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-36" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c36">Comment 36</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-10 19:34 PDT" data-time="1502418856">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-36">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-36" data-comment-id="12556488">Looks like this needs at least a Beta approval nomination. Is this something we should consider backporting to ESR52 as well?</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=isnotempty">tracking-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a></div><div class="change">Flags: needinfo?(gkrizsanits)</div></div></div><div class="change-set" id="c37"><div class="comment" data-id="12557058" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-11 01:08 PDT" data-time="1502438928">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-37" data-comment-id="12557058">Comment on <span class=""><a href="/attachment.cgi?id=8885478" name="attach_8885478" title="Stop bypassing the Xray layer when walking the prototype chain. v2">attachment 8885478</a> <a href="/attachment.cgi?id=8885478&amp;action=edit" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[details]</a> <a href="/attachment.cgi?id=8885478&amp;action=diff" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8885478'>[review]</a>
Stop bypassing the Xray layer when walking the prototype chain. v2

Approval Request Comment
[Feature/Bug causing the regression]: Not sure. It's been like this for a while.

[User impact if declined]: Xray is waived during instanceof, and instanceof for DOMWindow does not work in some special cases.

[Is this code covered by automated tests?]: Instanceof is well tested in general, but this exact scenario does not have a test. So it's unlikely that this patch breaks anything but it should be tested manually if the bug is fixed.

[Has the fix been verified in Nightly?]: Manually.

[Needs manual test from QE? If yes, steps to reproduce]: Bug description has an STR.
 
[List of other uplifts needed for the feature/fix]: Just these 2 patches.

[Is the change risky?]: I don't think so.

[Why is the change risky/not risky?]: The post patch version of the code is safer than to original in every imaginable cases, plus it's unlikely that such a generic function passes all the tests if incorrect. However as this bug exists, there can always be an untested edge case... Still, I'd sleep better with this patch than without.

[String changes made/needed]: None.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(gkrizsanits)</span></div><div class="change">
        <a href="/attachment.cgi?id=8885478&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v2"
           class=""
        >Attachment #8885478</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c38"><div class="comment" data-id="12557066" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-11 01:12 PDT" data-time="1502439168">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-38" data-comment-id="12557066">Comment on <span class=""><a href="/attachment.cgi?id=8893935" name="attach_8893935" title="guard for XOW in the sandboxproto. v1">attachment 8893935</a> <a href="/attachment.cgi?id=8893935&amp;action=edit" title="guard for XOW in the sandboxproto. v1">[details]</a> <a href="/attachment.cgi?id=8893935&amp;action=diff" title="guard for XOW in the sandboxproto. v1">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8893935'>[review]</a>
guard for XOW in the sandboxproto. v1

Approval Request Comment
[Feature/Bug causing the regression]: This code expected the broken behavior.

[User impact if declined]: A test will fail, and during add-on debugging we can hit a JS exception.

[Is this code covered by automated tests?]: Yes.

[Has the fix been verified in Nightly?]: The related test passes.

[Needs manual test from QE? If yes, steps to reproduce]: No.
 
[List of other uplifts needed for the feature/fix]: The other patch in this bug.

[Is the change risky?]: No.

[Why is the change risky/not risky?]: It's just handling an exception.

[String changes made/needed]: None.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c39"><div class="comment" data-id="12557073" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_420273" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/a3029c82e81d6ac69fc5f85dc2266312?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_420273" id="a773473_1689"><a class="email disabled" href="/user_profile?user_id=420273" > <span class="fna">Gabor Krizsanits (INACTIVE)</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-11 01:14 PDT" data-time="1502439290">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-39" data-comment-id="12557073">(In reply to Ryan VanderMeulen [:RyanVM] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c36">comment #36</a>)
<span class="quote">&gt; Looks like this needs at least a Beta approval nomination. Is this something
&gt; we should consider backporting to ESR52 as well?</span >

I'm not sure. I'd be surprised if this could be exploited... What's the requirement for backporting something to ESR?</pre></div><div class="change-set" id="c40"><div class="comment" data-id="12564817" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a773473_1689"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a773473_1689"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-14 09:05 PDT" data-time="1502726736">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-40" data-comment-id="12564817">Comment on <span class=""><a href="/attachment.cgi?id=8885478" name="attach_8885478" title="Stop bypassing the Xray layer when walking the prototype chain. v2">attachment 8885478</a> <a href="/attachment.cgi?id=8885478&amp;action=edit" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[details]</a> <a href="/attachment.cgi?id=8885478&amp;action=diff" title="Stop bypassing the Xray layer when walking the prototype chain. v2">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1378207&amp;attachment=8885478'>[review]</a>
Stop bypassing the Xray layer when walking the prototype chain. v2

Fix for sec-moderate issue, let's uplift this for beta 3.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885478&amp;action=edit"
           title="Stop bypassing the Xray layer when walking the prototype chain. v2"
           class=""
        >Attachment #8885478</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="a3531326_451704"><div class="change" id="aa3531326_451704">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a3531326_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_451704" id="a3531326_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3531326_451704"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3531326_451704">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a3531326_451704">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-14 09:05 PDT" data-time="1502726756">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8893935&amp;action=edit"
           title="guard for XOW in the sandboxproto. v1"
           class=""
        >Attachment #8893935</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c41"><div class="comment" data-id="12565097" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a3531326_451704"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a3531326_451704"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-14 10:24 PDT" data-time="1502731440">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-41" data-comment-id="12565097"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/ca6af5d81565">https://hg.mozilla.org/releases/mozilla-beta/rev/ca6af5d81565</a>
<a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/7ad9e8f27a03">https://hg.mozilla.org/releases/mozilla-beta/rev/7ad9e8f27a03</a>

Doesn't sound like this is worth considering for ESR52 backport given <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c39">comment 39</a>. Feel free to set it back to affected and nominate for approval if you feel otherwise, though.</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=%3F">?</a> &rarr; ---</div></div></div><div class="change-set" id="a3553688_1689"><div class="change" id="aa3553688_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a3553688_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a3553688_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3553688_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3553688_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a3553688_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-14 15:18 PDT" data-time="1502749118">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: dom-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="a3639227_538805"><div class="change" id="aa3639227_538805">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_538805" id="a3639227_538805"><img src="https://secure.gravatar.com/avatar/9bd092443d615af36b31b04e81ad7806?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_538805" id="a3639227_538805"><a class="email disabled" href="/user_profile?user_id=538805" > <span class="fna">Ritu Kothari (:ritu) (Inactive, please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3639227_538805"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3639227_538805">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a3639227_538805">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-15 15:04 PDT" data-time="1502834657">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=isnotempty">tracking-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=isnotempty">tracking-firefox57</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%3F">?</a> &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox57&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c42"><div class="comment" data-id="12570543" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a3639227_538805"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_488993" id="a3639227_538805"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-08-16 00:46 PDT" data-time="1502869587">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-42" data-comment-id="12570543">(In reply to Gabor Krizsanits [:krizsa :gabor] from <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - instanceof operator can bypass Xray and run unprivileged proxy trap"
   href="/show_bug.cgi?id=1378207#c38">comment #38</a>)
<span class="quote">&gt; [Is this code covered by automated tests?]: Yes.
&gt; 
&gt; [Has the fix been verified in Nightly?]: The related test passes.
&gt; 
&gt; [Needs manual test from QE? If yes, steps to reproduce]: No.</span >
 
Setting qe-verify- based on Gabor's assessment on manual testing needs and the fact that this fix has automated coverage.</pre><div class="activity"><div class="change">Flags: qe-verify-</div></div></div><div class="change-set" id="a6243181_280903"><div class="change" id="aa6243181_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a6243181_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a6243181_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a6243181_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a6243181_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a6243181_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-14 18:23 PDT" data-time="1505438611">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2017-7820</div><div class="change">Whiteboard: [adv-main56+]</div></div></div><div class="change-set" id="c43"><div class="comment" data-id="12704313" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a6243181_280903"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_1689" id="a6243181_280903"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-26 13:55 PDT" data-time="1506459354">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-43" data-comment-id="12704313">After re-reading the description I'm calling this sec-low</pre><div class="activity"><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-moderate&amp;resolution=---">sec-moderate</a> &rarr; <a href="/buglist.cgi?keywords=sec-low&amp;resolution=---">sec-low</a></div></div></div><div class="change-set" id="a16887886_542578"><div class="change" id="aa16887886_542578">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_542578" id="a16887886_542578"><img src="https://secure.gravatar.com/avatar/77e185f85aa29d3461a4e6cfee1da4e5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_542578" id="a16887886_542578"><a class="email " href="/user_profile?user_id=542578" > <span class="fna">magicp</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a16887886_542578"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a16887886_542578">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a16887886_542578">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-01-15 22:15 PST" data-time="1516083316">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - Toolbox starts blank when clicking debug button at the first time in about:debugging"
   href="/show_bug.cgi?id=1430711">1430711</a></div></div></div><div class="change-set" id="a18339301_1689"><div class="change" id="aa18339301_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a18339301_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a18339301_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a18339301_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a18339301_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1378207#a18339301_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-01 17:25 PST" data-time="1517534731">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1378207&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>