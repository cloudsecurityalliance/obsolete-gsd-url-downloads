<!DOCTYPE html>
<html lang="en">
  <head>
    <title>630822 &ndash; (CVE-2017-15945) dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via &quot;chown&quot;</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/1dee87cdc229fb032852e53a39a3c8b5.css?1635279638" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1635279638"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "630822 – (CVE-2017-15945) dev-db\/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via \"chown\"",
                             "show_bug.cgi?id=630822" );
        document.title = "630822 – (CVE-2017-15945) dev-db\/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via \"chown\"";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "630822 – (CVE-2017-15945) dev-db\/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via \"chown\"", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1635279638"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Gentoo's Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><script language="JavaScript" src="extensions/Gentoo/web/gentoo.js"></script>
  </head>

  <body 
        class="bugs-gentoo-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_Gentoo_Security
                 bz_component_Auditing
                 bz_bug_630822 yui-skin-sam">
<div id="gentoo-bar">
	<a href="/" title="Go to the Gentoo Bugzilla homepage" class="home-link">
		<img src="extensions/Gentoo/web/gentoo_org.png" alt="Gentoo Websites Logo" />
	</a>

	<div>
		Go to: 
		<a href="https://www.gentoo.org/">Gentoo Home</a>
		<a href="https://www.gentoo.org/support/documentation/">Documentation</a>
		<a href="https://forums.gentoo.org/">Forums</a>
		<a href="https://www.gentoo.org/get-involved/mailing-lists/">Lists</a>
		<a href="/" class="active">Bugs</a>
		<a href="https://planet.gentoo.org/">Planet</a>
		<a href="https://www.gentoo.org/inside-gentoo/stores/">Store</a>
		<a href="https://wiki.gentoo.org/">Wiki</a>
		<strong><a href="https://www.gentoo.org/downloads/">Get Gentoo!</a></strong>
	</div>
</div>

  <div id="header"><div id="banner">
  </div>

    <div id="titles">
      <span id="title">Gentoo's Bugzilla &ndash; Bug&nbsp;630822</span>

        <span id="subtitle" class="subheader">dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via &quot;chown&quot;</span>

        <span id="information" class="header_addl_info">Last modified: 2021-08-11 19:59:53 UTC node [gannet]</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=630822&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=630822" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=630822&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635619188-9PHIJfJINvzrqYW0LiBA0gZOwtSPf2809hlW5i91aFQ">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body"><!--<div style="border: 1px solid #ebccd1; background-color: #f2dede; color: #a94442; padding: 0.4em; margin-bottom: 0.4em;">critical goes here ...</div>-->
<!--<div id="message">
Bugzilla DB migration completed. Please report issues to Infra team via email via infra@gentoo.org or IRC
</div>-->


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2021-08-11 19:59:53">
  <input type="hidden" name="id" value="630822">
  <input type="hidden" name="token" value="1635619188-Pc6B6jUy5iGJli-UIiHUso3vurG_5MH9Rx-RZwD2xWQ">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=630822"><b>Bug&nbsp;630822</b></a> <span id="summary_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2017-15945</span>)
      - <span id="short_desc_nonedit_display">dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via &quot;chown&quot;</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span><span title="dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via &quot;chown&quot;">dev-db/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root priv...
        </span>
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'dev-db\/{mysql-cluster,mariadb,mysql,percona-server,mariadb-galera}: root privilege escalation via \"chown\"' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>CVE-2017-15945
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Gentoo Security

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Gentoo Security"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Auditing

  (<a href="buglist.cgi?component=Auditing&amp;product=Gentoo%20Security&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">All
        Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       normal<span id="votes_container">
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=630822#vote_630822">vote</a>)
  </span>
      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Gentoo Security Audit Team</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security-audit\x40gentoo.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
<a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-db/percona-server-5.6.37.82.2-r1: root privilege escalation via &quot;chown&quot;"
   href="show_bug.cgi?id=635702">635702</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-db/mariadb-{10.0.30-r1,10.0.32-r1,10.1.24-r1,10.1.26-r1,10.2.9}: root privilege escalation via &quot;chown&quot;"
   href="show_bug.cgi?id=635704">635704</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-db/mysql-{5.6.36-r1,5.6.37-r1,5.6.38}: root privilege escalation via &quot;chown&quot;"
   href="show_bug.cgi?id=635706">635706</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-db/mysql-cluster-{7.2.22-r1,7.3.11-r1}: root privilege escalation via &quot;chown&quot;"
   href="show_bug.cgi?id=635708">635708</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - &lt;dev-db/mariadb-galera-10.0.32: root privilege escalation via &quot;chown&quot;"
   href="show_bug.cgi?id=635710">635710</a> 
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>

    <tr>
      <th>&nbsp;</th>

      <td id="show_dependency_tree_or_graph">
        Show dependency <a href="showdependencytree.cgi?id=630822&amp;hide_resolved=1">tree</a>

      </td>
    </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2017-09-12 16:57 UTC by <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2021-08-11 19:59 UTC
      (<a href="show_activity.cgi?id=630822">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>5 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="grknight">grknight</option>
                <option value="jmbsvicetto">jmbsvicetto</option>
                <option value="mgorny">mgorny</option>
                <option value="robbat2">robbat2</option>
                <option value="whissi">whissi</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 
<tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_stabilisation_atoms">


  <a 
      title="Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_stabilisation_atoms"
  >Package list:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_stabilisation_atoms" >
      <div class="uneditable_textarea"></div>

</td>
    </tr>
    <tr>
      <th class="field_label  bz_hidden_field"
    id="field_label_cf_runtime_testing_required">


  <a 
      title="Indicate if runtime testing is required for this stabilisation request, or if it is sufficient to stabilised with a build/tests/qa test."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_runtime_testing_required"
  >Runtime testing required:</a>

</th>
  <td class="field_value  bz_hidden_field"
      id="field_container_cf_runtime_testing_required" >---

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="2" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_x-diff">
        <td>
            <a href="attachment.cgi?id=494538"
               title="View the content of the attachment">
          <b>bug-630822.patch</b></a>

          <span class="bz_attach_extra_info">
              (bug-630822.patch,1.46 KB,
                text/x-diff)

            <br>
            <a href="#attach_494538"
               title="Go to the comment associated with the attachment">2017-09-14 17:35 UTC</a>,

            <span class="vcard"><span class="fn">Brian Evans</span>
</span>
          </span>
        </td>


        <td>
          <a href="attachment.cgi?id=494538&amp;action=edit">Details</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="2">
        <span class="bz_attach_view_hide">
            <a id="view_all" href="attachment.cgi?bugid=630822&amp;action=viewall">View All</a>
        </span>
        <a href="attachment.cgi?bugid=630822&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=630822&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1635279621" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 16:57:22 UTC
        </span>

      </div>




<pre class="bz_comment_text">The latest two ebuilds for mariadb (10.2.7-r2 and 10.2.8) call &quot;chown&quot; on the live root filesystem in pkg_postinst, in more than one place. For example,

  pkg_postinst() {
      # Make sure the vars are correctly initialized
      mysql_init_vars

      # Check FEATURES=&quot;collision-protect&quot; before removing this
      [[ -d &quot;${ROOT}${MY_LOGDIR}&quot; ]] || \
          install -d -m0750 -o mysql -g mysql &quot;${ROOT}${MY_LOGDIR}&quot;

      # Secure the logfiles
      touch &quot;${ROOT}${MY_LOGDIR}&quot;/mysql.{log,err}
      chown mysql:mysql &quot;${ROOT}${MY_LOGDIR}&quot;/mysql*
      ...

This is exploitable by the &quot;mysql&quot; user to gain root. The non-recursive calls to &quot;chown&quot; are vulnerable to having their targets replaced by symlinks, and the recursive calls are vulnerable to the same trick with hard links. For example,

  1. emerge mariadb-10.2.8
  2. sudo su -s /bin/sh -c 'ln -sf /etc/passwd /var/log/mysql/mysql.log' mysql
  3. emerge mariadb-10.2.8
  4. The &quot;mysql&quot; user now owns /etc/passwd.

I haven't verified the exploit with &quot;chown -R&quot; because I don't want to spend another half hour on the build, but anywhere you call &quot;chown -R&quot; on the same directory more than once is going to be exploitable.</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 17:48:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">This is more than mariadb.  This code has existed for years and years in mysql.eclass (Overlay only now), mysql-v2.eclass, mysql-multilib*.eclass and now finally in the dev-db/mariadb ebuilds.

All versions of dev-db/{mysql,mariadb,percona-server,mysql-cluster,mariadb-galera} are included.  As well as past versions of dev-db/mysql-community.

I'm testing a patch for existence of non files so they can be removed at the log locations.

Any further suggestions are welcome.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 17:55:00 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c1">comment #1</a>)
<span class="quote">&gt; 
&gt; Any further suggestions are welcome.</span >

If the code has been around for that long, consider the possibility that your predecessors were wacko =)

The only person who can change ownership of a file is root, so if any of the log files have the wrong ownership, it's because root went in there and did it. So long as /var/log/mysql is writable by the &quot;mysql&quot; user, the logs will get created as mysql:mysql and everything will be fine.

Symlinks are easy to detect, but hard links are a lot, uh, harder -- and they have the same problem.</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 18:21:16 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c2">comment #2</a>)
<span class="quote">&gt; (In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c1">comment #1</a>)
&gt; &gt; 
&gt; &gt; Any further suggestions are welcome.
&gt; 
&gt; If the code has been around for that long, consider the possibility that
&gt; your predecessors were wacko =)
&gt; 
&gt; The only person who can change ownership of a file is root, so if any of the
&gt; log files have the wrong ownership, it's because root went in there and did
&gt; it. So long as /var/log/mysql is writable by the &quot;mysql&quot; user, the logs will
&gt; get created as mysql:mysql and everything will be fine.
&gt; 
&gt; Symlinks are easy to detect, but hard links are a lot, uh, harder -- and
&gt; they have the same problem.</span >

OK.  I have removed the &quot;# Secure the logfiles&quot; block an just kept the install above it.  This does not affect the server since it creates mysqld.err and other files without our help.

Let me know when this is OK to push.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 19:43:25 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c3">comment #3</a>)
<span class="quote">&gt; 
&gt; OK.  I have removed the &quot;# Secure the logfiles&quot; block an just kept the
&gt; install above it.  This does not affect the server since it creates
&gt; mysqld.err and other files without our help.
&gt; </span >

I suspect this one is vulnerable too (the others should be OK because they operate on $D and not $ROOT):

  chown -R mysql:mysql &quot;${ROOT}/${MY_DATADIR}&quot; 2&gt;/dev/null

I think the same reasoning applies -- everything in there should have the correct ownership already -- but I'm no expert.

If you feel like waiting for me to re-emerge mariadb one more time, I'll see if I can exploit that line above.</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 20:01:49 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c4">comment #4</a>)
<span class="quote">&gt; (In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c3">comment #3</a>)
&gt; &gt; 
&gt; &gt; OK.  I have removed the &quot;# Secure the logfiles&quot; block an just kept the
&gt; &gt; install above it.  This does not affect the server since it creates
&gt; &gt; mysqld.err and other files without our help.
&gt; &gt; 
&gt; 
&gt; I suspect this one is vulnerable too (the others should be OK because they
&gt; operate on $D and not $ROOT):
&gt; 
&gt;   chown -R mysql:mysql &quot;${ROOT}/${MY_DATADIR}&quot; 2&gt;/dev/null
&gt; 
&gt; I think the same reasoning applies -- everything in there should have the
&gt; correct ownership already -- but I'm no expert.
&gt; 
&gt; If you feel like waiting for me to re-emerge mariadb one more time, I'll see
&gt; if I can exploit that line above.</span >

While possible, this is unlikely as an attacker would have to expect that an admin is going to install a database and run 'emerge --config' and therefore create the directory in ${MY_DATADIR} which defaults to /var/lib/mysql but can be overridden in the environment by the admin at build time.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 20:24:47 UTC
        </span>

      </div>




<pre class="bz_comment_text">Hmm.. or otherwise remove the database directory entirely, which an admin will certainly notice, place an exploit and expect 'emerge --config' again.  A good admin should spot such trouble and prepare a new directory, but I understand this is not always the case.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 21:15:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">Well, pkg_config won't run if /var/lib/mysql already exists, so that eliminates the easy exploit where I just stick a hard link in there whenever I feel like it and later run emerge --config.

There's still a race condition I think, but that's much less serious:

  1. local cmd=( &quot;${EROOT}usr/share/mariadb/scripts/mysql_install_db&quot; )
  2. [[ -f &quot;${cmd}&quot; ]] || cmd=( &quot;${EROOT}usr/bin/mysql_install_db&quot; )
  ...
  5. &quot;${cmd[&#64;]}&quot; &gt;&quot;${TMPDIR}&quot;/mysql_install_db.log 2&gt;&amp;1
  ...
  12. chown -R mysql:mysql &quot;${ROOT}/${MY_DATADIR}&quot; 2&gt;/dev/null

I've probably miscounted those, but between lines 5 and 12, the &quot;mysql&quot; user can stick a hard link in MY_DATADIR. He could maybe clue himself into that by watching $TMPDIR for the creation of a file named mysql_install_db.log, but this is all pretty far-fetched.

Is the &quot;chown -R&quot; doing anything at all? If under normal circumstances, everything in that directory has the correct owner anyway, then I would say it's worthwhile to remove it just in case.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-12 21:23:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">Aw shit... so, the race condition is actually stupid easy to take advantage of. Run this in a shell as the &quot;mysql&quot; user:

  while true ; do
    ln /etc/passwd /var/lib/mysql/x
  done

As soon as you run emerge --config, even with a brand new MY_DATADIR, the &quot;mysql&quot; user will take ownership of /etc/passwd.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-13 13:52:43 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c7">comment #7</a>)
<span class="quote">&gt; Well, pkg_config won't run if /var/lib/mysql already exists, so that
&gt; eliminates the easy exploit where I just stick a hard link in there whenever
&gt; I feel like it and later run emerge --config.
&gt; 
&gt; There's still a race condition I think, but that's much less serious:
&gt; 
&gt;   1. local cmd=( &quot;${EROOT}usr/share/mariadb/scripts/mysql_install_db&quot; )
&gt;   2. [[ -f &quot;${cmd}&quot; ]] || cmd=( &quot;${EROOT}usr/bin/mysql_install_db&quot; )
&gt;   ...
&gt;   5. &quot;${cmd[&#64;]}&quot; &gt;&quot;${TMPDIR}&quot;/mysql_install_db.log 2&gt;&amp;1
&gt;   ...
&gt;   12. chown -R mysql:mysql &quot;${ROOT}/${MY_DATADIR}&quot; 2&gt;/dev/null
&gt; 
&gt; I've probably miscounted those, but between lines 5 and 12, the &quot;mysql&quot; user
&gt; can stick a hard link in MY_DATADIR. He could maybe clue himself into that
&gt; by watching $TMPDIR for the creation of a file named mysql_install_db.log,
&gt; but this is all pretty far-fetched.
&gt; 
&gt; Is the &quot;chown -R&quot; doing anything at all? If under normal circumstances,
&gt; everything in that directory has the correct owner anyway, then I would say
&gt; it's worthwhile to remove it just in case.</span >

The mysql_install_db script is run as root and the data files created get a group of root so is this line acceptable to replace line 12 above?

chgrp mysql &quot;${ROOT}/${MY_DATADIR}&quot;/{mysql,test} 2&gt;/dev/null</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-13 14:07:22 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c9">comment #9</a>)
<span class="quote">&gt; 
&gt; The mysql_install_db script is run as root and the data files created get a
&gt; group of root so is this line acceptable to replace line 12 above?
&gt; 
&gt; chgrp mysql &quot;${ROOT}/${MY_DATADIR}&quot;/{mysql,test} 2&gt;/dev/null</span >

What's the owner/group on $MY_DATADIR at that point? The chgrp will also affect the target of sym/hard links, so it's important that the mysql user not be able to stick a link in place of those two arguments via the same race condition. If MY_DATADIR is root:root, it should be safe.

Another thing that might work is to &quot;su mysql ...&quot; instead of passing --user to mysql_install_db.</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-13 14:15:27 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c10">comment #10</a>)
<span class="quote">&gt; (In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c9">comment #9</a>)
&gt; &gt; 
&gt; &gt; The mysql_install_db script is run as root and the data files created get a
&gt; &gt; group of root so is this line acceptable to replace line 12 above?
&gt; &gt; 
&gt; &gt; chgrp mysql &quot;${ROOT}/${MY_DATADIR}&quot;/{mysql,test} 2&gt;/dev/null
&gt; 
&gt; What's the owner/group on $MY_DATADIR at that point? The chgrp will also
&gt; affect the target of sym/hard links, so it's important that the mysql user
&gt; not be able to stick a link in place of those two arguments via the same
&gt; race condition. If MY_DATADIR is root:root, it should be safe.
&gt; 
&gt; Another thing that might work is to &quot;su mysql ...&quot; instead of passing --user
&gt; to mysql_install_db.</span >

The end result of pkg_config() without the chown -R is that the mysql and test directories have a mysql:root with 0700 permissions.  I simply wanted to keep those directories as they should be.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-13 14:50:47 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c10">comment #10</a>)
<span class="quote">&gt; Another thing that might work is to &quot;su mysql ...&quot; instead of passing --user
&gt; to mysql_install_db.</span >

&quot;su mysql ...&quot; is not an option as the user does not have a shell and the command fails.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-13 15:56:54 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Brian Evans from <a href="show_bug.cgi?id=630822#c12">comment #12</a>)
<span class="quote">&gt; 
&gt; &quot;su mysql ...&quot; is not an option as the user does not have a shell and the
&gt; command fails.</span >

You should be able to override that with --shell.</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Evans</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-14 17:35:47 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=494538" name="attach_494538" title="bug-630822.patch">attachment 494538</a> [<a href="attachment.cgi?id=494538&amp;action=edit" title="bug-630822.patch">details</a>]</span>
bug-630822.patch

Proposed patch for 10.2.8 and similar in eclasses.  I was not able to use su effectively and break out the array.  This still does the same job and only does chgrp on special directories.</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-09-29 21:43:18 UTC
        </span>

      </div>




<pre class="bz_comment_text">Brian fixed this last night:

<a href="https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5a4dfd9b7b9e8e8d23315dfd3afb4bbfc56b9de8">https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=5a4dfd9b7b9e8e8d23315dfd3afb4bbfc56b9de8</a>

<a href="https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=40984ffe654ae90069740e76c6406ec5f8d3ed9f">https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=40984ffe654ae90069740e76c6406ec5f8d3ed9f</a>

<a href="https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=b19f6190519f94450e4aa23cde091b8fd24d763d">https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=b19f6190519f94450e4aa23cde091b8fd24d763d</a>

Can we make this public so that I can reference it in the CVE request?</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-10-24 21:15:35 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c15">comment #15</a>)
<span class="quote">&gt; 
&gt; Can we make this public so that I can reference it in the CVE request?</span >

Ping =)</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Thomas Deutschmann</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2017-10-25 23:03:54 UTC
        </span>

      </div>




<pre class="bz_comment_text">Thank you Michael for the report and thank you Brian for the fix.

Like said in <a href="show_bug.cgi?id=630822#c15">comment #15</a>, everything is done. No bumps or user action required. Vulnerability only existed while emerging one of the affected ebuilds/ebuilds using affected eclasses.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-10-25 23:54:40 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Thomas Deutschmann from <a href="show_bug.cgi?id=630822#c17">comment #17</a>)
<span class="quote">&gt; Thank you Michael for the report and thank you Brian for the fix.
&gt; 
&gt; Like said in <a href="show_bug.cgi?id=630822#c15">comment #15</a>, everything is done. No bumps or user action
&gt; required. Vulnerability only existed while emerging one of the affected
&gt; ebuilds/ebuilds using affected eclasses.</span >

That's not *entirely* true.. the pkg_config phase had a similar problem, so if you installed a vulnerable version last month and waited until today to set it up, then you might want to upgrade first.

That scenario is a bit outlandish, though, because someone needs to gain access to the &quot;mysql&quot; user in order to do anything. If the database was never configured, that's next to impossible. The only plausible scenario is a pre-existing, exploited mysql installation that has had its databases wiped (and now needs them re-created). I won't be offended if you decide not to spend your time warning people about that.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Thomas Deutschmann</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2017-10-26 00:06:56 UTC
        </span>

      </div>




<pre class="bz_comment_text">Re-opened to evaluate which packages need a rev bump.

Thanks, Michael.</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-10-26 00:47:12 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Thomas Deutschmann from <a href="show_bug.cgi?id=630822#c19">comment #19</a>)
<span class="quote">&gt; Re-opened to evaluate which packages need a rev bump.
&gt; 
&gt; Thanks, Michael.</span >

What will portage do if you try to `emerge --config` a version that no longer exists? If it uses a newer version's pkg_config, or if it forces you to upgrade first -- then there's actually no need for a new revision: users need only sync their trees to remove the vulnerable code.</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Thomas Deutschmann</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2017-10-27 12:42:51 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c20">comment #20</a>)
<span class="quote">&gt; What will portage do if you try to `emerge --config` a version that no
&gt; longer exists? If it uses a newer version's pkg_config, or if it forces you
&gt; to upgrade first -- then there's actually no need for a new revision: users
&gt; need only sync their trees to remove the vulnerable code.</span >

When you emerge an ebuild, everything, including used eclasses, will be cached in the package db. This allows the user to run &quot;emerge --config&quot; at anytime to get the expected results even if we have removed the code from the eclass in the meantime.

However, if there was a problem in the ebuild/eclass, the user has to re-emerge the ebuild to get the fix.

That's the problem in this case.

dev-db/mariadb:

 - Affected by pkg_postinst:

   Fixed in &gt;=mariadb-10.2.9.
   Affected mariadb-10.2.x ebuilds are removed.

   =&gt; pkg_postinst vulnerability is fixed!

 - Affected by eclass:

   Fixed eclasses available since 2017-09-28 22:30:51 -0400.
   However, users with

     - mariadb-10.0.30
     - mariadb-10.0.32
     - mariadb-10.1.24
     - mariadb-10.1.26

   installed are probably affected if they have emerged the package before the
   date mentioned above.


dev-db/mysql:

 - Affected by pkg_postinst: -

 - Affected by eclass:

   Fixed eclasses available since 2017-09-28 22:30:51 -0400.
   However, users with

     - mysql-5.6.36
     - mysql-5.6.37

   installed are probably affected if they have emerged the package before the
   date mentioned above.


dev-db/percona-server:

 - Affected by pkg_postinst: -

 - Affected by eclass:

   Fixed eclasses available since 2017-09-28 22:30:51 -0400.
   However, users with

     - percona-server-5.6.37.82.2

   installed are probably affected if they have emerged the package before the
   date mentioned above.


dev-db/mysql-cluster:

 - Affected by pkg_postinst: -

 - Affected by eclass:

   Fixed eclasses available since 2017-09-28 22:30:51 -0400.
   However, users with

     - mysql-cluster-7.2.22
     - mysql-cluster-7.3.11

   installed are probably affected if they have emerged the package before the
   date mentioned above.


dev-db/mariadb-galera:

 - Affected by pkg_postinst: -

 - Affected by eclass: - (only available ebuild in repository was bumped after eclasses were fixed)</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-10-27 21:14:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Thomas Deutschmann from <a href="show_bug.cgi?id=630822#c21">comment #21</a>)
<span class="quote">&gt; 
&gt; When you emerge an ebuild, everything, including used eclasses, will be
&gt; cached in the package db. This allows the user to run &quot;emerge --config&quot; at
&gt; anytime to get the expected results even if we have removed the code from
&gt; the eclass in the meantime.
&gt; 
&gt; However, if there was a problem in the ebuild/eclass, the user has to
&gt; re-emerge the ebuild to get the fix.</span >

Thanks, that's important to know. I see now that portage is saving the ebuilds, but are the eclasses kept somewhere too? The PMS doesn't say what goes on in the VDB, so regardless, I think we should tell everyone to update or reinstall, just to keep things simple.

I requested a CVE for this (CVE-2017-15945), and my suggested fix is the following:

  1. Update your ::gentoo tree.

  2. Upgrade the affected packages to the latest version that your package
     manager suggests.

  3. If an affected package was not upgraded in the previous step (for
     example, if no new version was available), then reinstall that package
     manually.

That should cover everyone, I think?</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Thomas Deutschmann</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2017-10-27 22:31:16 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Michael Orlitzky from <a href="show_bug.cgi?id=630822#c22">comment #22</a>)
<span class="quote">&gt; I see now that portage is saving the ebuilds, but are the eclasses
&gt; kept somewhere too?</span >

The used eclasses are cached in &quot;environment.bz2&quot;.


<span class="quote">&gt;   3. If an affected package was not upgraded in the previous step (for
&gt;      example, if no new version was available), then reinstall that package
&gt;      manually.</span >
I will file vulnerability bugs for each affected package to track the bumping. Everything else is not an option. Think about binary package users.</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-10-27 23:21:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Thomas Deutschmann from <a href="show_bug.cgi?id=630822#c23">comment #23</a>)
<span class="quote">&gt; 
&gt; The used eclasses are cached in &quot;environment.bz2&quot;.</span >

Aha!


<span class="quote">&gt; I will file vulnerability bugs for each affected package to track the
&gt; bumping. Everything else is not an option. Think about binary package users.</span >

In hindsight, that is the simplest thing to do, and it makes the advice for end users easier to understand. I can update the CVE page afterwards. Thanks again.</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Orlitzky</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2017-11-06 16:41:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">I updated the CVE with the full list of affected packages, and the new mitigation instructions (&quot;just upgrade&quot;).</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">D'juan McDonald (domhnall)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2019-07-17 02:32:58 UTC
        </span>

      </div>




<pre class="bz_comment_text">All good here? <a href="https://security.gentoo.org/glsa/201711-04">https://security.gentoo.org/glsa/201711-04</a></pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=630822">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=630822">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=630822">Clone This Bug</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=630822&product=Gentoo%20Security">Clone In The Same 
                        Product</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=630822&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=630822" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=630822&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635619188-9PHIJfJINvzrqYW0LiBA0gZOwtSPf2809hlW5i91aFQ">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>