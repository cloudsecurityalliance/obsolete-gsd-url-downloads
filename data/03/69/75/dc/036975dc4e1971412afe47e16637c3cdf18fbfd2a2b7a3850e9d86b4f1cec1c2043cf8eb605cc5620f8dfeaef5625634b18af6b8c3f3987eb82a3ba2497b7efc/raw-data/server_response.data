<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8" />
<title>CVE-2012-4684 - Bitcoin Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"CVE-2012-4684","wgTitle":"CVE-2012-4684","wgCurRevisionId":54967,"wgRevisionId":54967,"wgArticleId":3894,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":false,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"CVE-2012-4684","wgRelevantArticleId":3894,"wgRequestId":"baf8eb15d1a70ec379c34a43","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[],"wgWikiEditorEnabledModules":{"toolbar":true,"preview":true,"publish":false}});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","skins.vector.styles":"ready"});mw.loader.implement("user.options@0bhc5ha",function($,jQuery,require,module){mw.user.options.set([]);});mw.loader.implement("user.tokens@0ft0puh",function ( $, jQuery, require, module ) {
mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});/*@nomin*/

});mw.loader.load(["site","mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest","skins.vector.js"]);});</script>
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.interface%7Cskins.vector.styles&amp;only=styles&amp;skin=vector" />
<script async="" src="/w/load.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content="" />
<link rel="stylesheet" href="/w/load.php?debug=false&amp;lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector" />
<meta name="generator" content="MediaWiki 1.30.0" />
<link rel="shortcut icon" href="/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="/w/opensearch_desc.php" title="Bitcoin Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="https://en.bitcoin.it/w/api.php?action=rsd" />
<link rel="license" href="http://creativecommons.org/licenses/by/3.0/" />
<link rel="alternate" type="application/atom+xml" title="Bitcoin Wiki Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom" />
<!--[if lt IE 9]><script src="/resources/lib/html5shiv/html5shiv.min.js"></script><![endif]-->
</head>
<body class="mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-CVE-2012-4684 rootpage-CVE-2012-4684 skin-vector action-view"> <div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
<a id="top"></a>
<div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="en">CVE-2012-4684</h1>
<div id="bodyContent" class="mw-body-content">
<div id="siteSub" class="noprint">From Bitcoin Wiki</div>
<div id="contentSub"></div>
<div id="jump-to-nav" class="mw-jump">
Jump to: <a href="#mw-head">navigation</a>, <a href="#p-search">search</a>
</div>
 <div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Network-wide_DoS_using_malleable_signatures_in_alerts"><span class="tocnumber">1</span> <span class="toctext">Network-wide DoS using malleable signatures in alerts</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#Systems_Affected"><span class="tocnumber">2</span> <span class="toctext">Systems Affected</span></a></li>
<li class="toclevel-1 tocsection-3"><a href="#Affected_Versions"><span class="tocnumber">3</span> <span class="toctext">Affected Versions</span></a></li>
<li class="toclevel-1 tocsection-4"><a href="#Fixed_in_version"><span class="tocnumber">4</span> <span class="toctext">Fixed in version</span></a></li>
<li class="toclevel-1 tocsection-5"><a href="#Overview"><span class="tocnumber">5</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-1 tocsection-6"><a href="#Details"><span class="tocnumber">6</span> <span class="toctext">Details</span></a></li>
<li class="toclevel-1 tocsection-7"><a href="#Attack_Scenario"><span class="tocnumber">7</span> <span class="toctext">Attack Scenario</span></a></li>
<li class="toclevel-1 tocsection-8"><a href="#Suggested_Solutions_for_the_0.7.0_release"><span class="tocnumber">8</span> <span class="toctext">Suggested Solutions for the 0.7.0 release</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Disclosure_Time-line"><span class="tocnumber">9</span> <span class="toctext">Disclosure Time-line</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Credit"><span class="tocnumber">10</span> <span class="toctext">Credit</span></a></li>
<li class="toclevel-1 tocsection-11"><a href="#See_Also"><span class="tocnumber">11</span> <span class="toctext">See Also</span></a></li>
</ul>
</div>
<h2><span class="mw-headline" id="Network-wide_DoS_using_malleable_signatures_in_alerts">Network-wide DoS using malleable signatures in alerts</span></h2>
<p>Private Release Date: 24-AGO-2012<br />
Public Release Date: 01-MAR-2013<br />
</p>
<h2><span class="mw-headline" id="Systems_Affected">Systems Affected</span></h2>
<ul><li> Satoshi Bitcoin Client (Bitcoin-Qt, bitcoind)</li>
<li> All Bitcoin clients that mimic the behavior related to the alert system of Satoshi client versions prior 0.6.3</li></ul>
<h2><span class="mw-headline" id="Affected_Versions">Affected Versions</span></h2>
<ul><li> Bitcoin version 0.6.3 released 2012-06-25</li>
<li> Bitcoin version 0.6.2 released 2012-05-08</li>
<li> Bitcoin version 0.6.1 released 2012-05-04</li>
<li> Bitcoin version 0.6.0 released 2012-03-30</li>
<li> Bitcoin version 0.5.3.1 released 2012-03-16</li>
<li> Bitcoin version 0.5.3 released 2012-03-14</li>
<li> Bitcoin version 0.5.2 released 2012-01-09</li>
<li> Bitcoin version 0.5.1 released 2011-12-15</li>
<li> Bitcoin version 0.5.0 released 2011-11-21</li>
<li> Bitcoin version 0.4.0 released 2011-09-23</li>
<li> Bitcoin version 0.3.24 released 2011-07-08</li>
<li> Bitcoin version 0.3.23 released 2011-06-14</li>
<li> Bitcoin version 0.3.22 released 2011-06-05</li>
<li> Bitcoin version 0.3.21 released 2011-04-27</li></ul>
<h2><span class="mw-headline" id="Fixed_in_version">Fixed in version</span></h2>
<ul><li> Bitcoin version 0.7.0 released 2012-09-17</li></ul>
<h2><span class="mw-headline" id="Overview">Overview</span></h2>
<p>Bitcoin protocol has an alert system to spread important news regarding the digital currency. Alerts are signed with a private ECDA key, so only the development team can issue new alerts. Nevertheless, prior version 0.7.0, alerts were identified by the hash of the message, which includes the signature. Bitcoin accepts BED-encoded signatures, which are malleable.
An attacker build new signatures at a high rate by changing the signature of an alert still in circulation and therefore increasing dramatically the number of valid alerts spreading across the network. This leads to halting all Bitcoin nodes in the network by RAM exhaustion in approximately 4 hours. The attack is persistent, since if a nodes restarted get flooded again by online peers.
</p>
<h2><span class="mw-headline" id="Details">Details</span></h2>
<p>There different ways an attacker can abuse the malleability of alert signatures:
</p><p>- 1. An attacker may try to fill the RAM of all the nodes by sending 2000 modified alerts, each of 1 Mbyte size, using padding zeros. Such 1 Mbyte alerts would slowly spread through the network, and finally reach every node.
</p><p>- 2. An attacker may use the fact that an ECDSA signature consist of two numbers (r,s), and each one can be padded by zeros. By interleaving and extending the zero padding of s and r, the attacker can build a stream of correct signatures whose sizes grows with the square root of the number of signatures generated.
(for example, for X bytes of zero-padding you can generate X different modified signature alerts whose sizes are size(r)=72+i, size(s)=72+X-i for 0 &lt;= i &lt;= X)
</p><p>This attack can try to exhaust GUI resources. For example, running the attack for 1 hour over a 64 Kbytes/sec link, the attacker is able to produce 321446 alerts. We have not evaluated how Qt responds in each platform to 321446 calls to QMessageBox::critical() without user interaction, but it's plausible that the application halts.
</p><p>- 3. An attacker can try to exhaust the victim's computer CPU by:
</p><p>- 3.1. Forcing excessive signature verification time (this only happens with the very first small alerts sent, and for old CPUs )
</p><p>- 3.2. Forcing excessive iterations of the loop&#160;: for (map&lt;uint256, CAlert&gt;::iterator mi = mapAlerts.begin(); mi&#160;!= mapAlerts.end()Wink
</p><p>As an example, in the first hour an attacker is able to send 321446 small alerts. The following hour the attacker is able to send 207757 alerts, starting at size 1218. With a 64 Kbytes/sec link, the attacker can send this last alerts at 52 alerts/second. The code block inside the for loop will be executed 321446*52 = 16,890,430 times, and that takes more than a second to process on an average computer, so CPU is exhausted in the loop.
</p><p>To maximize the damage of an attack, an attacker requires an existing alert that is relevant for all versions of the protocol, and one that will not have expired and is still in the relay interval. With such alert, the attacker can reach the maximum number of nodes. Because of this, the vulnerability should not be notified to users by using the alert system. By doing so the attacker may receive the tool required to mount the best possible attack.
</p>
<h2><span class="mw-headline" id="Attack_Scenario">Attack Scenario</span></h2>
<p>The best attack is to harm the entire network and possibly generate a rush to the coin. To simplify the analysis, we assume that an average connection bandwidth is 64 Kbytes/sec and that each node has 2 GB of RAM, plus 2 GB of swap space. We assume the attacker executes the attack 1 described in the previous section, which tries to exhaust RAM, but leaves the CPU resources intact to keep spreading the fake alerts. If the such an attack is executed, every node in the network will start trashing after 1.5 hours approximately, as Bitcoin application will be using more than 1.5 GB of RAM. After 2 hours, every node running in Windows 32-bits will halt, since the address space of 2 Gb will be filled. After 8.7 hours, every 64-bit node still alive will fill both the 2 Gb of RAM and the 4 gigabytes of hard disk swap space assumed, and the Bitcoin application will halt.
</p><p>It is supposed that, in Bitcoin-Qt application, QMessageBox::critical() with modal=false will be called for each alert, so the application may crash much sooner due to lack of Windows or whatever GUI resources Qt uses. This is only relevant to Bitcoin-qt and not Bitcoind releases.
</p>
<h2><span class="mw-headline" id="Suggested_Solutions_for_the_0.7.0_release">Suggested Solutions for the 0.7.0 release</span></h2>
<ol><li> Change the way the hash of alerts is computed: exclude the signature from the hash.</li>
<li> Reject alert signatures that are not DER-encoded.</li>
<li> Check setKnown before checking signatures.</li>
<li> Support a special fixed alert message that cancels all previous alerts. This would be a damage control measure if all other protections are violated.</li></ol>
<p>Solutions 1,3 and 4 were implemented in Bitcoin version 0.7.0.
</p>
<h2><span class="mw-headline" id="Disclosure_Time-line">Disclosure Time-line</span></h2>
<p>2012-08-24 - Vulnerability reported to Gavin Andressen and other core devs.<br />
2012-08-24 - Gavin Andressen acknowledges report<br />
2012-08-26 – Private discussions of Gavin Andressen, Gregory Maxwell and Sergio Lerner on how to address the vulnerability.<br />
2012-08-26 – Fix finally scheduled for the 0.7.0 release<br />
2012-09-17 - Bitcoin version 0.7.0 released<br />
2013-03-01 - Patched Bitcoin versions reach 80% of the network nodes upgraded.<br />
2013-03-01 - Vulnerability disclosure<br />
</p>
<h2><span class="mw-headline" id="Credit">Credit</span></h2>
<p>This vulnerability was discovered by Sergio Demian Lerner, from <a rel="nofollow" class="external text" href="http://Certimix.com">Certimix.com</a>.<br />
Bitcointalk user Enochian was the first to publish BER/DER encoding problems of Bitcoin signatures in this thread: <a rel="nofollow" class="external free" href="https://bitcointalk.org/index.php?topic=8392.0">https://bitcointalk.org/index.php?topic=8392.0</a>. <br />
This report was written by SDL.
</p>
<h2><span class="mw-headline" id="See_Also">See Also</span></h2>
<ul><li> <a href="/wiki/Common_Vulnerabilities_and_Exposures" title="Common Vulnerabilities and Exposures">Common Vulnerabilities and Exposures</a></li></ul>


</div>

</div> <div class="printfooter">
Retrieved from "<a dir="ltr" href="https://en.bitcoin.it/w/index.php?title=CVE-2012-4684&amp;oldid=54967">https://en.bitcoin.it/w/index.php?title=CVE-2012-4684&amp;oldid=54967</a>" </div>
<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div> <div class="visualClear"></div>
</div>
</div>
<div id="mw-navigation">
<h2>Navigation menu</h2>
<div id="mw-head">
<div id="p-personal" role="navigation" class="" aria-labelledby="p-personal-label">
<h3 id="p-personal-label">Personal tools</h3>
<ul>
<li id="pt-createaccount"><a href="/w/index.php?title=Special:CreateAccount&amp;returnto=CVE-2012-4684" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li><li id="pt-login"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=CVE-2012-4684" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li> </ul>
</div>
<div id="left-navigation">
<div id="p-namespaces" role="navigation" class="vectorTabs" aria-labelledby="p-namespaces-label">
<h3 id="p-namespaces-label">Namespaces</h3>
<ul>
<li id="ca-nstab-main" class="selected"><span><a href="/wiki/CVE-2012-4684" title="View the content page [c]" accesskey="c">Page</a></span></li>
<li id="ca-talk" class="new"><span><a href="/w/index.php?title=Talk:CVE-2012-4684&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></span></li>
</ul>
</div>
<div id="p-variants" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-variants-label">
<h3 id="p-variants-label">
<span>Variants</span>
</h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
</div>
<div id="right-navigation">
<div id="p-views" role="navigation" class="vectorTabs" aria-labelledby="p-views-label">
<h3 id="p-views-label">Views</h3>
<ul>
<li id="ca-view" class="selected"><span><a href="/wiki/CVE-2012-4684">Read</a></span></li>
<li id="ca-viewsource"><span><a href="/w/index.php?title=CVE-2012-4684&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></span></li>
<li id="ca-history" class="collapsible"><span><a href="/w/index.php?title=CVE-2012-4684&amp;action=history" title="Past revisions of this page [h]" accesskey="h">View history</a></span></li>
</ul>
</div>
<div id="p-cactions" role="navigation" class="vectorMenu emptyPortlet" aria-labelledby="p-cactions-label">
<h3 id="p-cactions-label"><span>More</span></h3>
<div class="menu">
<ul>
</ul>
</div>
</div>
<div id="p-search" role="search">
<h3>
<label for="searchInput">Search</label>
</h3>
<form action="/w/index.php" id="searchform">
<div id="simpleSearch">
<input type="search" name="search" placeholder="Search Bitcoin Wiki" title="Search Bitcoin Wiki [f]" accesskey="f" id="searchInput" /><input type="hidden" value="Special:Search" name="title" /><input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton mw-fallbackSearchButton" /><input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchButton" class="searchButton" /> </div>
</form>
</div>
</div>
</div>
<div id="mw-panel">
<div id="p-logo" role="banner"><a class="mw-wiki-logo" href="/wiki/Main_Page" title="Visit the main page"></a></div>
<div class="portal" role="navigation" id='p-navigation' aria-labelledby='p-navigation-label'>
<h3 id='p-navigation-label'>Navigation</h3>
<div class="body">
<ul>
<li id="n-mainpage-description"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z">Main page</a></li><li id="n-Bitcoin-FAQ"><a href="/wiki/Help:FAQ">Bitcoin FAQ</a></li><li id="n-Editing-help"><a href="/wiki/Bitcoin_Wiki:Help">Editing help</a></li><li id="n-Forums"><a href="/wiki/Forums">Forums</a></li><li id="n-Chatrooms"><a href="/wiki/IRC_channels">Chatrooms</a></li><li id="n-Recent-changes"><a href="/wiki/Special:RecentChanges">Recent changes</a></li><li id="n-Page-index"><a href="/wiki/Special:AllPages">Page index</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-tb' aria-labelledby='p-tb-label'>
<h3 id='p-tb-label'>Tools</h3>
<div class="body">
<ul>
<li id="t-whatlinkshere"><a href="/wiki/Special:WhatLinksHere/CVE-2012-4684" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li><li id="t-recentchangeslinked"><a href="/wiki/Special:RecentChangesLinked/CVE-2012-4684" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li><li id="t-specialpages"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li><li id="t-print"><a href="/w/index.php?title=CVE-2012-4684&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li><li id="t-permalink"><a href="/w/index.php?title=CVE-2012-4684&amp;oldid=54967" title="Permanent link to this revision of the page">Permanent link</a></li><li id="t-info"><a href="/w/index.php?title=CVE-2012-4684&amp;action=info" title="More information about this page">Page information</a></li> </ul>
</div>
</div>
<div class="portal" role="navigation" id='p-Sister_projects' aria-labelledby='p-Sister_projects-label'>
<h3 id='p-Sister_projects-label'>Sister projects</h3>
<div class="body">
<ul>
<li id="n-Essays"><a href="/wiki/Bitcoin_Wiki:Essay_main_page">Essays</a></li><li id="n-Source"><a href="/wiki/Bitcoin_Wiki:Source_main_page">Source</a></li> </ul>
</div>
</div>
</div>
</div>
<div id="footer" role="contentinfo">
<ul id="footer-info">
<li id="footer-info-lastmod"> This page was last edited on 6 March 2015, at 15:53.</li>
<li id="footer-info-copyright">Content is available under <a class="external" rel="nofollow" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0</a> unless otherwise noted.</li>
</ul>
<ul id="footer-places">
<li id="footer-places-privacy"><a href="/wiki/Bitcoin_Wiki:Privacy_policy" title="Bitcoin Wiki:Privacy policy">Privacy policy</a></li>
<li id="footer-places-about"><a href="/wiki/Bitcoin_Wiki:About" title="Bitcoin Wiki:About">About Bitcoin Wiki</a></li>
<li id="footer-places-disclaimer"><a href="/wiki/Bitcoin_Wiki:General_disclaimer" title="Bitcoin Wiki:General disclaimer">Disclaimers</a></li>
</ul>
<ul id="footer-icons" class="noprint">
<li id="footer-poweredbyico">
<a href="//www.mediawiki.org/"><img src="/w/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/w/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /w/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a> </li>
</ul>
<div style="clear:both"></div>
</div>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.006","walltime":"0.007","ppvisitednodes":{"value":53,"limit":1000000},"ppgeneratednodes":{"value":70,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20211030233309","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":39});});</script>
</body>
</html>
