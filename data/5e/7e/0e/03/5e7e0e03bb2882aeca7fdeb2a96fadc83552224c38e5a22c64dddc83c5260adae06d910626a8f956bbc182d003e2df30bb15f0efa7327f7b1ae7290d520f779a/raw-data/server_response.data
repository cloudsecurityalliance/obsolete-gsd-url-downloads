<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - TLS certificate check bypass with mbedTLS/PolarSSL - CVE-2016-3739</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>TLS certificate check bypass with mbedTLS/PolarSSL</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="tls-certificate-check-bypass-with-mbedtlspolarssl">TLS certificate check bypass with mbedTLS/PolarSSL</h1>
<p>Project curl Security Advisory, May 18th 2016 - <a href="https://curl.se/docs/CVE-2016-3739.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>libcurl did not check the server certificate of TLS connections done to a host specified as an IP address, or when explicitly asked to use SSLv3.</p>
<p>This flaw only exists when libcurl is built to use mbedTLS or PolarSSL as the TLS backend.</p>
<p>The documentation for mbedTLS and PolarSSL (wrongly) says that the API function <code>ssl_set_hostname()</code> is used only for setting the name for the TLS extension SNI. The set string is however even more importantly used by the libraries to verify the server certificate, and if no &quot;hostname&quot; is set it will just skip the check and successfully continue with the handshake.</p>
<p>libcurl would wrongly avoid using the function when the specified host name was given as an IP address or when SSLv3 is used, as SNI isn't supposed to be used then. This then leads to that all uses of TLS oriented protocols (HTTPS, FTPS, IMAPS, POPS3, SMTPS, etc) will allow connections to servers with unverified server certificates as long as they're specified as IP addresses or using SSLv3.</p>
<p>By tricking a libcurl-using client to use a URL with a host specified as IP address only, an application could be made to connect to an impostor server or Man In The Middle host without noticing.</p>
<p>Note: PolarSSL is the old name and releases of the library that nowadays is known and released under the name mbedTLS.</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This flaw also affects the curl command line tool.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2016-3739 to this issue.</p>
<p>CWE-297: Improper Validation of Certificate with Host Mismatch</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<p>This flaw is relevant for all versions of curl and libcurl that support PolarSSL or mbedTLS.</p>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.21.0.html">7.21.0</a> to and including <a href="vuln-7.48.0.html">7.48.0</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.21.0.html">7.21.0</a> and libcurl &gt;= <a href="vuln-7.49.0.html">7.49.0</a></li>
</ul>
<p>libcurl is used by many applications, but not always advertised as such!</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>In version <a href="vuln-7.49.0.html">7.49.0</a>, libcurl properly sets the &quot;hostname&quot; even when it is just an IP address and even when using SSLv3 that doesn't have SNI.</p>
<p>A <a href="https://curl.se/CVE-2016-3739.patch">patch for CVE-2016-3739</a> is available.</p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade curl and libcurl to version <a href="vuln-7.49.0.html">7.49.0</a></p>
<p>B - Apply the patch to your version and rebuild</p>
<p>C - Build your libcurl with another TLS backend to work around this flaw.</p>
<h2 id="time-line">TIME LINE</h2>
<p>It was first reported to the curl project on April 21st 2016. We contacted distros@openwall on May 8th.</p>
<p>libcurl <a href="vuln-7.49.0.html">7.49.0</a> was released on May 18 2016, coordinated with the publication of this advisory.</p>
<h2 id="credits">CREDITS</h2>
<p>Reported by Moti Avrahami. Patched by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
