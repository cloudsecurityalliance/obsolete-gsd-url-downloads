<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/glance/+bug/1498163/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1498163 “[OSSA 2015-020] Glance storage quota bypass when t...” : Bugs : Glance</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1498163" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1498163/bug.atom" title="Bug 1498163 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="About a year ago it was a vulnerability called 'Glance user storage quota bypass': https://security.openstack.org/ossa/OSSA-2015-003.html, where any user could overcome the quota and clog up the storage.
The fix was proposed in master and all other stable branches, but it turned out, that it doesn't completely remove the issue and any user still can exceed the quota.

It happens in case if user token is expired during file upload and when glance tries to update image status from 'saving' to '..." />
      <meta property="og:description" content="About a year ago it was a vulnerability called 'Glance user storage quota bypass': https://security.openstack.org/ossa/OSSA-2015-003.html, where any user could overcome the quota and clog up the storage.
The fix was proposed in master and all other stable branches, but it turned out, that it doesn't completely remove the issue and any user still can exceed the quota.

It happens in case if user token is expired during file upload and when glance tries to update image status from 'saving' to '..." />
    

    
    
      <meta property="og:title" content="Bug #1498163 “[OSSA 2015-020] Glance storage quota bypass when t...” : Bugs : Glance" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1498163" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["api", "cache", "documentation", "domain-proxy", "gate", "i18n", "low-hanging-fruit", "metadef", "mitaka-backport-potential", "newton-backport-potential", "ocata-rc-potential", "ops", "scrubber", "security"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/glance/+bug/1498163/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/glance"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/355215744/glance-chipmunk-64.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/glance">Glance</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/glance">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/glance">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/glance">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/glance">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/glance">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/glance">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1498163 reported by
      <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin</a>
      <time title="2015-09-21 19:46:58 UTC" datetime="2015-09-21T19:46:58.678681+00:00">on 2015-09-21</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">260</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary1909786">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/glance/+bug/1498163/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1909786">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/glance">Glance</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/glance/+bug/1498163/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/glance/+bug/1498163/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1909786">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~mfedosin">Mike Fedosin</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/glance/+milestone/11.0.0">Glance 11.0.0 "liberty"</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1909786">
     <td colspan="7"><form action="/glance/+bug/1498163/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/glance">Glance</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2015-09-21 19:46:58 UTC" datetime="2015-09-21T19:46:58.678681+00:00">2015-09-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2015-09-21 19:52:19 UTC" datetime="2015-09-21T19:52:19.967721+00:00">2015-09-21</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2015-09-21 20:00:36 UTC" datetime="2015-09-21T20:00:36.535774+00:00">2015-09-21</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2015-10-01 15:18:45 UTC" datetime="2015-10-01T15:18:45.267776+00:00">2015-10-01</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2015-10-03 12:48:15 UTC" datetime="2015-10-03T12:48:15.283511+00:00">2015-10-03</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="glance.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="glance.target.option.package" name="glance.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="glance.target.distribution" name="glance.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="glance.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="glance.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="glance.target.package"
                         name="glance.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;glance.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('glance.target.package');
              var select_menu = Y.DOM.byId('glance.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-glance-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a package", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "DistributionPackage", "extra_no_results_message": null, "selected_value": null, "show_assign_me_button": false, "show_widget_id": "show-widget-glance-target-package", "step_title": "Search by name", "assign_me_text": "Pick me", "input_element": "glance.target.package"};
        var show_widget_id = 'show-widget-glance-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="glance.target.option.product" name="glance.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="glance" id="glance.target.product"
                         name="glance.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;glance.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('glance.target.product');
              var select_menu = Y.DOM.byId('glance.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-glance-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a project", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "Product", "extra_no_results_message": null, "selected_value": "glance", "show_assign_me_button": false, "show_widget_id": "show-widget-glance-target-product", "step_title": "Search", "assign_me_text": "Pick me", "input_element": "glance.target.product"};
        var show_widget_id = 'show-widget-glance-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="glance.status" name="glance.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="glance.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          Glance 11.0.0
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="glance.assignee.assign_to_me" name="glance.assignee.option" value="glance.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="glance.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="glance.assignee.assigned_to" name="glance.assignee.option" value="glance.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="glance.assignee.assigned_to">
              Mike Fedosin (mfedosin)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="glance.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="glance.comment_on_change" name="glance.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1945071">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/glance/juno/+bug/1498163/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/glance/juno">Juno</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/glance/juno/+bug/1498163/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/glance/juno/+bug/1498163/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1945071">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/glance/+milestone/2014.2.4">Glance 2014.2.4</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1945071">
     <td colspan="7"><form action="/glance/juno/+bug/1498163/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/glance/juno">Glance juno</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~apevec" class="sprite person">Alan Pevec</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2015-11-14 10:32:00 UTC" datetime="2015-11-14T10:32:00.527905+00:00">2015-11-14</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2015-11-14 15:04:27 UTC" datetime="2015-11-14T15:04:27.966196+00:00">2015-11-14</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2015-11-14 15:04:27 UTC" datetime="2015-11-14T15:04:27.966196+00:00">2015-11-14</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2015-11-19 21:40:46 UTC" datetime="2015-11-19T21:40:46.405322+00:00">2015-11-19</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance_juno.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance_juno.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance_juno.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="glance_juno.status" name="glance_juno.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="glance_juno.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          Glance 2014.2.4
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance_juno.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="glance_juno.assignee.assign_to_nobody" name="glance_juno.assignee.option" value="glance_juno.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="glance_juno.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="glance_juno.assignee.assign_to_me" name="glance_juno.assignee.option" value="glance_juno.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="glance_juno.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="glance_juno.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="glance_juno.comment_on_change" name="glance_juno.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1982896">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/glance/kilo/+bug/1498163/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/glance/kilo">Kilo</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/glance/kilo/+bug/1498163/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/glance/kilo/+bug/1498163/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1982896">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/glance/+milestone/2015.1.3">Glance 2015.1.3</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1982896">
     <td colspan="7"><form action="/glance/kilo/+bug/1498163/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/glance/kilo">Glance kilo</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~davewalker" class="sprite person">Dave Walker</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2016-01-21 20:19:21 UTC" datetime="2016-01-21T20:19:21.150331+00:00">2016-01-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2016-01-21 20:19:52 UTC" datetime="2016-01-21T20:19:52.702525+00:00">2016-01-21</time>
      </td>
    </tr>
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2016-01-21 20:19:52 UTC" datetime="2016-01-21T20:19:52.702525+00:00">2016-01-21</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2016-01-21 23:12:55 UTC" datetime="2016-01-21T23:12:55.077118+00:00">2016-01-21</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance_kilo.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance_kilo.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="glance_kilo.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="glance_kilo.status" name="glance_kilo.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="glance_kilo.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          Glance 2015.1.3
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="glance_kilo.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="glance_kilo.assignee.assign_to_nobody" name="glance_kilo.assignee.option" value="glance_kilo.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="glance_kilo.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="glance_kilo.assignee.assign_to_me" name="glance_kilo.assignee.option" value="glance_kilo.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="glance_kilo.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="glance_kilo.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="glance_kilo.comment_on_change" name="glance_kilo.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1909790">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ossa/+bug/1498163/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1909790">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ossa/+bug/1498163/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ossa/+bug/1498163/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1909790">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~tristan-cacqueray">Tristan Cacqueray</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1909790">
     <td colspan="7"><form action="/ossa/+bug/1498163/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ossa">OpenStack Security Advisory</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2015-09-21 20:03:08 UTC" datetime="2015-09-21T20:03:08.387342+00:00">2015-09-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2015-09-25 14:57:34 UTC" datetime="2015-09-25T14:57:34.001967+00:00">2015-09-25</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2015-09-25 14:57:37 UTC" datetime="2015-09-25T14:57:37.216142+00:00">2015-09-25</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2015-09-25 14:57:34 UTC" datetime="2015-09-25T14:57:34.001967+00:00">2015-09-25</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2015-10-05 14:04:05 UTC" datetime="2015-10-05T14:04:05.625954+00:00">2015-10-05</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ossa.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="ossa.target.option.package" name="ossa.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ossa.target.distribution" name="ossa.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ossa.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ossa.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ossa.target.package"
                         name="ossa.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.package');
              var select_menu = Y.DOM.byId('ossa.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a package", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "DistributionPackage", "extra_no_results_message": null, "selected_value": null, "show_assign_me_button": false, "show_widget_id": "show-widget-ossa-target-package", "step_title": "Search by name", "assign_me_text": "Pick me", "input_element": "ossa.target.package"};
        var show_widget_id = 'show-widget-ossa-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ossa.target.option.product" name="ossa.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="ossa" id="ossa.target.product"
                         name="ossa.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.product');
              var select_menu = Y.DOM.byId('ossa.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_remove_button": false, "header": "Select a project", "vocabulary_filters": [], "remove_team_text": "Remove team", "remove_person_text": "Remove person", "selected_value_metadata": null, "show_create_team": false, "picker_type": "default", "vocabulary_name": "Product", "extra_no_results_message": null, "selected_value": "ossa", "show_assign_me_button": false, "show_widget_id": "show-widget-ossa-target-product", "step_title": "Search", "assign_me_text": "Pick me", "input_element": "ossa.target.product"};
        var show_widget_id = 'show-widget-ossa-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ossa.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ossa.status" name="ossa.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ossa.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ossa.assignee.assign_to_me" name="ossa.assignee.option" value="ossa.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="ossa.assignee.assigned_to" name="ossa.assignee.option" value="ossa.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="ossa.assignee.assigned_to">
              Tristan Cacqueray (tristan-cacqueray)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ossa.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ossa.comment_on_change" name="ossa.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/glance/+bug/1498163/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>About a year ago it was a vulnerability called &#x27;Glance user storage quota bypass&#x27;: <a rel="nofollow" href="https://security.openstack.org/ossa/OSSA-2015-003.html">https:/<wbr />/security.<wbr />openstack.<wbr />org/ossa/<wbr />OSSA-2015-<wbr />003.html</a>, where any user could overcome the quota and clog up the storage.<br />
The fix was proposed in master and all other stable branches, but it turned out, that it doesn&#x27;t completely remove the issue and any user still can exceed the quota.</p>
<p>It happens in case if user token is expired during file upload and when glance tries to update image status from &#x27;saving&#x27; to &#x27;active&#x27;. Then glance gets Unauthenticated exception from registry server and fails with 500 error. On the other side garbage file is left in storage.</p>
<p>Steps to reproduce mostly coincide with the related from the previous bug, but in general it is:<br />
1. Set some value (like 1Gb) to user_storage_quota in glance-api.conf and restart the server.<br />
2. Make sure that your token will expire soon, when you&#x27;ll be able to create an image instance in DB and begin the upload, but the token will expire during it.<br />
3. Create an image, begin the upload and quickly remove the image with &#x27;glance image-delete&#x27;.<br />
4. After the upload check that image is not in the list, i.e. it&#x27;s deleted, and file is still located in the store.<br />
5. Perform steps 2-4 several times to make sure that user quota is exceeded.</p>
<p>Related script (test_images.py from here <a rel="nofollow" href="https://bugs.launchpad.net/glance/+bug/1398830">https:/<wbr />/bugs.launchpad<wbr />.net/glance/<wbr />+bug/1398830</a>) works fine, too, but it&#x27;s better to reduce token life time in keystone config to 1 or 2 minutes, just for not to wait for one hour.</p>
<p>Glance api v2 is affected as well, but only if registry db_api is enabled.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          <span>See <a href="comments/0">original description</a></span>
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="unofficial-tag" href="/glance/+bugs?field.tag=in-stable-juno">in-stable-juno</a>
            <a class="unofficial-tag" href="/glance/+bugs?field.tag=in-stable-kilo">in-stable-kilo</a>
            <a class="unofficial-tag" href="/glance/+bugs?field.tag=in-stable-liberty">in-stable-liberty</a>
            <a class="unofficial-tag" href="/glance/+bugs?field.tag=kilo-backport-potential">kilo-backport-potential</a>
            <a class="unofficial-tag" href="/glance/+bugs?field.tag=liberty-rc-potential">liberty-rc-potential</a>
          </span>
          
          <a href="+edit" title="Edit tags" id="tags-trigger" class="sprite edit action-icon">Edit</a>
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2015-5286" title="OpenStack Image Service (Glance) befo...">2015-5286</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T19:48:14.974836+00:00" title="2015-09-21 19:48:14 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470670/+files/test_images.py">exploit for v1</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4470670">Edit</a>
        (1.8 KiB,
        text/x-python)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T19:48:40.691462+00:00" title="2015-09-21 19:48:40 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470671/+files/test_images_v2.py">exploit for v2</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4470671">Edit</a>
        (1.8 KiB,
        text/x-python)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T19:50:26.726921+00:00" title="2015-09-21 19:50:26 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470672/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch">Patch for master</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4470672">Edit</a>
        (6.6 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T19:53:11.094041+00:00" title="2015-09-21 19:53:11 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Mike. This is a legitimate issue.</p>
<p>The above patch looks good for v1 and v2. Can you please apply the same for import task too?</p>
<p>Thanks!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Mike. This is a legitimate issue.

The above patch looks good for v1 and v2. Can you please apply the same for import task too?

Thanks!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Triaged
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T19:56:54.881398+00:00" title="2015-09-21 19:56:54 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks for your comment Nikhil. I&#x27;ll do it tomorrow!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks for your comment Nikhil. I'll do it tomorrow!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
    
    <time title="2015-09-21 20:00:36 UTC" datetime="2015-09-21T20:00:36.347272+00:00">on 2015-09-21</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Mike Fedosin (mfedosin)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T20:04:00.352668+00:00" title="2015-09-21 20:04:00 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Since this report concerns a possible security risk, an incomplete security advisory task has been added while the core security reviewers for the affected project or projects confirm the bug and discuss the scope of any vulnerability along with potential solutions.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Incomplete
      </td>
    </tr>
  
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T20:11:51.017041+00:00" title="2015-09-21 20:11:51 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This looks tentative for RC1 but keeping here for tracking.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This looks tentative for RC1 but keeping here for tracking.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        none &#8594; liberty-rc1
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T22:21:29.848904+00:00" title="2015-09-21 22:21:29 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It seems like this could use an OSSA. However token lifetime is not user-controllable afaik... can the user tries more than 1 attempt per token expiration ?</p>
<p>Also the impact is different from OSSA-2015-003 if the left-over images are still located in the store.</p>
<p>Here is the proposed impact description.</p>
<p>Title: Glance storage overrun<br />
Reporter: Mike Fedosin (Mirantis)<br />
Products: Glance<br />
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1</p>
<p>Description:<br />
Mike Fedosin from Mirantis reported a vulnerability in Glance. By deleting images that are being uploaded using a token that is about to expire, a malicious user can overcome the storage quota and accumulate untracked image data in the backend resulting in potential resource exhaustion and denial of service. All Glance setups using the V1 API are affected and all setups using the V2 API with the registry db_api enabled are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It seems like this could use an OSSA. However token lifetime is not user-controllable afaik... can the user tries more than 1 attempt per token expiration ?

Also the impact is different from OSSA-2015-003 if the left-over images are still located in the store.

Here is the proposed impact description.

Title: Glance storage overrun
Reporter: Mike Fedosin (Mirantis)
Products: Glance
Affects: versions through 2014.2.3 and 2015.1 versions through 2015.1.1

Description:
Mike Fedosin from Mirantis reported a vulnerability in Glance. By deleting images that are being uploaded using a token that is about to expire, a malicious user can overcome the storage quota and accumulate untracked image data in the backend resulting in potential resource exhaustion and denial of service. All Glance setups using the V1 API are affected and all setups using the V2 API with the registry db_api enabled are affected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T22:52:41.017365+00:00" title="2015-09-21 22:52:41 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi again Tristan :)</p>
<p>Token lifetime is not user-controllable, indeed. But user can avoid it by waiting a decent amount of time.<br />
Example:<br />
Let&#x27;s assume that token lifetime is set for one hour, which is default for Keystone, and user quota is 5,5Gb. To exceed the quota user gets the token (with &#x27;keystone token-get&#x27;) and waits for 55 minutes, after that he consecutively creates and deletes 5Gb images each 3 seconds. After 5 minutes his token expires, but uploading of all images continues. And when server wants to update theirs status from &#x27;saving&#x27; to &#x27;active&#x27; it fails with 500 error and clogs the storage.</p>
<p>Also please add Alexei Galkin as reporter, too - because it&#x27;s he, who originally found this bug. He works in Mirantis as well.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi again Tristan :)

Token lifetime is not user-controllable, indeed. But user can avoid it by waiting a decent amount of time.
Example: 
Let's assume that token lifetime is set for one hour, which is default for Keystone, and user quota is 5,5Gb. To exceed the quota user gets the token (with 'keystone token-get') and waits for 55 minutes, after that he consecutively creates and deletes 5Gb images each 3 seconds. After 5 minutes his token expires, but uploading of all images continues. And when server wants to update theirs status from 'saving' to 'active' it fails with 500 error and clogs the storage.

Also please add Alexei Galkin as reporter, too - because it's he, who originally found this bug. He works in Mirantis as well.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T23:09:50.629959+00:00" title="2015-09-21 23:09:50 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It seems like this is a much, much slower potential denial of service than that described in <a href="/bugs/1398830" class="bug-link">bug 1398830</a> (for OSSA 2015-003).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It seems like this is a much, much slower potential denial of service than that described in bug 1398830 (for OSSA 2015-003).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T23:26:20.554957+00:00" title="2015-09-21 23:26:20 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Well the user can also generate a lot of tokens in advance too. But I agree the impact is rather moderate here, and considering the release schedule constrain, I would suggest to threat this bug without embargo.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Well the user can also generate a lot of tokens in advance too. But I agree the impact is rather moderate here, and considering the release schedule constrain, I would suggest to threat this bug without embargo.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-21T23:45:15.940940+00:00" title="2015-09-21 23:45:15 UTC">on 2015-09-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Technically the impact is the same, because user can do exactly the same things, but a little bit trickier.<br />
But yeah, I can&#x27;t deny that here security risk is smaller. I consider this patch as an amendment to the previous one, which fully eliminates the possibility of quota bypass.</p>
<p>By the way, this patch also fixes the consequences of the old famous bug with token expiration.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Technically the impact is the same, because user can do exactly the same things, but a little bit trickier. 
But yeah, I can't deny that here security risk is smaller. I consider this patch as an amendment to the previous one, which fully eliminates the possibility of quota bypass.

By the way, this patch also fixes the consequences of the old famous bug with token expiration.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T17:05:26.781666+00:00" title="2015-09-22 17:05:26 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4471488/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch">Patch with fixed tasks</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4471488">Edit</a>
        (9.4 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I made a fix for tasks as Nikhil asked.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I made a fix for tasks as Nikhil asked.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T19:56:28.600715+00:00" title="2015-09-22 19:56:28 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Mike, the patch looks good to me.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Mike, the patch looks good to me.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T19:57:19.698868+00:00" title="2015-09-22 19:57:19 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Need to add glance-core-sec team to this bug as I can&#x27;t find them on the right panel.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Need to add glance-core-sec team to this bug as I can't find them on the right panel.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T20:31:04.430750+00:00" title="2015-09-22 20:31:04 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Jeremy, I&#x27;d like to keep the proposed impact description, the title seems correct to me since the left-over image remain in the backend. This is actually worst than <a href="/bugs/1398830" class="bug-link">bug 1398830</a> (for OSSA 2015-003) where left-over image are actually deleted after the upload finished iiuc.</p>
<p>Here is an update impact description to include the additional reporter and new affected version line:</p>
<p>Title: Glance storage overrun<br />
Reporter: Mike Fedosin and Alexei Galkin (Mirantis)<br />
Products: Glance<br />
Affects: &lt;=2014.2.3, &gt;=2015.1.0, &lt;=2015.1.1</p>
<p>Description:<br />
Mike Fedosin and Alexei Galkin from Mirantis reported a vulnerability in Glance. By deleting images that are being uploaded using a token that is about to expire, a malicious user can overcome the storage quota and accumulate untracked image data in the backend resulting in potential resource exhaustion and denial of service. All Glance setups using the V1 API are affected and all setups using the V2 API with the registry db_api enabled are affected.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Jeremy, I'd like to keep the proposed impact description, the title seems correct to me since the left-over image remain in the backend. This is actually worst than bug 1398830 (for OSSA 2015-003) where left-over image are actually deleted after the upload finished iiuc.

Here is an update impact description to include the additional reporter and new affected version line:

Title: Glance storage overrun
Reporter: Mike Fedosin and Alexei Galkin (Mirantis)
Products: Glance
Affects: &lt;=2014.2.3, &gt;=2015.1.0, &lt;=2015.1.1

Description:
Mike Fedosin and Alexei Galkin from Mirantis reported a vulnerability in Glance. By deleting images that are being uploaded using a token that is about to expire, a malicious user can overcome the storage quota and accumulate untracked image data in the backend resulting in potential resource exhaustion and denial of service. All Glance setups using the V1 API are affected and all setups using the V2 API with the registry db_api enabled are affected.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T21:54:52.441368+00:00" title="2015-09-22 21:54:52 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m ok with either.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm ok with either.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hemanth-makkapati" class="sprite person">Hemanth Makkapati (hemanth-makkapati)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-22T23:01:23.246695+00:00" title="2015-09-22 23:01:23 UTC">on 2015-09-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The patch looks good to me.<br />
A couple of minor comments though.<br />
1. Logging a warn message in v2 is probably not required. A debug log message just like the one you have for v1 should suffice in my opinion<br />
2. The log message says it&#x27;s an &#x27;Authorization problem&#x27;. It&#x27;s authentication really.</p>
<p>Anyway, if there isn&#x27;t enough time to address the above minor issues, that&#x27;s fine.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The patch looks good to me.
A couple of minor comments though.
1. Logging a warn message in v2 is probably not required. A debug log message just like the one you have for v1 should suffice in my opinion
2. The log message says it's an 'Authorization problem'. It's authentication really.

Anyway, if there isn't enough time to address the above minor issues, that's fine.
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T06:43:16.696484+00:00" title="2015-09-23 06:43:16 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The code looks good to me. I took the liberty of addressing Hermanth comments. Here are the three patches backported from master all the way back to juno</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The code looks good to me. I took the liberty of addressing Hermanth comments. Here are the three patches backported from master all the way back to juno</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T06:43:29.773806+00:00" title="2015-09-23 06:43:29 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472005/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-master">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-master</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4472005">Edit</a>
        (6.8 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T06:43:47.400416+00:00" title="2015-09-23 06:43:47 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472007/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-kilo">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-kilo</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4472007">Edit</a>
        (7.0 KiB,
        text/plain)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T06:44:01.375452+00:00" title="2015-09-23 06:44:01 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472008/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-juno">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-juno</a>
        <a class="sprite edit action-icon" href="/glance/+bug/1498163/+attachment/4472008">Edit</a>
        (7.1 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stuart-mclaren" class="sprite person">Stuart McLaren (stuart-mclaren)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T08:40:17.619689+00:00" title="2015-09-23 08:40:17 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks Mike/Flavio.</p>
<p>Will the fix work for the multi-tenant swift store? In that case can we delete image data when we don&#x27;t have a token?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks Mike/Flavio.

Will the fix work for the multi-tenant swift store? In that case can we delete image data when we don't have a token?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T08:49:27.669962+00:00" title="2015-09-23 08:49:27 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Stuart,</p>
<p>I honestly don&#x27;t have a way to test that but, by reading the code, I think it does. If you have a chance to test this w/ a multi-tenant swift store, please, help! :)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Stuart,

I honestly don't have a way to test that but, by reading the code, I think it does. If you have a chance to test this w/ a multi-tenant swift store, please, help! :)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mfedosin" class="sprite person">Mike Fedosin (mfedosin)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-23T09:51:54.393860+00:00" title="2015-09-23 09:51:54 UTC">on 2015-09-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi, sorry for late response...</p>
<p>About Hemanth&#x27;s second comment: but anyway we have to raise Unauthorized exception, as it was done in the other cases, for example here <a rel="nofollow" href="https://github.com/openstack/glance/blob/master/glance/api/v2/images.py#L90">https:/<wbr />/github.<wbr />com/openstack/<wbr />glance/<wbr />blob/master/<wbr />glance/<wbr />api/v2/<wbr />images.<wbr />py#L90</a><br />
Also it seems that it&#x27;s more authZ problem rather than AuthN, because authenticated user can&#x27;t be authorized with expired token.</p>
<p>@Stuart, unfortunately no... To delete files form Multitenant store valid user&#x27;s token is required. It can&#x27;t be fixed without trusts. But it&#x27;s turned off by default and considered as experimental realization, am I right?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi, sorry for late response...

About Hemanth's second comment: but anyway we have to raise Unauthorized exception, as it was done in the other cases, for example here https://github.com/openstack/glance/blob/master/glance/api/v2/images.py#L90
Also it seems that it's more authZ problem rather than AuthN, because authenticated user can't be authorized with expired token.

@Stuart, unfortunately no... To delete files form Multitenant store valid user's token is required. It can't be fixed without trusts. But it's turned off by default and considered as experimental realization, am I right?
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
    
    <time title="2015-09-25 14:15:51 UTC" datetime="2015-09-25T14:15:51.221084+00:00">on 2015-09-25</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        liberty-rc1 &#8594; ongoing
      </td>
    </tr>
  
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: liberty-rc-potential
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~flaper87" class="sprite person">Flavio Percoco (flaper87)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-25T14:31:36.500817+00:00" title="2015-09-25 14:31:36 UTC">on 2015-09-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Can we schedule this  bug to be disclosed next week?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Can we schedule this  bug to be disclosed next week?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-25T14:53:36.173112+00:00" title="2015-09-25 14:53:36 UTC">on 2015-09-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Tristan&#x27;s impact description in comment #16 looks great.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Tristan's impact description in comment #16 looks great.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-09-25 14:57:33 UTC" datetime="2015-09-25T14:57:33.798163+00:00">on 2015-09-25</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Incomplete &#8594; In Progress
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Tristan Cacqueray (tristan-cacqueray)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-09-25T20:27:04.061179+00:00" title="2015-09-25 20:27:04 UTC">on 2015-09-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Proposed public disclosure date/time:<br />
2015-10-01, 1500UTC</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Proposed public disclosure date/time:
2015-10-01, 1500UTC</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-09-25 20:32:41 UTC" datetime="2015-09-25T20:32:41.073316+00:00">on 2015-09-25</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Committed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-09-25 20:42:45 UTC" datetime="2015-09-25T20:42:45.797110+00:00">on 2015-09-25</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Glance storage quota bypass when token is expired<br />+ Glance storage quota bypass when token is expired (CVE-2015-5286)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2015-10-01 11:56:02 UTC" datetime="2015-10-01T11:56:02.799663+00:00">on 2015-10-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        ongoing &#8594; liberty-rc2
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-10-01 15:01:16 UTC" datetime="2015-10-01T15:01:16.235688+00:00">on 2015-10-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - Glance storage quota bypass when token is expired (CVE-2015-5286)<br />+ [OSSA 2015-020] Glance storage quota bypass when token is expired<br />+ (CVE-2015-5286)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
    
    <time title="2015-10-01 15:18:44 UTC" datetime="2015-10-01T15:18:44.689432+00:00">on 2015-10-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; In Progress
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:41:14.270369+00:00" title="2015-10-01 15:41:14 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Adding some context from IRC conversations I had recently on this bug,</p>
<p>the latest proposed fixes do not include the tasks related fix. So, the in flight review atm -- <a rel="nofollow" href="https://review.openstack.org/#/q/I17a66eca55bfb83107046910e69c4da01415deec,n,z">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/q/<wbr />I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec,<wbr />n,z</a> , do not include the fix from <a rel="nofollow" href="https://bugs.launchpad.net/glance/+bug/1498163/comments/13">https:/<wbr />/bugs.launchpad<wbr />.net/glance/<wbr />+bug/1498163/<wbr />comments/<wbr />13</a> for getting rid if this vulnerability via tasks.</p>
<p>This is definitely out of some confusion so, I think we need to send another patch for tasks to avoid more of the same.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Adding some context from IRC conversations I had recently on this bug,

the latest proposed fixes do not include the tasks related fix. So, the in flight review atm -- https://review.openstack.org/#/q/I17a66eca55bfb83107046910e69c4da01415deec,n,z , do not include the fix from https://bugs.launchpad.net/glance/+bug/1498163/comments/13 for getting rid if this vulnerability via tasks. 

This is definitely out of some confusion so, I think we need to send another patch for tasks to avoid more of the same.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:43:10.777919+00:00" title="2015-10-01 15:43:10 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/30">
                <strong>Fix proposed to glance (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/229971">https:/<wbr />/review.<wbr />openstack.<wbr />org/229971</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.openstack.org/229971</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:44:54.101296+00:00" title="2015-10-01 15:44:54 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/31">
                <strong>Fix proposed to glance (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/liberty<br />
Review: <a rel="nofollow" href="https://review.openstack.org/229972">https:/<wbr />/review.<wbr />openstack.<wbr />org/229972</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/229972</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:45:08.026974+00:00" title="2015-10-01 15:45:08 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/32">
                <strong>Fix proposed to glance (stable/kilo)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/kilo<br />
Review: <a rel="nofollow" href="https://review.openstack.org/229973">https:/<wbr />/review.<wbr />openstack.<wbr />org/229973</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/kilo
Review: https://review.openstack.org/229973</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:45:47.822116+00:00" title="2015-10-01 15:45:47 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/33">
                <strong>Fix proposed to glance (stable/juno)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/juno<br />
Review: <a rel="nofollow" href="https://review.openstack.org/229975">https:/<wbr />/review.<wbr />openstack.<wbr />org/229975</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/juno
Review: https://review.openstack.org/229975</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T15:49:37.199620+00:00" title="2015-10-01 15:49:37 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><a rel="nofollow" href="https://review.openstack.org/#/q/I17a66eca55bfb83107046910e69c4da01415deec,n,z">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/q/<wbr />I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec,<wbr />n,z</a> and <a rel="nofollow" href="https://review.openstack.org/#/q/Ia6e1fe0d27b13b920ee7e728feb5305dec77e066,n,z">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/q/<wbr />Ia6e1fe0d27b13b<wbr />920ee7e728feb53<wbr />05dec77e066,<wbr />n,z</a> together look good. Please do the needful.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">https://review.openstack.org/#/q/I17a66eca55bfb83107046910e69c4da01415deec,n,z and https://review.openstack.org/#/q/Ia6e1fe0d27b13b920ee7e728feb5305dec77e066,n,z together look good. Please do the needful.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2015-10-01 16:01:03 UTC" datetime="2015-10-01T16:01:03.141427+00:00">on 2015-10-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>description</b>:
      </td>
      <td>
        updated
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-01T18:07:18.363111+00:00" title="2015-10-01 18:07:18 UTC">on 2015-10-01</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/35">
                <strong>Fix proposed to glance (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/liberty<br />
Review: <a rel="nofollow" href="https://review.openstack.org/230056">https:/<wbr />/review.<wbr />openstack.<wbr />org/230056</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/liberty
Review: https://review.openstack.org/230056</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-10-01 18:31:22 UTC" datetime="2015-10-01T18:31:22.313218+00:00">on 2015-10-01</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: kilo-backport-potential
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T11:15:30.780382+00:00" title="2015-10-02 11:15:30 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/36">
                <strong>Fix merged to glance (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229943">https:/<wbr />/review.<wbr />openstack.<wbr />org/229943</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=301bf5108a99ee5299c50089927edfd71024eb58">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=301bf5108a9<wbr />9ee5299c5008992<wbr />7edfd71024eb58</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 301bf5108a99ee5<wbr />299c50089927edf<wbr />d71024eb58<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Sun Sep 20 17:01:22 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Cleanup chunks for deleted image if token expired</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In patch I47229b366c2536<wbr />7ec1bd48aec684e<wbr />0880f3dfe60 it was<br />
&nbsp;&nbsp;&nbsp;&nbsp;introduced the logic that if image was deleted during file<br />
&nbsp;&nbsp;&nbsp;&nbsp;upload when we want to update image status from &#x27;saving&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;to &#x27;active&#x27; it&#x27;s expected to get Duplicate error and delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;stale chunks after that. But if user&#x27;s token is expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;there will be Unathorized exception and chunks will stay<br />
&nbsp;&nbsp;&nbsp;&nbsp;in store and clog it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;And when, the upload operation for such an image is<br />
&nbsp;&nbsp;&nbsp;&nbsp;completed the operator configured quota can be exceeded.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correctly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229943
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=301bf5108a99ee5299c50089927edfd71024eb58
Submitter: Jenkins
Branch:    master

commit 301bf5108a99ee5299c50089927edfd71024eb58
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Sun Sep 20 17:01:22 2015 +0300

    Cleanup chunks for deleted image if token expired
    
    In patch I47229b366c25367ec1bd48aec684e0880f3dfe60 it was
    introduced the logic that if image was deleted during file
    upload when we want to update image status from 'saving'
    to 'active' it's expected to get Duplicate error and delete
    stale chunks after that. But if user's token is expired
    there will be Unathorized exception and chunks will stay
    in store and clog it.
    And when, the upload operation for such an image is
    completed the operator configured quota can be exceeded.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correctly handle
    auth exceptions from registry server.
    
    Partial-bug: #1498163
    
    Change-Id: I17a66eca55bfb83107046910e69c4da01415deec
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T11:24:20.465980+00:00" title="2015-10-02 11:24:20 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229971">https:/<wbr />/review.<wbr />openstack.<wbr />org/229971</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=5be26e13ade3f33b98f551940ca39b25a5790c80">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=5be26e13ade<wbr />3f33b98f551940c<wbr />a39b25a5790c80</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 5be26e13ade3f33<wbr />b98f551940ca39b<wbr />25a5790c80<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Thu Oct 1 18:28:48 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Catch NotAuthenticated exception in import task</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If glance uses registry as data_api then it&#x27;s possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;that token may expire during image import task and Glance<br />
&nbsp;&nbsp;&nbsp;&nbsp;will have NotUauthenticated exception.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This code adds a correct handling of this exception and<br />
&nbsp;&nbsp;&nbsp;&nbsp;allows Glance to remove stale chunks from store.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-Bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ia6e1fe0d27b13b<wbr />920ee7e728feb53<wbr />05dec77e066</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229971
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=5be26e13ade3f33b98f551940ca39b25a5790c80
Submitter: Jenkins
Branch:    master

commit 5be26e13ade3f33b98f551940ca39b25a5790c80
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Thu Oct 1 18:28:48 2015 +0300

    Catch NotAuthenticated exception in import task
    
    If glance uses registry as data_api then it's possible
    that token may expire during image import task and Glance
    will have NotUauthenticated exception.
    
    This code adds a correct handling of this exception and
    allows Glance to remove stale chunks from store.
    
    Partial-Bug: #1498163
    
    Change-Id: Ia6e1fe0d27b13b920ee7e728feb5305dec77e066
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T13:54:45.877318+00:00" title="2015-10-02 13:54:45 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/38">
                <strong>Fix merged to glance (stable/liberty)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229972">https:/<wbr />/review.<wbr />openstack.<wbr />org/229972</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=ebdf076cc9b<wbr />d5d9239cdc96c6e<wbr />7cecc72f852bbb</a><br />
Submitter: Jenkins<br />
Branch:    stable/liberty</p>
<p>commit ebdf076cc9bd5d9<wbr />239cdc96c6e7cec<wbr />c72f852bbb<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Thu Oct 1 18:28:48 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Catch NotAuthenticated exception in import task</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If glance uses registry as data_api then it&#x27;s possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;that token may expire during image import task and Glance<br />
&nbsp;&nbsp;&nbsp;&nbsp;will have NotUauthenticated exception.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This code adds a correct handling of this exception and<br />
&nbsp;&nbsp;&nbsp;&nbsp;allows Glance to remove stale chunks from store.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-Bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ia6e1fe0d27b13b<wbr />920ee7e728feb53<wbr />05dec77e066</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229972
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb
Submitter: Jenkins
Branch:    stable/liberty

commit ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Thu Oct 1 18:28:48 2015 +0300

    Catch NotAuthenticated exception in import task
    
    If glance uses registry as data_api then it's possible
    that token may expire during image import task and Glance
    will have NotUauthenticated exception.
    
    This code adds a correct handling of this exception and
    allows Glance to remove stale chunks from store.
    
    Partial-Bug: #1498163
    
    Change-Id: Ia6e1fe0d27b13b920ee7e728feb5305dec77e066
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-liberty
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T17:00:34.987518+00:00" title="2015-10-02 17:00:34 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/230056">https:/<wbr />/review.<wbr />openstack.<wbr />org/230056</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=fc32f0554de0ba7773d98e6828da157ca7c66002">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=fc32f0554de<wbr />0ba7773d98e6828<wbr />da157ca7c66002</a><br />
Submitter: Jenkins<br />
Branch:    stable/liberty</p>
<p>commit fc32f0554de0ba7<wbr />773d98e6828da15<wbr />7ca7c66002<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Sun Sep 20 17:01:22 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Cleanup chunks for deleted image if token expired</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In patch I47229b366c2536<wbr />7ec1bd48aec684e<wbr />0880f3dfe60 it was<br />
&nbsp;&nbsp;&nbsp;&nbsp;introduced the logic that if image was deleted during file<br />
&nbsp;&nbsp;&nbsp;&nbsp;upload when we want to update image status from &#x27;saving&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;to &#x27;active&#x27; it&#x27;s expected to get Duplicate error and delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;stale chunks after that. But if user&#x27;s token is expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;there will be Unathorized exception and chunks will stay<br />
&nbsp;&nbsp;&nbsp;&nbsp;in store and clog it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;And when, the upload operation for such an image is<br />
&nbsp;&nbsp;&nbsp;&nbsp;completed the operator configured quota can be exceeded.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correctly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/230056
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=fc32f0554de0ba7773d98e6828da157ca7c66002
Submitter: Jenkins
Branch:    stable/liberty

commit fc32f0554de0ba7773d98e6828da157ca7c66002
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Sun Sep 20 17:01:22 2015 +0300

    Cleanup chunks for deleted image if token expired
    
    In patch I47229b366c25367ec1bd48aec684e0880f3dfe60 it was
    introduced the logic that if image was deleted during file
    upload when we want to update image status from 'saving'
    to 'active' it's expected to get Duplicate error and delete
    stale chunks after that. But if user's token is expired
    there will be Unathorized exception and chunks will stay
    in store and clog it.
    And when, the upload operation for such an image is
    completed the operator configured quota can be exceeded.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correctly handle
    auth exceptions from registry server.
    
    Partial-bug: #1498163
    
    Change-Id: I17a66eca55bfb83107046910e69c4da01415deec
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~nikhil-komawar" class="sprite person">Nikhil Komawar (nikhil-komawar)</a>
    
    <time title="2015-10-02 21:41:57 UTC" datetime="2015-10-02T21:41:57.236036+00:00">on 2015-10-02</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Committed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T22:24:54.061152+00:00" title="2015-10-02 22:24:54 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/40">
                <strong>Fix merged to glance (stable/juno)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229946">https:/<wbr />/review.<wbr />openstack.<wbr />org/229946</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=5447e8419d92f0cbb14de53b207e772ce9067933">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=5447e8419d9<wbr />2f0cbb14de53b20<wbr />7e772ce9067933</a><br />
Submitter: Jenkins<br />
Branch:    stable/juno</p>
<p>commit 5447e8419d92f0c<wbr />bb14de53b207e77<wbr />2ce9067933<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Sun Sep 20 17:01:22 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Cleanup chunks for deleted image if token expired</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In patch I47229b366c2536<wbr />7ec1bd48aec684e<wbr />0880f3dfe60 it was<br />
&nbsp;&nbsp;&nbsp;&nbsp;introduced the logic that if image was deleted during file<br />
&nbsp;&nbsp;&nbsp;&nbsp;upload when we want to update image status from &#x27;saving&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;to &#x27;active&#x27; it&#x27;s expected to get Duplicate error and delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;stale chunks after that. But if user&#x27;s token is expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;there will be Unathorized exception and chunks will stay<br />
&nbsp;&nbsp;&nbsp;&nbsp;in store and clog it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;And when, the upload operation for such an image is<br />
&nbsp;&nbsp;&nbsp;&nbsp;completed the operator configured quota can be exceeded.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correcly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correctly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glance/<wbr />api/v1/<wbr />upload_<wbr />utils.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Kilo catches NotFound instead of ImagenotFound)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 50e3a7c58a98622<wbr />06d92fef577540c<wbr />5b144ecbf0)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229946
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=5447e8419d92f0cbb14de53b207e772ce9067933
Submitter: Jenkins
Branch:    stable/juno

commit 5447e8419d92f0cbb14de53b207e772ce9067933
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Sun Sep 20 17:01:22 2015 +0300

    Cleanup chunks for deleted image if token expired
    
    In patch I47229b366c25367ec1bd48aec684e0880f3dfe60 it was
    introduced the logic that if image was deleted during file
    upload when we want to update image status from 'saving'
    to 'active' it's expected to get Duplicate error and delete
    stale chunks after that. But if user's token is expired
    there will be Unathorized exception and chunks will stay
    in store and clog it.
    And when, the upload operation for such an image is
    completed the operator configured quota can be exceeded.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correcly handle
    auth exceptions from registry server.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correctly handle
    auth exceptions from registry server.
    
    Partial-bug: #1498163
    
    Conflicts:
    	glance/api/v1/upload_utils.py
            (Kilo catches NotFound instead of ImagenotFound)
    
    Change-Id: I17a66eca55bfb83107046910e69c4da01415deec
    (cherry picked from commit 50e3a7c58a9862206d92fef577540c5b144ecbf0)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-juno
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-kilo
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/41" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T22:25:03.249583+00:00" title="2015-10-02 22:25:03 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/41">
                <strong>Fix merged to glance (stable/kilo)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/41"> #41</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229945">https:/<wbr />/review.<wbr />openstack.<wbr />org/229945</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=5bebd513fa71edcdb84f7dec7b16f3523c0c1092">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=5bebd513fa7<wbr />1edcdb84f7dec7b<wbr />16f3523c0c1092</a><br />
Submitter: Jenkins<br />
Branch:    stable/kilo</p>
<p>commit 5bebd513fa71edc<wbr />db84f7dec7b16f3<wbr />523c0c1092<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Sun Sep 20 17:01:22 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Cleanup chunks for deleted image if token expired</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In patch I47229b366c2536<wbr />7ec1bd48aec684e<wbr />0880f3dfe60 it was<br />
&nbsp;&nbsp;&nbsp;&nbsp;introduced the logic that if image was deleted during file<br />
&nbsp;&nbsp;&nbsp;&nbsp;upload when we want to update image status from &#x27;saving&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;to &#x27;active&#x27; it&#x27;s expected to get Duplicate error and delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;stale chunks after that. But if user&#x27;s token is expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;there will be Unathorized exception and chunks will stay<br />
&nbsp;&nbsp;&nbsp;&nbsp;in store and clog it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;And when, the upload operation for such an image is<br />
&nbsp;&nbsp;&nbsp;&nbsp;completed the operator configured quota can be exceeded.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correctly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Conflicts:<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;glance/<wbr />api/v1/<wbr />upload_<wbr />utils.py<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(Kilo catches NotFound instead of ImagenotFound)</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit 98a8832777a0639<wbr />a4031e52c69f0d5<wbr />65b3f500c5)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229945
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=5bebd513fa71edcdb84f7dec7b16f3523c0c1092
Submitter: Jenkins
Branch:    stable/kilo

commit 5bebd513fa71edcdb84f7dec7b16f3523c0c1092
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Sun Sep 20 17:01:22 2015 +0300

    Cleanup chunks for deleted image if token expired
    
    In patch I47229b366c25367ec1bd48aec684e0880f3dfe60 it was
    introduced the logic that if image was deleted during file
    upload when we want to update image status from 'saving'
    to 'active' it's expected to get Duplicate error and delete
    stale chunks after that. But if user's token is expired
    there will be Unathorized exception and chunks will stay
    in store and clog it.
    And when, the upload operation for such an image is
    completed the operator configured quota can be exceeded.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correctly handle
    auth exceptions from registry server.
    
    Partial-bug: #1498163
    
    Conflicts:
    	glance/api/v1/upload_utils.py
            (Kilo catches NotFound instead of ImagenotFound)
    
    Change-Id: I17a66eca55bfb83107046910e69c4da01415deec
    (cherry picked from commit 98a8832777a0639a4031e52c69f0d565b3f500c5)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/42" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-02T23:46:14.127475+00:00" title="2015-10-02 23:46:14 UTC">on 2015-10-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/42">
                <strong>Fix merged to glance (stable/juno)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/42"> #42</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229975">https:/<wbr />/review.<wbr />openstack.<wbr />org/229975</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=868d9161c60f839cbf53393b804d7c0c41338e5b">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=868d9161c60<wbr />f839cbf53393b80<wbr />4d7c0c41338e5b</a><br />
Submitter: Jenkins<br />
Branch:    stable/juno</p>
<p>commit 868d9161c60f839<wbr />cbf53393b804d7c<wbr />0c41338e5b<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Thu Oct 1 18:28:48 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Catch NotAuthenticated exception in import task</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If glance uses registry as data_api then it&#x27;s possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;that token may expire during image import task and Glance<br />
&nbsp;&nbsp;&nbsp;&nbsp;will have NotUauthenticated exception.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This code adds a correct handling of this exception and<br />
&nbsp;&nbsp;&nbsp;&nbsp;allows Glance to remove stale chunks from store.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-Bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ia6e1fe0d27b13b<wbr />920ee7e728feb53<wbr />05dec77e066<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from ebdf076cc9bd5d9<wbr />239cdc96c6e7cec<wbr />c72f852bbb)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229975
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=868d9161c60f839cbf53393b804d7c0c41338e5b
Submitter: Jenkins
Branch:    stable/juno

commit 868d9161c60f839cbf53393b804d7c0c41338e5b
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Thu Oct 1 18:28:48 2015 +0300

    Catch NotAuthenticated exception in import task
    
    If glance uses registry as data_api then it's possible
    that token may expire during image import task and Glance
    will have NotUauthenticated exception.
    
    This code adds a correct handling of this exception and
    allows Glance to remove stale chunks from store.
    
    Partial-Bug: #1498163
    
    Change-Id: Ia6e1fe0d27b13b920ee7e728feb5305dec77e066
    (cherry picked from ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2015-10-03 12:48:14 UTC" datetime="2015-10-03T12:48:14.737417+00:00">on 2015-10-03</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Committed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/43" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-04T14:23:43.813785+00:00" title="2015-10-04 14:23:43 UTC">on 2015-10-04</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/43">
                <strong>Fix merged to glance (stable/kilo)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/43"> #43</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/229973">https:/<wbr />/review.<wbr />openstack.<wbr />org/229973</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=15e34b54a5ad59d9aeb0284cc31453eb43b60cf1">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=15e34b54a5a<wbr />d59d9aeb0284cc3<wbr />1453eb43b60cf1</a><br />
Submitter: Jenkins<br />
Branch:    stable/kilo</p>
<p>commit 15e34b54a5ad59d<wbr />9aeb0284cc31453<wbr />eb43b60cf1<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Thu Oct 1 18:28:48 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Catch NotAuthenticated exception in import task</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If glance uses registry as data_api then it&#x27;s possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;that token may expire during image import task and Glance<br />
&nbsp;&nbsp;&nbsp;&nbsp;will have NotUauthenticated exception.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This code adds a correct handling of this exception and<br />
&nbsp;&nbsp;&nbsp;&nbsp;allows Glance to remove stale chunks from store.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-Bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ia6e1fe0d27b13b<wbr />920ee7e728feb53<wbr />05dec77e066<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from ebdf076cc9bd5d9<wbr />239cdc96c6e7cec<wbr />c72f852bbb)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/229973
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=15e34b54a5ad59d9aeb0284cc31453eb43b60cf1
Submitter: Jenkins
Branch:    stable/kilo

commit 15e34b54a5ad59d9aeb0284cc31453eb43b60cf1
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Thu Oct 1 18:28:48 2015 +0300

    Catch NotAuthenticated exception in import task
    
    If glance uses registry as data_api then it's possible
    that token may expire during image import task and Glance
    will have NotUauthenticated exception.
    
    This code adds a correct handling of this exception and
    allows Glance to remove stale chunks from store.
    
    Partial-Bug: #1498163
    
    Change-Id: Ia6e1fe0d27b13b920ee7e728feb5305dec77e066
    (cherry picked from ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~tristan-cacqueray" class="sprite person">Tristan Cacqueray (tristan-cacqueray)</a>
    
    <time title="2015-10-05 14:04:04 UTC" datetime="2015-10-05T14:04:04.874198+00:00">on 2015-10-05</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Committed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2015-10-15 13:34:53 UTC" datetime="2015-10-15T13:34:53.174847+00:00">on 2015-10-15</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in glance: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        liberty-rc2 &#8594; 11.0.0
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/44" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-15T13:37:55.873370+00:00" title="2015-10-15 13:37:55 UTC">on 2015-10-15</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/44">
                <strong>Fix proposed to glance (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/44"> #44</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/235346">https:/<wbr />/review.<wbr />openstack.<wbr />org/235346</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.openstack.org/235346</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/glance/+bug/1498163/comments/45" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2015-10-23T12:50:14.656410+00:00" title="2015-10-23 12:50:14 UTC">on 2015-10-23</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/glance/+bug/1498163/comments/45">
                <strong>Fix merged to glance (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/glance/+bug/1498163/comments/45"> #45</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/glance/+bug/1498163/comments/45/+download">Download full text</a> (4.1 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/235346">https:/<wbr />/review.<wbr />openstack.<wbr />org/235346</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/glance/commit/?id=431fa95ecf92a9ebb7082f829c0a99f958363cc3">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />glance/<wbr />commit/<wbr />?id=431fa95ecf9<wbr />2a9ebb7082f829c<wbr />0a99f958363cc3</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit 69516fad5f651a0<wbr />85a047a337a05c5<wbr />8b39023c1b<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Mon Oct 12 15:34:54 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add &#x27;deactivated&#x27; status to image schema.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;New &#x27;deactivated&#x27; status was introduced in Kilo release,<br />
&nbsp;&nbsp;&nbsp;&nbsp;but it doesn&#x27;t listed in available image statuses in the schema.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;It leads to issues  on the client side, when it can&#x27;t validate<br />
&nbsp;&nbsp;&nbsp;&nbsp;the image with this status against the schema and returns the error.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I5ec264614ae7ec<wbr />f54b846ad060044<wbr />2a18c61d24c<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: #1505218<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-bug: #1505134</p>
<p>commit c5b6901527b8b4a<wbr />1250bdc179405c8<wbr />af66fbae7e<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Tue Oct 13 00:33:27 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Add testresources and testscenarios used by oslo.db fixture</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If we use oslo.db fixtures, we&#x27;ll need these 2 packages or<br />
&nbsp;&nbsp;&nbsp;&nbsp;the next version of oslo.db release will break us.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I7c0d2f6dabc20b<wbr />d4ff0d29d3b47b9<wbr />48aa24ea56b<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1503501</p>
<p>commit fc32f0554de0ba7<wbr />773d98e6828da15<wbr />7ca7c66002<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Sun Sep 20 17:01:22 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Cleanup chunks for deleted image if token expired</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;In patch I47229b366c2536<wbr />7ec1bd48aec684e<wbr />0880f3dfe60 it was<br />
&nbsp;&nbsp;&nbsp;&nbsp;introduced the logic that if image was deleted during file<br />
&nbsp;&nbsp;&nbsp;&nbsp;upload when we want to update image status from &#x27;saving&#x27;<br />
&nbsp;&nbsp;&nbsp;&nbsp;to &#x27;active&#x27; it&#x27;s expected to get Duplicate error and delete<br />
&nbsp;&nbsp;&nbsp;&nbsp;stale chunks after that. But if user&#x27;s token is expired<br />
&nbsp;&nbsp;&nbsp;&nbsp;there will be Unathorized exception and chunks will stay<br />
&nbsp;&nbsp;&nbsp;&nbsp;in store and clog it.<br />
&nbsp;&nbsp;&nbsp;&nbsp;And when, the upload operation for such an image is<br />
&nbsp;&nbsp;&nbsp;&nbsp;completed the operator configured quota can be exceeded.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patch fixes the issue of left over chunks for an image<br />
&nbsp;&nbsp;&nbsp;&nbsp;which was deleted from saving status, by correctly handle<br />
&nbsp;&nbsp;&nbsp;&nbsp;auth exceptions from registry server.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Partial-bug: #1498163</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I17a66eca55bfb8<wbr />3107046910e69c4<wbr />da01415deec</p>
<p>commit ca8d909a61ba335<wbr />805d8d17070230c<wbr />e9478a000d<br />
Author: Stuart McLaren &lt;email address hidden&gt;<br />
Date:   Wed Sep 30 16:54:12 2015 +0000</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Download forbidden when get_image_location is set.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;When using v2 an attempt to download an image would return a 403 if the<br />
&nbsp;&nbsp;&nbsp;&nbsp;get_<wbr />image_location policy was set.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Note: We had been returning both 404 and 204 when no data was<br />
&nbsp;&nbsp;&nbsp;&nbsp;available. There was no way to detect the 404 case without trying to<br />
&nbsp;&nbsp;&nbsp;&nbsp;access the image locations so I&#x27;ve standardized on 204.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I658b08a35d3a8c<wbr />b8a7096baf716cc<wbr />b3d6e7d9abf<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-bug: 1501672<br />
&nbsp;&nbsp;&nbsp;&nbsp;(cherry picked from commit b47f625443c3b46<wbr />483506926f31fee<wbr />42478705d4)</p>
<p>commit ebdf076cc9bd5d9<wbr />239cdc96c6e7cec<wbr />c72f852bbb<br />
Author: Mike Fedosin &lt;email address hidden&gt;<br />
Date:   Thu Oct 1 18:28:48 2015 +0300</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Catch NotAuthenticated exception in import task</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;If glance uses registry as data_api then it&#x27;s possible<br />
&nbsp;&nbsp;&nbsp;&nbsp;that token may expire during image import task and Glance<br />
&nbsp;&nbsp;&nbsp;&nbsp;will have NotUauthenticated exception.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This code adds...</p></div>
    
    <p>
      <a href="/glance/+bug/1498163/comments/45">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/235346
Committed: https://git.openstack.org/cgit/openstack/glance/commit/?id=431fa95ecf92a9ebb7082f829c0a99f958363cc3
Submitter: Jenkins
Branch:    master

commit 69516fad5f651a085a047a337a05c58b39023c1b
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Mon Oct 12 15:34:54 2015 +0300

    Add 'deactivated' status to image schema.
    
    New 'deactivated' status was introduced in Kilo release,
    but it doesn't listed in available image statuses in the schema.
    
    It leads to issues  on the client side, when it can't validate
    the image with this status against the schema and returns the error.
    
    Change-Id: I5ec264614ae7ecf54b846ad0600442a18c61d24c
    Closes-bug: #1505218
    Related-bug: #1505134

commit c5b6901527b8b4a1250bdc179405c8af66fbae7e
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Tue Oct 13 00:33:27 2015 +0300

    Add testresources and testscenarios used by oslo.db fixture
    
    If we use oslo.db fixtures, we'll need these 2 packages or
    the next version of oslo.db release will break us.
    
    Change-Id: I7c0d2f6dabc20bd4ff0d29d3b47b948aa24ea56b
    Closes-Bug: #1503501

commit fc32f0554de0ba7773d98e6828da157ca7c66002
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Sun Sep 20 17:01:22 2015 +0300

    Cleanup chunks for deleted image if token expired
    
    In patch I47229b366c25367ec1bd48aec684e0880f3dfe60 it was
    introduced the logic that if image was deleted during file
    upload when we want to update image status from 'saving'
    to 'active' it's expected to get Duplicate error and delete
    stale chunks after that. But if user's token is expired
    there will be Unathorized exception and chunks will stay
    in store and clog it.
    And when, the upload operation for such an image is
    completed the operator configured quota can be exceeded.
    
    This patch fixes the issue of left over chunks for an image
    which was deleted from saving status, by correctly handle
    auth exceptions from registry server.
    
    Partial-bug: #1498163
    
    Change-Id: I17a66eca55bfb83107046910e69c4da01415deec

commit ca8d909a61ba335805d8d17070230ce9478a000d
Author: Stuart McLaren &lt;stuart.mclaren@hp.com&gt;
Date:   Wed Sep 30 16:54:12 2015 +0000

    Download forbidden when get_image_location is set.
    
    When using v2 an attempt to download an image would return a 403 if the
    get_image_location policy was set.
    
    Note: We had been returning both 404 and 204 when no data was
    available. There was no way to detect the 404 case without trying to
    access the image locations so I've standardized on 204.
    
    Change-Id: I658b08a35d3a8cb8a7096baf716ccb3d6e7d9abf
    Closes-bug: 1501672
    (cherry picked from commit b47f625443c3b46483506926f31fee42478705d4)

commit ebdf076cc9bd5d9239cdc96c6e7cecc72f852bbb
Author: Mike Fedosin &lt;mfedosin@mirantis.com&gt;
Date:   Thu Oct 1 18:28:48 2015 +0300

    Catch NotAuthenticated exception in import task
    
    If glance uses registry as data_api then it's possible
    that token may expire during image import task and Glance
    will have NotUauthenticated exception.
    
    This code adds a correct handling of this exception and
    allows Glance to remove stale chunks from store.
    
    Partial-Bug: #1498163
    
    Change-Id: Ia6e1fe0d27b13b920ee7e728feb5305dec77e066

commit 0cc46f4456449186d140b7e5d9c46e08acf181a5
Author: OpenStack Proposal Bot &lt;openstack-infra@lists.openstack.org&gt;
Date:   Thu Oct 1 06:10:45 2015 +0000

    Imported Translations from Zanata
    
    For more information about this automatic import see:
    https://wiki.openstack.org/wiki/Translations/Infrastructure
    
    Change-Id: I2646de236abc7576bf99e5fe1c415a04a647fad8

commit b7fb5bf0f89f657ead98024ee0168f2c2fa7a776
Author: Erno Kuvaja &lt;jokke@usr.fi&gt;
Date:   Mon Sep 28 10:44:38 2015 +0000

    Return missing authtoken options
    
    Example configs were missing keystone_authtoken section after moving
    to generated config files. This change returns that to generation.
    
    Closes-Bug: #1500361
    
    Change-Id: I6ee82c38061d483cea7254d155d9a72436880e84
    (cherry picked from commit b1d2d938d282ccd51986e57a638f8ea5bec56b0f)
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/glance/+bug/1498163/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/glance/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/glance/+bug/1498163/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/glance/+bug/1498163/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/glance/+bug/1498163/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/glance/+bug/1498163/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/glance/+bug/1498163/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/glance/+bug/1498163/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470672/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch">Patch for master</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4470672">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4471488/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch">Patch with fixed tasks</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4471488">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472005/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-master">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-master</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4472005">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472008/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-juno">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-juno</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4472008">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/glance/+bug/1498163/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470670/+files/test_images.py">exploit for v1</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4470670">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4470671/+files/test_images_v2.py">exploit for v2</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4470671">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/glance/+bug/1498163/+attachment/4472007/+files/0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-kilo">0001-Cleanup-chunks-for-deleted-image-if-token-expired.patch-kilo</a>
        <small>
          (<a href="/glance/+bug/1498163/+attachment/4472007">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/glance/+bug/1498163/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"bug_is_private": false, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1498163", "web_link": "https://bugs.launchpad.net/bugs/1498163", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1498163, "private": false, "information_type": "Public Security", "name": null, "title": "[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)", "description": "About a year ago it was a vulnerability called 'Glance user storage quota bypass': https://security.openstack.org/ossa/OSSA-2015-003.html, where any user could overcome the quota and clog up the storage.\nThe fix was proposed in master and all other stable branches, but it turned out, that it doesn't completely remove the issue and any user still can exceed the quota.\n\nIt happens in case if user token is expired during file upload and when glance tries to update image status from 'saving' to 'active'. Then glance gets Unauthenticated exception from registry server and fails with 500 error. On the other side garbage file is left in storage.\n\nSteps to reproduce mostly coincide with the related from the previous bug, but in general it is:\n1. Set some value (like 1Gb) to user_storage_quota in glance-api.conf and restart the server.\n2. Make sure that your token will expire soon, when you'll be able to create an image instance in DB and begin the upload, but the token will expire during it.\n3. Create an image, begin the upload and quickly remove the image with 'glance image-delete'.\n4. After the upload check that image is not in the list, i.e. it's deleted, and file is still located in the store.\n5. Perform steps 2-4 several times to make sure that user quota is exceeded.\n\nRelated script (test_images.py from here https://bugs.launchpad.net/glance/+bug/1398830) works fine, too, but it's better to reduce token life time in keystone config to 1 or 2 minutes, just for not to wait for one hour.\n\nGlance api v2 is affected as well, but only if registry db_api is enabled.", "owner_link": "https://bugs.launchpad.net/api/devel/~mfedosin", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/bug_tasks", "duplicate_of_link": null, "date_created": "2015-09-21T19:46:58.678681+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/subscriptions", "date_last_updated": "2016-01-21T23:12:57.114308+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 260, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/attachments", "security_related": true, "latest_patch_uploaded": "2015-09-23T06:44:01.375452+00:00", "tags": ["in-stable-juno", "in-stable-kilo", "in-stable-liberty", "kilo-backport-potential", "liberty-rc-potential"], "date_last_message": "2015-10-23T12:50:14.656410+00:00", "number_of_duplicates": 0, "message_count": 46, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1498163/linked_merge_proposals", "http_etag": "\"72446a928bc53a3cfb549280e594e3329c8c1645-6d857d623a46ee069fb2d8ca7547e27463d72b02\""}, "total_comments_and_activity": 91, "related_features": {}, "information_type_data": {"PUBLIC": {"is_private": false, "name": "Public", "order": 0, "description": "Everyone can see this information.\n", "value": "PUBLIC", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"is_private": true, "name": "Private Security", "order": 2, "description": "Only the security group can see this information.\n ", "value": "PRIVATESECURITY", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"is_private": false, "name": "Public Security", "order": 1, "description": "Everyone can see this security related information.\n", "value": "PUBLICSECURITY", "description_css_class": "choice-description"}, "USERDATA": {"is_private": true, "name": "Private", "order": 3, "description": "Only shared with users permitted to see private user information.\n", "value": "USERDATA", "description_css_class": "choice-description"}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/glance/+bug/1498163", "web_link": "https://bugs.launchpad.net/glance/+bug/1498163", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1498163", "milestone_link": "https://bugs.launchpad.net/api/devel/glance/+milestone/11.0.0", "status": "Fix Released", "importance": "Critical", "assignee_link": "https://bugs.launchpad.net/api/devel/~mfedosin", "bug_target_display_name": "Glance", "bug_target_name": "glance", "bug_watch_link": null, "date_assigned": "2015-09-21T20:00:36.535774+00:00", "date_created": "2015-09-21T19:46:58.678681+00:00", "date_confirmed": "2015-09-21T19:52:19.967721+00:00", "date_incomplete": null, "date_in_progress": "2015-10-01T15:18:45.267776+00:00", "date_closed": "2015-10-03T12:48:15.283511+00:00", "date_left_new": "2015-09-21T19:52:19.967721+00:00", "date_triaged": "2015-09-21T19:52:19.967721+00:00", "date_fix_committed": "2015-10-02T21:41:58.218989+00:00", "date_fix_released": "2015-10-03T12:48:15.283511+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~mfedosin", "target_link": "https://bugs.launchpad.net/api/devel/glance", "title": "Bug #1498163 in Glance: \"[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/glance/+bug/1498163/related_tasks", "is_complete": true, "http_etag": "\"a520c210bf49e5fafe95cb83d35654dabda9fc0c-b4310c67120e5fed1a04c9a289453ac14e9e0b5d\""}, "bugtask_data": {"1982896": {"delete_link": "https://bugs.launchpad.net/glance/kilo/+bug/1498163/+delete", "bug_title": "[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)", "user_can_unassign": false, "importance_value": "Undecided", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary1982896", "target_is_product": false, "user_can_edit_milestone": false, "prefix": "glance_kilo", "bugtask_path": "/glance/kilo/+bug/1498163", "id": 1982896, "milestone_value": "https://bugs.launchpad.net/api/devel/glance/+milestone/2015.1.3", "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task1982896", "targetname": "Glance kilo", "assignee_is_team": null, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": null, "status_value": "Fix Released"}, "1909786": {"delete_link": "https://bugs.launchpad.net/glance/+bug/1498163/+delete", "bug_title": "[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)", "user_can_unassign": false, "importance_value": "Critical", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary1909786", "target_is_product": true, "user_can_edit_milestone": false, "prefix": "glance", "bugtask_path": "/glance/+bug/1498163", "id": 1909786, "milestone_value": "https://bugs.launchpad.net/api/devel/glance/+milestone/11.0.0", "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task1909786", "targetname": "Glance", "assignee_is_team": false, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": "mfedosin", "status_value": "Fix Released"}, "1909790": {"delete_link": "https://bugs.launchpad.net/ossa/+bug/1498163/+delete", "bug_title": "[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)", "user_can_unassign": false, "importance_value": "Undecided", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary1909790", "target_is_product": true, "user_can_edit_milestone": false, "prefix": "ossa", "bugtask_path": "/ossa/+bug/1498163", "id": 1909790, "milestone_value": null, "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task1909790", "targetname": "OpenStack Security Advisory", "assignee_is_team": false, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": "tristan-cacqueray", "status_value": "Fix Released"}, "1945071": {"delete_link": "https://bugs.launchpad.net/glance/juno/+bug/1498163/+delete", "bug_title": "[OSSA 2015-020] Glance storage quota bypass when token is expired (CVE-2015-5286)", "user_can_unassign": false, "importance_value": "Undecided", "user_can_edit_importance": false, "assignee_vocabulary": "AllUserTeamsParticipation", "hide_assignee_team_selection": true, "user_can_edit_status": true, "user_can_delete": false, "row_id": "tasksummary1945071", "target_is_product": false, "user_can_edit_milestone": false, "prefix": "glance_juno", "bugtask_path": "/glance/juno/+bug/1498163", "id": 1945071, "milestone_value": "https://bugs.launchpad.net/api/devel/glance/+milestone/2014.2.4", "status_widget_items": "[]", "milestone_widget_items": "[]", "form_row_id": "task1945071", "targetname": "Glance juno", "assignee_is_team": null, "assignee_vocabulary_filters": [], "user_can_edit_assignee": false, "importance_widget_items": "[]", "assignee_value": null, "status_value": "Fix Released"}}, "subscribers_portlet_url_data": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1498163", "web_link": "https://bugs.launchpad.net/bugs/1498163"}, "initial_comment_batch_offset": 41, "first visible_recent_comment": 5};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 64 queries/external actions issued in 1.97 seconds

    Features: {'app.maintenance_message': None, 'hard_timeout': '9000', 'js.yui_version': None, 'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'baselayout.careers_link.disabled': None, 'bugs.affected_count_includes_dupes.disabled': None, 'visible_render_time': None, 'profiling.enabled': None, 'bugs.nominations.bug_supervisors_can_target': 'on'}

    r0d8de2b

    -->

</html>

