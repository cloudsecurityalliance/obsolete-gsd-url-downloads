<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 770143 – CVE-2016-6855 out-of-bounds write in eog 3.10.2</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=770143&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=770143" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 770143 – CVE-2016-6855 out-of-bounds write in eog 3.10.2",  
                             "show_bug.cgi?id=770143" );
        document.title = "Bug 770143 – CVE-2016-6855 out-of-bounds write in eog 3.10.2";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 770143 – CVE-2016-6855 out-of-bounds write in eog 3.10.2", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_eog bz_component_image_viewer bz_bug_770143 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 770143</p>
</td>
<td id="subtitle">
<p class="subheader">CVE-2016-6855 out-of-bounds write in eog 3.10.2</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2016-08-23 12:52:24 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2016-08-23 12:52:24"/>
<input name="longdesclength" type="hidden" value="7"/>
<input name="id" type="hidden" value="770143"/>
<input name="token" type="hidden" value="1626088667-wd2N7HAe6msHxfMl_zykDKEMr3bTrJZxVUwXGZcgWqE"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=770143"><b>Bug 770143</b></a> -<span class="bz_default_hidden" id="summary_alias_container">
<span id="short_desc_nonedit_display">CVE-2016-6855 out-of-bounds write in eog 3.10.2</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">
</td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>CVE-2016-6855 out-of-bounds write in eog 3.10.2
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('CVE-2016-6855 out-of-bounds write in eog 3.10.2', '');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">eog</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Core</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=eog" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">image viewer</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>3.10.x
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       Linux
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       normal
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>---
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard"><span class="fn">EOG Maintainers</span>
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard"><span class="fn">EOG Maintainers</span>
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'eog-maint\x40gnome.bugs',
        'eog-maint\x40gnome.bugs');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2016-08-19 12:54 UTC by <span class="vcard"><span class="fn">kaslovdmitri</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2016-08-23 12:52 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">---</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_image_svg+xml" id="a1">
<td valign="top">
<a href="attachment.cgi?id=333622" title="View the content of the attachment">
<b>The image open crashes eog 3.10.2 on Ubuntu 14.04 64-bit</b></a>
<span class="bz_attach_extra_info">
              (4.39 KB,
                image/svg+xml)

            <br/>
<a href="#attach_333622" title="Go to the comment associated with the attachment">2016-08-19 12:54 UTC</a>,

            <span class="vcard"><span class="fn">kaslovdmitri</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">
             
          </td>
<td valign="top">
<a href="attachment.cgi?id=333622&amp;action=edit">Details</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a2">
<td valign="top">
<a href="attachment.cgi?id=333820" title="View the content of the attachment">
<b>reference patch</b></a>
<span class="bz_attach_extra_info">
              (1.63 KB,
                patch)

            <br/>
<a href="#attach_333820" title="Go to the comment associated with the attachment">2016-08-21 14:25 UTC</a>,

            <span class="vcard"><span class="fn">Felix Riemann</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=333820&amp;action=edit">Details</a>  |
    <a href="review?bug=770143&amp;attachment=333820">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">kaslovdmitri</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-19 12:54:55 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=333622" name="attach_333622" title="The image open crashes eog 3.10.2 on Ubuntu 14.04 64-bit">attachment 333622</a> <a href="attachment.cgi?id=333622&amp;action=edit" title="The image open crashes eog 3.10.2 on Ubuntu 14.04 64-bit">[details]</a></span>
The image open crashes eog 3.10.2 on Ubuntu 14.04 64-bit

A specially craft .svg file causes eog to crash. Find the crash info below and the POC attached.


Program Counter	0x7ffff43d0540
Crash hash	540???
Crash instruction	7ffff43d0540 movzx eax, byte ptr [rbx]
Process	PID: 11652
Registers	

    r14  : 007efd20 '\x10\x90I\xe3\xff\x7f\x00\x00\xed%\x05\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
    r15  : 7ffff443c7c0 '\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01\x01'
    r12  : 7ffff4419e84 'lg\xfb\xff\x84g\xfb\xff\x84g\xfb\xff\x84g\xfb\xffTg\xfb\xff&lt;g\xfb\xff\x84g\xfb\xff\x84g\xfb\xff'
    r13  : 00a9a8a9 'X\x003\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x90\x00\x00\x00\x00\x00\x00\x1c\xa1'
    r10  : 0000153f
    r11  : 00000000
    es   : 00000000
    r8   : 00000002
    rdx  : 00000000
    rdi  : 7fffe3499010 'Error domain 1 code 73 on line 1'
    rcx  : 00000001
    rsi  : 00000001
    rsp  : 7fffffffd840 '\x00\xfc~\x00\x00\x00\x00\x00@\xf6~\x00\x00\x00\x00\x00`\xe4~\x00\x00\x00\x00\x00@\xa8\xa9\x00\x00\x00\x00\x00'
    rbx  : 00ae5000
    rbp  : 00ae5000
    rip  : 7ffff43d0540 '\x0f\xb6\x03\x0f\xb6\xd0\x83\xe8"I\x0f\xbe,\x17H\x01\xdd&lt;\x1c\x0f\x87\xaf\x00\x00\x00\x0f\xb6\xc0Ic\x04\x84'
    r9   : 00000073
    rax  : 007efd20 '\x10\x90I\xe3\xff\x7f\x00\x00\xed%\x05\x00\x00\x00\x00\x00\x00\x00\x08\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'
    eflags: 00010287
    

Stack trace	
Address	Module
0x7ffff43d0540	
Disassembly	
0x7ffff43d052c movabs al, byte ptr [0x994d258d4c002b8a] 
0x7ffff43d0535 add al, 0 
0x7ffff43d0537 mov r15, qword ptr [rax] 
0x7ffff43d053a nop word ptr [rax + rax] 
0x7ffff43d0540 movzx eax, byte ptr [rbx]     &lt;---- CRASH 
0x7ffff43d0543 movzx edx, al 
0x7ffff43d0546 sub eax, 0x22 
0x7ffff43d0549 movsx rbp, byte ptr [r15 + rdx] 
0x7ffff43d054e add rbp, rbx 
0x7ffff43d0551 cmp al, 0x1c 
0x7ffff43d0553 .byte 0x0f 


Valgrind output:'

==29915== Process terminating with default action of signal 11 (SIGSEGV)
==29915==  Access not within mapped region at address 0x1C4E600C
==29915==    at 0x85D3540: g_markup_escape_text (in /lib/x86_64-linux-gnu/libglib-2.0.so.0.4002.0)
==29915==    by 0x85D3882: g_markup_vprintf_escaped (in /lib/x86_64-linux-gnu/libglib-2.0.so.0.4002.0)
==29915==    by 0x85D39DB: g_markup_printf_escaped (in /lib/x86_64-linux-gnu/libglib-2.0.so.0.4002.0)
==29915==    by 0x43F285: ??? (in /usr/bin/eog)
==29915==    by 0x43F48C: ??? (in /usr/bin/eog)
==29915==    by 0x4367D0: ??? (in /usr/bin/eog)
==29915==    by 0x83455E6: ??? (in /usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0.4002.0)
==29915==    by 0x835E087: g_signal_emit_valist (in /usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0.4002.0)
==29915==    by 0x835ECE1: g_signal_emit (in /usr/lib/x86_64-linux-gnu/libgobject-2.0.so.0.4002.0)
==29915==    by 0x425E9B: ??? (in /usr/bin/eog)
==29915==    by 0x85CECE4: g_main_context_dispatch (in /lib/x86_64-linux-gnu/libglib-2.0.so.0.4002.0)
==29915==    by 0x85CF047: ??? (in /lib/x86_64-linux-gnu/libglib-2.0.so.0.4002.0)</pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">André Klapper</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-20 19:48:02 UTC
        </span>
</div>
<pre class="bz_comment_text">Using eog-3.20.3-1.fc24.x86_64, I get no crash but the following output:


(eog:3744): GLib-WARNING **: GError set over the top of a previous GError or uninitialized memory.
This indicates a bug in someone's code. You must ensure an error is NULL before it's set.
The overwriting error message was: Error domain 1 code 73 on line 1 column 4 of file:///home/user/crashEOG.svg: Couldn't find end of Start Tag \xf4

(eog:3744): Gtk-WARNING **: Failed to set text '&lt;small&gt;Error domain 1 code 73 on line 1 column 4 of file:///home/user/crashEOG.svg: Couldn&amp;apos;t find end of Start Tag \xf4
X&lt;/small&gt;' from markup due to error parsing markup: Error on line 2 char 3: Invalid UTF-8 encoded text in name - not valid 'Error domain 1 code 73 on line 1 column 4 of file:///home/user/crashEOG.svg: Couldn't find end of Start Tag \xf4
X'

(eog:3744): Pango-WARNING **: Invalid UTF-8 string passed to pango_layout_set_text()</pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Felix Riemann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-21 11:00:48 UTC
        </span>
</div>
<pre class="bz_comment_text">Okay, there's probably two things here.

1. Overwriting the error is a problem in eog which doesn't watch out to overwrite the previous (identical) error when closing the handle. This is should be a simple fix as we already do the same for gdk-pixbuf-decoded images. The problem shouldn't cause any problems besides the leaked error though.

2. The second problem, the crash in GMarkup, seems to be caused by the non-UTF8 character in the error message. This was apparently a weakness glib seems to have been hardened against (<a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=631597" title="RESOLVED NOTGNOME - Segmentation fault in append_escaped_text">bug 631597</a>) since 2.44.1 (GNOME 3.16) so it's not segfaultin anymore on recent distros. I'll try to verify this. 

Although it's a problem in older glib versions I'm not saying it's a bug but a weakness in glib as eog is actually passing unsupported data to GMarkup (which is UTF8-only) here. I'll see if eog's UTF8 sanitizing code can be applied here.</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Felix Riemann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-21 13:11:38 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to Felix Riemann from <a href="show_bug.cgi?id=770143#c2">comment #2</a>)
<span class="quote">&gt; Okay, there's probably two things here.
&gt; 
&gt; 1. Overwriting the error is a problem in eog which doesn't watch out to
&gt; overwrite the previous (identical) error when closing the handle. This is
&gt; should be a simple fix as we already do the same for gdk-pixbuf-decoded
&gt; images. The problem shouldn't cause any problems besides the leaked error
&gt; though.</span>

I split that bug off into <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=770197" title="RESOLVED FIXED - eog leaks error message if loading an SVG fails">bug 770197</a>.</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Felix Riemann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-21 14:21:19 UTC
        </span>
</div>
<pre class="bz_comment_text">So, this is indeed as I thought in <a href="show_bug.cgi?id=770143#c2">comment 2</a>.

GMarkup in glib pre-2.44.1 could cause this out-of-bounds access if given invalid input (<a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=631597" title="RESOLVED NOTGNOME - Segmentation fault in append_escaped_text">bug 631597</a>). eog triggered this by passing invalid UTF8 to GMarkup.
I patched eog now to make sure the error messages in the ErrorMessageArea are valid UTF8.  This also avoids the broken markup when using newer glib versions that wouldn't crash anymore.

I'll do new eog-3.18 and 3.20 releases and possibly also a 3.16 tarball containing this fix. I won't prepare older releases for now though as the demand for those should rather small and LTS distros in my experience tend to prefer cherry-picking patches over newer tarballs anyway.

Thanks for reporting this.

commit <a href="https://git.gnome.org/browse/eog/commit/?id=e99a8c00f959652fe7c10e2fa5a3a7a5c25e6af4">e99a8c00f959652fe7c10e2fa5a3a7a5c25e6af4</a>
Author: Felix Riemann &lt;&gt;
Date:   Sun Aug 21 15:56:46 2016 +0200

    EogErrorMessageArea: Make sure error messages are valid UTF8
    
    GMarkup requires valid UTF8 input strings and would cause odd
    looking messages if given invalid input. This could also trigger an
    out-of-bounds write in glib before 2.44.1. Reported by kaslovdmitri.
    
    <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=770143" title="RESOLVED FIXED - CVE-2016-6855 out-of-bounds write in eog 3.10.2">https://bugzilla.gnome.org/show_bug.cgi?id=770143</a>
---
This problem has been fixed in our software repository. The fix will go into the next software release. Once that release is available, you may want to check for a software upgrade provided by your Linux distribution.</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Felix Riemann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-21 14:25:50 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=333820" name="attach_333820" title="reference patch">attachment 333820</a> <a href="attachment.cgi?id=333820&amp;action=edit" title="reference patch">[details]</a></span> <a href="review?bug=770143&amp;attachment=333820">[review]</a>
reference patch

Attaching the patch for easier reference and cherry-picking.</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=770143#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">kaslovdmitri</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2016-08-23 12:52:24 UTC
        </span>
</div>
<pre class="bz_comment_text">You patched this way sooner than I anticipated.
It was a pleasure reporting this</pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=eog">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=770143&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=770143" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=770143&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626088667-kNio1ceysRa3kz8VscddXmcT4yXfZmfMpJNiCrOwYjs"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>