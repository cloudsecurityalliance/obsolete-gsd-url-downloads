
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>
Issue 36462: CVE-2019-9674 : zip bomb vulnerability in Lib/zipfile.py - Python tracker

</title>
<link rel="shortcut icon" href="@@file/favicon.ico" />
<link rel="stylesheet" type="text/css" href="@@file/main.css" />
<link rel="stylesheet" type="text/css" href="@@file/style.css" />
<link rel="search" type="application/opensearchdescription+xml" href="@@file/osd.xml" title="Python bug tracker search" />
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script nonce="2777ed5d6ced64e031b73f5acf043a3d05c3dc8723729bdd934c583ef4f47034" type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        return false;
    }
    submitted = true;
    return true;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://bugs.python.org/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
    HelpWin.focus ()
}
</script>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.js"></script>
<script type="text/javascript" src="@@file/issue.item.js"></script>
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/smoothness/jquery-ui.css" />


</head>
<body>
  <!--  Logo  -->
  <h1 id="logoheader">
    <a accesskey="1" href="." id="logolink">
       <img src="@@file/python-logo.gif" alt="homepage" border="0" id="logo" /></a>
  </h1>

<div id="utility-menu">
<!-- Search Box -->
<div id="searchbox">
    <form name="searchform" method="get" action="issue" id="searchform">
      <div id="search">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignee,status,type" />
       <input type="hidden" name="@sort" value="-activity" />
       <input type="hidden" name="@filter" value="status" />
       <input type="hidden" name="@action" value="searchid" />
       <input type="hidden" name="ignore" value="file:content" />
       <input class="input-text" id="search-text"
              name="@search_text" size="10" />
       <input type="submit" id="submit" value="search" name="submit" class="input-button" />
       <input type="radio" name="status"
              id="status_notresolved" value="-1,1,3" />
       <label for="status_notresolved">open</label>
       <input type="radio" name="status" checked="checked"
              id="status_all" value="-1,1,2,3" />
       <label for="status_all">all</label>
      </div>
     </form>
</div>
</div>


<div id="left-hand-navigation">
<!--  Main Menu NEED LEVEL TWO HEADER AND FOOTER -->
<div id="menu">
  <ul class="level-one">
    <li><a href="https://www.python.org/" title="Go to the Python homepage">Python Home</a></li>
    <li><a href="https://www.python.org/about/" title="About The Python Language">About</a></li>
    <li><a href="https://www.python.org/blogs/" title="">News</a></li>
    <li><a href="https://www.python.org/doc/" title="">Documentation</a></li>
    <li><a href="https://www.python.org/downloads/" title="">Downloads</a></li>
    <li><a href="https://www.python.org/community/" title="">Community</a></li>
    <li><a href="https://www.python.org/psf/" title="Python Software Foundation">Foundation</a></li>
    <li><a href="https://devguide.python.org/" title="Python Developer's Guide">Developer's Guide</a></li>
    <li class="selected"><a href="." class="selected" title="Python Issue Tracker">Issue Tracker</a>
      <ul class="level-two">
        <li>
          <strong>Issues</strong>
          <ul class="level-three">
            
            <li><a href="issue?@template=search&amp;status=1">Search</a></li>
            <li><a href="issue?@action=random">Random Issue</a></li>
            <li>
              <form method="post" action="issue36462">
                <input type="submit" class="form-small"
                       value="Show issue:" />
                <input class="form-small" size="4" type="text" name="@number" />
                <input type="hidden" name="@type" value="issue" />
                <input type="hidden" name="@action" value="show" />
              </form>
            </li>
          </ul>
        </li>


        <li>
          <strong>Summaries</strong>
          <ul class="level-three">
            

            

            

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Issues%20with%20patch&amp;@startwith=0&amp;@group=priority&amp;keywords=2&amp;@action=search&amp;@filter=&amp;@pagesize=50">Issues with patch</a>
            </li>

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Easy%20issues&amp;@startwith=0&amp;@group=priority&amp;keywords=6&amp;@action=search&amp;@filter=&amp;@pagesize=50">Easy issues</a>
            </li>

            <li>
              <a href="issue?@template=stats">Stats</a>
            </li>

          </ul>
        </li>


        <li>
          <strong>User</strong>
          <form method="post" action="issue36462">
          <ul class="level-three">
            <li>
                Login&nbsp;(OpenID&nbsp;possible)<br />
	         <a style="display:inline;width:0;margin:0"
             href="issue36462?@action=oic_login&amp;provider=Google">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.google.com/favicon.ico"
                       alt="Google" title="Google" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue36462?@action=oic_login&amp;provider=GitHub">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.github.com/favicon.ico"
                       alt="GitHub" title="GitHub" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue36462?@action=openid_login&amp;provider=Launchpad">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://launchpad.net/favicon.ico"
                       alt="Launchpad" title="Launchpad" /></a>
                <input size="10" name="openid_identifier" style="background:url(@@file/openid-16x16.gif)
                  center left no-repeat;padding-left:16px" /><br />
                <input size="10" type="password" name="__login_password" /><br />
                <input type="hidden" name="@action" value="Login" />
                <input type="checkbox" name="remember" id="remember" />
                <label for="remember">Remember me?</label><br />
                <input class="form-small" type="submit"
                       value="Login" /><br />
                <input type="hidden" name="__came_from"
                       value="https://bugs.python.org/issue36462?">
                
                <input type="hidden" name="@sort" value=""/>
<input type="hidden" name="@group" value=""/>
<input type="hidden" name="@pagesize" value="50"/>
<input type="hidden" name="@startwith" value="0"/>
            </li>
            <li>
                <a href="user?@template=register">Register</a>
            </li>
            <li><a href="user?@template=forgotten">Lost&nbsp;your&nbsp;login?</a></li>
          </ul>
          </form>
        </li>

        

        

        <li>
          <strong>Administration</strong>
          <ul class="level-three">
            
            <li>
                <a href="user?@sort=username">User List</a></li>
            <li>
                <a href="user?iscommitter=1&amp;@action=search&amp;@sort=username&amp;@pagesize=300">Committer List</a></li>
            
            
            
          </ul>
        </li>

        <li>
          <strong>Help</strong>
          <ul class="level-three">
            <li><a href="http://docs.python.org/devguide/triaging.html">
                Tracker Documentation</a></li>
            <li><a href="http://wiki.python.org/moin/TrackerDevelopment">
                Tracker Development</a></li>
            <li><a href="https://github.com/python/psf-infra-meta/issues">
                Report Tracker Problem</a></li>
          </ul>
        </li>

      </ul>
    </li>
  </ul>
</div> <!-- menu -->
</div> <!-- left-hand-navigation -->

<div id="content-body">
<div id="body-main">
<div id="content">
<div id="breadcrumb">
 
 
 Issue36462
 
</div>
 
 





<div>

<form method="post" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue36462">

<fieldset><legend>classification</legend>
<table class="form">
<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#title" target="_blank">Title</a>:</th>
 
 <td colspan="3">
  <span>CVE-2019-9674 : zip bomb vulnerability in Lib/zipfile.py</span>
  <input type="hidden" name="title"
         value="CVE-2019-9674 : zip bomb vulnerability in Lib/zipfile.py">
 </td>
</tr>

<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#type" target="_blank">Type</a>:</th>
 <td>security</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#stage" target="_blank">Stage</a>:</th>
 <td>resolved</td>
</tr>

<tr>
 <th><a href="http://docs.python.org/devguide/triaging.html#components" target="_blank">Components</a>:</th>
 <td>Library (Lib)</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#versions" target="_blank">Versions</a>:</th>
 <td>Python 3.8, Python 3.7, Python 3.6, Python 3.5</td>
</tr>
</table>
</fieldset>

<fieldset><legend>process</legend>
<table class="form">
<tr>
  <th><a href="http://docs.python.org/devguide/triaging.html#status" target="_blank">Status</a>:</th>
  <td>closed</td>
  <th><a href="http://docs.python.org/devguide/triaging.html#resolution" target="_blank">Resolution</a>:</th>
  <td>duplicate</td>
</tr>

<tr>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#dependencies"
       target="_blank">Dependencies</a>:
 </th>
 <td>
  
  
 </td>
 <th><a href="http://docs.python.org/devguide/triaging.html#superseder" target="_blank">Superseder</a>:</th>
 <td>
  [security] CVE-2019-9674: Zip Bomb vulnerability
 <span>
<!--   <br><span i18n:translate="">View</span>:
     <a tal:repeat="sup context/superseder"
        tal:content="python:sup['id'] + ', '*(not repeat['sup'].end)"
        tal:attributes="href string:issue${sup/id}; title sup/title;"></a> -->
   <br>View:
     <a href="issue36260" class="closed"
        title="[security] CVE-2019-9674: Zip Bomb vulnerability">36260</a>
  </span>
 </td>
 </tr>
 <tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#assigned-to"
      target="_blank">Assigned To</a>:
 </th>
 
 <td>
  
 </td>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#nosy-list"
      target="_blank">Nosy List</a><!--
        <span tal:condition="context/nosy_count" tal:replace="python: ' (%d)' % context.nosy_count" /> -->:
 </th>
 <td>
     brett.cannon, krnick, serhiy.storchaka, twouters, xtreak
     
 </td>
</tr>
<tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#priority"
      target="_blank">Priority</a>:
 </th>
 <td>normal</td>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#keywords"
       target="_blank">Keywords</a>:
 </th>
 <td></td>


</tr>









</table>
</fieldset>

</form>

<p>Created on <strong>2019-03-28 15:46</strong> by <strong>krnick</strong>, last changed <strong>2019-03-29 00:03</strong> by <strong>krnick</strong>. This issue is now <strong style="color:#00F; background-color:inherit;">closed</strong>.</p>









<table class="messages">
 <tr><th colspan="4" class="header">Messages (7)</th></tr>
 
  <tr>
    <th>
     <a href="#msg339053" id="msg339053">msg339053</a> - <a
    href="msg339053">(view)</a></th>
   <th>Author: JUN-WEI SONG (krnick) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-03-28 15:46</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Dear Python Community, 

we found a python module vulnerability during these days and we got a CVE number, CVE-2019-9674 after reported it to cve.mitre.org.

<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9674">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9674</a>


The reserved information of CVE-2019-9674 is shown below:

	   [Description]

           <a href="https://github.com/python/cpython/blob/master/Lib/zipfile.py">Lib/zipfile.py</a> in Python through 3.7.2 allows remote 
           attackers to cause a denial of service (resource consumption) 
           via a ZIP bomb.


           [Additional Information]

           The python zipfile library version 3.2, 3.3, 3.4, 3.5, 3.6, 
           3.7, 3.8. Allow attackers to cause a denial of service (disk 
           volume exhaustion) via a ZIP bomb.


           We have found python standard library zipfile doesn't have 
           ZIP bomb detection and protection. If the user uses zipfile 
           library to unzip a ZIP bomb file, this might cause a denial 
           of service of the localhost.


          [VulnerabilityType Other]

          Denial-of-Service



Our proposed solutions:


    1.The compression ratio:

    Compression ratio = Uncompressed file size / Compressed file size

    Since ZIP bomb file has a higher compression ratio (1028) than 
    normal ZIP file (1 to 3). Therefore, we calculate the compression 
    ratio and set a threshold for the detection.

    2.Nested zip file

    There is a high chance that it is zip bomb if it is a nested zip 
    file. 

    3.By limiting resources such as CPU, memory, disk usage.


Unsolved issue

    However, we have not yet determined the compression ratio. We 
    temporarily set the compression ratio to 10, and if it exceeds, it 
    may be a ZIP bomb.

    It is likely that detection may misjudge nested compressed files. 
    For example, under normal circumstances, compressed files are 
    included in the zip file.


Our solution code：

"""For ratio"""

def _exam_ratio(self, threshold=10):
    """If the ratio exceeds threshold, it may be a ZIP Bomb."""
    sum_file_size = sum([data.file_size for data in self.filelist])
    sum_compress_size = sum([data.compress_size for data in self.filelist])
    ratio = sum_file_size / sum_compress_size
    if (ratio &gt; threshold):
        raise BadZipFile("Zip Bomb Detected")

"""For Nested zip file"""

if(members.filename.endswith(".zip")):
    raise BadZipFile("Nested Zip File Detected")


Thanks!</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339055" id="msg339055">msg339055</a> - <a
    href="msg339055">(view)</a></th>
   <th>Author: Serhiy Storchaka (serhiy.storchaka) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-28 16:16</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>I do not think that the library should limit the compression ratio. Large compression ratio is legit. For example, compressed file of size 1 GiB consisting of zeros has the compress ratio 1030 (and I suppose it is even larger if use bzip2 or lzma compressions).

If this is a problem for your program, your program should make a decision what ZIP files should be rejected.

I suggest to close this issue as "not a bug".</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339056" id="msg339056">msg339056</a> - <a
    href="msg339056">(view)</a></th>
   <th>Author: Karthikeyan Singaravelan (xtreak) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-28 16:38</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Going by CVE number and report is this a duplicate of <a class="closed" title="[closed] [security] CVE-2019-9674: Zip Bomb vulnerability" href="issue36260">issue36260</a> ?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339058" id="msg339058">msg339058</a> - <a
    href="msg339058">(view)</a></th>
   <th>Author: Brett Cannon (brett.cannon) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-28 16:43</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Closing as a duplicate of <a class="closed" title="[closed] [security] CVE-2019-9674: Zip Bomb vulnerability" href="issue36260">issue36260</a>.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339060" id="msg339060">msg339060</a> - <a
    href="msg339060">(view)</a></th>
   <th>Author: Karthikeyan Singaravelan (xtreak) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-28 16:54</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>I would request closing the other one as duplicate and opening this since this contains the actual report or perhaps the report could be copied to <a class="closed" title="[closed] [security] CVE-2019-9674: Zip Bomb vulnerability" href="issue36260">issue36260</a>. Since Serhiy suggested closing this as not a bug I will leave it to him on resolution of the other issue too.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339063" id="msg339063">msg339063</a> - <a
    href="msg339063">(view)</a></th>
   <th>Author: Brett Cannon (brett.cannon) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-28 17:36</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>You can also leave a comment in the other issue saying there's more details
in the closed duplicate.

On Thu, Mar 28, 2019 at 9:54 AM Karthikeyan Singaravelan &lt;
<a href="mailto:report@bugs.python.org">report@bugs.python.org</a>&gt; wrote:

&gt;
&gt; Karthikeyan Singaravelan &lt;<a href="mailto:tir.karthi@gmail.com">tir.karthi@gmail.com</a>&gt; added the comment:
&gt;
&gt; I would request closing the other one as duplicate and opening this since
&gt; this contains the actual report or perhaps the report could be copied to
&gt; <a class="closed" title="[closed] [security] CVE-2019-9674: Zip Bomb vulnerability" href="issue36260">issue36260</a>. Since Serhiy suggested closing this as not a bug I will leave
&gt; it to him on resolution of the other issue too.
&gt;
&gt; ----------
&gt;
&gt; _______________________________________
&gt; Python tracker &lt;<a href="mailto:report@bugs.python.org">report@bugs.python.org</a>&gt;
&gt; &lt;<a href="https://bugs.python.org/issue36462">https://bugs.python.org/issue36462</a>&gt;
&gt; _______________________________________
&gt;</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339085" id="msg339085">msg339085</a> - <a
    href="msg339085">(view)</a></th>
   <th>Author: JUN-WEI SONG (krnick) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-03-29 00:03</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Thanks to the python community, both of these issues are the same.

I also think it's a good thing to make related documentation to reduce this type of problem rather than implementing it on a low-level zipfile module. Perhaps we can customize such a requirement through a pip package.</pre>
   </td>
  </tr>
 
</table>

<table class="history table table-condensed table-striped"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2019-03-29&nbsp;00:03:09</td><td>krnick</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339085">msg339085</a></td></tr>
<tr><td>2019-03-28&nbsp;17:36:02</td><td>brett.cannon</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339063">msg339063</a></td></tr>
<tr><td>2019-03-28&nbsp;16:54:25</td><td>xtreak</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339060">msg339060</a></td></tr>
<tr><td>2019-03-28&nbsp;16:43:08</td><td>brett.cannon</td><td>set</td><td>status: open -> closed<br /><br />superseder: <a rel="nofollow" href="issue36260">[security] CVE-2019-9674: Zip Bomb vulnerability</a><br /><br />nosy:
  + <a rel="nofollow" href="user37">brett.cannon</a><br />messages:
  + <a rel="nofollow" href="msg339058">msg339058</a><br />resolution: duplicate<br />stage: resolved</td></tr>
<tr><td>2019-03-28&nbsp;16:38:25</td><td>xtreak</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user28746">xtreak</a><br />messages:
  + <a rel="nofollow" href="msg339056">msg339056</a><br /></td></tr>
<tr><td>2019-03-28&nbsp;16:16:59</td><td>serhiy.storchaka</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339055">msg339055</a></td></tr>
<tr><td>2019-03-28&nbsp;15:50:18</td><td>matrixise</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user14">twouters</a>, <a rel="nofollow" href="user15623">serhiy.storchaka</a><br /></td></tr>
<tr><td>2019-03-28&nbsp;15:46:11</td><td>krnick</td><td>create</td><td></td></tr>
</table>

</div>


</div> <!-- content-body -->
<div id="footer">
<div id="credits">
  Hosted on <a href="https://m.do.co/c/783434964889" title="Hosted on DigitalOcean">DigitalOcean</a>,
  <br>
  Supported by <a href="https://python.org/psf-landing/" title="The Python Software Foundation">The Python Software Foundation</a>,
  <br>
  Powered by <a href="http://roundup.sourceforge.net" title="Powered by the Roundup Issue Tracker">Roundup</a>
</div> <!-- credits -->
Copyright &copy; 1990-2020, <a href="http://python.org/psf">Python Software Foundation</a><br />
<a href="http://python.org/about/legal">Legal Statements</a>
</div> <!-- footer -->
</div> <!-- body-main -->
</div> <!-- content -->



</body>
</html>

