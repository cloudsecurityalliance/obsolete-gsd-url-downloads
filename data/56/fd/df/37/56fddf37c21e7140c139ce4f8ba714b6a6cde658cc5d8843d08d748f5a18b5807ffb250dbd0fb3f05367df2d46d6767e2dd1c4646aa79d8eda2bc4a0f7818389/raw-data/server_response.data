<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - wrong connect-only connection - CVE-2020-8231</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>wrong connect-only connection</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="libcurl-wrong-connect-only-connection">libcurl: wrong connect-only connection</h1>
<p>Project curl Security Advisory, August 19th 2020 - <a href="https://curl.se/docs/CVE-2020-8231.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>An application that performs multiple requests with libcurl's multi API and sets the <code><a href="https://curl.se/libcurl/c/CURLOPT_CONNECT_ONLY.html">CURLOPT_CONNECT_ONLY</a></code> option, might in rare circumstances experience that when subsequently using the setup connect-only transfer, libcurl will pick and use the wrong connection - and instead pick another one the application has created since then.</p>
<p><code><a href="https://curl.se/libcurl/c/CURLOPT_CONNECT_ONLY.html">CURLOPT_CONNECT_ONLY</a></code> is the option to tell libcurl to not perform an actual transfer, only connect. When that operation is completed, libcurl remembers which connection it used for that transfer and &quot;easy handle&quot;. It remembers the connection using a pointer to the internal <code>connectdata</code> struct in memory.</p>
<p>If more transfers are then done with the same multi handle before the connect-only connection is used, leading to the initial connect-only connection to get closed (for example due to idle time-out) while also new transfers (and connections) are setup, such a <em>new</em> connection might end up getting the exact same memory address as the now closed connect-only connection.</p>
<p>If after those operations, the application then wants to use the original transfer's connect-only setup to for example use <code>curl_easy_send()</code> to send raw data over that connection, libcurl could <strong>erroneously</strong> find an existing connection still being alive at the address it remembered since before even though this is now a new and different connection.</p>
<p>The application could then accidentally send data over that connection which wasn't at all intended for that recipient, entirely unknowingly.</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This bug has existed at least since commit <a href="https://github.com/curl/curl/commit/c43127414d">c43127414d</a>, first shipped in curl <a href="vuln-7.29.0.html">7.29.0</a>.</p>
<p>This flaw cannot trigger for users of the curl tool but only for applications using libcurl and the <code><a href="https://curl.se/libcurl/c/CURLOPT_CONNECT_ONLY.html">CURLOPT_CONNECT_ONLY</a></code> option.</p>
<p>The flaw only happens if the exact same memory address is re-used again for the new connection as for the original connect-only connection.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2020-8231 to this issue.</p>
<p>CWE-825: Expired Pointer Dereference</p>
<p>Severity: Low</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.29.0.html">7.29.0</a> to and including <a href="vuln-7.71.1.html">7.71.1</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.29.0.html">7.29.0</a> and libcurl &gt;= <a href="vuln-7.72.0.html">7.72.0</a></li>
</ul>
<h2 id="the-solution">THE SOLUTION</h2>
<p>A <a href="https://github.com/curl/curl/commit/3c9e021f86872baae412a427e807fbfa2f3e8">fix for CVE-2020-8231</a></p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade curl to version <a href="vuln-7.72.0.html">7.72.0</a></p>
<p>B - Apply the patch on your curl version and rebuild</p>
<p>C - Do not use <code><a href="https://curl.se/libcurl/c/CURLOPT_CONNECT_ONLY.html">CURLOPT_CONNECT_ONLY</a></code></p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was first reported to the curl project on July 31, 2020.</p>
<p>This advisory was posted on August 19th 2020.</p>
<h2 id="credits">CREDITS</h2>
<p>This issue was reported by Marc Aldorasi. Patched by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
