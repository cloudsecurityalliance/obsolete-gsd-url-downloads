<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - Partial password leak over DNS on HTTP redirect - CVE-2020-8169</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>Partial password leak over DNS on HTTP redirect</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="partial-password-leak-over-dns-on-http-redirect">Partial password leak over DNS on HTTP redirect</h1>
<p>Project curl Security Advisory, June 24th 2020 - <a href="https://curl.se/docs/CVE-2020-8169.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>libcurl can be tricked to prepend a part of the password to the host name before it resolves it, potentially leaking the partial password over the network and to the DNS server(s).</p>
<p>libcurl can be given a username and password for HTTP authentication when requesting an HTTP resource - used for HTTP Authentication such as Basic, Digest, NTLM and similar. The credentials are set, either together with <code><a href="https://curl.se/libcurl/c/CURLOPT_USERPWD.html">CURLOPT_USERPWD</a></code> or separately with <code><a href="https://curl.se/libcurl/c/CURLOPT_USERNAME.html">CURLOPT_USERNAME</a></code> and <code><a href="https://curl.se/libcurl/c/CURLOPT_PASSWORD.html">CURLOPT_PASSWORD</a></code>. Important detail: these strings are given to libcurl as plain C strings and they are not supposed to be URL encoded.</p>
<p>In addition, libcurl also allows the credentials to be set in the URL, using the standard RFC 3986 format: <code>http://user:password@host/path</code>. In this case, the name and password are URL encoded as that's how they appear in URLs.</p>
<p>If the options are set, they override the credentials set in the URL.</p>
<p>Internally, this is handled by storing the credentials in the &quot;URL object&quot; so that there is only a single set of credentials stored associated with this single URL.</p>
<p>When libcurl handles a relative redirect (as opposed to an absolute URL redirect) for an HTTP transfer, the server is only sending a new path to the client and that path is applied on to the existing URL. That &quot;applying&quot; of the relative path on top of an absolute URL is done by libcurl first generating a full absolute URL out of all the components it has, then it applies the redirect and finally it deconstructs the URL again into its separate components.</p>
<p>This security vulnerability originates in the fact that curl did not correctly URL encode the credential data when set using one of the <code>curl_easy_setopt</code> options described above. This made curl generate a badly formatted full URL when it would do a redirect and the final re-parsing of the URL would then go bad and wrongly consider a part of the password field to belong to the host name.</p>
<p>The wrong host name would then be used in a name resolve lookup, potentially leaking the host name + partial password in clear text over the network (if plain DNS was used) and in particular to the used DNS server(s).</p>
<p>The password leak is triggered if an at sign (<code>@</code>) is used in the password field, like this: <code>passw@rd123</code>. If we also consider a user <code>dan</code>, curl would generate a full URL like:</p>
<p><code>https://dan:passw@rd123@example.com/path</code></p>
<p>... while a correct one should have been:</p>
<p><code>https://dan:passw%40rd123@example.com/path</code></p>
<p>... when parsing the wrongly generated URL, libcurl would end up with user name <code>dan</code> and password <code>passw</code> talking to the host <code>rd123@example.com</code>. That bad host name would then be passed on to the name resolver function in use (and for all typical cases return a &quot;cannot resolve host name&quot; error).</p>
<p>There's no hint in the name resolve as to how large portion of the password that is actually prepended to the host name (ie an observer won't know how much data there was on the left side of the <code>@</code>), but it can of course be a significant enough clue for an attacker to figure out the rest.</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>Requirements to trigger this flaw.</p>
<ol>
<li>a password set with a <code>@</code> in it</li>
<li>an HTTP transfer</li>
<li>a <em>relative</em> redirect that curl follows (<code><a href="https://curl.se/libcurl/c/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a></code> enabled)</li>
</ol>
<p>This bug was brought in commit <a href="https://github.com/curl/curl/commit/46e164069d">46e164069d</a>, first shipped in curl <a href="vuln-7.62.0.html">7.62.0</a>.</p>
<p>This flaw can happen to users of the curl tool as well as for applications using libcurl.</p>
<p>This bug was reported and inadvertently fixed and pushed to the public source respository before anyone realized its security impact.</p>
<p>The effects of this flaw is somewhat reduced if DNS-over-HTTPS is used, since then at least the name won't be observable on the network by a passive by-stander but only by the DoH server.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2020-8169 to this issue.</p>
<p>CWE-200: Exposure of Sensitive Information to an Unauthorized Actor</p>
<p>Severity: 5.5 (Medium)</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.62.0.html">7.62.0</a> to and including <a href="vuln-7.70.0.html">7.70.0</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.62.0.html">7.62.0</a></li>
</ul>
<p>libcurl is used by many applications, but not always advertised as such.</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>A <a href="https://github.com/curl/curl/commit/600a8cded447cd">fix for CVE-2020-8169</a></p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade curl to version <a href="vuln-7.71.0.html">7.71.0</a></p>
<p>B - Apply the patch on your libcurl version and rebuild</p>
<p>C - Disable <code><a href="https://curl.se/libcurl/c/CURLOPT_FOLLOWLOCATION.html">CURLOPT_FOLLOWLOCATION</a></code> or redirects to HTTP(S).</p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was first reported to the curl project on May 14, 2020. The initial fix was done, verified and pushed to git on the same day. (As a regular non-security related fix.)</p>
<p>On May 15, 2020, the bug was reported again but then with the security impact highlighted.</p>
<p>This advisory was posted on June 24th 2020.</p>
<h2 id="credits">CREDITS</h2>
<p>The security issue was reported by Marek Szlagor. The initial bug report was done by Gregory Jefferis and Jeroen Ooms. Patched by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
