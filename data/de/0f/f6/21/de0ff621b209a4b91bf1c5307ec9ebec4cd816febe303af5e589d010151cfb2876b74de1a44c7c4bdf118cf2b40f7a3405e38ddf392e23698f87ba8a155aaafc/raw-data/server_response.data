<!DOCTYPE html>
<html lang="en">
  <head>
    <title>469888 &ndash; (CVE-2013-2100) &lt;sys-apps/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/1dee87cdc229fb032852e53a39a3c8b5.css?1635279638" rel="stylesheet" type="text/css">



    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1635279638"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "469888 – (CVE-2013-2100) \x3csys-apps\/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)",
                             "show_bug.cgi?id=469888" );
        document.title = "469888 – (CVE-2013-2100) \x3csys-apps\/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "469888 – (CVE-2013-2100) \x3csys-apps\/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1635279638"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Gentoo's Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico"><script language="JavaScript" src="extensions/Gentoo/web/gentoo.js"></script>
  </head>

  <body 
        class="bugs-gentoo-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_Gentoo_Security
                 bz_component_Vulnerabilities
                 bz_bug_469888 yui-skin-sam">
<div id="gentoo-bar">
	<a href="/" title="Go to the Gentoo Bugzilla homepage" class="home-link">
		<img src="extensions/Gentoo/web/gentoo_org.png" alt="Gentoo Websites Logo" />
	</a>

	<div>
		Go to: 
		<a href="https://www.gentoo.org/">Gentoo Home</a>
		<a href="https://www.gentoo.org/support/documentation/">Documentation</a>
		<a href="https://forums.gentoo.org/">Forums</a>
		<a href="https://www.gentoo.org/get-involved/mailing-lists/">Lists</a>
		<a href="/" class="active">Bugs</a>
		<a href="https://planet.gentoo.org/">Planet</a>
		<a href="https://www.gentoo.org/inside-gentoo/stores/">Store</a>
		<a href="https://wiki.gentoo.org/">Wiki</a>
		<strong><a href="https://www.gentoo.org/downloads/">Get Gentoo!</a></strong>
	</div>
</div>

  <div id="header"><div id="banner">
  </div>

    <div id="titles">
      <span id="title">Gentoo's Bugzilla &ndash; Bug&nbsp;469888</span>

        <span id="subtitle" class="subheader">&lt;sys-apps/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)</span>

        <span id="information" class="header_addl_info">Last modified: 2015-07-10 13:14:33 UTC node [gannet]</span>
    </div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=469888&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=469888" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=469888&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635619261-BTYkocfaTcOk5LbfSm2kpbRspXz5DFZ5PttcOYuZpBM">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>

  <div id="bugzilla-body"><!--<div style="border: 1px solid #ebccd1; background-color: #f2dede; color: #a94442; padding: 0.4em; margin-bottom: 0.4em;">critical goes here ...</div>-->
<!--<div id="message">
Bugzilla DB migration completed. Please report issues to Infra team via email via infra@gentoo.org or IRC
</div>-->


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2015-07-10 13:14:33">
  <input type="hidden" name="id" value="469888">
  <input type="hidden" name="token" value="1635619261-OLsE6iUxtQiJJWkSFcguTPvKOJBU7MTyrHQ0YoF-H2Q">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=469888"><b>Bug&nbsp;469888</b></a> <span id="summary_container" class="bz_default_hidden">
        (<span id="alias_nonedit_display">CVE-2013-2100</span>)
      - <span id="short_desc_nonedit_display">&lt;sys-apps/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span><span title="&lt;sys-apps/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)">&lt;sys-apps/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-...
        </span>
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      '\x3csys-apps\/portage-2.1.12.2 : urlopen() does not verify SSL certificates (CVE-2013-2100)' );
  </script>
  <table class="edit_form">
    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>CVE-2013-2100
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >Gentoo Security

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=Gentoo Security"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >Vulnerabilities

  (<a href="buglist.cgi?component=Vulnerabilities&amp;product=Gentoo%20Security&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">All
        Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>Normal
       major<span id="votes_container">
    (<a href="page.cgi?id=voting/user.html&amp;bug_id=469888#vote_469888">vote</a>)
  </span>
      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Portage team</span>
</span>
      </td>
    </tr>

    <script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'security\x40gentoo.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>

    <tr><th class="field_label "
    id="field_label_status_whiteboard">


  <a 
      title="Each bug has a free-form single line text entry box for adding tags and status information."
      class="field_help_link"
      href="page.cgi?id=fields.html#status_whiteboard"
  >Whiteboard:</a>

</th><td>A2 [glsa cve]  
  </td>
    </tr>

    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>
<a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - gentoo.org may benefit from SSL"
   href="show_bug.cgi?id=470054">470054</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - sys-apps/portage-2.1.12.2 stable request"
   href="show_bug.cgi?id=472540">472540</a> <a class="bz_bug_link 
          bz_status_RESOLVED  bz_closed"
   title="RESOLVED FIXED - Migrate old *.gentoo.org servers to new DigiCert certificate"
   href="show_bug.cgi?id=482870">482870</a> 
  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>

    <tr>
      <th>&nbsp;</th>

      <td id="show_dependency_tree_or_graph">
        Show dependency <a href="showdependencytree.cgi?id=469888&amp;hide_resolved=1">tree</a>

      </td>
    </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2013-05-14 21:56 UTC by <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2015-07-10 13:14 UTC
      (<a href="show_activity.cgi?id=469888">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>5 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="alex_y_xu">alex_y_xu</option>
                <option value="david+gentoo.org">david+gentoo.org</option>
                <option value="dev-portage">dev-portage</option>
                <option value="flow">flow</option>
                <option value="infra-bugs">infra-bugs</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 
<tr>
      <th class="field_label "
    id="field_label_cf_stabilisation_atoms">


  <a 
      title="Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_stabilisation_atoms"
  >Package list:</a>

</th>
  <td class="field_value "
      id="field_container_cf_stabilisation_atoms" >
      <div class="uneditable_textarea"></div>

</td>
    </tr>
    <tr>
      <th class="field_label "
    id="field_label_cf_runtime_testing_required">


  <a 
      title="Indicate if runtime testing is required for this stabilisation request, or if it is sufficient to stabilised with a build/tests/qa test."
      class="field_help_link"
      href="page.cgi?id=fields.html#cf_runtime_testing_required"
  >Runtime testing required:</a>

</th>
  <td class="field_value "
      id="field_container_cf_runtime_testing_required" >---

</td>
    </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=362609"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">fix to reimplement caching for https</span></b></a>

          <span class="bz_attach_extra_info">
              (portage_https_fetchhack_caching_fix.patch,1.93 KB,
                patch)

            <br>
            <a href="#attach_362609"
               title="Go to the comment associated with the attachment">2013-11-05 09:26 UTC</a>,

            <span class="vcard"><span class="fn">Blu3</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=362609&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=362609&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden">
        <td>
            <a href="attachment.cgi?id=362613"
               title="View the content of the attachment">
          <b><span class="bz_obsolete">updated patch corrects comments and uses more secure tmpfile methods</span></b></a>

          <span class="bz_attach_extra_info">
              (portage_https_fetchhack_caching_fix.patch,2.18 KB,
                patch)

            <br>
            <a href="#attach_362613"
               title="Go to the comment associated with the attachment">2013-11-05 10:04 UTC</a>,

            <span class="vcard"><span class="fn">Blu3</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=362613&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=362613&amp;action=diff">Diff</a>
        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_text_plain bz_patch">
        <td>
            <a href="attachment.cgi?id=363172"
               title="View the content of the attachment">
          <b>handle newly set PORTAGE_BINHOST environments</b></a>

          <span class="bz_attach_extra_info">
              (portage_https_fetchhack_caching_fix.patch,2.39 KB,
                patch)

            <br>
            <a href="#attach_363172"
               title="Go to the comment associated with the attachment">2013-11-13 02:41 UTC</a>,

            <span class="vcard"><span class="fn">Blu3</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>
          <a href="attachment.cgi?id=363172&amp;action=edit">Details</a>
            | <a href="attachment.cgi?id=363172&amp;action=diff">Diff</a>
        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a href="#a0" onclick="return toggle_display(this);">Show
              Obsolete</a> (2)
            <a id="view_all" href="attachment.cgi?bugid=469888&amp;action=viewall&amp;hide_obsolete=1">View All</a>
        </span>
        <a href="attachment.cgi?bugid=469888&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=469888&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1635279621" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-14 21:56:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">Various functions call urlopen() in pym/portage/util/_urlopen.py, including the code which fetches the binary package list from a specified binhost.

urlopen() does not include any logic for validating ssl certificates. 


def urlopen(url, if_modified_since=None):
...
                request = urllib_request.Request(url)
...
                opener = urllib_request.build_opener(auth_handler)
...
                hdl = opener.open(request)
...
                return hdl



SSL certificates must be validated. Otherwise a man in the middle may tamper with data which is then used by portage.</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-14 22:53:10 UTC
        </span>

      </div>




<pre class="bz_comment_text">There are some code examples here that may be useful:

<a href="http://stackoverflow.com/questions/1087227/validate-ssl-certificates-with-python">http://stackoverflow.com/questions/1087227/validate-ssl-certificates-with-python</a>
<a href="https://gist.github.com/schlamar/2993700">https://gist.github.com/schlamar/2993700</a></pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-14 23:49:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">An intermediate solution to solve the binary package issue might be to use FETCHCOMMAND in bintree.py. Right now the code reads:

def _populate(self, getbinpkgs=0):
...
    try:
...
        f = _urlopen(url, if_modified_since=local_timestamp)
...
    except IOError as err:
...
        if parsed_url.scheme == 'sftp':
...
        elif parsed_url.scheme == 'ssh':
...
        else:
            setting = 'FETCHCOMMAND_' + parsed_url.scheme.upper()
            fcmd = self.settings.get(setting)
            if not fcmd:
                raise
            fd, tmp_filename = tempfile.mkstemp()
            tmp_dirname, tmp_basename = os.path.split(tmp_filename)
            os.close(fd)
            success = portage.getbinpkg.file_get(url,
                tmp_dirname, fcmd=fcmd, filename=tmp_basename)
            if not success:
                raise EnvironmentError(&quot;%s failed&quot; % (setting,))
            f = open(tmp_filename, 'rb')


FETCHCOMMAND has the nice property that by default it uses wget, which does things right, and furthermore, it can be overridden by the user in make.conf for matching against custom certificate authorities. 

As seen in the code above, this function already makes use of FETCHCOMMAND_*, which is different from vanilla FETCHCOMMAND, but is essentially the same logic. 

The proposed fix here would be to first try using FETCHCOMMAND, instead of urlopen, before falling back to the various alternatives.</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-14 23:55:59 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=469888#c2">comment #2</a>)
<span class="quote">&gt; An intermediate solution to solve the binary package issue might be to use
&gt; FETCHCOMMAND in bintree.py.</span >

Yeah, that sounds reasonable, at least for https protocol. For plain http, it would be nice to keep the existing urlopen code, since it's optimized check for modifications with the If-Modified-Since header.</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-15 02:42:06 UTC
        </span>

      </div>




<pre class="bz_comment_text">Great. Do you plan to work up a patch for this, or should I give it a stab?</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-15 07:41:21 UTC
        </span>

      </div>




<pre class="bz_comment_text">This should fix it:

<a href="http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit;h=b5969af9f575e4e4b669f44e76ad01f0dbc2dd27">http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit;h=b5969af9f575e4e4b669f44e76ad01f0dbc2dd27</a></pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-15 11:10:05 UTC
        </span>

      </div>




<pre class="bz_comment_text">A CVE has been requested for the binhost bug: <a href="http://seclists.org/oss-sec/2013/q2/332">http://seclists.org/oss-sec/2013/q2/332</a> .


We still need to audit all additional uses of urlopen() to see if a similar mistake is repeated elsewhere.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Agostino Sarubbo</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-15 12:41:14 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=469888#c5">comment #5</a>)
<span class="quote">&gt; This should fix it:
&gt; 
&gt; <a href="http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit">http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit</a>;
&gt; h=b5969af9f575e4e4b669f44e76ad01f0dbc2dd27</span >

&#64;Zac, you need to release a new version and we need to stabilize it.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-15 18:03:11 UTC
        </span>

      </div>




<pre class="bz_comment_text">Let's go one by one.

zx2c4&#64;thinkpad ~/portage-HEAD-5425900 $ grep -R -l urlopen
bin/repoman
pym/portage/glsa.py
pym/portage/util/_urlopen.py
pym/portage/dbapi/bintree.py

* _urlopen.py: N/A
* bintree.py: fixed by b5969af9
* glsa.py: only uses file:// -- not vulnerable


* repoman: metadata_dtd_uri hard-coded as http:// -- this means it's not relevent for this SSL validation issue, but, more generally, is this a bad thing? Apparently the fetched file is passed to xmllint. Will xmllint execute code in DTDs? Will it resolve external entities? I really have no idea. More generally, in assessing this, we essentially have to consider metadata.dtd to be untrusted input. Assuming this, are we safe? If not, perhaps we should be using https and checking certificates.

Anybody better versed care to weigh in on this?</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-15 22:33:31 UTC
        </span>

      </div>




<pre class="bz_comment_text">I've fixed repoman to use FETCHCOMMAND:

<a href="http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit;h=155b31eb91da4e6007a3a72c8027d66caf9fadb8">http://git.overlays.gentoo.org/gitweb/?p=proj/portage.git;a=commit;h=155b31eb91da4e6007a3a72c8027d66caf9fadb8</a>

If infra enables https for www.gentoo.org/dtd/metadata.dtd, then we can easily update repoman to use https.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-15 23:15:20 UTC
        </span>

      </div>




<pre class="bz_comment_text">Adding infra to this bug report.

It might be wise to enable SSL for gentoo.org for metadata.dtd. What is involved to make this happen? What's the deal with certificates?</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alec Warner</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-16 02:27:50 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=469888#c10">comment #10</a>)
<span class="quote">&gt; Adding infra to this bug report.
&gt; 
&gt; It might be wise to enable SSL for gentoo.org for metadata.dtd. What is
&gt; involved to make this happen? What's the deal with certificates?</span >

Please file a separate bug.

I don't believe https is enabled for anything on www.gentoo.org.

We have not yet purchased certificates, so we would rely on cacert to generate certs for www (or use the wildcard cert.)

-A</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-16 10:30:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">This has been assigned CVE-2013-2100.</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-16 11:22:03 UTC
        </span>

      </div>




<pre class="bz_comment_text">&#64;Zac: for b5969af9, it might be nice to suppress the wget output somehow. It's totally up to you, but IMHO, it's a bit ugly. Same functionality either way though.</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-05-16 13:48:52 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=469888#c13">comment #13</a>)
<span class="quote">&gt; &#64;Zac: for b5969af9, it might be nice to suppress the wget output somehow.
&gt; It's totally up to you, but IMHO, it's a bit ugly. Same functionality either
&gt; way though.</span >

Well, maybe it's ugly, but it could also provide some useful feedback to the user (especially if it times out while connecting to the server).

(In reply to <a href="show_bug.cgi?id=469888#c7">comment #7</a>)
<span class="quote">&gt; &#64;Zac, you need to release a new version and we need to stabilize it.</span >

It's release in portage-2.1.12.</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Jason A. Donenfeld</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-05-16 17:31:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=469888#c14">comment #14</a>)
<span class="quote">&gt; Well, maybe it's ugly, but it could also provide some useful feedback to the
&gt; user (especially if it times out while connecting to the server).</span >

Yea, this is a legitimate reason. Though, to be fair, the urlopen() http:// handler doesn't show any information.</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Xu (Hello71)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-29 01:58:17 UTC
        </span>

      </div>




<pre class="bz_comment_text">(In reply to Alec Warner from <a href="show_bug.cgi?id=469888#c11">comment #11</a>)
<span class="quote">&gt; (In reply to <a href="show_bug.cgi?id=469888#c10">comment #10</a>)
&gt; &gt; Adding infra to this bug report.
&gt; &gt; 
&gt; &gt; It might be wise to enable SSL for gentoo.org for metadata.dtd. What is
&gt; &gt; involved to make this happen? What's the deal with certificates?
&gt; 
&gt; Please file a separate bug.
&gt; 
&gt; I don't believe https is enabled for anything on www.gentoo.org.
&gt; 
&gt; We have not yet purchased certificates, so we would rely on cacert to
&gt; generate certs for www (or use the wildcard cert.)
&gt; 
&gt; -A</span >

This appears to have been done, but with CACert certificates. Conveniently, app-misc/ca-certificates installs the CACert roots.</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-08-29 04:51:02 UTC
        </span>

      </div>




<pre class="bz_comment_text">If we change repoman to fetch metadata.dtd via https, then we need to provide some instruction detailed instructions for how to configure it. For example, here's what happens with my current configuration:

$ wget <a href="https://www.gentoo.org/dtd/metadata.dtd">https://www.gentoo.org/dtd/metadata.dtd</a>
--2013-08-28 21:46:35--  <a href="https://www.gentoo.org/dtd/metadata.dtd">https://www.gentoo.org/dtd/metadata.dtd</a>
Resolving www.gentoo.org (www.gentoo.org)... 89.16.167.134, 2001:41c8:0:936::139, 2001:41c8:0:936::136
Connecting to www.gentoo.org (www.gentoo.org)|89.16.167.134|:443... connected.
ERROR: The certificate of ‘www.gentoo.org’ is not trusted.</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Robin Johnson</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-at.png"
                 alt="archtester"
                 title="archtester - Architecture Testers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-infra.png"
                 alt="Gentoo Infrastructure"
                 title="Gentoo Infrastructure - Access to bugs in the Gentoo Infrastructure product">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-sec.png"
                 alt="Security"
                 title="Security - Gentoo Security">
        </span>

        <span class="bz_comment_time">
          2013-08-29 06:03:34 UTC
        </span>

      </div>




<pre class="bz_comment_text">That host is using DigiCert, not CA-Cert.

$ wget <a href="https://www.gentoo.org/dtd/metadata.dtd">https://www.gentoo.org/dtd/metadata.dtd</a>
--2013-08-28 23:01:50--  <a href="https://www.gentoo.org/dtd/metadata.dtd">https://www.gentoo.org/dtd/metadata.dtd</a>
Resolving www.gentoo.org... 89.16.167.134, 2001:41c8:0:936::136, 2001:41c8:0:936::139
Connecting to www.gentoo.org|89.16.167.134|:443... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4720 (4.6K) [application/xml-dtd]
Saving to: ‘metadata.dtd’
...

robbat2&#64;bohr-int:~ $ openssl s_client -connect www.gentoo.org:443 -showcerts -servername www.gentoo.org
CONNECTED(00000003)
depth=2 C = US, O = DigiCert Inc, OU = www.digicert.com, CN = DigiCert High Assurance EV Root CA
verify error:num=20:unable to get local issuer certificate
verify return:0
---
Certificate chain
 0 s:/C=US/ST=New Mexico/L=Albuquerque/O=GENTOO Foundation, Inc./CN=*.gentoo.org
   i:/C=US/O=DigiCert Inc/OU=www.digicert.com/CN=DigiCert High Assurance CA-3
-----BEGIN CERTIFICATE-----</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Xu (Hello71)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-29 15:13:10 UTC
        </span>

      </div>




<pre class="bz_comment_text">Wget fails if built with GnuTLS instead of OpenSSL.

Still investigating why, as gnutls-cli works fine and returns a sha1WithRSAEncryption certificate.</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alex Xu (Hello71)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-08-29 16:13:46 UTC
        </span>

      </div>




<pre class="bz_comment_text">Fails with gnutls-2.12.23-r1 (stable on most arches) but works with gnutls-3.2.3 (~ on most arches).

Why? No idea. Maybe nettle is related.</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Zac Medico</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-08-29 16:52:49 UTC
        </span>

      </div>




<pre class="bz_comment_text">Maybe we should just file a stable request for net-libs/gnutls-3.2.3, since it's been in the tree for 30 days now.</pre>
    </div>

    <div id="c22" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c22">Comment 22</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Agostino Sarubbo</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2013-11-04 09:55:26 UTC
        </span>

      </div>




<pre class="bz_comment_text">The fixed version has been stabilized. If it is ok, please go ahead with the glsa.</pre>
    </div>

    <div id="c23" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c23">Comment 23</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Blu3</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-11-05 09:26:38 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=362609" name="attach_362609" title="fix to reimplement caching for https">attachment 362609</a> [<a href="attachment.cgi?id=362609&amp;action=edit" title="fix to reimplement caching for https">details</a>, <a href="attachment.cgi?id=362609&amp;action=diff" title="fix to reimplement caching for https">diff</a>]</span>
fix to reimplement caching for https

attached is a method of utilizing wget with -N option so local cache checking can be done. currently cache checking is voided with https due to the use of wget with redirection (-O option negates -N)

the attached patch creates a temporary directory instead of a temp file and copies the pkgindex file to it preserving timestamps. chdir is used so wget infers the unqualified basename, e.g. &quot;Packages&quot;, to do the timestamp checks.

'-O &quot;${DISTDIR}/${FILE}&quot;' in fcmd is replaced with '-N' to undo the redirect notion within wget.

after fetching (or not), and timestamps check, tmp_filename is set to tmp_dirname so the later cleanup with os.unlink() will remove both the temp directory and file

p.s. regarding the original implementation, there's still a race condition if a tmpfile is created and the opened file descriptor is discarded. malware watching for the tmpfile can quickly unlink it and link a target to the intended tmpfile for destruction or employ other DoS means. the use of a tmpfile is only secure if the returned file descriptor is used</pre>
    </div>

    <div id="c24" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c24">Comment 24</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Blu3</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-11-05 10:04:51 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=362613" name="attach_362613" title="updated patch corrects comments and uses more secure tmpfile methods">attachment 362613</a> [<a href="attachment.cgi?id=362613&amp;action=edit" title="updated patch corrects comments and uses more secure tmpfile methods">details</a>, <a href="attachment.cgi?id=362613&amp;action=diff" title="updated patch corrects comments and uses more secure tmpfile methods">diff</a>]</span>
updated patch corrects comments and uses more secure tmpfile methods</pre>
    </div>

    <div id="c25" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c25">Comment 25</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Blu3</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2013-11-13 02:41:58 UTC
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=363172" name="attach_363172" title="handle newly set PORTAGE_BINHOST environments">attachment 363172</a> [<a href="attachment.cgi?id=363172&amp;action=edit" title="handle newly set PORTAGE_BINHOST environments">details</a>, <a href="attachment.cgi?id=363172&amp;action=diff" title="handle newly set PORTAGE_BINHOST environments">diff</a>]</span>
handle newly set PORTAGE_BINHOST environments

this version of the patch now cleanly handles the situation where the PORTAGE_BINHOST factory has not yet stored a Packages file.</pre>
    </div>

    <div id="c26" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c26">Comment 26</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">GLSAMaker/CVETool Bot</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2014-10-11 00:38:49 UTC
        </span>

      </div>




<pre class="bz_comment_text">CVE-2013-2100 (<a href="http://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-2100">http://nvd.nist.gov/nvd.cfm?cvename=CVE-2013-2100</a>):
  The urlopen function in pym/portage/util/_urlopen.py in Gentoo Portage
  2.1.12, when using HTTPS, does not verify X.509 certificates from SSL
  servers, which allows man-in-the-middle attackers to spoof servers and
  modify binary package lists via a crafted certificate.</pre>
    </div>

    <div id="c27" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c27">Comment 27</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Brian Dolbec</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2014-10-11 01:48:15 UTC
        </span>

      </div>




<pre class="bz_comment_text">I don't know how much opposition I'll get, but the new ssl-fetch lib code I created from layman's code to do https verified fetching.  I was planning on possibly implementing it's use in portage in the near future.

It will be installed as a dep with the gentoo-keys project, layman and mirrorselect,  It wraps the urllib3 and dev-python/requests libs for the verified fetching from api.gentoo.org or any other url.

With gentoo-keys (soon to be released ;) and in operation, portage will get a module to make use of it for gpg verification of files too when signatures are available.

Repoman is currently undergoing a rewrite.  It would be a good time to introduce the ssl-fetch code there which can also easily be swapped out for a gkeys call which will use ssl-fetch to retrieve the file as well as a signature file if available and do the gpg verification.

We are currently working on the automation scripts for gkeys infra deployment.  So more files will be served via api.gentoo.org strictly via https and many with gpg signatures for further verification.</pre>
    </div>

    <div id="c28" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c28">Comment 28</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kristian Fiskerstrand (RETIRED)</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2015-05-11 16:43:08 UTC
        </span>

      </div>




<pre class="bz_comment_text">New GLSA request filed</pre>
    </div>

    <div id="c29" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="#c29">Comment 29</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">GLSAMaker/CVETool Bot</span>
</span>
        </span>

        <span class="bz_comment_user_images">
            <img src="https://bugs.gentoo.org/images/ranks/bugs-rank-dev.png"
                 alt="gentoo-dev"
                 title="gentoo-dev - Gentoo Developers">
        </span>

        <span class="bz_comment_time">
          2015-07-10 13:14:33 UTC
        </span>

      </div>




<pre class="bz_comment_text">This issue was resolved and addressed in
 GLSA 201507-16 at <a href="https://security.gentoo.org/glsa/201507-16">https://security.gentoo.org/glsa/201507-16</a>
by GLSA coordinator Mikle Kolyada (Zlogene).</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=469888">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=469888">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=469888">Clone This Bug</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=469888&product=Gentoo%20Security">Clone In The Same 
                        Product</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi?format=guided">New</a>&ndash;<a href="enter_bug.cgi">[Ex]</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>
  <li><span class="separator">| </span><a href="https://wiki.gentoo.org/wiki/Foundation:Privacy_Policy">Privacy Policy</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=469888&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=469888" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=469888&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635619261-BTYkocfaTcOk5LbfSm2kpbRspXz5DFZ5PttcOYuZpBM">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

  </body>
</html>