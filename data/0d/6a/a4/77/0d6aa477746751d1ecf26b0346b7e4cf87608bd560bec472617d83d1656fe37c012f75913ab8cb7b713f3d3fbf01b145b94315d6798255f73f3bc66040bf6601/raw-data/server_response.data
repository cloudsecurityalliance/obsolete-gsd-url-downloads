<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
<meta property="og:type" content="website">
<meta property="og:title" content="1371259 - (CVE-2017-7801) heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources">
<meta property="og:url" content="https://bugzilla.mozilla.org/show_bug.cgi?id=1371259">
<meta property="og:description"
      content="VERIFIED (bzbarsky) in Core - DOM: Core &amp; HTML. Last updated 2019-03-13.">
<meta name="twitter:label1" value="Type">
<meta name="twitter:data1" value="defect">
<meta name="twitter:label2" value="Priority">
<meta name="twitter:data2" value="--">

    <meta name="viewport" content="width=1024">
    <meta name="color-scheme" content="dark light">
    <meta name="generator" content="Bugzilla 20211025.1">
    <meta name="bugzilla-global" content="dummy"
        id="bugzilla-global" data-bugzilla="{&quot;api_token&quot;:&quot;&quot;,&quot;config&quot;:{&quot;basepath&quot;:&quot;\/&quot;},&quot;constant&quot;:{&quot;COMMENT_COLS&quot;:80},&quot;param&quot;:{&quot;maxattachmentsize&quot;:&quot;10240&quot;,&quot;maxusermatches&quot;:&quot;50&quot;,&quot;splinter_base&quot;:&quot;\/page.cgi?id=splinter.html&amp;ignore=\/&quot;},&quot;string&quot;:{&quot;bug_type_required&quot;:&quot;You must select a Type for this bug&quot;,&quot;component_required&quot;:&quot;You must select a Component for this bug&quot;,&quot;description_required&quot;:&quot;You must enter a Description for this bug&quot;,&quot;short_desc_required&quot;:&quot;You must enter a Summary for this bug&quot;,&quot;version_required&quot;:&quot;You must select a Version for this bug&quot;},&quot;user&quot;:{&quot;is_new&quot;:1,&quot;login&quot;:&quot;&quot;}}">
    <title>1371259 - (CVE-2017-7801) heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources</title>

<link rel="Top" href="/">

  


  
    <link rel="Show" title="Dependency Tree"
          href="/showdependencytree.cgi?id=1371259&amp;hide_resolved=1">
      <link rel="Show" title="Dependency Graph"
            href="/showdependencygraph.cgi?id=1371259">

      <link rel="Show" title="Bug Activity"
            href="/show_activity.cgi?id=1371259">

<link href="/static/v20211025.1/skins/yui.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/standard/global.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BugModal/web/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/BMO/web/styles/bug_modal.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/EditComments/web/styles/inline-editor.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-structure-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/js/jquery/ui/jquery-ui-theme-min.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/skins/lib/prism.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Needinfo/web/styles/needinfo.css" rel="stylesheet" type="text/css"><link href="/static/v20211025.1/extensions/Review/web/styles/badge.css" rel="stylesheet" type="text/css">



    
<script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/jquery/jquery-min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/jquery/ui/jquery-ui-min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/yui.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/jquery/plugins/contextMenu/contextMenu-min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/jquery/plugins/devbridgeAutocomplete/devbridgeAutocomplete-min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/global.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/util.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/dropdown.js"></script>

      <script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO">
          YAHOO.namespace('bugzilla');
          if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
              YAHOO.util.Event._simpleRemove(window, "unload",
                                             YAHOO.util.Event._unload);
          }BUGZILLA.value_descs = JSON.parse('{\"bug_status\":{},\"resolution\":{\"\":\"---\"}}');

  
    var tracking_flags_str = "{\"types\":[\"tracking\"],\"comments\":{\"cf_tracking_firefox_esr78\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox55\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox93\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox56\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_a11y_review_project_flag\":{\"requested\":\"Description:\\nPlease provide an explanation of the feature or change. Include a description of the user scenario in which it would be used and how the user would complete the task(s).\\nScreenshots and visual UI specs are welcome, but please include sufficient accompanying explanation so that blind members of the accessibility team are able to understand the feature\/change.\\n\\nHow do we test this?\\nIf there is an implementation to test, please provide instructions for testing it; e.g. setting preferences, other preparation, how to trigger the UI, etc.\\n\\nWhen will this ship?\\nTracking bug\/issue:\\nDesign documents (e.g. Product Requirements Document, UI spec):\\nEngineering lead:\\nProduct manager:\\n\\nThe accessibility team has developed the Mozilla Accessibility Release Guidelines which outline what is needed to make user interfaces accessible:\\nhttps:\/\/wiki.mozilla.org\/Accessibility\/Guidelines\\nPlease describe the accessibility guidelines you considered and what steps you\'ve taken to address them:\\n\\nDescribe any areas of concern to which you want the accessibility team to give special attention:\"},\"cf_tracking_firefox94\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_relnote\":{\"?\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_sumo\":{\"none-needed\":\"Release Note Request (optional, but appreciated)\\n[Why is this notable]:\\n[Affects Firefox for Android]:\\n[Suggested wording]:\\n[Links (documentation, blog post, etc)]:\"},\"cf_tracking_firefox_esr52\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox95\":{\"?\":\"[Tracking Requested - why for this release]:\"},\"cf_tracking_firefox_esr91\":{\"?\":\"[Tracking Requested - why for this release]:\"}},\"flags\":{\"project\":{\"cf_root_cause\":\"---\",\"cf_fission_milestone\":\"---\",\"cf_tracking_firefox_sumo\":\"---\",\"cf_a11y_review_project_flag\":\"---\",\"cf_webcompat_priority\":\"---\"},\"tracking\":{\"cf_tracking_thunderbird_esr91\":\"---\",\"cf_tracking_firefox93\":\"---\",\"cf_tracking_firefox56\":\"+\",\"cf_tracking_firefox_esr78\":\"---\",\"cf_status_firefox94\":\"---\",\"cf_tracking_firefox55\":\"+\",\"cf_status_firefox_esr78\":\"---\",\"cf_tracking_firefox_esr91\":\"---\",\"cf_tracking_firefox94\":\"---\",\"cf_status_thunderbird_esr78\":\"---\",\"cf_status_firefox_esr52\":\"verified\",\"cf_tracking_firefox_esr52\":\"55+\",\"cf_status_firefox54\":\"wontfix\",\"cf_status_thunderbird_esr91\":\"---\",\"cf_status_firefox_esr91\":\"---\",\"cf_status_firefox55\":\"verified\",\"cf_status_firefox53\":\"wontfix\",\"cf_status_firefox95\":\"---\",\"cf_tracking_thunderbird_esr78\":\"---\",\"cf_status_firefox93\":\"---\",\"cf_tracking_firefox_relnote\":\"---\",\"cf_status_firefox56\":\"verified\",\"cf_tracking_firefox95\":\"---\"}}}";
    var TrackingFlags = $.parseJSON(tracking_flags_str);

  

  
  BUGZILLA.bug_id = 1371259;
  BUGZILLA.bug_title = '1371259 - (CVE-2017-7801) heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources';
  BUGZILLA.bug_summary = 'heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources';
  BUGZILLA.bug_url = 'https:\/\/bugzilla.mozilla.org\/show_bug.cgi?id=1371259';
  BUGZILLA.bug_keywords = 'csectype-uaf, sec-critical',
  BUGZILLA.user = {
    id: 0,
    login: '',
    is_insider: false,
    is_timetracker: false,
    can_tag: false,
    timezone: 'America\/Los_Angeles',
    settings: {
      quote_replies: 'quoted_reply',
      zoom_textareas: true,
      remember_collapsed: true,
      inline_attachments: true,
      autosize_comments: false
    }
  };

  BUGZILLA.bug_secure = false;
      </script>
<script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/BugModal/web/autosize.min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/ProdCompSearch/web/js/prod_comp_search.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/BugModal/web/bug_modal.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/BugModal/web/comments.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/ComponentWatching/web/js/overlay.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/bugzilla-readable-status-min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/field.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/comments.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/TrackingFlags/web/js/flags.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/BMO/web/js/firefox-crash-table.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/MozChangeField/web/js/severity-s1-priority-p1.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/MozChangeField/web/js/clear-tracking-priority-s1.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/MozChangeField/web/js/set-tracking-severity-s1.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/lib/prism.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/GoogleAnalytics/web/js/analytics.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/js/lib/md5.min.js"></script><script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO" src="/static/v20211025.1/extensions/Review/web/js/badge.js"></script>

    

    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla@Mozilla" href="/search_plugin.cgi"><link rel="shortcut icon" href="/extensions/BMO/web/images/favicon.ico">
<link rel="canonical" href="https://bugzilla.mozilla.org/show_bug.cgi?id=1371259">
<link rel="shorturl" href="https://bugzilla.mozilla.org/1371259"><meta name="google-analytics" content="UA-36116321-3" data-location="https://bugzilla.mozilla.org/bug/show-modal" data-title="1371259 - (CVE-2017-7801) heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources">
<script async src="https://www.google-analytics.com/analytics.js"></script><meta name="robots" content="noarchive">
  </head>



  <body
        class="bugzilla-mozilla-org
               skin-standard bug_modal yui-skin-sam">



<div id="wrapper">

<header id="header" role="banner">
  <div class="inner">
    <h1 id="header-title" class="title"><a href="https://bugzilla.mozilla.org/home" title="Go to home page">Bugzilla</a></h1>
    <form role="search" id="header-search" class="quicksearch" action="/buglist.cgi" data-no-csrf>
      <section class="searchbox-outer dropdown" role="combobox" aria-expanded="false" aria-haspopup="listbox"
               aria-labelledby="header-search-label" aria-owns="header-search-dropdown">
        <h2 id="header-search-label">Quick Search</h2>
        <span class="icon" aria-hidden="true"></span>
        <input role="searchbox" id="quicksearch_top" class="dropdown-button" name="quicksearch" autocomplete="off"
               value="" placeholder="Search Bugs"
               title="Enter a bug number or some search terms" aria-controls="header-search-dropdown"
               aria-label="Quick Search"><div id="header-search-dropdown" class="dropdown-content right" role="listbox" style="display: none;">
  <div id="header-search-dropdown-wrapper">
  </div>
</div>
      </section>
    </form>
    <nav id="header-nav">
      <ul class="links">
        <li class="link-browse">
          <a href="/describecomponents.cgi" title="Browse bugs by component">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Browse</span>
          </a>
        </li>
        <li class="link-search">
          <a href="/query.cgi?format=advanced" title="Search bugs using various criteria">
            <span class="icon" aria-hidden="true"></span>
            <span class="label">Advanced Search</span>
          </a>
        </li>
      </ul>
      <div class="dropdown">
        <button type="button" id="header-tools-menu-button" class="dropdown-button minor" title="More tools…"
                aria-label="More tools…" aria-expanded="false" aria-haspopup="true" aria-controls="header-tools-menu">
          <span class="icon" aria-hidden="true"></span>
        </button>
        <ul class="dropdown-content left" id="header-tools-menu" role="menu" style="display:none;">
          <li role="presentation">
            <a href="/report.cgi" role="menuitem" tabindex="-1">Reports</a>
          </li>
            <li role="separator"></li>
            <li role="presentation">
              <a href="https://bmo.readthedocs.io/en/latest/" role="menuitem" tabindex="-1">Documentation</a>
            </li>
        </ul>
      </div>
    </nav>
      <ul id="header-login" class="links">
          <li id="moz_new_account_container_top"><a href="/createaccount.cgi">New Account</a></li><li id="mini_login_container_top">
  <a id="login_link_top" href="/index.cgi?GoAheadAndLogIn=1"
     class='show_mini_login_form' data-qs-suffix="_top">Log In</a>

  <div id="mini_login_top" class="mini-popup mini_login bz_default_hidden"><span id="github_mini_login_top" class="mini_login_top">
    <form method="post" action="/github.cgi">
      <input type="hidden" name="github_secret" value="qOX9tm5sFK5NAuG9dOtTsqcqntl0OGNWmKWdtTDSFAspcl6DNYebvb5hZQ63CzFQYnNx7dwEwCThWXrhv51l09eYgQ2XvMvZLlq6LhWKuHKOL57HRmV30nmYGtBMTCe6Ml7S4DUYPlGlEO5oWvsXHS4x2V5lPkBl2SsuSxLp3bMy8S48TN8zz0WPr96yjPw1MudIsDPhWyUgZsA1vwz3wa177rYfKgTo6qEkwuREnr8qtI6kULBNORIFFTj5t58i">
      <input type="hidden" name="target_uri" value="https://bugzilla.mozilla.org/show_bug.cgi">
      <input type="image" src="/extensions/GitHubAuth/web/images/sign_in.png" height="22" width="75" align="absmiddle"
             alt="Sign in with GitHub"
             title="Sign in with GitHub"> or
    </form>
  </span>

  <form action="/show_bug.cgi?id=1371259" method="POST"
        data-qs-suffix="_top">

    <input id="Bugzilla_login_top"
           class="bz_login"
           name="Bugzilla_login"
           title="Login"
           placeholder="Email"
           aria-label="Email"
           type="email"
           required
    >
    <input class="bz_password"
           id="Bugzilla_password_top"
           name="Bugzilla_password"
           type="password"
           title="Password"
           placeholder="Password"
           aria-label="Password"
           required
    >
    <input class="bz_password bz_default_hidden bz_mini_login_help" type="text"
           id="Bugzilla_password_dummy_top" value="password"
           title="Password"
    >
      <input type="checkbox" id="Bugzilla_remember_top"
             name="Bugzilla_remember" value="on" class="bz_remember"
                 checked>
      <label for="Bugzilla_remember_top">Remember</label>
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
           class="check_mini_login_fields"
            id="log_in_top">
    <a href="#" id="hide_mini_login_top" aria-label="Close"
       class="close-button hide_mini_login_form" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
<li id="forgot_container_top">
  <a id="forgot_link_top" href="/index.cgi?GoAheadAndLogIn=1#forgot"
     class='show_forgot_form'
     data-qs-suffix="_top">Forgot Password</a>
  <div id="forgot_form_top" class="mini-popup mini_forgot bz_default_hidden">
  <form action="/token.cgi" method="post">
    <input type="email" name="loginname" size="20" placeholder="Email" aria-label="Email" required>
    <input id="forgot_button_top" value="Reset Password"
           type="submit">
    <input type="hidden" name="a" value="reqpw">
    <input type="hidden" id="token_top" name="token" value="1635623195-wywGi6bJbJwRZTSnX7C4D0QmFxEm-hz_P4N9ie2w-7w">
    <a href="#" class="close-button hide_forgot_form" aria-label="Close" data-qs-suffix="_top">
      <span class="icon" aria-hidden="true"></span>
    </a>
  </form>
  </div>
</li>
      </ul><div id="header-external-links" class="dropdown first">
  <button type="button" id="header-external-menu-button" class="dropdown-button minor" title="Mozilla"
          aria-label="Mozilla" aria-expanded="false" aria-haspopup="true" aria-controls="header-external-menu">
    <img src="/static/v20211025.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg" width="32" height="32" alt="">
  </button>
  <ul class="dropdown-content right" id="header-external-menu" role="menu" style="display:none;">
    <li role="presentation">
      <a href="https://www.mozilla.org/" role="menuitem" tabindex="-1">Mozilla Home</a>
    </li>
    <li role="separator"></li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/" role="menuitem" tabindex="-1">Privacy</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/privacy/websites/#cookies" role="menuitem" tabindex="-1">Cookies</a>
    </li>
    <li role="presentation">
      <a href="https://www.mozilla.org/about/legal/" role="menuitem" tabindex="-1">Legal</a>
    </li>
  </ul>
</div>
  </div>
</header> 


<main id="bugzilla-body" tabindex="-1">

<aside id="message-container" role="complementary">
  <noscript>
    <div class="noscript">
      <div class="inner">
        <p>Please enable JavaScript in your browser to use all the features on this site.</p>
      </div>
    </div>
  </noscript>
</aside>

<div id="main-inner">




<div role="toolbar" id="page-toolbar">
  <div role="group" class="buttons">
    <button type="button" id="copy-summary" class="secondary"
      title="Copy bug number and summary to your clipboard">Copy Summary</button>
    <div id="clip-container" style="display:none"><input type="text" id="clip"></div>
    <div class="dropdown">
      <button type="button" id="action-menu-btn" aria-haspopup="true" aria-label="View"
        aria-expanded="false" aria-controls="action-menu" class="dropdown-button secondary">View &#9662;</button>
      <ul class="dropdown-content left" id="action-menu" role="menu" style="display:none;">
        <li role="presentation">
          <a id="action-reset" role="menuitem" tabindex="-1">Reset Sections</a>
        </li>
        <li role="presentation">
          <a id="action-expand-all" role="menuitem" tabindex="-1">Expand All Sections</a>
        </li>
        <li role="presentation">
          <a id="action-collapse-all" role="menuitem" tabindex="-1">Collapse All Sections</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a id="action-history" role="menuitem" tabindex="-1">History</a>
        </li>
        <li role="separator"></li>
        <li role="presentation">
          <a href="/rest/bug/1371259" role="menuitem" tabindex="-1">JSON</a>
        </li>
        <li role="presentation">
          <a href="/show_bug.cgi?ctype=xml&amp;id=1371259" role="menuitem" tabindex="-1">XML</a>
        </li>
      </ul>
    </div>
  </div>
</div>



<div role="status" id="io-error" style="display:none"></div>
<div role="status" id="floating-message" style="display:none">
  <div id="floating-message-text"></div>
</div>
<section class="module"
>
  <div class="module-content"
  >
  <div id="summary-container">
    <div class="field indent" id="field-status_summary"
>


  
    <div class=" container">
        <span id="field-value-status_summary">
      <span class="bug-status-label text" data-status="closed">Closed</span>
      <span id="field-value-bug_id">
        <a href="/show_bug.cgi?id=1371259">Bug 1371259</a>
          <span class="edit-hide">(CVE-2017-7801)</span>
      </span>
      <span>
        <span class="bug-time-label">Opened <span class="rel-time" title="2017-06-08 05:52 PDT" data-time="1496926379">5 years ago</span></span>
          <span class="bug-time-label">Closed <span class="rel-time" title="2017-07-10 18:47 PDT" data-time="1499737630">4 years ago</span></span>
      </span>
        </span>
    </div>

  
</div>
<div class="field indent edit-hide"
>


  
    <div class=" container">
      

      <h1 id="field-value-short_desc">heap-use-after-free in ns<wbr>Computed<wbr>DOMStyle::Update<wbr>Current<wbr>Style<wbr>Sources</h1>
    </div>

  
</div>

    <div class="field edit-show" id="field-short_desc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc" id="short_desc-help-link" class="help">Summary:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-short_desc">
            heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources

        </span>
    </div>

  
</div>
  </div>
  </div>
</section>


<section class="module" id="module-categories"
>
    <header id="module-categories-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Categories section"
           data-label-collapsed="Expand Categories section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-categories-content"
             aria-expanded="true"
             aria-labeledby="module-categories-title"
             aria-describedby="module-categories-subtitle"></div>
        <h2 class="module-title" id="module-categories-title">Categories</h2>
          <h3 class="module-subtitle" id="module-categories-subtitle">
            (Core :: DOM: Core &amp; HTML, defect)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-categories-content"
  ><div class="fields-lhs">

    <div class="field" id="field-product"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core" id="product-help-link" class="help">Product:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-product">
      <div class="name-info-outer dropdown">
        <span id="product-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="product-info">Core
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="product-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Product description and actions">
          <header>
            <div class="title">Core</div>
            <div class="description">Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the <a href="https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox">Firefox</a> product. (<a href="https://wiki.mozilla.org/Modules/All#Core">More info</a>)</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Product</a></div>
            <div><a href="/enter_bug.cgi?product=Core"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Product</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core"
                         data-label-watch="Watch This Product" data-label-unwatch="Unwatch This Product"
                         data-source="BugModal">Watch This Product</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-component"
>
    <div class="name">
        <a href="/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML" id="component-help-link" class="help">Component:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-component">
      <div class="name-info-outer dropdown">
        <span id="component-name" class="dropdown-button" tabindex="0" role="button"
             aria-haspopup="menu" aria-controls="component-info">DOM: Core &amp; HTML
          <span class="icon" aria-hidden="true">&#x25BE;</span>
        </span>
        <aside id="component-info" class="name-info-popup dropdown-content right hover-display" hidden role="menu"
               aria-label="Component description and actions">
          <header>
            <div class="title">Core :: DOM: Core &amp; HTML</div>
            <div class="description">Issues in DOM tree <a href="https://dom.spec.whatwg.org/">https://dom.spec.whatwg.org</a> & HTML <a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org</a> that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.</div>
          </header>
          <li role="separator"></li>
          <div class="actions">
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML&amp;bug_status=__open__"
                    target="_blank" role="menuitem" tabindex="-1">See Open Bugs in This Component</a></div>
            <div><a href="/buglist.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML&amp;chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__"
                    target="_blank" role="menuitem" tabindex="-1">Recently Fixed Bugs in This Component</a></div>
            <div><a href="/enter_bug.cgi?product=Core&amp;component=DOM%3A%20Core%20%26%20HTML"
                    target="_blank" role="menuitem" tabindex="-1">File New Bug in This Component</a></div>
            <div><button disabled type="button" class="secondary component-watching" role="menuitem" tabindex="-1"
                         data-product="Core" data-component="DOM: Core &amp; HTML"
                         data-label-watch="Watch This Component" data-label-unwatch="Unwatch This Component"
                         data-source="BugModal">Watch This Component</button></div>
          </div>
        </aside>
      </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-version"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#version" id="version-help-link" class="help">Version:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-version">
            52 Branch

        </span>
    </div>

  
</div>

    <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform" id="-help-link" class="help">Platform:
        </a>
    </div>


  
    <div class=" container"><div class="field inline" id="field-rep_platform"
>


  
    <div class="value">
        <span id="field-value-rep_platform">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline" id="field-op_sys"
>


  
    <div class="value">
        <span id="field-value-op_sys">
            Unspecified

        </span>
    </div>

  
</div><div class="field indent inline"
>


  
    <div class=" container">
    </div>

  
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field contains-buttons" id="field-bug_type"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type" id="bug_type-help-link" class="help">Type:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_type">
      <span class="bug-type-label iconic-text" data-type="defect">
        <span class="icon" aria-hidden="true"></span>defect</span>
        </span>
    </div>

  
</div>

    <div class="field" id="field-importance"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority" id="importance-help-link" class="help">Priority:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-importance"><div class="field inline" id="field-priority"
>


  
    <div class="value">
        <span id="field-value-priority">
          <em>Not set</em>
        </span>
    </div>

  
</div><div class="field inline" id="field-bug_severity"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity" id="bug_severity-help-link" class="help">Severity:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_severity">
            normal

        </span>
    </div>

  
</div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_points" style="display:none"
>
    <div class="name">Points:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_points">
            ---

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-tracking"
>
    <header id="module-tracking-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Tracking section"
           data-label-collapsed="Expand Tracking section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-tracking-content"
             aria-expanded="true"
             aria-labeledby="module-tracking-title"
             aria-describedby="module-tracking-subtitle"></div>
        <h2 class="module-title" id="module-tracking-title">Tracking</h2>
          <h3 class="module-subtitle" id="module-tracking-subtitle">
            (<span id="readable-bug-status" data-readable-bug-status="{&quot;cf_status_firefox_esr91&quot;:&quot;---&quot;,&quot;status&quot;:&quot;VERIFIED&quot;,&quot;cf_status_firefox55&quot;:&quot;verified&quot;,&quot;cf_status_firefox53&quot;:&quot;wontfix&quot;,&quot;keywords&quot;:[&quot;csectype-uaf&quot;,&quot;sec-critical&quot;],&quot;cf_webcompat_priority&quot;:&quot;---&quot;,&quot;id&quot;:1371259,&quot;cf_tracking_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_status_firefox95&quot;:&quot;---&quot;,&quot;cf_status_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_relnote&quot;:&quot;---&quot;,&quot;cf_status_firefox56&quot;:&quot;verified&quot;,&quot;cf_tracking_firefox95&quot;:&quot;---&quot;,&quot;cf_root_cause&quot;:&quot;---&quot;,&quot;cf_tracking_thunderbird_esr91&quot;:&quot;---&quot;,&quot;cf_tracking_firefox93&quot;:&quot;---&quot;,&quot;cf_tracking_firefox56&quot;:&quot;+&quot;,&quot;resolution&quot;:&quot;FIXED&quot;,&quot;cf_tracking_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox55&quot;:&quot;+&quot;,&quot;cf_status_firefox94&quot;:&quot;---&quot;,&quot;priority&quot;:&quot;--&quot;,&quot;cf_status_firefox_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_esr91&quot;:&quot;---&quot;,&quot;cf_fission_milestone&quot;:&quot;---&quot;,&quot;flags&quot;:[{&quot;name&quot;:&quot;sec-bounty&quot;,&quot;status&quot;:&quot;+&quot;}],&quot;cf_tracking_firefox94&quot;:&quot;---&quot;,&quot;cf_a11y_review_project_flag&quot;:&quot;---&quot;,&quot;cf_status_thunderbird_esr78&quot;:&quot;---&quot;,&quot;cf_tracking_firefox_sumo&quot;:&quot;---&quot;,&quot;cf_status_firefox_esr52&quot;:&quot;verified&quot;,&quot;cf_tracking_firefox_esr52&quot;:&quot;55+&quot;,&quot;dupe_of&quot;:null,&quot;cf_status_firefox54&quot;:&quot;wontfix&quot;,&quot;target_milestone&quot;:&quot;mozilla56&quot;,&quot;cf_status_thunderbird_esr91&quot;:&quot;---&quot;}"></span>)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-tracking-content"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-status-view"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-view-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-view">VERIFIED
        FIXED
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-status-edit" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugStatuses" id="status-edit-help-link" class="help">Status:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-status-edit"><div class="field inline" id="field-bug_status"
>


  
    <div class="value">
        <span id="field-value-bug_status">
            VERIFIED

        </span>
    </div>

  
</div><div class="field indent inline" id="field-resolution"
>


  
    <div class="value">
        <span id="field-value-resolution">
            FIXED

        </span>
    </div>

  
</div>
  <div id="status-action-buttons">
      <div id="assigned-container" style="display:none">
        <button type="button" class="secondary" id="mark-as-assigned-btn">
          Mark as Assigned
        </button>
      </div>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-target_milestone"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone" id="target_milestone-help-link" class="help">Milestone:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-target_milestone">
            mozilla56

        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-cf_fx_iteration" style="display:none"
>
    <div class="name">Iteration:
    </div>


  
    <div class="value">
        <span id="field-value-cf_fx_iteration">
            ---

        </span>
    </div>

  
</div>


      <div class="field edit-show" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Project Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <td class="tracking-flag-name">Webcompat Priority</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_webcompat_priority-dirty">
  <select id="cf_webcompat_priority" name="cf_webcompat_priority">
        <option value="---"
          id="v4274_cf_webcompat_priority" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">a11y-review</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_a11y_review_project_flag-dirty">
  <select id="cf_a11y_review_project_flag" name="cf_a11y_review_project_flag">
        <option value="---"
          id="v4876_cf_a11y_review_project_flag" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Root Cause</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_root_cause-dirty">
  <select id="cf_root_cause" name="cf_root_cause">
        <option value="---"
          id="v4701_cf_root_cause" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">user-doc-firefox</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_sumo-dirty">
  <select id="cf_tracking_firefox_sumo" name="cf_tracking_firefox_sumo">
        <option value="---"
          id="v4660_cf_tracking_firefox_sumo" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">Fission Milestone</td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_fission_milestone-dirty">
  <select id="cf_fission_milestone" name="cf_fission_milestone">
        <option value="---"
          id="v4222_cf_fission_milestone" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>
</div><div class="fields-rhs">

      <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags" id="-help-link" class="help">Tracking Flags:
        </a>
    </div>


  
    <div class=" container"><div class="flags edit-hide">
    <table class="layout-table tracking-flags">
        <tr>
          <th></th>
          <th>Tracking</th>
          <th>Status</th>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox-esr52</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=verified">verified</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox53</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox54</td>
            <td class="tracking-flag-tracking">---
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox55</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=verified">verified</a>
          </td>
        </tr>
        <tr>
          <td class="tracking-flag-name">firefox56</td>
            <td class="tracking-flag-tracking">
                <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a>
            </td>
          <td class="tracking-flag-status">
              <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=verified">verified</a>
          </td>
        </tr>
    </table>
  </div>


<div class="flags edit-show" style="display:none">
  <table class="layout-table tracking-flags">
      <tr>
        <th></th>
        <th>Tracking</th>
        <th>Status</th>
      </tr>
      <tr>
        <td class="tracking-flag-name">relnote-firefox</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_tracking_firefox_relnote-dirty">
  <select id="cf_tracking_firefox_relnote" name="cf_tracking_firefox_relnote">
        <option value="---"
          id="v539_cf_tracking_firefox_relnote" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr78-dirty">
  <select id="cf_tracking_thunderbird_esr78" name="cf_tracking_thunderbird_esr78">
        <option value="---"
          id="v4823_cf_tracking_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr78-dirty">
  <select id="cf_status_thunderbird_esr78" name="cf_status_thunderbird_esr78">
        <option value="---"
          id="v4829_cf_status_thunderbird_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">thunderbird_esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_thunderbird_esr91-dirty">
  <select id="cf_tracking_thunderbird_esr91" name="cf_tracking_thunderbird_esr91">
        <option value="---"
          id="v5236_cf_tracking_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_thunderbird_esr91-dirty">
  <select id="cf_status_thunderbird_esr91" name="cf_status_thunderbird_esr91">
        <option value="---"
          id="v5242_cf_status_thunderbird_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr52</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr52-dirty">
  <select id="cf_tracking_firefox_esr52" name="cf_tracking_firefox_esr52">
        <option value="55+"
          id="v3130_cf_tracking_firefox_esr52" selected
        >55+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr52-dirty">
  <select id="cf_status_firefox_esr52" name="cf_status_firefox_esr52">
        <option value="verified"
          id="v3138_cf_status_firefox_esr52" selected
        >verified
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr78</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr78-dirty">
  <select id="cf_tracking_firefox_esr78" name="cf_tracking_firefox_esr78">
        <option value="---"
          id="v4808_cf_tracking_firefox_esr78" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr78-dirty">
  <select id="cf_status_firefox_esr78" name="cf_status_firefox_esr78">
        <option value="---"
          id="v4813_cf_status_firefox_esr78" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox-esr91</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox_esr91-dirty">
  <select id="cf_tracking_firefox_esr91" name="cf_tracking_firefox_esr91">
        <option value="---"
          id="v5194_cf_tracking_firefox_esr91" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox_esr91-dirty">
  <select id="cf_status_firefox_esr91" name="cf_status_firefox_esr91">
        <option value="---"
          id="v5199_cf_status_firefox_esr91" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox53</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox53-dirty">
  <select id="cf_status_firefox53" name="cf_status_firefox53">
        <option value="wontfix"
          id="v3007_cf_status_firefox53" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox54</td>
          <td class="tracking-flag-tracking"></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox54-dirty">
  <select id="cf_status_firefox54" name="cf_status_firefox54">
        <option value="wontfix"
          id="v3047_cf_status_firefox54" selected
        >wontfix
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox55</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox55-dirty">
  <select id="cf_tracking_firefox55" name="cf_tracking_firefox55">
        <option value="+"
          id="v3175_cf_tracking_firefox55" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox55-dirty">
  <select id="cf_status_firefox55" name="cf_status_firefox55">
        <option value="verified"
          id="v3185_cf_status_firefox55" selected
        >verified
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox56</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox56-dirty">
  <select id="cf_tracking_firefox56" name="cf_tracking_firefox56">
        <option value="+"
          id="v3273_cf_tracking_firefox56" selected
        >+
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox56-dirty">
  <select id="cf_status_firefox56" name="cf_status_firefox56">
        <option value="verified"
          id="v3283_cf_status_firefox56" selected
        >verified
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox93</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox93-dirty">
  <select id="cf_tracking_firefox93" name="cf_tracking_firefox93">
        <option value="---"
          id="v5266_cf_tracking_firefox93" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox93-dirty">
  <select id="cf_status_firefox93" name="cf_status_firefox93">
        <option value="---"
          id="v5271_cf_status_firefox93" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox94</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox94-dirty">
  <select id="cf_tracking_firefox94" name="cf_tracking_firefox94">
        <option value="---"
          id="v5284_cf_tracking_firefox94" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox94-dirty">
  <select id="cf_status_firefox94" name="cf_status_firefox94">
        <option value="---"
          id="v5289_cf_status_firefox94" selected
        >---
        </option>
  </select></td>
      </tr>
      <tr>
        <td class="tracking-flag-name">firefox95</td>
          <td class="tracking-flag-tracking"><input type="hidden" id="cf_tracking_firefox95-dirty">
  <select id="cf_tracking_firefox95" name="cf_tracking_firefox95">
        <option value="---"
          id="v5311_cf_tracking_firefox95" selected
        >---
        </option>
  </select></td>
        <td class="tracking-flag-status"><input type="hidden" id="cf_status_firefox95-dirty">
  <select id="cf_status_firefox95" name="cf_status_firefox95">
        <option value="---"
          id="v5316_cf_status_firefox95" selected
        >---
        </option>
  </select></td>
      </tr>
  </table>
</div>
    </div>

  
</div>

</div>
  </div>
</section>



<section class="module" id="module-people"
>
    <header id="module-people-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse People section"
           data-label-collapsed="Expand People section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-people-content"
             aria-expanded="false"
             aria-labeledby="module-people-title"
             aria-describedby="module-people-subtitle"></div>
        <h2 class="module-title" id="module-people-title">People</h2>
          <h3 class="module-subtitle" id="module-people-subtitle">
            (Reporter: nils, Assigned: bzbarsky)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-people-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-hide" id="field-assigned_to"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to"><div class="vcard vcard_20209" ><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=20209" > <span class="fna">bzbarsky</span></a>
</div>
        </span>
    </div>

  
</div><div class="field edit-show" id="field-assigned_to" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to" id="assigned_to-help-link" class="help">Assignee:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-assigned_to">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-assignee" name="set_default_assignee" class="set-default"
          value="1" data-for="assigned_to">
        <label for="set-default-assignee">Reset Assignee to default</label>
      </div>
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-bug_mentors" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor" id="bug_mentors-help-link" class="help">Mentors:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_mentors">---
        </span>
    </div>

  
</div>

    <div class="field edit-show" id="field-qa_contact" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact" id="qa_contact-help-link" class="help">QA Contact:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-qa_contact">
      <div class="set-default-container" style="display:none">
        <input type="checkbox" id="set-default-qa-contact" name="set_default_qa_contact" class="set-default"
          value="1" data-for="qa_contact">
        <label for="set-default-qa-contact">Reset QA Contact to default</label>
      </div>
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-reporter"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter" id="reporter-help-link" class="help">Reporter:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-reporter">
            <div class="vcard vcard_344130" ><img src="https://secure.gravatar.com/avatar/1ac8e01cc88bca015e51fbd49a0b2df5?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=344130" > <span class="fna">nils</span></a>
</div>

        </span>
    </div>

  
</div>

    <div class="field" id="field-triage_owner"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner" id="triage_owner-help-link" class="help">Triage Owner:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-triage_owner">
            <div class="vcard vcard_434964" ><img src="https://secure.gravatar.com/avatar/331afc283e18d6d28cb7ebb11b2cf5bb?d=mm&size=40" class="gravatar" width="20" height="20"> <a class="email " href="/user_profile?user_id=434964" > <span class="fna">hsinyi</span></a>
</div>

        </span>
    </div>

  
</div>

    

    <div class="field"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc" id="-help-link" class="help">CC:
        </a>
    </div>


  
    <div class=" container">


        <span aria-owns="cc-summary cc-latch">
          <span role="button" tabindex="0" id="cc-summary" data-count="27">27 people
          </span>
        </span>


        <div id="cc-list" style="display:none"></div>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-references"
>
    <header id="module-references-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse References section"
           data-label-collapsed="Expand References section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-references-content"
             aria-expanded="false"
             aria-labeledby="module-references-title"
             aria-describedby="module-references-subtitle"></div>
        <h2 class="module-title" id="module-references-title">References</h2>
          <h3 class="module-subtitle" id="module-references-subtitle">
            (Depends on 1 open bug)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-references-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field bug-list" id="field-dependson"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson" id="dependson-help-link" class="help">Depends on:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-dependson">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_NEW"
   title="NEW - 2.46 - 8.27% compiler warnings (android-4-0-armv7-api15, android-4-2-x86, android-5-0-aarch64, android-api-15-gradle, linux32, linux64) regression on push 64ce651bf43d15e711de6e752d80702cd991b336 (Tue Jul 11 2017)"
   href="/show_bug.cgi?id=1379880">1379880</a>
      </div>

        </span>
    </div>

  
</div><div class="field bug-list" id="field-blocked"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks" id="blocked-help-link" class="help">Blocks:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-blocked">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::ParseColor"
   href="/show_bug.cgi?id=1371269">1371269</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::EnsureTarget"
   href="/show_bug.cgi?id=1371630">1371630</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">1371853</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">1371865</a>
      </div>
      <div class="bug-list">
        <span class="bug-type-label iconic" title="enhancement"
              aria-label="enhancement" data-type="enhancement">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">1371863</a>
      </div>

        </span>
    </div>

  
</div><div class="field" id="field-dependencytree"
>
    <div class="name">
    </div>


  
    <div class=" container">
        <span id="field-value-dependencytree">
        Dependency <a href="/showdependencytree.cgi?id=1371259&amp;hide_resolved=1">tree</a>
        / <a href="/showdependencygraph.cgi?id=1371259">graph</a>
        </span>
    </div>

  
</div>

    <div class="field bug-list edit-show" id="field-regresses" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses" id="regresses-help-link" class="help">Regressions:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regresses">
        ---
        </span>
    </div>

  
</div><div class="field bug-list edit-show" id="field-regressed_by" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by" id="regressed_by-help-link" class="help">Regressed by:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-regressed_by">
        ---
        </span>
    </div>

  
</div>

    <div class="field bug-list"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates" id="-help-link" class="help">Duplicates:
        </a>
    </div>


  
    <div class="value">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::ParseColor"
   href="/show_bug.cgi?id=1371269">1371269</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::EnsureTarget"
   href="/show_bug.cgi?id=1371630">1371630</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::HTMLInputElement::MaybeInitPickers"
   href="/show_bug.cgi?id=1378110">1378110</a>
      </div>

    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field edit-show" id="field-bug_file_loc" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc" id="bug_file_loc-help-link" class="help">URL:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-bug_file_loc"><div class="link">
    <a href="" target="_blank"
      rel="noreferrer" title=""
      class="bug-url" data-safe="0"></a>
  </div>
        </span>
    </div>

  
</div>

    <div class="field" id="field-see_also"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also" id="see_also-help-link" class="help">See Also:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-see_also">
            <div class="bug-list">
        <span class="bug-type-label iconic" title="defect"
              aria-label="defect" data-type="defect">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">1371865</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">1371853</a>
      </div>
      <div class="bug-list">
        <span class="bug-type-label iconic" title="enhancement"
              aria-label="enhancement" data-type="enhancement">
          <span class="icon" aria-hidden="true"></span>
        </span><a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">1371863</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - ExportHelpers has a nice long comment about FileList that doesn't match reality"
   href="/show_bug.cgi?id=1373042">1373042</a>
      </div>

        </span>
    </div>

  
</div>
</div>
  </div>
</section>


<section class="module" id="module-details"
>
    <header id="module-details-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Details section"
           data-label-collapsed="Expand Details section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-details-content"
             aria-expanded="false"
             aria-labeledby="module-details-title"
             aria-describedby="module-details-subtitle"></div>
        <h2 class="module-title" id="module-details-title">Details</h2>
          <h3 class="module-subtitle" id="module-details-subtitle">
            (Keywords: csectype-uaf, sec-critical, Whiteboard: [adv-main55+][adv-esr52.3+])
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-details-content" style="display:none"
  ><div class="fields-lhs">

    <div class="field edit-show" id="field-alias" style="display:none"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias" id="alias-help-link" class="help">Alias:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-alias">
            CVE-2017-7801

        </span>
    </div>

  
</div>

    <div class="field" id="field-keywords"
>
    <div class="name">
        <a href="/describekeywords.cgi" id="keywords-help-link" class="help">Keywords:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-keywords">
          <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a>, 
          <a href="/buglist.cgi?keywords=sec-critical&amp;resolution=---">sec-critical</a>
        </span>
    </div>

  
</div>

    <div class="field" id="field-status_whiteboard"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/Whiteboard" id="status_whiteboard-help-link" class="help">Whiteboard:
        </a>
    </div>


  
    <div class="value">
        <span id="field-value-status_whiteboard">[adv-main55+][adv-esr52.3+]
        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_qa_whiteboard" style="display:none"
>
    <div class="name">QA Whiteboard:
    </div>


  
    <div class="value">
        <span id="field-value-cf_qa_whiteboard">
        ---
        </span>
    </div>

  
</div>

    

    <div class="field edit-show" id="field-cf_has_regression_range" style="display:none"
>
    <div class="name">Has Regression Range:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_regression_range">
            ---

        </span>
    </div>

  
</div><div class="field edit-show" id="field-cf_has_str" style="display:none"
>
    <div class="name">Has STR:
    </div>


  
    <div class="value">
        <span id="field-value-cf_has_str">
            ---

        </span>
    </div>

  
</div>

    <div class="field" id="field-votes"
>
    <div class="name">
        <a href="https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes" id="votes-help-link" class="help">Votes:
        </a>
    </div>


  
    <div class=" container">
        <span id="field-value-votes">0
        </span>
    </div>

  
</div>
</div><div class="fields-rhs">

    <div class="field" id="field-bug_flags"
>
    <div class="name">Bug Flags:
    </div>


  
    <div class=" container">
        <span id="field-value-bug_flags"><div id="bug-flags" class="flags">
  <table class="layout-table">
          <tbody class="edit-hide"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
        <a href="#a3386819_1689"
            class="rel-time-title activity-ref"
            title="4 years ago"
        data-time="1499286029"
      >sec-bounty</a>
    </td>

    <td class="flag-value">+
    </td>

  </tr>
          </tbody>
          <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter"><div class="vcard vcard_1689" ><a class="email " href="/user_profile?user_id=1689" > <span class="fna">dveditz</span></a>
</div>
    </td>

    <td class="flag-name">
      <label title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug." for="flag-1607043">sec-bounty</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag-1607043-dirty">
      <select id="flag-1607043" name="flag-1607043"
        title="Flag is used to track security bug bounty nominations. Mail security(at)mozilla.org to nominate a bug."
        class="bug-flag">
            <option value="+" selected>+</option>
      </select>
    </td>


  </tr>
          </tbody>
    <tbody class="edit-show" style="display:none"><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?" for="flag_type-930">behind-pref</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-930-dirty">
      <select id="flag_type-930" name="flag_type-930"
        title="Is this bug/feature enabled in a release by a pref flag (see https://github.com/mozilla/bug-handling/blob/master/policy/feature-flags.md)?"
        class="bug-flag">
          <option value="X"></option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag tracking inclusion in the desktop Firefox product backlog." for="flag_type-846">firefox-backlog</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-846-dirty">
      <select id="flag_type-846" name="flag_type-846"
        title="Flag tracking inclusion in the desktop Firefox product backlog."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame." for="flag_type-913">sec-bounty-hof</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-913-dirty">
      <select id="flag_type-913" name="flag_type-913"
        title="Flag is used to track whether the bug report is eligible for inclusion in the Bug Bounty Hall of Fame."
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-787">in-qa-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-787-dirty">
      <select id="flag_type-787" name="flag_type-787"
        title="Whether the bug has a testcase in the qa test suite or not. Set it to &quot;in-qa-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-qa-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-qa-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>

      <td class="flag-requestee">
        <div id="requestee_type-787-container" style="display:none"><input
    name="requestee_type-787"
    value="" class="requestee bz_autocomplete_user"  id="requestee_type-787" 
  >
        </div>
      <td>

  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword." for="flag_type-37">in-testsuite</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-37-dirty">
      <select id="flag_type-37" name="flag_type-37"
        title="Whether the bug has a testcase in the test suite or not. Set it to &quot;in-testsuite?&quot; if the bug needs a testcase (only set this if the bug actually *needs* a testcase - not all bugs do, even layout bugs!), set it to &quot;in-testsuite+&quot; if the bug has an appropriate testcase, and set it to &quot;in-testsuite-&quot; if the bug doesn't need an explicit testcase (e.g. for code cleanup bugs). Only QA actively working on test cases in the component should use this keyword."
        class="bug-flag">
          <option value="X"></option>
            <option value="?" >?</option>
            <option value="+" >+</option>
            <option value="-" >-</option>
      </select>
    </td>


  </tr><tr>
    <td class="flag-setter">
    </td>

    <td class="flag-name">
      <label title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually" for="flag_type-864">qe-verify</label>
    </td>

    <td class="flag-value">
      <input type="hidden" id="flag_type-864-dirty">
      <select id="flag_type-864" name="flag_type-864"
        title="qe-verify: ? ➜ request to assess whether the bug should be tested manually
qe-verify: + ➜ request to verify the bug manually
qe-verify: – ➜ the bug will not/can not be verified manually"
          disabled
        class="bug-flag">
          <option value="X"></option>
      </select>
    </td>


  </tr>
    </tbody>
  </table>
</div>
        </span>
    </div>

  
</div>
</div>

  
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-crash-data"
>
    <header id="module-crash-data-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Crash Data section"
           data-label-collapsed="Expand Crash Data section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-crash-data-content"
             aria-expanded="false"
             aria-labeledby="module-crash-data-title"
             aria-describedby="module-crash-data-subtitle"></div>
        <h2 class="module-title" id="module-crash-data-title">Crash Data</h2>
      </div>
    </header>
  <div class="module-content" id="module-crash-data-content" style="display:none"
  ><div class="field edit-show" id="field-cf_crash_signature" style="display:none"
>
    <div class="name">Signature:
    </div>


  
    <div class="value">
        <span id="field-value-cf_crash_signature">
        </span>
    </div>

  
</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-security"
>
    <header id="module-security-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Security section"
           data-label-collapsed="Expand Security section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-security-content"
             aria-expanded="false"
             aria-labeledby="module-security-title"
             aria-describedby="module-security-subtitle"></div>
        <h2 class="module-title" id="module-security-title">Security</h2>
          <h3 class="module-subtitle" id="module-security-subtitle">
            (public)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-security-content" style="display:none"
  ><div class="groups edit-hide">
    This bug is publicly visible.
</div>

<div class="groups edit-show" style="display:none">


</div>
  </div>
</section>


<section class="module edit-show" style="display:none" id="module-user-story" data-non-stick="1"
>
    <header id="module-user-story-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse User Story section"
           data-label-collapsed="Expand User Story section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-user-story-content"
             aria-expanded="false"
             aria-labeledby="module-user-story-title"
             aria-describedby="module-user-story-subtitle"></div>
        <h2 class="module-title" id="module-user-story-title">User Story</h2>
      </div>
    </header>
  <div class="module-content" id="module-user-story-content" style="display:none"
  >
    <pre id="user-story"></pre>
  </div>
</section>







<section class="module" id="module-attachments"
>
    <header id="module-attachments-header" class="module-header">
      <div class="module-latch"
           data-label-expanded="Collapse Attachments section"
           data-label-collapsed="Expand Attachments section">
        <div class="module-spinner" role="button" tabindex="0"
             aria-controls="module-attachments-content"
             aria-expanded="true"
             aria-labeledby="module-attachments-title"
             aria-describedby="module-attachments-subtitle"></div>
        <h2 class="module-title" id="module-attachments-title">Attachments</h2>
          <h3 class="module-subtitle" id="module-attachments-subtitle">
            (22 files, 19 obsolete files)
          </h3>
      </div>
    </header>
  <div class="module-content" id="module-attachments-content"
  ><table role="table" class="layout-table" id="attachments">
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8875704">crash.html</a>
        </div>
        <div>
            <a href="#c0" class="attach-time activity-ref"><span class="rel-time" title="2017-06-08 05:52 PDT" data-time="1496926379">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_344130" ><a class="email " href="/user_profile?user_id=344130" > <span class="fna">Nils</span></a>
</div></span>
        </div>
        <div class="attach-info">772 bytes,
          text/html        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8875704&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8875705">ASAN stacks</a>
        </div>
        <div>
            <a href="#c1" class="attach-time activity-ref"><span class="rel-time" title="2017-06-08 05:53 PDT" data-time="1496926412">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_344130" ><a class="email " href="/user_profile?user_id=344130" > <span class="fna">Nils</span></a>
</div></span>
        </div>
        <div class="attach-info">21.67 KB,
          text/plain        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8875705&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876011">(not a fix) Patch to make bug reproduce on trunk [like it does on ESR]</a>
        </div>
        <div>
            <a href="#c8" class="attach-time activity-ref"><span class="rel-time" title="2017-06-08 22:48 PDT" data-time="1496987333">5 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">2.60 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876011&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8876011&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876011">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876221">(not a fix) Patch to make bug reproduce on trunk [like it does on ESR].</a>
        </div>
        <div>
            <a href="#c9" class="attach-time activity-ref"><span class="rel-time" title="2017-06-09 10:29 PDT" data-time="1497029346">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">3.57 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876221&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8876221&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876221">Splinter Review</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876223">ASAN report + backtrace, for trunk</a>
        </div>
        <div>
            <a href="#c10" class="attach-time activity-ref"><span class="rel-time" title="2017-06-09 10:31 PDT" data-time="1497029468">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">23.90 KB,
          text/plain        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876223&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876242">testcase 2 (reduced / made more human-readable)</a>
        </div>
        <div>
            <a href="#c11" class="attach-time activity-ref"><span class="rel-time" title="2017-06-09 11:13 PDT" data-time="1497032003">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">1012 bytes,
          text/html        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876242&amp;action=edit">Details</a>
    </tr>
    <tr class="
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876333">dholbert's build of domFuzzLite3.xpi (extension required for testcases to reproduce the crash)</a>
        </div>
        <div>
            <a href="#c23" class="attach-time activity-ref"><span class="rel-time" title="2017-06-09 16:01 PDT" data-time="1497049308">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">12.27 KB,
          application/x-xpinstall        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876333&amp;action=edit">Details</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876851">(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]</a>
        </div>
        <div>
            <a href="#c26" class="attach-time activity-ref"><span class="rel-time" title="2017-06-12 12:42 PDT" data-time="1497296535">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_278074" ><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div></span>
        </div>
        <div class="attach-info">4.03 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876851&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8876851&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876851">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876987">Work in progress</a>
        </div>
        <div>
            <a href="#c27" class="attach-time activity-ref"><span class="rel-time" title="2017-06-12 21:42 PDT" data-time="1497328930">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">42.20 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876987&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8876987&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876987">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8876988">WIP with some updates; still missing the non-owning union bits</a>
        </div>
        <div>
            <a href="#c28" class="attach-time activity-ref"><span class="rel-time" title="2017-06-12 22:00 PDT" data-time="1497330036">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">43.24 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8876988&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8876988&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876988">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877298">Compiling patch that should fix this bug</a>
        </div>
        <div>
            <a href="#c30" class="attach-time activity-ref"><span class="rel-time" title="2017-06-13 13:14 PDT" data-time="1497384843">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">65.67 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_278074" ><span class="fn">dholbert</span>
</div>:
              <a href="#c31"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497389490"
            >
              feedback+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877298&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877298&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877298">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877893">part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper</a>
        </div>
        <div>
            <a href="#c37" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507685">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">20.40 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#c57"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507685"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877893&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877893&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877893">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877894">part 2.  Change union conversions for non-owning unions to pass a MutableHandle through to the underlying conversion code</a>
        </div>
        <div>
            <a href="#c38" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507697">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.47 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#a1019942_24295"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507697"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877894&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877894&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877894">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877895">part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites</a>
        </div>
        <div>
            <a href="#c39" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507710">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">50.62 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#c58"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507710"
            >
              review+</a>
          </div>
          <div class="attach-flag"><div class="vcard vcard_280903" ><span class="fn">abillings</span>
</div>:
              <a href="#c53"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497508914"
            >
              sec-approval+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877895&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877895&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877895">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877896">part 4.  Stop using UnwrapArg to unwrap this values</a>
        </div>
        <div>
            <a href="#c40" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507726">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">7.28 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#a1189676_24295"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507726"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877896&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877896&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877896">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877897">part 5.  Use a safer implementation of IsFileList</a>
        </div>
        <div>
            <a href="#c41" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507736">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.79 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#a1189584_24295"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507736"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877897&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877897&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877897">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877898">part 6.  Root the unwrapped object in PRE_HELPER_STUB</a>
        </div>
        <div>
            <a href="#c42" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507776">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.67 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877898&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877898&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877898">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877899">part 7.  Root the unwrapped object in XPCConvert code</a>
        </div>
        <div>
            <a href="#c43" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:23 PDT" data-time="1497507818">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">1.60 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877899&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877899&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877899">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877900">part 8.  Get rid of nsIXPConnect::GetNativeOfWrapper</a>
        </div>
        <div>
            <a href="#c44" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:23 PDT" data-time="1497507836">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">14.36 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#a1192337_24295"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507836"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877900&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877900&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877900">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877901">part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;</a>
        </div>
        <div>
            <a href="#c45" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:24 PDT" data-time="1497507857">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">12.83 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#c60"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1497507857"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877901&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877901&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877901">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877902">Rollup patch for convenience</a>
        </div>
        <div>
            <a href="#c46" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:25 PDT" data-time="1497507937">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">92.98 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877902&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877902&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877902">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877903">Part 3 diff -w, for possible review convenience</a>
        </div>
        <div>
            <a href="#c47" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:26 PDT" data-time="1497507974">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">50.22 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877903&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877903&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877903">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877904">Rollup patch for beta</a>
        </div>
        <div>
            <a href="#c48" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:27 PDT" data-time="1497508025">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.23 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877904&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877904&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877904">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877905">Rollup patch for 54 release</a>
        </div>
        <div>
            <a href="#c49" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:27 PDT" data-time="1497508077">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.00 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877905&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877905&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877905">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8877906">Rollup patch for ESR52</a>
        </div>
        <div>
            <a href="#c50" class="attach-time activity-ref"><span class="rel-time" title="2017-06-14 23:28 PDT" data-time="1497508103">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">91.28 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8877906&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8877906&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877906">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880535">Addresses review comments on part 3; could use another look</a>
        </div>
        <div>
            <a href="#c62" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 13:04 PDT" data-time="1498161893">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">5.80 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#c69"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1498161893"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880535&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880535&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880535">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880595">Part 1 updated to review comments</a>
        </div>
        <div>
            <a href="#c63" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 15:11 PDT" data-time="1498169505">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">20.58 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880595&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880595&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880595">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880596">Part 3 updated to review comments</a>
        </div>
        <div>
            <a href="#c64" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169526">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">49.93 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880596&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880596&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880596">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880597">Part 9 updated to review comments</a>
        </div>
        <div>
            <a href="#c65" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169554">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">13.04 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880597&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880597&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880597">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880598">Updated esr52 rollup fix</a>
        </div>
        <div>
            <a href="#c66" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169649">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">91.08 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880598&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880598&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880598">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880599">Updated release channel rollup fix</a>
        </div>
        <div>
            <a href="#c67" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169665">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">92.81 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880599&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880599&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880599">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8880618">Updated beta channel rollup fix</a>
        </div>
        <div>
            <a href="#c68" class="attach-time activity-ref"><span class="rel-time" title="2017-06-22 16:01 PDT" data-time="1498172488">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.04 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8880618&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8880618&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880618">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884915">Updated esr52 rollup fix</a>
        </div>
        <div>
            <a href="#c71" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709091">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">91.42 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884915&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884915&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884915">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884916">Updated beta channel rollup fix</a>
        </div>
        <div>
            <a href="#c72" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709105">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.38 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884916&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884916&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884916">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884917">Updated release channel rollup fix</a>
        </div>
        <div>
            <a href="#c73" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 10:52 PDT" data-time="1499709121">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.15 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884917&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884917&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884917">Splinter Review</a>
    </tr>
    <tr class=" attach-obsolete attach-patch
    " style="display:none">
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884918">Part 3 updated to tip</a>
        </div>
        <div>
            <a href="#c77" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 11:02 PDT" data-time="1499709751">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">48.12 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884918&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884918&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884918">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8884955">Part 3 really merged to tip</a>
        </div>
        <div>
            <a href="#c78" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 11:59 PDT" data-time="1499713199">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">49.86 KB,
          patch        </div>
      </td>
      <td>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8884955&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8884955&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884955">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885007">Minor update to fix gc hazards</a>
        </div>
        <div>
            <a href="#c80" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 15:03 PDT" data-time="1499724235">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">2.01 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_24295" ><span class="fn">peterv</span>
</div>:
              <a href="#a2832942_24295"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499724235"
            >
              review+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885007&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885007&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885007">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885065">ESR52 patch updated to fix rooting hazard</a>
        </div>
        <div>
            <a href="#c82" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733151">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">91.83 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_451704" ><span class="fn">lizzard</span>
</div>:
              <a href="#c89"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499733224"
            >
              approval-mozilla-esr52+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885065&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885065&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885065">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885066">release patch updated to fix rooting hazard</a>
        </div>
        <div>
            <a href="#c83" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733175">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.56 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_506302" ><span class="fn">gchang</span>
</div>:
              <a href="#c88"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499733231"
            >
              approval-mozilla-release-</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885066&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885066&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885066">Splinter Review</a>
    </tr>
    <tr class=" attach-patch
    " >
      <td class="attach-desc-td">
        <div class="attach-desc">
            <a href="/attachment.cgi?id=8885067">beta patch updated to fix rooting hazard</a>
        </div>
        <div>
            <a href="#c84" class="attach-time activity-ref"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733192">4 years ago</span></a>
          <span class="attach-author"><div class="vcard vcard_20209" ><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div></span>
        </div>
        <div class="attach-info">93.79 KB,
          patch        </div>
      </td>
      <td>
          <div class="attach-flag"><div class="vcard vcard_580382" ><span class="fn">jcristau</span>
</div>:
              <a href="#c86"
                  class="flag-name-status rel-time-title activity-ref"
                  title="4 years ago"
              data-time="1499733236"
            >
              approval-mozilla-beta+</a>
          </div>
      </td>
      <td class="attach-actions">
        <a href="/attachment.cgi?id=8885067&amp;action=edit">Details</a>
          | <a href="/attachment.cgi?id=8885067&amp;action=diff">Diff</a>&#x0020; |
  <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885067">Splinter Review</a>
    </tr>
</table>

<footer id="attachments-footer">
  <div id="attachments-actions">
      <button type="button" id="attachments-obsolete-btn" class="secondary">Show Obsolete</button>
  </div>
  
</footer>
  </div>
</section>



<script nonce="dUAg54LdwxlVUQ1E2nlK0ZNfM1JeY8swPAzgAb9W8n12feEO">
  init_module_visibility();
</script>



<meta name="firefox-versions" content="{&quot;FIREFOX_AURORA&quot;:&quot;&quot;,&quot;FIREFOX_DEVEDITION&quot;:&quot;94.0b9&quot;,&quot;FIREFOX_ESR&quot;:&quot;78.15.0esr&quot;,&quot;FIREFOX_ESR_NEXT&quot;:&quot;91.2.0esr&quot;,&quot;FIREFOX_NIGHTLY&quot;:&quot;95.0a1&quot;,&quot;FIREFOX_PINEBUILD&quot;:&quot;&quot;,&quot;LAST_MERGE_DATE&quot;:&quot;2021-10-04&quot;,&quot;LAST_RELEASE_DATE&quot;:&quot;2021-10-05&quot;,&quot;LAST_SOFTFREEZE_DATE&quot;:&quot;2021-09-30&quot;,&quot;LATEST_FIREFOX_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_OLDER_VERSION&quot;:&quot;3.6.28&quot;,&quot;LATEST_FIREFOX_RELEASED_DEVEL_VERSION&quot;:&quot;94.0b9&quot;,&quot;LATEST_FIREFOX_VERSION&quot;:&quot;93.0&quot;,&quot;NEXT_MERGE_DATE&quot;:&quot;2021-11-01&quot;,&quot;NEXT_RELEASE_DATE&quot;:&quot;2021-11-02&quot;,&quot;NEXT_SOFTFREEZE_DATE&quot;:&quot;2021-10-28&quot;}">


<div id="comment-actions">
    <button type="button" id="bottom-btn" class="secondary" aria-label="Go to Page Bottom">Bottom &darr;</button>
  <div class="dropdown">
    <button type="button" id="comment-tags-btn" aria-haspopup="true" aria-label="Tags"
      aria-expanded="false" aria-controls="comment-tags-menu" class="dropdown-button minor">Tags &#9662;</button>
    <ul id="comment-tags-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a role="menuitem" tabindex="-1" data-comment-tag="">Reset</a>
      </li>
    </ul>
  </div>
  <div class="dropdown">
    <button type="button" id="view-menu-btn" aria-haspopup="true" aria-label="Timeline"
      aria-expanded="false" aria-controls="view-menu" class="dropdown-button minor">Timeline &#9662;</button>
    <ul id="view-menu" role="menu" tabindex="0" class="dropdown-content left" style="display:none">
      <li role="presentation">
        <a id="view-reset" role="menuitem" tabindex="-1">Reset</a>
      </li>
      <li role="separator"></li>
      <li role="presentation">
        <a id="view-collapse-all" role="menuitem" tabindex="-1">Collapse All</a>
      </li>
      <li role="presentation">
        <a id="view-expand-all" role="menuitem" tabindex="-1">Expand All</a>
      </li>
      <li role="presentation">
        <a id="view-comments-only" role="menuitem" tabindex="-1">Comments Only</a>
      </li>
    </ul>
   </div>
</div>
<div class="change-set" id="c0"><div class="comment" data-id="12382451" data-no="0"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-0" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_344130" ><img src="https://secure.gravatar.com/avatar/1ac8e01cc88bca015e51fbd49a0b2df5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_344130" ><a class="email " href="/user_profile?user_id=344130" > <span class="fna">Nils</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-0"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-0" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c0">Description</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 05:52 PDT" data-time="1496926379">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-0">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8875704"
         class="attachment"
         data-id="8875704" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="crash.html">
      <meta itemprop="contentSize" content="772">
      <meta itemprop="encodingFormat" content="text/html">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8875704" itemprop="contentUrl">
        <span id="att-8875704-description" itemprop="description">crash.html</span></a>
        — <a href="attachment.cgi?id=8875704&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-0" data-comment-id="12382451">The following testcase crashes the latest ASAN build of Firefox ESR 52.2.0 (20170607010726)

&lt;script&gt;
function start() {
	o0=window.open('data:text/html,&lt;div&gt;','popup65','height=88,width=131081,top=46,outerHeight=-1024,toolbar,resizable');
	o1=window.open('data:text/html,&lt;div&gt;','popup73','height=-1,width=64,outerHeight=38,outerWidth=-8,toolbar,resizable');
	o1.onload=fun0;
}
function fun0(e) {
	o5=o0.document;
	o0.onresize=fun1;
	o45=o5.querySelector('*:not([id])');
	o95=document.createElementNS('<a rel="nofollow" href="http://www.w3.org/1999/xhtml','marquee">http://www.w3.org/1999/xhtml','marquee</a>');
	o45.appendChild(o95);
	o0.resizeBy(8,4194304);
}
function fun1() {
	o0.close();
	o1.open('data:text/html,&lt;div&gt;','popup3','width=1,left=32768,menubar,toolbar,personalbar,status,resizable');
	fuzzPriv.GC();fuzzPriv.CC();fuzzPriv.GC();fuzzPriv.CC();
}
&lt;/script&gt;
&lt;body onload=&quot;start()&quot;&gt;&lt;/body&gt;
=================================================================
==1349==ERROR: AddressSanitizer: heap-use-after-free on address 0x60c0008a1ea0 at pc 0x7f65e45838b1 bp 0x7fff56b07810 sp 0x7fff56b07808
WRITE of size 8 at 0x60c0008a1ea0 thread T0
    #0 0x7f65e45838b0 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:639:14
    #1 0x7f65e4583efb in nsComputedDOMStyle::GetPropertyCSSValue(nsAString_internal const&amp;, mozilla::ErrorResult&amp;) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:796:3
    #2 0x7f65e4582196 in nsComputedDOMStyle::GetPropertyValue(nsAString_internal const&amp;, nsAString_internal&amp;) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:379:26
    #3 0x7f65e4581fb8 in nsComputedDOMStyle::GetPropertyValue(nsCSSPropertyID, nsAString_internal&amp;) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:317:10
    #4 0x7f65e0ed3ae9 in GetWidth /home/worker/workspace/build/src/layout/style/nsCSSPropList.h:4392:1
    #5 0x7f65e0ed3ae9 in mozilla::dom::CSS2PropertiesBinding::get_width(JSContext*, JS::Handle&lt;JSObject*&gt;, nsDOMCSSDeclaration*, JSJitGetterCallArgs) /home/worker/workspace/build/src/obj-firefox/dom/bindings/CSS2PropertiesBinding.cpp:42528
    #6 0x7f65e243ce3d in mozilla::dom::GenericBindingGetter(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/dom/bindings/BindingUtils.cpp:2813:13
    #7 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
    #8 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447
    #9 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #10 0x7f65e828c12d in JS::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12
    #11 0x7f65df404ea2 in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3330:12
    #12 0x7f65df404ea2 in xpc::XrayWrapper&lt;js::CrossCompartmentWrapper, xpc::DOMXrayTraits&gt;::get(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;jsid&gt;, JS::MutableHandle&lt;JS::Value&gt;) const /home/worker/workspace/build/src/js/xpconnect/wrappers/XrayWrapper.cpp:2247
    #13 0x7f65e85043ee in js::Proxy::get(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;jsid&gt;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:309:12
    #14 0x7f65e850478c in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16
    #15 0x7f65e850478c in js::Proxy::get(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;jsid&gt;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:305
    #16 0x7f65e87c65e1 in GetProperty /home/worker/workspace/build/src/js/src/vm/NativeObject.h:1522:16
    #17 0x7f65e87c65e1 in GetProperty /home/worker/workspace/build/src/js/src/jsobj.h:846
    #18 0x7f65e87c65e1 in js::GetProperty(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;js::PropertyName*&gt;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:4263
    #19 0x7f65e879eb9c in GetPropertyOperation /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:192:12
    #20 0x7f65e879eb9c in Interpret(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2639
    #21 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12
    #22 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15
    #23 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #24 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12
    #25 0x7f65e3cb130b in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14
    #26 0x7f65e3cb130b in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331
    #27 0x7f65e3c7b24e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5
    #28 0x7f65e3c7b04e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7
    #29 0x7f65e4aa5009 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5
    #30 0x7f65e4aa5009 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4167
    #31 0x7f65e47b721c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11
    #32 0x7f65e47c3a61 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray&lt;RefPtr&lt;nsRefreshDriver&gt; &gt;&amp;) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7
    #33 0x7f65e47c34f5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5
    #34 0x7f65e47c601e in applyImpl&lt;mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue&lt;mozilla::TimeStamp&gt; , 0&gt; /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12
    #35 0x7f65e47c601e in apply&lt;mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)&gt; /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781
    #36 0x7f65e47c601e in mozilla::detail::RunnableMethodImpl&lt;void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp&gt;::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810
    #37 0x7f65ddd178bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7
    #38 0x7f65ddd999fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10
    #39 0x7f65deb5140f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21
    #40 0x7f65deac2fc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3
    #41 0x7f65deac2fc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225
    #42 0x7f65deac2fc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205
    #43 0x7f65e40ec19f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3
    #44 0x7f65e6166451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19
    #45 0x7f65e62fd757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10
    #46 0x7f65e62feecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8
    #47 0x7f65e62ffd8c in XRE_main /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4712:16
    #48 0x4df91a in do_main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:282:10
    #49 0x4df91a in main /home/worker/workspace/build/src/browser/app/nsBrowserApp.cpp:415
    #50 0x7f65f8fc182f in __libc_start_main /build/glibc-9tT8Do/glibc-2.23/csu/../csu/libc-start.c:291
    #51 0x41ba88 in _start (/home/nils/fuzzer3/esr/firefox/firefox+0x41ba88)

0x60c0008a1ea0 is located 96 bytes inside of 128-byte region [0x60c0008a1e40,0x60c0008a1ec0)
freed by thread T0 here:
    #0 0x4b21db in __interceptor_free /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:38:3
    #1 0x7f65ddbe0354 in SnowWhiteKiller::~SnowWhiteKiller() /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2665:9
    #2 0x7f65ddbdff46 in nsCycleCollector::FreeSnowWhite(bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:2840:3
    #3 0x7f65ddbe701e in nsCycleCollector::BeginCollection(ccType, nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3826:3
    #4 0x7f65ddbe64dc in nsCycleCollector::Collect(ccType, js::SliceBudget&amp;, nsICycleCollectorListener*, bool) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:3651:9
    #5 0x7f65ddbea556 in nsCycleCollector_collect(nsICycleCollectorListener*) /home/worker/workspace/build/src/xpcom/base/nsCycleCollector.cpp:4144:3
    #6 0x7f65e0a7cb19 in nsJSContext::CycleCollectNow(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsJSEnvironment.cpp:1440:3
    #7 0x7f65e05aa55d in nsDOMWindowUtils::CycleCollect(nsICycleCollectorListener*, int) /home/worker/workspace/build/src/dom/base/nsDOMWindowUtils.cpp:1340:3
    #8 0x7f65ddd3fec6 in NS_InvokeByIndex /home/worker/workspace/build/src/xpcom/reflect/xptcall/md/unix/xptcinvoke_x86_64_unix.cpp:180:23
    #9 0x7f65df562fbe in Invoke /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:2058:12
    #10 0x7f65df562fbe in Call /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1377
    #11 0x7f65df562fbe in XPCWrappedNative::CallMethod(XPCCallContext&amp;, XPCWrappedNative::CallMode) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNative.cpp:1344
    #12 0x7f65df56a648 in XPC_WN_CallMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/XPCWrappedNativeJSOps.cpp:999:12
    #13 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
    #14 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447
    #15 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12
    #16 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
    #17 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12
    #18 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15
    #19 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #20 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12
    #21 0x7f65df48b8af in xpc::FunctionForwarder(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/xpconnect/src/ExportHelpers.cpp:319:18
    #22 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
    #23 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447
    #24 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12
    #25 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
    #26 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12
    #27 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15
    #28 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #29 0x7f65e852960c in js::Wrapper::call(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::CallArgs const&amp;) const /home/worker/workspace/build/src/js/src/proxy/Wrapper.cpp:165:12
    #30 0x7f65e84f8f5f in js::CrossCompartmentWrapper::call(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::CallArgs const&amp;) const /home/worker/workspace/build/src/js/src/proxy/CrossCompartmentWrapper.cpp:333:14
    #31 0x7f65e850672f in js::Proxy::call(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::CallArgs const&amp;) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:400:12
    #32 0x7f65e8508ede in js::proxy_Call(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/js/src/proxy/Proxy.cpp:689:12
    #33 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
    #34 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447
    #35 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #36 0x7f65e828c12d in JS::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/jsapi.cpp:2828:12

previously allocated by thread T0 here:
    #0 0x4b24fb in malloc /builds/slave/moz-toolchain/src/llvm/projects/compiler-rt/lib/asan/asan_malloc_linux.cc:52:3
    #1 0x4e0ded in moz_xmalloc /home/worker/workspace/build/src/memory/mozalloc/mozalloc.cpp:83:17
    #2 0x7f65e458003a in operator new /home/worker/workspace/build/src/obj-firefox/dist/include/mozilla/mozalloc.h:194:12
    #3 0x7f65e458003a in NS_NewComputedDOMStyle(mozilla::dom::Element*, nsAString_internal const&amp;, nsIPresShell*, nsComputedDOMStyle::StyleType) /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:72
    #4 0x7f65e066c40d in nsGlobalWindow::GetComputedStyleHelperOuter(mozilla::dom::Element&amp;, nsAString_internal const&amp;, bool) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10814:5
    #5 0x7f65e066be90 in nsGlobalWindow::GetComputedStyleHelper(mozilla::dom::Element&amp;, nsAString_internal const&amp;, bool, mozilla::ErrorResult&amp;) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10827:3
    #6 0x7f65e066bb56 in nsGlobalWindow::GetComputedStyle(mozilla::dom::Element&amp;, nsAString_internal const&amp;, mozilla::ErrorResult&amp;) /home/worker/workspace/build/src/dom/base/nsGlobalWindow.cpp:10743:10
    #7 0x7f65e1bea044 in mozilla::dom::WindowBinding::getComputedStyle(JSContext*, JS::Handle&lt;JSObject*&gt;, nsGlobalWindow*, JSJitMethodCallArgs const&amp;) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:3162:49
    #8 0x7f65e1be3634 in mozilla::dom::WindowBinding::genericMethod(JSContext*, unsigned int, JS::Value*) /home/worker/workspace/build/src/obj-firefox/dom/bindings/WindowBinding.cpp:15157:13
    #9 0x7f65e87ba2e5 in CallJSNative /home/worker/workspace/build/src/js/src/jscntxtinlines.h:239:15
    #10 0x7f65e87ba2e5 in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:447
    #11 0x7f65e879a6ef in CallFromStack /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:510:12
    #12 0x7f65e879a6ef in Interpret(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:2922
    #13 0x7f65e877f8ad in js::RunScript(JSContext*, js::RunState&amp;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:405:12
    #14 0x7f65e87ba94f in js::InternalCallOrConstruct(JSContext*, JS::CallArgs const&amp;, js::MaybeConstruct) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:477:15
    #15 0x7f65e87baf92 in js::Call(JSContext*, JS::Handle&lt;JS::Value&gt;, JS::Handle&lt;JS::Value&gt;, js::AnyInvokeArgs const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/vm/Interpreter.cpp:523:10
    #16 0x7f65e8289ec2 in JS_CallFunctionValue(JSContext*, JS::Handle&lt;JSObject*&gt;, JS::Handle&lt;JS::Value&gt;, JS::HandleValueArray const&amp;, JS::MutableHandle&lt;JS::Value&gt;) /home/worker/workspace/build/src/js/src/jsapi.cpp:2769:12
    #17 0x7f65e3cb130b in Call /home/worker/workspace/build/src/obj-firefox/dist/include/jsapi.h:3310:14
    #18 0x7f65e3cb130b in nsXBLProtoImplAnonymousMethod::Execute(nsIContent*, JSAddonId*) /home/worker/workspace/build/src/dom/xbl/nsXBLProtoImplMethod.cpp:331
    #19 0x7f65e3c7b24e in nsXBLBinding::ExecuteAttachedHandler() /home/worker/workspace/build/src/dom/xbl/nsXBLBinding.cpp:634:5
    #20 0x7f65e3c7b04e in nsBindingManager::ProcessAttachedQueueInternal(unsigned int) /home/worker/workspace/build/src/dom/xbl/nsBindingManager.cpp:419:7
    #21 0x7f65e4aa5009 in ProcessAttachedQueue /home/worker/workspace/build/src/dom/xbl/nsBindingManager.h:105:5
    #22 0x7f65e4aa5009 in PresShell::FlushPendingNotifications(mozilla::ChangesToFlush) /home/worker/workspace/build/src/layout/base/nsPresShell.cpp:4167
    #23 0x7f65e47b721c in nsRefreshDriver::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:1836:11
    #24 0x7f65e47c3a61 in mozilla::RefreshDriverTimer::TickRefreshDrivers(long, mozilla::TimeStamp, nsTArray&lt;RefPtr&lt;nsRefreshDriver&gt; &gt;&amp;) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:295:7
    #25 0x7f65e47c34f5 in mozilla::RefreshDriverTimer::Tick(long, mozilla::TimeStamp) /home/worker/workspace/build/src/layout/base/nsRefreshDriver.cpp:316:5
    #26 0x7f65e47c601e in applyImpl&lt;mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), StoreCopyPassByValue&lt;mozilla::TimeStamp&gt; , 0&gt; /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:775:12
    #27 0x7f65e47c601e in apply&lt;mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver, void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp)&gt; /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:781
    #28 0x7f65e47c601e in mozilla::detail::RunnableMethodImpl&lt;void (mozilla::VsyncRefreshDriverTimer::RefreshDriverVsyncObserver::*)(mozilla::TimeStamp), true, false, mozilla::TimeStamp&gt;::Run() /home/worker/workspace/build/src/obj-firefox/dist/include/nsThreadUtils.h:810
    #29 0x7f65ddd178bb in nsThread::ProcessNextEvent(bool, bool*) /home/worker/workspace/build/src/xpcom/threads/nsThread.cpp:1216:7
    #30 0x7f65ddd999fc in NS_ProcessNextEvent(nsIThread*, bool) /home/worker/workspace/build/src/xpcom/glue/nsThreadUtils.cpp:361:10
    #31 0x7f65deb5140f in mozilla::ipc::MessagePump::Run(base::MessagePump::Delegate*) /home/worker/workspace/build/src/ipc/glue/MessagePump.cpp:96:21
    #32 0x7f65deac2fc8 in RunInternal /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:232:3
    #33 0x7f65deac2fc8 in RunHandler /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:225
    #34 0x7f65deac2fc8 in MessageLoop::Run() /home/worker/workspace/build/src/ipc/chromium/src/base/message_loop.cc:205
    #35 0x7f65e40ec19f in nsBaseAppShell::Run() /home/worker/workspace/build/src/widget/nsBaseAppShell.cpp:156:3
    #36 0x7f65e6166451 in nsAppStartup::Run() /home/worker/workspace/build/src/toolkit/components/startup/nsAppStartup.cpp:283:19
    #37 0x7f65e62fd757 in XREMain::XRE_mainRun() /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4488:10
    #38 0x7f65e62feecd in XREMain::XRE_main(int, char**, nsXREAppData const*) /home/worker/workspace/build/src/toolkit/xre/nsAppRunner.cpp:4621:8

SUMMARY: AddressSanitizer: heap-use-after-free /home/worker/workspace/build/src/layout/style/nsComputedDOMStyle.cpp:639:14 in nsComputedDOMStyle::UpdateCurrentStyleSources(bool)
Shadow bytes around the buggy address:
  0x0c188010c380: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c188010c390: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
  0x0c188010c3a0: fd fd fd fd fd fd fd fd fa fa fa fa fa fa fa fa
  0x0c188010c3b0: fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd fd
  0x0c188010c3c0: fa fa fa fa fa fa fa fa fd fd fd fd fd fd fd fd
=&gt;0x0c188010c3d0: fd fd fd fd[fd]fd fd fd fa fa fa fa fa fa fa fa
  0x0c188010c3e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c188010c3f0: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
  0x0c188010c400: 00 00 00 00 00 00 00 00 fa fa fa fa fa fa fa fa
  0x0c188010c410: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0c188010c420: fa fa fa fa fa fa fa fa 00 00 00 00 00 00 00 00
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Heap right redzone:      fb
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack partial redzone:   f4
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
==1349==ABORTING</pre></div><div class="change-set" id="c1"><div class="comment" data-id="12382453" data-no="1"
       data-tags="">
    
    <table class="layout-table change-head reporter" id="ch-1" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_344130" ><img src="https://secure.gravatar.com/avatar/1ac8e01cc88bca015e51fbd49a0b2df5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_344130" ><a class="email " href="/user_profile?user_id=344130" > <span class="fna">Nils</span></a>
</div>
              <span class="user-role">Reporter</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-1" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c1">Comment 1</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 05:53 PDT" data-time="1496926412">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-1">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8875705"
         class="attachment"
         data-id="8875705" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="asan.txt">
      <meta itemprop="contentSize" content="22195">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8875705" itemprop="contentUrl">
        <span id="att-8875705-description" itemprop="description">ASAN stacks</span></a>
        — <a href="attachment.cgi?id=8875705&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div></div><div class="change-set" id="a15601_406194"><div class="change" id="aa15601_406194">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_406194" id="a15601_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a15601_406194"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a15601_406194">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a15601_406194">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 10:13 PDT" data-time="1496941980">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: core-security &rarr; layout-core-security</div><div class="change">Component: DOM &rarr; CSS Parsing and Computation</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=csectype-uaf&amp;resolution=---">csectype-uaf</a></div></div></div><div class="change-set" id="c2"><div class="comment" data-id="12383297" data-no="2"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-2" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a15601_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-2"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-2" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c2">Comment 2</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 10:17 PDT" data-time="1496942272">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-2">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-2" data-comment-id="12383297">Heycam, can you take a look?</pre><div class="activity"><div class="change">Flags: needinfo?(cam)</div><div class="change">Keywords: <a href="/buglist.cgi?keywords=sec-critical&amp;resolution=---">sec-critical</a></div></div></div><div class="change-set" id="c3"><div class="comment" data-id="12384333" data-no="3"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-3" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a15601_406194"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-3"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-3" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c3">Comment 3</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 15:21 PDT" data-time="1496960467">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-3">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-3" data-comment-id="12384333">I'm taking a look...  NOTE: the testcase requires the domfuzz extension to be installed (which I built locally by running &quot;make&quot; in this directory: <a rel="nofollow" href="https://github.com/MozillaSecurity/domfuzz/tree/master/dom/extension">https://github.com/MozillaSecurity/domfuzz/tree/master/dom/extension</a> ).

I can reproduce in ESR52 -- the latest esr52 release (no ASAN required).  It just crashes within a second or two, when I load the testcase.[1]

I can also trigger the reported ASAN issue in local opt builds of ESR52 (with &amp; without ASAN).

HOWEVER:
I don't get a crash in stock Nightly, nor in mozilla-central rewound to an arbitrary Firefox 52-era cset, nor in an arbitrary Aurora 52 build that I tested:
<a rel="nofollow" href="https://archive.mozilla.org/pub/firefox/nightly/2016/11/2016-11-30-00-40-19-mozilla-aurora/firefox-52.0a2.en-US.linux-x86_64.tar.bz2">https://archive.mozilla.org/pub/firefox/nightly/2016/11/2016-11-30-00-40-19-mozilla-aurora/firefox-52.0a2.en-US.linux-x86_64.tar.bz2</a>

(I can't test Release 52 or Beta 52 because they don't accept unsigned extensions and there's no way to make them do so, AFAICT.)

So this is either something that briefly affected 52 and was subsequently fixed [and ESR52 needs the fix], or it might be a regression that just happened on the 52 branch [and maybe on beta/release but we can't tell because they won't accept the extension which is required to run the testcase].</pre></div><div class="change-set" id="c4"><div class="comment" data-id="12384344" data-no="4"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-4" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a15601_406194"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-4"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-4" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c4">Comment 4</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 15:24 PDT" data-time="1496960642">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-4">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-4" data-comment-id="12384344">I'm narrowing down the regression range via &quot;hg bisect&quot; in the mozilla-esr52 repo.  Right now I've got a known-good &amp; known-bad endpoints, with a ~1200-cset fix range between them.  That should only require ~10 trials to bisect (which is reasonably fast with the icecc build cluster in MV).</pre></div><div class="change-set" id="c5"><div class="comment" data-id="12384568" data-no="5"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-5" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a15601_406194"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-5"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-5" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c5">Comment 5</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 17:24 PDT" data-time="1496967882">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-5">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-5" data-comment-id="12384568">hg bisect says this started crashing as of this cset:
  <a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/01d67bfe6c81">https://hg.mozilla.org/releases/mozilla-esr52/rev/01d67bfe6c81</a>
...which is a &quot;Update configs for release&quot; change.

We can ignore the mozconfig changes there (which shouldn't matter for my local build because I'm using my own mozconfig).

Of the remaining files, I've found with local testing that I can &quot;fix&quot; a build from that ^ cset by reverting its changes to these files (probably not all are necessary):
 browser/confvars.sh
 browser/config/version.txt
 browser/config/version_display.txt
 config/milestone.txt

Bottom-line: I'll bet there's some feature/behavior here that is dependent on &quot;is this a release build&quot; which those ^^ files' changes toggle.  So the real regression was older, and it's possible it's still present on Nightly if I toggle the same thing.</pre><div class="activity"><div class="change">Flags: needinfo?(cam) &rarr; needinfo?(dholbert)</div></div></div><div class="change-set" id="c6"><div class="comment" data-id="12384615" data-no="6"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-6" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_5168" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/04f630b96bdc20c8df8b8ab26a3a302e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_5168" id="a15601_406194"><a class="email " href="/user_profile?user_id=5168" > <span class="fna">Mats Palmgren (:mats)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-6"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-6" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c6">Comment 6</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 17:53 PDT" data-time="1496969616">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-6">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-6" data-comment-id="12384615">Fwiw, I seem to recall setting xpinstall.signatures.required to false to install DOMFuzz.</pre></div><div class="change-set" id="c7"><div class="comment" data-id="12384954" data-no="7"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-7" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a15601_406194"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-7"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-7" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c7">Comment 7</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 21:07 PDT" data-time="1496981236">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-7">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-7" data-comment-id="12384954">Yup, thanks -- I had to do that here, &amp; I'm testing in a profile that's got that pref manually set.

I'm definitely seeing terminal output (&quot;DOMFuzzHelper created&quot;) in both crashy &amp; non-crashy builds during my testing, too.  So the versioning-related regression isn't due to the extension's installability.</pre></div><div class="change-set" id="c8"><div class="comment" data-id="12385084" data-no="8"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-8" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a15601_406194"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a15601_406194"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-8"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-8" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c8">Comment 8</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 22:48 PDT" data-time="1496987333">5 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-8">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876011"
         class="attachment patch obsolete"
         data-id="8876011" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="needed-for-repro.patch">
      <meta itemprop="contentSize" content="2666">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8876011">
          <a class="link" href="attachment.cgi?id=8876011&amp;action=diff">
        <span id="att-8876011-description" itemprop="description">(not a fix) Patch to make bug reproduce on trunk [like it does on ESR]</span></a> (obsolete)
        — <a href="attachment.cgi?id=8876011&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876011">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-8" data-comment-id="12385084">OK, the key file from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c5">comment 5</a> is config/milestone.txt.  For this bug to be reproducible, that file's version number must NOT have a suffix after the version number (so it needs to be e.g. &quot;55.0&quot;, not &quot;55.0a1&quot;).

For convenience, here's a patch to make that tweak, and to set two extension-related prefs to DomFuzz-friendly defaults.  With this patch, this bug is reproducible in trunk.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(dholbert)</span></div></div></div><div class="change-set" id="a61406_278074"><div class="change" id="aa61406_278074">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a61406_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_278074" id="a61406_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a61406_278074"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a61406_278074">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a61406_278074">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-08 22:56 PDT" data-time="1496987785">5 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=isnotempty">status-firefox53</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=isnotempty">status-firefox54</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a></div></div></div><div class="change-set" id="c9"><div class="comment" data-id="12386867" data-no="9"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-9" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a61406_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a61406_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-9"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-9" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c9">Comment 9</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 10:29 PDT" data-time="1497029346">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-9">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876221"
         class="attachment patch obsolete"
         data-id="8876221" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="needed-for-repro.patch">
      <meta itemprop="contentSize" content="3653">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8876221">
          <a class="link" href="attachment.cgi?id=8876221&amp;action=diff">
        <span id="att-8876221-description" itemprop="description">(not a fix) Patch to make bug reproduce on trunk [like it does on ESR].</span></a> (obsolete)
        — <a href="attachment.cgi?id=8876221&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876221">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-9" data-comment-id="12386867">Here's a better reproducibility-enhancing patch -- it does one additional thing now: enables a pref to allow popups (since the testcase spawns some &amp; needs you to allow them).

This just removes one manual step from reproducing.  So, current STR:
 1. Apply this patch to trunk and build (ideally with ASAN enabled)
 2. &quot;./mach run&quot; and install domFuzzLite3.xpi built from <a rel="nofollow" href="https://github.com/MozillaSecurity/domfuzz/tree/master/dom/extension">https://github.com/MozillaSecurity/domfuzz/tree/master/dom/extension</a> and restart your build to complete the extension installation.
 3. &quot;./mach run&quot; and load nils's testcase (I'm using a locally-saved copy)

Occasionally it doens't trigger during the first attempt, but it generally reproduces if I close the popups &amp; reload my main browser window at that point.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876011&amp;action=edit"
           title="(not a fix) Patch to make bug reproduce on trunk [like it does on ESR]"
           class=""
        >Attachment #8876011</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c10"><div class="comment" data-id="12386875" data-no="10"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-10" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a61406_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a61406_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-10"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-10" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c10">Comment 10</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 10:31 PDT" data-time="1497029468">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-10">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876223"
         class="attachment"
         data-id="8876223" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="trunk-asan-backtrace.txt">
      <meta itemprop="contentSize" content="24472">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8876223" itemprop="contentUrl">
        <span id="att-8876223-description" itemprop="description">ASAN report + backtrace, for trunk</span></a>
        — <a href="attachment.cgi?id=8876223&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-10" data-comment-id="12386875">Here's an ASAN report + backtrace from a trunk build based off of this cset from yesterday: <a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/f4262773c433">https://hg.mozilla.org/mozilla-central/rev/f4262773c433</a></pre></div><div class="change-set" id="c11"><div class="comment" data-id="12387027" data-no="11"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-11" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a61406_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a61406_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-11"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-11" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c11">Comment 11</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 11:13 PDT" data-time="1497032003">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-11">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876242"
         class="attachment"
         data-id="8876242" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="testcase2.html">
      <meta itemprop="contentSize" content="1012">
      <meta itemprop="encodingFormat" content="text/html">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8876242" itemprop="contentUrl">
        <span id="att-8876242-description" itemprop="description">testcase 2 (reduced / made more human-readable)</span></a>
        — <a href="attachment.cgi?id=8876242&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div></div><div class="change-set" id="a105656_278074"><div class="change" id="aa105656_278074">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a105656_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_278074" id="a105656_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a105656_278074"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a105656_278074">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a105656_278074">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 11:13 PDT" data-time="1497032035">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876242&amp;action=edit"
           title="testcase 2 (reduced / made more human-readable)"
           class=""
        >Attachment #8876242</a> -
        Attachment description: testcase 2 (reduced) &rarr; testcase 2 (reduced / made more human-readable)</div></div></div><div class="change-set" id="c12"><div class="comment" data-id="12387398" data-no="12"
       data-tags="see_comment_19">
    
    <table class="layout-table change-head " id="ch-12" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a105656_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a105656_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-12"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-12" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c12">Comment 12</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 13:29 PDT" data-time="1497040168">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-12">
        <td colspan="2" class="comment-tags"><span class="comment-tag">see_comment_19</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-12" data-comment-id="12387398">OK, here's roughly what's going on here (looking at testcase 2):
 1. In fun0, we create a marquee, and we also resize the window that it's in. (Both of these involve a bit of deferred action.)

 2. During the next refresh driver tick (I think), we flush some deferred marquee action and trigger a call to nsXBLBinding::ExecuteAttachedHandler for the marquee's XBL.

 3. This involves a call to getComputedStyle in the marquee &quot;init()&quot; method:
<a rel="nofollow" href="https://dxr.mozilla.org/mozilla-central/rev/e61060be36424240058f8bef4c5597f401bc8b7e/layout/style/xbl-marquee/xbl-marquee.xml#538-539">https://dxr.mozilla.org/mozilla-central/rev/e61060be36424240058f8bef4c5597f401bc8b7e/layout/style/xbl-marquee/xbl-marquee.xml#538-539</a>

 4. Under the hood, that getComputedStyle invocation causes us to create a nsComputedDOMStyle and call UpdateCurrentStyleSources on it.

 5. nsComputedDOMStyle::UpdateCurrentStyleSources starts out by flushing layout, which flushes the resize operation, which triggers the resize handler (&quot;fun1&quot;).
   Inside of fun1:
    (a) the testcase calls close() on the window that we're operating inside of, which deletes some stuff.
    (b) the testcase forces a cycle collection, which deletes our nsComputedDOMStyle. (!!! We are hosed at this point.)

 6. After the fun1 &amp; the layout flush completes, we unwind the stack back up to nsComputedDOMStyle::UpdateCurrentStyleSources.

 7. ...and now the next member-var that we touch as we proceed through nsComputedDOMStyle::UpdateCurrentStyleSources will be a UAF, because our &quot;this&quot; object has been deleted.</pre></div><div class="change-set" id="c13"><div class="comment" data-id="12387467" data-no="13"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-13" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a105656_278074"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a105656_278074"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-13"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-13" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c13">Comment 13</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 13:53 PDT" data-time="1497041595">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-13">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-13" data-comment-id="12387467">Hmm.  So this is the second bug recently in which we ran into the problem that a delayed resize causes script to run during flush.  That said, flush is known to run arbitrary script.  So that part shouldn't be a problem per se.

In the sequence of events above, the really problematic bit from my point of view is that we collect the nsComputedDOMStyle.  That should really not happen.  Why is it happening?

Specifically, we should have a strong ref to the nsComputedDOMStyle from the object which is the &quot;this&quot; value of the binding call.  Bindings depend on this all over the place.

A horrible thought: Is it possible that the problem is that in this case the &quot;this&quot; value in the JS CallArgs in CSS2PropertiesBinding::get_width is an Xray (from the XBL scope to the content scope) and it gets hueyfixed by all the collection that's happening and hence drops its ref to the underlying DOM JS reflector, which then gets collected and calls Release on the C++ thing?

This seems scarily plausible, and if that's what's going on it means that any call via Xrays that can trigger untrusted code execution on the other side (which is lots of them!) is vulnerable to variants of this problem....</pre></div><div class="change-set" id="c14"><div class="comment" data-id="12387471" data-no="14"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-14" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a105656_278074"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a105656_278074"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-14"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-14" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c14">Comment 14</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 13:54 PDT" data-time="1497041648">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-14">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-14" data-comment-id="12387471">ccing some xpconnect/bindings people.</pre><div class="activity"><div class="change">Component: CSS Parsing and Computation &rarr; DOM</div></div></div><div class="change-set" id="c15"><div class="comment" data-id="12387512" data-no="15"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-15" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a105656_278074"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a105656_278074"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-15"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-15" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c15">Comment 15</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:08 PDT" data-time="1497042523">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-15">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-15" data-comment-id="12387512">Yeah, that sounds right to me.</pre></div><div class="change-set" id="c16"><div class="comment" data-id="12387532" data-no="16"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-16" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a105656_278074"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a105656_278074"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-16"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-16" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c16">Comment 16</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:13 PDT" data-time="1497042831">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-16">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-16" data-comment-id="12387532">Could UnwrapObject take a mutable handle for obj? Then the rooted value would be the actual reflector for |self|. Though presumably that would mess up the actual |getter| call...</pre></div><div class="change-set" id="c17"><div class="comment" data-id="12387535" data-no="17"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-17" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a105656_278074"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a105656_278074"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-17"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-17" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c17">Comment 17</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:15 PDT" data-time="1497042936">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-17">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-17" data-comment-id="12387535">OK, dholbert poked at this directly in rr, and in fact in CSS2PropertiesBinding::get_width &quot;obj&quot; is a dead object proxy in this case.  So <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c16">comment 16</a> explains exactly what's going on here.

We need to fix this in the bindings.  I'll think a bit about how best to do that, but I suspect the right answer is to stick the underlying object in a Rooted if we have a wrapper.  We'd need to do this for &quot;this&quot;, for arguments, and wherever else we don't do the &quot;is a member&quot; strong-ref bits in binding code.</pre><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c18"><div class="comment" data-id="12387540" data-no="18"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-18" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a105656_278074"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a105656_278074"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-18"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-18" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c18">Comment 18</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:17 PDT" data-time="1497043072">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-18">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-18" data-comment-id="12387540"><span class="quote">&gt; Could UnwrapObject take a mutable handle for obj?</span >

It could take one in addition to the arg, for example.  But that's the general idea, yes.

I do expect an extra Rooted on the stack is cheaper than addref/release on DOM objects, so it's worth sticking with the current setup where we rely on the JS object for ownership.  And of course for owned objects this is really the only way to make it work.</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="a116700_20209"><div class="change" id="aa116700_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a116700_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a116700_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a116700_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a116700_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a116700_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:17 PDT" data-time="1497043079">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c19"><div class="comment" data-id="12387543" data-no="19"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-19" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a116700_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a116700_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-19"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-19" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c19">Comment 19</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 14:19 PDT" data-time="1497043189">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-19">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-19" data-comment-id="12387543">(In reply to Daniel Holbert [:dholbert] from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c12">comment #12</a>)
<span class="quote">&gt;  3. This involves a call to getComputedStyle in the marquee &quot;init()&quot; method: [...]
&gt; 
&gt;  4. Under the hood, that getComputedStyle invocation causes us to create a
&gt; nsComputedDOMStyle and call UpdateCurrentStyleSources on it.</span >

Off-topic slightly at this point, but let me correct myself ^^ slightly here:
The marquee JS code actually calls &quot;getComputedStyle().width&quot;, and both parts (getComputedStyle and .width) are important for the bug here.
 - The getComputedStyle() creates the nsComputedDOMStyle
 - And then the .width is what triggers the problematic call into &quot;UpdateCurrentStyleSources&quot;.

This is why, at the point where we crash, mozilla::dom::CSS2PropertiesBinding::get_width is in the backtrace, as bz mentions.</pre></div><div class="change-set" id="c20"><div class="comment" data-id="12387766" data-no="20"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-20" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a116700_20209"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a116700_20209"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-20"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-20" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c20">Comment 20</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 15:55 PDT" data-time="1497048911">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-20">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-20" data-comment-id="12387766">I looked over all of the calls to CheckedUnwrap for places where the output isn't rooted and then we pull something out of the output. I filed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">bug 1371865</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">bug 1371863</a>, and <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">bug 1371853</a> for some possible variations on this issue.</pre><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">1371865</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">1371863</a>, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">1371853</a></div></div></div><div class="change-set" id="c21"><div class="comment" data-id="12387767" data-no="21"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-21" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a116700_20209"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a116700_20209"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-21"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-21" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c21">Comment 21</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 15:56 PDT" data-time="1497049011">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-21">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-21" data-comment-id="12387767">I didn't look at any of the calls in js/src, because I assume they are less likely to pull C++ stuff out and call methods on them. I did skim over the many call sites in generated DOM bindings code, but it all looked okay.</pre></div><div class="change-set ca-278074" id="c22"><div class="comment" data-id="12387771" data-no="22"
       data-tags="actually-its-just-e10s obsolete">
    
    <table class="layout-table change-head " id="ch-22" style="display:none" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a116700_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a116700_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-22"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-22" style="display:none">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c22">Comment 22</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 15:59 PDT" data-time="1497049169">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-22">
        <td colspan="2" class="comment-tags"><span class="comment-tag">actually-its-just-e10s</span><span class="comment-tag">obsolete</span>
        </td>
      </tr>
    </table>

    
      <table class="layout-table change-head default-collapsed" id="cc-22"
             role="presentation">
      <tr>
        <td class="comment-collapse-reason"
            title="dholbert [4 years ago]">
            Comment hidden (obsolete)
        </td>
        <td class="comment-actions">
          <button type="button" class="change-spinner minor iconic" id="ccs-22"
                  aria-label="Expand"
                  aria-expanded="false"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </td>
      </tr>
      </table>
  </div><pre
        class="comment-text  "
        id="ct-22" data-comment-id="12387771" style="display:none">For the record, I did some minimal digging to see if I could figure out why stock trunk builds are unaffected -- i.e. why bug only reproduces if you have a &quot;clean&quot; version number (e.g. &quot;55.0&quot;) in milestone.txt.

Referencing my overview of what goes wrong in <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c12">comment 12</a>, it seems like stock trunk builds take a different path in step 5:
<span class="quote">&gt; 5. nsComputedDOMStyle::UpdateCurrentStyleSources starts out by flushing layout,
&gt; which flushes the resize operation, which triggers the resize handler (&quot;fun1&quot;).</span >

For a stock trunk build (with milestone.txt=55.0a1), we don't trigger the resize handler at this point. Instead, the resize handler is triggered in a subsequent refresh driver tick.  So, this means the close() + CC are delayed -- they don't happen mid-marquee-JS-running.

I'm tentatively guessing that we have some delayed-event-dispatching code that is guarded by a check for NIGHTLY_BUILD and/or RELEASE_OR_BETA. Or something like that.</pre></div><div class="change-set" id="c23"><div class="comment" data-id="12387777" data-no="23"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-23" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a116700_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a116700_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-23"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-23" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c23">Comment 23</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 16:01 PDT" data-time="1497049308">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-23">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876333"
         class="attachment"
         data-id="8876333" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="domFuzzLite3.xpi">
      <meta itemprop="contentSize" content="12561">
      <meta itemprop="encodingFormat" content="application/x-xpinstall">
      <div class="label">
        Attached file
          <a class="link" href="attachment.cgi?id=8876333" itemprop="contentUrl">
        <span id="att-8876333-description" itemprop="description">dholbert's build of domFuzzLite3.xpi (extension required for testcases to reproduce the crash)</span></a>
        — <a href="attachment.cgi?id=8876333&amp;action=edit" itemprop="url">Details</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-23" data-comment-id="12387777">For reference/convenience, here's the domFuzzLite3.xpi extension that I'm using for testing here (which I built locally from the domfuzz github repo as noted previously).</pre></div><div class="change-set" id="a122958_278074"><div class="change" id="aa122958_278074">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a122958_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_278074" id="a122958_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a122958_278074"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a122958_278074">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a122958_278074">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 16:02 PDT" data-time="1497049337">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876333&amp;action=edit"
           title="dholbert's build of domFuzzLite3.xpi (extension required for testcases to reproduce the crash)"
           class=""
        >Attachment #8876333</a> -
        Attachment description: dholbert's build of domFuzzLite3.xpi (extension required by testcases) &rarr; dholbert's build of domFuzzLite3.xpi (extension required for testcases to reproduce the crash)</div></div></div><div class="change-set ca-39966" id="c24"><div class="comment" data-id="12387787" data-no="24"
       data-tags="obsolete replying-to-bad-c22">
    
    <table class="layout-table change-head " id="ch-24" style="display:none" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_39966" id="a122958_278074"><img src="https://secure.gravatar.com/avatar/7ba0f00f24191ccef0d14185bd7ca4ca?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_39966" id="a122958_278074"><a class="email " href="/user_profile?user_id=39966" > <span class="fna">Olli Pettay [:smaug]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-24"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-24" style="display:none">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c24">Comment 24</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-09 16:06 PDT" data-time="1497049617">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-24">
        <td colspan="2" class="comment-tags"><span class="comment-tag">obsolete</span><span class="comment-tag">replying-to-bad-c22</span>
        </td>
      </tr>
    </table>

    
      <table class="layout-table change-head default-collapsed" id="cc-24"
             role="presentation">
      <tr>
        <td class="comment-collapse-reason"
            title="smaug [4 years ago]">
            Comment hidden (obsolete)
        </td>
        <td class="comment-actions">
          <button type="button" class="change-spinner minor iconic" id="ccs-24"
                  aria-label="Expand"
                  aria-expanded="false"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </td>
      </tr>
      </table>
  </div><pre
        class="comment-text  "
        id="ct-24" data-comment-id="12387787" style="display:none">Hmm, I'm not aware of us changing resize event dispatching, and code seems to agreehttp://searchfox.org/mozilla-central/rev/12afa8cc9cea4a141494f767541b411845eef7a0/layout/base/PresShell.cpp#4131

Landing <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Update resize event firing to follow the specs"
   href="/show_bug.cgi?id=1149555">bug 1149555</a> never succeeded.</pre></div><div class="change-set" id="a356202_451704"><div class="change" id="aa356202_451704">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a356202_451704"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_451704" id="a356202_451704"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a356202_451704"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a356202_451704">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a356202_451704">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 08:49 PDT" data-time="1497282581">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=isnotempty">status-firefox53</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox53&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox54&amp;o1=isnotempty">tracking-firefox54</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox54&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=isnotempty">tracking-firefox55</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox55&amp;o1=equals&amp;v1=%2B">+</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=isnotempty">tracking-firefox56</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox56&amp;o1=equals&amp;v1=%2B">+</a></div></div></div><div class="change-set" id="c25"><div class="comment" data-id="12391682" data-no="25"
       data-tags="last-one-should-be-true">
    
    <table class="layout-table change-head " id="ch-25" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a356202_451704"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a356202_451704"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-25"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-25" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c25">Comment 25</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 12:17 PDT" data-time="1497295076">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-25">
        <td colspan="2" class="comment-tags"><span class="comment-tag">last-one-should-be-true</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-25" data-comment-id="12391682">(In reply to Daniel Holbert [:dholbert] from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c22">comment #22</a>)
<span class="quote">&gt; For the record, I did some minimal digging to see if I could figure out why
&gt; stock trunk builds are unaffected -- i.e. why bug only reproduces if you
&gt; have a &quot;clean&quot; version number (e.g. &quot;55.0&quot;) in milestone.txt</span >

Poked around a bit more, and it's simpler than I thought. The key difference between crashy &quot;milestone.txt-tweaked&quot; trunk builds vs non-crashy trunk builds is: e10s.

In release builds (or builds with milestone.txt adjusted to make them look like a release), I think the domFuzz extension makes us disable e10s by default.  Whereas, in a stock nightly build, we keep e10s enabled regardless of the extension's presence. And unsusprisingly, window-resize events get queued up &amp; dispatched a bit differently depending on e10s.

SO: bottom line, to trigger the issue with this particular testcase, e10s *must be disabled*.

I verified that I can reproduce the ASAN error report in a stock nightly build (no tweaks needed to milestone.txt), with the domfuzz extension installed &amp; with these prefs set:
  browser.tabs.remote.autostart.2      false    # Disable e10s
  dom.disable_open_during_load         false    # Allow popups (to make testcase more automated)
  xpinstall.signatures.required        false    # Allow domfuzz extension (which is unsigned)
  extensions.allow-non-mpc-extensions  false    # Allow domfuzz extension (which is not a webextension)</pre></div><div class="change-set" id="c26"><div class="comment" data-id="12391750" data-no="26"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-26" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a356202_451704"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a356202_451704"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-26"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-26" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c26">Comment 26</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 12:42 PDT" data-time="1497296535">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-26">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876851"
         class="attachment patch"
         data-id="8876851" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="needed-for-repro.patch">
      <meta itemprop="contentSize" content="4126">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8876851">
          <a class="link" href="attachment.cgi?id=8876851&amp;action=diff">
        <span id="att-8876851-description" itemprop="description">(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]</span></a>
        — <a href="attachment.cgi?id=8876851&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876851">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-26" data-comment-id="12391750">Here's an updated patch to make this bug reproduce easily on trunk, just by setting some about:config pref defaults as noted in prev. comment -- no longer any milestone.txt tweak needed here to trigger this.

I confirmed that I could reproduce this bug with &quot;testcase 2&quot; on the second attempt [it's not 100% reliable], with this patch applied, in an ASAN debug build. [Though likely any build will do &amp; may just crash slightly differently.]</pre></div><div class="change-set" id="a370189_278074"><div class="change" id="aa370189_278074">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a370189_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_278074" id="a370189_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a370189_278074"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a370189_278074">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a370189_278074">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 12:42 PDT" data-time="1497296568">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876221&amp;action=edit"
           title="(not a fix) Patch to make bug reproduce on trunk [like it does on ESR]."
           class=""
        >Attachment #8876221</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a370211_278074"><div class="change" id="aa370211_278074">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a370211_278074"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_278074" id="a370211_278074"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a370211_278074"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a370211_278074">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a370211_278074">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 12:43 PDT" data-time="1497296590">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876851&amp;action=edit"
           title="(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]"
           class=""
        >Attachment #8876851</a> -
        Attachment description: (not a fix) Patch to make bug reproduce on trunk, by setting some prefs &rarr; (not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]</div></div></div><div class="change-set" id="c27"><div class="comment" data-id="12392970" data-no="27"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-27" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a370211_278074"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a370211_278074"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-27"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-27" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c27">Comment 27</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 21:42 PDT" data-time="1497328930">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-27">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876987"
         class="attachment patch obsolete"
         data-id="8876987" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="43211">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8876987">
          <a class="link" href="attachment.cgi?id=8876987&amp;action=diff">
        <span id="att-8876987-description" itemprop="description">Work in progress</span></a> (obsolete)
        — <a href="attachment.cgi?id=8876987&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876987">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-27" data-comment-id="12392970">This makes unwrapping much safer.  It fixes or audits all the UNWRAP_OBJECT consumers and some UnwrapObject&lt;&gt; ones.  What's left is the codegen bits, especially the non-owning union conversions.  I'm really not sure how to handle those yet...

I do expect we'll want to land these changes together with the fixes for the various bugs mccr8 filed as a result of his followup audit (see <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c20">comment 20</a>).</pre></div><div class="change-set" id="a402555_20209"><div class="change" id="aa402555_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a402555_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a402555_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a402555_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a402555_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a402555_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 21:42 PDT" data-time="1497328934">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Assignee: nobody &rarr; bzbarsky</div><div class="change">Status: NEW &rarr; ASSIGNED</div></div></div><div class="change-set" id="c28"><div class="comment" data-id="12392993" data-no="28"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-28" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a402555_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a402555_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-28"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-28" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c28">Comment 28</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 22:00 PDT" data-time="1497330036">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-28">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8876988"
         class="attachment patch obsolete"
         data-id="8876988" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="44273">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8876988">
          <a class="link" href="attachment.cgi?id=8876988&amp;action=diff">
        <span id="att-8876988-description" itemprop="description">WIP with some updates; still missing the non-owning union bits</span></a> (obsolete)
        — <a href="attachment.cgi?id=8876988&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8876988">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a403660_20209"><div class="change" id="aa403660_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a403660_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a403660_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a403660_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a403660_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a403660_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-12 22:00 PDT" data-time="1497330039">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876987&amp;action=edit"
           title="Work in progress"
           class=""
        >Attachment #8876987</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c29"><div class="comment" data-id="12395231" data-no="29"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-29" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a403660_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a403660_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-29"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-29" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c29">Comment 29</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-13 12:48 PDT" data-time="1497383320">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-29">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-29" data-comment-id="12395231">(In reply to Daniel Holbert [:dholbert] from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c25">comment #25</a>)
<span class="quote">&gt; I verified that I can reproduce the ASAN error report in a stock nightly
&gt; build (no tweaks needed to milestone.txt), with the domfuzz extension
&gt; installed &amp; with these prefs set:
&gt;   browser.tabs.remote.autostart.2      false    # Disable e10s
&gt;   dom.disable_open_during_load         false    # Allow popups (to make testcase more automated)
&gt;   xpinstall.signatures.required        false    # Allow domfuzz extension (which is unsigned)
&gt;   extensions.allow-non-mpc-extensions  false    # Allow domfuzz extension (which is not a webextension)</span >

Sorry, I mistyped here -- that final pref (&quot;extensions.allow-non-mpc-extensions&quot;) needs to be manually set to *true* (not false) in order for the domfuzz extension to be activated.

My &quot;patch to make bug reproduce&quot; (<span class=""><a href="/attachment.cgi?id=8876851" name="attach_8876851" title="(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]">attachment 8876851</a> <a href="/attachment.cgi?id=8876851&amp;action=edit" title="(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]">[details]</a> <a href="/attachment.cgi?id=8876851&amp;action=diff" title="(not a fix) Patch to make bug reproduce on trunk, by setting some prefs [you also need domFuzzLite3.xpi]">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8876851'>[review]</a>) sets it correctly -- I just mistyped in <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c25">comment 25</a>.</pre></div><div class="change-set" id="c30"><div class="comment" data-id="12395307" data-no="30"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-30" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a403660_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a403660_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-30"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-30" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c30">Comment 30</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-13 13:14 PDT" data-time="1497384843">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-30">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877298"
         class="attachment patch obsolete"
         data-id="8877298" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="test.patch">
      <meta itemprop="contentSize" content="67248">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877298">
          <a class="link" href="attachment.cgi?id=8877298&amp;action=diff">
        <span id="att-8877298-description" itemprop="description">Compiling patch that should fix this bug</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877298&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877298">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-30" data-comment-id="12395307">I have been trying to reproduce the crash and failing so far, but I believe this should fix it.  If someone who can reproduce could test, that would be awesome.

I'm still working on the related issues mccr8 filed, because I think we should land them all at once.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8876988&amp;action=edit"
           title="WIP with some updates; still missing the non-owning union bits"
           class=""
        >Attachment #8876988</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c31"><div class="comment" data-id="12395515" data-no="31"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-31" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a403660_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a403660_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-31"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-31" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c31">Comment 31</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-13 14:31 PDT" data-time="1497389490">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-31">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-31" data-comment-id="12395515">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877298" name="attach_8877298" title="Compiling patch that should fix this bug">attachment 8877298</a> <a href="/attachment.cgi?id=8877298&amp;action=edit" title="Compiling patch that should fix this bug">[details]</a> <a href="/attachment.cgi?id=8877298&amp;action=diff" title="Compiling patch that should fix this bug">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877298'>[review]</a>
Compiling patch that should fix this bug

My initial testing seems to confirm that bz's patch fixes the bug.

I've got a debug not-ASAN build which crashed from this bug ~40% of the time (2/5 attempts today), and when I applied bz's patch, I couldn't reproduce the bug on 8 attempts.  I also broke in with gdb and confirmed that we were traversing the codepath that was previously crashy (marquee construtor calling get_width, which flushes layout, which fires the resize event, which triggers cycle collection -- all in one synchronous nested callstack), and nonetheless we don't crash.

So I think I can confirm that this patch does indeed fix this bug on trunk.  I'm rebuilding with ASAN now, for extra verification that there's no latent ASAN-only funny business.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877298&amp;action=edit"
           title="Compiling patch that should fix this bug"
           class=""
        >Attachment #8877298</a> -
        Flags: feedback+</div></div></div><div class="change-set" id="c32"><div class="comment" data-id="12396220" data-no="32"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-32" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_278074" id="a403660_20209"><img src="https://secure.gravatar.com/avatar/cd9b85b2e112bd7941b21ad03f42604e?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_278074" id="a403660_20209"><a class="email " href="/user_profile?user_id=278074" > <span class="fna">Daniel Holbert [:dholbert]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-32"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-32" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c32">Comment 32</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-13 20:43 PDT" data-time="1497411825">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-32">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-32" data-comment-id="12396220">(My ASAN build results seem to confirm that bz's patch fixes this, too.  Without his patch, I crashed on my 3rd or 4th attempt. With his patch, I was able to let the testcase run ~15 times without crashing.)</pre></div><div class="change-set" id="a534073_280903"><div class="change" id="aa534073_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a534073_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a534073_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a534073_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a534073_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a534073_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 10:14 PDT" data-time="1497460452">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=isnotempty">status-firefox54</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox54&amp;o1=equals&amp;v1=wontfix">wontfix</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox54&amp;o1=isnotempty">tracking-firefox54</a>:
          <a href="/buglist.cgi?f1=cf_tracking_firefox54&amp;o1=equals&amp;v1=%2B">+</a> &rarr; ---</div><div class="change">
          <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=isnotempty">tracking-firefox-esr52</a>:
          --- &rarr; <a href="/buglist.cgi?f1=cf_tracking_firefox_esr52&amp;o1=equals&amp;v1=55%2B">55+</a></div></div></div><div class="change-set" id="c33"><div class="comment" data-id="12398518" data-no="33"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-33" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a534073_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a534073_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-33"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-33" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c33">Comment 33</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 12:08 PDT" data-time="1497467297">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-33">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-33" data-comment-id="12398518">OK, I posted patches in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">bug 1371865</a> and <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">bug 1371853</a>, but I feel pretty strongly that we should fix these all at once, so maybe I should dup them here and just land those patches with this bug#...

I _definitely_ want to do that with <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">bug 1371863</a> because the patches for that are pretty tied in to the bindings patches we need for this bug.</pre></div><div class="change-set" id="a540952_20209"><div class="change" id="aa540952_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a540952_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a540952_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a540952_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a540952_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a540952_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 12:08 PDT" data-time="1497467331">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Questionable looking calls to UnwrapReflectorToISupports()"
   href="/show_bug.cgi?id=1371863">1371863</a></div></div></div><div class="change-set" id="c34"><div class="comment" data-id="12398618" data-no="34"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-34" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a540952_20209"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_406194" id="a540952_20209"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-34"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-34" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c34">Comment 34</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 12:36 PDT" data-time="1497468980">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-34">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-34" data-comment-id="12398618">(In reply to Boris Zbarsky [:bz] (if a patch has no decent message, automatic r-) from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c33">comment #33</a>)
<span class="quote">&gt; OK, I posted patches in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">bug 1371865</a> and <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">bug 1371853</a>, but I feel pretty
&gt; strongly that we should fix these all at once, so maybe I should dup them
&gt; here and just land those patches with this bug#...</span >

Yeah, we should definitely fix them all at once. Duping them over makes sense: this patch is already pretty big, so making it a little larger won't hurt.</pre></div><div class="change-set" id="c35"><div class="comment" data-id="12398686" data-no="35"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-35" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a540952_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a540952_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-35"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-35" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c35">Comment 35</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 12:53 PDT" data-time="1497469996">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-35">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-35" data-comment-id="12398686">Fwiw, this patch is actually multiple changesets in my tree; I'll be posting it in that form for review and then rollups for branch backports...  So yeah, I'll move over the other bits here.</pre></div><div class="change-set" id="a543827_20209"><div class="change" id="aa543827_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a543827_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a543827_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a543827_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a543827_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a543827_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 12:56 PDT" data-time="1497470206">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Duplicate of this bug: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::EnsureTarget"
   href="/show_bug.cgi?id=1371630">1371630</a></div></div></div><div class="change-set" id="a546822_20209"><div class="change" id="aa546822_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a546822_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a546822_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a546822_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a546822_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a546822_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 13:46 PDT" data-time="1497473201">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">See Also:  &rarr; <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - ExportHelpers has a nice long comment about FileList that doesn't match reality"
   href="/show_bug.cgi?id=1373042">1373042</a></div></div></div><div class="change-set" id="a547150_20209"><div class="change" id="aa547150_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547150_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a547150_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a547150_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a547150_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a547150_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 13:52 PDT" data-time="1497473529">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">1371865</a></div></div></div><div class="change-set" id="a547168_20209"><div class="change" id="aa547168_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a547168_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a547168_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a547168_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 13:52 PDT" data-time="1497473547">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">1371853</a></div></div></div><div class="change-set" id="c37"><div class="comment" data-id="12399920" data-no="37"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-37" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-37"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-37" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c37">Comment 37</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507685">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-37">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877893"
         class="attachment patch obsolete"
         data-id="8877893" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="binding-pass-values">
      <meta itemprop="contentSize" content="20885">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877893">
          <a class="link" href="attachment.cgi?id=8877893&amp;action=diff">
        <span id="att-8877893-description" itemprop="description">part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877893&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877893">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-37" data-comment-id="12399920">The idea is that CastableObjectUnwrapper will want to have a MutableHandle for
the thing it's unwrapping whenever its target is a raw pointer.  Since we have
convenient MutableHandle&lt;Value&gt; in most cases, it's easier to switch
CastableObjectUnwrapper to working with MutableHandle&lt;Value&gt; or Handle&lt;Value&gt;
instead of trying to get MutableHandle&lt;JSObject*&gt; in the right places.

There are basically two changes here:

1) Make CastableObjectUnwrapper work with at thing that looks like a Value.
2) Change various callsites to pass in MutableHandle&lt;Value&gt;, in addition to a
   Handle&lt;Value&gt;, into the JS-to-C++ conversion templates.  The
   MutableHandle&lt;Value&gt; is passed as ${maybeMutableVal}.  It may not actually
   end up being a MutableHandle in some cases.

The reason for passing both a Handle and a MutableHandle is that when the thing
we actually have is a Rooted named &quot;foo&quot; the Handle will be &quot;foo&quot; but the
MutableHandle is most naturally written as &quot;&amp;foo&quot;.  This is not a problem if
you're just passing it through, but if you want to test whether it's an object,
say, you have a problem.  Writing &quot;foo.isObject()&quot; is ok, but &quot;&amp;foo.isObject()&quot;
is not, and neither is &quot;(&amp;foo).isObject()&quot;.  This could be worked around by
passing the MutableHandle as &quot;JS::MutableHandle&lt;JS::Value&gt;(&amp;foo)&quot; or something,
and then &quot;JS::MutableHandle&lt;JS::Value&gt;(&amp;foo).isObject()&quot; does work.  But it
makes the code very hard to read.

So we just pass both things along; ${val} should be used for readonly access and
${maybeMutableVal} any time you really want a MutableHandle.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877893&amp;action=edit"
           title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper"
           class=""
        >Attachment #8877893</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c38"><div class="comment" data-id="12399921" data-no="38"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-38" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-38"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-38" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c38">Comment 38</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507697">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-38">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877894"
         class="attachment patch"
         data-id="8877894" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unions-pass">
      <meta itemprop="contentSize" content="1506">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877894">
          <a class="link" href="attachment.cgi?id=8877894&amp;action=diff">
        <span id="att-8877894-description" itemprop="description">part 2.  Change union conversions for non-owning unions to pass a MutableHandle through to the underlying conversion code</span></a>
        — <a href="attachment.cgi?id=8877894&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877894">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877894&amp;action=edit"
           title="part 2.  Change union conversions for non-owning unions to pass a MutableHandle through to the underlying conversion code"
           class=""
        >Attachment #8877894</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c39"><div class="comment" data-id="12399923" data-no="39"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-39" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-39"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-39" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c39">Comment 39</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:21 PDT" data-time="1497507710">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-39">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877895"
         class="attachment patch obsolete"
         data-id="8877895" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="51836">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877895">
          <a class="link" href="attachment.cgi?id=8877895&amp;action=diff">
        <span id="att-8877895-description" itemprop="description">part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877895&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877895">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-39" data-comment-id="12399923">I did audit all UNWRAP_OBJECT callers to make sure that the lifetimes of all the
temporary Rooted or the RefPtrs they unwrap into are long enough.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877895&amp;action=edit"
           title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites"
           class=""
        >Attachment #8877895</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c40"><div class="comment" data-id="12399924" data-no="40"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-40" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-40"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-40" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c40">Comment 40</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507726">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-40">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877896"
         class="attachment patch"
         data-id="8877896" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-arg-bits">
      <meta itemprop="contentSize" content="7451">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877896">
          <a class="link" href="attachment.cgi?id=8877896&amp;action=diff">
        <span id="att-8877896-description" itemprop="description">part 4.  Stop using UnwrapArg to unwrap this values</span></a>
        — <a href="attachment.cgi?id=8877896&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877896">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877896&amp;action=edit"
           title="part 4.  Stop using UnwrapArg to unwrap this values"
           class=""
        >Attachment #8877896</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c41"><div class="comment" data-id="12399925" data-no="41"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-41" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-41"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-41" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c41">Comment 41</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507736">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-41">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877897"
         class="attachment patch"
         data-id="8877897" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="safer-file-list">
      <meta itemprop="contentSize" content="1833">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877897">
          <a class="link" href="attachment.cgi?id=8877897&amp;action=diff">
        <span id="att-8877897-description" itemprop="description">part 5.  Use a safer implementation of IsFileList</span></a>
        — <a href="attachment.cgi?id=8877897&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877897">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877897&amp;action=edit"
           title="part 5.  Use a safer implementation of IsFileList"
           class=""
        >Attachment #8877897</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c42"><div class="comment" data-id="12399926" data-no="42"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-42" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-42"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-42" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c42">Comment 42</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:22 PDT" data-time="1497507776">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-42">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877898"
         class="attachment patch"
         data-id="8877898" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="root-pre-helper">
      <meta itemprop="contentSize" content="1706">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877898">
          <a class="link" href="attachment.cgi?id=8877898&amp;action=diff">
        <span id="att-8877898-description" itemprop="description">part 6.  Root the unwrapped object in PRE_HELPER_STUB</span></a>
        — <a href="attachment.cgi?id=8877898&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877898">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-42" data-comment-id="12399926">This has review from mccr8 in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - PRE_HELPER_STUB calls method on native without rooting the reflector"
   href="/show_bug.cgi?id=1371865">bug 1371865</a></pre></div><div class="change-set" id="c43"><div class="comment" data-id="12399931" data-no="43"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-43" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-43"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-43" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c43">Comment 43</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:23 PDT" data-time="1497507818">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-43">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877899"
         class="attachment patch"
         data-id="8877899" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="xpcconvert-root">
      <meta itemprop="contentSize" content="1634">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877899">
          <a class="link" href="attachment.cgi?id=8877899&amp;action=diff">
        <span id="att-8877899-description" itemprop="description">part 7.  Root the unwrapped object in XPCConvert code</span></a>
        — <a href="attachment.cgi?id=8877899&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877899">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-43" data-comment-id="12399931">This has review from mccr8 in <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Possible native rooting issue in XPCConvert::JSObject2NativeInterface()"
   href="/show_bug.cgi?id=1371853">bug 1371853</a></pre></div><div class="change-set" id="c44"><div class="comment" data-id="12399932" data-no="44"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-44" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-44"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-44" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c44">Comment 44</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:23 PDT" data-time="1497507836">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-44">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877900"
         class="attachment patch"
         data-id="8877900" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="nix-GetNative">
      <meta itemprop="contentSize" content="14704">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877900">
          <a class="link" href="attachment.cgi?id=8877900&amp;action=diff">
        <span id="att-8877900-description" itemprop="description">part 8.  Get rid of nsIXPConnect::GetNativeOfWrapper</span></a>
        — <a href="attachment.cgi?id=8877900&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877900">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-44" data-comment-id="12399932">Most of these changes are just replacements of GetNativeOfWrapper with
UnwrapReflectorToISupports, which is all it did under the hood.

The other changes are as follows:

* In nsDOMClassInfo, we really care whether we have a window, so we can just
  UNWRAP_OBJECT to the Window interface, since Window is always on Web IDL
  bindings now.  Also, the weird compartment check hasn't been needed ever since
  GetNativeOfWrapper stopped returning things off the passed-in object's
  prototype chain (Firefox 22, <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Incorrect |this| binding when using call() with XRayWrappers"
   href="/show_bug.cgi?id=658909">bug 658909</a>).
* The only use of do_QueryWrapper was to get a Window in nsDocument; again we
  can UNWRAP_OBJECT.
* In XPCJSRuntime, we again just want to check for a Window, so UNWRAP_OBJECT.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877900&amp;action=edit"
           title="part 8.  Get rid of nsIXPConnect::GetNativeOfWrapper"
           class=""
        >Attachment #8877900</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c45"><div class="comment" data-id="12399934" data-no="45"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-45" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-45"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-45" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c45">Comment 45</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:24 PDT" data-time="1497507857">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-45">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877901"
         class="attachment patch obsolete"
         data-id="8877901" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="addrefed-support">
      <meta itemprop="contentSize" content="13141">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877901">
          <a class="link" href="attachment.cgi?id=8877901&amp;action=diff">
        <span id="att-8877901-description" itemprop="description">part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877901&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877901">Splinter Review</a>
      </div>
    </div>

  
    <pre
        class="comment-text  "
        id="ct-45" data-comment-id="12399934">The main reason to not do this would be performance (avoiding the
addref/release), but there are two main mitigating factors:

1)  All calls to UnwrapReflectorToISupports that pass in a Web IDL object
    already do the addref (and in fact QI).  So this only affects the
    XPCWrappedNative case.

2)  The vast majority of the callers proceed to QI on the pointer anyway, and a
    second addref is cheap; it's the first addref after a CC that can be
    expensive on a cycle-collected object.

Going through the changes one by one:

* In GlobalObject::GetAsSupports, we do have a change that slightly slows down
  precisely in the XPCWrappedNative global case.  That's the message managers
  and the backstagepass.  And this really only affects calls to Web IDL statics
  from those globals.

* In UnwrapArgImpl we're talking about a Web IDL method taking an &quot;external
  interface&quot; type, and the UnwrapReflectorToISupports call is immediately
  followed by QI anyway.

* In UnwrapXPConnectImpl we're talking about the case when we have a
  non-WebIDL-object implementation of a Web IDL interface.  Again, this is the
  message manager globals, for EventTarget.  And we have a QI call immediately
  after the UnwrapReflectorToISupports.

* In the generated HasInstance hook for EventTarget we will be slightly slower
  when the LHS of the instanceof is an XPCWrappedNative.  And not much slower,
  because again there's an immediate QI.

* In InstallXBLField we're never going to have an XPCWrappedNative as thisObj;
  it's always an Element in practice.  So this is no more expensive than before.

* In sandbox's GetPrincipalOrSOP we now have an extra addref.  But it was
  followed by various QIs anyway.

* In XPCConvert::JSValToXPCException we have an extra addref if someone throws
  an XPCWrappedNative, which is fairly unlikely; our actual Exception objects
  are on Web IDL bindings.  Plus we have an immediate QI.

* In xpc::HasInstance we have an extra addred if the LHS of instanceof is an
  XPCWrappedNative.  But, again, there's an immediated QI after the
  UnwrapReflectorToISupports.

* In xpcJSWeakReference::Init we are likely doing an extra addref, but again
  immediately followed by QI.

I think it's worth making this change just to remove the footgun and that the
perf impact, if any, is pretty minimal.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877901&amp;action=edit"
           title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;"
           class=""
        >Attachment #8877901</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c46"><div class="comment" data-id="12399935" data-no="46"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-46" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-46"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-46" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c46">Comment 46</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:25 PDT" data-time="1497507937">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-46">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877902"
         class="attachment patch"
         data-id="8877902" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup.patch">
      <meta itemprop="contentSize" content="95215">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877902">
          <a class="link" href="attachment.cgi?id=8877902&amp;action=diff">
        <span id="att-8877902-description" itemprop="description">Rollup patch for convenience</span></a>
        — <a href="attachment.cgi?id=8877902&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877902">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c47"><div class="comment" data-id="12399937" data-no="47"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-47" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-47"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-47" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c47">Comment 47</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:26 PDT" data-time="1497507974">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-47">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877903"
         class="attachment patch"
         data-id="8877903" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage_ws">
      <meta itemprop="contentSize" content="51428">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877903">
          <a class="link" href="attachment.cgi?id=8877903&amp;action=diff">
        <span id="att-8877903-description" itemprop="description">Part 3 diff -w, for possible review convenience</span></a>
        — <a href="attachment.cgi?id=8877903&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877903">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c48"><div class="comment" data-id="12399938" data-no="48"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-48" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-48"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-48" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c48">Comment 48</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:27 PDT" data-time="1497508025">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-48">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877904"
         class="attachment patch obsolete"
         data-id="8877904" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-beta.patch">
      <meta itemprop="contentSize" content="95465">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877904">
          <a class="link" href="attachment.cgi?id=8877904&amp;action=diff">
        <span id="att-8877904-description" itemprop="description">Rollup patch for beta</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877904&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877904">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c49"><div class="comment" data-id="12399940" data-no="49"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-49" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-49"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-49" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c49">Comment 49</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:27 PDT" data-time="1497508077">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-49">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877905"
         class="attachment patch obsolete"
         data-id="8877905" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-release.patch">
      <meta itemprop="contentSize" content="95235">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877905">
          <a class="link" href="attachment.cgi?id=8877905&amp;action=diff">
        <span id="att-8877905-description" itemprop="description">Rollup patch for 54 release</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877905&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877905">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c50"><div class="comment" data-id="12399941" data-no="50"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-50" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-50"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-50" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c50">Comment 50</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:28 PDT" data-time="1497508103">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-50">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8877906"
         class="attachment patch obsolete"
         data-id="8877906" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-esr52.patch">
      <meta itemprop="contentSize" content="93466">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8877906">
          <a class="link" href="attachment.cgi?id=8877906&amp;action=diff">
        <span id="att-8877906-description" itemprop="description">Rollup patch for ESR52</span></a> (obsolete)
        — <a href="attachment.cgi?id=8877906&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8877906">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="c51"><div class="comment" data-id="12399966" data-no="51"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-51" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-51"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-51" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c51">Comment 51</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:41 PDT" data-time="1497508914">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-51">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-51" data-comment-id="12399966">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877895" name="attach_8877895" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">attachment 8877895</a> <a href="/attachment.cgi?id=8877895&amp;action=edit" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[details]</a> <a href="/attachment.cgi?id=8877895&amp;action=diff" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877895'>[review]</a>
part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites

Requesting sec-approval here, because this is the heart of the fix, but it should really apply to all of the patches.

[Security approval request comment]
How easily could an exploit be constructed based on the patch? Hard to say.  It's pretty clear from the patch that the problem is a rooting/ownership issue in bindings.  The new invariants described in the comments give an idea of what is wrong with the current code (violating those invariants by not providing a mutable handle _and_ not providing a strong ref).  So let's posit that based on the patch an attacker could figure out that they need to invoke a DOM API and then cause it to reenter script and cause things to be collected.  Also let's posit that an attacker knows enough about our code to figure out that wrappers are involved and hence that the DOM API call needs to be a cross-compartment one.  That leaves the problems of (1) figuring out that the call needs to be across Xrays, (2) figuring out that the hueyfix needs to be triggered, (3) finding a way to trigger an API call via Xrays that then reenters the untrusted script, (4) actually managing to trigger the hueyfix, (5) exploiting the resulting dead object.  I expect #5 is easy for someone who does this for a living, #4 is not too hard if you just do a bunch of allocation and event loop spinning.  #3 could take some work.  #1 and #2 also need some inspiration, but hard to say how much.

Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?  To some extent.  Per above, it's clear from the comments that the problem is with GC/rooting stuff, and I _think_ it's fairly clear that the issue is with wrappers.  I carefully avoided mentioning Xrays or hueyfix anywhere in the comments, so that part is not pointed out.  And of course I didn't mention the specific API involved here (i.e. the answer to #3 above).

That said, the commit messages and comments in these patches could probably use a once-over from someone other than me to see whether we could remove something from them without ending up with security-critical code that's not documented as critical and could get changed by people who don't realize it is.

Which older supported branches are affected by this flaw?  All of them.

If not all supported branches, which bug introduced the flaw?  I guess <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED FIXED - Remove support for Chrome -&gt; Content leaks"
   href="/show_bug.cgi?id=695480">bug 695480</a> landed before webidl bindings, so let's call it webidl bindings.

Do you have backports for the affected branches? If not, how different, hard to create, and risky will they be?  Backports to beta 55, release 54, ESR 52 are attached.  Risk is... hard to say.  I ended up changing a bunch of code to resolve this whole class of issues in various guises.  We _could_ probably land just parts 1-3 or 1-4 on the older branches to mitigate risk, but I think the later parts are actually not very risky...

How likely is this patch to cause regressions; how much testing does it need?  It's hard to say.  I'm touching some pretty critical code here.  I have compiled it on Mac and Linux, but I haven't even done a try push for Windows and tests because I'm not sure about exposing these patches on try too early...  Ideally I would give this as much bake time as I could.  I _think_ this is fairly safe as fixes for this bug go, but that's not a very high bar.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877895&amp;action=edit"
           title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites"
           class=""
        >Attachment #8877895</a> -
        Flags: sec-approval?</div></div></div><div class="change-set" id="c52"><div class="comment" data-id="12399967" data-no="52"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-52" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a547168_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a547168_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-52"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-52" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c52">Comment 52</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-14 23:42 PDT" data-time="1497508962">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-52">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-52" data-comment-id="12399967">I'm not going to worry about branch approvals until the reviews and sec-approval are done, because that may affect the branch patches.</pre></div><div class="change-set" id="a586544_1689"><div class="change" id="aa586544_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a586544_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a586544_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a586544_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a586544_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a586544_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-15 00:48 PDT" data-time="1497512923">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: layout-core-security &rarr; dom-core-security</div></div></div><div class="change-set" id="c53"><div class="comment" data-id="12406157" data-no="53"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-53" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a586544_1689"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a586544_1689"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-53"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-53" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c53">Comment 53</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-16 14:37 PDT" data-time="1497649066">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-53">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-53" data-comment-id="12406157">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877895" name="attach_8877895" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">attachment 8877895</a> <a href="/attachment.cgi?id=8877895&amp;action=edit" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[details]</a> <a href="/attachment.cgi?id=8877895&amp;action=diff" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877895'>[review]</a>
part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites

I'm going to say we should check this in the week of July 10, which is four weeks into our eight week (this time) product cycle, just to reduce the potential exposure window. I'm willing to have a discussion if this seems overly paranoid though.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877895&amp;action=edit"
           title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites"
           class=""
        >Attachment #8877895</a> -
        Flags: sec-approval? &rarr; sec-approval+</div></div></div><div class="change-set" id="a722710_280903"><div class="change" id="aa722710_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a722710_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a722710_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a722710_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a722710_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a722710_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-16 14:38 PDT" data-time="1497649089">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: [checkin on 7/10]</div></div></div><div class="change-set" id="c54"><div class="comment" data-id="12406232" data-no="54"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-54" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a722710_280903"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a722710_280903"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-54"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-54" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c54">Comment 54</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-16 15:13 PDT" data-time="1497651213">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-54">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-54" data-comment-id="12406232">That doesn't seem unreasonable.  I just wish I had a way to check whether this actually compiles on all platforms and passes tests before then...</pre></div><div class="change-set" id="c55"><div class="comment" data-id="12406395" data-no="55"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-55" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a722710_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_280903" id="a722710_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-55"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-55" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c55">Comment 55</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-16 16:51 PDT" data-time="1497657074">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-55">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-55" data-comment-id="12406395">I wish we had a truly private way to run tests and log results for viewing by the submitting dev.</pre></div><div class="change-set" id="c56"><div class="comment" data-id="12406619" data-no="56"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-56" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_54040" id="a722710_280903"><img src="https://secure.gravatar.com/avatar/becfee04c4233fec739dd9cb43128591?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_54040" id="a722710_280903"><a class="email " href="/user_profile?user_id=54040" > <span class="fna">Cameron McCormack (:heycam)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-56"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-56" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c56">Comment 56</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-16 19:30 PDT" data-time="1497666635">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-56">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-56" data-comment-id="12406619">That would be nice.  I filed <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - have an access controlled version of try for testing security sensitive bugs"
   href="/show_bug.cgi?id=1373889">bug 1373889</a>.</pre></div><div class="change-set" id="c57"><div class="comment" data-id="12413571" data-no="57"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-57" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a722710_280903"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_24295" id="a722710_280903"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-57"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-57" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c57">Comment 57</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-20 01:11 PDT" data-time="1497946294">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-57">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-57" data-comment-id="12413571">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877893" name="attach_8877893" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">attachment 8877893</a> <a href="/attachment.cgi?id=8877893&amp;action=edit" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">[details]</a> <a href="/attachment.cgi?id=8877893&amp;action=diff" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877893'>[review]</a>
part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8877893" name="attach_8877893" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">attachment 8877893</a> <a href="/attachment.cgi?id=8877893&amp;action=edit" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">[details]</a> <a href="/attachment.cgi?id=8877893&amp;action=diff" title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877893'>[review]</a>:
-----------------------------------------------------------------

::: dom/bindings/Codegen.py
&#64;&#64; +4255,5 &#64;&#64;
<span class="quote">&gt;      &quot;&quot;&quot;
&gt; +    A class for unwrapping an object stored in a JS Value (or
&gt; +    MutableHandle&lt;Value&gt; or Handle&lt;Value&gt;) named by the &quot;source&quot;
&gt; +    argument based on the passed-in descriptor and storing it in a
&gt; +    variable called by the name in the &quot;target&quot; argument.</span >

Could you add some explanation for mutableSource here?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877893&amp;action=edit"
           title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper"
           class=""
        >Attachment #8877893</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="a1019942_24295"><div class="change" id="aa1019942_24295">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1019942_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_24295" id="a1019942_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1019942_24295"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1019942_24295">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1019942_24295">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-20 01:12 PDT" data-time="1497946321">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877894&amp;action=edit"
           title="part 2.  Change union conversions for non-owning unions to pass a MutableHandle through to the underlying conversion code"
           class=""
        >Attachment #8877894</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="c58"><div class="comment" data-id="12420603" data-no="58"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-58" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1019942_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_24295" id="a1019942_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-58"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-58" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c58">Comment 58</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-21 23:51 PDT" data-time="1498114294">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-58">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-58" data-comment-id="12420603">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877895" name="attach_8877895" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">attachment 8877895</a> <a href="/attachment.cgi?id=8877895&amp;action=edit" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[details]</a> <a href="/attachment.cgi?id=8877895&amp;action=diff" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877895'>[review]</a>
part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8877895" name="attach_8877895" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">attachment 8877895</a> <a href="/attachment.cgi?id=8877895&amp;action=edit" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[details]</a> <a href="/attachment.cgi?id=8877895&amp;action=diff" title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877895'>[review]</a>:
-----------------------------------------------------------------

::: dom/base/StructuredCloneHolder.cpp
&#64;&#64; +450,5 &#64;&#64;
<span class="quote">&gt;                                                       JSStructuredCloneWriter* aWriter,
&gt;                                                       JS::Handle&lt;JSObject*&gt; aObj)
&gt;  {
&gt; +  // We can just keep passing the same Rooted to all the callees, because all of
&gt; +  // our callees want to CheckedUnwrap it as needed.</span >

I don't completely understand these comments (here and below). Is what is happening that the first call to UNWRAP_OBJECT will put the result of CheckedUnwrap into obj? And then subsequent calls to UNWRAP_OBJECT will just use the unwrapped object?
I thought about doing the CheckedUnwrap call here instead. Having unwrap change the passed in JSObject is a bit spooky, but then again I really prefer to keep CheckedUnwrap calls in binding code if possible :-/.

::: dom/base/nsDOMWindowUtils.cpp
&#64;&#64; +3135,5 &#64;&#64;
<span class="quote">&gt;      *_retval = -1;
&gt;      return NS_OK;
&gt;    }
&gt;  
&gt; +  JS::Rooted&lt;JSObject*&gt; obj(aCx, aFile.toObjectOrNull());</span >

Maybe add a comment here too? And wherever we pass it in multiple times?

::: dom/bindings/BindingUtils.h
&#64;&#64; +254,5 &#64;&#64;
<span class="quote">&gt; +    return NS_ERROR_XPC_SECURITY_MANAGER_VETO;
&gt; +  }
&gt; +  MOZ_ASSERT(!js::IsWrapper(unwrappedObj));
&gt; +  domClass = GetDOMClass(unwrappedObj);
&gt; +  if (!domClass) {</span >

Hmm, the duplication of this code is unfortunate. I don't suppose we could call UnwrapObjectInternal on unwrappedObj here?

&#64;&#64; +278,5 &#64;&#64;
<span class="quote">&gt;    return NS_ERROR_XPC_BAD_CONVERT_JS;
&gt;  }
&gt;  
&gt; +struct MutableObjectHandleWrapper {
&gt; +  MutableObjectHandleWrapper(JS::MutableHandle&lt;JSObject*&gt; aHandle)</span >

Make this explicit?

&#64;&#64; +299,5 &#64;&#64;
<span class="quote">&gt; +  JS::MutableHandle&lt;JSObject*&gt; mHandle;
&gt; +};
&gt; +
&gt; +struct MutableValueHandleWrapper {
&gt; +  MutableValueHandleWrapper(JS::MutableHandle&lt;JS::Value&gt; aHandle)</span >

explicit?

::: js/xpconnect/src/XPCComponents.cpp
&#64;&#64; +1717,2 &#64;&#64;
<span class="quote">&gt;          Exception* e;
&gt; +        *bp = NS_SUCCEEDED(UNWRAP_OBJECT(Exception, &amp;obj, e)) ||</span >

IS_INSTANCE_OF?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877895&amp;action=edit"
           title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites"
           class=""
        >Attachment #8877895</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="c59"><div class="comment" data-id="12420655" data-no="59"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-59" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1019942_24295"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1019942_24295"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-59"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-59" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c59">Comment 59</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 00:12 PDT" data-time="1498115572">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-59">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-59" data-comment-id="12420655"><span class="quote">&gt; Is what is happening that the first call to UNWRAP_OBJECT will put the result of CheckedUnwrap into obj?</span >

Oh, good catch.  That _was_ what was happening when I wrote that comment, before I realized that it would cause problems with IDL overloads (e.g. the case when we had an interface overloaded with a DOMString: the interface unwrap attempt would CheckedUnwrap and then the string conversion would no longer get Xrays) and changed UNWRAP_OBJECT to only modify the mutable handle when the unwrap succeeds.  I'll just take this comment out entirely, because at this point it's just confusing.

<span class="quote">&gt; Having unwrap change the passed in JSObject is a bit spooky</span >

I agree, but I don't really have any concrete better ideas.... if you do, I'm totally open to changing how this stuff works!

<span class="quote">&gt; Hmm, the duplication of this code is unfortunate</span >

I agree.  I couldn't figure out a way to keep from duplicating it while preserving that &quot;don't write to the inout param unless unwrap succeeds&quot; property, but that's because I wasn't thinking sufficiently well, clearly!

<span class="quote">&gt; I don't suppose we could call UnwrapObjectInternal on unwrappedObj here?</span >

Hmm... with mayBeWrapper forced to false, now that we have such a thing?  That's a good point.  I think we can in fact do that.  I think I didn't have the mayBeWrapper bit yet when I initially refactored this method to avoid the inout param writes; I added it later when I realized I neded UNWRAP_NON_WRAPPER_OBJECT.

<span class="quote">&gt; Make this explicit?</span >

Good catch, both places.

<span class="quote">&gt; IS_INSTANCE_OF?</span >

Also good catch; I think I changed that bit before I decided to introduce IS_INSTANCE_OF...  I can actually undo most of the changes to this method if I use IS_INSTANCE_OF here.</pre></div><div class="change-set" id="a1189584_24295"><div class="change" id="aa1189584_24295">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1189584_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_24295" id="a1189584_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1189584_24295"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1189584_24295">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1189584_24295">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 00:19 PDT" data-time="1498115963">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877897&amp;action=edit"
           title="part 5.  Use a safer implementation of IsFileList"
           class=""
        >Attachment #8877897</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="a1189676_24295"><div class="change" id="aa1189676_24295">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1189676_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_24295" id="a1189676_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1189676_24295"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1189676_24295">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1189676_24295">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 00:20 PDT" data-time="1498116055">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877896&amp;action=edit"
           title="part 4.  Stop using UnwrapArg to unwrap this values"
           class=""
        >Attachment #8877896</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="a1192337_24295"><div class="change" id="aa1192337_24295">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1192337_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_24295" id="a1192337_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1192337_24295"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1192337_24295">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1192337_24295">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 01:05 PDT" data-time="1498118716">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877900&amp;action=edit"
           title="part 8.  Get rid of nsIXPConnect::GetNativeOfWrapper"
           class=""
        >Attachment #8877900</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="c60"><div class="comment" data-id="12420803" data-no="60"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-60" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1192337_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_24295" id="a1192337_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-60"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-60" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c60">Comment 60</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 01:21 PDT" data-time="1498119666">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-60">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-60" data-comment-id="12420803">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8877901" name="attach_8877901" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">attachment 8877901</a> <a href="/attachment.cgi?id=8877901&amp;action=edit" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">[details]</a> <a href="/attachment.cgi?id=8877901&amp;action=diff" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877901'>[review]</a>
part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;

Review of <span class="bz_obsolete"><a href="/attachment.cgi?id=8877901" name="attach_8877901" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">attachment 8877901</a> <a href="/attachment.cgi?id=8877901&amp;action=edit" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">[details]</a> <a href="/attachment.cgi?id=8877901&amp;action=diff" title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8877901'>[review]</a>:
-----------------------------------------------------------------

I'm working on the message managers again, so hopefully some of this will be simpler soon.

::: js/xpconnect/src/nsXPConnect.cpp
&#64;&#64; -783,5 &#64;&#64;
<span class="quote">&gt;      }
&gt;  
&gt;      // Try DOM objects.
&gt;      nsCOMPtr&lt;nsISupports&gt; canonical =
&gt;          do_QueryInterface(mozilla::dom::UnwrapDOMObjectToISupports(reflector));</span >

This is safe because we never end up calling into JS for a QI to nsISupports. Right?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877901&amp;action=edit"
           title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;"
           class=""
        >Attachment #8877901</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="c61"><div class="comment" data-id="12421785" data-no="61"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-61" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1192337_24295"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1192337_24295"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-61"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-61" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c61">Comment 61</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 07:37 PDT" data-time="1498142266">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-61">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-61" data-comment-id="12421785"><span class="quote">&gt; This is safe because we never end up calling into JS for a QI to nsISupports. Right?</span >

Right, plus if the pointer is non-null we know we have an actual webidl object, not XPCWrappedJS.  Those should never call into JS for QI at all, except for XBL-implemented interfaces on elements.

I'll add a comment.</pre></div><div class="change-set" id="c62"><div class="comment" data-id="12422803" data-no="62"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-62" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1192337_24295"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1192337_24295"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-62"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-62" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c62">Comment 62</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 13:04 PDT" data-time="1498161893">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-62">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880535"
         class="attachment patch"
         data-id="8880535" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="bar.patch">
      <meta itemprop="contentSize" content="5937">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880535">
          <a class="link" href="attachment.cgi?id=8880535&amp;action=diff">
        <span id="att-8880535-description" itemprop="description">Addresses review comments on part 3; could use another look</span></a>
        — <a href="attachment.cgi?id=8880535&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880535">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880535&amp;action=edit"
           title="Addresses review comments on part 3; could use another look"
           class=""
        >Attachment #8880535</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c63"><div class="comment" data-id="12423265" data-no="63"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-63" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1192337_24295"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1192337_24295"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-63"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-63" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c63">Comment 63</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:11 PDT" data-time="1498169505">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-63">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880595"
         class="attachment patch"
         data-id="8880595" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="binding-pass-values">
      <meta itemprop="contentSize" content="21069">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880595">
          <a class="link" href="attachment.cgi?id=8880595&amp;action=diff">
        <span id="att-8880595-description" itemprop="description">Part 1 updated to review comments</span></a>
        — <a href="attachment.cgi?id=8880595&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880595">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1243130_20209"><div class="change" id="aa1243130_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243130_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1243130_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1243130_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1243130_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1243130_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:11 PDT" data-time="1498169509">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877893&amp;action=edit"
           title="part 1.  Pass maybe-mutable Value handles, not JSObject*, into CastableObjectUnwrapper"
           class=""
        >Attachment #8877893</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c64"><div class="comment" data-id="12423266" data-no="64"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-64" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243130_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1243130_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-64"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-64" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c64">Comment 64</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169526">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-64">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880596"
         class="attachment patch obsolete"
         data-id="8880596" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="51130">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880596">
          <a class="link" href="attachment.cgi?id=8880596&amp;action=diff">
        <span id="att-8880596-description" itemprop="description">Part 3 updated to review comments</span></a> (obsolete)
        — <a href="attachment.cgi?id=8880596&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880596">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1243151_20209"><div class="change" id="aa1243151_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243151_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1243151_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1243151_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1243151_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1243151_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169530">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877895&amp;action=edit"
           title="part 3.  Change UnwrapObject&lt;&gt; and the UNWRAP_OBJECT macro to allow passing in mutable object or value handles for the thing being unwrapped, and do so at various callsites"
           class=""
        >Attachment #8877895</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c65"><div class="comment" data-id="12423268" data-no="65"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-65" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243151_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1243151_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-65"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-65" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c65">Comment 65</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169554">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-65">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880597"
         class="attachment patch"
         data-id="8880597" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="addrefed-support">
      <meta itemprop="contentSize" content="13358">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880597">
          <a class="link" href="attachment.cgi?id=8880597&amp;action=diff">
        <span id="att-8880597-description" itemprop="description">Part 9 updated to review comments</span></a>
        — <a href="attachment.cgi?id=8880597&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880597">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1243179_20209"><div class="change" id="aa1243179_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243179_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1243179_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1243179_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1243179_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1243179_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:12 PDT" data-time="1498169558">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877901&amp;action=edit"
           title="part 9.  Make UnwrapReflectorToISupports return already_AddRefed&lt;nsISupports&gt;"
           class=""
        >Attachment #8877901</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c66"><div class="comment" data-id="12423271" data-no="66"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-66" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243179_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1243179_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-66"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-66" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c66">Comment 66</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169649">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-66">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880598"
         class="attachment patch obsolete"
         data-id="8880598" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-esr52.patch">
      <meta itemprop="contentSize" content="93262">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880598">
          <a class="link" href="attachment.cgi?id=8880598&amp;action=diff">
        <span id="att-8880598-description" itemprop="description">Updated esr52 rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8880598&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880598">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1243274_20209"><div class="change" id="aa1243274_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243274_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1243274_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1243274_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1243274_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1243274_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169653">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877906&amp;action=edit"
           title="Rollup patch for ESR52"
           class=""
        >Attachment #8877906</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c67"><div class="comment" data-id="12423272" data-no="67"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-67" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243274_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1243274_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-67"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-67" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c67">Comment 67</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169665">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-67">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880599"
         class="attachment patch obsolete"
         data-id="8880599" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-release.patch">
      <meta itemprop="contentSize" content="95040">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880599">
          <a class="link" href="attachment.cgi?id=8880599&amp;action=diff">
        <span id="att-8880599-description" itemprop="description">Updated release channel rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8880599&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880599">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1243291_20209"><div class="change" id="aa1243291_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243291_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1243291_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1243291_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1243291_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1243291_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 15:14 PDT" data-time="1498169670">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877905&amp;action=edit"
           title="Rollup patch for 54 release"
           class=""
        >Attachment #8877905</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c68"><div class="comment" data-id="12423432" data-no="68"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-68" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1243291_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a1243291_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-68"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-68" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c68">Comment 68</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 16:01 PDT" data-time="1498172488">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-68">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8880618"
         class="attachment patch obsolete"
         data-id="8880618" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-beta.patch">
      <meta itemprop="contentSize" content="95271">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8880618">
          <a class="link" href="attachment.cgi?id=8880618&amp;action=diff">
        <span id="att-8880618-description" itemprop="description">Updated beta channel rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8880618&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8880618">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a1246114_20209"><div class="change" id="aa1246114_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1246114_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1246114_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1246114_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1246114_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1246114_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 16:01 PDT" data-time="1498172493">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877904&amp;action=edit"
           title="Rollup patch for beta"
           class=""
        >Attachment #8877904</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="a1246166_20209"><div class="change" id="aa1246166_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a1246166_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a1246166_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a1246166_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a1246166_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a1246166_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-06-22 16:02 PDT" data-time="1498172545">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8877298&amp;action=edit"
           title="Compiling patch that should fix this bug"
           class=""
        >Attachment #8877298</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c69"><div class="comment" data-id="12443937" data-no="69"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-69" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a1246166_20209"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_24295" id="a1246166_20209"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-69"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-69" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c69">Comment 69</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-03 01:18 PDT" data-time="1499069938">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-69">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-69" data-comment-id="12443937">Comment on <span class=""><a href="/attachment.cgi?id=8880535" name="attach_8880535" title="Addresses review comments on part 3; could use another look">attachment 8880535</a> <a href="/attachment.cgi?id=8880535&amp;action=edit" title="Addresses review comments on part 3; could use another look">[details]</a> <a href="/attachment.cgi?id=8880535&amp;action=diff" title="Addresses review comments on part 3; could use another look">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8880535'>[review]</a>
Addresses review comments on part 3; could use another look

Review of <span class=""><a href="/attachment.cgi?id=8880535" name="attach_8880535" title="Addresses review comments on part 3; could use another look">attachment 8880535</a> <a href="/attachment.cgi?id=8880535&amp;action=edit" title="Addresses review comments on part 3; could use another look">[details]</a> <a href="/attachment.cgi?id=8880535&amp;action=diff" title="Addresses review comments on part 3; could use another look">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8880535'>[review]</a>:
-----------------------------------------------------------------

::: dom/bindings/BindingUtils.h
&#64;&#64; +255,5 &#64;&#64;
<span class="quote">&gt;    }
&gt;    MOZ_ASSERT(!js::IsWrapper(unwrappedObj));
&gt; +  // Recursive call is OK, because now we're using false for mayBeWrapper and
&gt; +  // we never reach this code if that boolean is false, so can't keep calling
&gt; +  // ourselves.</span >

Could we static_assert that?

&#64;&#64; -268,5 &#64;&#64;
<span class="quote">&gt; -    // It's very important to not update &quot;obj&quot; with the &quot;unwrappedObj&quot; value
&gt; -    // until we know the unwrap has succeeded.  Otherwise, in a situation in
&gt; -    // which we have an overload of object and primitive we could end up
&gt; -    // converting to the primitive from the unwrappedObj, whereas we want to do
&gt; -    // it from the original object.</span >

This comment still has value, no?</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880535&amp;action=edit"
           title="Addresses review comments on part 3; could use another look"
           class=""
        >Attachment #8880535</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="a2359650_1689"><div class="change" id="aa2359650_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2359650_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a2359650_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2359650_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2359650_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2359650_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-05 13:20 PDT" data-time="1499286029">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty?</div></div></div><div class="change-set" id="a2780619_1689"><div class="change" id="aa2780619_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2780619_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a2780619_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2780619_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2780619_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2780619_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:16 PDT" data-time="1499706998">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::EnsureTarget"
   href="/show_bug.cgi?id=1371630">1371630</a></div></div></div><div class="change-set" id="c70"><div class="comment" data-id="12460598" data-no="70"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-70" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2780619_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2780619_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-70"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-70" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c70">Comment 70</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:19 PDT" data-time="1499707194">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-70">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-70" data-comment-id="12460598"><span class="quote">&gt; Could we static_assert that?</span >

I don't quite see how: static_assert doesn't consider reachability.  That is, a static_assert in unreachable code still gets compiled and hence asserted at compile-time.

<span class="quote">&gt; This comment still has value, no?</span >

Indeed.  I will restore it.</pre></div><div class="change-set" id="c71"><div class="comment" data-id="12460701" data-no="71"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-71" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2780619_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2780619_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-71"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-71" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c71">Comment 71</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709091">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-71">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884915"
         class="attachment patch obsolete"
         data-id="8884915" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-esr52.patch">
      <meta itemprop="contentSize" content="93610">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884915">
          <a class="link" href="attachment.cgi?id=8884915&amp;action=diff">
        <span id="att-8884915-description" itemprop="description">Updated esr52 rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8884915&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884915">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2782716_20209"><div class="change" id="aa2782716_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782716_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2782716_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2782716_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2782716_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2782716_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709095">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880598&amp;action=edit"
           title="Updated esr52 rollup fix"
           class=""
        >Attachment #8880598</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c72"><div class="comment" data-id="12460703" data-no="72"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-72" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782716_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782716_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-72"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-72" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c72">Comment 72</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709105">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-72">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884916"
         class="attachment patch obsolete"
         data-id="8884916" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-beta.patch">
      <meta itemprop="contentSize" content="95619">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884916">
          <a class="link" href="attachment.cgi?id=8884916&amp;action=diff">
        <span id="att-8884916-description" itemprop="description">Updated beta channel rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8884916&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884916">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2782730_20209"><div class="change" id="aa2782730_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782730_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2782730_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2782730_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2782730_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2782730_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:51 PDT" data-time="1499709109">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880618&amp;action=edit"
           title="Updated beta channel rollup fix"
           class=""
        >Attachment #8880618</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c73"><div class="comment" data-id="12460704" data-no="73"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-73" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782730_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782730_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-73"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-73" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c73">Comment 73</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:52 PDT" data-time="1499709121">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-73">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884917"
         class="attachment patch obsolete"
         data-id="8884917" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-release.patch">
      <meta itemprop="contentSize" content="95388">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884917">
          <a class="link" href="attachment.cgi?id=8884917&amp;action=diff">
        <span id="att-8884917-description" itemprop="description">Updated release channel rollup fix</span></a> (obsolete)
        — <a href="attachment.cgi?id=8884917&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884917">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2782748_20209"><div class="change" id="aa2782748_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782748_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2782748_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2782748_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2782748_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2782748_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:52 PDT" data-time="1499709127">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880599&amp;action=edit"
           title="Updated release channel rollup fix"
           class=""
        >Attachment #8880599</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c74"><div class="comment" data-id="12460710" data-no="74"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-74" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782748_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782748_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-74"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-74" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c74">Comment 74</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:54 PDT" data-time="1499709298">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-74">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-74" data-comment-id="12460710">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8884915" name="attach_8884915" title="Updated esr52 rollup fix">attachment 8884915</a> <a href="/attachment.cgi?id=8884915&amp;action=edit" title="Updated esr52 rollup fix">[details]</a> <a href="/attachment.cgi?id=8884915&amp;action=diff" title="Updated esr52 rollup fix">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8884915'>[review]</a>
Updated esr52 rollup fix

[Approval Request Comment]
If this is not a sec:{high,crit} bug, please state case for ESR consideration:
User impact if declined: Possible UAF leading to bad things.
Fix Landed on Version: 56.
Risk to taking this patch (and alternatives if risky): Medium to high risk.  We
   do not yet have compat data for this, because it's just landing on tip.  We
   don't even have CI results yet.  I think the patches are correct, and they
   do fix the bug.  I believe they are principled enough and unobservable
   enough from web content that they should not cause compat issues.  But I
   don't have more than about 70% confidence in that.
String or UUID changes made by this patch: None.

See <a rel="nofollow" href="https://wiki.mozilla.org/Release_Management/ESR_Landing_Process">https://wiki.mozilla.org/Release_Management/ESR_Landing_Process</a> for more info.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884915&amp;action=edit"
           title="Updated esr52 rollup fix"
           class=""
        >Attachment #8884915</a> -
        Flags: approval-mozilla-esr52?</div></div></div><div class="change-set" id="c75"><div class="comment" data-id="12460711" data-no="75"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-75" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782748_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782748_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-75"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-75" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c75">Comment 75</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:56 PDT" data-time="1499709369">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-75">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-75" data-comment-id="12460711">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8884916" name="attach_8884916" title="Updated beta channel rollup fix">attachment 8884916</a> <a href="/attachment.cgi?id=8884916&amp;action=edit" title="Updated beta channel rollup fix">[details]</a> <a href="/attachment.cgi?id=8884916&amp;action=diff" title="Updated beta channel rollup fix">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8884916'>[review]</a>
Updated beta channel rollup fix

Approval Request Comment
[Feature/Bug causing the regression]: WebIDL bindings.
[User impact if declined]: Possible UAF leading to bad things.
[Is this code covered by automated tests?]: Generally, yes: this is changing all
   of our binding code.
[Has the fix been verified in Nightly?]: Not yet.
[Needs manual test from QE? If yes, steps to reproduce]: See <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c0">comment 0</a>.
[List of other uplifts needed for the feature/fix]: None.
[Is the change risky?]: Medium to high.
[Why is the change risky/not risky?]: See <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c74">comment 74</a>.
[String changes made/needed]: None.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884916&amp;action=edit"
           title="Updated beta channel rollup fix"
           class=""
        >Attachment #8884916</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c76"><div class="comment" data-id="12460713" data-no="76"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-76" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782748_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782748_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-76"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-76" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c76">Comment 76</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 10:56 PDT" data-time="1499709410">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-76">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-76" data-comment-id="12460713">Comment on <span class="bz_obsolete"><a href="/attachment.cgi?id=8884917" name="attach_8884917" title="Updated release channel rollup fix">attachment 8884917</a> <a href="/attachment.cgi?id=8884917&amp;action=edit" title="Updated release channel rollup fix">[details]</a> <a href="/attachment.cgi?id=8884917&amp;action=diff" title="Updated release channel rollup fix">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8884917'>[review]</a>
Updated release channel rollup fix

I'm not sure whether we want this on release, but in case we do, here's the patch and approval request.  See <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c75">comment 75</a> for the approval request boilerplate.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884917&amp;action=edit"
           title="Updated release channel rollup fix"
           class=""
        >Attachment #8884917</a> -
        Flags: approval-mozilla-release?</div></div></div><div class="change-set" id="c77"><div class="comment" data-id="12460724" data-no="77"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-77" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2782748_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2782748_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-77"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-77" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c77">Comment 77</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 11:02 PDT" data-time="1499709751">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-77">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884918"
         class="attachment patch obsolete"
         data-id="8884918" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="49277">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884918">
          <a class="link" href="attachment.cgi?id=8884918&amp;action=diff">
        <span id="att-8884918-description" itemprop="description">Part 3 updated to tip</span></a> (obsolete)
        — <a href="attachment.cgi?id=8884918&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884918">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2783377_20209"><div class="change" id="aa2783377_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2783377_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2783377_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2783377_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2783377_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2783377_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 11:02 PDT" data-time="1499709756">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8880596&amp;action=edit"
           title="Part 3 updated to review comments"
           class=""
        >Attachment #8880596</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c78"><div class="comment" data-id="12460932" data-no="78"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-78" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2783377_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2783377_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-78"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-78" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c78">Comment 78</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 11:59 PDT" data-time="1499713199">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-78">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8884955"
         class="attachment patch"
         data-id="8884955" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="unwrap-fixage">
      <meta itemprop="contentSize" content="51061">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8884955">
          <a class="link" href="attachment.cgi?id=8884955&amp;action=diff">
        <span id="att-8884955-description" itemprop="description">Part 3 really merged to tip</span></a>
        — <a href="attachment.cgi?id=8884955&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8884955">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2786824_20209"><div class="change" id="aa2786824_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2786824_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2786824_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2786824_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2786824_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2786824_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 12:00 PDT" data-time="1499713203">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884918&amp;action=edit"
           title="Part 3 updated to tip"
           class=""
        >Attachment #8884918</a> -
        Attachment is obsolete: true</div></div></div><div class="change-set" id="c79"><div class="comment" data-id="12461121" data-no="79"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-79" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2786824_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2786824_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-79"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-79" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c79">Comment 79</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 13:10 PDT" data-time="1499717425">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-79">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-79" data-comment-id="12461121">   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/516a1c0c080e7dce29df440a61f0e8ae0f88d36e">https://hg.mozilla.org/integration/mozilla-inbound/rev/516a1c0c080e7dce29df440a61f0e8ae0f88d36e</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/9c3018012352ca80f3ce4d132e6ed61cb2c813ba">https://hg.mozilla.org/integration/mozilla-inbound/rev/9c3018012352ca80f3ce4d132e6ed61cb2c813ba</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/d58add6deeb122dc92760eb100c7068306be6a7f">https://hg.mozilla.org/integration/mozilla-inbound/rev/d58add6deeb122dc92760eb100c7068306be6a7f</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/2338abec8626ded38b149b611f2ecfc7aa2466c8">https://hg.mozilla.org/integration/mozilla-inbound/rev/2338abec8626ded38b149b611f2ecfc7aa2466c8</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/19c7f37f992073c3f0b539062e0ef009b48d7675">https://hg.mozilla.org/integration/mozilla-inbound/rev/19c7f37f992073c3f0b539062e0ef009b48d7675</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/a32e94e98f03c23290f74f892bc545b7d4e025f6">https://hg.mozilla.org/integration/mozilla-inbound/rev/a32e94e98f03c23290f74f892bc545b7d4e025f6</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/9491622034f17872aec1732dd23005bfae368f32">https://hg.mozilla.org/integration/mozilla-inbound/rev/9491622034f17872aec1732dd23005bfae368f32</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/e9505b57cab715e24506db8d59a9dc4568ed490d">https://hg.mozilla.org/integration/mozilla-inbound/rev/e9505b57cab715e24506db8d59a9dc4568ed490d</a>
   <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/f1c298a314c6345b03609ed298437aa508aa7e1c">https://hg.mozilla.org/integration/mozilla-inbound/rev/f1c298a314c6345b03609ed298437aa508aa7e1c</a></pre></div><div class="change-set" id="a2791806_75935"><div class="change" id="aa2791806_75935">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a2791806_75935"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_75935" id="a2791806_75935"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2791806_75935"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2791806_75935">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2791806_75935">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 13:23 PDT" data-time="1499718185">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Whiteboard: <span class="activity-deleted">[checkin on 7/10]</span></div></div></div><div class="change-set" id="c80"><div class="comment" data-id="12461542" data-no="80"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-80" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2791806_75935"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2791806_75935"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-80"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-80" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c80">Comment 80</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 15:03 PDT" data-time="1499724235">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-80">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885007"
         class="attachment patch"
         data-id="8885007" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="fix-gc-analyze">
      <meta itemprop="contentSize" content="2060">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885007">
          <a class="link" href="attachment.cgi?id=8885007&amp;action=diff">
        <span id="att-8885007-description" itemprop="description">Minor update to fix gc hazards</span></a>
        — <a href="attachment.cgi?id=8885007&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885007">Splinter Review</a>
      </div>
    </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885007&amp;action=edit"
           title="Minor update to fix gc hazards"
           class=""
        >Attachment #8885007</a> -
        Flags: review?(peterv)</div></div></div><div class="change-set" id="c81"><div class="comment" data-id="12461559" data-no="81"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-81" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2791806_75935"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2791806_75935"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-81"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-81" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c81">Comment 81</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 15:11 PDT" data-time="1499724663">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-81">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-81" data-comment-id="12461559">    <a rel="nofollow" href="https://hg.mozilla.org/integration/mozilla-inbound/rev/64ce651bf43d15e711de6e752d80702cd991b336">https://hg.mozilla.org/integration/mozilla-inbound/rev/64ce651bf43d15e711de6e752d80702cd991b336</a>

to fix the gc hazards.</pre></div><div class="change-set" id="c82"><div class="comment" data-id="12461932" data-no="82"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-82" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2791806_75935"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2791806_75935"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-82"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-82" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c82">Comment 82</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733151">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-82">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885065"
         class="attachment patch"
         data-id="8885065" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-esr52.patch">
      <meta itemprop="contentSize" content="94030">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885065">
          <a class="link" href="attachment.cgi?id=8885065&amp;action=diff">
        <span id="att-8885065-description" itemprop="description">ESR52 patch updated to fix rooting hazard</span></a>
        — <a href="attachment.cgi?id=8885065&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885065">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2806777_20209"><div class="change" id="aa2806777_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806777_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806777_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806777_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806777_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806777_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733156">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884915&amp;action=edit"
           title="Updated esr52 rollup fix"
           class=""
        >Attachment #8884915</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8884915&amp;action=edit"
           title="Updated esr52 rollup fix"
           class=""
        >Attachment #8884915</a> -
        Flags: <span class="activity-deleted">approval-mozilla-esr52?</span></div></div></div><div class="change-set" id="c83"><div class="comment" data-id="12461934" data-no="83"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-83" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806777_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2806777_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-83"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-83" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c83">Comment 83</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733175">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-83">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885066"
         class="attachment patch"
         data-id="8885066" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-release.patch">
      <meta itemprop="contentSize" content="95808">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885066">
          <a class="link" href="attachment.cgi?id=8885066&amp;action=diff">
        <span id="att-8885066-description" itemprop="description">release patch updated to fix rooting hazard</span></a>
        — <a href="attachment.cgi?id=8885066&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885066">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2806799_20209"><div class="change" id="aa2806799_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806799_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806799_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806799_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806799_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806799_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:32 PDT" data-time="1499733178">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884917&amp;action=edit"
           title="Updated release channel rollup fix"
           class=""
        >Attachment #8884917</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8884917&amp;action=edit"
           title="Updated release channel rollup fix"
           class=""
        >Attachment #8884917</a> -
        Flags: <span class="activity-deleted">approval-mozilla-release?</span></div></div></div><div class="change-set" id="c84"><div class="comment" data-id="12461935" data-no="84"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-84" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806799_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a2806799_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-84"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-84" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c84">Comment 84</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733192">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-84">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><div id="att-8885067"
         class="attachment patch"
         data-id="8885067" itemscope itemtype="http://schema.org/MediaObject">
      <meta itemprop="name" content="rollup-beta.patch">
      <meta itemprop="contentSize" content="96039">
      <meta itemprop="encodingFormat" content="text/plain">
      <div class="label">
        Attached patch
          <meta itemprop="contentUrl" content="attachment.cgi?id=8885067">
          <a class="link" href="attachment.cgi?id=8885067&amp;action=diff">
        <span id="att-8885067-description" itemprop="description">beta patch updated to fix rooting hazard</span></a>
        — <a href="attachment.cgi?id=8885067&amp;action=edit" itemprop="url">Details</a>
          — <a href="/page.cgi?id=splinter.html&ignore=&bug=1371259&attachment=8885067">Splinter Review</a>
      </div>
    </div></div><div class="change-set" id="a2806816_20209"><div class="change" id="aa2806816_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806816_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806816_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806816_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806816_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806816_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733195">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8884916&amp;action=edit"
           title="Updated beta channel rollup fix"
           class=""
        >Attachment #8884916</a> -
        Attachment is obsolete: true</div><div class="change">
        <a href="/attachment.cgi?id=8884916&amp;action=edit"
           title="Updated beta channel rollup fix"
           class=""
        >Attachment #8884916</a> -
        Flags: <span class="activity-deleted">approval-mozilla-beta?</span></div></div></div><div class="change-set" id="a2806845_20209"><div class="change" id="aa2806845_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806845_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806845_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806845_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806845_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806845_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733224">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885065&amp;action=edit"
           title="ESR52 patch updated to fix rooting hazard"
           class=""
        >Attachment #8885065</a> -
        Flags: approval-mozilla-esr52?</div></div></div><div class="change-set" id="a2806852_20209"><div class="change" id="aa2806852_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806852_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806852_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806852_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806852_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806852_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733231">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885066&amp;action=edit"
           title="release patch updated to fix rooting hazard"
           class=""
        >Attachment #8885066</a> -
        Flags: approval-mozilla-release?</div></div></div><div class="change-set" id="a2806857_20209"><div class="change" id="aa2806857_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2806857_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2806857_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2806857_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2806857_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2806857_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 17:33 PDT" data-time="1499733236">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885067&amp;action=edit"
           title="beta patch updated to fix rooting hazard"
           class=""
        >Attachment #8885067</a> -
        Flags: approval-mozilla-beta?</div></div></div><div class="change-set" id="c85"><div class="comment" data-id="12462071" data-no="85"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-85" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_308534" id="a2806857_20209"><img src="https://secure.gravatar.com/avatar/bb55b2a8c34fd29f570ca139f13d46b8?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_308534" id="a2806857_20209"><a class="email " href="/user_profile?user_id=308534" > <span class="fna">Wes Kocher (:KWierso) (Not reading bugmail; email directly if needed)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-85"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-85" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c85">Comment 85</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 18:47 PDT" data-time="1499737630">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-85">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-85" data-comment-id="12462071"><a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/516a1c0c080e">https://hg.mozilla.org/mozilla-central/rev/516a1c0c080e</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/9c3018012352">https://hg.mozilla.org/mozilla-central/rev/9c3018012352</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/d58add6deeb1">https://hg.mozilla.org/mozilla-central/rev/d58add6deeb1</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/2338abec8626">https://hg.mozilla.org/mozilla-central/rev/2338abec8626</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/19c7f37f9920">https://hg.mozilla.org/mozilla-central/rev/19c7f37f9920</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/a32e94e98f03">https://hg.mozilla.org/mozilla-central/rev/a32e94e98f03</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/9491622034f1">https://hg.mozilla.org/mozilla-central/rev/9491622034f1</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/e9505b57cab7">https://hg.mozilla.org/mozilla-central/rev/e9505b57cab7</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/f1c298a314c6">https://hg.mozilla.org/mozilla-central/rev/f1c298a314c6</a>
<a rel="nofollow" href="https://hg.mozilla.org/mozilla-central/rev/64ce651bf43d">https://hg.mozilla.org/mozilla-central/rev/64ce651bf43d</a></pre><div class="activity"><div class="change">Status: ASSIGNED &rarr; RESOLVED</div><div class="change">Closed: <span class="rel-time" title="2017-07-10 18:47 PDT" data-time="1499737630">4 years ago</span></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a></div><div class="change">Resolution: --- &rarr; FIXED</div><div class="change">Target Milestone: --- &rarr; mozilla56</div></div></div><div class="change-set" id="a2824641_590618"><div class="change" id="aa2824641_590618">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_590618" id="a2824641_590618"><img src="https://secure.gravatar.com/avatar/b015363a314ff387c498d148d905cd87?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_590618" id="a2824641_590618"><a class="email " href="/user_profile?user_id=590618" > <span class="fna">Ionuț Goldan [:igoldan]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2824641_590618"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2824641_590618">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2824641_590618">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 22:30 PDT" data-time="1499751020">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Depends on: <a class="bz_bug_link
          bz_status_NEW"
   title="NEW - 2.46 - 8.27% compiler warnings (android-4-0-armv7-api15, android-4-2-x86, android-5-0-aarch64, android-api-15-gradle, linux32, linux64) regression on push 64ce651bf43d15e711de6e752d80702cd991b336 (Tue Jul 11 2017)"
   href="/show_bug.cgi?id=1379880">1379880</a></div></div></div><div class="change-set" id="a2826304_20209"><div class="change" id="aa2826304_20209">
    <table class="layout-table change-head assignee" role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a2826304_20209"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_20209" id="a2826304_20209"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
            <span class="user-role">Assignee</span>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2826304_20209"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2826304_20209">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2826304_20209">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-10 22:58 PDT" data-time="1499752683">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::HTMLInputElement::MaybeInitPickers"
   href="/show_bug.cgi?id=1378110">1378110</a></div></div></div><div class="change-set" id="a2832942_24295"><div class="change" id="aa2832942_24295">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_24295" id="a2832942_24295"><img src="https://secure.gravatar.com/avatar/21a031df69f8c0549475a8cdc06f53f5?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_24295" id="a2832942_24295"><a class="email " href="/user_profile?user_id=24295" > <span class="fna">Peter Van der Beken [:peterv]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2832942_24295"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2832942_24295">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2832942_24295">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 00:48 PDT" data-time="1499759321">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885007&amp;action=edit"
           title="Minor update to fix gc hazards"
           class=""
        >Attachment #8885007</a> -
        Flags: review?(peterv) &rarr; review+</div></div></div><div class="change-set" id="c86"><div class="comment" data-id="12462858" data-no="86"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-86" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_580382" id="a2832942_24295"><img src="https://secure.gravatar.com/avatar/15b9b3783e4671cd882bff1316df14c9?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_580382" id="a2832942_24295"><a class="email " href="/user_profile?user_id=580382" > <span class="fna">Julien Cristau [:jcristau]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-86"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-86" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c86">Comment 86</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 02:33 PDT" data-time="1499765604">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-86">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-86" data-comment-id="12462858">Comment on <span class=""><a href="/attachment.cgi?id=8885067" name="attach_8885067" title="beta patch updated to fix rooting hazard">attachment 8885067</a> <a href="/attachment.cgi?id=8885067&amp;action=edit" title="beta patch updated to fix rooting hazard">[details]</a> <a href="/attachment.cgi?id=8885067&amp;action=diff" title="beta patch updated to fix rooting hazard">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8885067'>[review]</a>
beta patch updated to fix rooting hazard

sec-critical, seems to stick on trunk; beta55+</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885067&amp;action=edit"
           title="beta patch updated to fix rooting hazard"
           class=""
        >Attachment #8885067</a> -
        Flags: approval-mozilla-beta? &rarr; approval-mozilla-beta+</div></div></div><div class="change-set" id="c87"><div class="comment" data-id="12463594" data-no="87"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-87" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_277293" id="a2832942_24295"><img src="https://secure.gravatar.com/avatar/8378311bf1bd5e9eddc7896a07688876?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_277293" id="a2832942_24295"><a class="email disabled" href="/user_profile?user_id=277293" > <span class="fna">Carsten Book [:Tomcat]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-87"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-87" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c87">Comment 87</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 07:26 PDT" data-time="1499783194">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-87">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-87" data-comment-id="12463594"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-beta/rev/e3d205dc31f3">https://hg.mozilla.org/releases/mozilla-beta/rev/e3d205dc31f3</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a2862337_1689"><div class="change" id="aa2862337_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a2862337_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a2862337_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a2862337_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a2862337_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a2862337_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-11 08:58 PDT" data-time="1499788716">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: dom-core-security &rarr; core-security-release</div></div></div><div class="change-set" id="c88"><div class="comment" data-id="12465946" data-no="88"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-88" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_506302" id="a2862337_1689"><img src="https://secure.gravatar.com/avatar/58cce0c47d9c6efb7d83bc34b9d79816?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_506302" id="a2862337_1689"><a class="email disabled" href="/user_profile?user_id=506302" > <span class="fna">Gerry Chang [:gchang]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-88"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-88" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c88">Comment 88</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 00:25 PDT" data-time="1499844326">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-88">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-88" data-comment-id="12465946">Comment on <span class=""><a href="/attachment.cgi?id=8885066" name="attach_8885066" title="release patch updated to fix rooting hazard">attachment 8885066</a> <a href="/attachment.cgi?id=8885066&amp;action=edit" title="release patch updated to fix rooting hazard">[details]</a> <a href="/attachment.cgi?id=8885066&amp;action=diff" title="release patch updated to fix rooting hazard">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8885066'>[review]</a>
release patch updated to fix rooting hazard

Since status-firefox54 was marked as won't fix, Release54-.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885066&amp;action=edit"
           title="release patch updated to fix rooting hazard"
           class=""
        >Attachment #8885066</a> -
        Flags: approval-mozilla-release? &rarr; approval-mozilla-release-</div></div></div><div class="change-set" id="c89"><div class="comment" data-id="12468261" data-no="89"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-89" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_451704" id="a2862337_1689"><img src="https://secure.gravatar.com/avatar/6168ea97fda0cefa449331e59b24e8f7?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_451704" id="a2862337_1689"><a class="email " href="/user_profile?user_id=451704" > <span class="fna">Liz Henry (:lizzard Please n-i to RyanVM, jcristau, or pascal)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-89"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-89" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c89">Comment 89</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 12:56 PDT" data-time="1499889393">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-89">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-89" data-comment-id="12468261">Comment on <span class=""><a href="/attachment.cgi?id=8885065" name="attach_8885065" title="ESR52 patch updated to fix rooting hazard">attachment 8885065</a> <a href="/attachment.cgi?id=8885065&amp;action=edit" title="ESR52 patch updated to fix rooting hazard">[details]</a> <a href="/attachment.cgi?id=8885065&amp;action=diff" title="ESR52 patch updated to fix rooting hazard">[diff]</a></span> <a href='/page.cgi?id=splinter.html&amp;ignore=&amp;bug=1371259&amp;attachment=8885065'>[review]</a>
ESR52 patch updated to fix rooting hazard

Sec-critical, sounds bad, let's land this on esr since it's going to release with 55.</pre><div class="activity"><div class="change">
        <a href="/attachment.cgi?id=8885065&amp;action=edit"
           title="ESR52 patch updated to fix rooting hazard"
           class=""
        >Attachment #8885065</a> -
        Flags: approval-mozilla-esr52? &rarr; approval-mozilla-esr52+</div></div></div><div class="change-set" id="c90"><div class="comment" data-id="12468927" data-no="90"
       data-tags="uplift">
    
    <table class="layout-table change-head " id="ch-90" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_75935" id="a2862337_1689"><img src="https://secure.gravatar.com/avatar/a10f7f199c75a9a5a1eb347730524a7a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_75935" id="a2862337_1689"><a class="email " href="/user_profile?user_id=75935" > <span class="fna">Ryan VanderMeulen [:RyanVM]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-90"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-90" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c90">Comment 90</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-12 16:51 PDT" data-time="1499903498">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-90">
        <td colspan="2" class="comment-tags"><span class="comment-tag">uplift</span>
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-90" data-comment-id="12468927"><a rel="nofollow" href="https://hg.mozilla.org/releases/mozilla-esr52/rev/0a86729d653e">https://hg.mozilla.org/releases/mozilla-esr52/rev/0a86729d653e</a></pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=affected">affected</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a></div></div></div><div class="change-set" id="a3043378_406194"><div class="change" id="aa3043378_406194">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_406194" id="a3043378_406194"><img src="https://secure.gravatar.com/avatar/0a70c84cd33dba0151fe15f2f8773137?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_406194" id="a3043378_406194"><a class="email " href="/user_profile?user_id=406194" > <span class="fna">Andrew McCreight [:mccr8]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3043378_406194"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3043378_406194">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a3043378_406194">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-13 11:15 PDT" data-time="1499969757">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">No longer blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::HTMLInputElement::MaybeInitPickers"
   href="/show_bug.cgi?id=1378110">1378110</a></div></div><div class="activity"><div class="change">Duplicate of this bug: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::HTMLInputElement::MaybeInitPickers"
   href="/show_bug.cgi?id=1378110">1378110</a></div></div></div><div class="change-set" id="c93"><div class="comment" data-id="12471646" data-no="93"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-93" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a3043378_406194"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a3043378_406194"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-93"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-93" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c93">Comment 93</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-13 12:35 PDT" data-time="1499974527">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-93">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-93" data-comment-id="12471646">Right, for bounty purposes: this bug report was awesome.  It pointed out a longstanding architectural problem and it was quite easy to go from the provided information to the problem determination.  If we have to have security bug reports, this is the kind I want.  ;)</pre></div><div class="change-set" id="a3087838_488993"><div class="change" id="aa3087838_488993">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a3087838_488993"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_488993" id="a3087838_488993"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3087838_488993"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3087838_488993">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a3087838_488993">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-13 23:36 PDT" data-time="1500014217">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: qe-verify+</div></div></div><div class="change-set" id="a3386819_1689"><div class="change" id="aa3386819_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a3386819_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a3386819_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3386819_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3386819_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a3386819_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-17 10:39 PDT" data-time="1500313198">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Flags: sec-bounty? &rarr; sec-bounty+</div></div></div><div class="change-set" id="a3490228_280903"><div class="change" id="aa3490228_280903">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_280903" id="a3490228_280903"><img src="https://secure.gravatar.com/avatar/58211442c4cece862d7a7850637c4edc?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_280903" id="a3490228_280903"><a class="email " href="/user_profile?user_id=280903" > <span class="fna">Al Billings [:abillings - ex-MoCo]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a3490228_280903"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a3490228_280903">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a3490228_280903">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-18 15:23 PDT" data-time="1500416607">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Alias: CVE-2017-7801</div><div class="change">Whiteboard: [adv-main55+][adv-esr52.3+]</div></div></div><div class="change-set" id="c94"><div class="comment" data-id="12507045" data-no="94"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-94" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a3490228_280903"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_488993" id="a3490228_280903"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-94"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-94" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c94">Comment 94</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-26 00:54 PDT" data-time="1501055697">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-94">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-94" data-comment-id="12507045">I've reproduced the crash on an affected build (asan 52.2esr, 20170608175922) using the test case from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c0">Comment 0</a> on Ubuntu 16.04 x64.

The crash is no longer ocurring on Ubuntu 16.04 x64 using:

      - asan 52.2esr (20170726030943)


Unfortunately I couldn't make the domFuzzLite3 add-on work with 55 and 56: tried setting xpinstall.signatures.required;false and extensions.allow-non-mpc-extensions;true and it still got disabled. Also tried loading it temporarily through about:debugging, with no success.


I tried reproducing the crash with the following regular asan builds instead and I was unable to:

      - asan 55.0b13 (20170726032849)
      - asan 56.0a1 (20170726020448)

Nils, do you have any tips on how I could make the add-on work with newer Fx versions? Thanks!</pre><div class="activity"><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=isnotempty">status-firefox-esr52</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=fixed">fixed</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox_esr52&amp;o1=equals&amp;v1=verified">verified</a></div><div class="change">Flags: needinfo?(nils)</div></div></div><div class="change-set" id="c95"><div class="comment" data-id="12508706" data-no="95"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-95" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_486634" id="a3490228_280903"><img src="https://secure.gravatar.com/avatar/a2837b951fa7dc639a2568203478ff0a?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_486634" id="a3490228_280903"><a class="email " href="/user_profile?user_id=486634" > <span class="fna">Tyson Smith [:tsmith] (PTO)</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-95"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-95" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c95">Comment 95</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-26 09:29 PDT" data-time="1501086595">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-95">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-95" data-comment-id="12508706">(In reply to Andrei Vaida [:avaida], Desktop Release QA – please ni? me from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c94">comment #94</a>)
<span class="quote">&gt; Nils, do you have any tips on how I could make the add-on work with newer Fx
&gt; versions? Thanks!</span >

Andrei, you can use ffpuppet[1]. It is a python module that the fuzzing team uses to automate launching the browser. You will need the unpacked extension which can be found here[2]. 

Then to launch the browser you would the command: python ffpuppet.py path/to/browser/firefox -e &lt;extension_path&gt; -p &lt;your_prefs_file&gt; -d

You can use the prefs file available here[3] or your own custom prefs.js

Hopefully that helps.

[1] <a rel="nofollow" href="https://github.com/MozillaSecurity/ffpuppet">https://github.com/MozillaSecurity/ffpuppet</a>
[2] <a rel="nofollow" href="https://github.com/MozillaSecurity/domfuzz/tree/master/dom">https://github.com/MozillaSecurity/domfuzz/tree/master/dom</a>
[3] <a rel="nofollow" href="https://github.com/MozillaSecurity/ffpuppet/blob/master/prefs/fuzzing-no-e10s.prefs.js">https://github.com/MozillaSecurity/ffpuppet/blob/master/prefs/fuzzing-no-e10s.prefs.js</a></pre></div><div class="change-set" id="c96"><div class="comment" data-id="12521763" data-no="96"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-96" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_488993" id="a3490228_280903"><img src="https://secure.gravatar.com/avatar/42f2a9436bbaefa7e0028e214f2b9350?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_488993" id="a3490228_280903"><a class="email " href="/user_profile?user_id=488993" > <span class="fna">Andrei Vaida [:avaida]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-96"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-96" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c96">Comment 96</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-07-31 05:12 PDT" data-time="1501503179">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-96">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-96" data-comment-id="12521763">Thank you, Tyson - it works. 

I've managed to verify the fix on Ubuntu 16.04 x64 using the following versions as well:

        - asan 55.0b13 (20170726032849)
        - asan 56.0a1 (20170726020448)</pre><div class="activity"><div class="change">Status: RESOLVED &rarr; VERIFIED</div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=isnotempty">status-firefox55</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=fixed">fixed</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox55&amp;o1=equals&amp;v1=verified">verified</a></div><div class="change">
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=isnotempty">status-firefox56</a>:
          <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=fixed">fixed</a> &rarr; <a href="/buglist.cgi?f1=cf_status_firefox56&amp;o1=equals&amp;v1=verified">verified</a></div><div class="change">Flags: <span class="activity-deleted">qe-verify+</span></div><div class="change">Flags: <span class="activity-deleted">needinfo?(nils)</span></div></div></div><div class="change-set" id="a9616034_293943"><div class="change" id="aa9616034_293943">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_293943" id="a9616034_293943"><img src="https://secure.gravatar.com/avatar/711e7c6f7c2c62a7bc2eb760585c3daa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_293943" id="a9616034_293943"><a class="email " href="/user_profile?user_id=293943" > <span class="fna">Markus Stange [:mstange]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a9616034_293943"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a9616034_293943">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a9616034_293943">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-09-27 13:00 PDT" data-time="1506542413">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Blocks: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::ParseColor"
   href="/show_bug.cgi?id=1371269">1371269</a></div></div></div><div class="change-set" id="a11454736_1689"><div class="change" id="aa11454736_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a11454736_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a11454736_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a11454736_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a11454736_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a11454736_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-18 19:45 PDT" data-time="1508381115">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Duplicate of this bug: <a class="bz_bug_link
          bz_status_RESOLVED bz_closed"
   title="RESOLVED DUPLICATE - heap-use-after-free in mozilla::dom::CanvasRenderingContext2D::ParseColor"
   href="/show_bug.cgi?id=1371269">1371269</a></div></div></div><div class="change-set" id="c98"><div class="comment" data-id="12777046" data-no="98"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-98" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_417288" id="a11454736_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_417288" id="a11454736_1689"><a class="email " href="/user_profile?user_id=417288" > <span class="fna">Nathan Froyd [:froydnj]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-98"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-98" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c98">Comment 98</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-20 10:07 PDT" data-time="1508519225">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-98">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-98" data-comment-id="12777046">So looking at this and the related bugs for some stats I'm collecting...why weren't some of the rooting problems here caught by our hazard analysis?  Is it because proxies were involved, and we're just looking at the possibility of garbage collection happening in the hazard analysis, and not considering things like dead proxies getting swapped in underneath us?</pre><div class="activity"><div class="change">Flags: needinfo?(continuation)</div><div class="change">Flags: needinfo?(bzbarsky)</div></div></div><div class="change-set" id="c99"><div class="comment" data-id="12777384" data-no="99"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-99" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11454736_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11454736_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-99"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-99" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c99">Comment 99</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-20 12:01 PDT" data-time="1508526083">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-99">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-99" data-comment-id="12777384">The fundamental code pattern in this bug was, in pseudo-C++-code:

  void doStuff(HandleObject obj) {
    nsISupports* foo;
    if (IsProxy(obj)) {
      foo = Unwrap(obj)-&gt;GetFoo();
    } else {
      foo = obj-&gt;GetFoo();
    }

    // Use foo and assume it stays alive even across GC.
  }

From the point of view of rooting analysis, there is no problem here.  &quot;obj&quot; is rooted.  Unwrap(obj) is not rooted, but its liveness lifetime does not cross a possible GC.  The nsISupports* _does_ have a liveness lifetime that crosses possible GC, but it's not a GCThing, so the rooting analysis doesn't care about it.

The fact that in the IsProxy() case the valid lifetime of &quot;foo&quot; matches the valid lifetime of Unwrap(obj) is not something the rooting analysis has a way to derive...

Now if we ignore the dead proxy bit, then everything is still ok: &quot;obj&quot; is rooted, it keeps Unwrap(obj) rooted, and that keeps &quot;foo&quot; alive.  But the dead proxy thing means that &quot;it keeps Unwrap(obj) rooted&quot; can become false, and then you lose.  But that was a problem that was missed by manual analysis, not the automated static analysis, because the automatic analysis didn't have a concept of &quot;it keeps Unwrap(obj) rooted&quot; in the first place; as far as it's concerned, Unwrap(obj) is _not_ rooted, but also not used across GC...</pre><div class="activity"><div class="change">Flags: <span class="activity-deleted">needinfo?(continuation)</span></div><div class="change">Flags: <span class="activity-deleted">needinfo?(bzbarsky)</span></div></div></div><div class="change-set" id="c100"><div class="comment" data-id="12790169" data-no="100"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-100" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_359004" id="a11454736_1689"><img src="https://secure.gravatar.com/avatar/d269c0228684029dedb75d73b81a64c3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_359004" id="a11454736_1689"><a class="email " href="/user_profile?user_id=359004" > <span class="fna">Steve Fink [:sfink] [:s:]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-100"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-100" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c100">Comment 100</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-25 12:10 PDT" data-time="1508958600">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-100">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-100" data-comment-id="12790169">Let me try repeating the problematic path that I understood: Unwrap(obj) returns an unrooted GC pointer that we call GetFoo() on, and its return value's (foo's) lifetime is contained within the unwrapped obj's lifetime, and foo is held live across a later GC.

So a hypothetical analysis would need to (1) somehow know that the lifetime of GetFoo's return value is contained within its 'this', and (2) do some amount of dataflow analysis to know that foo gets assigned an nsISupports* with a GC-controlled lifetime. Neither smells totally crazy, but I would worry about complexity and false positives.

unwrapped-&gt;GetFoo() is really something like XPCWrappedNative::Get(unwrapped), right?

If people are interested in this, please file a bug to at least get it on record. (Preferably clearing whatever misconceptions I have in the above.) I haven't thought too hard about the feasibility. And my current leaning would be to resuscitate mccr8's DOM iterator analysis before working on this, but opinions are welcome.</pre></div><div class="change-set" id="c101"><div class="comment" data-id="12790337" data-no="101"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-101" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11454736_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11454736_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-101"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-101" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c101">Comment 101</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-10-25 13:10 PDT" data-time="1508962239">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-101">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-101" data-comment-id="12790337"><span class="quote">&gt; and its return value's (foo's) lifetime is contained within the unwrapped obj's lifetime</span >

Conceptually, yes.  On the C++ language level, no.  The logic we used to have looks kinda like this:

  void* GetFoo(JSObject* obj) {
    if (IsWrapper(obj)) {
      return GetFoo(Unwrap(obj));
    }

    return GetReservedSlot(obj, 0).toPrivate();
  }

or:

  void* GetFoo(JSObject* obj) {
    if (IsWrapper(obj)) {
      return GetReservedSlot(Unwrap(obj), 0).toPrivate();
    }

    return GetReservedSlot(obj, 0).toPrivate();
  }

but in either case the void* is outliving the JSObject* returned by Unwrap(), from a static-analysis point of view....

<span class="quote">&gt; unwrapped-&gt;GetFoo() is really something like XPCWrappedNative::Get(unwrapped), right?</span >

It's dom::UnwrapDOMObject; see <a rel="nofollow" href="http://searchfox.org/mozilla-central/rev/1285ae3e810e2dbf2652c49ee539e3199fcfe820/dom/bindings/BindingUtils.h#155-164">http://searchfox.org/mozilla-central/rev/1285ae3e810e2dbf2652c49ee539e3199fcfe820/dom/bindings/BindingUtils.h#155-164</a>

But yes, conceptually pretty similar to XPCWrappedNative::Get.</pre></div><div class="change-set" id="c102"><div class="comment" data-id="12823118" data-no="102"
       data-tags="">
    
    <table class="layout-table change-head " id="ch-102" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_359004" id="a11454736_1689"><img src="https://secure.gravatar.com/avatar/d269c0228684029dedb75d73b81a64c3?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_359004" id="a11454736_1689"><a class="email " href="/user_profile?user_id=359004" > <span class="fna">Steve Fink [:sfink] [:s:]</span></a>
</div>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-102"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-102" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c102">Comment 102</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-06 22:44 PST" data-time="1510037060">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-102">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-102" data-comment-id="12823118">(In reply to Boris Zbarsky [:bz] (no decent commit message means r-) from <a class="bz_bug_link
          bz_status_VERIFIED bz_closed"
   title="VERIFIED FIXED - heap-use-after-free in nsComputedDOMStyle::UpdateCurrentStyleSources"
   href="/show_bug.cgi?id=1371259#c101">comment #101</a>)
<span class="quote">&gt; &gt; and its return value's (foo's) lifetime is contained within the unwrapped obj's lifetime
&gt; 
&gt; Conceptually, yes.  On the C++ language level, no.
&gt; ...
&gt; in either case the void* is outliving the JSObject* returned by
&gt; Unwrap(), from a static-analysis point of view....</span >

Right, exactly. I think we're saying the same thing.

But I should have paid more attention to the dead proxy bit. It's true that the case above is funky because obj can cease keeping Unwrap(obj) alive. But actually, the analysis doesn't know or care that obj is rooted. The HandleObject is meaningless to it. It just sees it as JSObject**, which doesn't require rooting.

So come to think of it, this is an interior pointer. obj-&gt;GetFoo() and Unwrap(obj)-&gt;GetFoo() are pretty much the same thing -- both return an interior pointer, and the analysis at least currently has no reason to believe that the interior pointer is going to survive the GC. Neither obj nor Unwrap(obj) is rooted in its point of view, though note that the analysis presently doesn't handle interior pointers anyway.

As is, this looks like a recipe for a massive number of false positives. It would at *least* need to know that HandleObject points to a rooted pointer. But I doubt that would be enough. Consider

  foo(HandleObject obj) {
    cobj = (CStruct*) obj.getPrivate();
    foo = GetFoo(cobj-&gt;GetSomeJSObjectMember());
    gc();
    use(foo);
  }

This is safe, because obj is rooted so everything else is going to stay alive. But the hypothetical analysis would scream because foo is an interior pointer in the temporary returned by cobj-&gt;GetSomeJSObjectMember(), and it has no reason to believe that it will stay alive. (And note this case also shows that treating HandleObject as rooted isn't all that helpful; obj might have a weak pointer to cobj, so you can't tell from this code whether obj really keeps cobj and cobj-&gt;mSomeJSObjectMember alive.)

Never mind, I'm not seeing much potential for the analysis to catch this case after all. The best I see is if we treated Unwrap() as returning an extra-volatile pointer that propagates its brittleness on any arbitrary call to the call's return value, and then check whether any brittle values are live across a GC. (It would be extra volatile because of the dead proxy possibility.) But that still seems like a lot of false positives and false negatives.

Well, the false negatives could be handled by saying if you Unwrap and then GC, you shouldn't touch any pointers at all. I won't be the judge of how problematic that might be.</pre></div><div class="change-set" id="c103"><div class="comment" data-id="12824244" data-no="103"
       data-tags="">
    
    <table class="layout-table change-head assignee" id="ch-103" role="presentation">
      <tr>
          <td rowspan="2" class="change-gravatar"><div class="vcard vcard_20209" id="a11454736_1689"><img src="extensions/Gravatar/web/default.jpg" class="gravatar" width="32" height="32">
</div>
          </td>

          <td class="change-author"><div class="vcard vcard_20209" id="a11454736_1689"><a class="email " href="/user_profile?user_id=20209" > <span class="fna">Boris Zbarsky [:bzbarsky]</span></a>
</div>
              <span class="user-role">Assignee</span>
          </td>

        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="cs-103"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>

      <tr id="cr-103" >
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#c103">Comment 103</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2017-11-07 07:22 PST" data-time="1510068122">4 years ago</span>
          </div>
        </td>
      </tr>

      <tr id="ctag-103">
        <td colspan="2" class="comment-tags">
        </td>
      </tr>
    </table>

    
  </div><pre
        class="comment-text  "
        id="ct-103" data-comment-id="12824244"><span class="quote">&gt; This is safe, because obj is rooted so everything else is going to stay alive.</span >

Maybe, maybe not.  Just because cobj has a JS object member, doesn't mean it traces it.  It could instead clear it out on finalization.  For an example, see nsWrapperCache when not preserving the wrapper.

<span class="quote">&gt; so you can't tell from this code whether obj really keeps cobj and cobj-&gt;mSomeJSObjectMember alive.</span >

Yep.</pre></div><div class="change-set" id="a20605976_1689"><div class="change" id="aa20605976_1689">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1689" id="a20605976_1689"><img src="https://secure.gravatar.com/avatar/da6b54ad3fdb36ba7656df9adfe65d12?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1689" id="a20605976_1689"><a class="email " href="/user_profile?user_id=1689" > <span class="fna">Daniel Veditz [:dveditz]</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a20605976_1689"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a20605976_1689">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a20605976_1689">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2018-02-01 16:45 PST" data-time="1517532355">4 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Group: <span class="activity-deleted">core-security-release</span></div></div></div><div class="change-set" id="a55558146_1"><div class="change" id="aa55558146_1">
    <table class="layout-table change-head " role="presentation">
      <tr>
        <td rowspan="2" class="change-gravatar"><div class="vcard vcard_1" id="a55558146_1"><img src="https://secure.gravatar.com/avatar/eaa3c40fff208819d0810fc338eea0aa?d=mm&size=64" class="gravatar" width="32" height="32">
</div>
        </td>
        <td class="change-author"><div class="vcard vcard_1" id="a55558146_1"><a class="email " href="/user_profile?user_id=1" > <span class="fna">Nobody; OK to take it and work on it</span></a>
</div>
        </td>
        <td rowspan="2" class="comment-actions"><div role="group">
          <button type="button" class="change-spinner minor iconic" id="as-a55558146_1"
                  aria-label="Collapse" aria-expanded="true"
                  data-strings='{ "collapse_label": "Collapse", "expand_label": "Expanded" }'>
            <span class="icon" aria-hidden="true"></span>
          </button>
        </div></td>
      </tr>
      <tr id="ar-a55558146_1">
        <td>
          <h3 class="change-name">
            <a href="/show_bug.cgi?id=1371259#a55558146_1">Updated</a>
          </h3>
          &bull;
          <div class="change-time"><span class="rel-time" title="2019-03-13 06:42 PDT" data-time="1552484525">3 years ago</span>
          </div>
        </td>
      </tr>
    </table>
  </div><div class="activity"><div class="change">Component: DOM &rarr; DOM: Core &amp; HTML</div></div></div><div id="new-comment-notice">
          You need to <a href="/show_bug.cgi?id=1371259&amp;GoAheadAndLogIn=1">log in</a>
          before you can comment on or make changes to this bug.
        </div>



<div id="bottom-actions">
  <div id="bottom-right-actions">
    <button type="button" id="top-btn" class="secondary" aria-label="Go to Page Top">Top &uarr;</button>
  </div>
</div></div> 
</main> 
</div> 


</body>
</html>