(*) Out-of-bounds write in dlls/gdi32/enhmetafile.c:951 (last commit: dd2624a24fba400bf59b9396e496d16c43d399d9):

mr is an EMF record from an attacker controlled file. Hence pCreatePen
in line 950 is fully controlled and allows an almost arbitary write at line
951.


 749 BOOL WINAPI PlayEnhMetaFileRecord(
 750      HDC hdc,                   /* [in] device context in which to render EMF record */
 751      LPHANDLETABLE handletable, /* [in] array of handles to be used in rendering record */
 752      const ENHMETARECORD *mr,   /* [in] EMF record to render */
 753      UINT handles               /* [in] size of handle array */
 754      )
 755 {
 756   int type;
 ...
 764   type = mr->iType;
 ...
 767   switch(type)
 768     {
 ...
 948     case EMR_CREATEPEN:
 949       {
 950     const EMRCREATEPEN *pCreatePen = (const EMRCREATEPEN *)mr;
 951     (handletable->objectHandle)[pCreatePen->ihPen] =               // <= full control over array index (pCreatePen->ihPen)
 952       CreatePenIndirect(&pCreatePen->lopn);                            
 953     break;