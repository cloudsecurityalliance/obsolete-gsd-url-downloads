<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 802593004: WebAudio: Fix AudioNode leak in a case that AudioNode is not disconnected from the graph explicitly. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '744217d8ce413316cf7c06f11a1564fc';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/802593004%252526ust%25253D1608665584921306%252526usg%25253DAFQjCNF63fTOVBI0fYmpTdNGt2haPFlu9A%26service%3Dah">Sign out</a>

</div>
<div class="counter">(31)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-802593004">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/802593004/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            802593004</a>:
    WebAudio: Fix AudioNode leak in a case that AudioNode is not disconnected from the graph explicitly.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            6 years ago by <a href="/user/tkent" onMouseOver="M_showUserInfoPopup(this)">tkent</a>
          </div>
          <div><b>Modified:</b><br/>
            5 years, 10 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <a href="/user/oilpan-reviews" onMouseOver="M_showUserInfoPopup(this)">oilpan-reviews</a>, <span class='approval'><a href="/user/haraken" onMouseOver="M_showUserInfoPopup(this)">haraken</a></span>, <a href="/user/Raymond%20Toy" onMouseOver="M_showUserInfoPopup(this)">Raymond Toy</a>
          </div>
          
          <div><b>CC:</b><br/>
            blink-reviews, oilpan-reviews, kouhei+heap_chromium.org, Mads Ager (chromium)
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
              <a href="http://src.chromium.org/viewvc/blink/trunk" target="blank">
            
            svn://svn.chromium.org/blink/trunk
            
              </a>
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=blink">
              blink
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - 82804f94bf4b4d551c864ff2ef44317633f76246"
               href="/search?repo_guid=82804f94bf4b4d551c864ff2ef44317633f76246">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">WebAudio: Fix AudioNode leak in a case that AudioNode is not disconnected from the graph explicitly.

The main purpose of this CL is to introduce ThreadState::markAsZombie
and ThreadState::purifyZombies, and to apply them for WebAudio.
Objects marked as zombies are not finalized until purifyZombies is
called.

This CL also adds MarkingTasks, which enable to run tasks before/
after Oilpan marking. AudioContext implements MarkingTask in order to
call purifyZombie before marking, and simplify AudioContext::trace.


BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=434136">434136</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=455993">455993</a>
Committed: <a href="https://src.chromium.org/viewvc/blink?view=rev&amp;revision=190366">https://src.chromium.org/viewvc/blink?view=rev&amp;revision=190366</a>
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/802593004/#ps1"
       onclick="M_toggleSectionForPS('802593004', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/802593004/#ps40001"
       onclick="M_toggleSectionForPS('802593004', '40001')"
       class="toggled-section ">
      Patch Set 2
      : New marking mode, simpify WebAudio code
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 8
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/802593004/#ps60001"
       onclick="M_toggleSectionForPS('802593004', '60001')"
       class="toggled-section ">
      Patch Set 3
      : Move removeMarkingTask to uninitialize()
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/802593004/#ps80001"
       onclick="M_toggleSectionForPS('802593004', '80001')"
       class="toggled-section ">
      Patch Set 4
      : rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/802593004/#ps100001"
       onclick="M_toggleSectionForPS('802593004', '100001')"
       class="toggled-section opentriangle">
      Patch Set 5
      : rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 3
      
    </div>
  

  <div id="ps-100001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 5 years, 10 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue802593004_100001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/802593004/100001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+184 lines, -24 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110002">
            Source/modules/webaudio/AudioContext.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/modules/webaudio/AudioContext.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/modules/webaudio/AudioContext.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/modules/webaudio/AudioContext.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/modules/webaudio/AudioContext.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/modules/webaudio/AudioContext.h"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+14 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110002.diff"
             title="Download patch for Source/modules/webaudio/AudioContext.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110001">
            Source/modules/webaudio/AudioContext.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/modules/webaudio/AudioContext.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/modules/webaudio/AudioContext.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/modules/webaudio/AudioContext.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/modules/webaudio/AudioContext.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/modules/webaudio/AudioContext.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">7 chunks</td>
          <td style="white-space: nowrap">+37 lines, -8 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110001.diff"
             title="Download patch for Source/modules/webaudio/AudioContext.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110003">
            Source/modules/webaudio/AudioNode.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/modules/webaudio/AudioNode.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/modules/webaudio/AudioNode.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/modules/webaudio/AudioNode.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/modules/webaudio/AudioNode.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/modules/webaudio/AudioNode.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+5 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110003.diff"
             title="Download patch for Source/modules/webaudio/AudioNode.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110004">
            Source/modules/webaudio/AudioSummingJunction.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/modules/webaudio/AudioSummingJunction.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/modules/webaudio/AudioSummingJunction.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/modules/webaudio/AudioSummingJunction.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/modules/webaudio/AudioSummingJunction.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/modules/webaudio/AudioSummingJunction.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+0 lines, -5 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110004.diff"
             title="Download patch for Source/modules/webaudio/AudioSummingJunction.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110006">
            Source/platform/heap/Heap.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/platform/heap/Heap.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/platform/heap/Heap.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/platform/heap/Heap.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/platform/heap/Heap.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/platform/heap/Heap.h"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110006.diff"
             title="Download patch for Source/platform/heap/Heap.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110005">
            Source/platform/heap/Heap.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/platform/heap/Heap.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/platform/heap/Heap.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/platform/heap/Heap.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/platform/heap/Heap.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/platform/heap/Heap.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+26 lines, -8 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110005.diff"
             title="Download patch for Source/platform/heap/Heap.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110007">
            Source/platform/heap/HeapTest.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/platform/heap/HeapTest.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/platform/heap/HeapTest.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/platform/heap/HeapTest.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/platform/heap/HeapTest.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/platform/heap/HeapTest.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+14 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110007.diff"
             title="Download patch for Source/platform/heap/HeapTest.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110009">
            Source/platform/heap/ThreadState.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/platform/heap/ThreadState.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/platform/heap/ThreadState.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/platform/heap/ThreadState.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/platform/heap/ThreadState.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/platform/heap/ThreadState.h"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">6 chunks</td>
          <td style="white-space: nowrap">+29 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          <b>
            3 comments
            
            
          </b>
        </td>
        <td>
          <a href="/download/issue802593004_100001_110009.diff"
             title="Download patch for Source/platform/heap/ThreadState.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/802593004/patch/100001/110008">
            Source/platform/heap/ThreadState.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/802593004/diff/100001/Source/platform/heap/ThreadState.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/802593004/diff2/1:100001/Source/platform/heap/ThreadState.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/802593004/diff2/40001:100001/Source/platform/heap/ThreadState.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/802593004/diff2/60001:100001/Source/platform/heap/ThreadState.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/802593004/diff2/80001:100001/Source/platform/heap/ThreadState.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+58 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue802593004_100001_110008.diff"
             title="Download patch for Source/platform/heap/ThreadState.cpp">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 100001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 24 (4 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          tkent@chromium.org changed reviewers: + oilpan-reviews@chromium.org, rtoy@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-12 05:36:57 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:tkent@chromium.org">tkent@chromium.org</a> changed reviewers:
+ <a href="mailto:oilpan-reviews@chromium.org">oilpan-reviews@chromium.org</a>, <a href="mailto:rtoy@chromium.org">rtoy@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          I need to go out now. I&#39;ll add more information to the description later.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-12 05:36:58 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >I need to go out now.  I&#39;ll add more information to the description later.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          I understand what this CL is doing, but it seems that the approach has some ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-12 06:27:41 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >I understand what this CL is doing, but it seems that the approach has some
fundamental issues.

- The zombie marking runs after threads are resumed. This is not safe because
the zombie marking can trace an object of another thread that is mutating the
object. Global marking is allowed only when all threads are in safe points.

- Neither weak processing nor prefinalizer runs after the zombie marking. This
will break the semantics of weak processing and prefinalizer.

I think I&#39;m understanding the problem you want to solve, so let me think about
it a bit more.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          On 2014/12/12 06:27:41, haraken wrote: &gt; I understand what this CL is doing, but it ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-12 08:02:52 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >On 2014/12/12 06:27:41, haraken wrote:
&gt; I understand what this CL is doing, but it seems that the approach has some
&gt; fundamental issues.
&gt; 
&gt; - The zombie marking runs after threads are resumed. This is not safe because
&gt; the zombie marking can trace an object of another thread that is mutating the
&gt; object. Global marking is allowed only when all threads are in safe points.

Right.  So, we should apply zombie to object graphs consisted of objects owned
by the thread.

&gt; - Neither weak processing nor prefinalizer runs after the zombie marking. This
&gt; will break the semantics of weak processing and prefinalizer.

It&#39;s intentional.  Zombie marking happens after weak processing and
prefinalizer.  We should not apply them to an object twice.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          I&#39;m getting convinced that something like the zombie you proposed is not avoidable. Here are ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-15 01:25:13 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >I&#39;m getting convinced that something like the zombie you proposed is not
avoidable.

Here are a couple of suggestions to minimize the complexity added to the GC
infrastructure:

- Add visitor-&gt;resurrect(object). This API can be used in weak processing to
resurrect a dead object. We can weakly observe Audio nodes in m_referencingNodes
and resurrect the Audio node in weak processing. Then we won&#39;t need
registerZombie or MarkingTask.

- It is a responsibility for a mutator to keep the resurrected objects alive.
Specifically, the main thread should put the resurrected Audio nodes into a
HeapVector&lt;Member&lt;AudioNode&gt;&gt; to keep the objects alive. The main thread clears
the vector in AudioContext::deleteDisconnectedNodes(). Then we won&#39;t need
purifyZombie.

- To avoid this change from causing unexpected bugs in trunk, limit the object
type accepted by visitor-&gt;resurrect() to AudioNode. Specifically,
visitor-&gt;resurrect(AudioNode*).

- Implement something like ThreadLocalGC and add RELEASE_ASSERT() when the
thread-specific marking is going to enter an object graph owned by another
thread.

(That being said, this is still a very flimsy change. For example, weak
processing and/or pre-finalizers can be called for objects that are not actually
dead, because the objects can be resurrected in the thread-specific marking.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          On 2014/12/15 01:25:13, haraken wrote: &gt; - Add visitor-&gt;resurrect(object). This API can be used in ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 06:31:37 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >On 2014/12/15 01:25:13, haraken wrote:
&gt; - Add visitor-&gt;resurrect(object). This API can be used in weak processing to
&gt; resurrect a dead object. We can weakly observe Audio nodes in
m_referencingNodes
&gt; and resurrect the Audio node in weak processing. Then we won&#39;t need
&gt; registerZombie or MarkingTask.

Do you intend that resurrect() traces the specified object and objects referred
by the specified object immediately, or stores the specified object to
thread-local storage and traces them later?

I added the explanation of MarkingTask to the CL description.  We can&#39;t remove
MarkingTask even with your idea.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          On 2014/12/16 06:31:37, unavailable until Feburuary wrote: &gt; On 2014/12/15 01:25:13, haraken wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 06:43:10 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >On 2014/12/16 06:31:37, unavailable until Feburuary wrote:
&gt; On 2014/12/15 01:25:13, haraken wrote:
&gt; &gt; - Add visitor-&gt;resurrect(object). This API can be used in weak processing to
&gt; &gt; resurrect a dead object. We can weakly observe Audio nodes in
&gt; m_referencingNodes
&gt; &gt; and resurrect the Audio node in weak processing. Then we won&#39;t need
&gt; &gt; registerZombie or MarkingTask.
&gt; 
&gt; Do you intend that resurrect() traces the specified object and objects
referred
&gt; by the specified object immediately, or stores the specified object to
&gt; thread-local storage and traces them later?

I&#39;m intending to trace all reachable objects from the object specified in
resurrect().

I&#39;m just curious but is there any way to delay tracing the specified objects?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          On 2014/12/16 06:43:10, haraken wrote: &gt; I&#39;m intending to trace all reachable objects from the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 06:53:09 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >On 2014/12/16 06:43:10, haraken wrote:
&gt; I&#39;m intending to trace all reachable objects from the object specified in
&gt; resurrect().

Is it safe to trace objects in weak processing?  I&#39;m afraid a disaster happens
If an object has a WeakMember.

&gt; I&#39;m just curious but is there any way to delay tracing the specified objects?

I guess it&#39;s possible if we add a lot of code.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          On 2014/12/16 06:53:09, unavailable until Feburuary wrote: &gt; On 2014/12/16 06:43:10, haraken wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 08:06:41 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >On 2014/12/16 06:53:09, unavailable until Feburuary wrote:
&gt; On 2014/12/16 06:43:10, haraken wrote:
&gt; &gt; I&#39;m intending to trace all reachable objects from the object specified in
&gt; &gt; resurrect().
&gt; 
&gt; Is it safe to trace objects in weak processing?  I&#39;m afraid a disaster happens
&gt; If an object has a WeakMember.

What I have in mind is:

1) A mutator calls object-&gt;resurrect() for objects that need to be resurrected.
The mutator puts the objects into HeapVector&lt;Member&gt; to keep the objects alive
in subsequent GCs.
2) Once all the weak processings are complete, ThreadState starts thread-local
marking from the resurrected objects.
3) The mutator clears the HeapVector&lt;Member&gt; once the objects get unnecessary.

Will it work?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          On 2014/12/16 08:06:41, haraken wrote: &gt; 1) A mutator calls object-&gt;resurrect() for objects that need ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 08:16:47 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >On 2014/12/16 08:06:41, haraken wrote:
&gt; 1) A mutator calls object-&gt;resurrect() for objects that need to be
resurrected.
&gt; The mutator puts the objects into HeapVector&lt;Member&gt; to keep the objects alive
&gt; in subsequent GCs.
&gt; 2) Once all the weak processings are complete, ThreadState starts thread-local
&gt; marking from the resurrected objects.

So, ThreadState::resurrect(object) would be much simpler than
Visitor::resurrect(object) because ThreadState needs to keep zombie list
temporarily.

&gt; 3) The mutator clears the HeapVector&lt;Member&gt; once the objects get unnecessary.
&gt; 
&gt; Will it work?

I think so.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          On 2014/12/16 08:16:47, unavailable until Feburuary wrote: &gt; On 2014/12/16 08:06:41, haraken wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                6 years ago
		(2014-12-16 08:28:36 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >On 2014/12/16 08:16:47, unavailable until Feburuary wrote:
&gt; On 2014/12/16 08:06:41, haraken wrote:
&gt; &gt; 1) A mutator calls object-&gt;resurrect() for objects that need to be
&gt; resurrected.
&gt; &gt; The mutator puts the objects into HeapVector&lt;Member&gt; to keep the objects
alive
&gt; &gt; in subsequent GCs.
&gt; &gt; 2) Once all the weak processings are complete, ThreadState starts
thread-local
&gt; &gt; marking from the resurrected objects.
&gt; 
&gt; So, ThreadState::resurrect(object) would be much simpler than
&gt; Visitor::resurrect(object) because ThreadState needs to keep zombie list
&gt; temporarily.

Ah, got it! Agreed. ThreadState::resurrect(object) should be simpler, and I now
understand this is exactly what your original CL is trying to do.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          On 2014/12/16 08:28:36, haraken wrote: &gt; On 2014/12/16 08:16:47, unavailable until Feburuary wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-05 04:13:28 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >On 2014/12/16 08:28:36, haraken wrote:
&gt; On 2014/12/16 08:16:47, unavailable until Feburuary wrote:
&gt; &gt; On 2014/12/16 08:06:41, haraken wrote:
&gt; &gt; &gt; 1) A mutator calls object-&gt;resurrect() for objects that need to be
&gt; &gt; resurrected.
&gt; &gt; &gt; The mutator puts the objects into HeapVector&lt;Member&gt; to keep the objects
&gt; alive
&gt; &gt; &gt; in subsequent GCs.
&gt; &gt; &gt; 2) Once all the weak processings are complete, ThreadState starts
&gt; thread-local
&gt; &gt; &gt; marking from the resurrected objects.
&gt; &gt; 
&gt; &gt; So, ThreadState::resurrect(object) would be much simpler than
&gt; &gt; Visitor::resurrect(object) because ThreadState needs to keep zombie list
&gt; &gt; temporarily.
&gt; 
&gt; Ah, got it! Agreed. ThreadState::resurrect(object) should be simpler, and I
now
&gt; understand this is exactly what your original CL is trying to do.

Also, we can&#39;t update HeapVector in weak processing because it&#39;s in
NoAllocationScope.
So, the current TODO for this CL is only &quot;thread-local tracing&quot; asked in comment
#5.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          Patchset #2 (id:20001) has been deleted
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-06 04:07:45 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >Patchset #2 (id:20001) has been deleted</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          I have updated the patch. Please take a look at it. Updates: * Add new ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-06 04:12:40 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >I have updated the patch.  Please take a look at it.

Updates:

* Add new thread-local marking mode which asserts foreign objects
  It uses ASSERT, not RELEASE_ASSERT because findPageFromAddress is not
available in Release build.
  I confirmed Oilpan Debug build didn&#39;t fail at the assertion.

* Do not use CrossThreadTask in AudioContext.  The new code is much simpler.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          haraken@chromium.org changed reviewers: + haraken@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-06 07:57:23 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            ><a href="mailto:haraken@chromium.org">haraken@chromium.org</a> changed reviewers:
+ <a href="mailto:haraken@chromium.org">haraken@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp File Source/modules/webaudio/AudioContext.cpp (right): https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode169 Source/modules/webaudio/AudioContext.cpp:169: ThreadState::current()-&gt;removeMarkingTask(this); Can we move this to AudioContext::uninitialize()? https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1165 Source/modules/webaudio/AudioContext.cpp:1165: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-06 07:57:24 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            ><a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
File Source/modules/webaudio/AudioContext.cpp (right):

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode169" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:169:
ThreadState::current()-&gt;removeMarkingTask(this);

Can we move this to AudioContext::uninitialize()?

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1165" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1165: void
AudioContext::willStartMarking(ThreadState&amp; threadState)

willStartMarking is called not only in the ZombieMarking but also in a normal
global marking. Is it OK (if so, why)?

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1167" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1167: lock();

What happens if a GC is triggered during AudioContext&#39;s constructor before the
lock gets initialized?

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1170" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1170: if (m_lastZombie !=
m_lastRemovableZombie)

I don&#39;t quite get what m_lastZombie and m_lastRemovableZombie point to. Would
you elaborate?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp File Source/modules/webaudio/AudioContext.cpp (right): https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode169 Source/modules/webaudio/AudioContext.cpp:169: ThreadState::current()-&gt;removeMarkingTask(this); On 2015/02/06 07:57:23, haraken wrote: &gt; &gt; Can ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-09 07:00:50 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
File Source/modules/webaudio/AudioContext.cpp (right):

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode169" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:169:
ThreadState::current()-&gt;removeMarkingTask(this);
On 2015/02/06 07:57:23, haraken wrote:
&gt; 
&gt; Can we move this to AudioContext::uninitialize()?

Yes.  It&#39;s consistent because we call addMarkingTask in initialize().  Done.

We need to call purifyZombies() before a marking after the last
AudioContext::handlePostRenderTasks().  uninitialize().  So, we also need to add
purifyZombies() to uninitialize().

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1165" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1165: void
AudioContext::willStartMarking(ThreadState&amp; threadState)
On 2015/02/06 07:57:23, haraken wrote:
&gt; 
&gt; willStartMarking is called not only in the ZombieMarking but also in a normal
&gt; global marking. Is it OK (if so, why)?

It&#39;s ok.
There are two purposes of this hook:

* Simplify AudioContext::trace by calling lock()/unlock() in the task
  We need this for both of global marking and zombie marking.

* Calls purifyZombies() before zombie marking
  purifyZombies() on one of the markings is enough, and purifyZombies() on both
of markings is harmless.   The current code applies the latter for code
simplicity.

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1167" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1167: lock();
On 2015/02/06 07:57:23, haraken wrote:
&gt; 
&gt; What happens if a GC is triggered during AudioContext&#39;s constructor before the
&gt; lock gets initialized?

It won&#39;t happen.  This task is registered after the mutex initialization.

<a href="https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/AudioContext.cpp#newcode1170" rel="nofollow">https://codereview.chromium.org/802593004/diff/40001/Source/modules/webaudio/...</a>
Source/modules/webaudio/AudioContext.cpp:1170: if (m_lastZombie !=
m_lastRemovableZombie)
On 2015/02/06 07:57:23, haraken wrote:
&gt; 
&gt; I don&#39;t quite get what m_lastZombie and m_lastRemovableZombie point to. Would
&gt; you elaborate?

We need to avoid the following scenario:

1. GC happens
2. Some AudioNodes are unreachable, and their weak processing makes them
zombies.
3. Another GC happens.  We can&#39;t call purifyZombies() yet because
AudioContext::handlePostRenderTasks() is not called yet.
4. AudioContext::handlePostRenderTasks() is called on audio thread.  We may
purify all existing zombies, but we can&#39;t purify immediately because we&#39;re on
audio thread.
5. Another GC happens.  More AudioNodes are unreachable and their weak
processing adds new zombies.
6. Now, we can purify zombies made at step 2, but shouldn&#39;t purify zombies made
at step 5.

There are some ways to resolve this issue.  The current code would be the
simplest one.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          rebased. https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h File Source/platform/heap/ThreadState.h (right): https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h#newcode603 Source/platform/heap/ThreadState.h:603: // Do not use this function. This feature ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 08:24:39 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >rebased.

<a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
File Source/platform/heap/ThreadState.h (right):

<a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h#newcode603" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
Source/platform/heap/ThreadState.h:603: // Do not use this function.  This
feature is a temporal workaround for
Clarified &quot;temporal workaround&quot;</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>haraken</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          LGTM! Thanks for taking a lot of your time on this. We discussed offline and ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 08:37:03 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >LGTM! Thanks for taking a lot of your time on this.

We discussed offline and concluded that it&#39;s hard to avoid this (scary) hack in
short term. In long term, we&#39;re planning to create a separate tree of AudioNodes
that can be exclusively touched by the audio thread. Then the
&quot;AudioNode-sharing&quot; problem will be gone and we can remove the hack added in
this CL.

We should seriously fix the problem because the existence of the zombie marking
can block our upcoming optimizations to the GC infrastructure.

<a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
File Source/platform/heap/ThreadState.h (right):

<a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h#newcode707" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
Source/platform/heap/ThreadState.h:707: HashSet&lt;void*&gt; m_zombies;

Another idea (that will reduce the complexity you need to add to the GC
infrastructure) would be to make the mutator keep the zombie objects alive.

- The responsibility of a GC is just to resurrect zombie objects in each marking
phase.
- The responsibility of a mutator is to hook postMarkingTasks and put the zombie
objects into PersistentVector&lt;Member&lt;AudioNode&gt;&gt;. The mutator drops the
AudioNode from the vector when it becomes really unnecessary.
- Then you need to remove m_zombies and the purifyZombie API from the GC
infrastructure.

That being said, this is a temporary hack and thus I don&#39;t much care about it.
If the current code is simpler overall, I&#39;m fine with it.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h File Source/platform/heap/ThreadState.h (right): https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h#newcode707 Source/platform/heap/ThreadState.h:707: HashSet&lt;void*&gt; m_zombies; On 2015/02/17 08:37:03, haraken wrote: &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 23:43:57 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            ><a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
File Source/platform/heap/ThreadState.h (right):

<a href="https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/ThreadState.h#newcode707" rel="nofollow">https://codereview.chromium.org/802593004/diff/100001/Source/platform/heap/Th...</a>
Source/platform/heap/ThreadState.h:707: HashSet&lt;void*&gt; m_zombies;
On 2015/02/17 08:37:03, haraken wrote:
&gt; 
&gt; Another idea (that will reduce the complexity you need to add to the GC
&gt; infrastructure) would be to make the mutator keep the zombie objects alive.
&gt; 
&gt; - The responsibility of a GC is just to resurrect zombie objects in each
marking
&gt; phase.
&gt; - The responsibility of a mutator is to hook postMarkingTasks and put the
zombie
&gt; objects into PersistentVector&lt;Member&lt;AudioNode&gt;&gt;. The mutator drops the
&gt; AudioNode from the vector when it becomes really unnecessary.
&gt; - Then you need to remove m_zombies and the purifyZombie API from the GC
&gt; infrastructure.
&gt; 
&gt; That being said, this is a temporary hack and thus I don&#39;t much care about it.
&gt; If the current code is simpler overall, I&#39;m fine with it.

Your idea would be much complex.

- ThreadState needs to have a list of new zombies anyway until ZombieMarking is
done.
- We can&#39;t update PersistentVector&lt;Member&lt;AudioNode&gt;&gt; in weak processing because
we can&#39;t allocate new collection backing.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          The CQ bit was checked by tkent@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 23:44:01 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >The CQ bit was checked by <a href="mailto:tkent@chromium.org">tkent@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/802593004/100001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 23:44:35 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/802593004/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/802593004/100001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          Committed patchset #5 (id:100001) as https://src.chromium.org/viewvc/blink?view=rev&amp;revision=190366
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-17 23:48:22 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-22"
            >Committed patchset #5 (id:100001) as
<a href="https://src.chromium.org/viewvc/blink?view=rev&amp;revision=190366" rel="nofollow">https://src.chromium.org/viewvc/blink?view=rev&amp;revision=190366</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>tkent</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-23">
                          A revert of this CL (patchset #5 id:100001) has been created in https://codereview.chromium.org/940963005/ by tkent@chromium.org. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 10 months ago
		(2015-02-20 00:47:18 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-23"
            >A revert of this CL (patchset #5 id:100001) has been created in
<a href="https://codereview.chromium.org/940963005/" rel="nofollow">https://codereview.chromium.org/940963005/</a> by <a href="mailto:tkent@chromium.org">tkent@chromium.org</a>.

The reason for reverting is: Caused multiple problems.  crbug.com/459605
crbug.com/459862 crbug.com/460254.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 24;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 802593004;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 802593004: WebAudio: Fix AudioNode leak in a case that AudioNode is not disconnected from the graph explicitly.
     (Closed) </b><br/>
      Created 6 years ago by tkent<br/>
      Modified 5 years, 10 months ago<br/>
      Reviewers: oilpan-reviews, Raymond Toy, haraken<br/>
      Base URL: svn://svn.chromium.org/blink/trunk<br/>
      Comments: 11
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
