<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Defeating Device Guard: A look into CVE-2017-0007 | enigma0x3</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="https://enigma0x3.net/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="https://s2.wp.com/wp-content/themes/pub/trvl/js/html5.js" type="text/javascript"></script>
<![endif]-->

<meta name='robots' content='max-image-preview:large' />

<!-- Async WordPress.com Remote Login -->
<script id="wpcom_remote_login_js">
var wpcom_remote_login_extra_auth = '';
function wpcom_remote_login_remove_dom_node_id( element_id ) {
	var dom_node = document.getElementById( element_id );
	if ( dom_node ) { dom_node.parentNode.removeChild( dom_node ); }
}
function wpcom_remote_login_remove_dom_node_classes( class_name ) {
	var dom_nodes = document.querySelectorAll( '.' + class_name );
	for ( var i = 0; i < dom_nodes.length; i++ ) {
		dom_nodes[ i ].parentNode.removeChild( dom_nodes[ i ] );
	}
}
function wpcom_remote_login_final_cleanup() {
	wpcom_remote_login_remove_dom_node_classes( "wpcom_remote_login_msg" );
	wpcom_remote_login_remove_dom_node_id( "wpcom_remote_login_key" );
	wpcom_remote_login_remove_dom_node_id( "wpcom_remote_login_validate" );
	wpcom_remote_login_remove_dom_node_id( "wpcom_remote_login_js" );
	wpcom_remote_login_remove_dom_node_id( "wpcom_request_access_iframe" );
	wpcom_remote_login_remove_dom_node_id( "wpcom_request_access_styles" );
}

// Watch for messages back from the remote login
window.addEventListener( "message", function( e ) {
	if ( e.origin === "https://r-login.wordpress.com" ) {
		var data = {};
		try {
			data = JSON.parse( e.data );
		} catch( e ) {
			wpcom_remote_login_final_cleanup();
			return;
		}

		if ( data.msg === 'LOGIN' ) {
			// Clean up the login check iframe
			wpcom_remote_login_remove_dom_node_id( "wpcom_remote_login_key" );

			var id_regex = new RegExp( /^[0-9]+$/ );
			var token_regex = new RegExp( /^.*|.*|.*$/ );
			if (
				token_regex.test( data.token )
				&& id_regex.test( data.wpcomid )
			) {
				// We have everything we need to ask for a login
				var script = document.createElement( "script" );
				script.setAttribute( "id", "wpcom_remote_login_validate" );
				script.src = '/remote-login.php?wpcom_remote_login=validate'
					+ '&wpcomid=' + data.wpcomid
					+ '&token=' + encodeURIComponent( data.token )
					+ '&host=' + window.location.protocol
					+ '//' + window.location.hostname
					+ '&postid=580'
					+ '&is_singular=1';
				document.body.appendChild( script );
			}

			return;
		}

		// Safari ITP, not logged in, so redirect
		if ( data.msg === 'LOGIN-REDIRECT' ) {
			window.location = 'https://wordpress.com/log-in?redirect_to=' + window.location.href;
			return;
		}

		// Safari ITP, storage access failed, remove the request
		if ( data.msg === 'LOGIN-REMOVE' ) {
			var css_zap = 'html { -webkit-transition: margin-top 1s; transition: margin-top 1s; } /* 9001 */ html { margin-top: 0 !important; } * html body { margin-top: 0 !important; } @media screen and ( max-width: 782px ) { html { margin-top: 0 !important; } * html body { margin-top: 0 !important; } }';
			var style_zap = document.createElement( 'style' );
			style_zap.type = 'text/css';
			style_zap.appendChild( document.createTextNode( css_zap ) );
			document.body.appendChild( style_zap );

			var e = document.getElementById( 'wpcom_request_access_iframe' );
			e.parentNode.removeChild( e );

			document.cookie = 'wordpress_com_login_access=denied; path=/; max-age=31536000';

			return;
		}

		// Safari ITP
		if ( data.msg === 'REQUEST_ACCESS' ) {
			console.log( 'request access: safari' );

			// Check ITP iframe enable/disable knob
			if ( wpcom_remote_login_extra_auth !== 'safari_itp_iframe' ) {
				return;
			}

			// If we are in a "private window" there is no ITP.
			var private_window = false;
			try {
				var opendb = window.openDatabase( null, null, null, null );
			} catch( e ) {
				private_window = true;
			}

			if ( private_window ) {
				console.log( 'private window' );
				return;
			}

			var iframe = document.createElement( 'iframe' );
			iframe.id = 'wpcom_request_access_iframe';
			iframe.setAttribute( 'scrolling', 'no' );
			iframe.setAttribute( 'sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin allow-top-navigation-by-user-activation' );
			iframe.src = 'https://r-login.wordpress.com/remote-login.php?wpcom_remote_login=request_access&origin=' + encodeURIComponent( data.origin ) + '&wpcomid=' + encodeURIComponent( data.wpcomid );

			var css = 'html { -webkit-transition: margin-top 1s; transition: margin-top 1s; } /* 9001 */ html { margin-top: 46px !important; } * html body { margin-top: 46px !important; } @media screen and ( max-width: 660px ) { html { margin-top: 71px !important; } * html body { margin-top: 71px !important; } #wpcom_request_access_iframe { display: block; height: 71px !important; } } #wpcom_request_access_iframe { border: 0px; height: 46px; position: fixed; top: 0; left: 0; width: 100%; min-width: 100%; z-index: 99999; background: #23282d; } ';

			var style = document.createElement( 'style' );
			style.type = 'text/css';
			style.id = 'wpcom_request_access_styles';
			style.appendChild( document.createTextNode( css ) );
			document.body.appendChild( style );

			document.body.appendChild( iframe );
		}

		if ( data.msg === 'DONE' ) {
			wpcom_remote_login_final_cleanup();
		}
	}
}, false );

// Inject the remote login iframe after the page has had a chance to load
// more critical resources
window.addEventListener( "DOMContentLoaded", function( e ) {
	var iframe = document.createElement( "iframe" );
	iframe.style.display = "none";
	iframe.setAttribute( "scrolling", "no" );
	iframe.setAttribute( "id", "wpcom_remote_login_key" );
	iframe.src = "https://r-login.wordpress.com/remote-login.php"
		+ "?wpcom_remote_login=key"
		+ "&origin=aHR0cHM6Ly9lbmlnbWEweDMubmV0"
		+ "&wpcomid=62662083"
		+ "&time=1635636805";
	document.body.appendChild( iframe );
}, false );
</script>
<link rel='dns-prefetch' href='//s2.wp.com' />
<link rel='dns-prefetch' href='//enigma0x3.wordpress.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="enigma0x3 &raquo; Feed" href="https://enigma0x3.net/feed/" />
<link rel="alternate" type="application/rss+xml" title="enigma0x3 &raquo; Comments Feed" href="https://enigma0x3.net/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="enigma0x3 &raquo; Defeating Device Guard: A look into&nbsp;CVE-2017-0007 Comments Feed" href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/feed/" />
	<script type="text/javascript">
		/* <![CDATA[ */
		function addLoadEvent(func) {
			var oldonload = window.onload;
			if (typeof window.onload != 'function') {
				window.onload = func;
			} else {
				window.onload = function () {
					oldonload();
					func();
				}
			}
		}
		/* ]]> */
	</script>
			<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/72x72\/","ext":".png","svgUrl":"https:\/\/s0.wp.com\/wp-content\/mu-plugins\/wpcom-smileys\/twemoji\/2\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/s1.wp.com\/wp-includes\/js\/wp-emoji-release.min.js?m=1625065786h&ver=5.8.1"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='all-css-0-1' href='https://s1.wp.com/_static/??-eJyNkt1OAyEQhV9IFjdurDfGZ+FngrQzQBhow9tLaWrWra3ekBxmvsNhQJ6SMDEUCEVSFQmr84HlKZlIgskjtI2aDPOT/B3LgKqAFSly2ahHGPoDsNxDScocxFA37ddeV7vUkF2vZJDHeZ520yx19WilxjgMdFa5SS4N4dvIB4PVns9hSWC9AgQaQVYioWqQBYJTpk3kw994r631D+h++JF0dWfVYi3CZW83sf9tkVXxwfEdfDXt89z6PiV1G/4BdvkEWqcMzKKv5CuJ8tnB8Vof9D6/vizzsnte3vZfNIviNA==?cssminify=yes' type='text/css' media='all' />
<style id='wp-block-library-inline-css'>
.has-text-align-justify {
	text-align:justify;
}
</style>
<style id='global-styles-inline-css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--normal: 16px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--huge: 42px;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-normal-font-size{font-size: var(--wp--preset--font-size--normal) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-huge-font-size{font-size: var(--wp--preset--font-size--huge) !important;}
</style>
<link rel='stylesheet' id='all-css-2-1' href='https://s1.wp.com/_static/??-eJx9i9EKwjAMRX/IGorI2IP4LV3JskralCZV/HvrmzLY2z2Xc+BVXZRiWAxsw4wKtS9g7cmwjl+BMVBHR2JbiueoeoKDRu3NuLNyd5U7paJAKI4lBktS/sCtHFI7ShsuLDQmwbB+8Bvd881f/cX7yU/z4wNKrE+r?cssminify=yes' type='text/css' media='all' />
<link rel='stylesheet' id='print-css-3-1' href='https://s2.wp.com/wp-content/mu-plugins/global-print/global-print.css?m=1465851035h&cssminify=yes' type='text/css' media='print' />
<style id='jetpack-global-styles-frontend-style-inline-css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='all-css-6-1' href='https://s1.wp.com/_static/??-eJxti8sKgCAQAH8o297RIfoWE1NjdaVV+v3o0CHqNAzMwBmFopB0SOCziJiNCwyROIkNpTuArTxcMA9LxVzA/8WknESBZOgtnylZ7TWD7cAgrRLvYPFzPbT12PRTX+0XZRA3zg==?cssminify=yes' type='text/css' media='all' />
<script id='jetpack_related-posts-js-extra'>
var related_posts_js_options = {"post_heading":"h4"};
</script>
<script id='wpcom-actionbar-placeholder-js-extra'>
var actionbardata = {"siteID":"62662083","siteName":"enigma0x3","siteURL":"https:\/\/enigma0x3.net","siteHost":"enigma0x3.net","icon":"<img alt='' src='https:\/\/s2.wp.com\/i\/logo\/wpcom-gray-white.png' class='avatar avatar-50' height='50' width='50' \/>","canManageOptions":"","canCustomizeSite":"","isFollowing":"","themeSlug":"pub\/trvl","signupURL":"https:\/\/wordpress.com\/start\/","loginURL":"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fenigma0x3.net%252F2017%252F04%252F03%252Fdefeating-device-guard-a-look-into-cve-2017-0007%252F","themeURL":"","xhrURL":"https:\/\/enigma0x3.net\/wp-admin\/admin-ajax.php","nonce":"8ec0ac2dfd","isSingular":"1","isFolded":"","isLoggedIn":"","isMobile":"","subscribeNonce":"<input type=\"hidden\" id=\"_wpnonce\" name=\"_wpnonce\" value=\"d9508f021a\" \/>","referer":"https:\/\/enigma0x3.net\/2017\/04\/03\/defeating-device-guard-a-look-into-cve-2017-0007\/","canFollow":"1","feedID":"45323403","statusMessage":"","subsEmailDefault":"instantly","customizeLink":"https:\/\/enigma0x3.wordpress.com\/wp-admin\/customize.php?url=https%3A%2F%2Fenigma0x3.wordpress.com%2F2017%2F04%2F03%2Fdefeating-device-guard-a-look-into-cve-2017-0007%2F","postID":"580","shortlink":"https:\/\/wp.me\/p4eVgL-9m","canEditPost":"","editLink":"https:\/\/wordpress.com\/post\/enigma0x3.net\/580","statsLink":"https:\/\/wordpress.com\/stats\/post\/580\/enigma0x3.net","i18n":{"view":"View site","follow":"Follow","following":"Following","edit":"Edit","login":"Log in","signup":"Sign up","customize":"Customize","report":"Report this content","themeInfo":"Get theme: Trvl","shortlink":"Copy shortlink","copied":"Copied","followedText":"New posts from this site will now appear in your <a href=\"https:\/\/wordpress.com\/read\">Reader<\/a>","foldBar":"Collapse this bar","unfoldBar":"Expand this bar","editSubs":"Manage subscriptions","viewReader":"View site in Reader","viewReadPost":"View post in Reader","subscribe":"Sign me up","enterEmail":"Enter your email address","followers":"Join 178 other followers","alreadyUser":"Already have a WordPress.com account? <a href=\"https:\/\/wordpress.com\/log-in?redirect_to=https%3A%2F%2Fr-login.wordpress.com%2Fremote-login.php%3Faction%3Dlink%26back%3Dhttps%253A%252F%252Fenigma0x3.net%252F2017%252F04%252F03%252Fdefeating-device-guard-a-look-into-cve-2017-0007%252F\">Log in now.<\/a>","stats":"Stats","notifyNewPosts":"Notify me of new posts","notifyNewPostsDetails":"Receive web and mobile notifications for new posts from this site.","emailNewPosts":"Email me new posts","emailNewPostsDetails":"You can customize your notification settings further <a href=\"https:\/\/wordpress.com\/following\/manage?s=enigma0x3.net\">here<\/a>.","emailNewComments":"Email me new comments","instantly":"Instantly","daily":"Daily","weekly":"Weekly"}};
</script>
<script crossorigin='anonymous' type='text/javascript' src='https://s0.wp.com/_static/??-eJyFjlEKwjAMQC9kVotMv8SzzC2OljatScrc7e1QYQ7BrxDeyyNmytAnUiQ1XkxOohFFuhEbLzvzTWO6uoBQBLkKpODolrZeLJBDGR2JYQyd4gBLdbN9rhz1oQwoS97fC/L8Hk109FeC6Eau0bW8+peDQub0mH+wKfcpvigw1ppotS7xbI8He9q31rb+CSjcafo='></script>
<script type='text/javascript'>
	window.addEventListener( 'DOMContentLoaded', function() {
		rltInitialize( {"token":null,"iframeOrigins":["https:\/\/widgets.wp.com"]} );
	} );
</script>
<link rel='stylesheet' id='all-css-0-2' href='https://s1.wp.com/wp-content/mu-plugins/highlander-comments/style.css?m=1633595895h&cssminify=yes' type='text/css' media='all' />
<!--[if lt IE 8]>
<link rel='stylesheet' id='highlander-comments-ie7-css'  href='https://s2.wp.com/wp-content/mu-plugins/highlander-comments/style-ie7.css?m=1351637563h&#038;ver=20110606' media='all' />
<![endif]-->
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://enigma0x3.wordpress.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://s1.wp.com/wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress.com" />
<link rel="canonical" href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/" />
<link rel='shortlink' href='https://wp.me/p4eVgL-9m' />
<link rel="alternate" type="application/json+oembed" href="https://public-api.wordpress.com/oembed/?format=json&amp;url=https%3A%2F%2Fenigma0x3.net%2F2017%2F04%2F03%2Fdefeating-device-guard-a-look-into-cve-2017-0007%2F&amp;for=wpcom-auto-discovery" /><link rel="alternate" type="application/xml+oembed" href="https://public-api.wordpress.com/oembed/?format=xml&amp;url=https%3A%2F%2Fenigma0x3.net%2F2017%2F04%2F03%2Fdefeating-device-guard-a-look-into-cve-2017-0007%2F&amp;for=wpcom-auto-discovery" />
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Defeating Device Guard: A look into CVE-2017-0007" />
<meta property="og:url" content="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/" />
<meta property="og:description" content="Over the past few months, I have had the pleasure to work side-by-side with Matt Graeber (@mattifestation) and Casey Smith (@subtee) in their previous job roles, researching Device Guard user mode …" />
<meta property="article:published_time" content="2017-04-03T13:26:45+00:00" />
<meta property="article:modified_time" content="2017-05-04T16:14:35+00:00" />
<meta property="og:site_name" content="enigma0x3" />
<meta property="og:image" content="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png" />
<meta property="og:image:width" content="2606" />
<meta property="og:image:height" content="420" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:site" content="@wordpressdotcom" />
<meta name="twitter:text:title" content="Defeating Device Guard: A look into&nbsp;CVE-2017-0007" />
<meta name="twitter:image" content="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="article:publisher" content="https://www.facebook.com/WordPresscom" />

<!-- End Jetpack Open Graph Tags -->
<link rel="shortcut icon" type="image/x-icon" href="https://s1.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="icon" type="image/x-icon" href="https://s1.wp.com/i/favicon.ico" sizes="16x16 24x24 32x32 48x48" />
<link rel="apple-touch-icon" href="https://s2.wp.com/i/webclip.png" />
<link rel='openid.server' href='https://enigma0x3.net/?openidserver=1' />
<link rel='openid.delegate' href='https://enigma0x3.net/' />
<link rel="search" type="application/opensearchdescription+xml" href="https://enigma0x3.net/osd.xml" title="enigma0x3" />
<link rel="search" type="application/opensearchdescription+xml" href="https://s1.wp.com/opensearch.xml" title="WordPress.com" />
<meta name="theme-color" content="#282828" />
<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>		<style type="text/css">
			.recentcomments a {
				display: inline !important;
				padding: 0 !important;
				margin: 0 !important;
			}

			table.recentcommentsavatartop img.avatar, table.recentcommentsavatarend img.avatar {
				border: 0px;
				margin: 0;
			}

			table.recentcommentsavatartop a, table.recentcommentsavatarend a {
				border: 0px !important;
				background-color: transparent !important;
			}

			td.recentcommentsavatarend, td.recentcommentsavatartop {
				padding: 0px 0px 1px 0px;
				margin: 0px;
			}

			td.recentcommentstextend {
				border: none !important;
				padding: 0px 0px 2px 10px;
			}

			.rtl td.recentcommentstextend {
				padding: 0px 10px 2px 0px;
			}

			td.recentcommentstexttop {
				border: none;
				padding: 0px 0px 0px 10px;
			}

			.rtl td.recentcommentstexttop {
				padding: 0px 10px 0px 0px;
			}
		</style>
		<meta name="application-name" content="enigma0x3" /><meta name="msapplication-window" content="width=device-width;height=device-height" /><meta name="msapplication-tooltip" content="Red Teamer and Security Addict" /><meta name="msapplication-task" content="name=Subscribe;action-uri=https://enigma0x3.net/feed/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=Sign up for a free blog;action-uri=http://wordpress.com/signup/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Support;action-uri=http://support.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="msapplication-task" content="name=WordPress.com Forums;action-uri=http://forums.wordpress.com/;icon-uri=https://s1.wp.com/i/favicon.ico" /><meta name="description" content="Over the past few months, I have had the pleasure to work side-by-side with Matt Graeber (@mattifestation) and Casey Smith (@subtee) in their previous job roles, researching Device Guard user mode code integrity (UMCI) bypasses. If you aren’t familiar with Device Guard, you can read more about it here: https://technet.microsoft.com/en-us/itpro/windows/keep-secure/device-guard-deployment-guide.  In short, Device Guard UMCI&hellip;" />
	<style type="text/css">
			.site-title a {
			color: #b5b5b5;
		}
		</style>
	<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #282828; }
</style>
	<link rel="amphtml" href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/amp/"><style type="text/css" id="custom-colors-css">body { background-color: #333333;}
pre { color: #333333;}
input[type="text"],input[type="email"],input[type="password"],input[type="search"],input[type="url"],textarea { color: #333333;}
#infinite-handle span { color: #333333;}
.entry-title { border-color: #191919;}
</style>
</head>

<body class="post-template-default single single-post postid-580 single-format-standard custom-background customizer-styles-applied highlander-enabled highlander-dark">
<div id="page" class="hfeed site">
		<header id="masthead" class="site-header" role="banner">
		<div class="site-description">Red Teamer and Security Addict</div>
		<h1 class="site-title"><a href="https://enigma0x3.net/" title="enigma0x3" rel="home">enigma0x3</a></h1>

			</header><!-- #masthead -->

	<div id="main" class="site-main">

<div id="primary" class="content-area">
	<div id="content" class="site-content" role="main">

		<nav role="navigation" id="nav-above" class="navigation-post">
		<h1 class="screen-reader-text">Post navigation</h1>

	
		<div class="nav-previous"><a href="https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/" rel="prev"><span class="meta-nav">&laquo;</span> &#8220;Fileless&#8221; UAC Bypass using&nbsp;sdclt.exe</a></div>		<div class="nav-next"><a href="https://enigma0x3.net/2017/07/13/phishing-against-protected-view/" rel="next">Phishing Against Protected&nbsp;View <span class="meta-nav">&raquo;</span></a></div>
	
	</nav><!-- #nav-above -->
	
	
		
<article id="post-580" class="post-580 post type-post status-publish format-standard hentry category-uncategorized">
	<header class="entry-header">
		<h1 class="entry-title">Defeating Device Guard: A look into&nbsp;CVE-2017-0007</h1>
		<div class="entry-meta">
			<a href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/" title="1:26 pm" rel="bookmark"><time class="entry-date" datetime="2017-04-03T13:26:45+00:00">April 3, 2017</time></a><span class="byline"> by <span class="author vcard"><a class="url fn n" href="https://enigma0x3.net/author/enigma0x3/" title="View all posts by enigma0x3" rel="author">enigma0x3</a></span></span>					</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p><span style="font-weight:400;">Over the past few months, I have had the pleasure to work side-by-side with Matt Graeber (</span><a href="https://twitter.com/mattifestation"><span style="font-weight:400;">@mattifestation</span></a><span style="font-weight:400;">) and Casey Smith (</span><a href="https://twitter.com/subtee"><span style="font-weight:400;">@subtee</span></a><span style="font-weight:400;">) in their previous job roles, researching Device Guard user mode code integrity (UMCI) bypasses. If you aren’t familiar with Device Guard, you can read more about it here: </span><a href="https://technet.microsoft.com/en-us/itpro/windows/keep-secure/device-guard-deployment-guide"><span style="font-weight:400;">https://technet.microsoft.com/en-us/itpro/windows/keep-secure/device-guard-deployment-guide</span></a><span style="font-weight:400;">.  In short, Device Guard UMCI prevents unapproved binaries from executing, restricts the Windows Scripting Host, and it places PowerShell in </span><a href="https://technet.microsoft.com/en-us/library/dn433292.aspx"><span style="font-weight:400;">Constrained Language mode</span></a><span style="font-weight:400;">, unless the scripts themselves are signed by a trusted signer. After spending some time evaluating how scripts are handled on Device Guard enabled systems, I ended up identifying a way to get any unapproved script to execute on a Device Guard enabled system. Upon reporting the issue to MSRC, this bug was eventually assigned <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0007">CVE-2017-0007</a> (under </span><a href="https://technet.microsoft.com/en-us/library/security/ms17-012.aspx"><span style="font-weight:400;">MS17-012</span></a><span style="font-weight:400;">) and patched. This particular bug only impacts PowerShell and the Windows Scripting Host, and not compiled code.</span></p>
<p><b>This bug is my first CVE and my first time reversing a patch. This post is a write-up of not only the bug, but the patch reverse-engineering process that I took as well. Since this is my first time doing this, there are bound to be errors. If I stated something incorrectly, please let me know so I can learn 🙂</b></p>
<p><span style="font-weight:400;">When executing a signed script, wintrust.dll handles validating the signature of that file. This was determined after looking at the exports. Ideally, if you take a Microsoft signed script and modify it, the integrity of the file has been compromised, and the signature should no longer be valid. Such validation is critical and fundamental to Device Guard, where its sole purpose is to prevent unsigned or untrusted code from running. CVE-2017-0007 circumvents this protection, allowing you to run any unsigned code you want by simply modifying a script that was previously signed by an approved signer. In this case, a Microsoft signed script was chosen since code signed by Microsoft needs to be able to run on Device Guard. For example, if we try to run an unsigned PowerShell script that executes restricted actions (e.g. instantiation of most COM objects), it will fail due to PowerShell being in </span><a href="https://blogs.technet.microsoft.com/kfalde/2017/01/20/pslockdownpolicy-and-powershell-constrained-language-mode/"><span style="font-weight:400;">Constrained Language mode</span></a><span style="font-weight:400;">. Any signed and trusted PowerShell code that is approved via the deployed Code Integrity Policy is permitted to run in “FullLanguage” mode, allowing it to execute with no restrictions. In this case, our code is not signed nor trusted, so it is placed in Constrained Language mode and fails to execute correctly.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png"><img loading="lazy" data-attachment-id="581" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/unsigned_calc_com/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png" data-orig-size="1644,1142" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="unsigned_calc_com" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=690" class="alignnone size-full wp-image-581" src="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=690&#038;h=479" alt="" width="690" height="479" srcset="https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=690&amp;h=479 690w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=1380&amp;h=958 1380w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=150&amp;h=104 150w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=300&amp;h=208 300w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=768&amp;h=533 768w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_calc_com.png?w=1024&amp;h=711 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">Fortunately, Microsoft has scripts that are signed with their code signing certificate. You can validate that a script is indeed signed by Microsoft using sigcheck or the PowerShell cmdlet “</span><a href="https://msdn.microsoft.com/en-us/powershell/reference/5.1/microsoft.powershell.security/get-authenticodesignature"><span style="font-weight:400;">Get-AuthenticodeSignature</span></a><span style="font-weight:400;">”. In this case, I grabbed a signed PowerShell script from the Windows SDK and renamed it to “MicrosoftSigned.ps1”:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png"><img loading="lazy" data-attachment-id="582" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/valid_signed_script/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png" data-orig-size="918,548" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="valid_signed_script" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=690" class="alignnone size-full wp-image-582" src="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=690&#038;h=412" alt="" width="690" height="412" srcset="https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=690&amp;h=412 690w, https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=150&amp;h=90 150w, https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=300&amp;h=179 300w, https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png?w=768&amp;h=458 768w, https://enigma0x3.files.wordpress.com/2017/04/valid_signed_script.png 918w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">When scripts like these are signed, they often contain an embedded authenticode signature within the body of the script. If you were to modify any contents of that file, the integrity of said file would be broken and the signature would no longer be valid. You can also simply copy the authenticode signature block from a signed file and paste it into the body of an unsigned script:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png"><img loading="lazy" data-attachment-id="583" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/broken_signature/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png" data-orig-size="1254,936" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="broken_signature" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=690" class="alignnone size-full wp-image-583" src="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=690&#038;h=515" alt="" width="690" height="515" srcset="https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=690&amp;h=515 690w, https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=150&amp;h=112 150w, https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=300&amp;h=224 300w, https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=768&amp;h=573 768w, https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png?w=1024&amp;h=764 1024w, https://enigma0x3.files.wordpress.com/2017/04/broken_signature.png 1254w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">As you can see, the original contents of the script were replaced with our own code, and sigcheck reports that “The digital signature of the object did not verify”, meaning the integrity of the file has been compromised and the code will be blocked from running, right?</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png"><img loading="lazy" data-attachment-id="584" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/unsigned_execution/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png" data-orig-size="1722,1000" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="unsigned_execution" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=690" class="alignnone size-full wp-image-584" src="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=690&#038;h=401" alt="" width="690" height="401" srcset="https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=690&amp;h=401 690w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=1380&amp;h=802 1380w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=150&amp;h=87 150w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=300&amp;h=174 300w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=768&amp;h=446 768w, https://enigma0x3.files.wordpress.com/2017/04/unsigned_execution.png?w=1024&amp;h=595 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">As you can see, our code executed anyway, despite the invalidated digital signature. Microsoft assigned this bug <a href="http://www.cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-0007">CVE-2017-0007</a>, classified under <a href="https://technet.microsoft.com/en-us/library/security/ms17-012.aspx">MS17-012</a>. The underlying issue here is that the error code returned by the function that ensures the file&#8217;s integrity never gets validated, resulting in successful execution of the unsigned code. </span></p>
<p><span style="font-weight:400;">So, what is the reason for the bug, and how was it fixed? Device Guard relies on wintrust.dll to handle some of the signature and integrity checks on signed files. Due to the nature of the bug, this was the first place I looked. </span><a href="https://www.zynamics.com/bindiff.html"><span style="font-weight:400;">Bindiffing</span></a><span style="font-weight:400;"> wintrust.dll pre-patch (10.0.14393.0) and post-patch (10.0.14393.953) reveals a new chunk of code was added. While there was one other change to wintrust.dll, this was the only change that pertained to validating signed scripts. Due to this, is very likely to be the patch for the bug:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png"><img loading="lazy" data-attachment-id="585" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/bindiff/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png" data-orig-size="1996,1508" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="bindiff" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=690" class="alignnone size-full wp-image-585" src="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=690&#038;h=521" alt="" width="690" height="521" srcset="https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=690&amp;h=521 690w, https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=1380&amp;h=1042 1380w, https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=150&amp;h=113 150w, https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=300&amp;h=227 300w, https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=768&amp;h=580 768w, https://enigma0x3.files.wordpress.com/2017/04/bindiff.png?w=1024&amp;h=774 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">Looking closer, you will see that some code from “sub_18002D0F8” was removed:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/removed.png"><img loading="lazy" data-attachment-id="586" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/removed/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/removed.png" data-orig-size="1666,1174" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="removed" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=690" class="alignnone size-full wp-image-586" src="https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=690&#038;h=486" alt="" width="690" height="486" srcset="https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=690&amp;h=486 690w, https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=1380&amp;h=972 1380w, https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=150&amp;h=106 150w, https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=300&amp;h=211 300w, https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=768&amp;h=541 768w, https://enigma0x3.files.wordpress.com/2017/04/removed.png?w=1024&amp;h=722 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">Looking at the newly added block named “sub_18002D104”, you will see that it contains some code from “sub_18002D0F8” as well as some additions. These particular functions don’t have symbols, so we must refer to them as the defined names. Alternatively, you can also rename these functions in IDA to something more meaningful.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png"><img loading="lazy" data-attachment-id="587" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/deep_view_of_added_code/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png" data-orig-size="1754,1374" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="deep_view_of_added_code" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=690" class="alignnone size-full wp-image-587" src="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=690&#038;h=541" alt="" width="690" height="541" srcset="https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=690&amp;h=541 690w, https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=1380&amp;h=1082 1380w, https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=150&amp;h=118 150w, https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=300&amp;h=235 300w, https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=768&amp;h=602 768w, https://enigma0x3.files.wordpress.com/2017/04/deep_view_of_added_code.png?w=1024&amp;h=802 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">The text above is a bit small, but I will go into depth on what exactly was done. I won’t go into specifics on using bindiff, but if you want to learn more I recommend you check out the </span><a href="https://www.zynamics.com/bindiff/manual/"><span style="font-weight:400;">manual</span></a><span style="font-weight:400;">. Armed with the general location of the bug fix, I set out to identify exactly what was happening when our unsigned code was executed. Knowing that some code was removed from “sub_18002D0F8” and added to a new block named “sub_18002D104” made these two places a good starting point. First, I opened up the pre-patch version of wintrust.dll (10.0.14393.0) in IDA, and navigated to the sub that was modified in the patch (sub_18002D0F8). This function starts off by setting a few variables and then calls “SoftpubAuthenticode”</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png"><img loading="lazy" data-attachment-id="588" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/original_softpubcall/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png" data-orig-size="1864,1124" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="original_softpubcall" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=690" class="alignnone size-full wp-image-588" src="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=690&#038;h=416" alt="" width="690" height="416" srcset="https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=690&amp;h=416 690w, https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=1380&amp;h=832 1380w, https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=150&amp;h=90 150w, https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=300&amp;h=181 300w, https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=768&amp;h=463 768w, https://enigma0x3.files.wordpress.com/2017/04/original_softpubcall.png?w=1024&amp;h=617 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">Looking at “SoftpubAuthenticode” reveals that it calls another function named “CheckValidSignature”:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png"><img loading="lazy" data-attachment-id="589" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/error_code_struc_applied/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png" data-orig-size="1740,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error_code_struc_applied" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=690" class="alignnone size-full wp-image-589" src="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=690&#038;h=183" alt="" width="690" height="183" srcset="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=690&amp;h=183 690w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=1380&amp;h=366 1380w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=150&amp;h=40 150w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=300&amp;h=80 300w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=768&amp;h=204 768w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied.png?w=1024&amp;h=272 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">It makes sense that “CheckValidSignature” would handle validating the signature/integrity of the file being executed. Looking at this function, we can get the location of the last instruction before it returns.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png"><img loading="lazy" data-attachment-id="590" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/end_of_checkvalidsig/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png" data-orig-size="2034,418" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="end_of_checkvalidsig" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=690" class="alignnone size-full wp-image-590" src="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=690&#038;h=142" alt="" width="690" height="142" srcset="https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=690&amp;h=142 690w, https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=1380&amp;h=284 1380w, https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=150&amp;h=31 150w, https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=300&amp;h=62 300w, https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=768&amp;h=158 768w, https://enigma0x3.files.wordpress.com/2017/04/end_of_checkvalidsig.png?w=1024&amp;h=210 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">We can see the error code from “CheckValidSignature” in the eax register by setting a windbg breakpoint at the last instruction in the function, which is highlighted in yellow above. </span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png"><img loading="lazy" data-attachment-id="591" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/return_code_in_eax/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png" data-orig-size="2068,312" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="return_code_in_eax" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=690" class="alignnone size-full wp-image-591" src="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=690&#038;h=104" alt="" width="690" height="104" srcset="https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=690&amp;h=104 690w, https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=1380&amp;h=208 1380w, https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=150&amp;h=23 150w, https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=300&amp;h=45 300w, https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=768&amp;h=116 768w, https://enigma0x3.files.wordpress.com/2017/04/return_code_in_eax.png?w=1024&amp;h=154 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">In this case, the error code is “0x80096010”, which translates to “</span><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa376512(v=vs.85).aspx"><span style="font-weight:400;">TRUST_E_BAD_DIGEST</span></a><span style="font-weight:400;">”, according to wintrust.h in the Windows SDK.</span> <span style="font-weight:400;">This is why we see “The digital signature of the object did not verify.” when running sigcheck on a modified signed file.</span> <span style="font-weight:400;">After “CheckValidSignature” returns (via retn), we arrive back at “SoftpubAuthenticode”.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png"><img loading="lazy" data-attachment-id="592" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/error_code_struc_applied-2/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png" data-orig-size="1740,462" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="error_code_struc_applied" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=690" class="alignnone size-full wp-image-592" src="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=690&#038;h=183" alt="" width="690" height="183" srcset="https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=690&amp;h=183 690w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=1380&amp;h=366 1380w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=150&amp;h=40 150w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=300&amp;h=80 300w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=768&amp;h=204 768w, https://enigma0x3.files.wordpress.com/2017/04/error_code_struc_applied1.png?w=1024&amp;h=272 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">“SoftPubAuthenticode” then goes on to call “SoftpubCallUI” and then returns back to “sub_18002D0F8”, all while keeping our error code “0x80096010” in the eax register. Now that we know what the error code is and where it is stored, we can take a close look at why our script was actually allowed to run, despite “CheckValidSignature” returning “TRUST_E_BAD_DIGEST”. At this point, we are resuming execution in sub_18002D0F8, immediately after the call to “SoftpubAuthenticode”.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png"><img loading="lazy" data-attachment-id="593" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/correct_bug/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png" data-orig-size="1244,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="correct_bug" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=690" class="alignnone size-full wp-image-593" src="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=690&#038;h=128" alt="" width="690" height="128" srcset="https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=690&amp;h=128 690w, https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=150&amp;h=28 150w, https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=300&amp;h=55 300w, https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=768&amp;h=142 768w, https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png?w=1024&amp;h=189 1024w, https://enigma0x3.files.wordpress.com/2017/04/correct_bug.png 1244w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">Since our error code is stored in eax, it gets overwritten immediately after returning from SoftpubAuthenticode via “move rax, [r12]”.</span></p>
<p>Since the error code stating that our script’s digital signature isn’t valid doesn’t exist anymore, it never gets validated and the script is allowed to execute:</p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png"><img loading="lazy" data-attachment-id="594" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/continued_execution/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png" data-orig-size="2100,950" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="continued_execution" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=690" class="alignnone size-full wp-image-594" src="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=690&#038;h=312" alt="" width="690" height="312" srcset="https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=690&amp;h=312 690w, https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=1380&amp;h=624 1380w, https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=150&amp;h=68 150w, https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=300&amp;h=136 300w, https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=768&amp;h=347 768w, https://enigma0x3.files.wordpress.com/2017/04/continued_execution.png?w=1024&amp;h=463 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">With an understanding of exactly what the bug is, we can go look at how Microsoft patched it. In order to do so, we need to install KB4013429. Looking at the new version of wintrust.dll (10.0.14393.953), we can explore “sub_18002D104”, which is the added block of code that was identified towards the beginning of the blog post. We know that the bug stemmed from the register holding our error code was being overwritten and not validated. We can see that the patch added a new call to “sub_18002D4BC” following the return from “SoftPubAuthenticode”.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/added_check.png"><img loading="lazy" data-attachment-id="595" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/added_check/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/added_check.png" data-orig-size="2470,560" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="added_check" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=690" class="alignnone size-full wp-image-595" src="https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=690&#038;h=156" alt="" width="690" height="156" srcset="https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=690&amp;h=156 690w, https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=1376&amp;h=312 1376w, https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=150&amp;h=34 150w, https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=300&amp;h=68 300w, https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=768&amp;h=174 768w, https://enigma0x3.files.wordpress.com/2017/04/added_check.png?w=1024&amp;h=232 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">You may also notice in the picture above that our error code gets placed in the ecx register, and the instructions to overwrite the rcx register is now dependent on a test instruction, followed by a “jump if zero” instruction. This means that our error code, now stored in “ecx” will only get overwritten if the jump isn’t followed. Looking at the newly introduced sub “sub_18002D4BC”, you will see this:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png"><img loading="lazy" data-attachment-id="596" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/new_function_check/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png" data-orig-size="914,890" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="new_function_check" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=690" class="alignnone size-full wp-image-596" src="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=690&#038;h=672" alt="" width="690" height="672" srcset="https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=690&amp;h=672 690w, https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=150&amp;h=146 150w, https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=300&amp;h=292 300w, https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png?w=768&amp;h=748 768w, https://enigma0x3.files.wordpress.com/2017/04/new_function_check.png 914w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">This function returns a BOOL (0 or 1), depending on the result of operations performed on our error code. This addition checks to see if the call to &#8220;SoftpubAuthenticode&#8221; succeeded (&lt; 0x7FFFFFFF) or if the return code matches &#8220;0x800B0109&#8221;, which translates to &#8220;CERT_E_UNTRUSTEDROOT&#8221;. In this case, SoftpubAuthenticode returned 0x80096010 (TRUST_E_BAD_DIGEST) which does not match either of the described conditions, resulting in the function returning 1 (TRUE).</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png"><img loading="lazy" data-attachment-id="597" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/al_getting_set/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png" data-orig-size="894,852" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="al_getting_set" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=690" class="alignnone size-full wp-image-597" src="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=690&#038;h=658" alt="" width="690" height="658" srcset="https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=690&amp;h=658 690w, https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=150&amp;h=143 150w, https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=300&amp;h=286 300w, https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png?w=768&amp;h=732 768w, https://enigma0x3.files.wordpress.com/2017/04/al_getting_set.png 894w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">After setting “al” to “1” and returning back to the previous function, we can see how this bug was actually patched:</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png"><img loading="lazy" data-attachment-id="598" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/after_al_set_continue/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png" data-orig-size="2446,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="after_al_set_continue" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=690" class="alignnone size-full wp-image-598" src="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=690&#038;h=167" alt="" width="690" height="167" srcset="https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=690&amp;h=167 690w, https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=1380&amp;h=334 1380w, https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=150&amp;h=36 150w, https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=300&amp;h=73 300w, https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=768&amp;h=186 768w, https://enigma0x3.files.wordpress.com/2017/04/after_al_set_continue.png?w=1024&amp;h=248 1024w" sizes="(max-width: 690px) 100vw, 690px" /></a></p>
<p><span style="font-weight:400;">With “al” set to “1”, the function does another logical compare to see if “al” is zero or not. Since it isn’t, it sets the “r14b” register to “0” (since the ZF flag isn’t set from the previous “test” instruction). It then does a last logical compare to check if “r14b” is zero. Since it is, it follows the jump and skips over the portion of code that overwrites the “rcx” register (leaving ecx populated with our error code). The error code eventually gets validated and the script is placed in Constrained Language mode, causing failed execution.</span></p>
<p><a href="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png"><img loading="lazy" data-attachment-id="599" data-permalink="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/blocked_execution/#main" data-orig-file="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png" data-orig-size="2606,420" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="blocked_execution" data-image-description="" data-image-caption="" data-medium-file="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=300" data-large-file="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=690" class="alignnone wp-image-599" src="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=802&#038;h=129" alt="" width="802" height="129" srcset="https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=802&amp;h=129 802w, https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=1601&amp;h=258 1601w, https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=150&amp;h=24 150w, https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=300&amp;h=48 300w, https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=768&amp;h=124 768w, https://enigma0x3.files.wordpress.com/2017/04/blocked_execution.png?w=1024&amp;h=165 1024w" sizes="(max-width: 802px) 100vw, 802px" /></a></p>
<p>Cheers,<br />
Matt</p>
<div id="jp-post-flair" class="sharedaddy sharedaddy-dark sd-like-enabled sd-sharing-enabled"><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-580" class="share-twitter sd-button share-icon" href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-580" class="share-facebook sd-button share-icon" href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-62662083-580-617dd645926d6' data-src='//widgets.wp.com/likes/index.html?ver=20210831#blog_id=62662083&amp;post_id=580&amp;origin=enigma0x3.wordpress.com&amp;obj_id=62662083-580-617dd645926d6&amp;domain=enigma0x3.net' data-name='like-post-frame-62662083-580-617dd645926d6' data-title='Like or Reblog'><h3 class='sd-title'>Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div></div>			</div><!-- .entry-content -->

	
	<footer class="entry-meta">
		Bookmark the <a href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/" title="Permalink to Defeating Device Guard: A look into&nbsp;CVE-2017-0007" rel="bookmark">permalink</a>.	</footer><!-- .entry-meta -->
</article><!-- #post-## -->

		
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			One thought on &ldquo;<span>Defeating Device Guard: A look into&nbsp;CVE-2017-0007</span>&rdquo;		</h2>

		<ol class="comment-list">
					<li id="comment-1502" class="comment even thread-even depth-1 highlander-comment">
			<article id="div-comment-1502" class="comment-body">
				<footer class="comment-meta">
					<div class="comment-author vcard">
						<img alt='' src='https://0.gravatar.com/avatar/f032b1869da8022340d18db76da8bfcb?s=32&#038;d=identicon&#038;r=G' class='avatar avatar-32' height='32' width='32' />						<b class="fn">Soc</b> <span class="says">says:</span>					</div><!-- .comment-author -->

					<div class="comment-metadata">
						<a href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/#comment-1502"><time datetime="2017-06-11T17:16:30+00:00">June 11, 2017 at 5:16 pm</time></a>					</div><!-- .comment-metadata -->

									</footer><!-- .comment-meta -->

				<div class="comment-content">
					<p>Your demonstration shows a constrained powershell script allowing calc.exe which is Microsoft signed to run.</p>
<p>Would this work on non-trusted executable code per the given CI policy?</p>
<p>Also the CI policy varies widely on deployments, what kind of policy was being enforced?</p>
				</div><!-- .comment-content -->

				<div class="reply"><a rel='nofollow' class='comment-reply-link' href='https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/?replytocom=1502#respond' data-commentid="1502" data-postid="580" data-belowelement="div-comment-1502" data-respondelement="respond" data-replyto="Reply to Soc" aria-label='Reply to Soc'>Reply</a></div>			</article><!-- .comment-body -->
		</li><!-- #comment-## -->
		</ol><!-- .comment-list -->

		
	
	
		<div id="respond" class="comment-respond">
		<h3 id="reply-title" class="comment-reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/#respond" style="display:none;">Cancel reply</a></small></h3><form action="https://enigma0x3.net/wp-comments-post.php" method="post" id="commentform" class="comment-form" novalidate><input type="hidden" id="highlander_comment_nonce" name="highlander_comment_nonce" value="80843b1c61" /><input type="hidden" name="_wp_http_referer" value="/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/" />
<input type="hidden" name="hc_post_as" id="hc_post_as" value="guest" />

<div class="comment-form-field comment-textarea">
	<label for="comment">Enter your comment here...</label>
	<div id="comment-form-comment"><textarea id="comment" name="comment" title="Enter your comment here..."></textarea></div>
</div>

<div id="comment-form-identity">
	<div id="comment-form-nascar">
		<p>Fill in your details below or click an icon to log in:</p>
		<ul>
			<li class="selected" style="display:none;">
				<a href="#comment-form-guest" id="postas-guest" class="nascar-signin-link"
                   title="Login via Guest">
									</a>
			</li>
			<li>
				<a href="#comment-form-load-service:WordPress.com" id="postas-wordpress" class="nascar-signin-link"
                   title="Login via WordPress.com">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg>				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Twitter" id="postas-twitter" class="nascar-signin-link"
                   title="Login via Twitter">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg>				</a>
			</li>
			<li>
				<a href="#comment-form-load-service:Facebook" id="postas-facebook" class="nascar-signin-link"
                   title="Login via Facebook">
					<svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg>				</a>
			</li>
		</ul>
	</div>

	<div id="comment-form-guest" class="comment-form-service selected">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
<a href="https://gravatar.com/site/signup/" target="_blank">				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Gravatar" width="25" class="no-grav" />
</a>			</div>

				<div class="comment-form-fields">
				<div class="comment-form-field comment-form-email">
					<label for="email">Email <span class="required">(required)</span> <span class="nopublish">(Address never made public)</span></label>
					<div class="comment-form-input"><input id="email" name="email" type="email" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-author">
					<label for="author">Name <span class="required">(required)</span></label>
					<div class="comment-form-input"><input id="author" name="author" type="text" value="" /></div>
				</div>
				<div class="comment-form-field comment-form-url">
					<label for="url">Website</label>
					<div class="comment-form-input"><input id="url" name="url" type="url" value="" /></div>
				</div>
			</div>
			
		</div>
	</div>

	<div id="comment-form-wordpress" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="WordPress.com Logo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="wp_avatar" id="wordpress-avatar" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_user_id" id="wordpress-user_id" class="comment-meta-wordpress" value="" />
				<input type="hidden" name="wp_access_token" id="wordpress-access_token" class="comment-meta-wordpress" value="" />
						<p class="comment-form-posting-as pa-wordpress">
			<strong></strong>
			You are commenting using your WordPress.com account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'wordpress' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M12.158 12.786l-2.698 7.84c.806.236 1.657.365 2.54.365 1.047 0 2.05-.18 2.986-.51-.024-.037-.046-.078-.065-.123l-2.762-7.57zM3.008 12c0 3.56 2.07 6.634 5.068 8.092L3.788 8.342c-.5 1.117-.78 2.354-.78 3.658zm15.06-.454c0-1.112-.398-1.88-.74-2.48-.456-.74-.883-1.368-.883-2.11 0-.825.627-1.595 1.51-1.595.04 0 .078.006.116.008-1.598-1.464-3.73-2.36-6.07-2.36-3.14 0-5.904 1.613-7.512 4.053.21.008.41.012.58.012.94 0 2.395-.114 2.395-.114.484-.028.54.684.057.74 0 0-.487.058-1.03.086l3.275 9.74 1.968-5.902-1.4-3.838c-.485-.028-.944-.085-.944-.085-.486-.03-.43-.77.056-.742 0 0 1.484.114 2.368.114.94 0 2.397-.114 2.397-.114.486-.028.543.684.058.74 0 0-.488.058-1.03.086l3.25 9.665.897-2.997c.456-1.17.684-2.137.684-2.907zm1.82-3.86c.04.286.06.593.06.924 0 .912-.17 1.938-.683 3.22l-2.746 7.94c2.672-1.558 4.47-4.454 4.47-7.77 0-1.564-.4-3.033-1.1-4.314zM12 22C6.486 22 2 17.514 2 12S6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-googleplus" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Google photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="googleplus_avatar" id="googleplus-avatar" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_user_id" id="googleplus-user_id" class="comment-meta-googleplus" value="" />
				<input type="hidden" name="googleplus_access_token" id="googleplus-access_token" class="comment-meta-googleplus" value="" />
						<p class="comment-form-posting-as pa-googleplus">
			<strong></strong>
			You are commenting using your Google account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'googleplus' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" x="0px" y="0px" viewBox="0 0 60 60" ><path fill="#FFF" d="M56.3,30c0,-1.6 -0.2,-3.4 -0.6,-5h-3.1H42.2H30v10.6h14.8C44,39.3 42,42 39.1,43.9l8.8,6.8C53,46 56.3,39 56.3,30z" /><path fill="#FFF" d="M30,57.5c6.7,0 13.1,-2.4 17.9,-6.8l-8.8,-6.8c-2.5,1.6 -5.6,2.4 -9.1,2.4c-7.2,0 -13.3,-4.7 -15.4,-11.2l-9.3,7.1C9.8,51.3 19.1,57.5 30,57.5z" /><path fill="#FFF" d="M5.3,42.2l9.3,-7.1c-0.5,-1.6 -0.8,-3.3 -0.8,-5.1s0.3,-3.5 0.8,-5.1l-9.3,-7.1C3.5,21.5 2.5,25.6 2.5,30S3.5,38.5 5.3,42.2z" /><path fill="#FFF" d="M40.1,17.4l8,-8C43.3,5.1 37,2.5 30,2.5C19.1,2.5 9.8,8.7 5.3,17.8l9.3,7.1c2.1,-6.5 8.2,-11.1 15.4,-11.1C33.9,13.7 37.4,15.1 40.1,17.4z" /></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-twitter" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="https://1.gravatar.com/avatar/ad516503a11cd5ca435acc9bb6523536?s=25&amp;d=identicon&amp;forcedefault=y&amp;r=G" alt="Twitter picture" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="twitter_avatar" id="twitter-avatar" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_user_id" id="twitter-user_id" class="comment-meta-twitter" value="" />
				<input type="hidden" name="twitter_access_token" id="twitter-access_token" class="comment-meta-twitter" value="" />
						<p class="comment-form-posting-as pa-twitter">
			<strong></strong>
			You are commenting using your Twitter account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'twitter' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M22.23 5.924c-.736.326-1.527.547-2.357.646.847-.508 1.498-1.312 1.804-2.27-.793.47-1.67.812-2.606.996C18.325 4.498 17.258 4 16.078 4c-2.266 0-4.103 1.837-4.103 4.103 0 .322.036.635.106.935-3.41-.17-6.433-1.804-8.457-4.287-.353.607-.556 1.312-.556 2.064 0 1.424.724 2.68 1.825 3.415-.673-.022-1.305-.207-1.86-.514v.052c0 1.988 1.415 3.647 3.293 4.023-.344.095-.707.145-1.08.145-.265 0-.522-.026-.773-.074.522 1.63 2.038 2.817 3.833 2.85-1.404 1.1-3.174 1.757-5.096 1.757-.332 0-.66-.02-.98-.057 1.816 1.164 3.973 1.843 6.29 1.843 7.547 0 11.675-6.252 11.675-11.675 0-.178-.004-.355-.012-.53.802-.578 1.497-1.3 2.047-2.124z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>

	<div id="comment-form-facebook" class="comment-form-service">
		<div class="comment-form-padder">
			<div class="comment-form-avatar">
				<img src="" alt="Facebook photo" width="25" class="no-grav" />
			</div>

				<div class="comment-form-fields">
				<input type="hidden" name="fb_avatar" id="facebook-avatar" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_user_id" id="facebook-user_id" class="comment-meta-facebook" value="" />
				<input type="hidden" name="fb_access_token" id="facebook-access_token" class="comment-meta-facebook" value="" />
						<p class="comment-form-posting-as pa-facebook">
			<strong></strong>
			You are commenting using your Facebook account.			<span class="comment-form-log-out">
				(&nbsp;<a href="javascript:HighlanderComments.doExternalLogout( 'facebook' );">Log&nbsp;Out</a>&nbsp;/&nbsp;
				<a href="#" onclick="javascript:HighlanderComments.switchAccount();return false;">Change</a>&nbsp;)
			</span>
			<span class="pa-icon"><svg xmlns="http://www.w3.org/2000/svg" role="presentation" viewBox="0 0 24 24" ><rect x="0" fill="none" width="24" height="24"/><g><path fill="#FFF" d="M20.007 3H3.993C3.445 3 3 3.445 3 3.993v16.013c0 .55.445.994.993.994h8.62v-6.97H10.27V11.31h2.346V9.31c0-2.325 1.42-3.59 3.494-3.59.993 0 1.847.073 2.096.106v2.43h-1.438c-1.128 0-1.346.537-1.346 1.324v1.734h2.69l-.35 2.717h-2.34V21h4.587c.548 0 .993-.445.993-.993V3.993c0-.548-.445-.993-.993-.993z"/></g></svg></span>
		</p>
					</div>
	
		</div>
	</div>


	<div id="comment-form-load-service" class="comment-form-service">
		<div class="comment-form-posting-as-cancel"><a href="javascript:HighlanderComments.cancelExternalWindow();">Cancel</a></div>
		<p>Connecting to %s</p>
	</div>

</div>

<script type="text/javascript">
var highlander_expando_javascript = function () {

	function hide( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.setProperty( 'display', 'none' );
		}
	}

	function show( sel ) {
		var el = document.querySelector( sel );
		if ( el ) {
			el.style.removeProperty( 'display' );
		}
	}

	var input = document.createElement( 'input' );
	var comment = document.querySelector( '#comment' );

	if ( input && comment && 'placeholder' in input ) {
		var label = document.querySelector( '.comment-textarea label' );
		if ( label ) {
			var text = label.textContent;
			label.parentNode.removeChild( label );
			comment.setAttribute( 'placeholder', text );
		}
	}

	// Expando Mode: start small, then auto-resize on first click + text length
	hide( '#comment-form-identity' );
	hide( '#comment-form-subscribe' );
	hide( '#commentform .form-submit' );

	if ( comment ) {
		comment.style.height = '10px';

		var handler = function () {
			comment.style.height = HighlanderComments.initialHeight + 'px';
			show( '#comment-form-identity' );
			show( '#comment-form-subscribe' );
			show( '#commentform .form-submit' );
			HighlanderComments.resizeCallback();

			comment.removeEventListener( 'focus', handler );
		};

		comment.addEventListener( 'focus', handler );
	}
}

if ( document.readyState !== 'loading' ) {
	highlander_expando_javascript();
} else {
	if ( typeof window.jQuery === 'function' ) {
		// Use jQuery's `ready` if available.
		// This solves some scheduling issues between this script and the main highlander script.
		jQuery( document ).ready( highlander_expando_javascript );
	} else {
		// If not available, add a vanilla event listener.
		document.addEventListener( 'DOMContentLoaded', highlander_expando_javascript );
	}
}

</script>

<div id="comment-form-subscribe">
	<p class="comment-subscription-form"><input type="checkbox" name="subscribe" id="subscribe" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-label" for="subscribe" style="display: inline;">Notify me of new comments via email.</label></p><p class="post-subscription-form"><input type="checkbox" name="subscribe_blog" id="subscribe_blog" value="subscribe" style="width: auto;"/> <label class="subscribe-label" id="subscribe-blog-label" for="subscribe_blog"  style="display: inline;">Notify me of new posts via email.</label></p></div>




<p class="form-submit wp-block-button"><input name="submit" type="submit" id="comment-submit" class="submit wp-block-button__link" value="Post Comment" /> <input type='hidden' name='comment_post_ID' value='580' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
</p><p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="96704aa928" /></p>
<input type="hidden" name="genseq" value="1635636805" />
<p style="display: none !important;"><label>&#916;<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js_1" name="ak_js" value="177"/><script>document.getElementById( "ak_js_1" ).setAttribute( "value", ( new Date() ).getTime() );</script></p></form>	</div><!-- #respond -->
	<div style="clear: both"></div>
</div><!-- #comments -->

	
	</div><!-- #content -->
</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" class="site-footer" role="contentinfo">
		
		<div id="secondary" class="widget-area" role="complementary">
		<aside id="search-2" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://enigma0x3.net/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></aside>
		<aside id="recent-posts-2" class="widget widget_recent_entries">
		<h1 class="widget-title">Recent Posts</h1>
		<ul>
											<li>
					<a href="https://enigma0x3.net/2020/01/15/avira-vpn-local-privilege-escalation-via-insecure-update-location/">Avira VPN Local Privilege Escalation via Insecure Update&nbsp;Location</a>
									</li>
											<li>
					<a href="https://enigma0x3.net/2019/12/10/cve-2019-19248-local-privilege-escalation-in-eas-origin-client/">CVE-2019-19248: Local Privilege Escalation in EA&#8217;s Origin&nbsp;Client</a>
									</li>
											<li>
					<a href="https://enigma0x3.net/2019/08/29/avira-optimizer-local-privilege-escalation/">Avira Optimizer Local Privilege&nbsp;Escalation</a>
									</li>
											<li>
					<a href="https://enigma0x3.net/2019/07/24/cve-2019-13382-privilege-escalation-in-snagit/">CVE-2019-13382: Local Privilege Escalation in&nbsp;SnagIt</a>
									</li>
											<li>
					<a href="https://enigma0x3.net/2019/07/05/cve-2019-13142-razer-surround-1-1-63-0-eop/">CVE-2019-13142: Razer Surround 1.1.63.0&nbsp;EoP</a>
									</li>
					</ul>

		</aside><aside id="recent-comments-2" class="widget widget_recent_comments"><h1 class="widget-title">Recent Comments</h1>				<table class="recentcommentsavatar" cellspacing="0" cellpadding="0" border="0">
					<tr><td title="Ron" class="recentcommentsavatartop" style="height:48px; width:48px;"><img alt='' src='https://2.gravatar.com/avatar/218f63a0f3f5746619b9ade0f27b9df3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstexttop" style="">Ron on <a href="https://enigma0x3.net/2019/07/24/cve-2019-13382-privilege-escalation-in-snagit/comment-page-1/#comment-18188">CVE-2019-13382: Local Privileg&hellip;</a></td></tr><tr><td title="enigma0x3" class="recentcommentsavatarend" style="height:48px; width:48px;"><img alt='' src='https://0.gravatar.com/avatar/c06dc3cee51829dbac8d5a40a56ada2f?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstextend" style="">enigma0x3 on <a href="https://enigma0x3.net/2019/07/24/cve-2019-13382-privilege-escalation-in-snagit/comment-page-1/#comment-18184">CVE-2019-13382: Local Privileg&hellip;</a></td></tr><tr><td title="Ron" class="recentcommentsavatarend" style="height:48px; width:48px;"><img alt='' src='https://2.gravatar.com/avatar/218f63a0f3f5746619b9ade0f27b9df3?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstextend" style="">Ron on <a href="https://enigma0x3.net/2019/07/24/cve-2019-13382-privilege-escalation-in-snagit/comment-page-1/#comment-18182">CVE-2019-13382: Local Privileg&hellip;</a></td></tr><tr><td title="Soc" class="recentcommentsavatarend" style="height:48px; width:48px;"><img alt='' src='https://0.gravatar.com/avatar/f032b1869da8022340d18db76da8bfcb?s=48&#038;d=identicon&#038;r=G' class='avatar avatar-48' height='48' width='48' /></td><td class="recentcommentstextend" style="">Soc on <a href="https://enigma0x3.net/2017/04/03/defeating-device-guard-a-look-into-cve-2017-0007/comment-page-1/#comment-1502">Defeating Device Guard: A look&hellip;</a></td></tr><tr><td title="&#8220;Fileless&#8221; UAC Bypass using sdclt.exe | enigma0x3" class="recentcommentsavatarend" style="height:48px; width:48px;"><a href="https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/" rel="nofollow"></a></td><td class="recentcommentstextend" style=""><a href="https://enigma0x3.net/2017/03/17/fileless-uac-bypass-using-sdclt-exe/" rel="nofollow">&#8220;Fileless&hellip;</a> on <a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/comment-page-1/#comment-1286">&#8220;Fileless&#8221; UAC Byp&hellip;</a></td></tr>				</table>
				</aside><aside id="archives-2" class="widget widget_archive"><h1 class="widget-title">Archives</h1>
			<ul>
					<li><a href='https://enigma0x3.net/2020/01/'>January 2020</a></li>
	<li><a href='https://enigma0x3.net/2019/12/'>December 2019</a></li>
	<li><a href='https://enigma0x3.net/2019/08/'>August 2019</a></li>
	<li><a href='https://enigma0x3.net/2019/07/'>July 2019</a></li>
	<li><a href='https://enigma0x3.net/2019/03/'>March 2019</a></li>
	<li><a href='https://enigma0x3.net/2019/01/'>January 2019</a></li>
	<li><a href='https://enigma0x3.net/2018/10/'>October 2018</a></li>
	<li><a href='https://enigma0x3.net/2018/06/'>June 2018</a></li>
	<li><a href='https://enigma0x3.net/2018/01/'>January 2018</a></li>
	<li><a href='https://enigma0x3.net/2017/11/'>November 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/10/'>October 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/09/'>September 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/08/'>August 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/07/'>July 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/04/'>April 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/03/'>March 2017</a></li>
	<li><a href='https://enigma0x3.net/2017/01/'>January 2017</a></li>
	<li><a href='https://enigma0x3.net/2016/11/'>November 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/08/'>August 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/07/'>July 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/05/'>May 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/03/'>March 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/02/'>February 2016</a></li>
	<li><a href='https://enigma0x3.net/2016/01/'>January 2016</a></li>
	<li><a href='https://enigma0x3.net/2015/10/'>October 2015</a></li>
	<li><a href='https://enigma0x3.net/2015/08/'>August 2015</a></li>
	<li><a href='https://enigma0x3.net/2015/04/'>April 2015</a></li>
	<li><a href='https://enigma0x3.net/2015/03/'>March 2015</a></li>
	<li><a href='https://enigma0x3.net/2015/01/'>January 2015</a></li>
	<li><a href='https://enigma0x3.net/2014/10/'>October 2014</a></li>
	<li><a href='https://enigma0x3.net/2014/07/'>July 2014</a></li>
	<li><a href='https://enigma0x3.net/2014/06/'>June 2014</a></li>
	<li><a href='https://enigma0x3.net/2014/03/'>March 2014</a></li>
	<li><a href='https://enigma0x3.net/2014/01/'>January 2014</a></li>
			</ul>

			</aside><aside id="categories-2" class="widget widget_categories"><h1 class="widget-title">Categories</h1>
			<ul>
					<li class="cat-item cat-item-1"><a href="https://enigma0x3.net/category/uncategorized/">Uncategorized</a>
</li>
			</ul>

			</aside><aside id="meta-2" class="widget widget_meta"><h1 class="widget-title">Meta</h1>
		<ul>
			<li><a href="https://wordpress.com/start?ref=wplogin">Register</a></li>			<li><a href="https://enigma0x3.wordpress.com/wp-login.php">Log in</a></li>
			<li><a href="https://enigma0x3.net/feed/">Entries feed</a></li>
			<li><a href="https://enigma0x3.net/comments/feed/">Comments feed</a></li>

			<li><a href="https://wordpress.com/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.com</a></li>
		</ul>

		</aside></div><!-- #secondary -->

		<div class="site-info">
						<a href="https://wordpress.com/?ref=footer_blog" rel="nofollow">Blog at WordPress.com.</a>
			
					</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<!--  -->
<script src='//0.gravatar.com/js/gprofiles.js?ver=202143y' id='grofiles-cards-js'></script>
<script id='wpgroho-js-extra'>
var WPGroHo = {"my_hash":""};
</script>
<script crossorigin='anonymous' type='text/javascript' src='https://s1.wp.com/wp-content/mu-plugins/gravatar-hovercards/wpgroho.js?m=1610363240h'></script>

	<script>
		// Initialize and attach hovercards to all gravatars
		( function() {
			function init() {
				if ( typeof Gravatar === 'undefined' ) {
					return;
				}

				if ( typeof Gravatar.init !== 'function' ) {
					return;
				}

				Gravatar.profile_cb = function ( hash, id ) {
					WPGroHo.syncProfileData( hash, id );
				};

				Gravatar.my_hash = WPGroHo.my_hash;
				Gravatar.init( 'body', '#wp-admin-bar-my-account' );
			}

			if ( document.readyState !== 'loading' ) {
				init();
			} else {
				document.addEventListener( 'DOMContentLoaded', init );
			}
		} )();
	</script>

		<div style="display:none">
	<div class="grofile-hash-map-f032b1869da8022340d18db76da8bfcb">
	</div>
	<div class="grofile-hash-map-218f63a0f3f5746619b9ade0f27b9df3">
	</div>
	<div class="grofile-hash-map-c06dc3cee51829dbac8d5a40a56ada2f">
	</div>
	</div>
<script id='highlander-comments-js-extra'>
var HighlanderComments = {"loggingInText":"Logging In\u2026","submittingText":"Posting Comment\u2026","postCommentText":"Post Comment","connectingToText":"Connecting to %s","commentingAsText":"%1$s: You are commenting using your %2$s account.","logoutText":"Log Out","loginText":"Log In","connectURL":"https:\/\/enigma0x3.wordpress.com\/public.api\/connect\/?action=request&domain=enigma0x3.net","logoutURL":"https:\/\/enigma0x3.wordpress.com\/wp-login.php?action=logout&_wpnonce=59d10fafa1","homeURL":"https:\/\/enigma0x3.net\/","postID":"580","gravDefault":"identicon","enterACommentError":"Please enter a comment","enterEmailError":"Please enter your email address here","invalidEmailError":"Invalid email address","enterAuthorError":"Please enter your name here","gravatarFromEmail":"This picture will show whenever you leave a comment. Click to customize it.","logInToExternalAccount":"Log in to use details from one of these accounts.","change":"Change","changeAccount":"Change Account","comment_registration":"0","userIsLoggedIn":"","isJetpack":"","text_direction":"ltr"};
</script>
<script crossorigin='anonymous' type='text/javascript' src='https://s1.wp.com/_static/??/wp-content/js/jquery/jquery.autoresize.js,/wp-content/mu-plugins/highlander-comments/script.js?m=1626677336j'></script>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-dark-grayscale"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0 0.49803921568627" /><feFuncG type="table" tableValues="0 0.49803921568627" /><feFuncB type="table" tableValues="0 0.49803921568627" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-grayscale"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0 1" /><feFuncG type="table" tableValues="0 1" /><feFuncB type="table" tableValues="0 1" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-purple-yellow"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0.54901960784314 0.98823529411765" /><feFuncG type="table" tableValues="0 1" /><feFuncB type="table" tableValues="0.71764705882353 0.25490196078431" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-blue-red"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0 1" /><feFuncG type="table" tableValues="0 0.27843137254902" /><feFuncB type="table" tableValues="0.5921568627451 0.27843137254902" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-midnight"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0 0" /><feFuncG type="table" tableValues="0 0.64705882352941" /><feFuncB type="table" tableValues="0 1" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-magenta-yellow"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0.78039215686275 1" /><feFuncG type="table" tableValues="0 0.94901960784314" /><feFuncB type="table" tableValues="0.35294117647059 0.47058823529412" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-purple-green"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0.65098039215686 0.40392156862745" /><feFuncG type="table" tableValues="0 1" /><feFuncB type="table" tableValues="0.44705882352941 0.4" /></feComponentTransfer></filter></defs></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 0 0" width="0" height="0" focusable="false" role="none" style="visibility: hidden; position: absolute; left: -9999px; overflow: hidden;" ><defs><filter id="wp-duotone-blue-orange"><feColorMatrix type="matrix" values=" .299 .587 .114 0 0 .299 .587 .114 0 0 .299 .587 .114 0 0 0 0 0 1 0 " /><feComponentTransfer color-interpolation-filters="sRGB" ><feFuncR type="table" tableValues="0.098039215686275 1" /><feFuncG type="table" tableValues="0 0.66274509803922" /><feFuncB type="table" tableValues="0.84705882352941 0.41960784313725" /></feComponentTransfer></filter></defs></svg>
<script>
window.addEventListener( "load", function( event ) {
	var link = document.createElement( "link" );
	link.href = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.css?v=20210915";
	link.type = "text/css";
	link.rel = "stylesheet";
	document.head.appendChild( link );

	var script = document.createElement( "script" );
	script.src = "https://s0.wp.com/wp-content/mu-plugins/actionbar/actionbar.js?v=20211021";
	script.defer = true;
	document.body.appendChild( script );
} );
</script>

			<div id="jp-carousel-loading-overlay">
			<div id="jp-carousel-loading-wrapper">
				<span id="jp-carousel-library-loading">&nbsp;</span>
			</div>
		</div>
		<div class="jp-carousel-overlay" style="display: none;">

		<div class="jp-carousel-container">
			<!-- The Carousel Swiper -->
			<div
				class="jp-carousel-wrap swiper-container jp-carousel-swiper-container jp-carousel-transitions"
				itemscope
				itemtype="https://schema.org/ImageGallery">
				<div class="jp-carousel swiper-wrapper"></div>
				<div class="jp-swiper-button-prev swiper-button-prev">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskPrev" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="9" height="12">
							<path d="M16.2072 16.59L11.6496 12L16.2072 7.41L14.8041 6L8.8335 12L14.8041 18L16.2072 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskPrev)">
							<rect x="0.579102" width="23.8823" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
				<div class="jp-swiper-button-next swiper-button-next">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskNext" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="8" height="12">
							<path d="M8.59814 16.59L13.1557 12L8.59814 7.41L10.0012 6L15.9718 12L10.0012 18L8.59814 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskNext)">
							<rect x="0.34375" width="23.8822" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
			</div>
			<!-- The main close buton -->
			<div class="jp-carousel-close-hint">
				<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<mask id="maskClose" mask-type="alpha" maskUnits="userSpaceOnUse" x="5" y="5" width="15" height="14">
						<path d="M19.3166 6.41L17.9135 5L12.3509 10.59L6.78834 5L5.38525 6.41L10.9478 12L5.38525 17.59L6.78834 19L12.3509 13.41L17.9135 19L19.3166 17.59L13.754 12L19.3166 6.41Z" fill="white"/>
					</mask>
					<g mask="url(#maskClose)">
						<rect x="0.409668" width="23.8823" height="24" fill="#FFFFFF"/>
					</g>
				</svg>
			</div>
			<!-- Image info, comments and meta -->
			<div class="jp-carousel-info">
				<div class="jp-carousel-info-footer">
					<div class="jp-carousel-pagination-container">
						<div class="jp-swiper-pagination swiper-pagination"></div>
						<div class="jp-carousel-pagination"></div>
					</div>
					<div class="jp-carousel-photo-title-container">
						<h2 class="jp-carousel-photo-caption"></h2>
					</div>
					<div class="jp-carousel-photo-icons-container">
						<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-info" aria-label="Toggle photo metadata visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskInfo" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7537 2C7.26076 2 2.80273 6.48 2.80273 12C2.80273 17.52 7.26076 22 12.7537 22C18.2466 22 22.7046 17.52 22.7046 12C22.7046 6.48 18.2466 2 12.7537 2ZM11.7586 7V9H13.7488V7H11.7586ZM11.7586 11V17H13.7488V11H11.7586ZM4.79292 12C4.79292 16.41 8.36531 20 12.7537 20C17.142 20 20.7144 16.41 20.7144 12C20.7144 7.59 17.142 4 12.7537 4C8.36531 4 4.79292 7.59 4.79292 12Z" fill="white"/>
									</mask>
									<g mask="url(#maskInfo)">
										<rect x="0.8125" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
							</span>
						</a>
												<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-comments" aria-label="Toggle photo comments visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskComments" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M4.3271 2H20.2486C21.3432 2 22.2388 2.9 22.2388 4V16C22.2388 17.1 21.3432 18 20.2486 18H6.31729L2.33691 22V4C2.33691 2.9 3.2325 2 4.3271 2ZM6.31729 16H20.2486V4H4.3271V18L6.31729 16Z" fill="white"/>
									</mask>
									<g mask="url(#maskComments)">
										<rect x="0.34668" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>

								<span class="jp-carousel-has-comments-indicator" aria-label="This image has comments."></span>
							</span>
						</a>
											</div>
				</div>
				<div class="jp-carousel-info-extra">
					<div class="jp-carousel-info-content-wrapper">
						<div class="jp-carousel-photo-title-container">
							<h2 class="jp-carousel-photo-title"></h2>
						</div>
						<div class="jp-carousel-comments-wrapper">
															<div id="jp-carousel-comments-loading">
									<span>Loading Comments...</span>
								</div>
								<div class="jp-carousel-comments"></div>
								<div id="jp-carousel-comment-form-container">
									<span id="jp-carousel-comment-form-spinner">&nbsp;</span>
									<div id="jp-carousel-comment-post-results"></div>
																														<form id="jp-carousel-comment-form">
												<label for="jp-carousel-comment-form-comment-field" class="screen-reader-text">Write a Comment...</label>
												<textarea
													name="comment"
													class="jp-carousel-comment-form-field jp-carousel-comment-form-textarea"
													id="jp-carousel-comment-form-comment-field"
													placeholder="Write a Comment..."
												></textarea>
												<div id="jp-carousel-comment-form-submit-and-info-wrapper">
													<div id="jp-carousel-comment-form-commenting-as">
																													<fieldset>
																<label for="jp-carousel-comment-form-email-field">Email (Required)</label>
																<input type="text" name="email" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-email-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-author-field">Name (Required)</label>
																<input type="text" name="author" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-author-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-url-field">Website</label>
																<input type="text" name="url" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-url-field" />
															</fieldset>
																											</div>
													<input
														type="submit"
														name="submit"
														class="jp-carousel-comment-form-button"
														id="jp-carousel-comment-form-button-submit"
														value="Post Comment" />
												</div>
											</form>
																											</div>
													</div>
						<div class="jp-carousel-image-meta">
							<div class="jp-carousel-title-and-caption">
								<div class="jp-carousel-photo-info">
									<h3 class="jp-carousel-caption" itemprop="caption description"></h3>
								</div>

								<div class="jp-carousel-photo-description"></div>
							</div>
							<ul class="jp-carousel-image-exif" style="display: none;"></ul>
							<a class="jp-carousel-image-download" target="_blank" style="display: none;">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="3" y="3" width="19" height="18">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M5.84615 5V19H19.7775V12H21.7677V19C21.7677 20.1 20.8721 21 19.7775 21H5.84615C4.74159 21 3.85596 20.1 3.85596 19V5C3.85596 3.9 4.74159 3 5.84615 3H12.8118V5H5.84615ZM14.802 5V3H21.7677V10H19.7775V6.41L9.99569 16.24L8.59261 14.83L18.3744 5H14.802Z" fill="white"/>
									</mask>
									<g mask="url(#mask0)">
										<rect x="0.870605" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
								<span class="jp-carousel-download-text"></span>
							</a>
							<div class="jp-carousel-image-map" style="display: none;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>
		
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/enigma0x3.net\/2017\/04\/03\/defeating-device-guard-a-look-into-cve-2017-0007\/":580};
	</script>
				<link rel='stylesheet' id='all-css-0-3' href='https://s0.wp.com/_static/??/wp-content/mu-plugins/carousel/swiper-bundle.css,/wp-content/mu-plugins/carousel/jetpack-carousel.css?m=1630955947j&cssminify=yes' type='text/css' media='all' />
<script id='jetpack-carousel-js-extra'>
var jetpackSwiperLibraryPath = {"url":"\/wp-content\/mu-plugins\/carousel\/swiper-bundle.js"};
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/enigma0x3.net\/wp-admin\/admin-ajax.php","nonce":"697ef9117f","display_exif":"1","display_comments":"1","display_geo":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/enigma0x3.wordpress.com\/wp-login.php?redirect_to=https%3A%2F%2Fenigma0x3.net%2F2017%2F04%2F03%2Fdefeating-device-guard-a-look-into-cve-2017-0007%2F","blog_id":"62662083","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"],"stats_query_args":"blog=62662083&v=wpcom&tz=0&user_id=0&subd=enigma0x3","is_public":"1"};
</script>
<script id='sharing-js-js-extra'>
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
</script>
<script crossorigin='anonymous' type='text/javascript' src='https://s1.wp.com/_static/??-eJyNkNFSxCAMRX9IlnEdqy+O30IhbdNCQAKt69ebndl1pp1afQqBc28u0UtSNlIBKnpk7WBGC+nzNPKDXj+NHxXy5VZOSDPC8ic2QknGTioD4xds8VBV8rVHYu1xAtYiqjAYch7yFi4DBEFSbXXJs7/O4gmT8kiT6qKtrDr8CY5kfXXCC2ZjCOIgIZK/nALSHoTB9MA+GgfuNyYYjpRXFgfpukq2YCQ++LZx4qVak6/eBbKcVMmyMd6bLy2Edp1vx9SaHCuDhLht/37xD41akqxr0x7oUuSiOm8wax5MRurvVUTv4e2xeTq/vJ6b5nn8BnJ156g='></script>
<script type='text/javascript'>
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
<script type="text/javascript">
// <![CDATA[
(function() {
try{
  if ( window.external &&'msIsSiteMode' in window.external) {
    if (window.external.msIsSiteMode()) {
      var jl = document.createElement('script');
      jl.type='text/javascript';
      jl.async=true;
      jl.src='/wp-content/plugins/ie-sitemode/custom-jumplist.php';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(jl, s);
    }
  }
}catch(e){}
})();
// ]]>
</script>	<iframe src='https://widgets.wp.com/likes/master.html?ver=20210831#ver=20210831&amp;origin=https://enigma0x3.net' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
	<div id='likes-other-gravatars'>
		<div class="likes-text">
			<span>%d</span> bloggers like this:		</div>
		<ul class="wpl-avatars sd-like-gravatars"></ul>
	</div>
	
		<script src="//stats.wp.com/w.js?62" defer></script> <script type="text/javascript">
_tkq = window._tkq || [];
_stq = window._stq || [];
_tkq.push(['storeContext', {'blog_id':'62662083','blog_tz':'0','user_lang':'en','blog_lang':'en','user_id':'0'}]);
_stq.push(['view', {'blog':'62662083','v':'wpcom','tz':'0','user_id':'0','post':'580','subd':'enigma0x3'}]);
_stq.push(['extra', {'crypt':'UE40eW5QN0p8M2Y/RE1TaVhzUzFMbjdWNHpwZGhTayxPSUFCMGNrd29+Smw0TDhnZmRTK0hlRi9QSGh6bi9GXVhBJWIlZlR5U1JMLU8/MkNtblkvY1dzSVouX254PXM/JT9UZnxGMTBzWWYtLEtMTlZHWndIfGc0cHdkW2YydUVzOV1fcGw4P3N2LWo5OC41NnM5aHRGVTUlL2pkUUx1VFh5cWsvPzIzdSZHRHFnSFhuK19Bfi0uJjZ1MDdGUlpUVGdqOXd1dF9MU19hRmx3cz9BWGZ1LjdIVSZVaXFGMWVWLlk4SDM0QXZabkhdOWduSnhdWDFzY1p4WDhCOFQ0aTJLU2dnNGhKVzBoeld1aT9Ua25DREt5ckV3eXUwZ2tUUmlBXWhdU0RnWW1Zfm4='}]);
_stq.push([ 'clickTrackerInit', '62662083', '580' ]);
	</script>
<noscript><img src="https://pixel.wp.com/b.gif?v=noscript" style="height:1px;width:1px;overflow:hidden;position:absolute;bottom:1px;" alt="" /></noscript>
<script>
if ( 'object' === typeof wpcom_mobile_user_agent_info ) {

	wpcom_mobile_user_agent_info.init();
	var mobileStatsQueryString = "";
	
	if( false !== wpcom_mobile_user_agent_info.matchedPlatformName )
		mobileStatsQueryString += "&x_" + 'mobile_platforms' + '=' + wpcom_mobile_user_agent_info.matchedPlatformName;
	
	if( false !== wpcom_mobile_user_agent_info.matchedUserAgentName )
		mobileStatsQueryString += "&x_" + 'mobile_devices' + '=' + wpcom_mobile_user_agent_info.matchedUserAgentName;
	
	if( wpcom_mobile_user_agent_info.isIPad() )
		mobileStatsQueryString += "&x_" + 'ipad_views' + '=' + 'views';

	if( "" != mobileStatsQueryString ) {
		new Image().src = document.location.protocol + '//pixel.wp.com/g.gif?v=wpcom-no-pv' + mobileStatsQueryString + '&baba=' + Math.random();
	}
	
}
</script>
</body>
</html>