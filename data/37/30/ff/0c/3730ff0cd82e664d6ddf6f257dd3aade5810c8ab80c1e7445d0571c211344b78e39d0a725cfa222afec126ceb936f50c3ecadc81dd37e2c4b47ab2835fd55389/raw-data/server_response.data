<html>
<head>
    <title>FS#2647 $NS is deleted, but template.php ajax.php mediamanager.php still use it.</title>
    <link href="static/style.css" rel="stylesheet"/>
    <meta charset="utf-8"/>
</head>
<body>
<div class="container">

    <div class="warning">
        This is a static dump of issues in the old "Flyspray" bugtracker for DokuWiki. Bugs and feature requests
        are now tracked at the <a href="https://github.com/splitbrain/dokuwiki/issues">issue tracker at Github</a>.
    </div>

    
    <div class="resolution">
                    <strong>Closed</strong><br />
            Deferred
            </div>

    <h1>FS#2647 $NS is deleted, but template.php ajax.php mediamanager.php still use it.</h1>
    <h2>Backend</h2>


    <ul class="tasks">
                                    <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/c289718adb8a2c36662f2fe05e813133?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2012-10-22</span>
                            <span class="user">furun</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        not sure about this...<br />
<br />
$NS is deleted, but template.php, media.php, ajax.php, mediamanager.php still use it (and maybe plugins). (unused declaration in media.php.)<br />
<br />
is this intended?<br />
<br />
(some of the functions are defining $NS, but i think not that all functions are using $NS correctly. correct $NS should be renamed to $ns or a alternative global name to avoid conflicts with the deprecated $NS, and all functions should by checked if they should use global $NS. plugin developers should be informed if there plugins are using $NS.)<br />

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/4933823dc5f71300a20a506869fcf4d9?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2012-10-22</span>
                            <span class="user">ach</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        Hmm, I was the one who deleted it. Sorry, I didn&#039;t check if it was in use, because I assumed whoever deprecated it would have made sure of that. (Note to self: Never assume anything!)<br />
<br />
The solution should be to use $NS = getNS($ID) instead.<br />
I wonder why that hasn&#039;t caused any problems so far!?

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/4933823dc5f71300a20a506869fcf4d9?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2012-10-22</span>
                            <span class="user">ach</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        Hmm, the original deprecation commit message might shed a light why this doesn&#039;t cause any problems:<br />
<br />
&quot;$NS is only used in lib/exe/{ajax,mediamanager}.php when no $ID context<br />
is present. The two functions which use $NS in inc/template.php are only<br />
called through those both endpoints, not through doku.php. In doku.php,<br />
$ID is the only correct value, $NS is not kept synchronous with $ID.&quot;<br />
See<a href=" https://github.com/splitbrain/dokuwiki/commit/bced4159c8c5f1b4da2e98b2242c2ec1c09ec74e"> https://github.com/splitbrain/dokuwiki/commit/bced4159c8c5f1b4da2e98b2242c2ec1c09ec74e</a>

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/c289718adb8a2c36662f2fe05e813133?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2012-10-22</span>
                            <span class="user">furun</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        this was the reason why i was not sure. but some users have reported problems with the media-manager...<br />
maybe anyway rename the global exchange $NS different, because of exactly this confusion? or maybe even clean op the code more deeper?<br />
<br />
dont&#039;t know if dokuwiki uses a base of all plugins to check incompatibilities, but i expect that some plugins will report problems, and maybe they search for a long time before they find the empty $NS, expect if they check the deprecated/update advices ;)<br />
(for luxury, a regexp search/lister could find plugins and native codes which have to be updated, and put a short advice how. this update had some more changes, and i see more coming.)<br />
<br />
PS:<br />
i checked the code, but i don&#039;t know this code very well and don&#039;t see the dependencies to maybe outside code, so i leave the patching to more skilled coders.<br />

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/125bdfa8a2b91432c072615364bc3fa1?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2013-02-16</span>
                            <span class="user">Michitux</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        This seems to be rather complicated as the global $NS is populated from different input variables so it&#039;s not possible to replace them easily. However I have the feeling that $NS is defined before it is used as the media manager code includes lib/exe/mediamanager.php which defines $NS and also the ajax handlers define it before calling the media manager functions. I think the proper fix should be to pass $NS as parameter where it is still used.

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/b6b4d7dbe3fb7cf61b68e36cd80f8698?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2013-02-17</span>
                            <span class="user">andi</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        bad coding style but not a real bug. should be fixed for next release, probably by reorganizing the code

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/50eb1042e50ebf3b50f99e3822b36746?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2014-06-24</span>
                            <span class="user">Greenleon</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        Not sure if related:<br />
<br />
Namespace-ACLs are broken in &quot;Ponder Stibbons&quot;.<br />
Permissions for a namespace other than the global namespace are not looked up in the media manager.<br />
I noticed that in inc/media.php (line 820) $ns is empty for me. $ns is passed as a parameter.<br />
The function is called from inc/template.php (line 1474). There, (global) $NS is used as the parameter for $ns.<br />
Using getNS($image) instead of $NS seems to work but there are other places affected.<br />
<br />
Please fix!<br />

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/8498600ecaeedbee2f19647083d758cc?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2015-08-16</span>
                            <span class="user">Klap-in</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        Something that would improve with rewrite of the media backend stuff.<br />
e.g.<a href=" https://github.com/splitbrain/dokuwiki/tree/mediarefactor"> https://github.com/splitbrain/dokuwiki/tree/mediarefactor</a><br />
<br />
Closing, as it is part of general possible improvements of the media backend code.

                                            </div>

                </li>
                                                <li class="task">
                    <div class="taskhead">
                        <img src="http://www.gravatar.com/avatar/8498600ecaeedbee2f19647083d758cc?d=monsterid&s=48" align="left"/>

                        <p class="text">
                            <span class="date">2015-08-16</span>
                            <span class="user">Klap-in</span>
                        </p>
                    </div>
                    <div class="tasktext">
                        Works, better is fine. Good to fix in general media backed rewrite.

                                            </div>

                </li>
                    
        
    </ul>


</div>
</body>
</html>
