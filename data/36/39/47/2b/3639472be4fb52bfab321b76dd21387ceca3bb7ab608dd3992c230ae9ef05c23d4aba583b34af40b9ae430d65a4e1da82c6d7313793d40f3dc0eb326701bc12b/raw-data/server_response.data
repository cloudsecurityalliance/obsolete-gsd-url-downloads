<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 2183423002: Only do security checks on javascript: URLs for frames for loading -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '28352de1a19da21bb7b46e86fe207a72';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/2183423002%252526ust%25253D1608723715681544%252526usg%25253DAFQjCNHgFLW0g1MImeScen6JvYverWs8Rw%26service%3Dah">Sign out</a>

</div>
<div class="counter">(794)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-2183423002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/2183423002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            2183423002</a>:
    Only do security checks on javascript: URLs for frames for loading  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 4 months ago by <a href="/user/jochen%20(gone%20-%20plz%20use%20gerrit)" onMouseOver="M_showUserInfoPopup(this)">jochen (gone - plz use gerrit)</a>
          </div>
          <div><b>Modified:</b><br/>
            3 years, 9 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <a href="/user/dominicc%20(has%20gone%20to%20gerrit)" onMouseOver="M_showUserInfoPopup(this)">dominicc (has gone to gerrit)</a>, <a href="/user/dcheng" onMouseOver="M_showUserInfoPopup(this)">dcheng</a>
          </div>
          
          <div><b>CC:</b><br/>
            blink-reviews, blink-reviews-html_chromium.org, chromium-reviews, dglazkov+blink
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Only do security checks on javascript: URLs for frames for loading

During layout, we don't know what origin set the URL, so we can't do the
check. On the other hand, assert that we can actually do the check for
loading.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=628942">628942</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=618138">618138</a>
<a href="mailto:R=dcheng@chromium.org,dominicc@chromium.org">R=dcheng@chromium.org,dominicc@chromium.org</a>
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/2183423002/#ps1"
       onclick="M_toggleSectionForPS('2183423002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 5
      
    </div>
  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/2183423002/#ps20001"
       onclick="M_toggleSectionForPS('2183423002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : updates
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/2183423002/#ps40001"
       onclick="M_toggleSectionForPS('2183423002', '40001')"
       class="toggled-section opentriangle">
      Patch Set 3
      : updates
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 1
      
    </div>
  

  <div id="ps-40001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 4 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue2183423002_40001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/2183423002/40001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+21 lines, -5 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2183423002/patch/40001/50001">
            third_party/WebKit/Source/bindings/core/v8/ScriptController.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2183423002/diff/40001/third_party/WebKit/Source/bindings/core/v8/ScriptController.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/2183423002/diff2/1:40001/third_party/WebKit/Source/bindings/core/v8/ScriptController.cpp"
             title="Delta from patch set 1">1</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2183423002_40001_50001.diff"
             title="Download patch for third_party/WebKit/Source/bindings/core/v8/ScriptController.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2183423002/patch/40001/50003">
            third_party/WebKit/Source/core/html/HTMLFrameElementBase.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/2183423002/diff2/1:40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/2183423002/diff2/20001:40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.h"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2183423002_40001_50003.diff"
             title="Download patch for third_party/WebKit/Source/core/html/HTMLFrameElementBase.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2183423002/patch/40001/50002">
            third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/2183423002/diff2/1:40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/2183423002/diff2/20001:40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp"
             title="Delta from patch set 2">2</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+18 lines, -4 lines</td>
        
        <td style="white-space: nowrap">
          <b>
            1 comment
            
            
          </b>
        </td>
        <td>
          <a href="/download/issue2183423002_40001_50002.diff"
             title="Download patch for third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 40001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 28 (13 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 28)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 28)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(28)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(28)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    "
           
           id="msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 09:17:56 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          The CQ bit was checked by jochen@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 09:17:59 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >The CQ bit was checked by <a href="mailto:jochen@chromium.org">jochen@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/1
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 09:18:23 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >Dry run: CQ is trying da patch. Follow status at
 
<a href="https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/1" rel="nofollow">https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.or...</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 12:06:23 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 12:06:24 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Incidentally, I think this would also address https://bugs.chromium.org/p/chromium/issues/detail?id=618138 https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60 third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:15:58 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Incidentally, I think this would also address
<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=618138" rel="nofollow">https://bugs.chromium.org/p/chromium/issues/detail?id=618138</a>

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason ==
WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) {
I wonder if we should just cache the result of this and have the various checks
consult the saved bit? It&#39;s not super intuitive (IMO) to callers what the right
enum value to pass should be, and I worry that if we add new calls, it&#39;d be easy
to get it wrong.

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode64" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:64: if
(!ScriptController::canAccessFromCurrentOrigin(toIsolate(&amp;document()),
contentFrame()))
I wonder if we should remove the isolate-&gt;InContext() branch in
canAccessFromCurrentOrigin()?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          The CQ bit was checked by jochen@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:19:35 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >The CQ bit was checked by <a href="mailto:jochen@chromium.org">jochen@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60 third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason == WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) { On 2016/07/27 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:19:37 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            ><a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason ==
WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) {
On 2016/07/27 at 15:15:58, dcheng wrote:
&gt; I wonder if we should just cache the result of this and have the various
checks consult the saved bit? It&#39;s not super intuitive (IMO) to callers what the
right enum value to pass should be, and I worry that if we add new calls, it&#39;d
be easy to get it wrong.

well, if you want to do layout and get it wrong, you&#39;ll crash in the
SECURITY_CHECK below.

If you want to load and use the layout check instead, we might be toast anyways,
if there is no cached value yet :-/

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode64" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:64: if
(!ScriptController::canAccessFromCurrentOrigin(toIsolate(&amp;document()),
contentFrame()))
On 2016/07/27 at 15:15:58, dcheng wrote:
&gt; I wonder if we should remove the isolate-&gt;InContext() branch in
canAccessFromCurrentOrigin()?

done</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/20001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:19:48 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >Dry run: CQ is trying da patch. Follow status at
 
<a href="https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/20001" rel="nofollow">https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.or...</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          Description was changed from ========== Only do security checks on javascript: URLs for frames for ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:20:07 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >Description was changed from

==========
Only do security checks on javascript: URLs for frames for loading

During layout, we don&#39;t know what origin set the URL, so we can&#39;t do the
check. On the other hand, assert that we can actually do the check for
loading.

BUG=628942
<a href="mailto:R=dcheng@chromium.org,dominicc@chromium.org">R=dcheng@chromium.org,dominicc@chromium.org</a>
==========

to

==========
Only do security checks on javascript: URLs for frames for loading

During layout, we don&#39;t know what origin set the URL, so we can&#39;t do the
check. On the other hand, assert that we can actually do the check for
loading.

BUG=628942,618138
<a href="mailto:R=dcheng@chromium.org,dominicc@chromium.org">R=dcheng@chromium.org,dominicc@chromium.org</a>
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          also referenced your bug from the CL desc
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:20:22 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >also referenced your bug from the CL desc</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60 third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason == WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) { On 2016/07/27 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 15:39:06 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            ><a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):

<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason ==
WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) {
On 2016/07/27 15:19:37, jochen wrote:
&gt; On 2016/07/27 at 15:15:58, dcheng wrote:
&gt; &gt; I wonder if we should just cache the result of this and have the various
&gt; checks consult the saved bit? It&#39;s not super intuitive (IMO) to callers what
the
&gt; right enum value to pass should be, and I worry that if we add new calls, it&#39;d
&gt; be easy to get it wrong.
&gt; 
&gt; well, if you want to do layout and get it wrong, you&#39;ll crash in the
&gt; SECURITY_CHECK below.
&gt; 
&gt; If you want to load and use the layout check instead, we might be toast
anyways,
&gt; if there is no cached value yet :-/

I&#39;m kind of thinking we should just reset this to false in insertedInto and
removedFrom: that would solve that issue right?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 16:42:15 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 16:42:16 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          On 2016/07/27 at 15:39:06, dcheng wrote: &gt; https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp &gt; File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): &gt; &gt; https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-27 18:31:09 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >On 2016/07/27 at 15:39:06, dcheng wrote:
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
&gt; File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode60" rel="nofollow">https://codereview.chromium.org/2183423002/diff/1/third_party/WebKit/Source/c...</a>
&gt; third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:60: if (reason ==
WillLoadURL &amp;&amp; protocolIsJavaScript(completeURL)) {
&gt; On 2016/07/27 15:19:37, jochen wrote:
&gt; &gt; On 2016/07/27 at 15:15:58, dcheng wrote:
&gt; &gt; &gt; I wonder if we should just cache the result of this and have the various
&gt; &gt; checks consult the saved bit? It&#39;s not super intuitive (IMO) to callers what
the
&gt; &gt; right enum value to pass should be, and I worry that if we add new calls,
it&#39;d
&gt; &gt; be easy to get it wrong.
&gt; &gt; 
&gt; &gt; well, if you want to do layout and get it wrong, you&#39;ll crash in the
&gt; &gt; SECURITY_CHECK below.
&gt; &gt; 
&gt; &gt; If you want to load and use the layout check instead, we might be toast
anyways,
&gt; &gt; if there is no cached value yet :-/
&gt; 
&gt; I&#39;m kind of thinking we should just reset this to false in insertedInto and
removedFrom: that would solve that issue right?

I dunno... too much magic IMO.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dominicc (has gone to gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          Naive question: Would it be better to just always give non-display: none; iframes layout objects, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 01:22:57 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >Naive question: Would it be better to just always give non-display: none;
iframes layout objects, even if they have invalid URLs, and decouple layout from
URL validity checks? What&#39;s the benefit of iframes with invalid URLs not having
a layout object?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          On 2016/07/28 at 01:22:57, dominicc wrote: &gt; Naive question: Would it be better to just ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 06:55:48 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >On 2016/07/28 at 01:22:57, dominicc wrote:
&gt; Naive question: Would it be better to just always give non-display: none;
iframes layout objects, even if they have invalid URLs, and decouple layout from
URL validity checks? What&#39;s the benefit of iframes with invalid URLs not having
a layout object?

I think that would be indeed better, but I don&#39;t know why this check is there -
looking at the history, it&#39;s from khtml</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          On 2016/07/28 06:55:48, jochen wrote: &gt; On 2016/07/28 at 01:22:57, dominicc wrote: &gt; &gt; Naive ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 06:57:56 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >On 2016/07/28 06:55:48, jochen wrote:
&gt; On 2016/07/28 at 01:22:57, dominicc wrote:
&gt; &gt; Naive question: Would it be better to just always give non-display: none;
&gt; iframes layout objects, even if they have invalid URLs, and decouple layout
from
&gt; URL validity checks? What&#39;s the benefit of iframes with invalid URLs not
having
&gt; a layout object?
&gt; 
&gt; I think that would be indeed better, but I don&#39;t know why this check is there
-
&gt; looking at the history, it&#39;s from khtml

OK, how about we just cache and calculate it once in
HTMLFrameElementBase::setLocation() then? That seems like the most reasonable
place to do it, as that&#39;s the central location for trigger location changes.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          On 2016/07/28 at 06:57:56, dcheng wrote: &gt; On 2016/07/28 06:55:48, jochen wrote: &gt; &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 07:09:02 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >On 2016/07/28 at 06:57:56, dcheng wrote:
&gt; On 2016/07/28 06:55:48, jochen wrote:
&gt; &gt; On 2016/07/28 at 01:22:57, dominicc wrote:
&gt; &gt; &gt; Naive question: Would it be better to just always give non-display: none;
&gt; &gt; iframes layout objects, even if they have invalid URLs, and decouple layout
from
&gt; &gt; URL validity checks? What&#39;s the benefit of iframes with invalid URLs not
having
&gt; &gt; a layout object?
&gt; &gt; 
&gt; &gt; I think that would be indeed better, but I don&#39;t know why this check is
there -
&gt; &gt; looking at the history, it&#39;s from khtml
&gt; 
&gt; OK, how about we just cache and calculate it once in
HTMLFrameElementBase::setLocation() then? That seems like the most reasonable
place to do it, as that&#39;s the central location for trigger location changes.

could it happen that we don&#39;t have a contentFrame() in setLocation but have one
later when we get inserted into a tree?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          The CQ bit was checked by jochen@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 07:16:28 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >The CQ bit was checked by <a href="mailto:jochen@chromium.org">jochen@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          updated
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 07:16:33 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >updated</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/40001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 07:16:36 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            >Dry run: CQ is trying da patch. Follow status at
 
<a href="https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2183423002/40001" rel="nofollow">https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.or...</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 08:43:04 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 08:43:05 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode192 third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:192: if (!m_URL.isEmpty()) { OK, so I thought this would ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 08:55:03 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            ><a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):

<a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode192" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:192: if
(!m_URL.isEmpty()) {
OK, so I thought this would be better, but the more I&#39;m looking at it, the more
confused I am.

setLocation() can be called directly by the parser, right? How come we don&#39;t
crash on SECURITY_CHECK(isolate-&gt;InContext())? I wouldn&#39;t expect us to
(normally) be in a v8 context when parsing a page like this:

&lt;body&gt;
&lt;iframe src=&quot;javascript:42&quot;&gt;&lt;/iframe&gt;
&lt;/body&gt;

So how does that work?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          On 2016/07/28 at 08:55:03, dcheng wrote: &gt; https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp &gt; File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right): &gt; &gt; https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode192 ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-28 08:56:13 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >On 2016/07/28 at 08:55:03, dcheng wrote:
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
&gt; File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode192" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
&gt; third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:192: if
(!m_URL.isEmpty()) {
&gt; OK, so I thought this would be better, but the more I&#39;m looking at it, the
more confused I am.
&gt; 
&gt; setLocation() can be called directly by the parser, right? How come we don&#39;t
crash on SECURITY_CHECK(isolate-&gt;InContext())? I wouldn&#39;t expect us to
(normally) be in a v8 context when parsing a page like this:
&gt; 
&gt; &lt;body&gt;
&gt; &lt;iframe src=&quot;javascript:42&quot;&gt;&lt;/iframe&gt;
&gt; &lt;/body&gt;
&gt; 
&gt; So how does that work?

either zero test coverage, or we are in context :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          On 2016/07/28 08:56:13, jochen wrote: &gt; On 2016/07/28 at 08:55:03, dcheng wrote: &gt; &gt; &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-07-29 08:41:47 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >On 2016/07/28 08:56:13, jochen wrote:
&gt; On 2016/07/28 at 08:55:03, dcheng wrote:
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
&gt; &gt; File third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp (right):
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp#newcode192" rel="nofollow">https://codereview.chromium.org/2183423002/diff/40001/third_party/WebKit/Sour...</a>
&gt; &gt; third_party/WebKit/Source/core/html/HTMLFrameElementBase.cpp:192: if
&gt; (!m_URL.isEmpty()) {
&gt; &gt; OK, so I thought this would be better, but the more I&#39;m looking at it, the
&gt; more confused I am.
&gt; &gt; 
&gt; &gt; setLocation() can be called directly by the parser, right? How come we don&#39;t
&gt; crash on SECURITY_CHECK(isolate-&gt;InContext())? I wouldn&#39;t expect us to
&gt; (normally) be in a v8 context when parsing a page like this:
&gt; &gt; 
&gt; &gt; &lt;body&gt;
&gt; &gt; &lt;iframe src=&quot;javascript:42&quot;&gt;&lt;/iframe&gt;
&gt; &gt; &lt;/body&gt;
&gt; &gt; 
&gt; &gt; So how does that work?
&gt; 
&gt; either zero test coverage, or we are in context :)


OK, so the answer to this mystery is we missed an entry point to openURL:
setNameAndOpenURL also calls openURL. It seems like this is actually callable
from script as well:

&lt;!DOCTYPE html&gt;
&lt;body&gt;
&lt;div&gt;
&lt;/div&gt;
&lt;script&gt;
document.querySelector(&#39;div&#39;).innerHTML = &#39;&lt;iframe src=&quot;javascript:\&#39;hello
world\&#39;&quot;&gt;&lt;/iframe&gt;&#39;;
&lt;/script&gt;
&lt;/body&gt;

In this case, I /think/ it might actually be safe to skip the check: since it is
only called when inserting new elements, the iframe must be same-origin, so
skipping the check is always safe. At the same time, it makes me pretty nervous
to have the check not cover this path...

The problem is if we extend the check to cover this path, then we have to make
the exception for isolate-&gt;InContext() once again...</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>jochen (gone - plz use gerrit)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-27">
                          so back to WillLoadURL?
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 4 months ago
		(2016-08-01 12:20:25 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             >
          <div class="message-body">
            
            <pre name="cl-message-27"
            >so back to WillLoadURL?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 28)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 28)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(28)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(28)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 28;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 2183423002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 2183423002: Only do security checks on javascript: URLs for frames for loading
     (Closed) </b><br/>
      Created 4 years, 4 months ago by jochen (gone - plz use gerrit)<br/>
      Modified 3 years, 9 months ago<br/>
      Reviewers: dcheng, dominicc (has gone to gerrit)<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 6
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
