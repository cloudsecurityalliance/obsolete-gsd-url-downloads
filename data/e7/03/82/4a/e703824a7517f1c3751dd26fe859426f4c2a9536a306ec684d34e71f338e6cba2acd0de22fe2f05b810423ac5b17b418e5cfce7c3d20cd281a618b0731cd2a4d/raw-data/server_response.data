<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='*General Issues Bug #76459 - RDF' href='rss/bug.php?id=76459'>
        <link rel='alternate' type='application/rss+xml' title='*General Issues Bug #76459 - RSS 2.0' href='rss/bug.php?id=76459&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Sec Bug #76459 :: windows linkinfo lacks openbasedir check</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=76459">Sec Bug</a>&nbsp;#76459</th>
            <td id="summary" colspan="5">windows linkinfo lacks openbasedir check</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2018-06-11 22:51 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2018-08-15 13:54 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>fernando &#x61;&#116; null-life &#x64;&#111;&#x74; com</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=ab">ab</a> (<a href="https://people.php.net/ab">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=%2AGeneral+Issues">*General Issues</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>7.2.6</td>
            <th class="details">OS:</th>
            <td>Windows</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-15132" target="_blank">2018-15132</a></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=76459&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=76459&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=76459&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1528757462">&nbsp;</a><strong>[2018-06-11 22:51 UTC] fernando &#x61;&#116; null-life &#x64;&#111;&#x74; com</strong>
<pre class='note'>Description:
------------
linkinfo function on windows doesn't implement openbasedir check, it can be seen by reviewing the source code. This could be abused to find files on paths outside of the allowed directories.


Windows: <a href="https://github.com/php/php-src/blob/master/ext/standard/link_win32.c#L88" rel="nofollow">https://github.com/php/php-src/blob/master/ext/standard/link_win32.c#L88</a>
Unix: <a href="https://github.com/php/php-src/blob/master/ext/standard/link.c#L85" rel="nofollow">https://github.com/php/php-src/blob/master/ext/standard/link.c#L85</a>

Test script:
---------------
&lt;?php

$var1=&quot;c:\\jump&quot;;
print &quot;checking $var1 ...&quot;.PHP_EOL;
print @linkinfo($var1).PHP_EOL;
$var1=&quot;c:\\jump\\folder\\file1.txt&quot;;
print &quot;checking $var1 ...&quot;.PHP_EOL;
print @linkinfo($var1).PHP_EOL;
$var1=&quot;c:\\jump\\blabla&quot;;
print &quot;checking $var1 ...&quot;.PHP_EOL;
print @linkinfo($var1).PHP_EOL;

Expected result:
----------------
Warning: linkinfo(): open_basedir restriction in effect...
                

Actual result:
--------------
C:\php726\php.exe -n -dopen_basedir=C:\tools sample.php

checking c:\jump ...
2
checking c:\jump\folder\file1.txt ...
2
checking c:\jump\blabla ...
-1  

</pre>
</div><h2>Patches</h2>
<a href="patch-display.php?bug_id=76459&amp;patch=Admin&amp;revision=latest" >Admin</a>
(last revision 2018-09-11 07:20 UTC by maocp_2014 &#x61;&#116; 163 &#x64;&#111;&#x74; com)
<br><p><a href='patch-add.php?bug_id=76459'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=76459'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_comment' ><a name="1528801642">&nbsp;</a><strong>[2018-06-12 11:07 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>Why do we even have distinct implementations for linkinfo()?
</pre>
</div><div class='comment type_comment' ><a name="1530688331">&nbsp;</a><strong>[2018-07-04 07:12 UTC] <a href="//people.php.net/ab">ab@php.net</a></strong>
<pre class='note'>I've pushed two branches to the security repo

- bug76459_56
- bug76459_70

Both are not more than applying <a href="http://git.php.net/?p=php-src.git;a=commitdiff;h=900778731c49611e1318e4d1839768eb46f26813" rel="nofollow">http://git.php.net/?p=php-src.git;a=commitdiff;h=900778731c49611e1318e4d1839768eb46f26813</a> to link_win32.c.

I can't tell, why these implementations are separated. Some common parts can for sure be merged, if not all of them.

Thanks.
</pre>
</div><div class='comment type_svn' ><a name="1531785472">&nbsp;</a><strong>[2018-07-16 23:57 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of ab
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=289cb0f77c28b80a779170711f5e4e92cdd4fbdb" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=289cb0f77c28b80a779170711f5e4e92cdd4fbdb</a>
Log: Fixed <a href='bug.php?id=76459'>bug #76459</a> windows linkinfo lacks openbasedir check
</pre>
</div><div class='comment type_log' ><a name="1531785473">&nbsp;</a><strong>[2018-07-16 23:57 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Open</span>
<span class="added">+Status: Closed</span>
</div></div></div><div class='comment type_svn' ><a name="1531785482">&nbsp;</a><strong>[2018-07-16 23:58 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of ab
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=f151e048ed27f6f4eef729f3310d053ab5da71d4" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=f151e048ed27f6f4eef729f3310d053ab5da71d4</a>
Log: Fixed <a href='bug.php?id=76459'>bug #76459</a> windows linkinfo lacks openbasedir check
</pre>
</div><div class='comment type_svn' ><a name="1531907748">&nbsp;</a><strong>[2018-07-18 09:55 UTC] <a href="//people.php.net/krakjoe">krakjoe@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of ab
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=2fa74ad7c4f7f716183860e81489490b83277ccc" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=2fa74ad7c4f7f716183860e81489490b83277ccc</a>
Log: Fixed <a href='bug.php?id=76459'>bug #76459</a> windows linkinfo lacks openbasedir check
</pre>
</div><div class='comment type_comment' ><a name="1533818866">&nbsp;</a><strong>[2018-08-09 12:47 UTC] fernando &#x61;&#116; null-life &#x64;&#111;&#x74; com</strong>
<pre class='note'>CVE-2018-15132 was assigned by MITRE

<a href="https://nvd.nist.gov/vuln/detail/CVE-2018-15132" rel="nofollow">https://nvd.nist.gov/vuln/detail/CVE-2018-15132</a>
</pre>
</div><div class='comment type_log' ><a name="1534341245">&nbsp;</a><strong>[2018-08-15 13:54 UTC] <a href="//people.php.net/kaplan">kaplan@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: kaplan</span>
<span class="removed">-CVE-ID:</span>
<span class="added">+CVE-ID:      2018-15132</span>
</div></div></div><div class='comment type_log' ><a name="1534341281">&nbsp;</a><strong>[2018-08-15 13:54 UTC] <a href="//people.php.net/kaplan">kaplan@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Assigned To: kaplan</span>
<span class="added">+Assigned To: ab</span>
</div></div></div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
