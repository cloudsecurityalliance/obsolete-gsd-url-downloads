<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1704163003: FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '90effb4d35f727fe4ec2f6e1a85cc7aa';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1704163003%252526ust%25253D1608725197700422%252526usg%25253DAFQjCNG-IcftjByb0gFtPaiK6x5b2ZaNZg%26service%3Dah">Sign out</a>

</div>
<div class="counter">(181)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1704163003">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1704163003/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1704163003</a>:
    FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 10 months ago by <a href="/user/mmenke" onMouseOver="M_showUserInfoPopup(this)">mmenke</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 10 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/eroman" onMouseOver="M_showUserInfoPopup(this)">eroman</a></span>, <span class='approval'><a href="/user/brettw" onMouseOver="M_showUserInfoPopup(this)">brettw</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, cbentzel+watch_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">FileURLToFilePath:  Don't unescape '/' and '\\'.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it's easily to use in an unsafe manner.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=586657">586657</a>
Committed: <a href="https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246">https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246</a>
Cr-Commit-Position: refs/heads/master@{#377013}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1704163003/#ps1"
       onclick="M_toggleSectionForPS('1704163003', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1704163003/#ps20001"
       onclick="M_toggleSectionForPS('1704163003', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Add test
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 1
      
    </div>
  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1704163003/#ps40001"
       onclick="M_toggleSectionForPS('1704163003', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Fix typo
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 7
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1704163003/#ps60001"
       onclick="M_toggleSectionForPS('1704163003', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Response to comments
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1704163003/#ps80001"
       onclick="M_toggleSectionForPS('1704163003', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Add constant, fix spelling, add test, remove smewhat tangential test added earlier
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 3
      
    </div>
  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1704163003/#ps100001"
       onclick="M_toggleSectionForPS('1704163003', '100001')"
       class="toggled-section opentriangle">
      Patch Set 6
      : Made comment less scary
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-100001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 10 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1704163003_100001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1704163003/100001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+215 lines, -168 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1704163003/patch/100001/110002">
            net/base/escape.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1704163003/diff/100001/net/base/escape.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1704163003/diff2/1:100001/net/base/escape.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1704163003/diff2/20001:100001/net/base/escape.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1704163003/diff2/40001:100001/net/base/escape.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1704163003/diff2/60001:100001/net/base/escape.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1704163003/diff2/80001:100001/net/base/escape.h"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+25 lines, -9 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1704163003_100001_110002.diff"
             title="Download patch for net/base/escape.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1704163003/patch/100001/110001">
            net/base/escape.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1704163003/diff/100001/net/base/escape.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1704163003/diff2/1:100001/net/base/escape.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1704163003/diff2/20001:100001/net/base/escape.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1704163003/diff2/40001:100001/net/base/escape.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1704163003/diff2/60001:100001/net/base/escape.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1704163003_100001_110001.diff"
             title="Download patch for net/base/escape.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1704163003/patch/100001/110003">
            net/base/escape_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1704163003/diff/100001/net/base/escape_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1704163003/diff2/1:100001/net/base/escape_unittest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1704163003/diff2/20001:100001/net/base/escape_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1704163003/diff2/40001:100001/net/base/escape_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1704163003/diff2/60001:100001/net/base/escape_unittest.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+178 lines, -157 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1704163003_100001_110003.diff"
             title="Download patch for net/base/escape_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1704163003/patch/100001/110004">
            net/base/filename_util.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1704163003/diff/100001/net/base/filename_util.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1704163003/diff2/1:100001/net/base/filename_util.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1704163003/diff2/20001:100001/net/base/filename_util.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1704163003/diff2/40001:100001/net/base/filename_util.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1704163003/diff2/60001:100001/net/base/filename_util.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1704163003_100001_110004.diff"
             title="Download patch for net/base/filename_util.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1704163003/patch/100001/110005">
            net/base/filename_util_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1704163003/diff/100001/net/base/filename_util_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1704163003/diff2/20001:100001/net/base/filename_util_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1704163003/diff2/40001:100001/net/base/filename_util_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1704163003/diff2/60001:100001/net/base/filename_util_unittest.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+6 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1704163003_100001_110005.diff"
             title="Download patch for net/base/filename_util_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 100001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 25 (10 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 25)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 25)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(25)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(25)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 22:56:40 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path (And also breaks GURL&#39;s canonicalization).

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering have GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are mapped to the
same file path via FileURLToFilePath, but have different GURLs,
seems like they aren&#39;t canonicalized...).

BUG=586657
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 22:58:01 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering have GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are mapped to the
same file path via FileURLToFilePath, but have different GURLs,
seems like they aren&#39;t canonicalized...).

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering have GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are canonicalized
to different file URLs by GURL, but mapped to the same file path
via FileURLToFilePath, seems like that rather contradicts the
definition of canonicalization).  Suspect we have a lot of other
issues there, though.

BUG=586657
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          mmenke@chromium.org changed reviewers: + eroman@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 22:59:58 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            ><a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a> changed reviewers:
+ <a href="mailto:eroman@chromium.org">eroman@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          Eric: Not really sure where else to send this. Open to ideas (Both for whom ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 22:59:59 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >Eric:  Not really sure where else to send this.  Open to ideas (Both for whom I
should send it to, and for how to solve the underlying bug).  Suppose I could
send it to brettw.

<a href="https://codereview.chromium.org/1704163003/diff/20001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/20001/net/base/filename_util_...</a>
File net/base/filename_util_unittest.cc (right):

<a href="https://codereview.chromium.org/1704163003/diff/20001/net/base/filename_util_unittest.cc#newcode803" rel="nofollow">https://codereview.chromium.org/1704163003/diff/20001/net/base/filename_util_...</a>
net/base/filename_util_unittest.cc:803: L&quot;--test.html&quot;},
This isn&#39;t exactly related to the fix.  There&#39;s another use of URL_SPECIAL_CHARS
a in GetFileNameFromURL, and this tests that we correctly sanitize it (There are
tests here when these special characters are in the filename field already, but
no tests for them when they come from URLs).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-17 23:01:15 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering have GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are canonicalized
to different file URLs by GURL, but mapped to the same file path
via FileURLToFilePath, seems like that rather contradicts the
definition of canonicalization).  Suspect we have a lot of other
issues there, though.

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering making GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are canonicalized
to different file URLs by GURL, but mapped to the same file path
via FileURLToFilePath, seems like that rather contradicts the
definition of canonicalization).  Suspect we have a lot of other
issues there, though.

BUG=586657
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Eric: I&#39;ll plan to pick this back up, re-working the enum (Split URL_SPECIAL_CHARS in two, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 16:25:29 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Eric:  I&#39;ll plan to pick this back up, re-working the enum (Split
URL_SPECIAL_CHARS in two, keeping URL_SPECIAL_CHARS  around, but planning to
remove it, after modifying all callsites to use one or both of the new values,
which I will do in followup CLs), unless you want to push back more on the
alternative approach of modifying GURL.

Modifying GURL is kinda terrifying - the code is so interleaved, with a bunch of
paths.  I&#39;m a bit concerned about doing it correctly...I still think that may be
worth doing, but I&#39;m starting to think we also want to split URL_SPECIAL_CHARS
in two, since we still need to keep these characters escaped in non-file URLs,
and I&#39;m concerned about other uses of URL_SPECIAL_CHARS.

Sound reasonable?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          lgtm https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newcode99 net/base/escape.h:99: // that&#39;s what FireFox and IE do. Worth ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 19:37:28 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >lgtm

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newcode99" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:99: // that&#39;s what FireFox and IE do.
Worth noting the obvious, that there are compatibility and web-security
ramifications to changing this for general URLs.

Apache for instance by default does not unescape these in paths:
<a href="http://httpd.apache.org/docs/current/mod/core.html#allowencodedslashes" rel="nofollow">http://httpd.apache.org/docs/current/mod/core.html#allowencodedslashes</a>

Web servers may be checking for directory escaping in urls by just ../ and not
the escaped variants, so if Chrome started transforming could be problematic.

As I understand this comment though it is specifically for file URLs, so sounds
fine.

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newcode109" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:109: SPOOFING_AND_CONTROL_CHARS = 16,
optional style: I find the 1 &lt;&lt; X notation simpler to edit for bit flags.

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
File net/base/filename_util_unittest.cc (right):

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;,
&quot;file:///C:\\foo%2f..%5cbar&quot;},
What are the unescaping rules for %2e   (dot) ?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          I think we have some disagreement here, and I want to reach some consensus on ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 20:30:22 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >I think we have some disagreement here, and I want to reach some consensus on
where we&#39;re going before I land this CL.

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newcode99" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:99: // that&#39;s what FireFox and IE do.
On 2016/02/18 19:37:28, eroman wrote:
&gt; Worth noting the obvious, that there are compatibility and web-security
&gt; ramifications to changing this for general URLs.
&gt; 
&gt; Apache for instance by default does not unescape these in paths:
&gt; <a href="http://httpd.apache.org/docs/current/mod/core.html#allowencodedslashes" rel="nofollow">http://httpd.apache.org/docs/current/mod/core.html#allowencodedslashes</a>
&gt; 
&gt; Web servers may be checking for directory escaping in urls by just ../ and not
&gt; the escaped variants, so if Chrome started transforming could be problematic.
&gt; 
&gt; As I understand this comment though it is specifically for file URLs, so
sounds
&gt; fine.

Actually, I&#39;m thinking that the compatibility and web-security ramifications are
more around *not* using this for URLs (Of any type), and that&#39;s where the scary
comment should go instead.  Unescaping slashes on GURLs or GURL components for
any reason seems like something that&#39;s generally not a good idea, with the
exception of Javascript URLs.  We mostly unescape for either display, or picking
local file names (On file or http URLs).  For display, it changes the semantic
meaning of a URL, so seems like a bad idea.  For local files, it seems like a
potential attack vector, regardless of whether we&#39;re talking file or http URLs.

I think we should get rid of URL_SPECIAL_CHARS in favor of this, and a separate
flag just for path characters - I&#39;ve added a TODO about that, and a warning to
URL_SPECIAL_CHARS.

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newcode109" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:109: SPOOFING_AND_CONTROL_CHARS = 16,
On 2016/02/18 19:37:28, eroman wrote:
&gt; optional style: I find the 1 &lt;&lt; X notation simpler to edit for bit flags.

SGTM, done.

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
File net/base/filename_util_unittest.cc (right):

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;,
&quot;file:///C:\\foo%2f..%5cbar&quot;},
On 2016/02/18 19:37:28, eroman wrote:
&gt; What are the unescaping rules for %2e   (dot) ?

Dots are unescaped in paths, since they have no magic meaning http or file URLs
(They may have a magic meaning to the OS for how to handle opening, but that&#39;s
another matter).

The periods removed in the other test I added are removed because of magic code
to sanitize a file name for download.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc File net/base/filename_util_unittest.cc (right): https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244 net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;, &quot;file:///C:\\foo%2f..%5cbar&quot;}, On 2016/02/18 20:30:22, mmenke wrote: &gt; On ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 21:17:22 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            ><a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
File net/base/filename_util_unittest.cc (right):

<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;,
&quot;file:///C:\\foo%2f..%5cbar&quot;},
On 2016/02/18 20:30:22, mmenke wrote:
&gt; On 2016/02/18 19:37:28, eroman wrote:
&gt; &gt; What are the unescaping rules for %2e   (dot) ?
&gt; 
&gt; Dots are unescaped in paths, since they have no magic meaning http or file
URLs
&gt; (They may have a magic meaning to the OS for how to handle opening, but that&#39;s
&gt; another matter).
&gt; 
&gt; The periods removed in the other test I added are removed because of magic
code
&gt; to sanitize a file name for download.

But dots do have a magical meaning, which is no less magical than slashes and
backslashes IMO.

GURL will collapse paths during canonicalization, so for instance
   foo/bar/../x ---&gt; foo/x

Right?

This will also occur when the dots are percent escaped, as in %2e%2e.

So from a policy perspective I still don&#39;t really understand why we would choose
to unescape dots, but not slashes and backslashes.

Both have implications for how file paths are opened on disk.

I get that this CL is trying to at least match the consistency from the point of
view of GURL, and LGTM from that side. But as a larger policy I don&#39;t quite
understand why special preference for slashes but not dots.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          On 2016/02/18 21:17:22, eroman wrote: &gt; https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc &gt; File net/base/filename_util_unittest.cc (right): &gt; &gt; https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244 &gt; ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 22:11:06 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >On 2016/02/18 21:17:22, eroman wrote:
&gt;
<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
&gt; File net/base/filename_util_unittest.cc (right):
&gt; 
&gt;
<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
&gt; net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;,
&gt; &quot;file:///C:\\foo%2f..%5cbar&quot;},
&gt; On 2016/02/18 20:30:22, mmenke wrote:
&gt; &gt; On 2016/02/18 19:37:28, eroman wrote:
&gt; &gt; &gt; What are the unescaping rules for %2e   (dot) ?
&gt; &gt; 
&gt; &gt; Dots are unescaped in paths, since they have no magic meaning http or file
&gt; URLs
&gt; &gt; (They may have a magic meaning to the OS for how to handle opening, but
that&#39;s
&gt; &gt; another matter).
&gt; &gt; 
&gt; &gt; The periods removed in the other test I added are removed because of magic
&gt; code
&gt; &gt; to sanitize a file name for download.
&gt; 
&gt; But dots do have a magical meaning, which is no less magical than slashes and
&gt; backslashes IMO.
&gt; 
&gt; GURL will collapse paths during canonicalization, so for instance
&gt;    foo/bar/../x ---&gt; foo/x
&gt; 
&gt; Right?

Those are dots surrounded by slashes, so I consider that more a property of the
slash than the dot.

&gt; This will also occur when the dots are percent escaped, as in %2e%2e.
&gt; 
&gt; So from a policy perspective I still don&#39;t really understand why we would
choose
&gt; to unescape dots, but not slashes and backslashes.

&quot;.&quot; is not a reserved character in URLs, &quot;/&quot; is
(<a href="https://www.ietf.org/rfc/rfc2396.txt" rel="nofollow">https://www.ietf.org/rfc/rfc2396.txt</a>, see section 2.2), so &quot;/&quot; has to be kept
escaped, unlike &quot;.&quot;, or it will change the meaning of a URL.

<a href="http://blah/foo%2e" rel="nofollow">http://blah/foo%2e</a> is a file or directory named &quot;foo.&quot;, which is the same as
&quot;http://blah/foo.&quot;, while <a href="http://blah/foo%2f&quot;" rel="nofollow">http://blah/foo%2f&quot;</a> is a file named &quot;foo/&quot;, but that
is *not* the same as <a href="http://blah/foo%2f" rel="nofollow">http://blah/foo%2f</a>.

Also, <a href="https://blah/foo/../" rel="nofollow">https://blah/foo/../</a> and <a href="https://blah/foo/%2e%2e/" rel="nofollow">https://blah/foo/%2e%2e/</a> both mean the same thing
as <a href="https://blah/" rel="nofollow">https://blah/</a>.

&gt; Both have implications for how file paths are opened on disk.
&gt; 
&gt; I get that this CL is trying to at least match the consistency from the point
of
&gt; view of GURL, and LGTM from that side. But as a larger policy I don&#39;t quite
&gt; understand why special preference for slashes but not dots.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          On 2016/02/18 22:11:06, mmenke wrote: &gt; On 2016/02/18 21:17:22, eroman wrote: &gt; &gt; &gt; https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-18 22:21:12 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >On 2016/02/18 22:11:06, mmenke wrote:
&gt; On 2016/02/18 21:17:22, eroman wrote:
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
&gt; &gt; File net/base/filename_util_unittest.cc (right):
&gt; &gt; 
&gt; &gt;
&gt;
<a href="https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_unittest.cc#newcode244" rel="nofollow">https://codereview.chromium.org/1704163003/diff/40001/net/base/filename_util_...</a>
&gt; &gt; net/base/filename_util_unittest.cc:244: {L&quot;C:\\foo%2f..%5cbar&quot;,
&gt; &gt; &quot;file:///C:\\foo%2f..%5cbar&quot;},
&gt; &gt; On 2016/02/18 20:30:22, mmenke wrote:
&gt; &gt; &gt; On 2016/02/18 19:37:28, eroman wrote:
&gt; &gt; &gt; &gt; What are the unescaping rules for %2e   (dot) ?
&gt; &gt; &gt; 
&gt; &gt; &gt; Dots are unescaped in paths, since they have no magic meaning http or file
&gt; &gt; URLs
&gt; &gt; &gt; (They may have a magic meaning to the OS for how to handle opening, but
&gt; that&#39;s
&gt; &gt; &gt; another matter).
&gt; &gt; &gt; 
&gt; &gt; &gt; The periods removed in the other test I added are removed because of magic
&gt; &gt; code
&gt; &gt; &gt; to sanitize a file name for download.
&gt; &gt; 
&gt; &gt; But dots do have a magical meaning, which is no less magical than slashes
and
&gt; &gt; backslashes IMO.
&gt; &gt; 
&gt; &gt; GURL will collapse paths during canonicalization, so for instance
&gt; &gt;    foo/bar/../x ---&gt; foo/x
&gt; &gt; 
&gt; &gt; Right?
&gt; 
&gt; Those are dots surrounded by slashes, so I consider that more a property of
the
&gt; slash than the dot.
&gt; 
&gt; &gt; This will also occur when the dots are percent escaped, as in %2e%2e.
&gt; &gt; 
&gt; &gt; So from a policy perspective I still don&#39;t really understand why we would
&gt; choose
&gt; &gt; to unescape dots, but not slashes and backslashes.
&gt; 
&gt; &quot;.&quot; is not a reserved character in URLs, &quot;/&quot; is
&gt; (<a href="https://www.ietf.org/rfc/rfc2396.txt" rel="nofollow">https://www.ietf.org/rfc/rfc2396.txt</a>, see section 2.2), so &quot;/&quot; has to be kept
&gt; escaped, unlike &quot;.&quot;, or it will change the meaning of a URL.
&gt; 
&gt; <a href="http://blah/foo%2e" rel="nofollow">http://blah/foo%2e</a> is a file or directory named &quot;foo.&quot;, which is the same as
&gt; &quot;http://blah/foo.&quot;, while <a href="http://blah/foo%2f&quot;" rel="nofollow">http://blah/foo%2f&quot;</a> is a file named &quot;foo/&quot;, but that
&gt; is *not* the same as <a href="http://blah/foo%2f" rel="nofollow">http://blah/foo%2f</a>.

Not the same as <a href="http://blah/foo/" rel="nofollow">http://blah/foo/</a>, rather.

&gt; Also, <a href="https://blah/foo/../" rel="nofollow">https://blah/foo/../</a> and <a href="https://blah/foo/%2e%2e/" rel="nofollow">https://blah/foo/%2e%2e/</a> both mean the same
thing
&gt; as <a href="https://blah/" rel="nofollow">https://blah/</a>.
&gt; 
&gt; &gt; Both have implications for how file paths are opened on disk.
&gt; &gt; 
&gt; &gt; I get that this CL is trying to at least match the consistency from the
point
&gt; of
&gt; &gt; view of GURL, and LGTM from that side. But as a larger policy I don&#39;t quite
&gt; &gt; understand why special preference for slashes but not dots.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>eroman</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          lgtm, but for a more pro review you would want brettw :)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 01:01:14 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >lgtm, but for a more pro review you would want brettw :)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          On 2016/02/19 01:01:14, eroman wrote: &gt; lgtm, but for a more pro review you would ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 01:14:44 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >On 2016/02/19 01:01:14, eroman wrote:
&gt; lgtm, but for a more pro review you would want brettw :)

Will do</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 17:54:48 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.  May be worth considering making GURL unescape
these characters in file URLs, though that could lead to other
issues.

Unescaping characters that GURL doesn&#39;t escape in the first place
also seems to break canonicalization (If two URLs are canonicalized
to different file URLs by GURL, but mapped to the same file path
via FileURLToFilePath, seems like that rather contradicts the
definition of canonicalization).  Suspect we have a lot of other
issues there, though.

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it&#39;s easily to use in an unsafe manner.

BUG=586657
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          mmenke@chromium.org changed reviewers: + brettw@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 17:54:48 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            ><a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a> changed reviewers:
+ <a href="mailto:brettw@chromium.org">brettw@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          [+brettw]: PTAL https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittest.cc File net/base/escape_unittest.cc (right): https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittest.cc#newcode165 net/base/escape_unittest.cc:165: &quot;Some%20random text %25-OK&quot;}, Sorry for the reformatting ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-19 17:55:12 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >[+brettw]: PTAL

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittest.cc" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittes...</a>
File net/base/escape_unittest.cc (right):

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittest.cc#newcode165" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape_unittes...</a>
net/base/escape_unittest.cc:165: &quot;Some%20random text %25-OK&quot;},
Sorry for the reformatting - it was due to git cl format.  Basically just
replaced URL_SPECIAL_CHARS with URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS
everywhere, added the above test case, and added two test cases at the end of
the section.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>brettw</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          lgtm https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newcode92 net/base/escape.h:92: // should be used rarely, and only with ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-22 23:33:24 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >lgtm

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newcode92" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newco...</a>
net/base/escape.h:92: // should be used rarely, and only with extreme caution.
I think it would be worth mentioning here that the normal use-case for this is
for URLs that don&#39;t assign meaning to a path like data URLs. Otherwise this
comment seems overly discouraging of this type of use-case.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          Thanks for the feedback! https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newcode92 net/base/escape.h:92: // should be used rarely, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 15:59:39 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >Thanks for the feedback!

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newcode92" rel="nofollow">https://codereview.chromium.org/1704163003/diff/80001/net/base/escape.h#newco...</a>
net/base/escape.h:92: // should be used rarely, and only with extreme caution.
On 2016/02/22 23:33:24, brettw wrote:
&gt; I think it would be worth mentioning here that the normal use-case for this is
&gt; for URLs that don&#39;t assign meaning to a path like data URLs. Otherwise this
&gt; comment seems overly discouraging of this type of use-case.

Done</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          The CQ bit was checked by mmenke@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 16:00:43 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >The CQ bit was checked by <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          The patchset sent to the CQ was uploaded after l-g-t-m from eroman@chromium.org, brettw@chromium.org Link to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 16:00:43 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:eroman@chromium.org">eroman@chromium.org</a>,
<a href="mailto:brettw@chromium.org">brettw@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1704163003/#ps100001" rel="nofollow">https://codereview.chromium.org/1704163003/#ps100001</a>
(title: &quot;Made comment less scary&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1704163003/100001 View timeline at https://chromium-cq-status.appspot.com/patch-timeline/1704163003/100001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 16:03:03 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1704163003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1704163003/100001</a>
View timeline at
 <a href="https://chromium-cq-status.appspot.com/patch-timeline/1704163003/100001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-timeline/1704163003/100001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 17:28:28 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-21"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it&#39;s easily to use in an unsafe manner.

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it&#39;s easily to use in an unsafe manner.

BUG=586657
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          Committed patchset #6 (id:100001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 17:28:29 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-22"
            >Committed patchset #6 (id:100001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          Description was changed from ========== FileURLToFilePath: Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;. GURL leaves these escaped, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 17:29:17 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-23"
            >Description was changed from

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it&#39;s easily to use in an unsafe manner.

BUG=586657
==========

to

==========
FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.

GURL leaves these escaped, and unescaping them in paths changes the
meaning of the path.

Added two values to the UnescapeRule enumeration:
PATH_SEPARATORS and URL_SPECIAL_CHARS_EXCEPT_PATH_SEPARATORS.

In followup CLs, I intend to replace all uses of URL_SPECIAL_CHARS,
in favor of one or both the two new values, and eventually remove
the value, as it&#39;s easily to use in an unsafe manner.

BUG=586657

Committed: <a href="https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246" rel="nofollow">https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246</a>
Cr-Commit-Position: refs/heads/master@{#377013}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-24">
                          Patchset 6 (id:??) landed as https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246 Cr-Commit-Position: refs/heads/master@{#377013}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 10 months ago
		(2016-02-23 17:29:18 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-24"
            >Patchset 6 (id:??) landed as
<a href="https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246" rel="nofollow">https://crrev.com/30408ae67a9f6aea074b2883ba861613f52bd246</a>
Cr-Commit-Position: refs/heads/master@{#377013}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 25)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 25)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(25)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(25)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 25;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1704163003;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1704163003: FileURLToFilePath:  Don&#39;t unescape &#39;/&#39; and &#39;\\&#39;.
     (Closed) </b><br/>
      Created 4 years, 10 months ago by mmenke<br/>
      Modified 4 years, 10 months ago<br/>
      Reviewers: eroman, brettw<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 11
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
