
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>
Issue 39401: [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7 - Python tracker

</title>
<link rel="shortcut icon" href="@@file/favicon.ico" />
<link rel="stylesheet" type="text/css" href="@@file/main.css" />
<link rel="stylesheet" type="text/css" href="@@file/style.css" />
<link rel="search" type="application/opensearchdescription+xml" href="@@file/osd.xml" title="Python bug tracker search" />
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script nonce="5a279c07ecdf61729118d3c50bfed526540b6ec0a87af9ca2ba3d3cca4341fc5" type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        return false;
    }
    submitted = true;
    return true;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://bugs.python.org/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
    HelpWin.focus ()
}
</script>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.js"></script>
<script type="text/javascript" src="@@file/issue.item.js"></script>
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/smoothness/jquery-ui.css" />


</head>
<body>
  <!--  Logo  -->
  <h1 id="logoheader">
    <a accesskey="1" href="." id="logolink">
       <img src="@@file/python-logo.gif" alt="homepage" border="0" id="logo" /></a>
  </h1>

<div id="utility-menu">
<!-- Search Box -->
<div id="searchbox">
    <form name="searchform" method="get" action="issue" id="searchform">
      <div id="search">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignee,status,type" />
       <input type="hidden" name="@sort" value="-activity" />
       <input type="hidden" name="@filter" value="status" />
       <input type="hidden" name="@action" value="searchid" />
       <input type="hidden" name="ignore" value="file:content" />
       <input class="input-text" id="search-text"
              name="@search_text" size="10" />
       <input type="submit" id="submit" value="search" name="submit" class="input-button" />
       <input type="radio" name="status"
              id="status_notresolved" value="-1,1,3" />
       <label for="status_notresolved">open</label>
       <input type="radio" name="status" checked="checked"
              id="status_all" value="-1,1,2,3" />
       <label for="status_all">all</label>
      </div>
     </form>
</div>
</div>


<div id="left-hand-navigation">
<!--  Main Menu NEED LEVEL TWO HEADER AND FOOTER -->
<div id="menu">
  <ul class="level-one">
    <li><a href="https://www.python.org/" title="Go to the Python homepage">Python Home</a></li>
    <li><a href="https://www.python.org/about/" title="About The Python Language">About</a></li>
    <li><a href="https://www.python.org/blogs/" title="">News</a></li>
    <li><a href="https://www.python.org/doc/" title="">Documentation</a></li>
    <li><a href="https://www.python.org/downloads/" title="">Downloads</a></li>
    <li><a href="https://www.python.org/community/" title="">Community</a></li>
    <li><a href="https://www.python.org/psf/" title="Python Software Foundation">Foundation</a></li>
    <li><a href="https://devguide.python.org/" title="Python Developer's Guide">Developer's Guide</a></li>
    <li class="selected"><a href="." class="selected" title="Python Issue Tracker">Issue Tracker</a>
      <ul class="level-two">
        <li>
          <strong>Issues</strong>
          <ul class="level-three">
            
            <li><a href="issue?@template=search&amp;status=1">Search</a></li>
            <li><a href="issue?@action=random">Random Issue</a></li>
            <li>
              <form method="post" action="issue39401">
                <input type="submit" class="form-small"
                       value="Show issue:" />
                <input class="form-small" size="4" type="text" name="@number" />
                <input type="hidden" name="@type" value="issue" />
                <input type="hidden" name="@action" value="show" />
              </form>
            </li>
          </ul>
        </li>


        <li>
          <strong>Summaries</strong>
          <ul class="level-three">
            

            

            

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Issues%20with%20patch&amp;@startwith=0&amp;@group=priority&amp;keywords=2&amp;@action=search&amp;@filter=&amp;@pagesize=50">Issues with patch</a>
            </li>

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Easy%20issues&amp;@startwith=0&amp;@group=priority&amp;keywords=6&amp;@action=search&amp;@filter=&amp;@pagesize=50">Easy issues</a>
            </li>

            <li>
              <a href="issue?@template=stats">Stats</a>
            </li>

          </ul>
        </li>


        <li>
          <strong>User</strong>
          <form method="post" action="issue39401">
          <ul class="level-three">
            <li>
                Login&nbsp;(OpenID&nbsp;possible)<br />
	         <a style="display:inline;width:0;margin:0"
             href="issue39401?@action=oic_login&amp;provider=Google">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.google.com/favicon.ico"
                       alt="Google" title="Google" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue39401?@action=oic_login&amp;provider=GitHub">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.github.com/favicon.ico"
                       alt="GitHub" title="GitHub" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue39401?@action=openid_login&amp;provider=Launchpad">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://launchpad.net/favicon.ico"
                       alt="Launchpad" title="Launchpad" /></a>
                <input size="10" name="openid_identifier" style="background:url(@@file/openid-16x16.gif)
                  center left no-repeat;padding-left:16px" /><br />
                <input size="10" type="password" name="__login_password" /><br />
                <input type="hidden" name="@action" value="Login" />
                <input type="checkbox" name="remember" id="remember" />
                <label for="remember">Remember me?</label><br />
                <input class="form-small" type="submit"
                       value="Login" /><br />
                <input type="hidden" name="__came_from"
                       value="https://bugs.python.org/issue39401?">
                
                <input type="hidden" name="@sort" value=""/>
<input type="hidden" name="@group" value=""/>
<input type="hidden" name="@pagesize" value="50"/>
<input type="hidden" name="@startwith" value="0"/>
            </li>
            <li>
                <a href="user?@template=register">Register</a>
            </li>
            <li><a href="user?@template=forgotten">Lost&nbsp;your&nbsp;login?</a></li>
          </ul>
          </form>
        </li>

        

        

        <li>
          <strong>Administration</strong>
          <ul class="level-three">
            
            <li>
                <a href="user?@sort=username">User List</a></li>
            <li>
                <a href="user?iscommitter=1&amp;@action=search&amp;@sort=username&amp;@pagesize=300">Committer List</a></li>
            
            
            
          </ul>
        </li>

        <li>
          <strong>Help</strong>
          <ul class="level-three">
            <li><a href="http://docs.python.org/devguide/triaging.html">
                Tracker Documentation</a></li>
            <li><a href="http://wiki.python.org/moin/TrackerDevelopment">
                Tracker Development</a></li>
            <li><a href="https://github.com/python/psf-infra-meta/issues">
                Report Tracker Problem</a></li>
          </ul>
        </li>

      </ul>
    </li>
  </ul>
</div> <!-- menu -->
</div> <!-- left-hand-navigation -->

<div id="content-body">
<div id="body-main">
<div id="content">
<div id="breadcrumb">
 
 
 Issue39401
 
</div>
 
 





<div>

<form method="post" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue39401">

<fieldset><legend>classification</legend>
<table class="form">
<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#title" target="_blank">Title</a>:</th>
 
 <td colspan="3">
  <span>[CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7</span>
  <input type="hidden" name="title"
         value="[CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7">
 </td>
</tr>

<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#type" target="_blank">Type</a>:</th>
 <td>security</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#stage" target="_blank">Stage</a>:</th>
 <td>resolved</td>
</tr>

<tr>
 <th><a href="http://docs.python.org/devguide/triaging.html#components" target="_blank">Components</a>:</th>
 <td>Windows</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#versions" target="_blank">Versions</a>:</th>
 <td>Python 3.8, Python 3.7, Python 3.6</td>
</tr>
</table>
</fieldset>

<fieldset><legend>process</legend>
<table class="form">
<tr>
  <th><a href="http://docs.python.org/devguide/triaging.html#status" target="_blank">Status</a>:</th>
  <td>closed</td>
  <th><a href="http://docs.python.org/devguide/triaging.html#resolution" target="_blank">Resolution</a>:</th>
  <td>fixed</td>
</tr>

<tr>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#dependencies"
       target="_blank">Dependencies</a>:
 </th>
 <td>
  
  
 </td>
 <th><a href="http://docs.python.org/devguide/triaging.html#superseder" target="_blank">Superseder</a>:</th>
 <td>
  
 
 </td>
 </tr>
 <tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#assigned-to"
      target="_blank">Assigned To</a>:
 </th>
 
 <td>
  steve.dower
 </td>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#nosy-list"
      target="_blank">Nosy List</a><!--
        <span tal:condition="context/nosy_count" tal:replace="python: ' (%d)' % context.nosy_count" /> -->:
 </th>
 <td>
     anthonywee, eryksun, jkloth, miss-islington, ned.deily, paul.moore, steve.dower, tim.golden, vstinner, zach.ware
     
 </td>
</tr>
<tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#priority"
      target="_blank">Priority</a>:
 </th>
 <td></td>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#keywords"
       target="_blank">Keywords</a>:
 </th>
 <td>patch</td>


</tr>









</table>
</fieldset>

</form>

<p>Created on <strong>2020-01-21 01:02</strong> by <strong>anthonywee</strong>, last changed <strong>2020-01-31 02:14</strong> by <strong>ned.deily</strong>. This issue is now <strong style="color:#00F; background-color:inherit;">closed</strong>.</p>

<table class="files">
 <tr><th colspan="5" class="header">Files</th></tr>
 <tr>
  <th>File name</th>
  <th>Uploaded</th>
  <th>Description</th>
  <th>Edit</th>
 </tr>
 <tr>
  <td>
   <a href="file48855/python%20unsafe%20dll%20loading.png">python unsafe dll loading.png</a>
  </td>
  <td>
   <span>anthonywee</span>,
   <span>2020-01-21 01:02</span>
  </td>
  <td></td>
  <td>
      
      
      
  </td>
 </tr>
</table>

<table class="files">
 <tr><th class="header" colspan="4">Pull Requests</th></tr>
 <tr>
  <th>URL</th>
  <th>Status</th>
  <th>Linked</th>
  <th>Edit</th>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/18231" title="bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier">PR 18231</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2020-01-28 09:57</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/18232" title="[3.7] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">PR 18232</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2020-01-28 10:02</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/18233" title="[3.6] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">PR 18233</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2020-01-28 10:05</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/18234" title="[3.8] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">PR 18234</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2020-01-28 10:06</span>
  </td>
  <td>
    
  </td>
 </tr>
</table>





<table class="messages">
 <tr><th colspan="4" class="header">Messages (17)</th></tr>
 
  <tr>
    <th>
     <a href="#msg360348" id="msg360348">msg360348</a> - <a
    href="msg360348">(view)</a></th>
   <th>Author: Anthony Wee (anthonywee) <span title="Contributor form received">*</span></th>
   <th>Date: 2020-01-21 01:02</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>On Win7, running Python in the terminal will attempt to load the "api-ms-win-core-path-l1-1-0.dll" from various paths outside of the Python directory and the C:\Windows\System32 directories. This behavior can be verified using Process Monitor (see attachment).

This is happening due to direct calls to LoadLibraryW() in getpathp.c without any "LOAD_LIBRARY_SEARCH*" flags.

In join():

<a href="https://github.com/python/cpython/blob/c02b41b1fb115c87693530ea6a480b2e15460424/PC/getpathp.c#L255">https://github.com/python/cpython/blob/c02b41b1fb115c87693530ea6a480b2e15460424/PC/getpathp.c#L255</a>

and canonicalize():

<a href="https://github.com/python/cpython/blob/c02b41b1fb115c87693530ea6a480b2e15460424/PC/getpathp.c#L291">https://github.com/python/cpython/blob/c02b41b1fb115c87693530ea6a480b2e15460424/PC/getpathp.c#L291</a>

For both cases, the methods they are trying to load from api-ms-win-core-path-l1-1-0.dll (PathCchCanonicalizeEx and PathCchCombineEx) were introduced in Win8. 

I tested on Win7 and Win10 and they differ in how they load these api-ms-win-* dll's and whether they appear in process monitor. In Win7, a CreateFile event appears in procmon, while in Win10 it seems like the OS is automatically loading the module from kernelbase.dll. Also in Win7 the loading of api-ms-win-core-path-l1-1-0.dll will fail while in Win10 it succeeds. However, in Win7 when it fails it results in the standard dll search strategy, which will eventually search outside of the secure directories such as the directories in the PATH env var: <a href="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order">https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order</a>

Each of the problematic methods in cpython have a pattern of attempting to load the dll, then falling back to an older version of the method. Thus in Win7, the dll fails to load and it falls back to the older version of the method. In Win10, the dll load succeeds and we use the new versions of the methods.

I'm working on a fix to pass the LOAD_LIBRARY_SEARCH_DEFAULT_DIRS flag to limit to the dll search path scope.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360350" id="msg360350">msg360350</a> - <a
    href="msg360350">(view)</a></th>
   <th>Author: Eryk Sun (eryksun) <span title="Contributor form received">*</span> <img src="@@file/triager.png" title="Python triager" alt="(Python triager)" /></th>
   <th>Date: 2020-01-21 04:34</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; On Win7, running Python in the terminal will attempt to load the 
&gt; "api-ms-win-core-path-l1-1-0.dll" from various paths outside of the 
&gt; Python directory and the C:\Windows\System32 directories.

"api-ms-win-core-path-l1-1-0.dll" is not assigned in the API set schema (in ApiSetSchema.dll) in Windows 7. Since the name is neither in the list of known DLLs nor the list of assigned API sets, the loader searches for it in the normal way. (FYI, the number of API sets increased from 35 in Windows 7 up to 502 in Windows 8.1.)

&gt; I'm working on a fix to pass the LOAD_LIBRARY_SEARCH_DEFAULT_DIRS

I think this could use just LOAD_LIBRARY_SEARCH_SYSTEM32. I see no reason to try to load "api-ms-win-core-path-l1-1-0.dll" from the application directory or user directories.

I'm adding 3.6-3.9 to the list of affected versions. In 3.9 it can use a static import instead (i.e. remove LoadLibraryaExW / GetProcAddress), since only Windows 8.1+ is supported.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360529" id="msg360529">msg360529</a> - <a
    href="msg360529">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-23 01:56</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Agreed, we can just search System32 for this. Thanks for doing the patch!

For future reference, and for anyone else reading this, we generally prefer unavoidable DLL hijacking bugs to come to the Python Security Response Team first (<a href="mailto:security@python.org">security@python.org</a>).</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360858" id="msg360858">msg360858</a> - <a
    href="msg360858">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-28 10:18</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>For clarity, I'm removing 3.9 from the affected versions. This version does not support Windows 7, and only Windows 7 is vulnerable to this DLL hijack.

Also submitting the CVE request.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360882" id="msg360882">msg360882</a> - <a
    href="msg360882">(view)</a></th>
   <th>Author: Eryk Sun (eryksun) <span title="Contributor form received">*</span> <img src="@@file/triager.png" title="Python triager" alt="(Python triager)" /></th>
   <th>Date: 2020-01-28 16:33</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; For clarity, I'm removing 3.9 from the affected versions. This version 
&gt; does not support Windows 7, and only Windows 7 is vulnerable to this
&gt; DLL hijack.

I added 3.9 for the related issue to switch to using a static import, since Windows 7 isn't supported in 3.9. But I guess that should have been made a separate issue, or added to the omnibus issue <a class="open" title="[open] Drop support of Windows Vista and Windows 7" href="issue32592">bpo-32592</a>.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360933" id="msg360933">msg360933</a> - <a
    href="msg360933">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-29 02:30</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>This is now assigned CVE-2020-8315 (<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8315">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-8315</a> <a href="https://nvd.nist.gov/vuln/detail/CVE-2020-8315">https://nvd.nist.gov/vuln/detail/CVE-2020-8315</a>)

Thanks Anthony for the report! I included your name as the reporter, though I don't see it on any of the pages.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360935" id="msg360935">msg360935</a> - <a
    href="msg360935">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-29 02:46</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/6a65eba44bfd82ccc8bed4b5c6dd6637549955d5">6a65eba44bfd82ccc8bed4b5c6dd6637549955d5</a> by Steve Dower in branch 'master':
<a class="closed" title="[closed] [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7" href="issue39401">bpo-39401</a>: Avoid unsafe DLL load on Windows 7 and earlier (<a href="https://github.com/python/cpython/pull/18231" class="closed" title="GitHub PR 18231: [merged] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier">GH-18231</a>)
<a href="https://github.com/python/cpython/commit/6a65eba44bfd82ccc8bed4b5c6dd6637549955d5">https://github.com/python/cpython/commit/6a65eba44bfd82ccc8bed4b5c6dd6637549955d5</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360946" id="msg360946">msg360946</a> - <a
    href="msg360946">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-29 10:23</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>I added <a href="https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html">https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html</a> to track fixes in all branches.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360994" id="msg360994">msg360994</a> - <a
    href="msg360994">(view)</a></th>
   <th>Author: Jeremy Kloth (jkloth) <span title="Contributor form received">*</span></th>
   <th>Date: 2020-01-29 23:30</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>As noted on the PR landing page, this PR has caused failures of 2 buildbots:

<a href="https://buildbot.python.org/all/#builders/81/builds/272">https://buildbot.python.org/all/#builders/81/builds/272</a>

<a href="https://buildbot.python.org/all/#builders/150/builds/227">https://buildbot.python.org/all/#builders/150/builds/227</a>

(both are Windows 7)</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360997" id="msg360997">msg360997</a> - <a
    href="msg360997">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-30 00:41</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Both of those buildbots should be retired (or repurposed for versions of Python that still support Windows 7) :)</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360998" id="msg360998">msg360998</a> - <a
    href="msg360998">(view)</a></th>
   <th>Author: Eryk Sun (eryksun) <span title="Contributor form received">*</span> <img src="@@file/triager.png" title="Python triager" alt="(Python triager)" /></th>
   <th>Date: 2020-01-30 00:41</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; this PR has caused failures of 2 buildbots

The master branch should no longer get built on Windows 7 machines. The initial build succeeds, but running "_freeze_importlib[_d].exe" fails with STATUS_DLL_NOT_FOUND (0xC0000135, i.e. -1073741515) since "api-ms-win-core-path-l1-1-0.dll" (linked from pathcch.lib) is not a Windows 7 API set.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg360999" id="msg360999">msg360999</a> - <a
    href="msg360999">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-30 00:42</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; I added <a href="https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html">https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html</a> to track fixes in all branches.

Thanks, Victor!

Python 2.7 and 3.5 are not vulnerable. The issue was added in 3.6 when I added support for installing Python into a long path name on up-to-date OS, which required dynamically loading an OS function. That dynamic load was the problem.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg361013" id="msg361013">msg361013</a> - <a
    href="msg361013">(view)</a></th>
   <th>Author: miss-islington (miss-islington)</th>
   <th>Date: 2020-01-30 06:07</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/561c59777c8426fde0ef48b57cf02eddaeb2a5b8">561c59777c8426fde0ef48b57cf02eddaeb2a5b8</a> by Steve Dower in branch '3.7':
[3.7] <a class="closed" title="[closed] [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7" href="issue39401">bpo-39401</a>: Avoid unsafe DLL load on Windows 7 and earlier (<a href="https://github.com/python/cpython/pull/18231" class="closed" title="GitHub PR 18231: [merged] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier">GH-18231</a>) (<a href="https://github.com/python/cpython/pull/18232" class="closed" title="GitHub PR 18232: [merged] [3.7] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">GH-18232</a>)
<a href="https://github.com/python/cpython/commit/561c59777c8426fde0ef48b57cf02eddaeb2a5b8">https://github.com/python/cpython/commit/561c59777c8426fde0ef48b57cf02eddaeb2a5b8</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg361014" id="msg361014">msg361014</a> - <a
    href="msg361014">(view)</a></th>
   <th>Author: miss-islington (miss-islington)</th>
   <th>Date: 2020-01-30 06:18</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/ad4a20b87d79a619ffbdea3f26848780899494e5">ad4a20b87d79a619ffbdea3f26848780899494e5</a> by Steve Dower in branch '3.8':
[3.8] <a class="closed" title="[closed] [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7" href="issue39401">bpo-39401</a>: Avoid unsafe DLL load on Windows 7 and earlier (<a href="https://github.com/python/cpython/pull/18231" class="closed" title="GitHub PR 18231: [merged] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier">GH-18231</a>) (<a href="https://github.com/python/cpython/pull/18234" class="closed" title="GitHub PR 18234: [merged] [3.8] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">GH-18234</a>)
<a href="https://github.com/python/cpython/commit/ad4a20b87d79a619ffbdea3f26848780899494e5">https://github.com/python/cpython/commit/ad4a20b87d79a619ffbdea3f26848780899494e5</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg361022" id="msg361022">msg361022</a> - <a
    href="msg361022">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-30 08:28</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt;&gt; I added <a href="https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html">https://python-security.readthedocs.io/vuln/unsafe-dll-load-windows-7.html</a> to track fixes in all branches.

&gt; Thanks, Victor! Python 2.7 and 3.5 are not vulnerable. The issue was added in 3.6 when I added support for installing Python into a long path name on up-to-date OS, which required dynamically loading an OS function. That dynamic load was the problem.

Oh ok, I updated the page to reflect that. I also added 3.7 &amp; 3.8 commits.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg361038" id="msg361038">msg361038</a> - <a
    href="msg361038">(view)</a></th>
   <th>Author: Anthony Wee (anthonywee) <span title="Contributor form received">*</span></th>
   <th>Date: 2020-01-30 11:05</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; Thanks Anthony for the report! I included your name as the reporter, though I don't see it on any of the pages.

No problem! Thanks Steve, Eryk, and Victor for jumping on this!</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg361088" id="msg361088">msg361088</a> - <a
    href="msg361088">(view)</a></th>
   <th>Author: Ned Deily (ned.deily) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2020-01-31 02:12</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/51332c467ed2e07a191f903d554d0c54248e4d88">51332c467ed2e07a191f903d554d0c54248e4d88</a> by Steve Dower in branch '3.6':
[3.6] <a class="closed" title="[closed] [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7" href="issue39401">bpo-39401</a>: Avoid unsafe DLL load on Windows 7 and earlier (<a href="https://github.com/python/cpython/pull/18231" class="closed" title="GitHub PR 18231: [merged] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier">GH-18231</a>) (<a href="https://github.com/python/cpython/pull/18233" class="closed" title="GitHub PR 18233: [merged] [3.6] bpo-39401: Avoid unsafe DLL load on Windows 7 and earlier (GH-18231)">GH-18233</a>)
<a href="https://github.com/python/cpython/commit/51332c467ed2e07a191f903d554d0c54248e4d88">https://github.com/python/cpython/commit/51332c467ed2e07a191f903d554d0c54248e4d88</a>
</pre>
   </td>
  </tr>
 
</table>

<table class="history table table-condensed table-striped"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2020-01-31&nbsp;02:14:13</td><td>ned.deily</td><td>set</td><td>priority: deferred blocker -> <br />status: open -> closed<br />resolution: fixed<br />stage: patch review -> resolved</td></tr>
<tr><td>2020-01-31&nbsp;02:12:27</td><td>ned.deily</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg361088">msg361088</a></td></tr>
<tr><td>2020-01-30&nbsp;11:05:05</td><td>anthonywee</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg361038">msg361038</a></td></tr>
<tr><td>2020-01-30&nbsp;08:28:35</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg361022">msg361022</a></td></tr>
<tr><td>2020-01-30&nbsp;06:18:33</td><td>miss-islington</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg361014">msg361014</a></td></tr>
<tr><td>2020-01-30&nbsp;06:07:21</td><td>miss-islington</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user27838">miss-islington</a><br />messages:
  + <a rel="nofollow" href="msg361013">msg361013</a><br /></td></tr>
<tr><td>2020-01-30&nbsp;00:42:41</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360999">msg360999</a></td></tr>
<tr><td>2020-01-30&nbsp;00:41:47</td><td>eryksun</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360998">msg360998</a></td></tr>
<tr><td>2020-01-30&nbsp;00:41:07</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360997">msg360997</a></td></tr>
<tr><td>2020-01-29&nbsp;23:30:26</td><td>jkloth</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user4624">jkloth</a><br />messages:
  + <a rel="nofollow" href="msg360994">msg360994</a><br /></td></tr>
<tr><td>2020-01-29&nbsp;10:23:47</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360946">msg360946</a></td></tr>
<tr><td>2020-01-29&nbsp;02:46:39</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360935">msg360935</a></td></tr>
<tr><td>2020-01-29&nbsp;02:30:16</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360933">msg360933</a><br />title: Unsafe dll loading in getpathp.c on Win7 -> [CVE-2020-8315] Unsafe dll loading in getpathp.c on Win7</td></tr>
<tr><td>2020-01-28&nbsp;17:41:47</td><td>vstinner</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user2377">vstinner</a><br /></td></tr>
<tr><td>2020-01-28&nbsp;16:33:36</td><td>eryksun</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360882">msg360882</a></td></tr>
<tr><td>2020-01-28&nbsp;10:18:01</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360858">msg360858</a><br />versions:
  - Python 3.9</td></tr>
<tr><td>2020-01-28&nbsp;10:06:21</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request17614">pull_request17614</a></td></tr>
<tr><td>2020-01-28&nbsp;10:05:38</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request17613">pull_request17613</a></td></tr>
<tr><td>2020-01-28&nbsp;10:02:29</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request17612">pull_request17612</a></td></tr>
<tr><td>2020-01-28&nbsp;09:57:36</td><td>steve.dower</td><td>set</td><td>keywords:
  + <a rel="nofollow" href="keyword2">patch</a><br />stage: needs patch -> patch review<br />pull_requests:
  + <a rel="nofollow" href="pull_request17611">pull_request17611</a></td></tr>
<tr><td>2020-01-28&nbsp;09:44:52</td><td>steve.dower</td><td>set</td><td>assignee: <a rel="nofollow" href="user16632">steve.dower</a></td></tr>
<tr><td>2020-01-23&nbsp;03:39:19</td><td>ned.deily</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user5248">ned.deily</a><br /></td></tr>
<tr><td>2020-01-23&nbsp;03:37:19</td><td>ned.deily</td><td>set</td><td>priority: normal -> deferred blocker</td></tr>
<tr><td>2020-01-23&nbsp;01:56:01</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg360529">msg360529</a></td></tr>
<tr><td>2020-01-21&nbsp;04:34:55</td><td>eryksun</td><td>set</td><td>type: security<br />components:
  + Windows<br />versions:
  + Python 3.6, Python 3.7, Python 3.8, Python 3.9<br />nosy:
  + <a rel="nofollow" href="user301">paul.moore</a>, <a rel="nofollow" href="user16413">eryksun</a>, <a rel="nofollow" href="user3951">tim.golden</a>, <a rel="nofollow" href="user15467">zach.ware</a>, <a rel="nofollow" href="user16632">steve.dower</a><br /><br />messages:
  + <a rel="nofollow" href="msg360350">msg360350</a><br />stage: needs patch</td></tr>
<tr><td>2020-01-21&nbsp;01:02:15</td><td>anthonywee</td><td>create</td><td></td></tr>
</table>

</div>


</div> <!-- content-body -->
<div id="footer">
<div id="credits">
  Hosted on <a href="https://m.do.co/c/783434964889" title="Hosted on DigitalOcean">DigitalOcean</a>,
  <br>
  Supported by <a href="https://python.org/psf-landing/" title="The Python Software Foundation">The Python Software Foundation</a>,
  <br>
  Powered by <a href="http://roundup.sourceforge.net" title="Powered by the Roundup Issue Tracker">Roundup</a>
</div> <!-- credits -->
Copyright &copy; 1990-2020, <a href="http://python.org/psf">Python Software Foundation</a><br />
<a href="http://python.org/about/legal">Legal Statements</a>
</div> <!-- footer -->
</div> <!-- body-main -->
</div> <!-- content -->



</body>
</html>

