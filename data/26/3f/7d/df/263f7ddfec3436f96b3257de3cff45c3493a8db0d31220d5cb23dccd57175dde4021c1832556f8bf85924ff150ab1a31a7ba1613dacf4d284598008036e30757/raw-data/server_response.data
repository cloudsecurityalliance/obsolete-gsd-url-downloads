<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 600741 – "read_channel_data()" Integer Overflow Vulnerability</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=600741&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=600741" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 600741 – \"read_channel_data()\" Integer Overflow Vulnerability",  
                             "show_bug.cgi?id=600741" );
        document.title = "Bug 600741 – \"read_channel_data()\" Integer Overflow Vulnerability";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 600741 – \"read_channel_data()\" Integer Overflow Vulnerability", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_GIMP bz_component_Plugins bz_bug_600741 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 600741</p>
</td>
<td id="subtitle">
<p class="subheader">"read_channel_data()" Integer Overflow Vulnerability</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2015-11-29 12:50:31 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2015-11-29 12:50:31"/>
<input name="longdesclength" type="hidden" value="14"/>
<input name="id" type="hidden" value="600741"/>
<input name="token" type="hidden" value="1626083556-Aat6igEYYigz-qsd7C-pQUNL7atLo5eFyb99aqPp5yc"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=600741"><b>Bug 600741</b></a> -<span class="bz_default_hidden" id="summary_alias_container">
<span id="short_desc_nonedit_display">"read_channel_data()" Integer Overflow Vulnerability</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">
</td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>"read_channel_data()" Integer Overflow Vulnerability
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('\"read_channel_data()\" Integer Overflow Vulnerability', '');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">GIMP</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Other</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=GIMP" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">Plugins</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>2.6.7
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       All
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       major
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>2.6
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard"><span class="fn">GIMP Bugs</span>
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard"><span class="fn">GIMP Bugs</span>
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'bugs\x40gimp.org',
        'bugs\x40gimp.org');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2009-11-04 21:57 UTC by <span class="vcard"><span class="fn">Sven Neumann</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2015-11-29 12:50 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">---</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a1">
<td valign="top">
<a href="attachment.cgi?id=147344" title="View the content of the attachment">
<b><span class="bz_obsolete">start of a patch against int overflow issues in the PSD plugin</span></b></a>
<span class="bz_attach_extra_info">
              (4.32 KB,
                patch)

            <br/>
<a href="#attach_147344" title="Go to the comment associated with the attachment">2009-11-10 00:49 UTC</a>,

            <span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">needs-work
          </td>
<td valign="top">
<a href="attachment.cgi?id=147344&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147344">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a2">
<td valign="top">
<a href="attachment.cgi?id=147676" title="View the content of the attachment">
<b>My patch for this issue</b></a>
<span class="bz_attach_extra_info">
              (5.64 KB,
                patch)

            <br/>
<a href="#attach_147676" title="Go to the comment associated with the attachment">2009-11-13 16:24 UTC</a>,

            <span class="vcard"><span class="fn">Mukund Sivaraman</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=147676&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147676">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a3">
<td valign="top">
<a href="attachment.cgi?id=147749" title="View the content of the attachment">
<b><span class="bz_obsolete">Patch against int overflow issues in the PSD plugin</span></b></a>
<span class="bz_attach_extra_info">
              (5.48 KB,
                patch)

            <br/>
<a href="#attach_147749" title="Go to the comment associated with the attachment">2009-11-14 23:59 UTC</a>,

            <span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=147749&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147749">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a4">
<td valign="top">
<a href="attachment.cgi?id=147866" title="View the content of the attachment">
<b><span class="bz_obsolete">Use more defensive code for type boundary checks.</span></b></a>
<span class="bz_attach_extra_info">
              (1.22 KB,
                patch)

            <br/>
<a href="#attach_147866" title="Go to the comment associated with the attachment">2009-11-16 11:11 UTC</a>,

            <span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">needs-work
          </td>
<td valign="top">
<a href="attachment.cgi?id=147866&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147866">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a5">
<td valign="top">
<a href="attachment.cgi?id=147917" title="View the content of the attachment">
<b><span class="bz_obsolete">Use more defensive code for type boundary checks. Avoid division by zero.</span></b></a>
<span class="bz_attach_extra_info">
              (1.47 KB,
                patch)

            <br/>
<a href="#attach_147917" title="Go to the comment associated with the attachment">2009-11-16 17:46 UTC</a>,

            <span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=147917&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147917">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a6">
<td valign="top">
<a href="attachment.cgi?id=147944" title="View the content of the attachment">
<b>Patch against the int overflow issue in the psd plugin</b></a>
<span class="bz_attach_extra_info">
              (5.93 KB,
                patch)

            <br/>
<a href="#attach_147944" title="Go to the comment associated with the attachment">2009-11-17 00:55 UTC</a>,

            <span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">reviewed
          </td>
<td valign="top">
<a href="attachment.cgi?id=147944&amp;action=edit">Details</a>  |
    <a href="review?bug=600741&amp;attachment=147944">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Sven Neumann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-04 21:57:03 UTC
        </span>
</div>
<pre class="bz_comment_text">Secunia Research has discovered a vulnerability in Gimp, which
potentially can be exploited by malicious people to compromise a user's
system.

The vulnerability is caused due to an integer overflow within the
"read_channel_data()" function in plug-ins/file-psd/psd-load.c
(confirmed in line 1764. Note that there are further calculations in
e.g. line 1803, 1808, and 1813). This can be exploited to cause a
heap-based buffer overflow by e.g. tricking a user into opening a
specially crafted PSD file.

Secunia Research has created a PoC, which is available upon request.

The vulnerability is confirmed in version 2.6.7. Other versions may also
be affected.

We have assigned this vulnerability Secunia advisory SA37232 and CVE
identifier CVE-2009-1570, which will be shared with the BMP integer
overflow reported to Sven Neumann on Monday. If you prefer a separate
CVE identifier, we can assign a new one.

A preliminary disclosure date of 25-11-2009 10am CET has been set,
where the details will be publicly disclosed. However, we are naturally
prepared to push the disclosure date if you need more time to address
the vulnerability.

Please acknowledge receiving this e-mail and let us know when you
expect to fix the vulnerability.

Additionally, we would like to be able to follow the bug report
regarding the BMP integer overflow.

Credits should go to:
Stefan Cornelius, Secunia Research</pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-10 00:49:30 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=147344" name="attach_147344" title="start of a patch against int overflow issues in the PSD plugin">attachment 147344</a> <a href="attachment.cgi?id=147344&amp;action=edit" title="start of a patch against int overflow issues in the PSD plugin">[details]</a></span> <a href="review?bug=600741&amp;attachment=147344">[review]</a>
start of a patch against int overflow issues in the PSD plugin

Ok, this is the start of a patch against int overflow issues in the PSD loader.

This is quite nasty code and I have trouble tracing back the variables. There are two #warnings in the patch that show potential problems not yet addressed.</pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Sven Neumann</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-10 01:41:09 UTC
        </span>
</div>
<pre class="bz_comment_text">+#warning what can happen here?
                   pixels = g_malloc (layer_size);

Well, the plug-in can exit with an out-of-memory error. Or the OS may decide to grant the plug-in the memory it asks for, which may put quite a bit of load on the system. But I don't think we have a chance to catch this in a reasonable way.</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-10 01:46:23 UTC
        </span>
</div>
<pre class="bz_comment_text">Note that the layer_size is a guint32, and gets computed by layer_size = lm_w * lm_h. So there is another potential overflow issue there, later the memory gets written by two nested loops.

The warning really is just a reminder for me to check this issue, I need to trace back where the numbers lm_w and lm_h come from and if they are checked against int overflow already.</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Martin Nordholts</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-10 07:08:24 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=147344" name="attach_147344" title="start of a patch against int overflow issues in the PSD plugin">attachment 147344</a> <a href="attachment.cgi?id=147344&amp;action=edit" title="start of a patch against int overflow issues in the PSD plugin">[details]</a></span> <a href="review?bug=600741&amp;attachment=147344">[review]</a>:

Thanks a lot for looking into this Simon. Setting to 'needs-work' to reflect your comments on the patch.</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Mukund Sivaraman</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-13 16:24:26 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=147676" name="attach_147676" title="My patch for this issue">attachment 147676</a> <a href="attachment.cgi?id=147676&amp;action=edit" title="My patch for this issue">[details]</a></span> <a href="review?bug=600741&amp;attachment=147676">[review]</a>
My patch for this issue

I'm on the security list too, and saw the email. This is a patch that I had written for the bug and was showing to others on IRC. Didn't know this bug existed for it :)</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-14 23:59:22 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=147749" name="attach_147749" title="Patch against int overflow issues in the PSD plugin">attachment 147749</a> <a href="attachment.cgi?id=147749&amp;action=edit" title="Patch against int overflow issues in the PSD plugin">[details]</a></span> <a href="review?bug=600741&amp;attachment=147749">[review]</a>
Patch against int overflow issues in the PSD plugin

Ok, here is an updated version of the patch and it is ready for commit from my side of things.

I don't have lots of PSD to check if they still load properly, it would be useful if someone could do some tests on that.</pre>
</div><div class="bz_comment" id="c7">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c7">Comment 7</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-16 10:48:48 UTC
        </span>
</div>
<pre class="bz_comment_text">I haven't reviewed the whole PSD code, but the last hunk of the patch could potentially overflow the expression type (gint64) if channel-&gt;rows, channel-&gt;columns and bps aren't guaranteed to be less than certain max values:

+
+  /* int overflow check */
+  if (((gint64) channel-&gt;rows) * channel-&gt;columns * MAX (bps &gt;&gt; 3, 1) &gt; G_MAXINT32)
+    {
+      g_set_error (error, G_FILE_ERROR, G_FILE_ERROR_FAILED,
+                   _("Unsupported or invalid channel size"));
+      return -1;
+    }
+

E.g. if both rows and columns were G_MAXUINT32 (0xFFFFFFFF) and bps were 16, the expression would evaluate to 0x1fffffffc00000002 which is still an order of magnitude greater than G_MAXUINT64, i.e. it would overflow. While the other comparisons in the patch look safe to me (even though they use multiplication), I'd still suggest using divisions as a defensive measure because they cannot overflow (and get by without casts to larger types -- useful if you have to check numbers of the largest type available), e.g. replace the above comparison with:

if (channel-&gt;rows &gt; G_MAXINT32 / channel-&gt;columns / MAX (bps &gt;&gt; 3, 1))
    ...</pre>
</div><div class="bz_comment" id="c8">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c8">Comment 8</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-16 11:11:00 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=147866" name="attach_147866" title="Use more defensive code for type boundary checks.">attachment 147866</a> <a href="attachment.cgi?id=147866&amp;action=edit" title="Use more defensive code for type boundary checks.">[details]</a></span> <a href="review?bug=600741&amp;attachment=147866">[review]</a>
Use more defensive code for type boundary checks.

This uses divisions (which cannot overflow) for type boundary checks. Apply on top of Simon's patch (<span class="bz_obsolete"><a href="attachment.cgi?id=147749" name="attach_147749" title="Patch against int overflow issues in the PSD plugin">attachment #147749</a> <a href="attachment.cgi?id=147749&amp;action=edit" title="Patch against int overflow issues in the PSD plugin">[details]</a></span>).</pre>
</div><div class="bz_comment" id="c9">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c9">Comment 9</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-16 17:44:03 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=147866" name="attach_147866" title="Use more defensive code for type boundary checks.">attachment 147866</a> <a href="attachment.cgi?id=147866&amp;action=edit" title="Use more defensive code for type boundary checks.">[details]</a></span> <a href="review?bug=600741&amp;attachment=147866">[review]</a>:

Doesn't completely avoid dividing by zero.</pre>
</div><div class="bz_comment" id="c10">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c10">Comment 10</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-16 17:46:43 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=147917" name="attach_147917" title="Use more defensive code for type boundary checks. Avoid division by zero.">attachment 147917</a> <a href="attachment.cgi?id=147917&amp;action=edit" title="Use more defensive code for type boundary checks. Avoid division by zero.">[details]</a></span> <a href="review?bug=600741&amp;attachment=147917">[review]</a>
Use more defensive code for type boundary checks. Avoid division by zero.

This uses divisions (which cannot overflow) for type boundary checks. It now even avoids dividing by zero and documents where this is already done by existing sanity checks.

Apply on top of Simon's patch (<span class="bz_obsolete"><a href="attachment.cgi?id=147749" name="attach_147749" title="Patch against int overflow issues in the PSD plugin">attachment #147749</a> <a href="attachment.cgi?id=147749&amp;action=edit" title="Patch against int overflow issues in the PSD plugin">[details]</a></span>).</pre>
</div><div class="bz_comment" id="c11">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c11">Comment 11</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-17 00:55:44 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=147944" name="attach_147944" title="Patch against the int overflow issue in the psd plugin">attachment 147944</a> <a href="attachment.cgi?id=147944&amp;action=edit" title="Patch against the int overflow issue in the psd plugin">[details]</a></span> <a href="review?bug=600741&amp;attachment=147944">[review]</a>
Patch against the int overflow issue in the psd plugin

This patch is a new version for the int overflow problem.

This incorporates the "division" approach for the checks by Nils and also adds a few more sanity checks (it right now barfs on channel data with -&gt;rows or -&gt;columns = 0. if there are PSDs in the wild that have this rather weird property the code is unlikely to do the right thing there).

Note that this patch might refuse to load images when not also using commit  0e440cb6d4d6ee029667363d244aff61b154c33c (already in master and gimp-2-6), which corrects the signedness of the top/bottom/left/right bbox coordinates in the PSD structs.</pre>
</div><div class="bz_comment" id="c12">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c12">Comment 12</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nils Philippsen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-17 09:56:34 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=147944" name="attach_147944" title="Patch against the int overflow issue in the psd plugin">attachment 147944</a> <a href="attachment.cgi?id=147944&amp;action=edit" title="Patch against the int overflow issue in the psd plugin">[details]</a></span> <a href="review?bug=600741&amp;attachment=147944">[review]</a>:

The CVE identifier is CVE-2009-3909 (-1570 is a separate one for the BMP issue). Otherwise the patch looks good to me.</pre>
</div><div class="bz_comment" id="c13">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=600741#c13">Comment 13</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Simon Budig</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2009-11-17 10:19:24 UTC
        </span>
</div>
<pre class="bz_comment_text">Fixed in both master and gimp-2-6:

commit <a href="https://git.gnome.org/browse/GIMP/commit/?id=9cc8d78ff33b7a36852b74e64b427489cad44d0e">9cc8d78ff33b7a36852b74e64b427489cad44d0e</a>
Author: Simon Budig &lt;<a href="mailto:simon@gimp.org">simon@gimp.org</a>&gt;
Date:   Tue Nov 17 00:41:39 2009 +0100

    Harden the PSD plugin against integer overflows.
    
    Issues discovered by Stefan Cornelius, Secunia Research, advisory SA37232
    and CVE identifier CVE-2009-3909. Fixes <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=600741" title='RESOLVED FIXED - "read_channel_data()" Integer Overflow Vulnerability'>bug #600741</a>.</pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=GIMP">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=600741&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=600741" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=600741&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626083557-nwDXchRdazyzPfNqswH0OdQFaQsgXJhp2AjMbZKnnOs"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>