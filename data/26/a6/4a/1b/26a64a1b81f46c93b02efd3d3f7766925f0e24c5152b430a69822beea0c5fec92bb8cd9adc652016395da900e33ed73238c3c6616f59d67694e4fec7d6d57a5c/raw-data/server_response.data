<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    
        <link rel='alternate' type='application/rss+xml' title='Filesystem function related Bug #79099 - RDF' href='rss/bug.php?id=79099'>
        <link rel='alternate' type='application/rss+xml' title='Filesystem function related Bug #79099 - RSS 2.0' href='rss/bug.php?id=79099&format=rss2'>
        <base href="https://bugs.php.net/">
    <title>PHP :: Sec Bug #79099 :: OOB read in php_strip_tags_ex</title>
    <link rel="shortcut icon" href="https://bugs.php.net/images/favicon.ico">
    <link rel="stylesheet" href="https://bugs.php.net/css/style.css">
</head>

<body>

<table id="top" class="head" cellspacing="0" cellpadding="0">
    <tr>
        <td class="head-logo">
            <a href="/"><img src="images/logo.png" alt="Bugs" vspace="2" hspace="2"></a>
        </td>

        <td class="head-menu">
            <a href="https://php.net/">php.net</a>&nbsp;|&nbsp;
            <a href="https://php.net/support.php">support</a>&nbsp;|&nbsp;
            <a href="https://php.net/docs.php">documentation</a>&nbsp;|&nbsp;
            <a href="report.php">report a bug</a>&nbsp;|&nbsp;
            <a href="search.php">advanced search</a>&nbsp;|&nbsp;
            <a href="search-howto.php">search howto</a>&nbsp;|&nbsp;
            <a href="stats.php">statistics</a>&nbsp;|&nbsp;
            <a href="random">random bug</a>&nbsp;|&nbsp;
            <a href="login.php">login</a>
        </td>
    </tr>

    <tr>
        <td class="head-search" colspan="2">
            <form method="get" action="search.php">
                <p class="head-search">
                    <input type="hidden" name="cmd" value="display">
                    <small>go to bug id or search bugs for</small>
                    <input class="small" type="text" name="search_for" value="" size="30">
                    <input type="image" src="images/small_submit_white.gif" alt="search" style="vertical-align: middle;">
                </p>
            </form>
        </td>
    </tr>
</table>

<table class="middle" cellspacing="0" cellpadding="0">
    <tr>
        <td class="content">
<div id="bugheader">
    <table id="details">
        <tr id="title">
            <th class="details" id="number"><a href="bug.php?id=79099">Sec Bug</a>&nbsp;#79099</th>
            <td id="summary" colspan="5">OOB read in php_strip_tags_ex</td>
        </tr>
        <tr id="submission">
            <th class="details">Submitted:</th>
            <td style="white-space: nowrap;">2020-01-11 07:02 UTC</td>
            <th class="details">Modified:</th>
            <td style="white-space: nowrap;">2020-01-21 07:15 UTC</td>
            <td rowspan="6">


            </td>
        </tr>

        <tr id="submitter">
            <th class="details">From:</th>
            <td>wxhusst &#x61;&#116; gmail &#x64;&#111;&#x74; com</td>
            <th class="details">Assigned:</th>
            <td><a href="search.php?cmd=display&amp;assign=stas">stas</a> (<a href="https://people.php.net/stas">profile</a>)</td>
        </tr>

        <tr id="categorization">
            <th class="details">Status:</th>
            <td>Closed</td>
            <th class="details">Package:</th>
            <td><a href="search.php?cmd=display&amp;package_name[]=Filesystem+function+related">Filesystem function related</a></td>
        </tr>

        <tr id="situation">
            <th class="details">PHP Version:</th>
            <td>7.2.26</td>
            <th class="details">OS:</th>
            <td>*</td>
        </tr>

        <tr id="private">
            <th class="details">Private report:</th>
            <td>No</td>
            <th class="details">CVE-ID:</th>
            <td><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7059 	" target="_blank">2020-7059 	</a></td>
        </tr>
    </table>
</div>

<div class="controls">
<span id='control_0' class='control active'>View</span>
<span id='control_3' class='control'><a href='bug.php?id=79099&amp;edit=3'>Add Comment</a></span>
<span id='control_1' class='control'><a href='bug.php?id=79099&amp;edit=1'>Developer</a></span>
<span id='control_2' class='control'><a href='bug.php?id=79099&amp;edit=2'>Edit</a></span>
</div>
<div class="clear"></div>



<div class='comment type_comment' ><a name="1578726133">&nbsp;</a><strong>[2020-01-11 07:02 UTC] wxhusst &#x61;&#116; gmail &#x64;&#111;&#x74; com</strong>
<pre class='note'>Description:
------------
sorry. I think this bug is difficult. 
I want to reduce the code of explian,  But it can't crash.

Maybe you could know why

first export USE_ZEND_ALLOC=0

then php -f file.php

=================================================================
==6268==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000005d8f at pc 0x000002b3333a bp 0x7ffe57b54b50 sp 0x7ffe57b54b48
READ of size 1 at 0x602000005d8f thread T0
    #0 0x2b33339 in php_strip_tags_ex /home/raven/fuzz/php-src-php-7.4.1/ext/standard/string.c:5383:8
    #1 0x2b3ed07 in php_strip_tags /home/raven/fuzz/php-src-php-7.4.1/ext/standard/string.c:5146:9
    #2 0x2842a9d in zif_fgetss /home/raven/fuzz/php-src-php-7.4.1/ext/standard/file.c:1137:15
    #3 0x354a4d8 in zend_call_function /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_execute_API.c:824:4
    #4 0x239971a in spl_filesystem_file_call /home/raven/fuzz/php-src-php-7.4.1/ext/spl/spl_directory.c:2102:11
    #5 0x239fcea in zim_spl_SplFileObject_fgetss /home/raven/fuzz/php-src-php-7.4.1/ext/spl/spl_directory.c:2863:2
    #6 0x3fe5c26 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:1617:4
    #7 0x3c03f76 in execute_ex /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:53379:7
    #8 0x3c0513f in zend_execute /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:57664:2
    #9 0x36b4324 in zend_execute_scripts /home/raven/fuzz/php-src-php-7.4.1/Zend/zend.c:1663:4
    #10 0x2fa0ab1 in php_execute_script /home/raven/fuzz/php-src-php-7.4.1/main/main.c:2619:14
    #11 0x4626bc7 in do_cli /home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php_cli.c:961:5
    #12 0x4621885 in main /home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php_cli.c:1352:18
    #13 0x7f2d114501e2 in __libc_start_main /build/glibc-4WA41p/glibc-2.30/csu/../csu/libc-start.c:308:16
    #14 0x60297d in _start (/home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php+0x60297d)

0x602000005d8f is located 1 bytes to the left of 16-byte region [0x602000005d90,0x602000005da0)
allocated by thread T0 here:
    #0 0x67a87d in malloc (/home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php+0x67a87d)
    #1 0x33698f4 in __zend_malloc /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_alloc.c:2975:14
    #2 0x3367b4e in _malloc_custom /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_alloc.c:2416:10
    #3 0x3367447 in _emalloc /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_alloc.c:2535:10
    #4 0x336a28d in _estrndup /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_alloc.c:2633:15
    #5 0x2b302cc in php_strip_tags_ex /home/raven/fuzz/php-src-php-7.4.1/ext/standard/string.c:5180:8
    #6 0x2b3ed07 in php_strip_tags /home/raven/fuzz/php-src-php-7.4.1/ext/standard/string.c:5146:9
    #7 0x2842a9d in zif_fgetss /home/raven/fuzz/php-src-php-7.4.1/ext/standard/file.c:1137:15
    #8 0x354a4d8 in zend_call_function /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_execute_API.c:824:4
    #9 0x239971a in spl_filesystem_file_call /home/raven/fuzz/php-src-php-7.4.1/ext/spl/spl_directory.c:2102:11
    #10 0x239fcea in zim_spl_SplFileObject_fgetss /home/raven/fuzz/php-src-php-7.4.1/ext/spl/spl_directory.c:2863:2
    #11 0x3fe5c26 in ZEND_DO_FCALL_SPEC_RETVAL_UNUSED_HANDLER /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:1617:4
    #12 0x3c03f76 in execute_ex /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:53379:7
    #13 0x3c0513f in zend_execute /home/raven/fuzz/php-src-php-7.4.1/Zend/zend_vm_execute.h:57664:2
    #14 0x36b4324 in zend_execute_scripts /home/raven/fuzz/php-src-php-7.4.1/Zend/zend.c:1663:4
    #15 0x2fa0ab1 in php_execute_script /home/raven/fuzz/php-src-php-7.4.1/main/main.c:2619:14
    #16 0x4626bc7 in do_cli /home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php_cli.c:961:5
    #17 0x4621885 in main /home/raven/fuzz/php-src-php-7.4.1/sapi/cli/php_cli.c:1352:18
    #18 0x7f2d114501e2 in __libc_start_main /build/glibc-4WA41p/glibc-2.30/csu/../csu/libc-start.c:308:16

SUMMARY: AddressSanitizer: heap-buffer-overflow /home/raven/fuzz/php-src-php-7.4.1/ext/standard/string.c:5383:8 in php_strip_tags_ex
Shadow bytes around the buggy address:
  0x0c047fff8b60: fa fa 00 06 fa fa 00 04 fa fa 00 02 fa fa 00 00
  0x0c047fff8b70: fa fa 04 fa fa fa 05 fa fa fa 00 02 fa fa 00 03
  0x0c047fff8b80: fa fa 00 07 fa fa 00 01 fa fa 00 00 fa fa fd fa
  0x0c047fff8b90: fa fa 02 fa fa fa 00 03 fa fa 00 03 fa fa 00 03
  0x0c047fff8ba0: fa fa 02 fa fa fa 01 fa fa fa fd fd fa fa fd fa
=&gt;0x0c047fff8bb0: fa[fa]00 00 fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c047fff8bc0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c047fff8bd0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c047fff8be0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c047fff8bf0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
  0x0c047fff8c00: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07 
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
  Shadow gap:              cc
==6268==ABORTING

Test script:
---------------
&lt;?php

// $ref_bool = true;
// $ref_int = 0;
// $ref_string = &quot;a&quot;;
// $ref_array = array(0);
// $ref_object = new StdClass();
// $ref_resource = fopen(&quot;/dev/null&quot;, &quot;r&quot;);

function templateFunction($templateParameter) {
	return 0;
}

function templateGenerator() {
	yield 0;
}

class TemplateClass {
	var $templateProperty;
	const TEMPLATE_CONSTANT = 0;
	function templateMethod() {
		return 0;
	}
}

$p = new Phar(&quot;/tmp/fuzz.phar&quot;);
$p[&quot;fuzz.txt&quot;] = &quot;fuzz&quot;;

$vars = array(
	&quot;stdClass&quot;                       =&gt; new stdClass(),
	&quot;Exception&quot;                      =&gt; new Exception(),
	&quot;ErrorException&quot;                 =&gt; new ErrorException(),
	&quot;Error&quot;                          =&gt; new Error(),
	&quot;CompileError&quot;                   =&gt; new CompileError(),
	&quot;ParseError&quot;                     =&gt; new ParseError(),
	&quot;TypeError&quot;                      =&gt; new TypeError(),
	&quot;ArgumentCountError&quot;             =&gt; new ArgumentCountError(),
	&quot;ArithmeticError&quot;                =&gt; new ArithmeticError(),
	&quot;DivisionByZeroError&quot;            =&gt; new DivisionByZeroError(),
//	&quot;Closure&quot;                        =&gt; new Closure(),
//	&quot;Generator&quot;                      =&gt; new Generator(),
	&quot;ClosedGeneratorException&quot;       =&gt; new ClosedGeneratorException(),
	&quot;DateTime&quot;                       =&gt; new DateTime(),
	&quot;DateTimeImmutable&quot;              =&gt; new DateTimeImmutable(),
	&quot;DateTimeZone&quot;                   =&gt; new DateTimeZone(&quot;America/Chicago&quot;),
	&quot;DateInterval&quot;                   =&gt; new DateInterval(&quot;P2Y4DT6H8M&quot;),
	&quot;DatePeriod&quot;                     =&gt; new DatePeriod(&quot;R4/2012-07-01T00:00:00Z/P7D&quot;),
	&quot;LibXMLError&quot;                    =&gt; new LibXMLError(),
	&quot;DOMException&quot;                   =&gt; new DOMException(),
	&quot;DOMStringList&quot;                  =&gt; new DOMStringList(),
	&quot;DOMNameList&quot;                    =&gt; new DOMNameList(),
	&quot;DOMImplementationList&quot;          =&gt; new DOMImplementationList(),
	&quot;DOMImplementationSource&quot;        =&gt; new DOMImplementationSource(),
	&quot;DOMImplementation&quot;              =&gt; new DOMImplementation(),
	&quot;DOMNode&quot;                        =&gt; new DOMNode(),
	&quot;DOMNameSpaceNode&quot;               =&gt; new DOMNameSpaceNode(),
	&quot;DOMDocumentFragment&quot;            =&gt; new DOMDocumentFragment(),
	&quot;DOMDocument&quot;                    =&gt; new DOMDocument(),
	&quot;DOMNodeList&quot;                    =&gt; new DOMNodeList(),
	&quot;DOMNamedNodeMap&quot;                =&gt; new DOMNamedNodeMap(),
	&quot;DOMCharacterData&quot;               =&gt; new DOMCharacterData(),
	&quot;DOMAttr&quot;                        =&gt; new DOMAttr(&quot;artr&quot;),
	&quot;DOMElement&quot;                     =&gt; new DOMElement(&quot;root&quot;),
	&quot;DOMText&quot;                        =&gt; new DOMText(),
	&quot;DOMComment&quot;                     =&gt; new DOMComment(),
	&quot;DOMTypeinfo&quot;                    =&gt; new DOMTypeinfo(),
	&quot;DOMUserDataHandler&quot;             =&gt; new DOMUserDataHandler(),
	&quot;DOMDomError&quot;                    =&gt; new DOMDomError(),
	&quot;DOMErrorHandler&quot;                =&gt; new DOMErrorHandler(),
	&quot;DOMLocator&quot;                     =&gt; new DOMLocator(),
	&quot;DOMConfiguration&quot;               =&gt; new DOMConfiguration(),
	&quot;DOMCdataSection&quot;                =&gt; new DOMCdataSection(&quot;root value&quot;),
	&quot;DOMDocumentType&quot;                =&gt; new DOMDocumentType(),
	&quot;DOMNotation&quot;                    =&gt; new DOMNotation(),
	&quot;DOMEntity&quot;                      =&gt; new DOMEntity(),
	&quot;DOMEntityReference&quot;             =&gt; new DOMEntityReference(&quot;nbsp&quot;),
	&quot;DOMProcessingInstruction&quot;       =&gt; new DOMProcessingInstruction(&quot;php&quot;),
	&quot;DOMStringExtend&quot;                =&gt; new DOMStringExtend(),
	&quot;DOMXPath&quot;                       =&gt; new DOMXPath(new DOMDocument()),
	&quot;finfo&quot;                          =&gt; new finfo(),
//	&quot;HashContext&quot;                    =&gt; new HashContext(),
	&quot;JsonException&quot;                  =&gt; new JsonException(),
	&quot;LogicException&quot;                 =&gt; new LogicException(),
	&quot;BadFunctionCallException&quot;       =&gt; new BadFunctionCallException(),
	&quot;BadMethodCallException&quot;         =&gt; new BadMethodCallException(),
	&quot;DomainException&quot;                =&gt; new DomainException(),
	&quot;InvalidArgumentException&quot;       =&gt; new InvalidArgumentException(),
	&quot;LengthException&quot;                =&gt; new LengthException(),
	&quot;OutOfRangeException&quot;            =&gt; new OutOfRangeException(),
	&quot;RuntimeException&quot;               =&gt; new RuntimeException(),
	&quot;OutOfBoundsException&quot;           =&gt; new OutOfBoundsException(),
	&quot;OverflowException&quot;              =&gt; new OverflowException(),
	&quot;RangeException&quot;                 =&gt; new RangeException(),
	&quot;UnderflowException&quot;             =&gt; new UnderflowException(),
	&quot;UnexpectedValueException&quot;       =&gt; new UnexpectedValueException(),
/*
	&quot;RecursiveIteratorIterator&quot;      =&gt; new RecursiveIteratorIterator(),
	&quot;IteratorIterator&quot;               =&gt; new IteratorIterator(),
	&quot;FilterIterator&quot;                 =&gt; new FilterIterator(),
	&quot;RecursiveFilterIterator&quot;        =&gt; new RecursiveFilterIterator(),
	&quot;CallbackFilterIterator&quot;         =&gt; new CallbackFilterIterator(),
	&quot;RecursiveCallbackFilterIterator&quot; =&gt; new RecursiveCallbackFilterIterator(),
	&quot;ParentIterator&quot;                 =&gt; new ParentIterator(),
	&quot;LimitIterator&quot;                  =&gt; new LimitIterator(),
	&quot;CachingIterator&quot;                =&gt; new CachingIterator(),
	&quot;RecursiveCachingIterator&quot;       =&gt; new RecursiveCachingIterator(),
	&quot;NoRewindIterator&quot;               =&gt; new NoRewindIterator(),
	&quot;AppendIterator&quot;                 =&gt; new AppendIterator(),
	&quot;InfiniteIterator&quot;               =&gt; new InfiniteIterator(),
	&quot;RegexIterator&quot;                  =&gt; new RegexIterator(),
	&quot;RecursiveRegexIterator&quot;         =&gt; new RecursiveRegexIterator(),
	&quot;EmptyIterator&quot;                  =&gt; new EmptyIterator(),
	&quot;RecursiveTreeIterator&quot;          =&gt; new RecursiveTreeIterator(),
	&quot;ArrayObject&quot;                    =&gt; new ArrayObject(),
	&quot;ArrayIterator&quot;                  =&gt; new ArrayIterator(),
	&quot;RecursiveArrayIterator&quot;         =&gt; new RecursiveArrayIterator(),
	&quot;SplFileInfo&quot;                    =&gt; new SplFileInfo(),
	&quot;DirectoryIterator&quot;              =&gt; new DirectoryIterator(),
	&quot;FilesystemIterator&quot;             =&gt; new FilesystemIterator(),
	&quot;RecursiveDirectoryIterator&quot;     =&gt; new RecursiveDirectoryIterator(),
	&quot;GlobIterator&quot;                   =&gt; new GlobIterator(),
*/
	&quot;SplFileObject&quot;                  =&gt; new SplFileObject(__FILE__),
	&quot;SplTempFileObject&quot;              =&gt; new SplTempFileObject(),
	&quot;SplDoublyLinkedList&quot;            =&gt; new SplDoublyLinkedList(),
	&quot;SplQueue&quot;                       =&gt; new SplQueue(),
	&quot;SplStack&quot;                       =&gt; new SplStack(),
//	&quot;SplHeap&quot;                        =&gt; new SplHeap(),
	&quot;SplMinHeap&quot;                     =&gt; new SplMinHeap(),
	&quot;SplMaxHeap&quot;                     =&gt; new SplMaxHeap(),
	&quot;SplPriorityQueue&quot;               =&gt; new SplPriorityQueue(),
	&quot;SplFixedArray&quot;                  =&gt; new SplFixedArray(),
	&quot;SplObjectStorage&quot;               =&gt; new SplObjectStorage(),
	&quot;MultipleIterator&quot;               =&gt; new MultipleIterator(),
/*
	&quot;PDOException&quot;                   =&gt; new PDOException(),
	&quot;PDO&quot;                            =&gt; new PDO(),
	&quot;PDOStatement&quot;                   =&gt; new PDOStatement(),
	&quot;PDORow&quot;                         =&gt; new PDORow(),
*/
	&quot;SessionHandler&quot;                 =&gt; new SessionHandler(),
	&quot;ReflectionException&quot;            =&gt; new ReflectionException(),
	&quot;Reflection&quot;                     =&gt; new Reflection(),
//	&quot;ReflectionFunctionAbstract&quot;     =&gt; new ReflectionFunctionAbstract(),
	&quot;ReflectionFunction&quot;             =&gt; new ReflectionFunction(&quot;templateFunction&quot;),
	&quot;ReflectionGenerator&quot;            =&gt; new ReflectionGenerator(templateGenerator()),
	&quot;ReflectionParameter&quot;            =&gt; new ReflectionParameter(&quot;templateFunction&quot;, &quot;templateParameter&quot;),
	&quot;ReflectionType&quot;                 =&gt; (new ReflectionClass(&quot;ZipArchive&quot;))-&gt;getMethod(&quot;getCommentName&quot;)-&gt;getReturnType(),
	&quot;ReflectionNamedType&quot;            =&gt; new ReflectionNamedType(),
	&quot;ReflectionMethod&quot;               =&gt; new ReflectionMethod(&quot;TemplateClass&quot;, &quot;templateMethod&quot;),
	&quot;ReflectionClass&quot;                =&gt; new ReflectionClass(&quot;TemplateClass&quot;),
	&quot;ReflectionObject&quot;               =&gt; new ReflectionObject(new TemplateClass()),
	&quot;ReflectionProperty&quot;             =&gt; new ReflectionProperty(&quot;TemplateClass&quot;, &quot;templateProperty&quot;),
	&quot;ReflectionClassConstant&quot;        =&gt; new ReflectionClassConstant(&quot;TemplateClass&quot;, &quot;TEMPLATE_CONSTANT&quot;),
	&quot;ReflectionExtension&quot;            =&gt; new ReflectionExtension(&quot;Reflection&quot;),

);


try { try { $vars[&quot;SplFileObject&quot;]-&gt;fgetss(str_repeat(chr(6), 17) + str_repeat(chr(226), 65)); } catch (Exception $e) { } } catch(Error $e) { }

try { try { $vars[&quot;SplFileObject&quot;]-&gt;fseek(3, 5); } catch (Exception $e) { } } catch(Error $e) { }

try { try { $vars[&quot;SplFileObject&quot;]-&gt;fgetss(implode(array_map(function($c) {return &quot;\\x&quot; . str_pad(dechex($c), 2, &quot;0&quot;);}, range(0, 255)))); } catch (Exception $e) { } } catch(Error $e) { }

?&gt;

Expected result:
----------------
normal

Actual result:
--------------
crash

</pre>
</div><h2>Patches</h2>
<p><a href='patch-add.php?bug_id=79099'>Add a Patch</a></p><h2>Pull Requests</h2>
<p><a href='gh-pull-add.php?bug_id=79099'>Add a Pull Request</a></p><h2 style="border-bottom:2px solid #666;margin-bottom:0;padding:5px 0;">History</h2><div id='comment_filter' class='controls comments'><span id='type_all' class='control active' onclick='do_comment(this);'>All</span><span id='type_comment' class='control ' onclick='do_comment(this);'>Comments</span><span id='type_log' class='control ' onclick='do_comment(this);'>Changes</span><span id='type_svn' class='control ' onclick='do_comment(this);'>Git/SVN commits</span><span id='type_related' class='control ' onclick='do_comment(this);'>Related reports</span>            </div>
            <div id='comments_view' style='clear:both;'>
<div class='comment type_log' ><a name="1579002063">&nbsp;</a><strong>[2020-01-14 11:41 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Summary:     SUMMARY: AddressSanitizer:
              heap-buffer-overflow /home/raven/fuzz/php-src-php-7.</span>
<span class="added">+Summary:     OOB read in php_strip_tags_ex</span>
<span class="removed">-Status:      Open</span>
<span class="added">+Status:      Verified</span>
<span class="removed">-Package:     Unknown/Other Function</span>
<span class="added">+Package:     Filesystem function related</span>
<span class="removed">-PHP Version: 7.4.1</span>
<span class="added">+PHP Version: 7.2.26</span>
<span class="removed">-Assigned To:</span>
<span class="added">+Assigned To: stas</span>
</div></div></div><div class='comment type_comment' ><a name="1579002063">&nbsp;</a><strong>[2020-01-14 11:41 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<pre class='note'>Thanks for reporting!  A simpler reproducer:

&lt;?php
$stream = fopen('php://memory', 'w+');
fputs($stream, &quot;&lt;?\n\&quot;\n&quot;);
rewind($stream);
var_dump(fgetss($stream));
var_dump(fgetss($stream));
?&gt;

There are two more similar issues.  Suggested patch for PHP-7.2:
&lt;<a href="https://gist.github.com/cmb69/eff31156c4a14cf0887f1347b0439eff" rel="nofollow">https://gist.github.com/cmb69/eff31156c4a14cf0887f1347b0439eff</a>&gt;.

Merging into PHP-7.3 will conflict because the strip tags parser
has been refactored.  Resolving these conflicts manually shouldn't
be hard, though.

Stas, can you please handle this ticket?
</pre>
</div><div class='comment type_log' ><a name="1579002090">&nbsp;</a><strong>[2020-01-14 11:41 UTC] <a href="//people.php.net/cmb">cmb@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Operating System: linux</span>
<span class="added">+Operating System: *</span>
</div></div></div><div class='comment type_log' ><a name="1579584513">&nbsp;</a><strong>[2020-01-21 05:28 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-CVE-ID:</span>
<span class="added">+CVE-ID: 2020-7059</span>
</div></div></div><div class='comment type_svn' ><a name="1579590964">&nbsp;</a><strong>[2020-01-21 07:16 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<pre class='note'>Automatic comment on behalf of stas
Revision: <a href="http://git.php.net/?p=php-src.git;a=commit;h=0f79b1bf301f455967676b5129240140c5c45b09" rel="nofollow">http://git.php.net/?p=php-src.git;a=commit;h=0f79b1bf301f455967676b5129240140c5c45b09</a>
Log: Fix #79099: OOB read in php_strip_tags_ex
</pre>
</div><div class='comment type_log' ><a name="1579590964">&nbsp;</a><strong>[2020-01-21 07:16 UTC] <a href="//people.php.net/stas">stas@php.net</a></strong>
<div class='log_note'><div class="changeset">
<span class="removed">-Status: Verified</span>
<span class="added">+Status: Closed</span>
</div></div></div></div>
        </td>
    </tr>
</table>

<script src='js/util.js'></script>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js'></script>
<script src="js/jquery.cookie.js"></script>
<script>
function do_comment(nd)
{
    $('#comment_filter > .control.active').removeClass("active");
    $(nd).addClass("active");

    $.cookie('history_tab', nd.id, { expires: 365 });

    if (nd.id == 'type_all') {
        $('#comments_view > .comment:hidden').show('slow');
    } else {
        $('#comments_view > .comment').each(function(i) {
            if ($(this).hasClass(nd.id)) {
                $(this).show('slow');
            } else {
                $(this).hide('slow');
            }
        });
    }
    return false;
}
</script>
<table class="foot" cellspacing="0" cellpadding="0">
    <tr>
        <td class="foot-bar" colspan="2">&nbsp;</td>
    </tr>

    <tr>
        <td class="foot-copy">
            <small>
                <a href="https://php.net/"><img src="images/logo-small.gif" align="left" valign="middle" hspace="3" alt="PHP"></a>
                <a href="https://php.net/copyright.php">Copyright &copy; 2001-2021 The PHP Group</a><br>
                All rights reserved.
            </small>
        </td>
        <td class="foot-source">
            <small>Last updated: Sat Oct 30 19:03:34 2021 UTC</small>
        </td>
    </tr>
</table>
</body>
</html>
