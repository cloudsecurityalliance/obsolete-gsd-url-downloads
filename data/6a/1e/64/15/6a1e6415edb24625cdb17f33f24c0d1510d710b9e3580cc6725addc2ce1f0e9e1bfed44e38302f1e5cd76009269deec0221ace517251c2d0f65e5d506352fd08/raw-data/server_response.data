<!DOCTYPE html>
<html lang="en">
<head>
    <title>SSH-MITM Docs - CVE-2021-36370</title>

    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google-site-verification" content="Mos9VsYAjVSwkkLf9UmxLDE_IeVmFOO3ChGGRAPn-eA" />

	<meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <meta name="author" content="SSH-MITM Dev-Team">
    <link rel="shortcut icon" href="favicon.ico">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">

    <script src="https://kit.fontawesome.com/df034fdb97.js" crossorigin="anonymous"></script>

    <!-- Theme CSS -->
	<link id="theme-style" rel="stylesheet" href="_static/pygments.css?1634826075">
    <link id="theme-style" rel="stylesheet" href="https://www.ssh-mitm.at/assets/css/theme.css?1634826075">
    <link id="theme-style" rel="stylesheet" href="_static/assets/css/sphinx.css?1634826075">
	<link id="theme-style" rel="stylesheet" href="_static/assets/css/theme2.css?1634826075">
	<link id="theme-style" rel="stylesheet" href="_static/assets/css/toctree-icons.css?1634826075"> 

<!-- RTD Extra Head -->

<link rel="stylesheet" href="https://assets.readthedocs.org/static/css/readthedocs-doc-embed.css" type="text/css" />

<script type="application/json" id="READTHEDOCS_DATA">{"ad_free": false, "api_host": "https://readthedocs.org", "build_date": "2021-10-21T14:21:16Z", "builder": "sphinx", "canonical_url": null, "commit": "e67975cd", "docroot": "/doc/", "features": {"docsearch_disabled": false}, "global_analytics_code": null, "language": "en", "page": "CVE-2021-36370", "programming_language": "py", "project": "ssh-mitm", "proxied_api_host": "/_", "source_suffix": ".rst", "subprojects": {}, "theme": "sphinx_rtd_theme", "user_analytics_code": "", "version": "latest"}</script>

<!--
Using this variable directly instead of using `JSON.parse` is deprecated.
The READTHEDOCS_DATA global variable will be removed in the future.
-->
<script type="text/javascript">
READTHEDOCS_DATA = JSON.parse(document.getElementById('READTHEDOCS_DATA').innerHTML);
</script>

<script type="text/javascript" src="https://assets.readthedocs.org/static/javascript/readthedocs-analytics.js" async="async"></script>

<!-- end RTD <extrahead> -->
</head>

<body>
	<header class="header fixed-top">
    <div class="branding">
        <div class="container-fluid position-relative">
            <nav class="navbar navbar-expand-lg" >
                <button id="docs-sidebar-toggler" class="docs-sidebar-toggler docs-sidebar-visible mr-2 d-xl-none" type="button">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="site-logo">
                    <a class="navbar-brand" href="https://www.ssh-mitm.at"><img class="logo-icon mr-2" src="https://www.ssh-mitm.at/assets/images/site-logo.svg" alt="logo"><span class="logo-text">SSH-MITM <span class="text-alt">Docs</span></span></a>
                </div>

                <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation" aria-expanded="false" aria-label="Toggle navigation">
                    <span> </span>
                    <span> </span>
                    <span> </span>
                </button>

                <div class="collapse navbar-collapse py-3 py-lg-0" id="navigation">
                    <ul class="navbar-nav ml-lg-auto">
                        <li class="nav-item mr-lg-4">
    <a class="nav-link" href="https://docs.ssh-mitm.at">Docs<i class="fas fa-book ml-2"></i></a>
</li>
<li class="nav-item mr-lg-4">
    <a class="nav-link" href="https://www.ssh-mitm.at/projects.html">Projects<i class="fas fa-tasks ml-2"></i></a>
</li>
<li class="nav-item mr-lg-4">
    <a class="nav-link" href="https://www.ssh-mitm.at/contact.html">Contact<i class="far fa-address-card ml-2"></i></a>
</li>
<li class="nav-item mr-lg-0 mt-3 mt-lg-0">
   <a class="btn btn-primary text-white" href="https://github.com/ssh-mitm/ssh-mitm">Checkout on GitHub<i class="fab fa-github ml-2"></i></a>
</li>
                    </ul>
                </div>
            </nav>

        </div><!--//container-->
    </div><!--//branding-->
</header><!--//header-->
	
		<div class="docs-wrapper">
			<div id="docs-sidebar" class="docs-sidebar">

    <nav id="docs-nav" class="docs-nav navbar">

        <div class="top-search-box d-none d-lg-flex ">
            <form class="search-form" action="search.html" method="get">
                <input type="text" placeholder="Search the docs..." name="q" class="form-control search-input">
                <input type="hidden" name="check_keywords" value="yes">
                <input type="hidden" name="area" value="default">
                <button type="submit" class="btn search-btn" value="Search"><i class="fas fa-search"></i></button>
            </form>
        </div>

    
        
        <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 toctree-item"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="fingerprint.html">SSH Fingerprints</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="authentication.html">Authentication</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="sshagent.html">SSH Agent</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="filetransfer.html">SCP/SFTP Filetransfers</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="portforwarding.html">Port Forwarding</a></li>
<li class="toctree-l1 toctree-item"><a class="reference internal" href="advanced-usage.html">Advanced usage cases</a></li>
<li class="toctree-l1 toctree-item current"><a class="reference internal" href="ssh_vulnerabilities.html">SSH Vurnabilities</a></li>
</ul>

    

    </nav><!--//docs-nav-->
</div><!--//docs-sidebar-->
			<div class="docs-content">
				<div class="container">
					<article class="docs-article" id="section-1">
                        <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
                        
  <section id="cve-2021-36370">
<h1>CVE-2021-36370</h1>
<div class="card card-margin">
    <div class="card-header no-border">
        <h5 class="card-title cve-title">CVE-2021-36370</h5>
    </div>
    <div class="card-body pt-0">
        <div class="widget-49">
            <div class="widget-49-title-wrapper">
                <div class="widget-49-date-primary">
                    <span class="widget-49-date-day">7.4</span>
                    <span class="widget-49-date-month">CVSS</span>
                </div>
                <div class="widget-49-meeting-info">
                    <span class="widget-49-pro-title"><b>Vector:</b> CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:N</span>
                    <span class="widget-49-meeting-time">
                        <a href="https://nvd.nist.gov/vuln/detail/CVE-2021-36370">https://nvd.nist.gov/vuln/detail/CVE-2021-36370</a>
                    </span>
                </div>
            </div>
            <p class="widget-49-meeting-integration">
                <i class="far fa-times-circle"></i> not integrated in SSH-MITM server
            </p>
            <p class="widget-49-meeting-text">
            An issue was discovered in Midnight Commander through 4.8.26. When establishing an SFTP connection, the fingerprint of the server is neither checked nor displayed. As a result, a user connects to the server without the ability to verify its authenticity.
            </p>
            <span class="widget-49-pro-title"><b>Affected Software:</b></span>
            <ul class="widget-49-meeting-points">
                <li class="widget-49-meeting-item"><b>Midnight Commander</b> 4.8.4 - 4.8.26 </li>
            </ul>
        </div>
    </div>
</div><p>Midnight Commander from version 4.8.4 up to 4.8.26 does not verify the host fingerprint when connecting to a server using the SFTP VFS.</p>
<p>The SFTP VFS was introduces in 2012 as an addition to the shell connection, which uses <a class="reference external" href="https://en.wikipedia.org/wiki/Files_transferred_over_shell_protocol">FISH</a>.</p>
<p>The problem was, that the host fingerprint was caclucated, but not verified.
Instead it continued with the authentication step, which makes SFTP connections vulnerable to man in the middle attacks.</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cm">/* At this point we havn&#39;t yet authenticated.  The first thing to do</span>
<span class="cm"> * is check the hostkey&#39;s fingerprint against our known hosts Your app</span>
<span class="cm"> * may have it hard coded, may go to a file, may present it to the</span>
<span class="cm"> * user, that&#39;s your call</span>
<span class="cm"> */</span><span class="w"></span>
<span class="hll"><span class="n">sftpfs_super</span><span class="o">-&gt;</span><span class="n">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"></span>
</span><span class="hll"><span class="n">libssh2_hostkey_hash</span><span class="w"> </span><span class="p">(</span><span class="n">sftpfs_super</span><span class="o">-&gt;</span><span class="n">session</span><span class="p">,</span><span class="w"> </span><span class="n">LIBSSH2_HOSTKEY_HASH_SHA1</span><span class="p">);</span><span class="w"></span>
</span>
<span class="hll"><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">sftpfs_recognize_auth_types</span><span class="w"> </span><span class="p">(</span><span class="n">super</span><span class="p">))</span><span class="w"></span>
</span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">sftp_errno</span><span class="p">;</span><span class="w"></span>

<span class="w">    </span><span class="n">sftp_errno</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">libssh2_session_last_errno</span><span class="w"> </span><span class="p">(</span><span class="n">sftpfs_super</span><span class="o">-&gt;</span><span class="n">session</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">sftpfs_ssherror_to_gliberror</span><span class="w"> </span><span class="p">(</span><span class="n">sftpfs_super</span><span class="p">,</span><span class="w"> </span><span class="n">sftp_errno</span><span class="p">,</span><span class="w"> </span><span class="n">mcerror</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">-1</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<section id="release-announcement">
<h2>Release Announcement</h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Hi there,</p>
<p>I’m glad to announce the immediate availability of mc-4.8.27, a maintenance and security release, just in time before leaving all of you for a long overdue summer vacation!</p>
<p>This release addresses an important security issue (CVE-2021-36370) in the SFTP VFS. Unfortunately, as the VFS was first introduced, the fingerprints of remote hosts were computed, but not verified, and the issue reported only now by Manfred KAISER from AUT-milCERT during an audit of open source software. We would like to thank the team at AUT-milCERT for finding the issue and responsibly disclosing it!</p>
<p>…</p>
<ul class="simple">
<li><p>– Sincerely yours,</p></li>
</ul>
<p>Yury V. Zaytsev</p>
</div>
<p><strong>Source:</strong> <a class="reference external" href="https://mail.gnome.org/archives/mc-devel/2021-August/msg00008.html">https://mail.gnome.org/archives/mc-devel/2021-August/msg00008.html</a></p>
</section>
<section id="mitigation">
<h2>Mitigation</h2>
<p>Update Midnight Commander to version &gt;= 4.8.27</p>
<p>If updating to the latest version is not possible, the shell connection (FISH) can be used for remote file operations over ssh.</p>
</section>
<section id="references">
<h2>References</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://midnight-commander.org/wiki/NEWS-4.8.27">https://midnight-commander.org/wiki/NEWS-4.8.27</a></p></li>
<li><p><a class="reference external" href="https://mail.gnome.org/archives/mc-devel/2021-August/msg00008.html">https://mail.gnome.org/archives/mc-devel/2021-August/msg00008.html</a></p></li>
<li><p><a class="reference external" href="https://github.com/MidnightCommander/mc/blob/a88a626e76139259e5b6fc0db39045f051e243dd/src/vfs/sftpfs/connection.c#L479">https://github.com/MidnightCommander/mc/blob/a88a626e76139259e5b6fc0db39045f051e243dd/src/vfs/sftpfs/connection.c#L479</a></p></li>
<li><p><a class="reference external" href="https://www.bundesheer.at/cms/artikel.php?ID=11021">https://www.bundesheer.at/cms/artikel.php?ID=11021</a></p></li>
</ul>
</section>
</section>


                        </div>
					</article>

					<footer class="footer">
    <div class="container">
        <hr>
    </div>
    <div class="container text-center pb-5">
        <ul class="social-list list-unstyled pt-4 mb-0">
            <li class="list-inline-item"><a href="https://github.com/ssh-mitm/ssh-mitm"><i class="fab fa-github fa-fw"></i></a></li>
<li class="list-inline-item"><a href="https://pypi.org/project/ssh-mitm/"><i class="fab fa-python fa-fw"></i></a></li>
<li class="list-inline-item"><a href="https://twitter.com/SshMitm"><i class="fab fa-twitter fa-fw"></i></a></li>
<li class="list-inline-item"><a href="https://www.linkedin.com/in/manfred-kaiser"><i class="fab fa-linkedin fa-fw"></i></a></li>
        </ul>
        <small class="copyright">
            &#169; Copyright 2021, <a href="https://github.com/ssh-mitm/ssh-mitm/graphs/contributors">SSH-MITM Dev-Team</a>
        </small>
    </div>
</footer>
				</div>
			</div>
		</div><!--//docs-wrapper-->
	

    <!-- Javascript -->
		<script id="documentation_options" data-url_root="" src="_static/documentation_options.js"></script>
		<script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
		<script src="_static/jquery.js"></script>
		<script src="_static/underscore.js"></script>
		<script src="_static/doctools.js"></script>
		<script async="async" src="https://assets.readthedocs.org/static/javascript/readthedocs-doc-embed.js"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

		<!-- Page Specific JS -->
		<script src="_static/assets/js/docs.js"></script>
	
	
</body>
</html>