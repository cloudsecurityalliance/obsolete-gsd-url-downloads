<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 657374 – mailto: attachment parameter can lead to accidental data exfiltration</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=657374&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=657374" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 657374 – mailto: attachment parameter can lead to accidental data exfiltration",  
                             "show_bug.cgi?id=657374" );
        document.title = "Bug 657374 – mailto: attachment parameter can lead to accidental data exfiltration";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 657374 – mailto: attachment parameter can lead to accidental data exfiltration", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_evolution bz_component_Mailer bz_bug_657374 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 657374</p>
</td>
<td id="subtitle">
<p class="subheader">mailto: attachment parameter can lead to accidental data exfiltration</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2011-11-30 13:26:14 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2011-11-30 13:26:14"/>
<input name="longdesclength" type="hidden" value="27"/>
<input name="id" type="hidden" value="657374"/>
<input name="token" type="hidden" value="1626114603-TkHT2GieGSsn-3JliWYUUjj3jD0KifBaR11G4wsM-5k"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=657374"><b>Bug 657374</b></a> -<span class="bz_default_hidden" id="summary_alias_container">
<span id="short_desc_nonedit_display">mailto: attachment parameter can lead to accidental data exfiltration</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">
</td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>mailto: attachment parameter can lead to accidental data exfiltration
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('mailto: attachment parameter can lead to accidental data exfiltration', '');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">evolution</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Applications</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=evolution" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">Mailer</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>unspecified
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       Linux
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       critical
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>---
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard">evolution-mail-maintainers
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard"><span class="fn">Evolution QA team</span>
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'evolution-mail-maintainers\x40gnome.bugs',
        'evolution-qa\x40gnome.bugs');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2011-08-25 20:00 UTC by <span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2011-11-30 13:26 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"><ul class="bug_urls">
<li><a href="https://bugzilla.redhat.com/show_bug.cgi?id=733504">https://bugzilla.redhat.com/show_bug.cgi?id=733504</a>
</li></ul></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">---</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a1">
<td valign="top">
<a href="attachment.cgi?id=196367" title="View the content of the attachment">
<b><span class="bz_obsolete">Patch for Evolution</span></b></a>
<span class="bz_attach_extra_info">
              (2.15 KB,
                patch)

            <br/>
<a href="#attach_196367" title="Go to the comment associated with the attachment">2011-09-13 13:06 UTC</a>,

            <span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">needs-work
          </td>
<td valign="top">
<a href="attachment.cgi?id=196367&amp;action=edit">Details</a>  |
    <a href="review?bug=657374&amp;attachment=196367">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch bz_tr_obsolete bz_default_hidden" id="a2">
<td valign="top">
<a href="attachment.cgi?id=196368" title="View the content of the attachment">
<b><span class="bz_obsolete">Patch for Evolution</span></b></a>
<span class="bz_attach_extra_info">
              (1.68 KB,
                patch)

            <br/>
<a href="#attach_196368" title="Go to the comment associated with the attachment">2011-09-13 13:16 UTC</a>,

            <span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">needs-work
          </td>
<td valign="top">
<a href="attachment.cgi?id=196368&amp;action=edit">Details</a>  |
    <a href="review?bug=657374&amp;attachment=196368">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a3">
<td valign="top">
<a href="attachment.cgi?id=196487" title="View the content of the attachment">
<b>Patch for Evolution</b></a>
<span class="bz_attach_extra_info">
              (2.36 KB,
                patch)

            <br/>
<a href="#attach_196487" title="Go to the comment associated with the attachment">2011-09-14 12:14 UTC</a>,

            <span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=196487&amp;action=edit">Details</a>  |
    <a href="review?bug=657374&amp;attachment=196487">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a4">
<td valign="top">
<a href="attachment.cgi?id=196488" title="View the content of the attachment">
<b>Patch for Evolution</b></a>
<span class="bz_attach_extra_info">
              (1.89 KB,
                patch)

            <br/>
<a href="#attach_196488" title="Go to the comment associated with the attachment">2011-09-14 12:26 UTC</a>,

            <span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=196488&amp;action=edit">Details</a>  |
    <a href="review?bug=657374&amp;attachment=196488">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-08-25 20:00:02 UTC
        </span>
</div>
<pre class="bz_comment_text">By registering a mailto: URL handler that allows local files to be attached via a query parameter, you are letting arbitrary web sites place the user one unsuspecting click away from exfiltrating confidential data.  E.g.:

<a href="https://mattmccutchen.net/private/evolution-mailto-test">https://mattmccutchen.net/private/evolution-mailto-test</a>

I'm not sure if the security model for URL handlers has been decided in general, but given that browsers currently allow untrusted sites to call the mailto: handler, it needs to have appropriate safeguards.  I would suggest showing a prompt with a checkbox, initially off, for each attachment specified in the URL.</pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-08-25 20:42:39 UTC
        </span>
</div>
<pre class="bz_comment_text">I think this needs to be handled by web browsers.  Nautilus SendTo, for example, invokes Evolution with a mailto: URL and I don't want to get prompted with a scary warning about attaching a file that I just told Nautilus to attach to an email.</pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-08-25 20:43:42 UTC
        </span>
</div>
<pre class="bz_comment_text">Oh... I didn't anticipate that you would want this private and already filed a public Fedora bug (<a href="https://bugzilla.redhat.com/show_bug.cgi?id=733504">https://bugzilla.redhat.com/show_bug.cgi?id=733504</a>), which I cannot now make private.</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-08-25 20:59:01 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=657374#c1">comment #1</a>)
<span class="quote">&gt; I think this needs to be handled by web browsers.</span>

I think you mean all applications that present untrusted links, which also includes IM clients and HTML mail readers such as Evolution.  So your suggestion would not get you out of changing Evolution.

After the URL handler security model has been ambiguous for so long, assuming the URLs to be trustworthy or sanitized and obliging all callers to comply is unrealistic, especially with respect to an Evolution-specific query parameter.

<span class="quote">&gt; Nautilus SendTo, for
&gt; example, invokes Evolution with a mailto: URL and I don't want to get prompted
&gt; with a scary warning about attaching a file that I just told Nautilus to attach
&gt; to an email.</span>

So we introduce a different API for that.  At any rate, it is a lesser evil than this bug.</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vincent Untz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-06 16:02:58 UTC
        </span>
</div>
<pre class="bz_comment_text">Since the Red Hat bug is public and cannot be made private, is it okay to make this bug public too?</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-06 16:23:12 UTC
        </span>
</div>
<pre class="bz_comment_text">Bug is public now.</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 13:06:58 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=196367" name="attach_196367" title="Patch for Evolution">attachment 196367</a> <a href="attachment.cgi?id=196367&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196367">[review]</a>
Patch for Evolution

Added the code for providing the warning in if mailto command is trying to attach any blacklisted file.

The blacklist is currently:

- hidden files (e.g. ".foo").
- files in hidden directories (e.g. ".secret/foo").
- files under /etc.
- files with ".." as a path component.</pre>
</div><div class="bz_comment" id="c7">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c7">Comment 7</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 13:16:22 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class="bz_obsolete"><a href="attachment.cgi?id=196368" name="attach_196368" title="Patch for Evolution">attachment 196368</a> <a href="attachment.cgi?id=196368&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196368">[review]</a>
Patch for Evolution

Patch for corporate releases.
Here instead of providing a warning in composer window. Blocking the blacklisted file from getting attached and providing a warning on terminal.

Backported to 2.28</pre>
</div><div class="bz_comment" id="c8">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c8">Comment 8</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 14:59:56 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=196367" name="attach_196367" title="Patch for Evolution">attachment 196367</a> <a href="attachment.cgi?id=196367&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196367">[review]</a>:

A simple substring search against the blacklist is too simplistic.  You're going to exclude perfectly safe filenames like "README.txt" ('.' rule).

The filename needs to be broken into path components using

   g_strsplit (filename, G_DIR_SEPARATOR_S, -1)

and then compare each path component against the blacklist using prefix match (g_str_has_prefix()) instead of a substring match.

Also I think the wording of the alert could be improved.  Perhaps something like:

   The mailto: URL included a suspicious looking attachment

   A suspicious looking file named "$FILENAME" was removed as a precaution.
   You can reattach this file using the "Add Attachment" button below.</pre>
</div><div class="bz_comment" id="c9">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c9">Comment 9</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 15:05:38 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class="bz_obsolete"><a href="attachment.cgi?id=196368" name="attach_196368" title="Patch for Evolution">attachment 196368</a> <a href="attachment.cgi?id=196368&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196368">[review]</a>:

Same issue here with the blacklist comparison.  You're correct to just use a terminal message here to avoid new translatable strings.</pre>
</div><div class="bz_comment" id="c10">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c10">Comment 10</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">André Klapper</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 15:24:02 UTC
        </span>
</div>
<pre class="bz_comment_text">Why blacklist at all? Can't I get always in case that the &amp;attachment parameter was passed (in case this can be identified and that the filename[s] can be extracted) a popup telling me that $filename was automatically attached and that I should make sure that I really want to send this file?</pre>
</div><div class="bz_comment" id="c11">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c11">Comment 11</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 15:56:54 UTC
        </span>
</div>
<pre class="bz_comment_text">Such a dialog would be annoying and redundant if the attachment was submitted intentionally by way of Nautilus-Sendto or even a command-line or shell script invocation.</pre>
</div><div class="bz_comment" id="c12">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c12">Comment 12</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-13 19:01:08 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=657374#c11">comment #11</a>)
<span class="quote">&gt; Such a dialog would be annoying and redundant if the attachment was submitted
&gt; intentionally by way of Nautilus-Sendto or even a command-line or shell script
&gt; invocation.</span>

See <a href="show_bug.cgi?id=657374#c3">comment #3</a>.</pre>
</div><div class="bz_comment" id="c13">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c13">Comment 13</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-14 12:14:16 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=196487" name="attach_196487" title="Patch for Evolution">attachment 196487</a> <a href="attachment.cgi?id=196487&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196487">[review]</a>
Patch for Evolution

Rework on review comments.</pre>
</div><div class="bz_comment" id="c14">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c14">Comment 14</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-14 12:26:04 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=196488" name="attach_196488" title="Patch for Evolution">attachment 196488</a> <a href="attachment.cgi?id=196488&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196488">[review]</a>
Patch for Evolution

Reworked on review comments for 2.28</pre>
</div><div class="bz_comment" id="c15">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c15">Comment 15</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">André Klapper</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-14 12:39:12 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class="quote">&gt; g_warning("Mailto command is trying to attach blacklisted file: %s. The
&gt; attachment may contain sensitive data. Kindly review it", content);</span>

* "Trying"? So it's not done and I still have to attach it manually 
  afterwards if this was indeed wanted?
* Missing fullstop at the end
* If e.g. nautilus-sendto triggered this, no user necessarily needs 
  to know what a "mailto command" is...
* "Please review it before sending." maybe?</pre>
</div><div class="bz_comment" id="c16">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c16">Comment 16</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-15 11:58:14 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class="quote">&gt; * "Trying"? So it's not done and I still have to attach it manually 
&gt;   afterwards if this was indeed wanted?</span>

Yes it is not yet attached in case of 2.28.
<span class="quote">&gt; * Missing fullstop at the end
&gt; * If e.g. nautilus-sendto triggered this, no user necessarily needs 
&gt;   to know what a "mailto command" is...
&gt; * "Please review it before sending." maybe?</span>

Making it following message for 2.28.

g_warning("Blacklisted file: %s is trying to get attached. The attachment may contain sensitive data. Please review it before sending.", content); 

and following for master

+  &lt;error id="blacklisted-file" type="warning"&gt;
+    &lt;_primary&gt;A blacklisted file is attached.&lt;/_primary&gt;
+    &lt;_secondary xml:space="preserve"&gt;The attachment named {0} is a hidden file and may contain sensitive data. Please review it before sending.&lt;/_secondary&gt;
+  &lt;/error&gt;
+</pre>
</div><div class="bz_comment" id="c17">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c17">Comment 17</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">André Klapper</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-15 12:06:05 UTC
        </span>
</div>
<pre class="bz_comment_text">Still I wonder if the user really needs to know anything about "blacklisting" here... sounds scary.</pre>
</div><div class="bz_comment" id="c18">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c18">Comment 18</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-15 12:26:51 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=196487" name="attach_196487" title="Patch for Evolution">attachment 196487</a> <a href="attachment.cgi?id=196487&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196487">[review]</a>:

Okay, the blacklist comparison routine looks good now.  I still like my suggested wording for the alert text better (<a href="show_bug.cgi?id=657374#c8">comment #8</a>).</pre>
</div><div class="bz_comment" id="c19">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c19">Comment 19</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-15 12:29:00 UTC
        </span>
</div>
<pre class="bz_comment_text">Review of <span class=""><a href="attachment.cgi?id=196488" name="attach_196488" title="Patch for Evolution">attachment 196488</a> <a href="attachment.cgi?id=196488&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196488">[review]</a>:

Same as <a href="show_bug.cgi?id=657374#c18">comment #18</a>.  I'll let you and Andre duke it out over the wording, but a terminal message is less important since it isn't translated.</pre>
</div><div class="bz_comment" id="c20">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c20">Comment 20</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-16 03:04:17 UTC
        </span>
</div>
<pre class="bz_comment_text">A blacklist is not a solution.  I have plenty of confidential files at paths that have no hidden component and contain no randomness; it's too strong an assumption that such paths will never be guessed or accidentally leaked by an application or in a log posted to a bug report, etc.  Attachments specified by untrusted mailto URLs should not be honored without explicit user consent.

There can be an additional mimeapp for "x-scheme-handler-trusted/mailto" or so which Nautilus-Sendto would use and which would include a flag that tells Evolution to accept the attachments without prompting.</pre>
</div><div class="bz_comment" id="c21">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c21">Comment 21</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-16 03:49:14 UTC
        </span>
</div>
<pre class="bz_comment_text">It's good enough for now.</pre>
</div><div class="bz_comment" id="c22">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c22">Comment 22</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matt McCutchen</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-09-16 23:29:06 UTC
        </span>
</div>
<pre class="bz_comment_text">BS.  Looks like I'll be carrying a patch.</pre>
</div><div class="bz_comment" id="c23">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c23">Comment 23</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Vibha Yadav</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-10-04 06:42:15 UTC
        </span>
</div>
<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=196487" name="attach_196487" title="Patch for Evolution">attachment 196487</a> <a href="attachment.cgi?id=196487&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196487">[review]</a>
Patch for Evolution

committed to master in 273b10a</pre>
</div><div class="bz_comment" id="c24">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c24">Comment 24</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">André Klapper</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-11-04 15:42:38 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=657374#c23">comment #23</a>)
<span class="quote">&gt; (From update of <span class=""><a href="attachment.cgi?id=196487" name="attach_196487" title="Patch for Evolution">attachment 196487</a> <a href="attachment.cgi?id=196487&amp;action=edit" title="Patch for Evolution">[details]</a></span> <a href="review?bug=657374&amp;attachment=196487">[review]</a>)
&gt; committed to master in 273b10a</span>

So can this be closed as FIXED? Or does anybody plan to backport something to 3.2 that does not introduce new strings?</pre>
</div><div class="bz_comment" id="c25">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c25">Comment 25</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Milan Crha</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-11-28 09:01:15 UTC
        </span>
</div>
<pre class="bz_comment_text">I'm marking it as fixed, the bug is sort of lame anyway, because you see a list of attachments being attached, before the message is sent.</pre>
</div><div class="bz_comment" id="c26">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=657374#c26">Comment 26</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Matthew Barnes</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2011-11-30 13:26:14 UTC
        </span>
</div>
<pre class="bz_comment_text">Backported to 3.2, which just dumps a message to the terminal and silently skips suspicious looking mailto attachments which match the blacklist:

<a href="http://git.gnome.org/browse/evolution/commit/?h=gnome-3-2&amp;id=588c410718068388f8ce0004a71c104a4c89cce3">http://git.gnome.org/browse/evolution/commit/?h=gnome-3-2&amp;id=588c410718068388f8ce0004a71c104a4c89cce3</a></pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=evolution">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=657374&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=657374" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=657374&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626114603-fZFY6krarPud7K8xc2-j-4j5uDh2Oj7p3_ddbM1yx44"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>