<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>e7cf91a198de995c7440b3b64352effd2e309906 - platform/frameworks/base - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/frameworks/base/%2B/e7cf91a198de995c7440b3b64352effd2e309906">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/">frameworks</a> / <a class="Breadcrumbs-crumb" href="/platform/frameworks/base/">base</a> / <span class="Breadcrumbs-crumb">e7cf91a198de995c7440b3b64352effd2e309906</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>e7cf91a198de995c7440b3b64352effd2e309906</td><td><span>[<a href="/platform/frameworks/base/+log/e7cf91a198de995c7440b3b64352effd2e309906">log</a>]</span> <span>[<a href="/platform/frameworks/base/+archive/e7cf91a198de995c7440b3b64352effd2e309906.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Christopher Tate &lt;ctate@google.com&gt;</td><td>Mon Jun 13 15:17:54 2016 -0700</td></tr><tr><th class="Metadata-title">committer</th><td>The Android Automerger &lt;android-build@android.com&gt;</td><td>Fri Jun 24 16:52:27 2016 -0700</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/">f6c9eec88214774ba2314a789d251c5348d41caa</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E">9b8c6d2df35455ce9e67907edded1e4a2ecb9e28</a> <span>[<a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Don&#39;t trust callers to supply app info to bindBackupAgent()

Get the canonical identity and metadata about the package from the
Package Manager at time of usage rather than rely on the caller to
have gotten things right, even when the caller has the system uid.

Bug 28795098

Change-Id: <a href="https://android-review.googlesource.com/#/q/I215786bc894dedf7ca28e9c80cefabd0e40ca877">I215786bc894dedf7ca28e9c80cefabd0e40ca877</a>

Merge conflict resolution for ag/1133474 (referencing ag/1148862)
- directly to mnc-mr2-release
</pre><ul class="DiffTree"><li><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/core/java/android/app/ActivityManagerNative.java">core/java/android/app/ActivityManagerNative.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E%21/#F0">diff</a>]</span></li><li><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/core/java/android/app/IActivityManager.java">core/java/android/app/IActivityManager.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E%21/#F1">diff</a>]</span></li><li><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/services/backup/java/com/android/server/backup/BackupManagerService.java">services/backup/java/com/android/server/backup/BackupManagerService.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E%21/#F2">diff</a>]</span></li><li><a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/services/core/java/com/android/server/am/ActivityManagerService.java">services/core/java/com/android/server/am/ActivityManagerService.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906%5E%21/#F3">diff</a>]</span></li></ul><div class="DiffSummary">4 files changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: f6c9eec88214774ba2314a789d251c5348d41caa</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - Android.mk"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/Android.mk">Android.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CleanSpec.mk"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/CleanSpec.mk">CleanSpec.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - MODULE_LICENSE_APACHE2"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/MODULE_LICENSE_APACHE2">MODULE_LICENSE_APACHE2</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NOTICE"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/NOTICE">NOTICE</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - api/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/api/">api/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - cmds/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/cmds/">cmds/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - core/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/core/">core/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - data/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/data/">data/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - docs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/docs/">docs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - drm/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/drm/">drm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - graphics/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/graphics/">graphics/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - include/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/include/">include/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - keystore/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/keystore/">keystore/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - libs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/libs/">libs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - location/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/location/">location/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - media/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/media/">media/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - native/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/native/">native/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - nfc-extras/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/nfc-extras/">nfc-extras/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - obex/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/obex/">obex/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - opengl/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/opengl/">opengl/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - packages/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/packages/">packages/</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - preloaded-classes"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/preloaded-classes">preloaded-classes</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - rs/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/rs/">rs/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - samples/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/samples/">samples/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - sax/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/sax/">sax/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - services/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/services/">services/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - telecomm/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/telecomm/">telecomm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - telephony/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/telephony/">telephony/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - test-runner/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/test-runner/">test-runner/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tests/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/tests/">tests/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - tools/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/tools/">tools/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - wifi/"><a class="FileList-itemLink" href="/platform/frameworks/base/+/e7cf91a198de995c7440b3b64352effd2e309906/wifi/">wifi/</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>