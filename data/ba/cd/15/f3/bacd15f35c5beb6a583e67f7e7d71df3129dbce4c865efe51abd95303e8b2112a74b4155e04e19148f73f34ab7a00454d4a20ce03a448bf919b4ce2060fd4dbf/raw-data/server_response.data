<!DOCTYPE html>
<html lang="en">
<head>

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-92665328-1"></script>
<script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        
        gtag('config', 'UA-92665328-1');
    </script>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<title>[CVE-2017-8851] OnePlus OTA One/X Crossover Vulnerability</title>
<meta name="name" content="CVE-2017-8851">
<meta name="description" content="OnePlus OTA One/X Crossover Vulnerability">
<meta name="image" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@alephsecurity">
<meta name="twitter:creator" content="@alephsecurity">
<meta name="twitter:title" content="CVE-2017-8851">
<meta name="twitter:url" content="https://alephsecurity.com/vulns/aleph-2017021">
<meta name="twitter:description" content="OnePlus OTA One/X Crossover Vulnerability">
<meta name="twitter:image:src" content="https://alephsecurity.com/assets/img/logo-black.png">
<meta property="og:site_name" content="">
<meta property="og:title" content="CVE-2017-8851">
<meta property="og:type" content="article">
<meta property="og:description" content="OnePlus OTA One/X Crossover Vulnerability">
<meta property="og:url" content="https://alephsecurity.com/vulns/aleph-2017021">
<meta property="article:published_time" content="2017-05-11T00:00:00+00:00">
<meta property="article:author" content="https://alephsecurity.com">
<meta property="og:image" content="https://alephsecurity.com/assets/img/logo-black.png">
<link rel="icon" href="/favicon.png">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inconsolata:400,700">
<link rel="stylesheet" type="text/css" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: "none",
      tex2jax: {preview: "none"},
      CommonHTML: { linebreaks: { automatic: true } },
      "HTML-CSS": { linebreaks: { automatic: true } },
      SVG: { linebreaks: { automatic: true } }
    });
    </script>
<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
</head>
<body>
<div class="wrapper">
<div class="page__back">
<a href="/">&lt;-- <span class="smallogo">א</span></a>
</div>
<div class="page">
<div class="advisory">
<div class="advisory__title">
<h1>OnePlus OTA One/X Crossover Vulnerability</h1>
</div>
<div class="advisory__subtitle">
Aleph Research Advisory
</div>
<div class="advisory__meta">
<p></p>
</div>
<h2>Identifier</h2>
<div class="cve-high"><span class="" title="OnePlus OTA One/X Crossover Vulnerability"><a href="/vulns/aleph-2017021">CVE-2017-8851</a></span></div>
<h2>Severity</h2>
High
<h2>Products</h2>
<div class="numberedlistnoalternative">
<ol>
<li><p>OnePlus X</p>
</li>
<li><p>OnePlus One</p>
</li>
</ol>
</div>
<h2>Vulnerable Version</h2>
<p>All OnePlus OxygenOS &amp; HydrogenOS OTAs</p>
<h2>Technical Details</h2>
<div class="advisory__content" ?>
 <p>Due to lenient <code class="language-plaintext highlighter-rouge">updater-script</code> on the OnePlus One &amp; X’s OTA images (see below), the fact both products use the same OTA verification keys, and the fact both products share the same <code class="language-plaintext highlighter-rouge">ro.build.product</code> system property, attackers can install OTAs of one product over the other, even on locked bootloaders. That could theoretically allow for exploitation of vulnerabilities patched on one image but not on the other, in addition to expansion of the attack surface. Moreover, the vulnerability may result in having the device unusable until a Factory Reset is performed. This vulnerability can be exploited by Man-in-the-Middle (MiTM) attackers targeting the update process. This is possible because the update transaction does not occur over TLS (<span class="cve-high" title="OnePlus OTA Lack of TLS Vulnerability"><a href="/vulns/aleph-2017022">CVE-2016-10370</a></span>). In addition, physical attackers can reboot the phone into recovery, and then use <code class="language-plaintext highlighter-rouge">adb sideload</code> to push the OTA.</p>
<p><code class="language-plaintext highlighter-rouge">updater-script</code> of the latest OnePlus X OxygenOS OTA:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">getprop("ro.build.product") == "OnePlus" || abort("This package is for \"OnePlus\" devices;</span><span class="w"> </span>this is a <span class="se">\"</span><span class="s2">" + getprop("</span>ro.build.product<span class="s2">") + "</span><span class="se">\"</span>.<span class="s2">");
</span><span class="gp">show_progress(0.750000, 0);</span><span class="w">
</span><span class="gp">ui_print("Patching system image unconditionally...");</span><span class="w">
</span><span class="gp">block_image_update("/dev/block/platform/msm_sdcc.1/by-name/system", package_extract_file("system.transfer.list"), "system.new.dat", "system.patch.dat");</span><span class="w">
</span></code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">updater-script</code> of the OnePlus One OxygenOS OTA:</p>
<div class="language-terminal highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="gp">getprop("ro.build.product") == "OnePlus" || getprop("ro.build.product") == "ONE" || abort("This package is for \"OnePlus\" devices;</span><span class="w"> </span>this is a <span class="se">\"</span><span class="s2">" + getprop("</span>ro.build.product<span class="s2">") + "</span><span class="se">\"</span>.<span class="s2">");
</span><span class="gp">ifelse(is_mounted("/system"), unmount("/system"));</span><span class="w">
</span><span class="gp">mount("ext4", "EMMC", "/dev/block/platform/msm_sdcc.1/by-name/system", "/system", "");</span><span class="w">
</span><span class="gp">unmount("/system");</span><span class="w">
</span><span class="gp">show_progress(0.750000, 0);</span><span class="w">
</span><span class="gp">ui_print("Patching system image unconditionally...");</span><span class="w">
</span></code></pre></div></div>
<p>PoC can be found <a href="https://github.com/alephsecurity/research/tree/master/OnePlusOTA">here</a>.</p>
</div>
<h2>Timeline</h2>
<div class="list"><ul><li><div class="list__date"><span>11-May-17<span></div>: Public disclosure.</li><li><div class="list__date"><span>10-May-17<span></div>: Deadline Extension.</li><li><div class="list__date"><span>08-May-17<span></div>: <span class="cve-high" title="OnePlus OTA One/X Crossover Vulnerability"><a href="/vulns/aleph-2017021">CVE-2017-8851</a></span> assigned.</li><li><div class="list__date"><span>08-May-17<span></div>: CVE ID requested.</li><li><div class="list__date"><span>08-May-17<span></div>: Added as <span class="cve-high" title="OnePlus OTA One/X Crossover Vulnerability"><a href="/vulns/aleph-2017021">ALEPH-2017021</a></span>.</li><li><div class="list__date"><span>26-Apr-17<span></div>: Deadline.</li><li><div class="list__date"><span>09-Apr-17<span></div>: 14-day Deadline Extension Offered (no reply).</li><li><div class="list__date"><span>26-Jan-17<span></div>: Reported.</li></ul></div>
<h2>Posts</h2>
<div class="pagelist__narrow"><ul>  <li onclick="javscript:document.location.href='/2017/05/11/oneplus-ota/'"> <a href="/2017/05/11/oneplus-ota/">OnePlus OTAs: Analysis & Exploitation </a> <div class="pagelist__subtitle">By <a href="/authors/roeeh">Roee Hay</a>, <div class="pagelist__date"><span>11-May 2017</span></div></div></li> </ul></div>
<h2>Credit</h2>
<div class="list">
<ul>
<li>
<a href="/authors/roeeh">Roee Hay</a> (<a href="https://twitter.com/roeehay">@roeehay</a>) of Aleph Research, HCL Technologies
</li>
</ul>
</div>
</div>
</div>
</div>
</body>
</html>
