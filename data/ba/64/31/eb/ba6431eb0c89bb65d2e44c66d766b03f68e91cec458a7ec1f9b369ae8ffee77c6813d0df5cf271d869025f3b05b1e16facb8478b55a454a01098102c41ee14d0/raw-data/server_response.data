
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>
Issue 36216: CVE-2019-9636: urlsplit does not handle NFKC normalization - Python tracker

</title>
<link rel="shortcut icon" href="@@file/favicon.ico" />
<link rel="stylesheet" type="text/css" href="@@file/main.css" />
<link rel="stylesheet" type="text/css" href="@@file/style.css" />
<link rel="search" type="application/opensearchdescription+xml" href="@@file/osd.xml" title="Python bug tracker search" />
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script nonce="ef55eb433ef0c0f10e065f723b9f4936c985291534e9a3b7c94d7422a1516f43" type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        return false;
    }
    submitted = true;
    return true;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://bugs.python.org/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
    HelpWin.focus ()
}
</script>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.js"></script>
<script type="text/javascript" src="@@file/issue.item.js"></script>
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/smoothness/jquery-ui.css" />


</head>
<body>
  <!--  Logo  -->
  <h1 id="logoheader">
    <a accesskey="1" href="." id="logolink">
       <img src="@@file/python-logo.gif" alt="homepage" border="0" id="logo" /></a>
  </h1>

<div id="utility-menu">
<!-- Search Box -->
<div id="searchbox">
    <form name="searchform" method="get" action="issue" id="searchform">
      <div id="search">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignee,status,type" />
       <input type="hidden" name="@sort" value="-activity" />
       <input type="hidden" name="@filter" value="status" />
       <input type="hidden" name="@action" value="searchid" />
       <input type="hidden" name="ignore" value="file:content" />
       <input class="input-text" id="search-text"
              name="@search_text" size="10" />
       <input type="submit" id="submit" value="search" name="submit" class="input-button" />
       <input type="radio" name="status"
              id="status_notresolved" value="-1,1,3" />
       <label for="status_notresolved">open</label>
       <input type="radio" name="status" checked="checked"
              id="status_all" value="-1,1,2,3" />
       <label for="status_all">all</label>
      </div>
     </form>
</div>
</div>


<div id="left-hand-navigation">
<!--  Main Menu NEED LEVEL TWO HEADER AND FOOTER -->
<div id="menu">
  <ul class="level-one">
    <li><a href="https://www.python.org/" title="Go to the Python homepage">Python Home</a></li>
    <li><a href="https://www.python.org/about/" title="About The Python Language">About</a></li>
    <li><a href="https://www.python.org/blogs/" title="">News</a></li>
    <li><a href="https://www.python.org/doc/" title="">Documentation</a></li>
    <li><a href="https://www.python.org/downloads/" title="">Downloads</a></li>
    <li><a href="https://www.python.org/community/" title="">Community</a></li>
    <li><a href="https://www.python.org/psf/" title="Python Software Foundation">Foundation</a></li>
    <li><a href="https://devguide.python.org/" title="Python Developer's Guide">Developer's Guide</a></li>
    <li class="selected"><a href="." class="selected" title="Python Issue Tracker">Issue Tracker</a>
      <ul class="level-two">
        <li>
          <strong>Issues</strong>
          <ul class="level-three">
            
            <li><a href="issue?@template=search&amp;status=1">Search</a></li>
            <li><a href="issue?@action=random">Random Issue</a></li>
            <li>
              <form method="post" action="issue36216">
                <input type="submit" class="form-small"
                       value="Show issue:" />
                <input class="form-small" size="4" type="text" name="@number" />
                <input type="hidden" name="@type" value="issue" />
                <input type="hidden" name="@action" value="show" />
              </form>
            </li>
          </ul>
        </li>


        <li>
          <strong>Summaries</strong>
          <ul class="level-three">
            

            

            

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Issues%20with%20patch&amp;@startwith=0&amp;@group=priority&amp;keywords=2&amp;@action=search&amp;@filter=&amp;@pagesize=50">Issues with patch</a>
            </li>

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Easy%20issues&amp;@startwith=0&amp;@group=priority&amp;keywords=6&amp;@action=search&amp;@filter=&amp;@pagesize=50">Easy issues</a>
            </li>

            <li>
              <a href="issue?@template=stats">Stats</a>
            </li>

          </ul>
        </li>


        <li>
          <strong>User</strong>
          <form method="post" action="issue36216">
          <ul class="level-three">
            <li>
                Login&nbsp;(OpenID&nbsp;possible)<br />
	         <a style="display:inline;width:0;margin:0"
             href="issue36216?@action=oic_login&amp;provider=Google">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.google.com/favicon.ico"
                       alt="Google" title="Google" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue36216?@action=oic_login&amp;provider=GitHub">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.github.com/favicon.ico"
                       alt="GitHub" title="GitHub" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue36216?@action=openid_login&amp;provider=Launchpad">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://launchpad.net/favicon.ico"
                       alt="Launchpad" title="Launchpad" /></a>
                <input size="10" name="openid_identifier" style="background:url(@@file/openid-16x16.gif)
                  center left no-repeat;padding-left:16px" /><br />
                <input size="10" type="password" name="__login_password" /><br />
                <input type="hidden" name="@action" value="Login" />
                <input type="checkbox" name="remember" id="remember" />
                <label for="remember">Remember me?</label><br />
                <input class="form-small" type="submit"
                       value="Login" /><br />
                <input type="hidden" name="__came_from"
                       value="https://bugs.python.org/issue36216?">
                
                <input type="hidden" name="@sort" value=""/>
<input type="hidden" name="@group" value=""/>
<input type="hidden" name="@pagesize" value="50"/>
<input type="hidden" name="@startwith" value="0"/>
            </li>
            <li>
                <a href="user?@template=register">Register</a>
            </li>
            <li><a href="user?@template=forgotten">Lost&nbsp;your&nbsp;login?</a></li>
          </ul>
          </form>
        </li>

        

        

        <li>
          <strong>Administration</strong>
          <ul class="level-three">
            
            <li>
                <a href="user?@sort=username">User List</a></li>
            <li>
                <a href="user?iscommitter=1&amp;@action=search&amp;@sort=username&amp;@pagesize=300">Committer List</a></li>
            
            
            
          </ul>
        </li>

        <li>
          <strong>Help</strong>
          <ul class="level-three">
            <li><a href="http://docs.python.org/devguide/triaging.html">
                Tracker Documentation</a></li>
            <li><a href="http://wiki.python.org/moin/TrackerDevelopment">
                Tracker Development</a></li>
            <li><a href="https://github.com/python/psf-infra-meta/issues">
                Report Tracker Problem</a></li>
          </ul>
        </li>

      </ul>
    </li>
  </ul>
</div> <!-- menu -->
</div> <!-- left-hand-navigation -->

<div id="content-body">
<div id="body-main">
<div id="content">
<div id="breadcrumb">
 
 
 Issue36216
 
</div>
 
 





<div>

<form method="post" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue36216">

<fieldset><legend>classification</legend>
<table class="form">
<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#title" target="_blank">Title</a>:</th>
 
 <td colspan="3">
  <span>CVE-2019-9636: urlsplit does not handle NFKC normalization</span>
  <input type="hidden" name="title"
         value="CVE-2019-9636: urlsplit does not handle NFKC normalization">
 </td>
</tr>

<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#type" target="_blank">Type</a>:</th>
 <td>security</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#stage" target="_blank">Stage</a>:</th>
 <td>resolved</td>
</tr>

<tr>
 <th><a href="http://docs.python.org/devguide/triaging.html#components" target="_blank">Components</a>:</th>
 <td>Unicode</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#versions" target="_blank">Versions</a>:</th>
 <td>Python 3.8, Python 3.7, Python 3.6</td>
</tr>
</table>
</fieldset>

<fieldset><legend>process</legend>
<table class="form">
<tr>
  <th><a href="http://docs.python.org/devguide/triaging.html#status" target="_blank">Status</a>:</th>
  <td>closed</td>
  <th><a href="http://docs.python.org/devguide/triaging.html#resolution" target="_blank">Resolution</a>:</th>
  <td>fixed</td>
</tr>

<tr>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#dependencies"
       target="_blank">Dependencies</a>:
 </th>
 <td>
  
  
 </td>
 <th><a href="http://docs.python.org/devguide/triaging.html#superseder" target="_blank">Superseder</a>:</th>
 <td>
  
 
 </td>
 </tr>
 <tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#assigned-to"
      target="_blank">Assigned To</a>:
 </th>
 
 <td>
  steve.dower
 </td>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#nosy-list"
      target="_blank">Nosy List</a><!--
        <span tal:condition="context/nosy_count" tal:replace="python: ' (%d)' % context.nosy_count" /> -->:
 </th>
 <td>
     benjamin.peterson, ezio.melotti, jeremy.kloth, jkloth, koobs, martin.panter, mcepl, ned.deily, steve.dower, vstinner, xtreak
     
 </td>
</tr>
<tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#priority"
      target="_blank">Priority</a>:
 </th>
 <td>normal</td>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#keywords"
       target="_blank">Keywords</a>:
 </th>
 <td>patch, security_issue</td>


</tr>









</table>
</fieldset>

</form>

<p>Created on <strong>2019-03-06 17:37</strong> by <strong>steve.dower</strong>, last changed <strong>2021-05-11 14:28</strong> by <strong>larry</strong>. This issue is now <strong style="color:#00F; background-color:inherit;">closed</strong>.</p>



<table class="files">
 <tr><th class="header" colspan="4">Pull Requests</th></tr>
 <tr>
  <th>URL</th>
  <th>Status</th>
  <th>Linked</th>
  <th>Edit</th>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12201" title="bpo-36216: Add check for characters in netloc that normalize to separators">PR 12201</a></td>
  <td>closed</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-06 17:45</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12213" title="[3.7] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">PR 12213</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-07 16:07</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12215" title="[3.6] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">PR 12215</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-07 16:11</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12216" title="[2.7] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">PR 12216</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-07 16:29</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12223" title="[3.5] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">PR 12223</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-07 18:31</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12224" title="[3.4] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">PR 12224</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-07 18:34</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/12291" title="[2.7] bpo-36216: Only print test messages when verbose (GH-12291)">PR 12291</a></td>
  <td>merged</td>
  <td>
   <span>steve.dower</span>,
   <span>2019-03-12 15:27</span>
  </td>
  <td>
    
  </td>
 </tr>
</table>





<table class="messages">
 <tr><th colspan="4" class="header">Messages (22)</th></tr>
 
  <tr>
    <th>
     <a href="#msg337336" id="msg337336">msg337336</a> - <a
    href="msg337336">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-06 17:37</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>URLs encoded with Punycode/IDNA use NFKC normalization to decompose characters [1]. This can result in some characters introducing new segments into a URL.

For example, \uFF03 is not equal to '#' under direct comparison, but normalizes to '#' which changes the fragment part of the URL. Similarly \u2100 normalizes to 'a/c' which introduces a path segment.

Currently, urlsplit() does not normalize, which may result in it returning a different netloc from what a browser would

&gt;&gt;&gt; u = "<a href="https://example.com">https://example.com</a>\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>"
&gt;&gt;&gt; urlsplit(u).netloc.rpartition("@")[2]
bing.com

&gt;&gt;&gt; # Simulate
&gt;&gt;&gt; u = "<a href="https://example.com">https://example.com</a>\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>".encode("idna").decode("ascii")
&gt;&gt;&gt; urlsplit(u).netloc.rpartition("@")[2]
example.com

(Note that .netloc includes user/pass and .rpartition("@") is often used to remove it.)

This may be used to steal cookies or authentication data from applications that use the netloc to cache or retrieve this information.

The preferred fix for the urllib module is to detect and raise ValueError if NFKC-normalization of the netloc introduce any of '/?#@:'. Applications that want to avoid this error should perform their own decomposition using unicodedata or transcode to ASCII via IDNA.

&gt;&gt;&gt; # New behavior
&gt;&gt;&gt; u = "<a href="https://example.com">https://example.com</a>\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>"
&gt;&gt;&gt; urlsplit(u)
...
ValueError: netloc 'example.com#@bing.com' contains invalid characters under NFKC normalization

&gt;&gt;&gt; # Workaround 1
&gt;&gt;&gt; u2 = unicodedata.normalize("NFKC", u)
&gt;&gt;&gt; urlsplit(u2)
SplitResult(scheme='https', netloc='example.com', path='', query='', fragment='@bing.com')

&gt;&gt;&gt; # Workaround 2
&gt;&gt;&gt; u3 = u.encode("idna").decode("ascii")
&gt;&gt;&gt; urlsplit(u3)
SplitResult(scheme='https', netloc='example.com', path='', query='', fragment='@bing.com')

Note that we do not address other characters, such as those that convert into period. The error is only raised for changes that affect how urlsplit() locates the netloc and the very common next step of removing credentials from the netloc.

This vulnerability was reported by Jonathan Birch of Microsoft Corporation and Panayiotis Panayiotou (<a href="mailto:p.panayiotou2@gmail.com">p.panayiotou2@gmail.com</a>) via the Python Security Response Team. A CVE number has been requested.

[1]: <a href="https://unicode.org/reports/tr46/">https://unicode.org/reports/tr46/</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337383" id="msg337383">msg337383</a> - <a
    href="msg337383">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-07 10:35</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>FYI I added this vulnerability to:
<a href="https://python-security.readthedocs.io/vuln/urlsplit-nfkc-normalization.html">https://python-security.readthedocs.io/vuln/urlsplit-nfkc-normalization.html</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337398" id="msg337398">msg337398</a> - <a
    href="msg337398">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-07 16:02</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/16e6f7dee7f02bb81aa6b385b982dcdda5b99286">16e6f7dee7f02bb81aa6b385b982dcdda5b99286</a> by Steve Dower in branch 'master':
<a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>)
<a href="https://github.com/python/cpython/commit/16e6f7dee7f02bb81aa6b385b982dcdda5b99286">https://github.com/python/cpython/commit/16e6f7dee7f02bb81aa6b385b982dcdda5b99286</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337411" id="msg337411">msg337411</a> - <a
    href="msg337411">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-07 17:08</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/daad2c482c91de32d8305abbccc76a5de8b3a8be">daad2c482c91de32d8305abbccc76a5de8b3a8be</a> by Steve Dower in branch '3.7':
<a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>)
<a href="https://github.com/python/cpython/commit/daad2c482c91de32d8305abbccc76a5de8b3a8be">https://github.com/python/cpython/commit/daad2c482c91de32d8305abbccc76a5de8b3a8be</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337412" id="msg337412">msg337412</a> - <a
    href="msg337412">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-07 17:08</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/e37ef41289b77e0f0bb9a6aedb0360664c55bdd5">e37ef41289b77e0f0bb9a6aedb0360664c55bdd5</a> by Steve Dower in branch '2.7':
<a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>)
<a href="https://github.com/python/cpython/commit/e37ef41289b77e0f0bb9a6aedb0360664c55bdd5">https://github.com/python/cpython/commit/e37ef41289b77e0f0bb9a6aedb0360664c55bdd5</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337532" id="msg337532">msg337532</a> - <a
    href="msg337532">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-08 21:29</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>This issue is now assigned CVE-2019-9636

<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9636">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-9636</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337566" id="msg337566">msg337566</a> - <a
    href="msg337566">(view)</a></th>
   <th>Author: Jeremy Kloth (jkloth) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-03-09 09:49</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>A missed print statement in the 2.7 patch is causing the tests to fail.

Line 647 of <a href="https://github.com/python/cpython/blob/master/Lib/test/test_urlparse.py">Lib/test/test_urlparse.py</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337645" id="msg337645">msg337645</a> - <a
    href="msg337645">(view)</a></th>
   <th>Author: Larry Hastings (larry) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-11 04:58</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/62d36547f97210a26cc6051da78714fd078e158c">62d36547f97210a26cc6051da78714fd078e158c</a> by larryhastings (Steve Dower) in branch '3.4':
<a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>) (<a class="closed" title="[closed] problem with siginterrupt" href="issue12224">#12224</a>)
<a href="https://github.com/python/cpython/commit/62d36547f97210a26cc6051da78714fd078e158c">https://github.com/python/cpython/commit/62d36547f97210a26cc6051da78714fd078e158c</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337646" id="msg337646">msg337646</a> - <a
    href="msg337646">(view)</a></th>
   <th>Author: Larry Hastings (larry) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-11 04:59</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/c0d95113b070799679bcb9dc49d4960d82e8bb08">c0d95113b070799679bcb9dc49d4960d82e8bb08</a> by larryhastings (Steve Dower) in branch '3.5':
<a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>) (<a class="closed" title="[closed] Datamodel documentation page: 'operator' where 'operand' should be" href="issue12223">#12223</a>)
<a href="https://github.com/python/cpython/commit/c0d95113b070799679bcb9dc49d4960d82e8bb08">https://github.com/python/cpython/commit/c0d95113b070799679bcb9dc49d4960d82e8bb08</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337704" id="msg337704">msg337704</a> - <a
    href="msg337704">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-11 22:23</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; A missed print statement in the 2.7 patch is causing the tests to fail.

How does that cause tests to fail? Is it going to stderr? Or just causing an error.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337711" id="msg337711">msg337711</a> - <a
    href="msg337711">(view)</a></th>
   <th>Author: Jeremy Kloth (jeremy.kloth)</th>
   <th>Date: 2019-03-12 02:20</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt;
&gt; How does that cause tests to fail? Is it going to stderr? Or just causing
&gt; an error.
&gt;

It is causing an "unexpected output error".  When the test is re-run at the
end, it is run in verbose mode so the extra output is ignored and thus
passes at that point.

&gt;</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337720" id="msg337720">msg337720</a> - <a
    href="msg337720">(view)</a></th>
   <th>Author: Ned Deily (ned.deily) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 04:34</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/23fc0416454c4ad5b9b23d520fbe6d89be3efc24">23fc0416454c4ad5b9b23d520fbe6d89be3efc24</a> by Ned Deily (Steve Dower) in branch '3.6':
[3.6] <a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Add check for characters in netloc that normalize to separators (<a href="https://github.com/python/cpython/pull/12201" class="closed" title="GitHub PR 12201: [closed] bpo-36216: Add check for characters in netloc that normalize to separators">GH-12201</a>) (<a href="https://github.com/python/cpython/pull/12215" class="closed" title="GitHub PR 12215: [merged] [3.6] bpo-36216: Add check for characters in netloc that normalize to separators (GH-12201)">GH-12215</a>)
<a href="https://github.com/python/cpython/commit/23fc0416454c4ad5b9b23d520fbe6d89be3efc24">https://github.com/python/cpython/commit/23fc0416454c4ad5b9b23d520fbe6d89be3efc24</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337725" id="msg337725">msg337725</a> - <a
    href="msg337725">(view)</a></th>
   <th>Author: Karthikeyan Singaravelan (xtreak) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 08:17</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Sample buildbot log of print statement in testcase causing rerun of test : <a href="https://buildbot.python.org/all/#/builders/101/builds/364/steps/4/logs/stdio">https://buildbot.python.org/all/#/builders/101/builds/364/steps/4/logs/stdio</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337753" id="msg337753">msg337753</a> - <a
    href="msg337753">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 15:34</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Thanks. Just posted a PR that puts the print behind a verbose flag (on Python 3 it uses subtest so that we see which character caused the failure).

If that doesn't work for whatever reason, I'll just leave it out and hope that we never have to debug it on Python 2 :)</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337771" id="msg337771">msg337771</a> - <a
    href="msg337771">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 16:09</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Commit <a href="https://hg.python.org/lookup/e37ef41289b77e0f0bb9a6aedb0360664c55bdd5">e37ef41289b77e0f0bb9a6aedb0360664c55bdd5</a> introduced a regression on AMD64 Windows8.1 Refleaks 2.7:

test_urlparse leaked [114, 114, 114] references, sum=342

<a href="https://buildbot.python.org/all/#/builders/33/builds/532">https://buildbot.python.org/all/#/builders/33/builds/532</a>

It is fixed by <a href="https://github.com/python/cpython/pull/12291" class="closed" title="GitHub PR 12291: [merged] [2.7] bpo-36216: Only print test messages when verbose (GH-12291)">PR 12291</a>.

You can test:

python -m test -R 3:3 test_urlparse</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337773" id="msg337773">msg337773</a> - <a
    href="msg337773">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 16:16</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>If it's fixed by not printing to the console, then it must be a refleak in print. Or perhaps in the test failure/repeat.

That PR is going to be merged as soon as AppVeyor finishes, so nothing to worry about here.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337806" id="msg337806">msg337806</a> - <a
    href="msg337806">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 20:52</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/507bd8cde60ced74d13a1ffa883bb9b0e73c38be">507bd8cde60ced74d13a1ffa883bb9b0e73c38be</a> by Steve Dower in branch '2.7':
[3.7] <a class="closed" title="[closed] CVE-2019-9636: urlsplit does not handle NFKC normalization" href="issue36216">bpo-36216</a>: Only print test messages when verbose (<a href="https://github.com/python/cpython/pull/12291" class="closed" title="GitHub PR 12291: [merged] [2.7] bpo-36216: Only print test messages when verbose (GH-12291)">GH-12291</a>)
<a href="https://github.com/python/cpython/commit/507bd8cde60ced74d13a1ffa883bb9b0e73c38be">https://github.com/python/cpython/commit/507bd8cde60ced74d13a1ffa883bb9b0e73c38be</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg337811" id="msg337811">msg337811</a> - <a
    href="msg337811">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-03-12 21:25</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Hah, I typo'd the commit message and marked it as 3.7 instead of 2.7. Oh well.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339391" id="msg339391">msg339391</a> - <a
    href="msg339391">(view)</a></th>
   <th>Author: Matej Cepl (mcepl) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-04-03 13:35</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>I am trying to investigate the impact of this bug on Python 2.6 (yes, it is for SLE), and I have hard to replicate the steps in the description even on 2.7:

~$ ipython2
Python 2.7.15 (default, May 21 2018, 17:53:03) [GCC]
Type "copyright", "credits" or "license" for more information.

IPython 5.8.0 -- An enhanced Interactive Python.
?         -&gt; Introduction and overview of IPython's features.
%quickref -&gt; Quick reference.
help      -&gt; Python's own help system.
object?   -&gt; Details about 'object', use 'object??' for extra details.

In [1]: from urlparse import urlsplit

In [2]: u = "<a href="https://example.com">https://example.com</a>\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>".encode("idna").decode("ascii") 

In [3]: u
Out[3]: u'<a href="https://example.com">https://example.com</a>\\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>'

In [4]: urlsplit(u).netloc.rpartition('@')[2]
Out[4]: u'bing.com'

In [5]: u = "<a href="https://example.com">https://example.com</a>\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>"

In [6]: urlsplit(u).netloc.rpartition('@')[2]
Out[6]: 'bing.com'

In [7]: u = u.encode("idna").decode("ascii") 

In [8]: urlsplit(u).netloc.rpartition('@')[2]
Out[8]: u'bing.com'

In [9]: import unicodedata

In [10]: u2 = unicodedata.normalize('NFKC', u)

In [11]: u2
Out[11]: u'<a href="https://example.com">https://example.com</a>\\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>'

In [12]: urlsplit(u2)
Out[12]: SplitResult(scheme=u'https', netloc=u'example.com\\<a href="mailto:uFF03@bing.com">uFF03@bing.com</a>', path=u'', query='', fragment='')

In [13]:

Yes, the results are weird, and most likely they would break any software relying on them, but I am not sure that it is a security issue.

vstinner ? steve.dower ? What do you think?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339428" id="msg339428">msg339428</a> - <a
    href="msg339428">(view)</a></th>
   <th>Author: Steve Dower (steve.dower) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-04-04 03:42</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>You need a "u" prefix on some of your strings or they're probably being immediately decomposed. The result of urlsplit should be unicode on Python 2 for a Unicode input, and yours are not.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg339433" id="msg339433">msg339433</a> - <a
    href="msg339433">(view)</a></th>
   <th>Author: Matej Cepl (mcepl) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-04-04 05:31</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>You are right. Thank you.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg393450" id="msg393450">msg393450</a> - <a
    href="msg393450">(view)</a></th>
   <th>Author: Kubilay Kocak (koobs) <img src="@@file/triager.png" title="Python triager" alt="(Python triager)" /></th>
   <th>Date: 2021-05-11 09:57</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Fix meta (not incl 2.7 which is no longer available to select).</pre>
   </td>
  </tr>
 
</table>

<table class="history table table-condensed table-striped"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2021-05-11&nbsp;14:28:00</td><td>larry</td><td>set</td><td>nosy:
  - <a rel="nofollow" href="user2731">larry</a><br /></td></tr>
<tr><td>2021-05-11&nbsp;09:57:21</td><td>koobs</td><td>set</td><td>nosy:
  <a rel="nofollow" href="user2377">vstinner</a>, <a rel="nofollow" href="user2731">larry</a>, <a rel="nofollow" href="user4455">benjamin.peterson</a>, <a rel="nofollow" href="user4624">jkloth</a>, <a rel="nofollow" href="user5248">ned.deily</a>, <a rel="nofollow" href="user5290">mcepl</a>, <a rel="nofollow" href="user7047">ezio.melotti</a>, <a rel="nofollow" href="user11685">jeremy.kloth</a>, <a rel="nofollow" href="user14751">martin.panter</a>, <a rel="nofollow" href="user16276">koobs</a>, <a rel="nofollow" href="user16632">steve.dower</a>, <a rel="nofollow" href="user28746">xtreak</a><br />messages:
  + <a rel="nofollow" href="msg393450">msg393450</a><br />components:
  + Unicode, - FreeBSD<br />versions:
  + Python 3.7, Python 3.8</td></tr>
<tr><td>2021-05-11&nbsp;05:51:48</td><td>dcockcn</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user16276">koobs</a><br />components:
  + FreeBSD, - Unicode<br /></td></tr>
<tr><td>2021-05-11&nbsp;05:51:11</td><td>dcockcn</td><td>set</td><td>versions:
  - Python 2.7, Python 3.4, Python 3.5, Python 3.7, Python 3.8</td></tr>
<tr><td>2019-05-10&nbsp;18:05:52</td><td>ned.deily</td><td>set</td><td>messages:
  - <a rel="nofollow" href="msg342088">msg342088</a></td></tr>
<tr><td>2019-05-10&nbsp;17:36:37</td><td>ned.deily</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg342088">msg342088</a></td></tr>
<tr><td>2019-04-04&nbsp;05:31:15</td><td>mcepl</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339433">msg339433</a></td></tr>
<tr><td>2019-04-04&nbsp;03:42:50</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg339428">msg339428</a></td></tr>
<tr><td>2019-04-03&nbsp;13:35:37</td><td>mcepl</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user5290">mcepl</a><br />messages:
  + <a rel="nofollow" href="msg339391">msg339391</a><br /></td></tr>
<tr><td>2019-03-14&nbsp;12:11:56</td><td>vstinner</td><td>set</td><td>title: urlsplit does not handle NFKC normalization -> CVE-2019-9636: urlsplit does not handle NFKC normalization</td></tr>
<tr><td>2019-03-12&nbsp;21:25:47</td><td>steve.dower</td><td>set</td><td>status: open -> closed<br />resolution: fixed<br />messages:
  + <a rel="nofollow" href="msg337811">msg337811</a><br /><br />stage: patch review -> resolved</td></tr>
<tr><td>2019-03-12&nbsp;20:52:03</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337806">msg337806</a></td></tr>
<tr><td>2019-03-12&nbsp;16:16:04</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337773">msg337773</a></td></tr>
<tr><td>2019-03-12&nbsp;16:09:04</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337771">msg337771</a></td></tr>
<tr><td>2019-03-12&nbsp;15:34:51</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337753">msg337753</a></td></tr>
<tr><td>2019-03-12&nbsp;15:27:07</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12272">pull_request12272</a></td></tr>
<tr><td>2019-03-12&nbsp;08:17:20</td><td>xtreak</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337725">msg337725</a></td></tr>
<tr><td>2019-03-12&nbsp;04:34:05</td><td>ned.deily</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337720">msg337720</a></td></tr>
<tr><td>2019-03-12&nbsp;02:20:00</td><td>jeremy.kloth</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user11685">jeremy.kloth</a><br />messages:
  + <a rel="nofollow" href="msg337711">msg337711</a><br /></td></tr>
<tr><td>2019-03-11&nbsp;22:23:12</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337704">msg337704</a></td></tr>
<tr><td>2019-03-11&nbsp;04:59:26</td><td>larry</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337646">msg337646</a></td></tr>
<tr><td>2019-03-11&nbsp;04:58:50</td><td>larry</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337645">msg337645</a></td></tr>
<tr><td>2019-03-09&nbsp;09:49:04</td><td>jkloth</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user4624">jkloth</a><br />messages:
  + <a rel="nofollow" href="msg337566">msg337566</a><br /></td></tr>
<tr><td>2019-03-08&nbsp;21:29:47</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337532">msg337532</a></td></tr>
<tr><td>2019-03-07&nbsp;18:34:38</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12214">pull_request12214</a></td></tr>
<tr><td>2019-03-07&nbsp;18:31:25</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12213">pull_request12213</a></td></tr>
<tr><td>2019-03-07&nbsp;17:08:47</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337412">msg337412</a></td></tr>
<tr><td>2019-03-07&nbsp;17:08:33</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337411">msg337411</a></td></tr>
<tr><td>2019-03-07&nbsp;16:29:21</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12207">pull_request12207</a></td></tr>
<tr><td>2019-03-07&nbsp;16:11:00</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12205">pull_request12205</a></td></tr>
<tr><td>2019-03-07&nbsp;16:07:01</td><td>steve.dower</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request12203">pull_request12203</a></td></tr>
<tr><td>2019-03-07&nbsp;16:02:31</td><td>steve.dower</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337398">msg337398</a></td></tr>
<tr><td>2019-03-07&nbsp;10:35:26</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg337383">msg337383</a></td></tr>
<tr><td>2019-03-06&nbsp;23:25:00</td><td>xtreak</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user14751">martin.panter</a>, <a rel="nofollow" href="user28746">xtreak</a><br /></td></tr>
<tr><td>2019-03-06&nbsp;17:45:19</td><td>steve.dower</td><td>set</td><td>keywords:
  + <a rel="nofollow" href="keyword2">patch</a><br />stage: needs patch -> patch review<br />pull_requests:
  + <a rel="nofollow" href="pull_request12196">pull_request12196</a></td></tr>
<tr><td>2019-03-06&nbsp;17:37:20</td><td>steve.dower</td><td>create</td><td></td></tr>
</table>

</div>


</div> <!-- content-body -->
<div id="footer">
<div id="credits">
  Hosted on <a href="https://m.do.co/c/783434964889" title="Hosted on DigitalOcean">DigitalOcean</a>,
  <br>
  Supported by <a href="https://python.org/psf-landing/" title="The Python Software Foundation">The Python Software Foundation</a>,
  <br>
  Powered by <a href="http://roundup.sourceforge.net" title="Powered by the Roundup Issue Tracker">Roundup</a>
</div> <!-- credits -->
Copyright &copy; 1990-2020, <a href="http://python.org/psf">Python Software Foundation</a><br />
<a href="http://python.org/about/legal">Legal Statements</a>
</div> <!-- footer -->
</div> <!-- body-main -->
</div> <!-- content -->



</body>
</html>

