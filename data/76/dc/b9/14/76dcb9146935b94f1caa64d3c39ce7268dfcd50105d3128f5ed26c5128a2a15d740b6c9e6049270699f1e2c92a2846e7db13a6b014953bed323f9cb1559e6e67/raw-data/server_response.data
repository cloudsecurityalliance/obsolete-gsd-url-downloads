
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>
Issue 34656: [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393 - Python tracker

</title>
<link rel="shortcut icon" href="@@file/favicon.ico" />
<link rel="stylesheet" type="text/css" href="@@file/main.css" />
<link rel="stylesheet" type="text/css" href="@@file/style.css" />
<link rel="search" type="application/opensearchdescription+xml" href="@@file/osd.xml" title="Python bug tracker search" />
<meta http-equiv="Content-Type"
      content="text/html; charset=utf-8" />

<script nonce="a64ced87c74b83bcfe49248b4190524dfa9f171929b6be68e6b9d2718540961e" type="text/javascript">
submitted = false;
function submit_once() {
    if (submitted) {
        alert("Your request is being processed.\nPlease be patient.");
        return false;
    }
    submitted = true;
    return true;
}

function help_window(helpurl, width, height) {
    HelpWin = window.open('https://bugs.python.org/' + helpurl, 'RoundupHelpWindow', 'scrollbars=yes,resizable=yes,toolbar=no,height='+height+',width='+width);
    HelpWin.focus ()
}
</script>


<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.js"></script>
<script type="text/javascript" src="@@file/issue.item.js"></script>
<link rel="stylesheet" type="text/css" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/smoothness/jquery-ui.css" />


</head>
<body>
  <!--  Logo  -->
  <h1 id="logoheader">
    <a accesskey="1" href="." id="logolink">
       <img src="@@file/python-logo.gif" alt="homepage" border="0" id="logo" /></a>
  </h1>

<div id="utility-menu">
<!-- Search Box -->
<div id="searchbox">
    <form name="searchform" method="get" action="issue" id="searchform">
      <div id="search">
       <input type="hidden" name="@columns"
              value="id,activity,title,creator,assignee,status,type" />
       <input type="hidden" name="@sort" value="-activity" />
       <input type="hidden" name="@filter" value="status" />
       <input type="hidden" name="@action" value="searchid" />
       <input type="hidden" name="ignore" value="file:content" />
       <input class="input-text" id="search-text"
              name="@search_text" size="10" />
       <input type="submit" id="submit" value="search" name="submit" class="input-button" />
       <input type="radio" name="status"
              id="status_notresolved" value="-1,1,3" />
       <label for="status_notresolved">open</label>
       <input type="radio" name="status" checked="checked"
              id="status_all" value="-1,1,2,3" />
       <label for="status_all">all</label>
      </div>
     </form>
</div>
</div>


<div id="left-hand-navigation">
<!--  Main Menu NEED LEVEL TWO HEADER AND FOOTER -->
<div id="menu">
  <ul class="level-one">
    <li><a href="https://www.python.org/" title="Go to the Python homepage">Python Home</a></li>
    <li><a href="https://www.python.org/about/" title="About The Python Language">About</a></li>
    <li><a href="https://www.python.org/blogs/" title="">News</a></li>
    <li><a href="https://www.python.org/doc/" title="">Documentation</a></li>
    <li><a href="https://www.python.org/downloads/" title="">Downloads</a></li>
    <li><a href="https://www.python.org/community/" title="">Community</a></li>
    <li><a href="https://www.python.org/psf/" title="Python Software Foundation">Foundation</a></li>
    <li><a href="https://devguide.python.org/" title="Python Developer's Guide">Developer's Guide</a></li>
    <li class="selected"><a href="." class="selected" title="Python Issue Tracker">Issue Tracker</a>
      <ul class="level-two">
        <li>
          <strong>Issues</strong>
          <ul class="level-three">
            
            <li><a href="issue?@template=search&amp;status=1">Search</a></li>
            <li><a href="issue?@action=random">Random Issue</a></li>
            <li>
              <form method="post" action="issue34656">
                <input type="submit" class="form-small"
                       value="Show issue:" />
                <input class="form-small" size="4" type="text" name="@number" />
                <input type="hidden" name="@type" value="issue" />
                <input type="hidden" name="@action" value="show" />
              </form>
            </li>
          </ul>
        </li>


        <li>
          <strong>Summaries</strong>
          <ul class="level-three">
            

            

            

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Issues%20with%20patch&amp;@startwith=0&amp;@group=priority&amp;keywords=2&amp;@action=search&amp;@filter=&amp;@pagesize=50">Issues with patch</a>
            </li>

            <li>
              <a href="issue?status=1&amp;@sort=-activity&amp;@columns=id%2Cactivity%2Ctitle%2Ccreator%2Cstatus&amp;@dispname=Easy%20issues&amp;@startwith=0&amp;@group=priority&amp;keywords=6&amp;@action=search&amp;@filter=&amp;@pagesize=50">Easy issues</a>
            </li>

            <li>
              <a href="issue?@template=stats">Stats</a>
            </li>

          </ul>
        </li>


        <li>
          <strong>User</strong>
          <form method="post" action="issue34656">
          <ul class="level-three">
            <li>
                Login&nbsp;(OpenID&nbsp;possible)<br />
	         <a style="display:inline;width:0;margin:0"
             href="issue34656?@action=oic_login&amp;provider=Google">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.google.com/favicon.ico"
                       alt="Google" title="Google" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue34656?@action=oic_login&amp;provider=GitHub">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://www.github.com/favicon.ico"
                       alt="GitHub" title="GitHub" /></a>
	         <a style="display:inline;width:0;margin:0"
             href="issue34656?@action=openid_login&amp;provider=Launchpad">
                  <img hspace="0" vspace="0" width="16"
                       height="16"
                       src="https://launchpad.net/favicon.ico"
                       alt="Launchpad" title="Launchpad" /></a>
                <input size="10" name="openid_identifier" style="background:url(@@file/openid-16x16.gif)
                  center left no-repeat;padding-left:16px" /><br />
                <input size="10" type="password" name="__login_password" /><br />
                <input type="hidden" name="@action" value="Login" />
                <input type="checkbox" name="remember" id="remember" />
                <label for="remember">Remember me?</label><br />
                <input class="form-small" type="submit"
                       value="Login" /><br />
                <input type="hidden" name="__came_from"
                       value="https://bugs.python.org/issue34656?">
                
                <input type="hidden" name="@sort" value=""/>
<input type="hidden" name="@group" value=""/>
<input type="hidden" name="@pagesize" value="50"/>
<input type="hidden" name="@startwith" value="0"/>
            </li>
            <li>
                <a href="user?@template=register">Register</a>
            </li>
            <li><a href="user?@template=forgotten">Lost&nbsp;your&nbsp;login?</a></li>
          </ul>
          </form>
        </li>

        

        

        <li>
          <strong>Administration</strong>
          <ul class="level-three">
            
            <li>
                <a href="user?@sort=username">User List</a></li>
            <li>
                <a href="user?iscommitter=1&amp;@action=search&amp;@sort=username&amp;@pagesize=300">Committer List</a></li>
            
            
            
          </ul>
        </li>

        <li>
          <strong>Help</strong>
          <ul class="level-three">
            <li><a href="http://docs.python.org/devguide/triaging.html">
                Tracker Documentation</a></li>
            <li><a href="http://wiki.python.org/moin/TrackerDevelopment">
                Tracker Development</a></li>
            <li><a href="https://github.com/python/psf-infra-meta/issues">
                Report Tracker Problem</a></li>
          </ul>
        </li>

      </ul>
    </li>
  </ul>
</div> <!-- menu -->
</div> <!-- left-hand-navigation -->

<div id="content-body">
<div id="body-main">
<div id="content">
<div id="breadcrumb">
 
 
 Issue34656
 
</div>
 
 





<div>

<form method="post" name="itemSynopsis"
      onsubmit="return submit_once()"
      enctype="multipart/form-data" action="issue34656">

<fieldset><legend>classification</legend>
<table class="form">
<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#title" target="_blank">Title</a>:</th>
 
 <td colspan="3">
  <span>[CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393</span>
  <input type="hidden" name="title"
         value="[CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393">
 </td>
</tr>

<tr>
 <th class="required"><a href="http://docs.python.org/devguide/triaging.html#type" target="_blank">Type</a>:</th>
 <td>security</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#stage" target="_blank">Stage</a>:</th>
 <td>resolved</td>
</tr>

<tr>
 <th><a href="http://docs.python.org/devguide/triaging.html#components" target="_blank">Components</a>:</th>
 <td>Library (Lib)</td>
 <th><a href="http://docs.python.org/devguide/triaging.html#versions" target="_blank">Versions</a>:</th>
 <td>Python 3.8, Python 3.7, Python 3.6, Python 3.4, Python 3.5</td>
</tr>
</table>
</fieldset>

<fieldset><legend>process</legend>
<table class="form">
<tr>
  <th><a href="http://docs.python.org/devguide/triaging.html#status" target="_blank">Status</a>:</th>
  <td>closed</td>
  <th><a href="http://docs.python.org/devguide/triaging.html#resolution" target="_blank">Resolution</a>:</th>
  <td>fixed</td>
</tr>

<tr>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#dependencies"
       target="_blank">Dependencies</a>:
 </th>
 <td>
  
  
 </td>
 <th><a href="http://docs.python.org/devguide/triaging.html#superseder" target="_blank">Superseder</a>:</th>
 <td>
  
 
 </td>
 </tr>
 <tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#assigned-to"
      target="_blank">Assigned To</a>:
 </th>
 
 <td>
  
 </td>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#nosy-list"
      target="_blank">Nosy List</a><!--
        <span tal:condition="context/nosy_count" tal:replace="python: ' (%d)' % context.nosy_count" /> -->:
 </th>
 <td>
     dfmz77669, larry, ned.deily, vstinner
     
 </td>
</tr>
<tr>
 <th>
   <a href="http://docs.python.org/devguide/triaging.html#priority"
      target="_blank">Priority</a>:
 </th>
 <td>normal</td>
 <th>
    <a href="http://docs.python.org/devguide/triaging.html#keywords"
       target="_blank">Keywords</a>:
 </th>
 <td>patch</td>


</tr>









</table>
</fieldset>

</form>

<p>Created on <strong>2018-09-13 04:38</strong> by <strong>shuoz</strong>, last changed <strong>2019-05-10 18:14</strong> by <strong>ned.deily</strong>. This issue is now <strong style="color:#00F; background-color:inherit;">closed</strong>.</p>

<table class="files">
 <tr><th colspan="5" class="header">Files</th></tr>
 <tr>
  <th>File name</th>
  <th>Uploaded</th>
  <th>Description</th>
  <th>Edit</th>
 </tr>
 <tr>
  <td>
   <a href="file47801/poc">poc</a>
  </td>
  <td>
   <span>shuoz</span>,
   <span>2018-09-13 04:38</span>
  </td>
  <td></td>
  <td>
      
      
      
  </td>
 </tr>
 <tr>
  <td>
   <a href="file47802/pk.py">pk.py</a>
  </td>
  <td>
   <span>shuoz</span>,
   <span>2018-09-13 04:53</span>
  </td>
  <td></td>
  <td>
      
      
      
  </td>
 </tr>
 <tr>
  <td>
   <a href="file48073/CVE-2018-20406-pickle_LONG_BINPUT.patch">CVE-2018-20406-pickle_LONG_BINPUT.patch</a>
  </td>
  <td>
   <span>mcepl</span>,
   <span>2019-01-23 17:24</span>
  </td>
  <td>Patch updated for Python 3.4.*</td>
  <td>
      
      
      
  </td>
 </tr>
</table>

<table class="files">
 <tr><th class="header" colspan="4">Pull Requests</th></tr>
 <tr>
  <th>URL</th>
  <th>Status</th>
  <th>Linked</th>
  <th>Edit</th>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/9261" title="bpo-34656: Avoid relying on signed overflow in _pickle memos.">PR 9261</a></td>
  <td>merged</td>
  <td>
   <span>benjamin.peterson</span>,
   <span>2018-09-14 00:55</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/9465" title="[3.7] closes bpo-34656: Avoid relying on signed overflow in _pickle memos. (GH-9261)">PR 9465</a></td>
  <td>merged</td>
  <td>
   <span>miss-islington</span>,
   <span>2018-09-21 01:36</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/9466" title="[3.6] closes bpo-34656: Avoid relying on signed overflow in _pickle memos. (GH-9261)">PR 9466</a></td>
  <td>merged</td>
  <td>
   <span>miss-islington</span>,
   <span>2018-09-21 01:37</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/11869" title="[3.5] bpo-34656: Avoid relying on signed overflow in _pickle memos (GH-9261)">PR 11869</a></td>
  <td>merged</td>
  <td>
   <span>vstinner</span>,
   <span>2019-02-15 11:44</span>
  </td>
  <td>
    
  </td>
 </tr>
 <tr>
  <td><a href="https://github.com/python/cpython/pull/11870" title="[3.4] bpo-34656: Avoid relying on signed overflow in _pickle memos (GH-9261)">PR 11870</a></td>
  <td>merged</td>
  <td>
   <span>vstinner</span>,
   <span>2019-02-15 11:46</span>
  </td>
  <td>
    
  </td>
 </tr>
</table>





<table class="messages">
 <tr><th colspan="4" class="header">Messages (18)</th></tr>
 
  <tr>
    <th>
     <a href="#msg325230" id="msg325230">msg325230</a> - <a
    href="msg325230">(view)</a></th>
   <th>Author: shuoz (shuoz)</th>
   <th>Date: 2018-09-13 04:38</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>python version:
   Python 3.8.0a0 (heads/master:4ae8ece, Sep 13 2018, 09:48:16) 
   [GCC 5.4.0 20160609] on linux


I found a bug in python pickle.load func. Can cause memory exhaustion DDOS.

./python pk.py poc


cat ./pk.py
import pickle
import sys
filename = sys.argv[1]
with open(filename, 'rb') as f:
    aa = pickle.load(f)
    print(aa)</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg325231" id="msg325231">msg325231</a> - <a
    href="msg325231">(view)</a></th>
   <th>Author: shuoz (shuoz)</th>
   <th>Date: 2018-09-13 04:55</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>[----------------------------------registers-----------------------------------]
RAX: 0x7ff9d401e010 --&gt; 0x0 
RBX: 0x7ffff7f48d00 --&gt; 0x1 
RCX: 0x7ff8ab58c800 --&gt; 0x7ffff7ea5d80 --&gt; 0x2 
RDX: 0x7ffff3ac47d8 --&gt; 0x1 
RSI: 0x25152303 
RDI: 0xfff3a803c00 --&gt; 0x0 
RBP: 0x7473078c 
RSP: 0x7fffffffcf20 --&gt; 0x7ffff3ac47d8 --&gt; 0x1 
RIP: 0x7ffff28a8a64 (&lt;_Unpickler_MemoPut+1668&gt;:	add    r11,0x20)
R8 : 0xfff3a803bff --&gt; 0x0 
R9 : 0xfff3a803c01 --&gt; 0x0 
R10: 0xffffefe91a3 --&gt; 0x0 
R11: 0x128a917f8 --&gt; 0x0 
R12: 0xfff156b1922 --&gt; 0x0 
R13: 0xe8e60f18 --&gt; 0x0 
R14: 0x7ffff7f48d18 --&gt; 0x7ff8ab58c800 --&gt; 0x7ffff7ea5d80 --&gt; 0x2 
R15: 0xfff3a803c02 --&gt; 0x0
EFLAGS: 0x216 (carry PARITY ADJUST zero sign trap INTERRUPT direction overflow)
[-------------------------------------code-------------------------------------]
   0x7ffff28a8a52 &lt;_Unpickler_MemoPut+1650&gt;:	cmp    BYTE PTR [r15+0x7fff8000],0x0
   0x7ffff28a8a5a &lt;_Unpickler_MemoPut+1658&gt;:	jne    0x7ffff28a8ae1 &lt;_Unpickler_MemoPut+1793&gt;
   0x7ffff28a8a60 &lt;_Unpickler_MemoPut+1664&gt;:	add    rsi,0x4
=&gt; 0x7ffff28a8a64 &lt;_Unpickler_MemoPut+1668&gt;:	add    r11,0x20
   0x7ffff28a8a68 &lt;_Unpickler_MemoPut+1672&gt;:	cmp    BYTE PTR [r10+0x7fff8000],0x0
   0x7ffff28a8a70 &lt;_Unpickler_MemoPut+1680&gt;:	mov    QWORD PTR [rax],0x0
   0x7ffff28a8a77 &lt;_Unpickler_MemoPut+1687&gt;:	je     0x7ffff28a896d &lt;_Unpickler_MemoPut+1421&gt;
   0x7ffff28a8a7d &lt;_Unpickler_MemoPut+1693&gt;:	nop    DWORD PTR [rax]
[------------------------------------stack-------------------------------------]
0000| 0x7fffffffcf20 --&gt; 0x7ffff3ac47d8 --&gt; 0x1 
0008| 0x7fffffffcf28 --&gt; 0xffffefe91a3 --&gt; 0x0 
0016| 0x7fffffffcf30 --&gt; 0x7ffff7f48da8 --&gt; 0x20 (' ')
0024| 0x7fffffffcf38 --&gt; 0x7ffff7f48d00 --&gt; 0x1 
0032| 0x7fffffffcf40 --&gt; 0xffffffffa00 --&gt; 0x0 
0040| 0x7fffffffcf48 --&gt; 0x0 
0048| 0x7fffffffcf50 --&gt; 0x7ffff7f48da0 --&gt; 0x28 ('(')
0056| 0x7fffffffcf58 --&gt; 0x7ffff7f48da8 --&gt; 0x20 (' ')
[------------------------------------------------------------------------------]
Legend: code, data, rodata, value
0x00007ffff28a8a64	1392	    for (i = self-&gt;memo_size; i &lt; new_size; i++)
gdb-peda$ p new_size
$5 = 0xe8e60f18
gdb-peda$ p self-&gt;memo_size
$6 = 0x20
gdb-peda$ p i


.....
for (i = self-&gt;memo_size; i &lt; new_size; i++)
        self-&gt;memo[i] = NULL;
.....</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg325430" id="msg325430">msg325430</a> - <a
    href="msg325430">(view)</a></th>
   <th>Author: Serhiy Storchaka (serhiy.storchaka) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2018-09-15 11:02</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt;&gt;&gt; import pickletools
&gt;&gt;&gt; pickletools.dis(b'\x80\x04\x95\x1d\x00\x00\x00\x00\x00\x00\x00}\x94(\x8c\x03age\x94K\x17\x8c\x03jobr\x8c\x07student\x94u.')
    0: \x80 PROTO      4
    2: \x95 FRAME      29
   11: }    EMPTY_DICT
   12: \x94 MEMOIZE    (as 0)
   13: (    MARK
   14: \x8c     SHORT_BINUNICODE 'age'
   19: \x94     MEMOIZE    (as 1)
   20: K        BININT1    23
   22: \x8c     SHORT_BINUNICODE 'job'
   27: r        LONG_BINPUT <a href="https://hg.python.org/lookup/1953695628">1953695628</a>
   32: u        SETITEMS   (MARK at 13)
   33: d    DICT       no MARK exists on stack
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/home/serhiy/py/cpython/Lib/<a href="https://github.com/python/cpython/blob/main/Lib/pickletools.py#L2457">pickletools.py</a>", line 2457, in dis
    raise ValueError(errormsg)
ValueError: no MARK exists on stack

Ignore the error of unbalanced MARK. The problem code is LONG_BINPUT with the excessive large argument <a href="https://hg.python.org/lookup/1953695628">1953695628</a>. The C implementation of pickle tries to resize the the memo list to the size twice larger than this index. And here an integer overflow occurred.

This unlikely occurred in real world. The pickle needs to have more than 2**30-1 ≈ 10**9 memoized items for encountering this bug. It means that its size on disk and in memory should be tens or hundreds of gigabytes. Pickle is not the best format for serializing such amount of data.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg325937" id="msg325937">msg325937</a> - <a
    href="msg325937">(view)</a></th>
   <th>Author: Benjamin Peterson (benjamin.peterson) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2018-09-21 01:36</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd">a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd</a> by Benjamin Peterson in branch 'master':
closes <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos. (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>)
<a href="https://github.com/python/cpython/commit/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd">https://github.com/python/cpython/commit/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg325938" id="msg325938">msg325938</a> - <a
    href="msg325938">(view)</a></th>
   <th>Author: miss-islington (miss-islington)</th>
   <th>Date: 2018-09-21 01:52</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/ef4306b24c9034d6b37bb034e2ebe82e745d4b77">ef4306b24c9034d6b37bb034e2ebe82e745d4b77</a> by Miss Islington (bot) in branch '3.7':
closes <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos. (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>)
<a href="https://github.com/python/cpython/commit/ef4306b24c9034d6b37bb034e2ebe82e745d4b77">https://github.com/python/cpython/commit/ef4306b24c9034d6b37bb034e2ebe82e745d4b77</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg325939" id="msg325939">msg325939</a> - <a
    href="msg325939">(view)</a></th>
   <th>Author: miss-islington (miss-islington)</th>
   <th>Date: 2018-09-21 02:00</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/71a9c65e74a70b6ed39adc4ba81d311ac1aa2acc">71a9c65e74a70b6ed39adc4ba81d311ac1aa2acc</a> by Miss Islington (bot) in branch '3.6':
closes <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos. (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>)
<a href="https://github.com/python/cpython/commit/71a9c65e74a70b6ed39adc4ba81d311ac1aa2acc">https://github.com/python/cpython/commit/71a9c65e74a70b6ed39adc4ba81d311ac1aa2acc</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg333292" id="msg333292">msg333292</a> - <a
    href="msg333292">(view)</a></th>
   <th>Author: Miro Hrončok (hroncok) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-01-09 08:08</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Should this go to 3.4 and 3.5 as well, since it is a security thing?

<a href="http://people.canonical.com/~ubuntu-security/cve/2018/CVE-2018-20406.html">http://people.canonical.com/~ubuntu-security/cve/2018/CVE-2018-20406.html</a></pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg333294" id="msg333294">msg333294</a> - <a
    href="msg333294">(view)</a></th>
   <th>Author: Serhiy Storchaka (serhiy.storchaka) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-01-09 09:33</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>I am not sure this issue should be classified as a security issue. It can cause DDOS, because pickle should not be used with untrusted data. If it is used, the program has more severe security issues than just DDOS.

The crash could be triggered by accident, but this is very unlikely. I doubts that this happened even once in real world.  Libraries used for handling a large amount of data (like NumPy) use more efficient pickle representation, and can provide even more efficient alternate serialization methods. Note that integers and floats are not memoized, this increases the complexity and size of data that could be affected by this bug.

But I think that this fix needs a news entry. Do you mind to add it Benjamin?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334108" id="msg334108">msg334108</a> - <a
    href="msg334108">(view)</a></th>
   <th>Author: Matej Cepl (mcepl) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-01-20 23:18</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Does it even make sense to make a security patch for 2.7 for this one?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334179" id="msg334179">msg334179</a> - <a
    href="msg334179">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-01-21 20:58</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Python 2.7 is not affected:

* Python 2.7 has no C accelerator _pickle (<a href="https://github.com/python/cpython/blob/master/Modules/_pickle.c">Modules/_pickle.c</a>)
* Python 2.7 doesn't support protocol 4 (attached proof of concept)

I reopen the issue because the issue should be fixed in 3.4 and 3.5 as well, since it has been marked as a vulnerability (it got a CVE number).</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334183" id="msg334183">msg334183</a> - <a
    href="msg334183">(view)</a></th>
   <th>Author: Matej Cepl (mcepl) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-01-21 21:47</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; * Python 2.7 has no C accelerator _pickle (<a href="https://github.com/python/cpython/blob/master/Modules/_pickle.c">Modules/_pickle.c</a>)

And <a href="https://github.com/python/cpython/blob/master/Modules/cPickle.c">Modules/cPickle.c</a> is that drastically different?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334208" id="msg334208">msg334208</a> - <a
    href="msg334208">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-01-22 12:24</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>&gt; And <a href="https://github.com/python/cpython/blob/master/Modules/cPickle.c">Modules/cPickle.c</a> is that drastically different?

Stupid me. I was surprised that Python 2.7 had no C accelerator. I was looking for Modules/*pickle*.c on my case sensitive Linux filesystem...</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334209" id="msg334209">msg334209</a> - <a
    href="msg334209">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-01-22 12:34</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>New changeset <a href="https://hg.python.org/lookup/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd">a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd</a> by Benjamin Peterson in branch 'master':
closes <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos. (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>)
<a href="https://github.com/python/cpython/commit/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd">https://github.com/python/cpython/commit/a4ae828ee416a66d8c7bf5ee71d653c2cc6a26dd</a>

It seems like this patch changes the implementation of the internal "memo" object which is a custom C type in Python 3.

In Python 2 cPickle, the memo is a regular dictionary and so I'm not sure that Python 2 is affected by this vulnerability.

Can someone please confirm?</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg334267" id="msg334267">msg334267</a> - <a
    href="msg334267">(view)</a></th>
   <th>Author: Matej Cepl (mcepl) <span title="Contributor form received">*</span></th>
   <th>Date: 2019-01-23 17:24</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>Python 3.4 doesn't allow C99 constructs, so I had to update the patch to reorder iterator declarations. Just if any future colleague Python Linux distro maintainer needs it.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg336381" id="msg336381">msg336381</a> - <a
    href="msg336381">(view)</a></th>
   <th>Author: dfmz77669 (dfmz77669)</th>
   <th>Date: 2019-02-23 14:14</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>In python2, Picklertype donot has tp init which has bug in python3 Pickler_Type.
I think it not effect python2.
Can you arch more infor?
thanks</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg336508" id="msg336508">msg336508</a> - <a
    href="msg336508">(view)</a></th>
   <th>Author: STINNER Victor (vstinner) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-02-25 10:12</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>As I wrote in my previous comment, I don't think that Python 2.7 is affected by this issue.</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg336568" id="msg336568">msg336568</a> - <a
    href="msg336568">(view)</a></th>
   <th>Author: Larry Hastings (larry) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-02-25 22:44</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/4b42d575bf0fb01192b3ec54b7e224b238691527">4b42d575bf0fb01192b3ec54b7e224b238691527</a> by larryhastings (Victor Stinner) in branch '3.4':
[3.4] <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>) (<a class="closed" title="[closed] test_3_join_in_forked_from_thread() of test_threading hangs 1 hour on 'x86 Ubuntu Shared 3.x'" href="issue11870">#11870</a>)
<a href="https://github.com/python/cpython/commit/4b42d575bf0fb01192b3ec54b7e224b238691527">https://github.com/python/cpython/commit/4b42d575bf0fb01192b3ec54b7e224b238691527</a>
</pre>
   </td>
  </tr>
 
 
  <tr>
    <th>
     <a href="#msg336589" id="msg336589">msg336589</a> - <a
    href="msg336589">(view)</a></th>
   <th>Author: Larry Hastings (larry) <span title="Contributor form received">*</span> <img src="@@file/committer.png" title="Python committer" alt="(Python committer)" /></th>
   <th>Date: 2019-02-26 00:41</th>
  </tr>
  <tr>
   <td colspan="4" class="content">
    
    <pre>
New changeset <a href="https://hg.python.org/lookup/ef33dd6036aafbd3f06c1d56e2b1a81dae3da63c">ef33dd6036aafbd3f06c1d56e2b1a81dae3da63c</a> by larryhastings (Victor Stinner) in branch '3.5':
closes <a class="closed" title="[closed] [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393" href="issue34656">bpo-34656</a>: Avoid relying on signed overflow in _pickle memos. (<a href="https://github.com/python/cpython/pull/9261" class="closed" title="GitHub PR 9261: [merged] [3.10] bpo-44904: Fix classmethod property bug in doctest module (GH-28838)">GH-9261</a>) (<a class="closed" title="[closed] Include information about the bug tracker Rietveld code review tool" href="issue11869">#11869</a>)
<a href="https://github.com/python/cpython/commit/ef33dd6036aafbd3f06c1d56e2b1a81dae3da63c">https://github.com/python/cpython/commit/ef33dd6036aafbd3f06c1d56e2b1a81dae3da63c</a>
</pre>
   </td>
  </tr>
 
</table>

<table class="history table table-condensed table-striped"><tr><th colspan="4" class="header">
History
</th></tr><tr>
<th>Date</th>
<th>User</th>
<th>Action</th>
<th>Args</th>
</tr>
<tr><td>2019-05-10&nbsp;18:14:59</td><td>ned.deily</td><td>set</td><td>messages:
  - <a rel="nofollow" href="msg342084">msg342084</a></td></tr>
<tr><td>2019-05-10&nbsp;17:36:37</td><td>ned.deily</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user5248">ned.deily</a><br />messages:
  + <a rel="nofollow" href="msg342084">msg342084</a><br /></td></tr>
<tr><td>2019-02-26&nbsp;00:41:36</td><td>larry</td><td>set</td><td>status: open -> closed<br />resolution: fixed<br />messages:
  + <a rel="nofollow" href="msg336589">msg336589</a><br /><br />stage: patch review -> resolved</td></tr>
<tr><td>2019-02-25&nbsp;22:44:16</td><td>larry</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user2731">larry</a><br />messages:
  + <a rel="nofollow" href="msg336568">msg336568</a><br /></td></tr>
<tr><td>2019-02-25&nbsp;10:12:46</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg336508">msg336508</a><br />components:
  + Library (Lib), - ctypes<br />versions:
  + Python 3.4, Python 3.5, Python 3.6, Python 3.7, Python 3.8, - Python 2.7</td></tr>
<tr><td>2019-02-23&nbsp;14:14:10</td><td>dfmz77669</td><td>set</td><td>versions:
  - Python 3.4, Python 3.5, Python 3.6, Python 3.7, Python 3.8<br />nosy:
  + <a rel="nofollow" href="user30670">dfmz77669</a><br /><br />messages:
  + <a rel="nofollow" href="msg336381">msg336381</a><br /><br />components:
  + ctypes, - FreeBSD</td></tr>
<tr><td>2019-02-23&nbsp;13:42:06</td><td>dfmz77669</td><td>set</td><td>nosy:
  - <a rel="nofollow" href="user3805">alexandre.vassalotti</a>, <a rel="nofollow" href="user4455">benjamin.peterson</a>, <a rel="nofollow" href="user5290">mcepl</a>, <a rel="nofollow" href="user15623">serhiy.storchaka</a>, <a rel="nofollow" href="user25227">hroncok</a>, <a rel="nofollow" href="user27838">miss-islington</a>, <a rel="nofollow" href="user28746">xtreak</a>, <a rel="nofollow" href="user29448">shuoz</a><br /></td></tr>
<tr><td>2019-02-15&nbsp;11:46:03</td><td>vstinner</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request11903">pull_request11903</a></td></tr>
<tr><td>2019-02-15&nbsp;11:44:19</td><td>vstinner</td><td>set</td><td>stage: resolved -> patch review<br />pull_requests:
  + <a rel="nofollow" href="pull_request11902">pull_request11902</a></td></tr>
<tr><td>2019-01-23&nbsp;17:24:30</td><td>mcepl</td><td>set</td><td>files:
  + <a rel="nofollow" href="file48073">CVE-2018-20406-pickle_LONG_BINPUT.patch</a><br /><br />messages:
  + <a rel="nofollow" href="msg334267">msg334267</a></td></tr>
<tr><td>2019-01-22&nbsp;12:34:09</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg334209">msg334209</a></td></tr>
<tr><td>2019-01-22&nbsp;12:24:56</td><td>vstinner</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg334208">msg334208</a><br />versions:
  + Python 2.7</td></tr>
<tr><td>2019-01-21&nbsp;21:47:40</td><td>mcepl</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg334183">msg334183</a></td></tr>
<tr><td>2019-01-21&nbsp;20:58:29</td><td>vstinner</td><td>set</td><td>status: closed -> open<br />versions:
  + Python 3.4, Python 3.5, Python 3.6, Python 3.7<br />nosy:
  + <a rel="nofollow" href="user2377">vstinner</a><br /><br />messages:
  + <a rel="nofollow" href="msg334179">msg334179</a><br /><br />resolution: fixed -> (no value)</td></tr>
<tr><td>2019-01-21&nbsp;20:41:36</td><td>vstinner</td><td>set</td><td>title: memory exhaustion in Modules/_pickle.c:1393 -> [CVE-2018-20406] memory exhaustion in Modules/_pickle.c:1393</td></tr>
<tr><td>2019-01-20&nbsp;23:18:13</td><td>mcepl</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user5290">mcepl</a><br />messages:
  + <a rel="nofollow" href="msg334108">msg334108</a><br /></td></tr>
<tr><td>2019-01-09&nbsp;09:33:25</td><td>serhiy.storchaka</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg333294">msg333294</a></td></tr>
<tr><td>2019-01-09&nbsp;08:08:59</td><td>hroncok</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user25227">hroncok</a><br />messages:
  + <a rel="nofollow" href="msg333292">msg333292</a><br /></td></tr>
<tr><td>2018-09-21&nbsp;02:00:41</td><td>miss-islington</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg325939">msg325939</a></td></tr>
<tr><td>2018-09-21&nbsp;01:52:40</td><td>miss-islington</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user27838">miss-islington</a><br />messages:
  + <a rel="nofollow" href="msg325938">msg325938</a><br /></td></tr>
<tr><td>2018-09-21&nbsp;01:37:06</td><td>miss-islington</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request8879">pull_request8879</a></td></tr>
<tr><td>2018-09-21&nbsp;01:36:57</td><td>miss-islington</td><td>set</td><td>pull_requests:
  + <a rel="nofollow" href="pull_request8878">pull_request8878</a></td></tr>
<tr><td>2018-09-21&nbsp;01:36:50</td><td>benjamin.peterson</td><td>set</td><td>status: open -> closed<br /><br />nosy:
  + <a rel="nofollow" href="user4455">benjamin.peterson</a><br />messages:
  + <a rel="nofollow" href="msg325937">msg325937</a><br /><br />resolution: fixed<br />stage: patch review -> resolved</td></tr>
<tr><td>2018-09-15&nbsp;11:02:11</td><td>serhiy.storchaka</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg325430">msg325430</a></td></tr>
<tr><td>2018-09-14&nbsp;04:04:40</td><td>koobs</td><td>set</td><td>nosy:
  - <a rel="nofollow" href="user16276">koobs</a><br /></td></tr>
<tr><td>2018-09-14&nbsp;00:55:24</td><td>benjamin.peterson</td><td>set</td><td>keywords:
  + <a rel="nofollow" href="keyword2">patch</a><br />stage: patch review<br />pull_requests:
  + <a rel="nofollow" href="pull_request8718">pull_request8718</a></td></tr>
<tr><td>2018-09-13&nbsp;09:47:19</td><td>xtreak</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user28746">xtreak</a><br /></td></tr>
<tr><td>2018-09-13&nbsp;05:46:03</td><td>serhiy.storchaka</td><td>set</td><td>nosy:
  + <a rel="nofollow" href="user3805">alexandre.vassalotti</a>, <a rel="nofollow" href="user15623">serhiy.storchaka</a><br /></td></tr>
<tr><td>2018-09-13&nbsp;04:55:08</td><td>shuoz</td><td>set</td><td>messages:
  + <a rel="nofollow" href="msg325231">msg325231</a></td></tr>
<tr><td>2018-09-13&nbsp;04:53:32</td><td>shuoz</td><td>set</td><td>files:
  + <a rel="nofollow" href="file47802">pk.py</a></td></tr>
<tr><td>2018-09-13&nbsp;04:38:47</td><td>shuoz</td><td>create</td><td></td></tr>
</table>

</div>


</div> <!-- content-body -->
<div id="footer">
<div id="credits">
  Hosted on <a href="https://m.do.co/c/783434964889" title="Hosted on DigitalOcean">DigitalOcean</a>,
  <br>
  Supported by <a href="https://python.org/psf-landing/" title="The Python Software Foundation">The Python Software Foundation</a>,
  <br>
  Powered by <a href="http://roundup.sourceforge.net" title="Powered by the Roundup Issue Tracker">Roundup</a>
</div> <!-- credits -->
Copyright &copy; 1990-2020, <a href="http://python.org/psf">Python Software Foundation</a><br />
<a href="http://python.org/about/legal">Legal Statements</a>
</div> <!-- footer -->
</div> <!-- body-main -->
</div> <!-- content -->



</body>
</html>

