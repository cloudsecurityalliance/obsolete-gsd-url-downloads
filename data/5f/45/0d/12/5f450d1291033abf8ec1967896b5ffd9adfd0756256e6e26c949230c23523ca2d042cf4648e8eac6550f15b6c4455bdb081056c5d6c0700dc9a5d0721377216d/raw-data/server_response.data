<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - NTLM buffer overflow via integer overflow - CVE-2017-8816</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>NTLM buffer overflow via integer overflow</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="ntlm-buffer-overflow-via-integer-overflow">NTLM buffer overflow via integer overflow</h1>
<p>Project curl Security Advisory, November 29th 2017 - <a href="https://curl.se/docs/CVE-2017-8816.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>libcurl contains a buffer overrun flaw in the NTLM authentication code.</p>
<p>The internal function <code>Curl_ntlm_core_mk_ntlmv2_hash</code> sums up the lengths of the user name + password (= SUM) and multiplies the sum by two (= SIZE) to figure out how large storage to allocate from the heap.</p>
<p>The SUM value is subsequently used to iterate over the input and generate output into the storage buffer. On systems with a 32 bit <code>size_t</code>, the math to calculate SIZE triggers an integer overflow when the combined lengths of the user name and password is larger than 2GB (2^31 bytes). This integer overflow usually causes a very small buffer to actually get allocated instead of the intended very huge one, making the use of that buffer end up in a buffer overrun.</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This bug was introduced in commit <a href="https://github.com/curl/curl/commit/86724581b6c02d160b5">86724581b6c02d160b5</a>, January 2014.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2017-8816 to this issue.</p>
<p>CWE-131: Incorrect Calculation of Buffer Size</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<p>This is only an issue on 32 bit systems. It also requires the user and password fields to use more than 2GB of memory combined, which in itself should be rare.</p>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.36.0.html">7.36.0</a> to and including <a href="vuln-7.56.1.html">7.56.1</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.36.0.html">7.36.0</a> and &gt;= <a href="vuln-7.57.0.html">7.57.0</a></li>
</ul>
<p>curl is used by many applications, but not always advertised as such.</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>In libcurl version <a href="vuln-7.57.0.html">7.57.0</a>, the integer overflow is avoided.</p>
<p>A <a href="https://curl.se/CVE-2017-8816.patch">patch for CVE-2017-8816</a> is available.</p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade curl to version <a href="vuln-7.57.0.html">7.57.0</a></p>
<p>B - Apply the patch to your version and rebuild</p>
<p>C - Put length restrictions on the user name and passwords you can pass to libcurl</p>
<h2 id="time-line">TIME LINE</h2>
<p>It was reported to the curl project on November 6, 2017. We contacted distros@openwall on November 21.</p>
<p>curl <a href="vuln-7.57.0.html">7.57.0</a> was released on November 29 2017, coordinated with the publication of this advisory.</p>
<h2 id="credits">CREDITS</h2>
<p>Reported by Alex Nichols. Patch by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
