<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#385253 - uses temporary files unsafely; race - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=385253&quot;&gt;385253&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:385253@bugs.debian.org">#385253</a><br>
uses temporary files unsafely; race</h1>
<div class="versiongraph"><a href="version.cgi?package=archivemail;absolute=0;fixed=0.6.2-2;collapse=1;found=archivemail%2F0.6.2-1;info=1"><img alt="version graph" src="version.cgi?absolute=0;width=2;fixed=0.6.2-2;package=archivemail;height=2;found=archivemail%2F0.6.2-1;collapse=1"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=archivemail">archivemail</a>;
Maintainer for <a href="pkgreport.cgi?package=archivemail">archivemail</a> is <a href="pkgreport.cgi?maint=microschulz%40web.de">Nikolaus Schulz &lt;microschulz@web.de&gt;</a>; Source for <a href="pkgreport.cgi?package=archivemail">archivemail</a> is <a href="pkgreport.cgi?src=archivemail">src:archivemail</a> (<a href="https://tracker.debian.org/pkg/archivemail">PTS</a>, <a href="https://buildd.debian.org/archivemail">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=archivemail">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=joeyh%40debian.org">Joey Hess &lt;joeyh@debian.org&gt;</a></p>
  <p>Date: Wed, 30 Aug 2006 04:18:55 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: security</p>

<p>Found in version archivemail/0.6.2-1</p>
<p>Fixed in version 0.6.2-2</p>

<p><strong>Done:</strong> Joey Hess &lt;joeyh@debian.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=385253;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<strong>Report forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian Security Team &lt;team@security.debian.org&gt;,</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=2">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<strong>Acknowledgement sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Debian Security Team &lt;team@security.debian.org&gt;,</code>.
(<a href="bugreport.cgi?bug=385253;msg=4">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=5">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=5">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830041029.GA8080%40kitenet.net%3E&amp;subject=Re%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;In-Reply-To=%3C20060830041029.GA8080%40kitenet.net%3E&amp;body=On%20Wed%2C%2030%20Aug%202006%2000%3A10%3A29%20-0400%20Joey%20Hess%20%3Cjoeyh%40debian.org%3E%20wrote%3A%0A%3E%20Package%3A%20archivemail%0A%3E%20Version%3A%200.6.2-1%0A%3E%20Severity%3A%20grave%0A%3E%20Tags%3A%20security%0A%3E%20%0A%3E%20tempfile.mktemp%20in%20python%20has%20this%20comment%3A%0A%3E%20%0A%3E%20%20%20%20%20User-callable%20function%20to%20return%20a%20unique%20temporary%20file%20name.%20%20The%0A%3E%20%20%20%20%20file%20is%20not%20created.%0A%3E%20%0A%3E%20%20%20%20%20Arguments%20are%20as%20for%20mkstemp%2C%20except%20that%20the%20%27text%27%20argument%20is%0A%3E%20%20%20%20%20not%20accepted.%0A%3E%20%0A%3E%20%20%20%20%20This%20function%20is%20unsafe%20and%20should%20not%20be%20used.%20%20The%20file%20name%0A%3E%20%20%20%20%20refers%20to%20a%20file%20that%20did%20not%20exist%20at%20some%20point%2C%20but%20by%20the%20time%0A%3E%20%20%20%20%20you%20get%20around%20to%20creating%20it%2C%20someone%20else%20may%20have%20beaten%20you%20to%0A%3E%20%20%20%20%20the%20punch.%0A%3E%20%0A%3E%20While%20I%20was%20looking%20over%20archivemail%27s%20source%20due%20to%20bug%20%23385249%2C%20I%0A%3E%20noticed%20that%20it%20creates%20temporary%20files%20insecurely.%20%0A%3E%20%0A%3E%20%20%20%20%20%20%20%20%20temp_name%20%3D%20tempfile.mktemp%28%22retain%22%29%0A%3E%20%20%20%20%20%20%20%20%20self.mbox_file%20%3D%20open%28temp_name%2C%20%22w%22%29%0A%3E%20%0A%3E%20So%20this%20seems%20raceable.%20Here%27s%20another%20one%3A%0A%3E%20%0A%3E%20%20%20%20%20%20%20%20%20temp_name%20%3D%20tempfile.mktemp%28%22archive%22%29%0A%3E%20%20%20%20%20%20%20%20%20if%20os.path.isfile%28final_name%29%3A%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20vprint%28%22file%20already%20exists%20that%20is%20named%3A%20%25s%22%20%25%20final_name%29%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20shutil.copy2%28final_name%2C%20temp_name%29%0A%3E%20%20%20%20%20%20%20%20%20_stale.archive%20%3D%20temp_name%0A%3E%20%20%20%20%20%20%20%20%20self.mbox_file%20%3D%20open%28temp_name%2C%20%22a%22%29%0A%3E%20%0A%3E%20There%20are%20a%20few%20more%20like%20that.%0A%3E%20%0A%3E%20There%20are%20also%20a%20lot%20of%20other%20uses%20of%20mktemp%20in%20the%20test%20suite%2C%20which%0A%3E%20could%20lead%20to%20security%20problems%20at%20build%20time.%0A%3E%20%0A%3E%20I%27ve%20attached%20the%20patch%20that%20I%20came%20up%20with%20after%20this%20little%20audit.%20I%27ll%20be%0A%3E%20releasing%20to%20unstable%2C%20but%20thought%20I%20should%20file%20the%20bug%20so%20this%20can%20be%20hadled%0A%3E%20for%20stable%20and%20in%20case%20someone%20wants%20to%20get%20a%20CVE%20and%20such.%20Upstream%0A%3E%20maintainers%20are%20CC%27d.%0A%3E%20%0A%3E%20Oh%2C%20one%20other%20funny%20thing%2C%20the%20TODO%20has%20this%20in%20it%3A%0A%3E%20%22Check%20for%20symlink%20attacks%20for%20tempfiles%20%28although%20we%20don%27t%20use%20%2Fvar%2Ftmp%29%22%0A%3E%20%0A%3E%20--%20%0A%3E%20see%20shy%20jo%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=joeyh%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Joey Hess &lt;joeyh@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> knitterb@users.sourceforge.net, poeml@users.sourceforge.net</div>
<div class="header"><span class="headerfield">Subject:</span> uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 00:10:29 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=5">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Package: archivemail
Version: 0.6.2-1
Severity: grave
Tags: security

tempfile.mktemp in python has this comment:

    User-callable function to return a unique temporary file name.  The
    file is not created.

    Arguments are as for mkstemp, except that the &#39;text&#39; argument is
    not accepted.

    This function is unsafe and should not be used.  The file name
    refers to a file that did not exist at some point, but by the time
    you get around to creating it, someone else may have beaten you to
    the punch.

While I was looking over archivemail&#39;s source due to bug #385249, I
noticed that it creates temporary files insecurely. 

        temp_name = tempfile.mktemp(&quot;retain&quot;)
        self.mbox_file = open(temp_name, &quot;w&quot;)

So this seems raceable. Here&#39;s another one:

        temp_name = tempfile.mktemp(&quot;archive&quot;)
        if os.path.isfile(final_name):
            vprint(&quot;file already exists that is named: %s&quot; % final_name)
            shutil.copy2(final_name, temp_name)
        _stale.archive = temp_name
        self.mbox_file = open(temp_name, &quot;a&quot;)

There are a few more like that.

There are also a lot of other uses of mktemp in the test suite, which
could lead to security problems at build time.

I&#39;ve attached the patch that I came up with after this little audit. I&#39;ll be
releasing to unstable, but thought I should file the bug so this can be hadled
for stable and in case someone wants to get a CVE and such. Upstream
maintainers are CC&#39;d.

Oh, one other funny thing, the TODO has this in it:
&quot;Check for symlink attacks for tempfiles (although we don&#39;t use /var/tmp)&quot;

-- 
see shy jo
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=archivemail.patch;msg=5">archivemail.patch</a> (text/plain, attachment)]</pre>
<pre class="mime">[<a href="bugreport.cgi?att=2;bug=385253;filename=signature.asc;msg=5">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="6"></a>
<strong>Bug marked as not found in version 0.6.2-2.</strong>
Request was from <code>Joey Hess &lt;joeyh@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>. 
(<a href="bugreport.cgi?bug=385253;msg=7">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=9">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="10"></a>
<strong>Acknowledgement sent</strong> to <code>Noah Meyerhans &lt;noahm@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=385253;msg=11">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=11">mbox</a>, <a href="#10">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="12"></a><a name="msg12"></a><a href="#12">Message #12</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=12">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=12">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830041029.GA8080%40kitenet.net%3E%0A%20%3C20060830162128.GN9422%40morgul.net%3E&amp;In-Reply-To=%3C20060830162128.GN9422%40morgul.net%3E&amp;subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;body=On%20Wed%2C%2030%20Aug%202006%2012%3A21%3A28%20-0400%20Noah%20Meyerhans%20%3Cnoahm%40debian.org%3E%20wrote%3A%0A%3E%20On%20Wed%2C%20Aug%2030%2C%202006%20at%2012%3A10%3A29AM%20-0400%2C%20Joey%20Hess%20wrote%3A%0A%3E%20%3E%20Package%3A%20archivemail%0A%3E%20%3E%20Version%3A%200.6.2-1%0A%3E%20%3E%20Severity%3A%20grave%0A%3E%20%3E%20Tags%3A%20security%0A%3E%20%0A%3E%20This%20is%20CVE-2006-4245.%20%20Please%20mention%20that%20in%20a%20future%20changelog%20entry%0A%3E%20for%20unstable.%20%20%28I%20see%20that%20you%20already%20uploaded%200.6.2-2%20to%20fix%20this%20in%0A%3E%20unstable.%29%0A%3E%20%0A%3E%20noah%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=noahm%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Noah Meyerhans &lt;noahm@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Joey Hess &lt;joeyh@debian.org&gt;, 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 12:21:28 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=12">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Wed, Aug 30, 2006 at 12:10:29AM -0400, Joey Hess wrote:
&gt; Package: archivemail
&gt; Version: 0.6.2-1
&gt; Severity: grave
&gt; Tags: security

This is <a href="https://security-tracker.debian.org/tracker/CVE-2006-4245">CVE-2006-4245</a>.  Please mention that in a future changelog entry
for unstable.  (I see that you already uploaded 0.6.2-2 to fix this in
unstable.)

noah


</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=12">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="13"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=14">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="15"></a>
<strong>Acknowledgement sent</strong> to <code>Noah Meyerhans &lt;noahm@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=385253;msg=16">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=16">mbox</a>, <a href="#15">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="17"></a><a name="msg17"></a><a href="#17">Message #17</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=17">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=17">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830041029.GA8080%40kitenet.net%3E%0A%20%3C20060830163841.GO9422%40morgul.net%3E&amp;In-Reply-To=%3C20060830163841.GO9422%40morgul.net%3E&amp;subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;body=On%20Wed%2C%2030%20Aug%202006%2012%3A38%3A41%20-0400%20Noah%20Meyerhans%20%3Cnoahm%40debian.org%3E%20wrote%3A%0A%3E%20Upon%20investigating%20this%20for%20stable%2C%20I%20wonder%20if%20the%20problem%20is%20as%20bad%20as%0A%3E%20reported.%20%20It%20seems%20that%20archivemail%20sets%20up%20its%20own%20temp%20directory%20and%0A%3E%20creates%20its%20files%20in%20it%3A%0A%3E%20%0A%3E%20%20%20%20%20%23%20create%20a%20temporary%20directory%20for%20us%20to%20work%20in%20securely%0A%3E%20%20%20%20%20old_temp_dir%20%3D%20tempfile.tempdir%0A%3E%20%20%20%20%20tempfile.tempdir%20%3D%20None%0A%3E%20%20%20%20%20new_temp_dir%20%3D%20tempfile.mktemp%28%27archivemail%27%29%0A%3E%20%20%20%20%20assert%28new_temp_dir%29%0A%3E%20%20%20%20%20os.mkdir%28new_temp_dir%29%0A%3E%20%20%20%20%20_stale.temp_dir%20%3D%20new_temp_dir%0A%3E%20%20%20%20%20tempfile.tempdir%20%3D%20new_temp_dir%0A%3E%20%20%20%20%20vprint%28%22set%20tempfile%20directory%20to%20%27%25s%27%22%20%25%20new_temp_dir%29%0A%3E%20%0A%3E%20I%20don%27t%20really%20know%20python%20at%20all%2C%20but%20it%20seems%20like%20it%20might%20be%20OK.%20%20Do%0A%3E%20you%20agree%3F%0A%3E%20%0A%3E%20noah%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=noahm%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Noah Meyerhans &lt;noahm@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Joey Hess &lt;joeyh@debian.org&gt;, 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 12:38:41 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=17">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Upon investigating this for stable, I wonder if the problem is as bad as
reported.  It seems that archivemail sets up its own temp directory and
creates its files in it:

    # create a temporary directory for us to work in securely
    old_temp_dir = tempfile.tempdir
    tempfile.tempdir = None
    new_temp_dir = tempfile.mktemp(&#39;archivemail&#39;)
    assert(new_temp_dir)
    os.mkdir(new_temp_dir)
    _stale.temp_dir = new_temp_dir
    tempfile.tempdir = new_temp_dir
    vprint(&quot;set tempfile directory to &#39;%s&#39;&quot; % new_temp_dir)

I don&#39;t really know python at all, but it seems like it might be OK.  Do
you agree?

noah

</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=17">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="18"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=19">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="20"></a>
<strong>Acknowledgement sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.
(<a href="bugreport.cgi?bug=385253;msg=21">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="22"></a><a name="msg22"></a><a href="#22">Message #22</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=22">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=22">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830041029.GA8080%40kitenet.net%3E%20%3C20060830162128.GN9422%40morgul.net%3E%0A%20%3C20060830185424.GC16125%40kitenet.net%3E&amp;body=On%20Wed%2C%2030%20Aug%202006%2014%3A54%3A24%20-0400%20Joey%20Hess%20%3Cjoeyh%40debian.org%3E%20wrote%3A%0A%3E%20Noah%20Meyerhans%20wrote%3A%0A%3E%20%3E%20On%20Wed%2C%20Aug%2030%2C%202006%20at%2012%3A10%3A29AM%20-0400%2C%20Joey%20Hess%20wrote%3A%0A%3E%20%3E%20%3E%20Package%3A%20archivemail%0A%3E%20%3E%20%3E%20Version%3A%200.6.2-1%0A%3E%20%3E%20%3E%20Severity%3A%20grave%0A%3E%20%3E%20%3E%20Tags%3A%20security%0A%3E%20%3E%20%0A%3E%20%3E%20This%20is%20CVE-2006-4245.%20%20Please%20mention%20that%20in%20a%20future%20changelog%20entry%0A%3E%20%3E%20for%20unstable.%20%20%28I%20see%20that%20you%20already%20uploaded%200.6.2-2%20to%20fix%20this%20in%0A%3E%20%3E%20unstable.%29%0A%3E%20%0A%3E%20yes%2C%20next%20release%20will%20have%20all%20the%20info%20in%20that%20changelog%20entry.%20Thanks%0A%3E%20for%20getting%20the%20CVE.%0A%3E%20%0A%3E%20--%20%0A%3E%20see%20shy%20jo%0A&amp;In-Reply-To=%3C20060830185424.GC16125%40kitenet.net%3E&amp;subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=joeyh%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Joey Hess &lt;joeyh@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Noah Meyerhans &lt;noahm@debian.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 14:54:24 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=22">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Noah Meyerhans wrote:
&gt; On Wed, Aug 30, 2006 at 12:10:29AM -0400, Joey Hess wrote:
&gt; &gt; Package: archivemail
&gt; &gt; Version: 0.6.2-1
&gt; &gt; Severity: grave
&gt; &gt; Tags: security
&gt; 
&gt; This is <a href="https://security-tracker.debian.org/tracker/CVE-2006-4245">CVE-2006-4245</a>.  Please mention that in a future changelog entry
&gt; for unstable.  (I see that you already uploaded 0.6.2-2 to fix this in
&gt; unstable.)

yes, next release will have all the info in that changelog entry. Thanks
for getting the CVE.

-- 
see shy jo
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=22">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="23"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=24">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=24">mbox</a>, <a href="#23">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="25"></a>
<strong>Acknowledgement sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.
(<a href="bugreport.cgi?bug=385253;msg=26">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="27"></a><a name="msg27"></a><a href="#27">Message #27</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=27">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=27">mbox</a>, <a href="mailto:385253@bugs.debian.org?subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;In-Reply-To=%3C20060830190318.GD16125%40kitenet.net%3E&amp;body=On%20Wed%2C%2030%20Aug%202006%2015%3A03%3A18%20-0400%20Joey%20Hess%20%3Cjoeyh%40debian.org%3E%20wrote%3A%0A%3E%20Noah%20Meyerhans%20wrote%3A%0A%3E%20%3E%20Upon%20investigating%20this%20for%20stable%2C%20I%20wonder%20if%20the%20problem%20is%20as%20bad%20as%0A%3E%20%3E%20reported.%20%20It%20seems%20that%20archivemail%20sets%20up%20its%20own%20temp%20directory%20and%0A%3E%20%3E%20creates%20its%20files%20in%20it%3A%0A%3E%20%3E%20%0A%3E%20%3E%20%20%20%20%20%23%20create%20a%20temporary%20directory%20for%20us%20to%20work%20in%20securely%0A%3E%20%3E%20%20%20%20%20old_temp_dir%20%3D%20tempfile.tempdir%0A%3E%20%3E%20%20%20%20%20tempfile.tempdir%20%3D%20None%0A%3E%20%3E%20%20%20%20%20new_temp_dir%20%3D%20tempfile.mktemp%28%27archivemail%27%29%0A%3E%20%3E%20%20%20%20%20assert%28new_temp_dir%29%0A%3E%20%3E%20%20%20%20%20os.mkdir%28new_temp_dir%29%0A%3E%20%3E%20%20%20%20%20_stale.temp_dir%20%3D%20new_temp_dir%0A%3E%20%3E%20%20%20%20%20tempfile.tempdir%20%3D%20new_temp_dir%0A%3E%20%3E%20%20%20%20%20vprint%28%22set%20tempfile%20directory%20to%20%27%25s%27%22%20%25%20new_temp_dir%29%0A%3E%20%3E%20%0A%3E%20%3E%20I%20don%27t%20really%20know%20python%20at%20all%2C%20but%20it%20seems%20like%20it%20might%20be%20OK.%20%20Do%0A%3E%20%3E%20you%20agree%3F%0A%3E%20%0A%3E%20Not%20being%20a%20python%20programmer%2C%20I%20missed%20the%20tempfile.tempdir%20setting%2C%0A%3E%20which%2C%20if%20it%20makes%20tempfile.mktemp%20use%20that%20temp%20dir%2C%20should%20make%20the%0A%3E%20program%20safe%20for%20all%20calls%20to%20mktemp%20from%20then%20on.%20Whether%20it%27s%0A%3E%20exploitable%20would%20thus%20depend%20on%20whether%20there%20are%20any%20calls%20to%20the%0A%3E%20other%20functions%20first.%20It%20seems%20like%20those%20calls%20all%20happen%20afterwards%2C%0A%3E%20I%27m%20not%20100%25%20sure.%0A%3E%20%0A%3E%20The%20test%20suite%20still%20seems%20raceable%20for%20sure%2C%20though%20that%27s%20lower%0A%3E%20exploitability.%0A%3E%20%0A%3E%20--%20%0A%3E%20see%20shy%20jo%0A&amp;References=%3C20060830041029.GA8080%40kitenet.net%3E%20%3C20060830163841.GO9422%40morgul.net%3E%0A%20%3C20060830190318.GD16125%40kitenet.net%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=joeyh%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Joey Hess &lt;joeyh@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Noah Meyerhans &lt;noahm@debian.org&gt;, 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 15:03:18 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=27">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Noah Meyerhans wrote:
&gt; Upon investigating this for stable, I wonder if the problem is as bad as
&gt; reported.  It seems that archivemail sets up its own temp directory and
&gt; creates its files in it:
&gt; 
&gt;     # create a temporary directory for us to work in securely
&gt;     old_temp_dir = tempfile.tempdir
&gt;     tempfile.tempdir = None
&gt;     new_temp_dir = tempfile.mktemp(&#39;archivemail&#39;)
&gt;     assert(new_temp_dir)
&gt;     os.mkdir(new_temp_dir)
&gt;     _stale.temp_dir = new_temp_dir
&gt;     tempfile.tempdir = new_temp_dir
&gt;     vprint(&quot;set tempfile directory to &#39;%s&#39;&quot; % new_temp_dir)
&gt; 
&gt; I don&#39;t really know python at all, but it seems like it might be OK.  Do
&gt; you agree?

Not being a python programmer, I missed the tempfile.tempdir setting,
which, if it makes tempfile.mktemp use that temp dir, should make the
program safe for all calls to mktemp from then on. Whether it&#39;s
exploitable would thus depend on whether there are any calls to the
other functions first. It seems like those calls all happen afterwards,
I&#39;m not 100% sure.

The test suite still seems raceable for sure, though that&#39;s lower
exploitability.

-- 
see shy jo
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=27">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="28"></a>
<strong>Reply sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
You have taken responsibility.
(<a href="bugreport.cgi?bug=385253;msg=29">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=29">mbox</a>, <a href="#28">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="30"></a>
<strong>Notification sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
(<a href="bugreport.cgi?bug=385253;msg=31">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="32"></a><a name="msg32"></a><a href="#32">Message #32</a> received at 385253-done@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=32">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=32">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830185419.GA17062%40kitenet.net%3E&amp;In-Reply-To=%3C20060830185419.GA17062%40kitenet.net%3E&amp;subject=Re%3A%20fixed..&amp;body=On%20Wed%2C%2030%20Aug%202006%2014%3A54%3A19%20-0400%20Joey%20Hess%20%3Cjoeyh%40debian.org%3E%20wrote%3A%0A%3E%20Version%3A%200.6.2-2%0A%3E%20%0A%3E%20Fixed%20in%20-2%0A%3E%20%0A%3E%20--%20%0A%3E%20see%20shy%20jo%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=joeyh%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Joey Hess &lt;joeyh@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 385253-done@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> fixed..</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 30 Aug 2006 14:54:19 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=32">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message wrapping">Version: 0.6.2-2

Fixed in -2

-- 
see shy jo
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=32">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="33"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=34">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="35"></a><a name="msg35"></a><a href="#35">Message #35</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=35">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=35">mbox</a>, <a href="mailto:385253@bugs.debian.org?body=On%20Sun%2C%2010%20Sep%202006%2018%3A53%3A10%20%2B0200%20Nikolaus%20Schulz%20%3Cmicroschulz%40web.de%3E%20wrote%3A%0A%3E%20Joey%20Hess%20wrote%3A%0A%3E%20%3E%20Noah%20Meyerhans%20wrote%3A%0A%3E%20%3E%20%3E%20Upon%20investigating%20this%20for%20stable%2C%20I%20wonder%20if%20the%20problem%20is%20as%20bad%20as%0A%3E%20%3E%20%3E%20reported.%20%20It%20seems%20that%20archivemail%20sets%20up%20its%20own%20temp%20directory%20and%0A%3E%20%3E%20%3E%20creates%20its%20files%20in%20it%3A%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20%3E%20%20%20%20%20%23%20create%20a%20temporary%20directory%20for%20us%20to%20work%20in%20securely%0A%3E%20%3E%20%3E%20%20%20%20%20old_temp_dir%20%3D%20tempfile.tempdir%0A%3E%20%3E%20%3E%20%20%20%20%20tempfile.tempdir%20%3D%20None%0A%3E%20%3E%20%3E%20%20%20%20%20new_temp_dir%20%3D%20tempfile.mktemp%28%27archivemail%27%29%0A%3E%20%3E%20%3E%20%20%20%20%20assert%28new_temp_dir%29%0A%3E%20%3E%20%3E%20%20%20%20%20os.mkdir%28new_temp_dir%29%0A%3E%20%3E%20%3E%20%20%20%20%20_stale.temp_dir%20%3D%20new_temp_dir%0A%3E%20%3E%20%3E%20%20%20%20%20tempfile.tempdir%20%3D%20new_temp_dir%0A%3E%20%3E%20%3E%20%20%20%20%20vprint%28%22set%20tempfile%20directory%20to%20%27%25s%27%22%20%25%20new_temp_dir%29%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20%3E%20I%20don%27t%20really%20know%20python%20at%20all%2C%20but%20it%20seems%20like%20it%20might%20be%20OK.%20%20Do%0A%3E%20%3E%20%3E%20you%20agree%3F%0A%3E%20%3E%20%0A%3E%20%3E%20Not%20being%20a%20python%20programmer%2C%20I%20missed%20the%20tempfile.tempdir%20setting%2C%0A%3E%20%3E%20which%2C%20if%20it%20makes%20tempfile.mktemp%20use%20that%20temp%20dir%2C%20should%20make%20the%0A%3E%20%3E%20program%20safe%20for%20all%20calls%20to%20mktemp%20from%20then%20on.%20Whether%20it%27s%0A%3E%20%3E%20exploitable%20would%20thus%20depend%20on%20whether%20there%20are%20any%20calls%20to%20the%0A%3E%20%3E%20other%20functions%20first.%20It%20seems%20like%20those%20calls%20all%20happen%20afterwards%2C%0A%3E%20%3E%20I%27m%20not%20100%25%20sure.%0A%3E%20%0A%3E%20I%27ve%20examined%20this%2C%20and%20I%20think%20there%20is%20no%20security%20issue%20in%0A%3E%20archivemail.py.%20%0A%3E%20%0A%3E%20%20%20%20%20There%20are%20four%20calls%20to%20tempfile.mktemp%28%29%3A%20two%20in%20the%20constructor%20of%0A%3E%20the%20ArchiveMbox%20class%2C%20one%20in%20the%20RetainMbox%20class%20constructor%2C%20and%0A%3E%20finally%2C%20one%20in%20the%20archive%28%29%20function.%20%20The%20latter%20is%20the%20code%20section%0A%3E%20Noah%20has%20cited%20above%2C%20and%20since%20the%20umask%20is%20set%20to%20077%20before%20and%0A%3E%20tempfile.tempdir%20is%20set%2C%20it%20should%20all%20be%20safe.%20%20Though%20I%27d%20say%20it%27s%0A%3E%20still%20reasonable%20to%20patch%20the%20code%20to%20use%20mkstemp%28%29%20instead.%0A%3E%20%0A%3E%20%3E%20The%20test%20suite%20still%20seems%20raceable%20for%20sure%2C%20though%20that%27s%20lower%0A%3E%20%3E%20exploitability.%0A%3E%20%0A%3E%20Agreed.%20%20Does%20this%20whole%20thing%20warrant%20a%20CVE%3F%0A%3E%20%0A%3E%20Nikolaus%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;In-Reply-To=%3C20060910165308.GA3336%40penelope.zusammrottung.local%3E&amp;References=%3C20060830041029.GA8080%40kitenet.net%3E%20%3C20060830163841.GO9422%40morgul.net%3E%20%3C20060830190318.GD16125%40kitenet.net%3E%0A%20%3C20060910165308.GA3336%40penelope.zusammrottung.local%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=microschulz%40web.de" alt="">
<div class="header"><span class="headerfield">From:</span> Nikolaus Schulz &lt;microschulz@web.de&gt;</div>
<div class="header"><span class="headerfield">To:</span> 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> Noah Meyerhans &lt;noahm@debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 10 Sep 2006 18:53:10 +0200</div>
</div>
<pre class="message">Joey Hess wrote:
&gt; Noah Meyerhans wrote:
&gt; &gt; Upon investigating this for stable, I wonder if the problem is as bad as
&gt; &gt; reported.  It seems that archivemail sets up its own temp directory and
&gt; &gt; creates its files in it:
&gt; &gt; 
&gt; &gt;     # create a temporary directory for us to work in securely
&gt; &gt;     old_temp_dir = tempfile.tempdir
&gt; &gt;     tempfile.tempdir = None
&gt; &gt;     new_temp_dir = tempfile.mktemp(&#39;archivemail&#39;)
&gt; &gt;     assert(new_temp_dir)
&gt; &gt;     os.mkdir(new_temp_dir)
&gt; &gt;     _stale.temp_dir = new_temp_dir
&gt; &gt;     tempfile.tempdir = new_temp_dir
&gt; &gt;     vprint(&quot;set tempfile directory to &#39;%s&#39;&quot; % new_temp_dir)
&gt; &gt; 
&gt; &gt; I don&#39;t really know python at all, but it seems like it might be OK.  Do
&gt; &gt; you agree?
&gt; 
&gt; Not being a python programmer, I missed the tempfile.tempdir setting,
&gt; which, if it makes tempfile.mktemp use that temp dir, should make the
&gt; program safe for all calls to mktemp from then on. Whether it&#39;s
&gt; exploitable would thus depend on whether there are any calls to the
&gt; other functions first. It seems like those calls all happen afterwards,
&gt; I&#39;m not 100% sure.

I&#39;ve examined this, and I think there is no security issue in
archivemail.py. 

    There are four calls to tempfile.mktemp(): two in the constructor of
the ArchiveMbox class, one in the RetainMbox class constructor, and
finally, one in the archive() function.  The latter is the code section
Noah has cited above, and since the umask is set to 077 before and
tempfile.tempdir is set, it should all be safe.  Though I&#39;d say it&#39;s
still reasonable to patch the code to use mkstemp() instead.

&gt; The test suite still seems raceable for sure, though that&#39;s lower
&gt; exploitability.

Agreed.  Does this whole thing warrant a CVE?

Nikolaus


</pre>

<div class="infmessage"><hr><p>
<a name="36"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org</code>:<br>
<code>Bug#385253</code>; Package <code>archivemail</code>.
(<a href="bugreport.cgi?bug=385253;msg=37">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=37">mbox</a>, <a href="#36">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="38"></a>
<strong>Acknowledgement sent</strong> to <code>Joey Hess &lt;joeyh@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.
(<a href="bugreport.cgi?bug=385253;msg=39">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="40"></a><a name="msg40"></a><a href="#40">Message #40</a> received at 385253@bugs.debian.org (<a href="bugreport.cgi?bug=385253;msg=40">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=40">mbox</a>, <a href="mailto:385253@bugs.debian.org?References=%3C20060830041029.GA8080%40kitenet.net%3E%20%3C20060830163841.GO9422%40morgul.net%3E%20%3C20060830190318.GD16125%40kitenet.net%3E%20%3C20060910165308.GA3336%40penelope.zusammrottung.local%3E%0A%20%3C20060910174955.GD5915%40kitenet.net%3E&amp;body=On%20Sun%2C%2010%20Sep%202006%2013%3A49%3A55%20-0400%20Joey%20Hess%20%3Cjoeyh%40debian.org%3E%20wrote%3A%0A%3E%20Nikolaus%20Schulz%20wrote%3A%0A%3E%20%3E%20%3E%20Not%20being%20a%20python%20programmer%2C%20I%20missed%20the%20tempfile.tempdir%20setting%2C%0A%3E%20%3E%20%3E%20which%2C%20if%20it%20makes%20tempfile.mktemp%20use%20that%20temp%20dir%2C%20should%20make%20the%0A%3E%20%3E%20%3E%20program%20safe%20for%20all%20calls%20to%20mktemp%20from%20then%20on.%20Whether%20it%27s%0A%3E%20%3E%20%3E%20exploitable%20would%20thus%20depend%20on%20whether%20there%20are%20any%20calls%20to%20the%0A%3E%20%3E%20%3E%20other%20functions%20first.%20It%20seems%20like%20those%20calls%20all%20happen%20afterwards%2C%0A%3E%20%3E%20%3E%20I%27m%20not%20100%25%20sure.%0A%3E%20%3E%20%0A%3E%20%3E%20I%27ve%20examined%20this%2C%20and%20I%20think%20there%20is%20no%20security%20issue%20in%0A%3E%20%3E%20archivemail.py.%20%0A%3E%20%3E%20%0A%3E%20%3E%20%20%20%20%20There%20are%20four%20calls%20to%20tempfile.mktemp%28%29%3A%20two%20in%20the%20constructor%20of%0A%3E%20%3E%20the%20ArchiveMbox%20class%2C%20one%20in%20the%20RetainMbox%20class%20constructor%2C%20and%0A%3E%20%3E%20finally%2C%20one%20in%20the%20archive%28%29%20function.%20%20The%20latter%20is%20the%20code%20section%0A%3E%20%3E%20Noah%20has%20cited%20above%2C%20and%20since%20the%20umask%20is%20set%20to%20077%20before%20and%0A%3E%20%3E%20tempfile.tempdir%20is%20set%2C%20it%20should%20all%20be%20safe.%20%20Though%20I%27d%20say%20it%27s%0A%3E%20%3E%20still%20reasonable%20to%20patch%20the%20code%20to%20use%20mkstemp%28%29%20instead.%0A%3E%20%0A%3E%20I%20think%20you%27re%20right.%0A%3E%20%0A%3E%20%3E%20%3E%20The%20test%20suite%20still%20seems%20raceable%20for%20sure%2C%20though%20that%27s%20lower%0A%3E%20%3E%20%3E%20exploitability.%0A%3E%20%3E%20%0A%3E%20%3E%20Agreed.%20%20Does%20this%20whole%20thing%20warrant%20a%20CVE%3F%0A%3E%20%0A%3E%20Dunno%2C%20One%20has%2C%20however%2C%20been%20assigned.%0A%3E%20%0A%3E%20--%20%0A%3E%20see%20shy%20jo%0A&amp;subject=Re%3A%20Bug%23385253%3A%20uses%20temporary%20files%20unsafely%3B%20race&amp;In-Reply-To=%3C20060910174955.GD5915%40kitenet.net%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=joeyh%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Joey Hess &lt;joeyh@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Nikolaus Schulz &lt;microschulz@web.de&gt;, 385253@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> Noah Meyerhans &lt;noahm@debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#385253: uses temporary files unsafely; race</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 10 Sep 2006 13:49:55 -0400</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=385253;msg=40">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Nikolaus Schulz wrote:
&gt; &gt; Not being a python programmer, I missed the tempfile.tempdir setting,
&gt; &gt; which, if it makes tempfile.mktemp use that temp dir, should make the
&gt; &gt; program safe for all calls to mktemp from then on. Whether it&#39;s
&gt; &gt; exploitable would thus depend on whether there are any calls to the
&gt; &gt; other functions first. It seems like those calls all happen afterwards,
&gt; &gt; I&#39;m not 100% sure.
&gt; 
&gt; I&#39;ve examined this, and I think there is no security issue in
&gt; archivemail.py. 
&gt; 
&gt;     There are four calls to tempfile.mktemp(): two in the constructor of
&gt; the ArchiveMbox class, one in the RetainMbox class constructor, and
&gt; finally, one in the archive() function.  The latter is the code section
&gt; Noah has cited above, and since the umask is set to 077 before and
&gt; tempfile.tempdir is set, it should all be safe.  Though I&#39;d say it&#39;s
&gt; still reasonable to patch the code to use mkstemp() instead.

I think you&#39;re right.

&gt; &gt; The test suite still seems raceable for sure, though that&#39;s lower
&gt; &gt; exploitability.
&gt; 
&gt; Agreed.  Does this whole thing warrant a CVE?

Dunno, One has, however, been assigned.

-- 
see shy jo
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=385253;filename=signature.asc;msg=40">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="41"></a>
<!-- time:1182807931 -->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>. 
 (Mon, 25 Jun 2007 21:45:31 GMT) (<a href="bugreport.cgi?bug=385253;msg=42">full text</a>, <a href="bugreport.cgi?bug=385253;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=385253">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:23:16 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
