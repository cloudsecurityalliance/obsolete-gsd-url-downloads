<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#982519 - zstd: Race condition allows attacker to access world-readable destination file - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=982519&quot;&gt;982519&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:982519@bugs.debian.org">#982519</a><br>
zstd: Race condition allows attacker to access world-readable destination file</h1>
<div class="versiongraph"><a href="version.cgi?found=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u1;found=libzstd%2F1.1.2-1;found=libzstd%2F1.4.8%2Bdfsg-1;package=zstd;fixed=libzstd%2F1.4.8%2Bdfsg-2;fixed=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u2;collapse=1;info=1;absolute=0"><img alt="version graph" src="version.cgi?absolute=0;package=zstd;found=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u1;found=libzstd%2F1.1.2-1;found=libzstd%2F1.4.8%2Bdfsg-1;width=2;height=2;fixed=libzstd%2F1.4.8%2Bdfsg-2;fixed=libzstd%2F1.3.8%2Bdfsg-3%2Bdeb10u2;collapse=1"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=zstd">zstd</a>;
Maintainer for <a href="pkgreport.cgi?package=zstd">zstd</a> is <a href="pkgreport.cgi?maint=debian-med-packaging%40lists.alioth.debian.org">Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=zstd">zstd</a> is <a href="pkgreport.cgi?src=libzstd">src:libzstd</a> (<a href="https://tracker.debian.org/pkg/libzstd">PTS</a>, <a href="https://buildd.debian.org/libzstd">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=libzstd">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=seb%40debian.org">Sebastien Delafond &lt;seb@debian.org&gt;</a></p>
  <p>Date: Thu, 11 Feb 2021 07:36:02 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: security, upstream</p>

<p>Found in versions libzstd/1.3.8+dfsg-3+deb10u1, libzstd/1.1.2-1, libzstd/1.4.8+dfsg-1</p>
<p>Fixed in versions libzstd/1.4.8+dfsg-2, libzstd/1.3.8+dfsg-3+deb10u2</p>

<p><strong>Done:</strong> Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p><p>Forwarded to <a href="https://github.com/facebook/zstd/issues/2491">https://github.com/facebook/zstd/issues/2491</a></p>
</div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=982519;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, team@security.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt; -->
<!-- time:1613028964 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, team@security.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#982519</code>; Package <code>zstd</code>.
 (Thu, 11 Feb 2021 07:36:04 GMT) (<a href="bugreport.cgi?bug=982519;msg=2">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: Sebastien Delafond &lt;seb@debian.org&gt; -->
<!-- time:1613028964 -->
<strong>Acknowledgement sent</strong>
to <code>Sebastien Delafond &lt;seb@debian.org&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>team@security.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>.
 (Thu, 11 Feb 2021 07:36:04 GMT) (<a href="bugreport.cgi?bug=982519;msg=4">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=5">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=5">mbox</a>, <a href="mailto:982519@bugs.debian.org?In-Reply-To=%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E&amp;subject=Re%3A%20zstd%3A%20Race%20condition%20allows%20attacker%20to%20access%20world-readable%20destination%20file&amp;body=On%20Thu%2C%2011%20Feb%202021%2008%3A33%3A58%20%2B0100%20Sebastien%20Delafond%20%3Cseb%40debian.org%3E%20wrote%3A%0A%3E%20Package%3A%20zstd%0A%3E%20Version%3A%201.4.8%2Bdfsg-1%0A%3E%20Severity%3A%20grave%0A%3E%20Tags%3A%20security%0A%3E%20X-Debbugs-Cc%3A%20team%40security.debian.org%0A%3E%20%0A%3E%20The%20recently%20applied%20patch%20still%20creates%20the%20file%20with%20the%20default%0A%3E%20umask%5B0%5D%2C%20before%20chmod%27ing%20down%20to%200600%2C%20so%20an%20attacker%20could%20still%20open%0A%3E%20it%20in%20the%20meantime.%0A%3E%20%0A%3E%20Cheers%2C%0A%3E%20%0A%3E%20--%20%0A%3E%20Seb%0A%3E%20%0A%3E%20%5B0%5D%20https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fblob%2Fdev%2Fprograms%2Ffileio.c%23L682%0A%3E%20%0A%3E%20%0A&amp;References=%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=seb%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Sebastien Delafond &lt;seb@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> zstd: Race condition allows attacker to access world-readable destination file</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 11 Feb 2021 08:33:58 +0100</div>
</div>
<pre class="message">Package: zstd
Version: 1.4.8+dfsg-1
Severity: grave
Tags: security
X-Debbugs-Cc: team@security.debian.org

The recently applied patch still creates the file with the default
umask[0], before chmod&#39;ing down to 0600, so an attacker could still open
it in the meantime.

Cheers,

-- 
Seb

[0] <a href="https://github.com/facebook/zstd/blob/dev/programs/fileio.c#L682">https://github.com/facebook/zstd/blob/dev/programs/fileio.c#L682</a>


</pre>

<div class="msgreceived"><hr><p>
<a name="6"></a>
<!-- command:tag -->
<!-- requester: Sebastien Delafond &lt;seb@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1613029504 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security&#39;
            };
-->
<strong>Added tag(s) upstream.</strong>
Request was from <code>Sebastien Delafond &lt;seb@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 11 Feb 2021 07:45:04 GMT) (<a href="bugreport.cgi?bug=982519;msg=7">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="8"></a>
<!-- command:forwarded -->
<!-- requester: Sebastien Delafond &lt;seb@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1613029506 -->
<!-- new_data:
$new_data = {
              &#39;forwarded&#39; =&gt; &#39;<a href="https://github.com/facebook/zstd/issues/2491">https://github.com/facebook/zstd/issues/2491</a>&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;forwarded&#39; =&gt; &#39;&#39;
            };
-->
<strong>Set Bug forwarded-to-address to &#39;<a href="https://github.com/facebook/zstd/issues/2491">https://github.com/facebook/zstd/issues/2491</a>&#39;.</strong>
Request was from <code>Sebastien Delafond &lt;seb@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 11 Feb 2021 07:45:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=9">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="10"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt; -->
<!-- time:1613059026 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#982519</code>; Package <code>zstd</code>.
 (Thu, 11 Feb 2021 15:57:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=11">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=11">mbox</a>, <a href="#10">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="12"></a>
<!-- request_addr: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- time:1613059026 -->
<strong>Acknowledgement sent</strong>
to <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>.
 (Thu, 11 Feb 2021 15:57:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=13">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=13">mbox</a>, <a href="#12">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="14"></a><a name="msg14"></a><a href="#14">Message #14</a> received at 982519@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=14">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=14">mbox</a>, <a href="mailto:982519@bugs.debian.org?subject=Re%3A%20Bug%23981404%3A%20Fix%20seems%20incomplete&amp;In-Reply-To=%3CYCVTTU61gD7el9I1%40eldamar.lan%3E&amp;References=%3Cb90aa02e-803c-a261-6b29-c3496a2a4f88%40afaics.de%3E%0A%20%3C87wnvex5lk.fsf%40lant.ki.iif.hu%3E%0A%20%3CYCVTTU61gD7el9I1%40eldamar.lan%3E&amp;body=On%20Thu%2C%2011%20Feb%202021%2016%3A54%3A53%20%2B0100%20Salvatore%20Bonaccorso%20%3Ccarnil%40debian.org%3E%20wrote%3A%0A%3E%20Hi%20Feri%2C%2C%0A%3E%20%0A%3E%20On%20Thu%2C%20Feb%2011%2C%202021%20at%2011%3A26%3A47AM%20%2B0100%2C%20wferi%40niif.hu%20wrote%3A%0A%3E%20%3E%20Hi%2C%0A%3E%20%3E%20%0A%3E%20%3E%20The%20patch%20in%20this%20bug%20report%20very%20much%20shrinks%20the%20window%20of%20the%0A%3E%20%3E%20vulnerability%2C%20but%20doesn%27t%20close%20it%20completely%3A%20the%20file%20is%20still%0A%3E%20%3E%20created%20with%20default%20permissions%2C%20then%20chmodded%20as%20a%20separate%20step.%0A%3E%20%3E%20It%27s%20hard%2C%20but%20not%20impossible%20to%20still%20win%20the%20race%20and%20open%20the%20file%0A%3E%20%3E%20before%20the%20chmod%2C%20enabling%20the%20same%20attack.%20%20I%20recommend%20something%20like%0A%3E%20%3E%20%0A%3E%20%3E%20fd%20%3D%20open%28dstFileName%2C%20O_WRONLY%7CO_CREAT%7CO_EXCL%2C%200600%29%3B%0A%3E%20%3E%20if%20%28fd%20%21%3D%20-1%29%0A%3E%20%3E%20%20%20%20%20f%20%3D%20fdopen%28%20fd%2C%20%22wb%22%20%29%3B%0A%3E%20%3E%20if%20%28fd%20%3D%3D%20-1%20%7C%7C%20f%20%3D%3D%20NULL%29%0A%3E%20%3E%20%20%20%20%20DISPLAYLEVEL%281%2C%20%22zstd%3A%20%25s%3A%20%25s%5Cn%22%2C%20dstFileName%2C%20strerror%28errno%29%29%3B%0A%3E%20%3E%20return%20f%3B%0A%3E%20%3E%20%0A%3E%20%3E%20for%20example.%0A%3E%20%0A%3E%20See%20%23982519%20respectively%20https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fissues%2F2491%0A%3E%20upstream.%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20Salvatore%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=carnil%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Salvatore Bonaccorso &lt;carnil@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> wferi@niif.hu, 981404@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> 982519@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#981404: Fix seems incomplete</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 11 Feb 2021 16:54:53 +0100</div>
</div>
<pre class="message">Hi Feri,,

On Thu, Feb 11, 2021 at 11:26:47AM +0100, wferi@niif.hu wrote:
&gt; Hi,
&gt; 
&gt; The patch in this bug report very much shrinks the window of the
&gt; vulnerability, but doesn&#39;t close it completely: the file is still
&gt; created with default permissions, then chmodded as a separate step.
&gt; It&#39;s hard, but not impossible to still win the race and open the file
&gt; before the chmod, enabling the same attack.  I recommend something like
&gt; 
&gt; fd = open(dstFileName, O_WRONLY|O_CREAT|O_EXCL, 0600);
&gt; if (fd != -1)
&gt;     f = fdopen( fd, &quot;wb&quot; );
&gt; if (fd == -1 || f == NULL)
&gt;     DISPLAYLEVEL(1, &quot;zstd: %s: %s\n&quot;, dstFileName, strerror(errno));
&gt; return f;
&gt; 
&gt; for example.

See #982519 respectively <a href="https://github.com/facebook/zstd/issues/2491">https://github.com/facebook/zstd/issues/2491</a>
upstream.

Regards,
Salvatore


</pre>

<div class="infmessage"><hr><p>
<a name="15"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt; -->
<!-- time:1613625663 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#982519</code>; Package <code>zstd</code>.
 (Thu, 18 Feb 2021 05:21:03 GMT) (<a href="bugreport.cgi?bug=982519;msg=16">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=16">mbox</a>, <a href="#15">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="17"></a>
<!-- request_addr: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- time:1613625663 -->
<strong>Acknowledgement sent</strong>
to <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>.
 (Thu, 18 Feb 2021 05:21:03 GMT) (<a href="bugreport.cgi?bug=982519;msg=18">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=18">mbox</a>, <a href="#17">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="19"></a><a name="msg19"></a><a href="#19">Message #19</a> received at 982519@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=19">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=19">mbox</a>, <a href="mailto:982519@bugs.debian.org?References=%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E%0A%20%3CYC344fE5FdXbCL2w%40lorien.valinor.li%3E&amp;body=On%20Thu%2C%2018%20Feb%202021%2006%3A19%3A29%20%2B0100%20Salvatore%20Bonaccorso%20%3Ccarnil%40debian.org%3E%20wrote%3A%0A%3E%20On%20Thu%2C%20Feb%2011%2C%202021%20at%2008%3A33%3A58AM%20%2B0100%2C%20Sebastien%20Delafond%20wrote%3A%0A%3E%20%3E%20Package%3A%20zstd%0A%3E%20%3E%20Version%3A%201.4.8%2Bdfsg-1%0A%3E%20%3E%20Severity%3A%20grave%0A%3E%20%3E%20Tags%3A%20security%0A%3E%20%3E%20X-Debbugs-Cc%3A%20team%40security.debian.org%0A%3E%20%3E%20%0A%3E%20%3E%20The%20recently%20applied%20patch%20still%20creates%20the%20file%20with%20the%20default%0A%3E%20%3E%20umask%5B0%5D%2C%20before%20chmod%27ing%20down%20to%200600%2C%20so%20an%20attacker%20could%20still%20open%0A%3E%20%3E%20it%20in%20the%20meantime.%0A%3E%20%0A%3E%20FTR%2C%20this%20has%20been%20fixed%20upstream.%0A%3E%20%0A%3E%20https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fcommit%2Fa774c5797399040af62db21d8a9b9769e005430e%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20Salvatore%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23982519%3A%20zstd%3A%20Race%20condition%20allows%20attacker%20to%20access%0A%20world-readable%20destination%20file&amp;In-Reply-To=%3CYC344fE5FdXbCL2w%40lorien.valinor.li%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=carnil%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Salvatore Bonaccorso &lt;carnil@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Sebastien Delafond &lt;seb@debian.org&gt;, 982519@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#982519: zstd: Race condition allows attacker to access
 world-readable destination file</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 18 Feb 2021 06:19:29 +0100</div>
</div>
<pre class="message">On Thu, Feb 11, 2021 at 08:33:58AM +0100, Sebastien Delafond wrote:
&gt; Package: zstd
&gt; Version: 1.4.8+dfsg-1
&gt; Severity: grave
&gt; Tags: security
&gt; X-Debbugs-Cc: team@security.debian.org
&gt; 
&gt; The recently applied patch still creates the file with the default
&gt; umask[0], before chmod&#39;ing down to 0600, so an attacker could still open
&gt; it in the meantime.

FTR, this has been fixed upstream.

<a href="https://github.com/facebook/zstd/commit/a774c5797399040af62db21d8a9b9769e005430e">https://github.com/facebook/zstd/commit/a774c5797399040af62db21d8a9b9769e005430e</a>

Regards,
Salvatore


</pre>

<div class="infmessage"><hr><p>
<a name="20"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt; -->
<!-- time:1613644742 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#982519</code>; Package <code>zstd</code>.
 (Thu, 18 Feb 2021 10:39:02 GMT) (<a href="bugreport.cgi?bug=982519;msg=21">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="22"></a>
<!-- request_addr: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- time:1613644742 -->
<strong>Acknowledgement sent</strong>
to <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>.
 (Thu, 18 Feb 2021 10:39:02 GMT) (<a href="bugreport.cgi?bug=982519;msg=23">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=23">mbox</a>, <a href="#22">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="24"></a><a name="msg24"></a><a href="#24">Message #24</a> received at 982519@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=24">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=24">mbox</a>, <a href="mailto:982519@bugs.debian.org?subject=Re%3A%20%5Bsprint%5D%20%5BRFS%5D%20libzstd%201.4.8%2Bdfsg-2&amp;In-Reply-To=%3CYC5CvcrVaXGTxuit%40fusion%3E&amp;References=%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E%0A%20%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E%0A%20%3CYC344fE5FdXbCL2w%40lorien.valinor.li%3E%0A%20%3CYC5CvcrVaXGTxuit%40fusion%3E&amp;body=On%20Thu%2C%2018%20Feb%202021%2011%3A34%3A37%20%2B0100%20%3D%3Futf-8%3FQ%3F%3DC3%3D89tienne%3F%3D%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%20wrote%3A%0A%3E%20Control%3A%20tag%20-1%20pending%0A%3E%20%0A%3E%20Hi%20S%C3%A9bastien%2C%20Hi%20Salvatore%2C%0A%3E%20%0A%3E%20Salvatore%20Bonaccorso%2C%20on%202021-02-18%2006%3A19%3A29%20%2B0100%3A%0A%3E%20%3E%20FTR%2C%20this%20has%20been%20fixed%20upstream.%0A%3E%20%0A%3E%20Thanks%20the%20ping%2C%20I%20inlined%20upstream%20patch%20in%20the%20next%20iteration%0A%3E%20of%20libzstd%3A%201.4.8%2Bdfsg-2.%20%20Upload%20will%20occur%20with%20urgency%3Dhigh.%0A%3E%20Changes%20are%20available%20on%20Salsa%3A%0A%3E%20%0A%3E%20%09https%3A%2F%2Fsalsa.debian.org%2Fmed-team%2Flibzstd%0A%3E%20%0A%3E%20This%20package%20will%20need%20sponsored%20upload%20%28unless%20Nilesh%20did%20grant%0A%3E%20me%20upload%20permissions.%20%20%3A%29%0A%3E%20%0A%3E%20Have%20a%20nice%20day%2C%0A%3E%20--%20%0A%3E%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%0A%3E%20Fingerprint%3A%20%208f91%20b227%20c7d6%20f2b1%20948c%20%208236%20793c%20f67e%208f0d%2011da%0A%3E%20Sent%20from%20%2Fdev%2Fpts%2F1%2C%20please%20excuse%20my%20verbosity.%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=etienne.mollier%40mailoo.org" alt="">
<div class="header"><span class="headerfield">From:</span> Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Salvatore Bonaccorso &lt;carnil@debian.org&gt;, 982519@bugs.debian.org,
	seb@debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> [sprint] [RFS] libzstd 1.4.8+dfsg-2</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 18 Feb 2021 11:34:37 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=982519;msg=24">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Control: tag -1 pending

Hi Sébastien, Hi Salvatore,

Salvatore Bonaccorso, on 2021-02-18 06:19:29 +0100:
&gt; FTR, this has been fixed upstream.

Thanks the ping, I inlined upstream patch in the next iteration
of libzstd: 1.4.8+dfsg-2.  Upload will occur with urgency=high.
Changes are available on Salsa:

	<a href="https://salsa.debian.org/med-team/libzstd">https://salsa.debian.org/med-team/libzstd</a>

This package will need sponsored upload (unless Nilesh did grant
me upload permissions.  :)

Have a nice day,
-- 
Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;
Fingerprint:  8f91 b227 c7d6 f2b1 948c  8236 793c f67e 8f0d 11da
Sent from /dev/pts/1, please excuse my verbosity.
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=982519;filename=signature.asc;msg=24">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="25"></a>
<!-- command:tag -->
<!-- requester: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- request_addr: 982519-submit@bugs.debian.org -->
<!-- time:1613644742 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security pending&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security&#39;
            };
-->
<strong>Added tag(s) pending.</strong>
Request was from <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>
to <code>982519-submit@bugs.debian.org</code>.
 (Thu, 18 Feb 2021 10:39:02 GMT) (<a href="bugreport.cgi?bug=982519;msg=26">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="27"></a>
<!-- command:found -->
<!-- requester: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1613645465 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libzstd/1.3.8+dfsg-3+deb10u1&#39;,
                                    &#39;libzstd/1.4.8+dfsg-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libzstd/1.4.8+dfsg-1&#39;
                                  ]
            };
-->
<strong>Marked as found in versions libzstd/1.3.8+dfsg-3+deb10u1.</strong>
Request was from <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 18 Feb 2021 10:51:05 GMT) (<a href="bugreport.cgi?bug=982519;msg=28">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=28">mbox</a>, <a href="#27">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="29"></a>
<!-- command:found -->
<!-- requester: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1613645466 -->
<!-- new_data:
$new_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libzstd/1.3.8+dfsg-3+deb10u1&#39;,
                                    &#39;libzstd/1.1.2-1&#39;,
                                    &#39;libzstd/1.4.8+dfsg-1&#39;
                                  ]
            };
-->
<!-- old_data:
$old_data = {
              &#39;found_versions&#39; =&gt; [
                                    &#39;libzstd/1.3.8+dfsg-3+deb10u1&#39;,
                                    &#39;libzstd/1.4.8+dfsg-1&#39;
                                  ]
            };
-->
<strong>Marked as found in versions libzstd/1.1.2-1.</strong>
Request was from <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 18 Feb 2021 10:51:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=30">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=30">mbox</a>, <a href="#29">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="31"></a>
<!-- request_addr: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- time:1613647266 -->
<strong>Reply sent</strong>
to <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>:<br>
You have taken responsibility.
 (Thu, 18 Feb 2021 11:21:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=32">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=32">mbox</a>, <a href="#31">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="33"></a>
<!-- request_addr: Sebastien Delafond &lt;seb@debian.org&gt; -->
<!-- time:1613647266 -->
<strong>Notification sent</strong>
to <code>Sebastien Delafond &lt;seb@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
 (Thu, 18 Feb 2021 11:21:06 GMT) (<a href="bugreport.cgi?bug=982519;msg=34">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="35"></a><a name="msg35"></a><a href="#35">Message #35</a> received at 982519-close@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=35">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=35">mbox</a>, <a href="mailto:982519@bugs.debian.org?subject=Re%3A%20Bug%23982519%3A%20fixed%20in%20libzstd%201.4.8%2Bdfsg-2&amp;In-Reply-To=%3CE1lChLA-0005cd-Oj%40fasolo.debian.org%3E&amp;References=%3CE1lChLA-0005cd-Oj%40fasolo.debian.org%3E&amp;body=On%20Thu%2C%2018%20Feb%202021%2011%3A19%3A24%20%2B0000%20Debian%20FTP%20Masters%20%3Cftpmaster%40ftp-master.debian.org%3E%20wrote%3A%0A%3E%20Source%3A%20libzstd%0A%3E%20Source-Version%3A%201.4.8%2Bdfsg-2%0A%3E%20Done%3A%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20libzstd%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20982519%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%20%28supplier%20of%20updated%20libzstd%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA512%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Thu%2C%2018%20Feb%202021%2009%3A52%3A53%20%2B0100%0A%3E%20Source%3A%20libzstd%0A%3E%20Architecture%3A%20source%0A%3E%20Version%3A%201.4.8%2Bdfsg-2%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20high%0A%3E%20Maintainer%3A%20Debian%20Med%20Packaging%20Team%20%3Cdebian-med-packaging%40lists.alioth.debian.org%3E%0A%3E%20Changed-By%3A%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%0A%3E%20Closes%3A%20982519%0A%3E%20Changes%3A%0A%3E%20%20libzstd%20%281.4.8%2Bdfsg-2%29%20unstable%3B%20urgency%3Dhigh%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20Team%20upload.%0A%3E%20%20%20%20%2A%20When%20a%20file%20with%20restricted%20permissions%20is%20compressed%2C%20the%20resulting%20file%0A%3E%20%20%20%20%20%20inherits%20the%20umask%20of%20the%20user%20for%20the%20time%20of%20the%20compression.%20%20This%20was%0A%3E%20%20%20%20%20%20partially%20mitigated%20previously%20by%20running%20a%20change%20of%20permissions%20after%20a%0A%3E%20%20%20%20%20%20%60chmod%60%2C%20but%20left%20a%20small%20but%20exploitable%20window%20just%20after%20the%20%60fopen%60.%0A%3E%20%20%20%20%20%20This%20update%20adds%200018-fix-file-permissions-on-compression.patch%20to%20make%0A%3E%20%20%20%20%20%20sure%20the%20compressed%20file%20is%20not%20group%20nor%20world%20readable%20for%20the%20_entire_%0A%3E%20%20%20%20%20%20duration%20of%20the%20compression.%0A%3E%20%20%20%20%20%20Closes%3A%20%23982519%0A%3E%20Checksums-Sha1%3A%0A%3E%20%20c03852712749e44d07c52073b0862c74fc536326%202266%20libzstd_1.4.8%2Bdfsg-2.dsc%0A%3E%20%207ddd022f263593fd1420a20b726988fc4177e566%2014644%20libzstd_1.4.8%2Bdfsg-2.debian.tar.xz%0A%3E%20%203446d20b07dc6f52cfcb4a3abf9b4d7c84c1d104%207398%20libzstd_1.4.8%2Bdfsg-2_amd64.buildinfo%0A%3E%20Checksums-Sha256%3A%0A%3E%20%20956bf60dc6f33a2a1deac7b0323d31e409fa8833f0fad423cede60a96ce73317%202266%20libzstd_1.4.8%2Bdfsg-2.dsc%0A%3E%20%2067cb0e652e9b6f543640b82ff5a5e94460d8e107521af7518e06477aa4df0822%2014644%20libzstd_1.4.8%2Bdfsg-2.debian.tar.xz%0A%3E%20%202bc235602530e434b8811d4732197c1e6878bdfee58e4872f39e1b3936b5595c%207398%20libzstd_1.4.8%2Bdfsg-2_amd64.buildinfo%0A%3E%20Files%3A%0A%3E%20%20c4b5c38975d04467ae5b9b564770a6bf%202266%20libs%20optional%20libzstd_1.4.8%2Bdfsg-2.dsc%0A%3E%20%20908f01d234189534d8661d8a2c2f77c1%2014644%20libs%20optional%20libzstd_1.4.8%2Bdfsg-2.debian.tar.xz%0A%3E%20%20afbf6a443b713102575837d428704b1e%207398%20libs%20optional%20libzstd_1.4.8%2Bdfsg-2_amd64.buildinfo%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Debian FTP Masters &lt;ftpmaster@ftp-master.debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 982519-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#982519: fixed in libzstd 1.4.8+dfsg-2</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 18 Feb 2021 11:19:24 +0000</div>
</div>
<pre class="message">Source: libzstd
Source-Version: 1.4.8+dfsg-2
Done: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;

We believe that the bug you reported is fixed in the latest version of
libzstd, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 982519@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; (supplier of updated libzstd package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Thu, 18 Feb 2021 09:52:53 +0100
Source: libzstd
Architecture: source
Version: 1.4.8+dfsg-2
Distribution: unstable
Urgency: high
Maintainer: Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;
Changed-By: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;
Closes: <a href="bugreport.cgi?bug=982519">982519</a>
Changes:
 libzstd (1.4.8+dfsg-2) unstable; urgency=high
 .
   * Team upload.
   * When a file with restricted permissions is compressed, the resulting file
     inherits the umask of the user for the time of the compression.  This was
     partially mitigated previously by running a change of permissions after a
     `chmod`, but left a small but exploitable window just after the `fopen`.
     This update adds 0018-fix-file-permissions-on-compression.patch to make
     sure the compressed file is not group nor world readable for the _entire_
     duration of the compression.
     Closes: #<a href="bugreport.cgi?bug=982519">982519</a>
Checksums-Sha1:
 c03852712749e44d07c52073b0862c74fc536326 2266 libzstd_1.4.8+dfsg-2.dsc
 7ddd022f263593fd1420a20b726988fc4177e566 14644 libzstd_1.4.8+dfsg-2.debian.tar.xz
 3446d20b07dc6f52cfcb4a3abf9b4d7c84c1d104 7398 libzstd_1.4.8+dfsg-2_amd64.buildinfo
Checksums-Sha256:
 956bf60dc6f33a2a1deac7b0323d31e409fa8833f0fad423cede60a96ce73317 2266 libzstd_1.4.8+dfsg-2.dsc
 67cb0e652e9b6f543640b82ff5a5e94460d8e107521af7518e06477aa4df0822 14644 libzstd_1.4.8+dfsg-2.debian.tar.xz
 2bc235602530e434b8811d4732197c1e6878bdfee58e4872f39e1b3936b5595c 7398 libzstd_1.4.8+dfsg-2_amd64.buildinfo
Files:
 c4b5c38975d04467ae5b9b564770a6bf 2266 libs optional libzstd_1.4.8+dfsg-2.dsc
 908f01d234189534d8661d8a2c2f77c1 14644 libs optional libzstd_1.4.8+dfsg-2.debian.tar.xz
 afbf6a443b713102575837d428704b1e 7398 libs optional libzstd_1.4.8+dfsg-2_amd64.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEj5GyJ8fW8rGUjII2eTz2fo8NEdoFAmAuPdQACgkQeTz2fo8N
Edq5kw//bMU9RNODi4Vn/LQwx38j13P+uirwvPM7+BKbq1v3Gr4FBdogbCZarChM
aMnQ5BDMFGThZaW69GXrGEEZB/EuhIbwNWH3tBpbAEYLlz7vfg5JlmVNW/WxhifR
/l05ZAUzix0wx6fFfM11tVXDX0Tjr/pa60aNnbw3Bu2tJrjuLR0foh8iSyLHSDsf
jjRBrf7OtRV2X8d7r5xOUuHkmVXyGV3Bp5g8yhrSBGIW/9kjXRrcOUbUXTb7lca6
tmAgRnXAfAK1+GCPYMelJANRTjSVKEXcEArlIKKkXWLqdclRLcpHDEA5flXceoGx
bNtooNwEPZCuYak7BDq4US8C0Wsn3sP3Fmolzuwo4+Vw7DCXcDRSoQuupHj2qRJC
otlCJcTP1cr2rHGlSzzfHCK8cIuH8TgkOqsRu7zmKA1i4B5l1NRdYvI4T2Lcm1og
/SITL57mlqnwqtpSrXOT48nuH7k9Gi1he6r6B98e/YSuW5YEeJ6+ULyDYGrtC0EL
QL3avVLUQi0PMCwHupI6+zaGqPu3pdSO//A3YsE6cmNobeb3Ywax3/Za6SfDKdQh
K+GYAK0tj4JTd4lvR4y2gZkZNHCYUKm8NSK68+ttQwB/3mxTdPan5AJ2RrH7Sz7M
0M+dSq/FxNQM60WnSaVFXcVDkOVNAbA/XGJg3isDgM+WBODAgIU=
=urmZ
-----END PGP SIGNATURE-----



</pre>

<div class="infmessage"><hr><p>
<a name="36"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt; -->
<!-- time:1613672823 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#982519</code>; Package <code>zstd</code>.
 (Thu, 18 Feb 2021 18:27:03 GMT) (<a href="bugreport.cgi?bug=982519;msg=37">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=37">mbox</a>, <a href="#36">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="38"></a>
<!-- request_addr: Thorsten Glaser &lt;t.glaser@tarent.de&gt; -->
<!-- time:1613672823 -->
<strong>Acknowledgement sent</strong>
to <code>Thorsten Glaser &lt;t.glaser@tarent.de&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;</code>.
 (Thu, 18 Feb 2021 18:27:03 GMT) (<a href="bugreport.cgi?bug=982519;msg=39">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="40"></a><a name="msg40"></a><a href="#40">Message #40</a> received at 982519@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=40">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=40">mbox</a>, <a href="mailto:982519@bugs.debian.org?body=On%20Thu%2C%2018%20Feb%202021%2019%3A23%3A59%20%2B0100%20%28CET%29%20Thorsten%20Glaser%20%3Ct.glaser%40tarent.de%3E%20wrote%3A%0A%3E%20On%20Thu%2C%2018%20Feb%202021%2C%20Salvatore%20Bonaccorso%20wrote%3A%0A%3E%20%3E%20On%20Thu%2C%20Feb%2011%2C%202021%20at%2008%3A33%3A58AM%20%2B0100%2C%20Sebastien%20Delafond%20wrote%3A%0A%3E%20%0A%3E%20%3E%20%3E%20The%20recently%20applied%20patch%20still%20creates%20the%20file%20with%20the%20default%0A%3E%20%3E%20%3E%20umask%5B0%5D%2C%20before%20chmod%27ing%20down%20to%200600%2C%20so%20an%20attacker%20could%20still%20open%0A%3E%20%3E%20%3E%20it%20in%20the%20meantime.%0A%3E%20%3E%0A%3E%20%3E%20FTR%2C%20this%20has%20been%20fixed%20upstream.%0A%3E%20%3E%0A%3E%20%3E%20https%3A%2F%2Fgithub.com%2Ffacebook%2Fzstd%2Fcommit%2Fa774c5797399040af62db21d8a9b9769e005430e%0A%3E%20%0A%3E%20%7C%20Note%20that%20a%20downside%20of%20this%20solution%20is%20that%20it%20is%20global%3A%20%60umask%28%29%60%20affects%0A%3E%20%7C%20all%20file%20creation%20calls%20in%20the%20process.%20I%20believe%20this%20is%20safe%20since%0A%3E%20%7C%20%5B%E2%80%A6%5D%20thread%20%5B%E2%80%A6%5D%0A%3E%20%0A%3E%20Why%20don%E2%80%99t%20you%20use%20a%20n%C5%8Dn-global%20solution%20then%3F%0A%3E%20%0A%3E%20Instead%20of%20fopen%28%E2%80%A6%29%20do%20an%20open%28%E2%80%A6%2C%200600%29%20followed%20by%20fdopen%28%29.%0A%3E%20%0A%3E%20bye%2C%0A%3E%20%2F%2Fmirabilos%0A%3E%20--%20%0A%3E%20Sometimes%20they%20%5Bpeople%5D%20care%20too%20much%3A%20pretty%20printers%20%5Band%20syntax%20highligh-%0A%3E%20ting%2C%20d.A.%5D%20mechanically%20produce%20pretty%20output%20that%20accentuates%20irrelevant%0A%3E%20detail%20in%20the%20program%2C%20which%20is%20as%20sensible%20as%20putting%20all%20the%20prepositions%0A%3E%20in%20English%20text%20in%20bold%20font.%09--%20Rob%20Pike%20in%20%22Notes%20on%20Programming%20in%20C%22%0A%3E%20%0A%3E%20%0A&amp;References=%3C161302883810.4154573.14498031941503694432.reportbug%40hulk.befour.org%3E%20%3CYC344fE5FdXbCL2w%40lorien.valinor.li%3E%0A%20%3C306cf655-b112-bd13-6a88-328780292c1c%40tarent.de%3E&amp;In-Reply-To=%3C306cf655-b112-bd13-6a88-328780292c1c%40tarent.de%3E&amp;subject=Re%3A%20Bug%23982519%3A%20zstd%3A%20Race%20condition%20allows%20attacker%20to%20access%0A%20world-readable%20destination%20file">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=t.glaser%40tarent.de" alt="">
<div class="header"><span class="headerfield">From:</span> Thorsten Glaser &lt;t.glaser@tarent.de&gt;</div>
<div class="header"><span class="headerfield">To:</span> &quot;W. Felix Handte&quot; &lt;w@felixhandte.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> Salvatore Bonaccorso &lt;carnil@debian.org&gt;, 
    Sebastien Delafond &lt;seb@debian.org&gt;, 982519@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#982519: zstd: Race condition allows attacker to access
 world-readable destination file</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 18 Feb 2021 19:23:59 +0100 (CET)</div>
</div>
<pre class="message">On Thu, 18 Feb 2021, Salvatore Bonaccorso wrote:
&gt; On Thu, Feb 11, 2021 at 08:33:58AM +0100, Sebastien Delafond wrote:

&gt; &gt; The recently applied patch still creates the file with the default
&gt; &gt; umask[0], before chmod&#39;ing down to 0600, so an attacker could still open
&gt; &gt; it in the meantime.
&gt;
&gt; FTR, this has been fixed upstream.
&gt;
&gt; <a href="https://github.com/facebook/zstd/commit/a774c5797399040af62db21d8a9b9769e005430e">https://github.com/facebook/zstd/commit/a774c5797399040af62db21d8a9b9769e005430e</a>

| Note that a downside of this solution is that it is global: `umask()` affects
| all file creation calls in the process. I believe this is safe since
| […] thread […]

Why don’t you use a nōn-global solution then?

Instead of fopen(…) do an open(…, 0600) followed by fdopen().

bye,
//mirabilos
-- 
Sometimes they [people] care too much: pretty printers [and syntax highligh-
ting, d.A.] mechanically produce pretty output that accentuates irrelevant
detail in the program, which is as sensible as putting all the prepositions
in English text in bold font.	-- Rob Pike in &quot;Notes on Programming in C&quot;


</pre>

<div class="msgreceived"><hr><p>
<a name="41"></a>
<!-- request_addr: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; -->
<!-- time:1614188172 -->
<strong>Reply sent</strong>
to <code>Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;</code>:<br>
You have taken responsibility.
 (Wed, 24 Feb 2021 17:36:12 GMT) (<a href="bugreport.cgi?bug=982519;msg=42">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="43"></a>
<!-- request_addr: Sebastien Delafond &lt;seb@debian.org&gt; -->
<!-- time:1614188172 -->
<strong>Notification sent</strong>
to <code>Sebastien Delafond &lt;seb@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
 (Wed, 24 Feb 2021 17:36:12 GMT) (<a href="bugreport.cgi?bug=982519;msg=44">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="45"></a><a name="msg45"></a><a href="#45">Message #45</a> received at 982519-close@bugs.debian.org (<a href="bugreport.cgi?bug=982519;msg=45">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=45">mbox</a>, <a href="mailto:982519@bugs.debian.org?In-Reply-To=%3CE1lEy1h-000Cvg-VO%40fasolo.debian.org%3E&amp;subject=Re%3A%20Bug%23982519%3A%20fixed%20in%20libzstd%201.3.8%2Bdfsg-3%2Bdeb10u2&amp;body=On%20Wed%2C%2024%20Feb%202021%2017%3A32%3A41%20%2B0000%20Debian%20FTP%20Masters%20%3Cftpmaster%40ftp-master.debian.org%3E%20wrote%3A%0A%3E%20Source%3A%20libzstd%0A%3E%20Source-Version%3A%201.3.8%2Bdfsg-3%2Bdeb10u2%0A%3E%20Done%3A%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20libzstd%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20982519%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%20%28supplier%20of%20updated%20libzstd%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA512%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Thu%2C%2018%20Feb%202021%2012%3A59%3A48%20%2B0100%0A%3E%20Source%3A%20libzstd%0A%3E%20Architecture%3A%20source%0A%3E%20Version%3A%201.3.8%2Bdfsg-3%2Bdeb10u2%0A%3E%20Distribution%3A%20buster-security%0A%3E%20Urgency%3A%20high%0A%3E%20Maintainer%3A%20Debian%20Med%20Packaging%20Team%20%3Cdebian-med-packaging%40lists.alioth.debian.org%3E%0A%3E%20Changed-By%3A%20%C3%89tienne%20Mollier%20%3Cetienne.mollier%40mailoo.org%3E%0A%3E%20Closes%3A%20982519%0A%3E%20Changes%3A%0A%3E%20%20libzstd%20%281.3.8%2Bdfsg-3%2Bdeb10u2%29%20buster-security%3B%20urgency%3Dhigh%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20Team%20upload.%0A%3E%20%20%20%20%2A%20The%20previous%20fix-file-permissions-on-compression.patch%20almost%20closed%20the%0A%3E%20%20%20%20%20%20window%20of%20the%20race%20condition%2C%20but%20not%20completely.%20%20This%20patch%2C%20adapted%20from%0A%3E%20%20%20%20%20%20upstream%2C%200017-fix-file-permissions-on-compression.patch%2C%20replaces%20the%0A%3E%20%20%20%20%20%20previous%20attempt%20by%20erasing%20the%20umask%20before%20opening%20the%20destination%20file.%0A%3E%20%20%20%20%20%20Closes%3A%20%23982519%0A%3E%20Checksums-Sha1%3A%0A%3E%20%2003d81ebef581456fe05ed1b29c04b7a246397e31%201947%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.dsc%0A%3E%20%2015d166c14fb22f550ae877780e7df4181db3db99%2011648%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.debian.tar.xz%0A%3E%20%2059e9ea6e541e66619ccd623c803bff02a73fa9d2%207283%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2_amd64.buildinfo%0A%3E%20Checksums-Sha256%3A%0A%3E%20%20572fae1c7dc9bace3b9f7fcdeabf30dd1d00d0462e319ccec7b58b0adbf7dc85%201947%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.dsc%0A%3E%20%201f107f6cdc3bf46fb2aebf9c5c997ed2a125ac2fb1d28e939da857d5b061079e%2011648%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.debian.tar.xz%0A%3E%20%204a9e21b3a79b55dc746cc49e73a071dcecc0dc72d337c1b7d7ea1e5d2cd5eeb5%207283%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2_amd64.buildinfo%0A%3E%20Files%3A%0A%3E%20%200b2a0be995c017b99e7127727983a08f%201947%20libs%20optional%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.dsc%0A%3E%20%20e89a2db50691a011ba72efe6b207f8fc%2011648%20libs%20optional%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2.debian.tar.xz%0A%3E%20%20dedf0ea07aeba086357e2f1cc5529d47%207283%20libs%20optional%20libzstd_1.3.8%2Bdfsg-3%2Bdeb10u2_amd64.buildinfo%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNATURE-----%0A%3E%20%0A&amp;References=%3CE1lEy1h-000Cvg-VO%40fasolo.debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Debian FTP Masters &lt;ftpmaster@ftp-master.debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 982519-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#982519: fixed in libzstd 1.3.8+dfsg-3+deb10u2</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 24 Feb 2021 17:32:41 +0000</div>
</div>
<pre class="message">Source: libzstd
Source-Version: 1.3.8+dfsg-3+deb10u2
Done: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;

We believe that the bug you reported is fixed in the latest version of
libzstd, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 982519@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Étienne Mollier &lt;etienne.mollier@mailoo.org&gt; (supplier of updated libzstd package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Thu, 18 Feb 2021 12:59:48 +0100
Source: libzstd
Architecture: source
Version: 1.3.8+dfsg-3+deb10u2
Distribution: buster-security
Urgency: high
Maintainer: Debian Med Packaging Team &lt;debian-med-packaging@lists.alioth.debian.org&gt;
Changed-By: Étienne Mollier &lt;etienne.mollier@mailoo.org&gt;
Closes: <a href="bugreport.cgi?bug=982519">982519</a>
Changes:
 libzstd (1.3.8+dfsg-3+deb10u2) buster-security; urgency=high
 .
   * Team upload.
   * The previous fix-file-permissions-on-compression.patch almost closed the
     window of the race condition, but not completely.  This patch, adapted from
     upstream, 0017-fix-file-permissions-on-compression.patch, replaces the
     previous attempt by erasing the umask before opening the destination file.
     Closes: #<a href="bugreport.cgi?bug=982519">982519</a>
Checksums-Sha1:
 03d81ebef581456fe05ed1b29c04b7a246397e31 1947 libzstd_1.3.8+dfsg-3+deb10u2.dsc
 15d166c14fb22f550ae877780e7df4181db3db99 11648 libzstd_1.3.8+dfsg-3+deb10u2.debian.tar.xz
 59e9ea6e541e66619ccd623c803bff02a73fa9d2 7283 libzstd_1.3.8+dfsg-3+deb10u2_amd64.buildinfo
Checksums-Sha256:
 572fae1c7dc9bace3b9f7fcdeabf30dd1d00d0462e319ccec7b58b0adbf7dc85 1947 libzstd_1.3.8+dfsg-3+deb10u2.dsc
 1f107f6cdc3bf46fb2aebf9c5c997ed2a125ac2fb1d28e939da857d5b061079e 11648 libzstd_1.3.8+dfsg-3+deb10u2.debian.tar.xz
 4a9e21b3a79b55dc746cc49e73a071dcecc0dc72d337c1b7d7ea1e5d2cd5eeb5 7283 libzstd_1.3.8+dfsg-3+deb10u2_amd64.buildinfo
Files:
 0b2a0be995c017b99e7127727983a08f 1947 libs optional libzstd_1.3.8+dfsg-3+deb10u2.dsc
 e89a2db50691a011ba72efe6b207f8fc 11648 libs optional libzstd_1.3.8+dfsg-3+deb10u2.debian.tar.xz
 dedf0ea07aeba086357e2f1cc5529d47 7283 libs optional libzstd_1.3.8+dfsg-3+deb10u2_amd64.buildinfo

-----BEGIN PGP SIGNATURE-----

iQEzBAEBCgAdFiEEAqSkbVtrXP4xJMh3EL6Jg/PVnWQFAmAvkY4ACgkQEL6Jg/PV
nWSsCwf/RC+pOALg8V4rP3nRB9z8mkQ9UB+5jdge8iOgI8AYJquWPtgj9OElh+eF
Sf/hFRA8dbaE/vK0ytoTvPUHQftI+tSgkwsRFrvSA33jUrU+LziRsYy8ruBHSQ1j
c/E2oskPswzDN3OCwWMjNYMzmmRg0w1z9BsiFDSMpTN1C1BCncL8qXiTBbL3OT8n
msJpxQC8jyomZvtymB9rgqRgJqJcyg2WZTmtZhBUXOQb/GsVeDSUhTI8SDYG6KrW
NCpqC4N3Q1ECaFWA9TJJJyqOlK2TWf6IUi8MC2Pko0xqE75GOZj92fl9vBUCsVgR
W3q6cPwPXRAXrHXXZpotKBwPseY4Vw==
=aPXH
-----END PGP SIGNATURE-----



</pre>

<div class="msgreceived"><hr><p>
<a name="46"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1616916364 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Sun, 28 Mar 2021 07:26:04 GMT) (<a href="bugreport.cgi?bug=982519;msg=47">full text</a>, <a href="bugreport.cgi?bug=982519;mbox=yes;msg=47">mbox</a>, <a href="#46">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=982519">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:36:38 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->buxtehude<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
