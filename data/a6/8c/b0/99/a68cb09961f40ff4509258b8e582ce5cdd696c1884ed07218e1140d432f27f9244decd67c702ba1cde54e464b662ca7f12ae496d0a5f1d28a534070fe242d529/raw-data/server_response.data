<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en">
<head>
<title>Bug 777991 – Nautilus hides filename for .desktop files with execute permission</title>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="https://bugzilla.gnome.org/" rel="Top"/>
<link href="showdependencytree.cgi?id=777991&amp;hide_resolved=1" rel="Show" title="Dependency Tree"/>
<link href="show_bug.cgi?format=multiple&amp;id=777991" rel="Show" title="Printer-Friendly Version"/>
<link href="skins/standard/global.css" rel="alternate stylesheet" title="Classic"/><link href="js/yui/assets/skins/sam/autocomplete.css" rel="stylesheet" type="text/css"/><link href="js/yui/assets/skins/sam/calendar.css" rel="stylesheet" type="text/css"/><link href="skins/standard/global.css" rel="stylesheet" type="text/css"/><link href="skins/standard/show_bug.css" rel="stylesheet" type="text/css"/><!--[if lte IE 7]>
      


  <link href="skins/standard/IE-fixes.css" rel="stylesheet"
        type="text/css" >
<![endif]-->
<link href="skins/contrib/Gnome/global.css" rel="stylesheet" title="Gnome" type="text/css"/>
<script src="js/yui/yahoo-dom-event/yahoo-dom-event.js" type="text/javascript"></script><script src="js/yui/cookie/cookie-min.js" type="text/javascript"></script><script src="js/yui/datasource/datasource-min.js" type="text/javascript"></script><script src="js/yui/connection/connection-min.js" type="text/javascript"></script><script src="js/yui/json/json-min.js" type="text/javascript"></script><script src="js/yui/autocomplete/autocomplete-min.js" type="text/javascript"></script><script src="js/yui/calendar/calendar-min.js" type="text/javascript"></script><script src="js/global.js" type="text/javascript"></script>
<script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 50
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    'You must enter a Description for this attachment.',
                component_required:
                    'You must select a Component for this bug.',
                description_required:
                    'You must enter a Description for this bug.',
                short_desc_required:
                    'You must enter a Summary for this bug.',
                version_required:
                    'You must select a Version for this bug.'
            }
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null, 
                             "Bug 777991 – Nautilus hides filename for .desktop files with execute permission",  
                             "show_bug.cgi?id=777991" );
        document.title = "Bug 777991 – Nautilus hides filename for .desktop files with execute permission";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "Bug 777991 – Nautilus hides filename for .desktop files with execute permission", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();
    });
    // -->
    </script>
<script src="js/util.js" type="text/javascript"></script><script src="js/field.js" type="text/javascript"></script>
<link href="./search_plugin.cgi" rel="search" title="GNOME Bugzilla" type="application/opensearchdescription+xml"/>
<link href="images/favicon.ico" rel="shortcut icon"/><link href="extensions/TraceParser/web/style.css" rel="stylesheet" type="text/css"/>
</head>
<body class="bugzilla-gnome-org bz_bug bz_status_RESOLVED bz_product_nautilus bz_component_general bz_bug_777991 yui-skin-sam" onload="">
<div id="header">
<div id="banner">
</div>
<table border="0" cellpadding="0" cellspacing="0" id="titles">
<tr>
<td id="title">
<p>GNOME Bugzilla – Bug 777991</p>
</td>
<td id="subtitle">
<p class="subheader">Nautilus hides filename for .desktop files with execute permission</p>
</td>
<td id="information">
<p class="header_addl_info">Last modified: 2017-10-11 02:29:53 UTC</p>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" class="bz_default_hidden" id="lang_links_container"><tr><td>
</td></tr></table>
<ul class="links"><li><a href="./">Home</a></li></ul>
</div>
<div id="bugzilla-body">
<div style="margin-bottom: 50px; margin-top: 50px; padding: 40px; text-align: center; background-color: rgb(74,134,207); border: rgb(57,104,161); color: rgb(255,255,255); line-height: 300%;">After an <a href="https://wiki.gnome.org/Initiatives/DevelopmentInfrastructure" style="color: rgb(255,255,255);">evaluation</a>, GNOME has moved from Bugzilla to <a href="https://gitlab.gnome.org/" style="color: rgb(255,255,255);">GitLab</a>. <a href="https://wiki.gnome.org/GitLab" style="color: rgb(255,255,255);">Learn more about GitLab</a>. <br/><span style="background-color: #EE0000; font-size: xx-large;"><b>No new issues can be reported in GNOME Bugzilla anymore.</b></span>
<br/><span style="background-color: #EE0000; font-size: xx-large;"><b>To report an issue in a GNOME project, <a href="https://gitlab.gnome.org/GNOME" style="color: rgb(255,255,255);">go to GNOME GitLab</a></b>.</span><br/>Do <b>not</b> go to GNOME Gitlab for: <a href="https://sourceforge.net/p/bluefish/tickets" style="color: rgb(255,255,255);">Bluefish</a>, <a href="https://github.com/doxygen/doxygen/issues" style="color: rgb(255,255,255);">Doxygen</a>, <a href="https://bugs.gnucash.org/" style="color: rgb(255,255,255);">GnuCash</a>, <a href="https://gitlab.freedesktop.org/gstreamer/" style="color: rgb(255,255,255);">GStreamer</a>, <a href="https://github.com/afcowie/java-gnome/issues" style="color: rgb(255,255,255);">java-gnome</a>, <a href="https://github.com/ldtp/ldtp2/issues" style="color: rgb(255,255,255);">LDTP</a>, <a href="https://gitlab.freedesktop.org/NetworkManager/NetworkManager/issues" style="color: rgb(255,255,255);">NetworkManager</a>, <a href="https://github.com/tomboy-notes/tomboy/issues" style="color: rgb(255,255,255);">Tomboy</a>.</div>
<script type="text/javascript">
<!--

//-->
</script>
<form action="process_bug.cgi" id="changeform" method="post" name="changeform">
<input name="delta_ts" type="hidden" value="2017-10-11 02:29:53"/>
<input name="longdesclength" type="hidden" value="31"/>
<input name="id" type="hidden" value="777991"/>
<input name="token" type="hidden" value="1626093959-vgQWVOrLzzspTe9XMarUM81zNjUghIY9PGuBQmyOD78"/>
<div class="bz_alias_short_desc_container edit_form">
<a href="show_bug.cgi?id=777991"><b>Bug 777991</b></a> -<span class="bz_default_hidden" id="summary_alias_container"> 
        (<span id="alias_nonedit_display">CVE-2017-14604</span>) 
      <span id="short_desc_nonedit_display">Nautilus hides filename for .desktop files with execute permission</span>
</span>
<div id="summary_alias_input">
<table id="summary">
<tr>
<td colspan="2">(CVE-2017-14604)
          </td>
</tr>
<tr><th class="field_label" id="field_label_short_desc">
<label accesskey="s" for="short_desc">
<a class="field_help_link" href="page.cgi?id=fields.html#short_desc" title="The bug summary is a short sentence which succinctly describes what the bug is about.">Summary:</a>
</label>
</th>
<td>Nautilus hides filename for .desktop files with execute permission
          </td>
</tr>
</table>
</div>
</div>
<script type="text/javascript">
    hideAliasAndSummary('Nautilus hides filename for .desktop files with execute permission', 'CVE-2017-14604');
  </script>
<table class="edit_form">
<tr>
<td class="bz_show_bug_column" id="bz_show_bug_column_1">
<table>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
<td id="bz_field_status">
<span id="static_bug_status">RESOLVED
          FIXED
      </span>
</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_product">
<a class="field_help_link" href="describecomponents.cgi" title="Bugs are categorised into Products and Components. Select a Classification to narrow down this list.">Product:</a>
</th>
<td class="field_value" id="field_container_product">nautilus</td>
</tr>
<tr class="bz_default_hidden"><th class="field_label" id="field_label_classification">
<a class="field_help_link" href="page.cgi?id=fields.html#classification" title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.">Classification:</a>
</th>
<td class="field_value" id="field_container_classification">Core</td>
</tr>
<tr><th class="field_label" id="field_label_component">
<a class="field_help_link" href="describecomponents.cgi?product=nautilus" title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.">Component:</a>
</th>
<td class="field_value" id="field_container_component">general</td>
</tr>
<tr><th class="field_label" id="field_label_version">
<label for="version">
<a class="field_help_link" href="page.cgi?id=fields.html#version" title="The version field defines the version of the software the bug was found in.">Version:</a>
</label>
</th>
<td>3.22.x
  </td>
</tr>
<tr><th class="field_label" id="field_label_rep_platform">
<label accesskey="h" for="rep_platform">
<a class="field_help_link" href="page.cgi?id=fields.html#rep_platform" title='The hardware platform the bug was observed on. Note: When searching, selecting the option "All" only finds bugs whose value for this field is literally the word "All".'>Hardware:</a>
</label>
</th>
<td class="field_value">Other
       All
      </td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label accesskey="i" for="priority">
<a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
<td>Normal
       normal
      </td>
</tr>
<tr>
<th class="field_label">
<label for="target_milestone">
<a href="page.cgi?id=fields.html#target_milestone">
            Target Milestone</a></label>:
        </th><td>3.24
  </td>
</tr>
<tr>
<th class="field_label">
<a href="page.cgi?id=fields.html#assigned_to">Assigned To</a>:
      </th>
<td><span class="vcard"><span class="fn">Nautilus Maintainers</span>
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_qa_contact">
<label accesskey="q" for="qa_contact">
<a class="field_help_link" href="page.cgi?id=fields.html#qa_contact" title="The person responsible for confirming this bug if it is unconfirmed, and for verifying the fix once the bug has been resolved.">QA Contact:</a>
</label>
</th>
<td><span class="vcard"><span class="fn">Nautilus Maintainers</span>
</span>
</td>
</tr>
<script type="text/javascript">
      assignToDefaultOnChange(['product', 'component'],
        'nautilus-maint\x40gnome.bugs',
        'nautilus-maint\x40gnome.bugs');
    </script>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_bug_file_loc">
<label accesskey="u" for="bug_file_loc">
<a class="field_help_link" href="page.cgi?id=fields.html#bug_file_loc" title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.">URL:</a>
</label>
</th>
<td>
<span id="bz_url_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_status_whiteboard">
<label accesskey="w" for="status_whiteboard">
<a class="field_help_link" href="page.cgi?id=fields.html#status_whiteboard" title="Each bug has a free-form single line text entry box for adding tags and status information.">Whiteboard:</a>
</label>
</th><td colspan="2">
</td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr>
<th class="field_label">
<label for="duplicates">Duplicates</label>:
    </th>
<td class="field_value" colspan="2">
<span id="duplicates"><a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=779547" title="RESOLVED DUPLICATE - Deceptive Display of Dangerous File">779547</a>
</span>
      (<a href="buglist.cgi?bug_id=779547">view as bug list</a>)
    </td>
</tr>
<tr><th class="field_label" id="field_label_dependson">
<a class="field_help_link" href="page.cgi?id=fields.html#dependson" title="The bugs listed here must be resolved before this bug can be resolved.">Depends on:</a>
</th>
<td>
<span id="dependson_input_area">
</span>
</td>
</tr>
<tr><th class="field_label" id="field_label_blocked">
<a class="field_help_link" href="page.cgi?id=fields.html#blocked" title="This bug must be resolved before the bugs listed in this field can be resolved.">Blocks:</a>
</th>
<td>
<span id="blocked_input_area">
</span>
</td>
</tr>
<tr>
<th> </th>

</tr>
</table>
</td>
<td>
<div class="bz_column_spacer"> </div>
</td>
<td class="bz_show_bug_column" id="bz_show_bug_column_2">
<table cellpadding="3" cellspacing="1">
<tr>
<th class="field_label">
      Reported:
    </th>
<td>2017-01-31 16:46 UTC by <span class="vcard"><span class="fn">Christian Boxdörfer</span>
</span>
</td>
</tr>
<tr>
<th class="field_label">
      Modified:
    </th>
<td>2017-10-11 02:29 UTC 
    </td>
</tr>

<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
<tr><th class="field_label" id="field_label_see_also">
<a class="field_help_link" href="page.cgi?id=fields.html#see_also" title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with a comma. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.">See Also:</a>
</th>
<td class="field_value" id="field_container_see_also"></td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_target">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_target" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME target:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_target">---</td>
</tr>
<tr><th class="field_label" id="field_label_cf_gnome_version">
<a class="field_help_link" href="page.cgi?id=fields.html#cf_gnome_version" title="A custom Drop Down field in this installation of GNOME Bugzilla.">GNOME version:</a>
</th>
<td class="field_value" colspan="2" id="field_container_cf_gnome_version">---</td>
</tr>
<tr>
<td class="bz_section_spacer" colspan="2"></td>
</tr>
</table>
</td>
</tr>
<tr>
<td colspan="3">
<hr id="bz_top_half_spacer"/>
</td>
</tr>
</table>
<table cellpadding="0" cellspacing="0" id="bz_big_form_parts"><tr>
<td>
<script type="text/javascript">
<!--
function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>
<br/>
<table cellpadding="4" cellspacing="0" id="attachment_table">
<tr id="a0">
<th align="left" colspan="3">
      Attachments
    </th>
</tr>
<tr class="bz_contenttype_image_png" id="a1">
<td valign="top">
<a href="attachment.cgi?id=344652" title="View the content of the attachment">
<b>Screenshot of malicious .desktop file displayed in Nautilus</b></a>
<span class="bz_attach_extra_info">
              (35.39 KB,
                image/png)

            <br/>
<a href="#attach_344652" title="Go to the comment associated with the attachment">2017-01-31 16:46 UTC</a>,

            <span class="vcard"><span class="fn">Christian Boxdörfer</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">
             
          </td>
<td valign="top">
<a href="attachment.cgi?id=344652&amp;action=edit">Details</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a2">
<td valign="top">
<a href="attachment.cgi?id=345047" title="View the content of the attachment">
<b>mime-actions: use file metadata for trusting desktop files</b></a>
<span class="bz_attach_extra_info">
              (15.96 KB,
                patch)

            <br/>
<a href="#attach_345047" title="Go to the comment associated with the attachment">2017-02-06 17:52 UTC</a>,

            <span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">committed
          </td>
<td valign="top">
<a href="attachment.cgi?id=345047&amp;action=edit">Details</a>  |
    <a href="review?bug=777991&amp;attachment=345047">Review</a>
</td>
</tr>
<tr class="bz_contenttype_text_plain bz_patch" id="a3">
<td valign="top">
<a href="attachment.cgi?id=359888" title="View the content of the attachment">
<b>Backported patch containing cherry-picked translations</b></a>
<span class="bz_attach_extra_info">
              (27.84 KB,
                patch)

            <br/>
<a href="#attach_359888" title="Go to the comment associated with the attachment">2017-09-16 11:45 UTC</a>,

            <span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
</td>
<td class="bz_attach_status" valign="top">none
          </td>
<td valign="top">
<a href="attachment.cgi?id=359888&amp;action=edit">Details</a>  |
    <a href="review?bug=777991&amp;attachment=359888">Review</a>
</td>
</tr>

</table>
<br/>
</td>
<td>
</td>
</tr></table>
<div id="comments"><script src="js/comments.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
  /* Adds the reply text to the `comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>
<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table cellpadding="0" cellspacing="0" class="bz_comment_table"><tr>
<td>
<div class="bz_comment bz_first_comment" id="c0">
<div class="bz_first_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c0">Description</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Christian Boxdörfer</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-01-31 16:46:12 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=344652" name="attach_344652" title="Screenshot of malicious .desktop file displayed in Nautilus">attachment 344652</a> <a href="attachment.cgi?id=344652&amp;action=edit" title="Screenshot of malicious .desktop file displayed in Nautilus">[details]</a></span>
Screenshot of malicious .desktop file displayed in Nautilus

How to reproduce:

1. Create a file called malware.desktop 

2. Add the following content to it:

[Desktop Entry]
Name=CV.pdf
Exec=sh -c 'touch ~/MALWARE_WAS_HERE'
Terminal=false
Icon=x-office-document
Type=Application
Categories=Office

3. Make it executable

Nautilus displays the file like that: (see attachment)

Once the user opens the file the Exec entry is executed without any confirmation. By hiding the filename and therefore also the filename extension users can easily be tricked to execute arbitrary code when some ships files like that in an archive which preserves execute permissions. Especially since nowadays Nautilus even extracts archives with a simple double click.

How to fix it:

Maybe by don't hiding the filename for .desktop files at all.</pre>
</div><div class="bz_comment" id="c1">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c1">Comment 1</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Christian Boxdörfer</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-01-31 17:20:22 UTC
        </span>
</div>
<pre class="bz_comment_text">For reference, this bug also applies to other file managers:
<a href="https://github.com/lxde/pcmanfm-qt/issues/449">https://github.com/lxde/pcmanfm-qt/issues/449</a>
<a href="https://github.com/mate-desktop/caja/issues/727">https://github.com/mate-desktop/caja/issues/727</a>
<a href="https://github.com/linuxmint/nemo/issues/1404">https://github.com/linuxmint/nemo/issues/1404</a></pre>
</div><div class="bz_comment" id="c2">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c2">Comment 2</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Nate Graham</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-01-31 18:40:31 UTC
        </span>
</div>
<pre class="bz_comment_text">I can reproduce the issue. This is a really, really bad security hole. .desktop files shouldn't be able to masquerade as anything else when viewed by the file manager. macOS Finder and Windows Explorer both have security measures put in place to prevent spoofing file extensions in this manner; Nautilus should, too.</pre>
</div><div class="bz_comment" id="c3">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c3">Comment 3</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-02-01 17:23:37 UTC
        </span>
</div>
<pre class="bz_comment_text">The extension is just a detail (as it would putting an emblem or so) which doesn't really communicate or stop the user to run it.

I tried the steps in here and I cannot reproduce, the mimetype is detected as pdf and cannot open it. But this is highly different per system/user, so not something we can rely on.

The solution we came up with is to not allow desktop file activation at all if the desktop file was not created by us or acknowledged by the user via dialog of trusting it.</pre>
</div><div class="bz_comment" id="c4">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c4">Comment 4</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-02-06 17:52:27 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=345047" name="attach_345047" title="mime-actions: use file metadata for trusting desktop files">attachment 345047</a> <a href="attachment.cgi?id=345047&amp;action=edit" title="mime-actions: use file metadata for trusting desktop files">[details]</a></span> <a href="review?bug=777991&amp;attachment=345047">[review]</a>
mime-actions: use file metadata for trusting desktop files

Currently we only trust desktop files that have the executable bit
set, and don't replace the displayed icon or the displayed name until
it's trusted, which prevents for running random programs by a malicious
desktop file.

However, the executable permission is preserved if the desktop file
comes from a compressed file.

To prevent this, add a metadata::trusted metadata to the file once the
user acknowledges the file as trusted. This adds metadata to the file,
which cannot be added unless it has access to the computer.

Also remove the SHEBANG "trusted" content we were putting inside the
desktop file, since that doesn't add more security since it can come
with the file itself.</pre>
</div><div class="bz_comment" id="c5">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c5">Comment 5</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-02-06 17:53:55 UTC
        </span>
</div>
<pre class="bz_comment_text"><span class=""><a href="attachment.cgi?id=345047" name="attach_345047" title="mime-actions: use file metadata for trusting desktop files">Attachment 345047</a> <a href="attachment.cgi?id=345047&amp;action=edit" title="mime-actions: use file metadata for trusting desktop files">[details]</a></span> pushed as <a href="https://git.gnome.org/browse/nautilus/commit/?id=1630f53">1630f53</a> - mime-actions: use file metadata for trusting desktop files</pre>
</div><div class="bz_comment" id="c6">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c6">Comment 6</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-03-04 11:50:15 UTC
        </span>
</div>
<pre class="bz_comment_text">*** <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=779547" title="RESOLVED DUPLICATE - Deceptive Display of Dangerous File">Bug 779547</a> has been marked as a duplicate of this bug. ***</pre>
</div><div class="bz_comment" id="c7">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c7">Comment 7</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-07 11:56:52 UTC
        </span>
</div>
<pre class="bz_comment_text">Carlos, thank you for resolving this security issue. Is there a plan to backport this fix to the 3.22.x branch to make it available for Debian users? Debian wants to backport this patch as a security update [1].

I think that a CVE should be requested for this issue to help all distros coordinate on the deployment of the patch for this vulnerability. It is possible to trivially exploit this issue in-the-wild [1]. I'm happy to file the CVE request if you would like me too.

[1] <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860268">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860268</a>
[2] <a href="https://github.com/freedomofpress/securedrop/issues/2238">https://github.com/freedomofpress/securedrop/issues/2238</a></pre>
</div><div class="bz_comment" id="c8">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c8">Comment 8</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-07 12:13:23 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to Donncha Ó Cearbhaill from <a href="show_bug.cgi?id=777991#c7">comment #7</a>)
<span class="quote">&gt; Carlos, thank you for resolving this security issue. Is there a plan to
&gt; backport this fix to the 3.22.x branch to make it available for Debian
&gt; users? Debian wants to backport this patch as a security update [1].
&gt; 
&gt; I think that a CVE should be requested for this issue to help all distros
&gt; coordinate on the deployment of the patch for this vulnerability. It is
&gt; possible to trivially exploit this issue in-the-wild [1]. I'm happy to file
&gt; the CVE request if you would like me too.
&gt; 
&gt; [1] <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860268">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860268</a>
&gt; [2] <a href="https://github.com/freedomofpress/securedrop/issues/2238">https://github.com/freedomofpress/securedrop/issues/2238</a></span>

Not in principle, 3.22 is not supported upstream neither any new 3.22.x releases are expected.

If it's something that will be of convenience to Debian I'm fine doing a release, but someone will have to do the backport since I believe there will be conflicts.

I'm fine if you want to file a CVE indeed.</pre>
</div><div class="bz_comment" id="c9">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c9">Comment 9</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-07 13:03:16 UTC
        </span>
</div>
<pre class="bz_comment_text">Phil Wyett has provided a debdiff of the .desktop fix backported to 3.22.3. Is that patch acceptable for you?

<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=860268;filename=nautilus_3.22.3-1_to_nautilus_3.22.3-1.1.debdiff;msg=19">https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=860268;filename=nautilus_3.22.3-1_to_nautilus_3.22.3-1.1.debdiff;msg=19</a>

I'll file a CVE request for the issue.</pre>
</div><div class="bz_comment" id="c10">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c10">Comment 10</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-07 13:07:29 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to Donncha Ó Cearbhaill from <a href="show_bug.cgi?id=777991#c9">comment #9</a>)
<span class="quote">&gt; Phil Wyett has provided a debdiff of the .desktop fix backported to 3.22.3.
&gt; Is that patch acceptable for you?
&gt; 
&gt; <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=860268">https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=860268</a>;
&gt; filename=nautilus_3.22.3-1_to_nautilus_3.22.3-1.1.debdiff;msg=19
&gt; 
&gt; I'll file a CVE request for the issue.</span>

Sorry, I just remember this has UI changes. This cannot be accepted upstream since we don't have UI changes in stable branches.

Should be fine as downstream patch, and you might want to cherry-pick translations for those string changes too.</pre>
</div><div class="bz_comment" id="c11">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c11">Comment 11</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-07 14:45:56 UTC
        </span>
</div>
<pre class="bz_comment_text">Okay, thank you. I'll follow-up with Debian about downstream backport.</pre>
</div><div class="bz_comment" id="c12">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c12">Comment 12</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-16 11:45:46 UTC
        </span>
</div>
<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=359888" name="attach_359888" title="Backported patch containing cherry-picked translations">attachment 359888</a> <a href="attachment.cgi?id=359888&amp;action=edit" title="Backported patch containing cherry-picked translations">[details]</a></span> <a href="review?bug=777991&amp;attachment=359888">[review]</a>
Backported patch containing cherry-picked translations</pre>
</div><div class="bz_comment" id="c13">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c13">Comment 13</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-16 11:46:02 UTC
        </span>
</div>
<pre class="bz_comment_text">I've updated a backport of your patch to include translations for the
"Trust and _Launch" string.

It looks like .gmo file are built and included in the upstream release?
I'm trying to rebuild the gmo files with the new translations during the
Debian package building process. Do you know what modifications I need
to make in order to force a rebuild of the gmo files?

Phil Wyett opened a ticket on the Redhat bug tracker in order to get
this fix backported to RHEL and Fedora too.</pre>
</div><div class="bz_comment" id="c14">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c14">Comment 14</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-16 14:31:05 UTC
        </span>
</div>
<pre class="bz_comment_text">Cool. No I don't know off hand about gmo files, a wild guess: maybe you need to distcheck?

Otherwise I'm sure someone in #gnome-hackers could help you, I know few who cherry picked translations in the past as downstream patches.</pre>
</div><div class="bz_comment" id="c15">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c15">Comment 15</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Cedric Buissart</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-18 08:03:08 UTC
        </span>
</div>
<pre class="bz_comment_text">Hi,
Any news on the CVE assignment ? 
I can request one from Red Hat if needed.</pre>
</div><div class="bz_comment" id="c16">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c16">Comment 16</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-18 08:15:55 UTC
        </span>
</div>
<pre class="bz_comment_text">Hi,

I have not been received the CVE yet. I requested the CVE from the Distributed Weakness Filing project. I don't want to cause any confusion by requesting a CVE for the same issue twice. If you think that it is not a problem, the please feel free to request one from Red Hat instead.</pre>
</div><div class="bz_comment" id="c17">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c17">Comment 17</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Michael Catanzaro</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-18 13:08:32 UTC
        </span>
</div>
<pre class="bz_comment_text">Turnaround time from DWF is generally upwards of four months in my experience (I've used it three times). It will come through eventually, and you will have a duplicate if you get impatient and request one somewhere else.</pre>
</div><div class="bz_comment" id="c18">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c18">Comment 18</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Cedric Buissart</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-20 08:42:08 UTC
        </span>
</div>
<pre class="bz_comment_text">4 months would mean we would hit the anniversary of the discovery before getting a CVE :)
I sent a request to mitre.org, stating that there may be a request on the fly already &amp; got a quick answer with a CVE ID. 

This vulnerability is now known as CVE-2017-14604 : <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14604">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14604</a>

Hopefully, DWF will check around here before assigning anything.</pre>
</div><div class="bz_comment" id="c19">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c19">Comment 19</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-20 08:56:41 UTC
        </span>
</div>
<pre class="bz_comment_text">(In reply to Cedric Buissart from <a href="show_bug.cgi?id=777991#c18">comment #18</a>)
<span class="quote">&gt; 4 months would mean we would hit the anniversary of the discovery before
&gt; getting a CVE :)
&gt; I sent a request to mitre.org, stating that there may be a request on the
&gt; fly already &amp; got a quick answer with a CVE ID. 
&gt; 
&gt; This vulnerability is now known as CVE-2017-14604 :
&gt; <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14604">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-14604</a>
&gt; 
&gt; Hopefully, DWF will check around here before assigning anything.</span>

Reading the CVE, it points to Nautilus in GitHub. That is not the canonical source and could be removed at any point. Use git.gnome.org instead.</pre>
</div><div class="bz_comment" id="c20">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c20">Comment 20</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Donncha Ó Cearbhaill</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-09-20 11:08:31 UTC
        </span>
</div>
<pre class="bz_comment_text">Cedric, thank you for getting the CVE issued. That's much better than waiting for the anniversary :) 

I'm following up with Debian to try and get this issue resolved downstream.</pre>
</div><div class="bz_comment" id="c21">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c21">Comment 21</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 15:22:09 UTC
        </span>
</div>
<pre class="bz_comment_text">Hey, @Carlos Soriano: I just read the patch and can't help to wonder what you actually mean by "use file metadata". What does

+            nautilus_file_set_metadata (parameters-&gt;file, NAUTILUS_METADATA_KEY_DESKTOP_FILE_TRUSTED,
+                                        NULL,
+                                        "yes");

actually do? Does it somehow attach a trusted flag to file itself (via xattrs?)? Or does Nautilus keep a path-based whitelist somewhere? Because that would be dangerous...</pre>
</div><div class="bz_comment" id="c22">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c22">Comment 22</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 16:07:47 UTC
        </span>
</div>
<pre class="bz_comment_text">Ok, I tested this:

$ nautilus --version
GNOME nautilus 3.26.0
$ 

Let's see if the "trusted" flag is associated with the file itself or the path:

$ printf '[Desktop Entry]\nName=42\nExec=gnome-terminal\nType=Application' &gt; foo.desktop
$ ls -l
total 4
-rw-r--r-- 1 alexander alexander 60 Oct  8 17:57 foo.desktop
$ # nautilus shows one file "foo.desktop"
$ chmod +x foo.desktop 
$ ls -l
total 4
-rwxr-xr-x 1 alexander alexander 60 Oct  8 17:57 foo.desktop
$ # nautilus still shows one file "foo.desktop"
$ # use nautilus to start "foo.desktop" and mark it as trusted
$ # nautilus starts gnome-terminal and now displays one file "42"
$ ln foo.desktop bar.desktop
$ ls -li foo.desktop bar.desktop 
12218402 -rwxr-xr-x 2 alexander alexander 60 Oct  8 17:57 bar.desktop
12218402 -rwxr-xr-x 2 alexander alexander 60 Oct  8 17:57 foo.desktop
$ # nautilus shows two files, "42" and "bar.desktop"

It appears to be path-associated, since only "foo.desktop" is displayed as "42" even though "foo.desktop" and "bar.desktop" are the same file.

Let's try something:

$ rm --verbose foo.desktop bar.desktop 
removed 'foo.desktop'
removed 'bar.desktop'
$ printf '[Desktop Entry]\nName=42\nExec=gnome-terminal\nType=Application' &gt; foo.desktop
$ chmod +x foo.desktop 
$ # nautilus displays one file "42"
$ 

Wow, so removing the "trusted" file and then re-creating it in the same path bypasses this new "trusted" flag. All that's left is the executable bit which isn't enough as shown by the initial bug report.

TL;DR: User using nautilus for some time and sometimes "trusting" .desktop files will have an ever growing (is there a way to clear it?) whitelist of paths where the executable bit is again all that's needed for pwnage. Now, combine this with XDG_DOWNLOAD_DIR and this becomes a problem...</pre>
</div><div class="bz_comment" id="c23">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c23">Comment 23</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 16:10:17 UTC
        </span>
</div>
<pre class="bz_comment_text">Oh, and also this:

$ printf '[Desktop Entry]\nName=42' &gt; baz.desktop
$ ls -l
total 4
-rw-r--r-- 1 alexander alexander 23 Oct  8 18:08 baz.desktop
$ # nautilus displays one file "42"
$ 

So for .desktop files not containing an Exec= (or Type=Application) setting neither the executable bit nor the new "trusted flag" check seem to be active. Not yet sure if this is exploitable, but it sure seems fishy.</pre>
</div><div class="bz_comment" id="c24">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c24">Comment 24</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 16:27:13 UTC
        </span>
</div>
<pre class="bz_comment_text">Yup, can at least be used for tracking:

$ printf '[Desktop Entry]\nName=CV.pdf\nIcon=x-office-document\nType=Link\nURL=<a href="https://gnome.org">https://gnome.org</a>' &gt; baz.desktop
$ ls -l baz.desktop 
-rw-r--r-- 1 alexander alexander 82 Oct  8 18:20 baz.desktop
$ # nautilus shows a file "CV.pdf" which looks like a symbolic link
$ # clicking on "CV.pdf" opens a web browser showing gnome.org

So, reading the spec [0] for five minutes gave a privacy leak. oO

Why exactly does nautilus even parse .desktop at all? Isn't starting applications more of Gnome Shell's domain?

[0] <a href="https://developer.gnome.org/desktop-entry-spec/">https://developer.gnome.org/desktop-entry-spec/</a></pre>
</div><div class="bz_comment" id="c25">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c25">Comment 25</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 16:37:30 UTC
        </span>
</div>
<pre class="bz_comment_text">Hurray for "be liberal in what you accept from others" (i.e. just ignore the spec, we don't need no "Type="!)

$ cat baz.desktop 
[Desktop Entry]
Name=CV.pdf
Icon=x-office-document
URL=<a href="http://gnome.org">http://gnome.org</a>
$ ls -l baz.desktop 
-rw-r--r-- 1 alexander alexander 72 Oct  8 18:32 baz.desktop
$ # nautilus shows a file "CV.pdf" which looks like a regular PDF
$ # clicking on "CV.pdf" opens a web browser showing gnome.org

Nautilus 3.26. No x-bit or trusted flag. Visually indistinguishable from a regular PDF. Can open arbitrary URLs.</pre>
</div><div class="bz_comment" id="c26">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c26">Comment 26</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 17:38:31 UTC
        </span>
</div>
<pre class="bz_comment_text">Another vector to the same goal, abusing legacy compatibility [0]:

$ cat baz.desktop 
[Desktop Entry]
Name=CV.pdf
Icon=x-office-document
Type=URL
Exec=<a href="http://gnome.org">http://gnome.org</a>
$ ls -l baz.desktop 
-rw-r--r-- 1 alexander alexander 82 Oct  8 19:31 baz.desktop
$ # nautilus shows a file "CV.pdf" which looks like a regular PDF
$ # clicking on "CV.pdf" opens a web browser showing gnome.org
$ 

[0] <a href="https://github.com/GNOME/nautilus/blob/3.26.0/src/nautilus-link.c#L383">https://github.com/GNOME/nautilus/blob/3.26.0/src/nautilus-link.c#L383</a></pre>
</div><div class="bz_comment" id="c27">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c27">Comment 27</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-08 18:27:16 UTC
        </span>
</div>
<pre class="bz_comment_text">For the record, the "trusted metadata" gets stored to (after a frankly insane function call tour through Nautilus and GLib) to a file under ~/.local/share/gvfs-metadata, so removing this directory should reset all "trusted" markings. 

And yeah, it's definitely path based:

alexander@shepard:~/.local/share/gvfs-metadata$ hd root-8daa6d16.log 
00000000  da 1a 6a 6f 75 72 01 00  8d aa 6d 16 00 00 80 00  |..jour....m.....|
00000010  00 00 00 01 00 00 00 38  c0 78 97 05 00 00 00 00  |.......8.x......|
00000020  59 da 6b 86 00 2f 68 6f  6d 65 2f 77 6f 6d 2f 62  |Y.k../home/wom/b|
00000030  61 7a 2e 64 65 73 6b 74  6f 70 00 74 72 75 73 74  |az.desktop.trust|
00000040  65 64 00 79 65 73 00 00  00 00 00 38 00 00 00 00  |ed.yes.....8....|
00000050  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00008000

So, if you ever mark a launcher as trusted and then remove it, be sure to tell GVFS about it (does Nautilus at least do this?). Otherwise this specific launcher path has just gained a vulnerability for <a class="bz_bug_link bz_status_RESOLVED bz_closed" href="show_bug.cgi?id=777991" title="RESOLVED FIXED - Nautilus hides filename for .desktop files with execute permission">Bug 777991</a> / CVE-2017-14604. It's not hard to imagine an attack using this: Get the user to extract a good app in $XDG_DOWNLOAD_DIR and launch it, marking the launcher as trusted. (Much) later, get the user to extract a malicious tarball to the same directory. Boom.</pre>
</div><div class="bz_comment" id="c28">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c28">Comment 28</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-09 11:03:34 UTC
        </span>
</div>
<pre class="bz_comment_text">Yes, that's how it works.
Obviously there is an usability compromise. Otherwise I would just remove executable ability in the file manager, which is not something we have planned for now.</pre>
</div><div class="bz_comment" id="c29">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c29">Comment 29</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Alexander Kurtz</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-09 11:24:16 UTC
        </span>
</div>
<pre class="bz_comment_text">So all of this is "works-as-intended"? Even the link thing? Even though it enables fun like this?

$ cat poc.desktop 
[Desktop Entry]
Name=Emergency Contact.pdf
Icon=x-office-document
Type=URL
Exec=<a href="mailto:firedepartment@example.com">mailto:firedepartment@example.com</a>?subject=Fire&amp;body=Dear%20Sir%2FMadam%2C%0A%0AFire!%20Fire!%20Help%20me!%0A%0A123%20Carrendon%20Road.%0A%0ALooking%20forward%20to%20hearing%20from%20you.%0A%0AAll%20the%20best%2C%0A%0AMaurice%20Moss
$</pre>
</div><div class="bz_comment" id="c30">
<div class="bz_comment_head">
<span class="bz_comment_number">
<a href="show_bug.cgi?id=777991#c30">Comment 30</a>
</span>
<span class="bz_comment_user">
<span class="vcard"><span class="fn">Carlos Soriano</span>
</span>
</span>
<span class="bz_comment_user_images">
</span>
<span class="bz_comment_time">
          2017-10-09 12:29:39 UTC
        </span>
</div>
<pre class="bz_comment_text">That's how desktop files work, yes.</pre>
</div>
<script type="text/javascript">
  function traceparser_toggle_trace(link, trace_id) {
    var trace = document.getElementById('trace_' + trace_id);
    bz_toggleClass(trace, 'bz_default_hidden');
    if (link.innerHTML == '+') { link.innerHTML = '&mdash;'; }
    else { link.innerHTML = '+'; }
  }
</script>
</td>
<td>
</td>
</tr></table>
</div>
<hr/>
</form>
<hr/>

<br/>
</div>
<div id="footer">
<div class="intro"></div>
<ul id="useful-links">
<li id="links-actions"><ul class="links">
<li><a href="./">Home</a></li>
<li><span class="separator">| </span><span style="text-decoration:line-through"><a href="">New</a></span></li>
<li><span class="separator">| </span><a href="page.cgi?id=browse.html&amp;product=nautilus">Browse</a></li>
<li><span class="separator">| </span><a href="query.cgi">Search</a></li>
<li class="form">
<span class="separator">| </span>
<form action="buglist.cgi" method="get" onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
<input id="no_redirect_bottom" name="no_redirect" type="hidden" value="0"/>
<script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
<input class="txt" id="quicksearch_bottom" name="quicksearch" title="Quick Search" type="text" value=""/>
<input class="btn" id="find_bottom" type="submit" value="Search"/></form>
<a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>
<li><span class="separator">| </span><a href="page.cgi?id=reports.html">Reports</a></li>
<li>
<span class="separator">| </span>
<a href="http://www.bugzilla.org/docs/4.4/en/html/bug_page.html" target="_blank">Help</a>
</li>
<li id="mini_login_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=777991&amp;GoAheadAndLogIn=1" id="login_link_bottom" onclick="return show_mini_login_form('_bottom')">Log In</a>
<form action="show_bug.cgi?id=777991" class="mini_login bz_default_hidden" id="mini_login_bottom" method="POST" onsubmit="return check_mini_login_fields( '_bottom' );">
<input class="bz_login" id="Bugzilla_login_bottom" name="Bugzilla_login" onfocus="mini_login_on_focus('_bottom')" title="Login"/>
<input class="bz_password" id="Bugzilla_password_bottom" name="Bugzilla_password" title="Password" type="password"/>
<input class="bz_password bz_default_hidden bz_mini_login_help" id="Bugzilla_password_dummy_bottom" onfocus="mini_login_on_focus('_bottom')" title="Password" type="text" value="password"/>
<input checked="" class="bz_remember" id="Bugzilla_remember_bottom" name="Bugzilla_remember" type="checkbox" value="on"/>
<label for="Bugzilla_remember_bottom">Remember</label>
<input name="Bugzilla_login_token" type="hidden" value=""/>
<input id="log_in_bottom" name="GoAheadAndLogIn" type="submit" value="Log in"/>
<script type="text/javascript">
      mini_login_constants = {
          "login" : "login",
          "warning" : "You must set the login and password before logging in."
      };
      
      if (YAHOO.env.ua.gecko || YAHOO.env.ua.ie || YAHOO.env.ua.opera) {
          YAHOO.util.Event.onDOMReady(function() {
              init_mini_login_form('_bottom');
          });
      }
      else {
          YAHOO.util.Event.on(window, 'load', function () {
              window.setTimeout(function() {
                  init_mini_login_form('_bottom');
              }, 200);
          });
    }
    </script>
<a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
</form>
</li>
<li id="forgot_container_bottom">
<span class="separator">| </span>
<a href="show_bug.cgi?id=777991&amp;GoAheadAndLogIn=1#forgot" id="forgot_link_bottom" onclick="return show_forgot_form('_bottom')">Forgot Password</a>
<form action="token.cgi" class="mini_forgot bz_default_hidden" id="forgot_form_bottom" method="post">
<label for="login_bottom">Login:</label>
<input id="login_bottom" name="loginname" size="20" type="text"/>
<input id="forgot_button_bottom" type="submit" value="Reset Password"/>
<input name="a" type="hidden" value="reqpw"/>
<input id="token_bottom" name="token" type="hidden" value="1626093959-GMOUPlfY1aHgi-Rb3nxjvnjo_lqudRqImpLzb_7hjm8"/>
<a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
</form>
</li>
</ul>
</li>
</ul>
<div class="outro"></div>
</div>
</body>
</html>