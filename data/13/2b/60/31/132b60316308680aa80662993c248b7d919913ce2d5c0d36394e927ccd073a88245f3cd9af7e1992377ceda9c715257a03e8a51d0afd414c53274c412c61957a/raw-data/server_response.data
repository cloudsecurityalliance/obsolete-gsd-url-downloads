<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/keystone/+bug/1242597/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1242597 “[OSSA 2013-032] Keystone trust circumvention throu...” : Bugs : OpenStack Identity (keystone)</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1242597" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1242597/bug.atom" title="Bug 1242597 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="So I finally got around to investigating the scenario I mentioned in https://review.openstack.org/#/c/40444/, and unfortunately it seems that the ec2tokens API does indeed provide a way to circumvent the role delegation provided by trusts, and obtain all the roles of the trustor user, not just those explicitly delegated.

Steps to reproduce:
- Trustor creates a trust delegating a subset of roles
- Trustee gets a token scoped to that trust
- Trustee creates an ec2-keypair
- Trustee makes a req..." />
      <meta property="og:description" content="So I finally got around to investigating the scenario I mentioned in https://review.openstack.org/#/c/40444/, and unfortunately it seems that the ec2tokens API does indeed provide a way to circumvent the role delegation provided by trusts, and obtain all the roles of the trustor user, not just those explicitly delegated.

Steps to reproduce:
- Trustor creates a trust delegating a subset of roles
- Trustee gets a token scoped to that trust
- Trustee creates an ec2-keypair
- Trustee makes a req..." />
    

    
    
      <meta property="og:title" content="Bug #1242597 “[OSSA 2013-032] Keystone trust circumvention throu...” : Bugs : OpenStack Identity (keystone)" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1242597" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["api-ref", "caching", "configuration", "default-roles", "documentation", "federation", "fernet", "fix-requires-microversion", "hierarchical-multitenancy", "i18n", "jwt", "ldap", "limits", "logging", "low-hanging-fruit", "meeting-topic", "notifications", "ocata-backport-potential", "office-hours", "ops", "password", "pci", "performance", "pike-backport-potential", "pki", "policy", "python3", "queens-backport-potential", "rc-potential", "revoke", "rfe", "rocky-backport-potential", "security", "sql", "system-scope", "test-improvement", "trusts", "upgrades", "user-experience", "x509"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/keystone/+bug/1242597/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/keystone"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/359059841/OpenStack_Project_Keystone_mascot%20%281%29.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/keystone">OpenStack Identity (keystone)</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/keystone">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/keystone">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/keystone">Bugs</a></li>
      
      
    
    
      
      <li class="specifications"><a href="https://blueprints.launchpad.net/keystone">Blueprints</a></li>
      
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/keystone">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/keystone">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    [OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1242597 reported by
      <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy</a>
      <time title="2013-10-21 09:46:29 UTC" datetime="2013-10-21T09:46:29.457927+00:00">on 2013-10-21</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">280</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 2 people</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr class="highlight" id="tasksummary1487091">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/keystone/+bug/1242597/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1487091">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/keystone">OpenStack Identity (keystone)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/keystone/+bug/1242597/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/keystone/+bug/1242597/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1487091">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~shardy">Steven Hardy</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/keystone/+milestone/2014.1">OpenStack Identity (keystone) 2014.1 "icehouse"</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1487091">
     <td colspan="7"><form action="/keystone/+bug/1242597/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/keystone">OpenStack Identity (keystone)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2013-10-21 09:46:29 UTC" datetime="2013-10-21T09:46:29.457927+00:00">2013-10-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2013-10-21 13:34:45 UTC" datetime="2013-10-21T13:34:45.649366+00:00">2013-10-21</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2013-10-21 16:10:12 UTC" datetime="2013-10-21T16:10:12.128531+00:00">2013-10-21</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2013-12-11 13:38:23 UTC" datetime="2013-12-11T13:38:23.601854+00:00">2013-12-11</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2014-01-22 15:42:23 UTC" datetime="2014-01-22T15:42:23.955084+00:00">2014-01-22</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="keystone.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="keystone.target.option.package" name="keystone.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="keystone.target.distribution" name="keystone.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="keystone.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="keystone.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="keystone.target.package"
                         name="keystone.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;keystone.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('keystone.target.package');
              var select_menu = Y.DOM.byId('keystone.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-keystone-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a package", "show_remove_button": false, "selected_value": null, "step_title": "Search by name", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "DistributionPackage", "input_element": "keystone.target.package", "show_widget_id": "show-widget-keystone-target-package", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-keystone-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="keystone.target.option.product" name="keystone.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="keystone" id="keystone.target.product"
                         name="keystone.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;keystone.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('keystone.target.product');
              var select_menu = Y.DOM.byId('keystone.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-keystone-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a project", "show_remove_button": false, "selected_value": "keystone", "step_title": "Search", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "Product", "input_element": "keystone.target.product", "show_widget_id": "show-widget-keystone-target-product", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-keystone-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="keystone.status" name="keystone.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="keystone.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          OpenStack Identity (keystone) 2014.1
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="keystone.assignee.assign_to_me" name="keystone.assignee.option" value="keystone.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="keystone.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="keystone.assignee.assigned_to" name="keystone.assignee.option" value="keystone.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="keystone.assignee.assigned_to">
              Steven Hardy (shardy)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="keystone.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="keystone.comment_on_change" name="keystone.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1570596">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/keystone/grizzly/+bug/1242597/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/keystone/grizzly">Grizzly</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/keystone/grizzly/+bug/1242597/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/keystone/grizzly/+bug/1242597/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1570596">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~dolph">Dolph Mathews</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/keystone/+milestone/2013.1.5">OpenStack Identity (keystone) 2013.1.5</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1570596">
     <td colspan="7"><form action="/keystone/grizzly/+bug/1242597/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/keystone/grizzly">OpenStack Identity (keystone) grizzly</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~apevec" class="sprite person">Alan Pevec</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2014-03-20 20:05:16 UTC" datetime="2014-03-20T20:05:16.960032+00:00">2014-03-20</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2014-03-20 20:05:51 UTC" datetime="2014-03-20T20:05:51.346004+00:00">2014-03-20</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2014-03-20 20:07:36 UTC" datetime="2014-03-20T20:07:36.082056+00:00">2014-03-20</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2014-03-20 20:05:51 UTC" datetime="2014-03-20T20:05:51.346004+00:00">2014-03-20</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2014-03-20 22:12:18 UTC" datetime="2014-03-20T22:12:18.344541+00:00">2014-03-20</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone_grizzly.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone_grizzly.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone_grizzly.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="keystone_grizzly.status" name="keystone_grizzly.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="keystone_grizzly.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          OpenStack Identity (keystone) 2013.1.5
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone_grizzly.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="keystone_grizzly.assignee.assign_to_me" name="keystone_grizzly.assignee.option" value="keystone_grizzly.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="keystone_grizzly.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="keystone_grizzly.assignee.assigned_to" name="keystone_grizzly.assignee.option" value="keystone_grizzly.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="keystone_grizzly.assignee.assigned_to">
              Dolph Mathews (dolph)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="keystone_grizzly.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="keystone_grizzly.comment_on_change" name="keystone_grizzly.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1514051">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/keystone/havana/+bug/1242597/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/keystone/havana">Havana</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/keystone/havana/+bug/1242597/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/keystone/havana/+bug/1242597/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceCRITICAL">Critical</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1514051">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~shardy">Steven Hardy</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href="https://launchpad.net/keystone/+milestone/2013.2.1">OpenStack Identity (keystone) 2013.2.1</a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1514051">
     <td colspan="7"><form action="/keystone/havana/+bug/1242597/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/keystone/havana">OpenStack Identity (keystone) havana</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2013-12-11 13:59:22 UTC" datetime="2013-12-11T13:59:22.836734+00:00">2013-12-11</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2013-12-11 14:00:31 UTC" datetime="2013-12-11T14:00:31.123371+00:00">2013-12-11</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2013-12-11 14:00:31 UTC" datetime="2013-12-11T14:00:31.112998+00:00">2013-12-11</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2013-12-11 14:00:31 UTC" datetime="2013-12-11T14:00:31.123371+00:00">2013-12-11</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2013-12-16 22:45:32 UTC" datetime="2013-12-16T22:45:32.739084+00:00">2013-12-16</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone_havana.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone_havana.importance">Importance</label>
        </td>
        <td>
          <label style="font-weight: bold" for="keystone_havana.milestone">Milestone</label>
        </td>
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="keystone_havana.status" name="keystone_havana.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="keystone_havana.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceCRITICAL">Critical</span>
        </td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          OpenStack Identity (keystone) 2013.2.1
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="keystone_havana.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="keystone_havana.assignee.assign_to_me" name="keystone_havana.assignee.option" value="keystone_havana.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="keystone_havana.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="keystone_havana.assignee.assigned_to" name="keystone_havana.assignee.option" value="keystone_havana.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="keystone_havana.assignee.assigned_to">
              Steven Hardy (shardy)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="keystone_havana.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="keystone_havana.comment_on_change" name="keystone_havana.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary1487206">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ossa/+bug/1242597/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary1487206">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ossa">OpenStack Security Advisory</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ossa/+bug/1242597/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ossa/+bug/1242597/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceHIGH">High</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary1487206">
          <span class="yui3-activator-data-box">
            <a class="sprite person" href="https://launchpad.net/~fungi">Jeremy Stanley</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task1487206">
     <td colspan="7"><form action="/ossa/+bug/1242597/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ossa">OpenStack Security Advisory</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2013-10-21 13:33:36 UTC" datetime="2013-10-21T13:33:36.167637+00:00">2013-10-21</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2013-10-21 13:34:58 UTC" datetime="2013-10-21T13:34:58.472730+00:00">2013-10-21</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2013-11-14 10:43:20 UTC" datetime="2013-11-14T10:43:20.349128+00:00">2013-11-14</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2013-11-25 16:02:56 UTC" datetime="2013-11-25T16:02:56.101173+00:00">2013-11-25</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2013-12-14 18:36:16 UTC" datetime="2013-12-14T18:36:16.919981+00:00">2013-12-14</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ossa.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="ossa.target.option.package" name="ossa.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ossa.target.distribution" name="ossa.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ossa.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ossa.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ossa.target.package"
                         name="ossa.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.package');
              var select_menu = Y.DOM.byId('ossa.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a package", "show_remove_button": false, "selected_value": null, "step_title": "Search by name", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "DistributionPackage", "input_element": "ossa.target.package", "show_widget_id": "show-widget-ossa-target-package", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ossa-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ossa.target.option.product" name="ossa.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="ossa" id="ossa.target.product"
                         name="ossa.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ossa.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ossa.target.product');
              var select_menu = Y.DOM.byId('ossa.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ossa-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"remove_team_text": "Remove team", "header": "Select a project", "show_remove_button": false, "selected_value": "ossa", "step_title": "Search", "show_assign_me_button": false, "vocabulary_filters": [], "vocabulary_name": "Product", "input_element": "ossa.target.product", "show_widget_id": "show-widget-ossa-target-product", "assign_me_text": "Pick me", "show_create_team": false, "remove_person_text": "Remove person", "picker_type": "default", "extra_no_results_message": null, "selected_value_metadata": null};
        var show_widget_id = 'show-widget-ossa-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ossa.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ossa.status" name="ossa.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ossa.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceHIGH">High</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ossa.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ossa.assignee.assign_to_me" name="ossa.assignee.option" value="ossa.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ossa.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="ossa.assignee.assigned_to" name="ossa.assignee.option" value="ossa.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="ossa.assignee.assigned_to">
              Jeremy Stanley (fungi)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ossa.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ossa.comment_on_change" name="ossa.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/keystone/+bug/1242597/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>So I finally got around to investigating the scenario I mentioned in <a rel="nofollow" href="https://review.openstack.org/#/c/40444/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />40444/</a>, and unfortunately it seems that the ec2tokens API does indeed provide a way to circumvent the role delegation provided by trusts, and obtain all the roles of the trustor user, not just those explicitly delegated.</p>
<p>Steps to reproduce:<br />
- Trustor creates a trust delegating a subset of roles<br />
- Trustee gets a token scoped to that trust<br />
- Trustee creates an ec2-keypair<br />
- Trustee makes a request to the ec2tokens API, to validate a signature created with the keypair<br />
- ec2tokens API returns a new token, which is not scoped to the trust and enables access to all the trustor&#x27;s roles.</p>
<p>I can provide some test code which demonstrates the issue.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            
          </span>
          <span id="tag-list">
          </span>
          <a href="+edit" title="Add tags" id="tags-trigger" class="sprite add">Add tags</a>
          
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2013-4477" title="The LDAP backend in OpenStack Identit...">2013-4477</a>
            </li>
            <li class="sprite cve">
              <a href="/bugs/cve/2013-6391" title="The ec2tokens API in OpenStack Identi...">2013-6391</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-21T09:51:02.674853+00:00" title="2013-10-21 09:51:02 UTC">on 2013-10-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3885983/+files/trust_ec2_test.py">Reproducer script</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1242597/+attachment/3885983">Edit</a>
        (5.2 KiB,
        text/x-python)
      </li>
    </ul>

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2013-10-21 13:34:45 UTC" datetime="2013-10-21T13:34:45.024529+00:00">on 2013-10-21</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; Critical
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; High
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Confirmed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-21T16:04:14.202288+00:00" title="2013-10-21 16:04:14 UTC">on 2013-10-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>So, looking into this a bit more, it seems that we need to implement something similar to <a rel="nofollow" href="https://review.openstack.org/#/c/40444/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />40444/</a> to fix this.</p>
<p>Currently the token in the ec2 controller is generated with the user_id and no knowledge of trusts.  There are some issues with that patch atm though, looks like it still needs significant work.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">So, looking into this a bit more, it seems that we need to implement something similar to https://review.openstack.org/#/c/40444/ to fix this.  

Currently the token in the ec2 controller is generated with the user_id and no knowledge of trusts.  There are some issues with that patch atm though, looks like it still needs significant work.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
    
    <time title="2013-10-21 16:10:11 UTC" datetime="2013-10-21T16:10:11.905415+00:00">on 2013-10-21</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Steven Hardy (shardy)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-21T19:06:56.563259+00:00" title="2013-10-21 19:06:56 UTC">on 2013-10-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3886582/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API.patch">Proposed fix</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1242597/+attachment/3886582">Edit</a>
        (3.0 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Proposed fix attached - this currently has no tests, as there is no coverage at all of the Ec2Token controller, can I just propose adding the coverage via the normal gerrit process?</p>
<p>Also, this renders <a rel="nofollow" href="https://review.openstack.org/#/c/40444/11">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />40444/11</a> (and the related blueprint) obsolete, so we may want to warn the submitter of that patch not to bother doing any rework and resubmitting?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Proposed fix attached - this currently has no tests, as there is no coverage at all of the Ec2Token controller, can I just propose adding the coverage via the normal gerrit process?

Also, this renders https://review.openstack.org/#/c/40444/11 (and the related blueprint) obsolete, so we may want to warn the submitter of that patch not to bother doing any rework and resubmitting?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/4" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-21T19:16:07.820644+00:00" title="2013-10-21 19:16:07 UTC">on 2013-10-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/4"> #4</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Oops, my bad, I didn&#x27;t spot test_keystonecl<wbr />ient_sql.<wbr />py - I&#x27;ll add some tests and propose another patch</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Oops, my bad, I didn't spot test_keystoneclient_sql.py - I'll add some tests and propose another patch</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-22T18:19:52.179886+00:00" title="2013-10-22 18:19:52 UTC">on 2013-10-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Update patch, one minor fix and added a test.</p>
<p>There are some limitations in what we can test atm, because the v2 token trust-scoping happens at the controller level (on an existing token) rather than when issuing it.  This doesn&#x27;t seem to enable a representative response to be generated (in terms of the token contents) due to the way the fixtures/mocking works in these tests.</p>
<p>I think probably what needs to happen (under a different bug) is the trust-scoping code needs to move from the controller to where the token is generated behind the identity_api? (comments welcome on this..)</p>
<p>i.e this code is never hit in these tests, but it is when you make a real request:<br />
<a rel="nofollow" href="https://github.com/openstack/keystone/blob/master/keystone/token/controllers.py#L130">https:/<wbr />/github.<wbr />com/openstack/<wbr />keystone/<wbr />blob/master/<wbr />keystone/<wbr />token/controlle<wbr />rs.py#L130</a></p>
<p>So I guess that really needs to be happening here instead?<br />
<a rel="nofollow" href="https://github.com/openstack/keystone/blob/master/keystone/token/providers/uuid.py#L359">https:/<wbr />/github.<wbr />com/openstack/<wbr />keystone/<wbr />blob/master/<wbr />keystone/<wbr />token/providers<wbr />/uuid.py#<wbr />L359</a></p>
<p>Anyway, even with the somewhat limited test, this patch should fix the vulnerability and the test does provide coverage of the new code.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Update patch, one minor fix and added a test.

There are some limitations in what we can test atm, because the v2 token trust-scoping happens at the controller level (on an existing token) rather than when issuing it.  This doesn't seem to enable a representative response to be generated (in terms of the token contents) due to the way the fixtures/mocking works in these tests.

I think probably what needs to happen (under a different bug) is the trust-scoping code needs to move from the controller to where the token is generated behind the identity_api? (comments welcome on this..)

i.e this code is never hit in these tests, but it is when you make a real request:
https://github.com/openstack/keystone/blob/master/keystone/token/controllers.py#L130

So I guess that really needs to be happening here instead?
https://github.com/openstack/keystone/blob/master/keystone/token/providers/uuid.py#L359

Anyway, even with the somewhat limited test, this patch should fix the vulnerability and the test does provide coverage of the new code.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-22T18:20:21.659396+00:00" title="2013-10-22 18:20:21 UTC">on 2013-10-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3887645/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API.patch">Proposed fix, second draft</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1242597/+attachment/3887645">Edit</a>
        (6.8 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-22T18:23:30.355964+00:00" title="2013-10-22 18:23:30 UTC">on 2013-10-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Note, I still need to test this with a MD5 hashed v3 token as I&#x27;ve only tested with pure v2 interfaces so far (other than the v3 call to create the trust).  I&#x27;d like to ensure that creds_ref still returns the trust_id correctly in that case.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Note, I still need to test this with a MD5 hashed v3 token as I've only tested with pure v2 interfaces so far (other than the v3 call to create the trust).  I'd like to ensure that creds_ref still returns the trust_id correctly in that case.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-24T14:41:29.095901+00:00" title="2013-10-24 14:41:29 UTC">on 2013-10-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Keystone folks, please review proposed patch. Feel free to subscribe more appropriate keystone-core reviewers.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Keystone folks, please review proposed patch. Feel free to subscribe more appropriate keystone-core reviewers.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-28T11:47:29.798656+00:00" title="2013-10-28 11:47:29 UTC">on 2013-10-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I tested with MD5 hashed v3 tokens, and all works OK, except for a client <a href="/bugs/1244675" class="bug-link">bug #1244675</a> which I&#x27;ve reported and have proposed a fix for.  The API level behaviour is OK though, so I think this patch is OK to be proposed for merging, unless keystone folks have any review feedback (I&#x27;ve not had any comments at all so far)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I tested with MD5 hashed v3 tokens, and all works OK, except for a client bug #1244675 which I've reported and have proposed a fix for.  The API level behaviour is OK though, so I think this patch is OK to be proposed for merging, unless keystone folks have any review feedback (I've not had any comments at all so far)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~dolph" class="sprite person">Dolph Mathews (dolph)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-28T13:26:20.054327+00:00" title="2013-10-28 13:26:20 UTC">on 2013-10-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Adding Matthieu Huin to help review, who proposed a related patch in <a rel="nofollow" href="https://review.openstack.org/#/c/40444/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />40444/</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Adding Matthieu Huin to help review, who proposed a related patch in https://review.openstack.org/#/c/40444/</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mhu-s" class="sprite person">Matthieu Huin (mhu-s)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-28T15:20:37.815103+00:00" title="2013-10-28 15:20:37 UTC">on 2013-10-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Your patch looks good to me, Steven.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Your patch looks good to me, Steven.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ayoung" class="sprite person">Adam Young (ayoung)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-28T16:27:45.356279+00:00" title="2013-10-28 16:27:45 UTC">on 2013-10-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>TO explain the patch:  the metadata on the frist token will havea trust_id on it.  When creating the EC2 Keyspair, this needs to be carried over.  That is done by earlier code.  What was missing is the call that appends the trust_id on to the token created from the ec2 keypair.  That is what is done at line 106.  From this point forward, the trust_id will be maintained.</p>
<p>In the future, we probably want to change from &quot;if we can&#x27;t find the trust id, assume that there is none.&quot;  To an approach of &quot;we need to see an avid disavowal of a trust_id.&quot;  Something like metadata.trust_id = None.  We need to ensure that we carry over proof of non-delegation from mechanism to mechanism or we are going to continue to have these forms of errors.</p>
<p>The patch as written looks good.</p>
<p>Mattieu, does you patch take any security issues into account that this one does not?  It seems to be a larger patch, but I can&#x27;t tell if that means it is covering a wider array of issues.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">TO explain the patch:  the metadata on the frist token will havea trust_id on it.  When creating the EC2 Keyspair, this needs to be carried over.  That is done by earlier code.  What was missing is the call that appends the trust_id on to the token created from the ec2 keypair.  That is what is done at line 106.  From this point forward, the trust_id will be maintained.

In the future, we probably want to change from "if we can't find the trust id, assume that there is none."  To an approach of "we need to see an avid disavowal of a trust_id."  Something like metadata.trust_id = None.  We need to ensure that we carry over proof of non-delegation from mechanism to mechanism or we are going to continue to have these forms of errors.

The patch as written looks good.    


Mattieu, does you patch take any security issues into account that this one does not?  It seems to be a larger patch, but I can't tell if that means it is covering a wider array of issues.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/13" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mhu-s" class="sprite person">Matthieu Huin (mhu-s)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-28T17:05:58.274329+00:00" title="2013-10-28 17:05:58 UTC">on 2013-10-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/13"> #13</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ayoung: as far as I can tell this patch is more appropriate than mine regarding the problem at hand. What I was doing was serving the same trust token (ie the one used to create the ec2 creds) whenever there was an ec2 authentication. This wasn&#x27;t a good idea, due to the short lifespan of tokens.<br />
I also added a reference to the trustee id when creating the credentials, so that it&#x27;d be possible to differenciate impersonation.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ayoung: as far as I can tell this patch is more appropriate than mine regarding the problem at hand. What I was doing was serving the same trust token (ie the one used to create the ec2 creds) whenever there was an ec2 authentication. This wasn't a good idea, due to the short lifespan of tokens.
I also added a reference to the trustee id when creating the credentials, so that it'd be possible to differenciate impersonation.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/14" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-10-31T18:05:37.610779+00:00" title="2013-10-31 18:05:37 UTC">on 2013-10-31</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/14"> #14</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The patchset seems to be a sane approach to solving the concern.  I&#x27;m still making sure I&#x27;m not seeing any gaps in it, but the hole seems to be covered with the patchset in #6</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The patchset seems to be a sane approach to solving the concern.  I'm still making sure I'm not seeing any gaps in it, but the hole seems to be covered with the patchset in #6</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/15" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-14T10:43:19.684076+00:00" title="2013-11-14 10:43:19 UTC">on 2013-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/15"> #15</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@keystone-core: still need a formal second +2 on this patch... so far only Adam clearly expressed it.<br />
I&#x27;ll be working on an impact description.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@keystone-core: still need a formal second +2 on this patch... so far only Adam clearly expressed it.
I'll be working on an impact description.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Thierry Carrez (ttx)
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/16" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-14T15:04:54.146356+00:00" title="2013-11-14 15:04:54 UTC">on 2013-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/16"> #16</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Proposed impact description, please doublecheck that I got it right (included affected versions):</p>
<p>-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-<br />
Title: Keystone trust circumvention through EC2-style tokens<br />
Reporter: Steven Hardy (Red Hat)<br />
Products: Keystone<br />
Affects: Grizzly and later</p>
<p>Description:<br />
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 tokens from a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevtaing privileges to all of the trustor&#x27;s roles. Only Keystone setups enabling EC2-style authentication are affected.<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />---</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Proposed impact description, please doublecheck that I got it right (included affected versions):

-------------------------------------------
Title: Keystone trust circumvention through EC2-style tokens
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Affects: Grizzly and later

Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 tokens from a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevtaing privileges to all of the trustor's roles. Only Keystone setups enabling EC2-style authentication are affected.
---------------------------------------------</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; Triaged
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/17" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-14T15:05:45.034409+00:00" title="2013-11-14 15:05:45 UTC">on 2013-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/17"> #17</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>elevtaing -&gt; elevating</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">elevtaing -&gt; elevating</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/18" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-14T15:09:32.691472+00:00" title="2013-11-14 15:09:32 UTC">on 2013-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/18"> #18</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;d say &quot;By generating ec2 credentials using a trust-scoped token&quot;</p>
<p>Also typo s/elevtaing/<wbr />elevating</p>
<p>Otherwise lgtm</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'd say "By generating ec2 credentials using a trust-scoped token"

Also typo s/elevtaing/elevating

Otherwise lgtm</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/19" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-14T15:58:14.677560+00:00" title="2013-11-14 15:58:14 UTC">on 2013-11-14</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/19"> #19</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Impact description looks good to me aside from the recommendations above.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Impact description looks good to me aside from the recommendations above.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/20" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-15T10:48:32.260245+00:00" title="2013-11-15 10:48:32 UTC">on 2013-11-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/20"> #20</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>New version including recommendations:</p>
<p>-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-<br />
Title: Keystone trust circumvention through EC2-style tokens<br />
Reporter: Steven Hardy (Red Hat)<br />
Products: Keystone<br />
Affects: Grizzly and later</p>
<p>Description:<br />
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 credentials using a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevating privileges to all of the trustor&#x27;s roles. Only Keystone setups enabling EC2-style authentication are affected.<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />---</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">New version including recommendations:

-------------------------------------------
Title: Keystone trust circumvention through EC2-style tokens
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Affects: Grizzly and later

Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 credentials using a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevating privileges to all of the trustor's roles. Only Keystone setups enabling EC2-style authentication are affected.
---------------------------------------------</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/21" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-15T16:02:39.703216+00:00" title="2013-11-15 16:02:39 UTC">on 2013-11-15</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/21"> #21</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Thierry&#x27;s updated impact description in comment #20 looks good to me.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Thierry's updated impact description in comment #20 looks good to me.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/22" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-19T21:25:11.080569+00:00" title="2013-11-19 21:25:11 UTC">on 2013-11-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/22"> #22</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The impact description looks good to me (#20).</p>
<p>This patchset only seems to apply (#6) to stable/havana.  For use in stable/havana +2 for me.</p>
<p>We will need slightly different patchsets for grizzly and master as there was enough shuffling in havana to move code around fairly significantly.  Master has now seen some changes that eliminate the identity_api -&gt; assignment_api proxy that this patchset relies on.</p>
<p>I&#x27;ll work on posting the &quot;fixed&quot; patchsets for grizzly and master today to this thread.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The impact description looks good to me (#20).

This patchset only seems to apply (#6) to stable/havana.  For use in stable/havana +2 for me.

We will need slightly different patchsets for grizzly and master as there was enough shuffling in havana to move code around fairly significantly.  Master has now seen some changes that eliminate the identity_api -&gt; assignment_api proxy that this patchset relies on.

I'll work on posting the "fixed" patchsets for grizzly and master today to this thread.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/23" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-19T21:46:19.396711+00:00" title="2013-11-19 21:46:19 UTC">on 2013-11-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/23"> #23</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3912878/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-MASTER.patch">0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-MASTER.patch</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1242597/+attachment/3912878">Edit</a>
        (6.8 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Patch Rebased for Master</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Patch Rebased for Master</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/24" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-19T23:11:11.957000+00:00" title="2013-11-19 23:11:11 UTC">on 2013-11-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/24"> #24</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>For Grizzly, there is no good way to correlate (as far as I can tell) the Trust to the EC2 Credential.  EC2 Credential was refactored in Havana to have a lot more information available to it (generic credentials backend that is not limited to the very limited EC2 data set).</p>
<p>The easiest solution is to either<br />
1: Disable EC2 credentials for trust scoped tokens<br />
2: State that it is recommended that trusts and EC2 contrib not be enabled at the same time.</p>
<p>I am not sure what the alternatives for getting more data into the EC2 credential would be in the Grizzly code base.  It might be possible to add a migration to grizzly that encompasses the new data and the first migration of Havana for the DB.  I think that a new migration is a sub-optimal choice.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">For Grizzly, there is no good way to correlate (as far as I can tell) the Trust to the EC2 Credential.  EC2 Credential was refactored in Havana to have a lot more information available to it (generic credentials backend that is not limited to the very limited EC2 data set).

The easiest solution is to either
1: Disable EC2 credentials for trust scoped tokens
2: State that it is recommended that trusts and EC2 contrib not be enabled at the same time.

I am not sure what the alternatives for getting more data into the EC2 credential would be in the Grizzly code base.  It might be possible to add a migration to grizzly that encompasses the new data and the first migration of Havana for the DB.  I think that a new migration is a sub-optimal choice. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/25" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-20T10:09:56.693193+00:00" title="2013-11-20 10:09:56 UTC">on 2013-11-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/25"> #25</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Morgan Fainberg - my vote is for (1), since there may be users of both trusts and ec2tokens on grizzly (who won&#x27;t want this hole to be exploitable), but they probably don&#x27;t care about ec2 credentials derived from a trust (well they can&#x27;t because it doesn&#x27;t currently work..)</p>
<p>AFAIK Heat is the only thing which wants to make use of ec2 credentials derived from a trust ID, which will be possible after this is fixed, and we only care about that functionality from Havana onwards, so (1) wfm and shouldn&#x27;t impact existing users (whereas the second option will, potentially)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Morgan Fainberg - my vote is for (1), since there may be users of both trusts and ec2tokens on grizzly (who won't want this hole to be exploitable), but they probably don't care about ec2 credentials derived from a trust (well they can't because it doesn't currently work..)

AFAIK Heat is the only thing which wants to make use of ec2 credentials derived from a trust ID, which will be possible after this is fixed, and we only care about that functionality from Havana onwards, so (1) wfm and shouldn't impact existing users (whereas the second option will, potentially)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/26" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-20T10:32:30.325787+00:00" title="2013-11-20 10:32:30 UTC">on 2013-11-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/26"> #26</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Note, I&#x27;m aware of <a rel="nofollow" href="https://blueprints.launchpad.net/keystone/+spec/ec2-keypairs-from-tokens">https:/<wbr />/blueprints.<wbr />launchpad.<wbr />net/keystone/<wbr />+spec/ec2-<wbr />keypairs-<wbr />from-tokens</a> which Matthieu has been working on, but since that functionality doesn&#x27;t exist yet, I&#x27;m assuming potential users can&#x27;t care about it in Grizzly.  Heat on the other hand might make use of this to fix <a href="/bugs/1089261" class="bug-link">bug #1089261</a>, which could be a candidate for backporting to Havana.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Note, I'm aware of https://blueprints.launchpad.net/keystone/+spec/ec2-keypairs-from-tokens which Matthieu has been working on, but since that functionality doesn't exist yet, I'm assuming potential users can't care about it in Grizzly.  Heat on the other hand might make use of this to fix bug #1089261, which could be a candidate for backporting to Havana.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/27" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-20T16:04:44.070928+00:00" title="2013-11-20 16:04:44 UTC">on 2013-11-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/27"> #27</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Morgan: go for (1)</p>
<p>I should probably add a grizzly-specific note explaining that we took this radical action in the patch.<br />
Something like &quot;Note: the patch for this vulnerability in Grizzly disables the ability to derive ec2 credentials from a trust, as there is no clean way in Grizzly to properly correlate the two.&quot; -- Feel free to suggest better wording to add to the description.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Morgan: go for (1)

I should probably add a grizzly-specific note explaining that we took this radical action in the patch.
Something like "Note: the patch for this vulnerability in Grizzly disables the ability to derive ec2 credentials from a trust, as there is no clean way in Grizzly to properly correlate the two." -- Feel free to suggest better wording to add to the description.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/28" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-20T21:15:13.147752+00:00" title="2013-11-20 21:15:13 UTC">on 2013-11-20</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/28"> #28</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>@Thierry,</p>
<p>Sounds good. I&#x27;ll get going on that change for grizzly.  Hopefully have the patchset in order today.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">@Thierry,

Sounds good. I'll get going on that change for grizzly.  Hopefully have the patchset in order today.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/29" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-21T21:18:36.617559+00:00" title="2013-11-21 21:18:36 UTC">on 2013-11-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/29"> #29</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3914454/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-grizzly.patch">0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-grizzly.patch</a>
        <a class="sprite edit action-icon" href="/keystone/+bug/1242597/+attachment/3914454">Edit</a>
        (2.9 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Ok a couple bits of added information.</p>
<p>Grizzly is not affected by this bug to an issue with how impersonation is checked for.  As seen here: <a rel="nofollow" href="http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/controllers.py?h=stable/grizzly#n204">http://<wbr />git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />tree/keystone/<wbr />token/controlle<wbr />rs.py?h=<wbr />stable/<wbr />grizzly#<wbr />n204</a><br />
we check for the string &quot;True&quot; not the singleton True.  This means that impersonation will never work within grizzly and mitigates this problem.  This issue was fixed in Havana but never backported.</p>
<p>I have not finalized testing in this grizzly patchset, I will work on finalizing tests once I am back at home this evening.  This fix can be validated by using Steven Hardy&#x27;s script from #1.  I have confirmed this re-enables Impersonation Trusts and fixes the security flaw.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Ok a couple bits of added information.

Grizzly is not affected by this bug to an issue with how impersonation is checked for.  As seen here: http://git.openstack.org/cgit/openstack/keystone/tree/keystone/token/controllers.py?h=stable/grizzly#n204
we check for the string "True" not the singleton True.  This means that impersonation will never work within grizzly and mitigates this problem.  This issue was fixed in Havana but never backported.

I have not finalized testing in this grizzly patchset, I will work on finalizing tests once I am back at home this evening.  This fix can be validated by using Steven Hardy's script from #1.  I have confirmed this re-enables Impersonation Trusts and fixes the security flaw.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/30" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-21T21:19:29.499510+00:00" title="2013-11-21 21:19:29 UTC">on 2013-11-21</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/30"> #30</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>In theory the patchset in #29 can go through public gerrit after the Havana / master patchset go through if desired.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">In theory the patchset in #29 can go through public gerrit after the Havana / master patchset go through if desired.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/31" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-22T15:48:40.622978+00:00" title="2013-11-22 15:48:40 UTC">on 2013-11-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/31"> #31</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>OK, amending description based on that info, please reconfirm:</p>
<p>-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-<br />
Title: Keystone trust circumvention through EC2-style tokens<br />
Reporter: Steven Hardy (Red Hat)<br />
Products: Keystone<br />
Affects: Havana and later</p>
<p>Description:<br />
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 credentials using a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevating privileges to all of the trustor&#x27;s roles. Only Keystone setups enabling EC2-style authentication are affected.<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />---</p>
<p>(Yes, we can push the grizzly fix publicly once this is opened)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">OK, amending description based on that info, please reconfirm:

-------------------------------------------
Title: Keystone trust circumvention through EC2-style tokens
Reporter: Steven Hardy (Red Hat)
Products: Keystone
Affects: Havana and later

Description:
Steven Hardy from Red Hat reported a vulnerability in Keystone trusts when used in conjunction with the ec2tokens API. By generating EC2 credentials using a trust-scoped token, a trustee may retrieve a token not scoped to the trust, therefore elevating privileges to all of the trustor's roles. Only Keystone setups enabling EC2-style authentication are affected.
---------------------------------------------

(Yes, we can push the grizzly fix publicly once this is opened)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/32" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-22T19:27:59.899983+00:00" title="2013-11-22 19:27:59 UTC">on 2013-11-22</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/32"> #32</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I am good with the revised message, +2</p>
<p>I am also happy to push the grizzly &quot;fix&quot; publicly afterwards.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I am good with the revised message, +2

I am also happy to push the grizzly "fix" publicly afterwards.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/33" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-25T16:02:54.977982+00:00" title="2013-11-25 16:02:54 UTC">on 2013-11-25</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/33"> #33</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>CVE requested</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">CVE requested</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2013-11-26 10:19:20 UTC" datetime="2013-11-26T10:19:20.771853+00:00">on 2013-11-26</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
          ec2tokens API doesn&#x27;t handle trust-scoped tokens correctly<br />+ (CVE-2013-6391)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/34" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-28T18:37:12.708426+00:00" title="2013-11-28 18:37:12 UTC">on 2013-11-28</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/34">
                <strong>Re: ec2tokens API doesn't handle trust-scoped tokens correctly (CVE-2013-6391)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/34"> #34</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>We should block <a rel="nofollow" href="https://review.openstack.org/#/c/51973/2">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />51973/2</a> until after we get the &quot;fix&quot; into stable/grizzly.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">We should block https://review.openstack.org/#/c/51973/2 until after we get the "fix" into stable/grizzly.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/35" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mdrnstm" class="sprite person">Morgan Fainberg (mdrnstm)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-11-28T18:37:43.718866+00:00" title="2013-11-28 18:37:43 UTC">on 2013-11-28</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/35"> #35</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Re: comment on #34, this would open grizzly to the exploit here.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Re: comment on #34, this would open grizzly to the exploit here.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/36" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-04T10:02:14.716366+00:00" title="2013-12-04 10:02:14 UTC">on 2013-12-04</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/36"> #36</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Can anyone provide a status update on this - will the fix be landing in Icehouse-1?</p>
<p>The heat instance-users work (related to <a href="/bugs/1089261" class="bug-link">bug #1089261</a>) has been blocked since this was reported, so I&#x27;m really hoping we can get the fix in soon.. :)</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Can anyone provide a status update on this - will the fix be landing in Icehouse-1?

The heat instance-users work (related to bug #1089261) has been blocked since this was reported, so I'm really hoping we can get the fix in soon.. :)</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2013-12-06 15:47:32 UTC" datetime="2013-12-06T15:47:32.056188+00:00">on 2013-12-06</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        Thierry Carrez (ttx) &#8594; Jeremy Stanley (fungi)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2013-12-06 16:44:09 UTC" datetime="2013-12-06T16:44:09.483236+00:00">on 2013-12-06</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Committed
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/37" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-06T21:06:45.341037+00:00" title="2013-12-06 21:06:45 UTC">on 2013-12-06</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/37"> #37</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Scheduled advisory publication date is Wednesday, December 11, 2013 at 1500UTC (so as to fall before the 2013.2.1 point release). Patches will be pushed to review.<wbr />openstack.<wbr />org for last-minute approval shortly prior to that time.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Scheduled advisory publication date is Wednesday, December 11, 2013 at 1500UTC (so as to fall before the 2013.2.1 point release). Patches will be pushed to review.openstack.org for last-minute approval shortly prior to that time.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2013-12-11 13:36:43 UTC" datetime="2013-12-11T13:36:43.728990+00:00">on 2013-12-11</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/38" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-11T13:38:25.337557+00:00" title="2013-12-11 13:38:25 UTC">on 2013-12-11</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/38">
                <strong>Fix proposed to keystone (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/38"> #38</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: master<br />
Review: <a rel="nofollow" href="https://review.openstack.org/61419">https:/<wbr />/review.<wbr />openstack.<wbr />org/61419</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: master
Review: https://review.openstack.org/61419</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        Steven Hardy (shardy) &#8594; Jeremy Stanley (fungi)
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Confirmed &#8594; In Progress
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2013-12-11 13:57:57 UTC" datetime="2013-12-11T13:57:57.997437+00:00">on 2013-12-11</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        Jeremy Stanley (fungi) &#8594; Steven Hardy (shardy)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/39" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-11T14:00:32.102603+00:00" title="2013-12-11 14:00:32 UTC">on 2013-12-11</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/39">
                <strong>Fix proposed to keystone (stable/havana)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/39"> #39</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fix proposed to branch: stable/havana<br />
Review: <a rel="nofollow" href="https://review.openstack.org/61425">https:/<wbr />/review.<wbr />openstack.<wbr />org/61425</a></p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fix proposed to branch: stable/havana
Review: https://review.openstack.org/61425</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2013-12-11 15:56:47 UTC" datetime="2013-12-11T15:56:47.114980+00:00">on 2013-12-11</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>summary</b>:
      </td>
      <td>
        - ec2tokens API doesn&#x27;t handle trust-scoped tokens correctly<br />+ [OSSA 2013-032] Keystone trust circumvention through EC2-style tokens<br />  (CVE-2013-6391)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/40" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-13T07:45:58.887299+00:00" title="2013-12-13 07:45:58 UTC">on 2013-12-13</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/40">
                <strong>Fix merged to keystone (master)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/40"> #40</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/61419">https:/<wbr />/review.<wbr />openstack.<wbr />org/61419</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=fa16882507d05f3bf2bbfbd62bb1b5bc0a6fb2b4">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=fa16882507d<wbr />05f3bf2bbfbd62b<wbr />b1b5bc0a6fb2b4</a><br />
Submitter: Jenkins<br />
Branch:    master</p>
<p>commit fa16882507d05f3<wbr />bf2bbfbd62bb1b5<wbr />bc0a6fb2b4<br />
Author: Steven Hardy &lt;email address hidden&gt;<br />
Date:   Mon Oct 21 19:49:01 2013 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix issues handling trust tokens via ec2tokens API</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Trust scoped tokens are handled incorectly when making requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;via the ec2tokens API, meaning that the restrictions enforced<br />
&nbsp;&nbsp;&nbsp;&nbsp;by trust-scoped tokens are not respected when obtaining a token<br />
&nbsp;&nbsp;&nbsp;&nbsp;via ec2token signature validation.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Storing the trust_id in the blob associated with the ec2 keypair,<br />
&nbsp;&nbsp;&nbsp;&nbsp;and passing that id in the metadata when requesting a v2 token<br />
&nbsp;&nbsp;&nbsp;&nbsp;solves the issue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I52566384d7813e<wbr />f0e2f20fb94a507<wbr />6386457ff02<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1242597</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/61419
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=fa16882507d05f3bf2bbfbd62bb1b5bc0a6fb2b4
Submitter: Jenkins
Branch:    master

commit fa16882507d05f3bf2bbfbd62bb1b5bc0a6fb2b4
Author: Steven Hardy &lt;shardy@redhat.com&gt;
Date:   Mon Oct 21 19:49:01 2013 +0100

    Fix issues handling trust tokens via ec2tokens API
    
    Trust scoped tokens are handled incorectly when making requests
    via the ec2tokens API, meaning that the restrictions enforced
    by trust-scoped tokens are not respected when obtaining a token
    via ec2token signature validation.
    
    Storing the trust_id in the blob associated with the ec2 keypair,
    and passing that id in the metadata when requesting a v2 token
    solves the issue.
    
    Change-Id: I52566384d7813ef0e2f20fb94a5076386457ff02
    Closes-Bug: #1242597
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        In Progress &#8594; Fix Committed
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/41" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-14T01:02:50.281349+00:00" title="2013-12-14 01:02:50 UTC">on 2013-12-14</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/41">
                <strong>Fix merged to keystone (stable/havana)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/41"> #41</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/61425">https:/<wbr />/review.<wbr />openstack.<wbr />org/61425</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=bd0e3e4cf0bda19ba9f45a60be7e4d6de196f224">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=bd0e3e4cf0b<wbr />da19ba9f45a60be<wbr />7e4d6de196f224</a><br />
Submitter: Jenkins<br />
Branch:    stable/havana</p>
<p>commit bd0e3e4cf0bda19<wbr />ba9f45a60be7e4d<wbr />6de196f224<br />
Author: Steven Hardy &lt;email address hidden&gt;<br />
Date:   Mon Oct 21 19:49:01 2013 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix issues handling trust tokens via ec2tokens API</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Trust scoped tokens are handled incorectly when making requests<br />
&nbsp;&nbsp;&nbsp;&nbsp;via the ec2tokens API, meaning that the restrictions enforced<br />
&nbsp;&nbsp;&nbsp;&nbsp;by trust-scoped tokens are not respected when obtaining a token<br />
&nbsp;&nbsp;&nbsp;&nbsp;via ec2token signature validation.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Storing the trust_id in the blob associated with the ec2 keypair,<br />
&nbsp;&nbsp;&nbsp;&nbsp;and passing that id in the metadata when requesting a v2 token<br />
&nbsp;&nbsp;&nbsp;&nbsp;solves the issue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: I52566384d7813e<wbr />f0e2f20fb94a507<wbr />6386457ff02<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1242597</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/61425
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=bd0e3e4cf0bda19ba9f45a60be7e4d6de196f224
Submitter: Jenkins
Branch:    stable/havana

commit bd0e3e4cf0bda19ba9f45a60be7e4d6de196f224
Author: Steven Hardy &lt;shardy@redhat.com&gt;
Date:   Mon Oct 21 19:49:01 2013 +0100

    Fix issues handling trust tokens via ec2tokens API
    
    Trust scoped tokens are handled incorectly when making requests
    via the ec2tokens API, meaning that the restrictions enforced
    by trust-scoped tokens are not respected when obtaining a token
    via ec2token signature validation.
    
    Storing the trust_id in the blob associated with the ec2 keypair,
    and passing that id in the metadata when requesting a v2 token
    solves the issue.
    
    Change-Id: I52566384d7813ef0e2f20fb94a5076386457ff02
    Closes-Bug: #1242597
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fungi" class="sprite person">Jeremy Stanley (fungi)</a>
    
    <time title="2013-12-14 18:36:16 UTC" datetime="2013-12-14T18:36:16.180386+00:00">on 2013-12-14</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ossa: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Committed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/42" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jdstrand" class="sprite person">Jamie Strandboge (jdstrand)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-17T20:34:10.784710+00:00" title="2013-12-17 20:34:10 UTC">on 2013-12-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/42"> #42</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m getting a testsuite failures on Ubuntu 13.10 with the patch from <a rel="nofollow" href="https://review.openstack.org/61425">https:/<wbr />/review.<wbr />openstack.<wbr />org/61425</a>:</p>
<p>=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<wbr />=======<br />
ERROR: keystone.<wbr />tests.test_<wbr />keystoneclient_<wbr />sql.KcMasterSql<wbr />TestCase.<wbr />test_ec2_<wbr />auth_success_<wbr />trust<br />
-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<wbr />-------<br />
_StringException: Traceback (most recent call last):<br />
&nbsp;&nbsp;File &quot;/«PKGBUILDDIR»<wbr />/keystone/<wbr />tests/test_<wbr />keystoneclient_<wbr />sql.py&quot;<wbr />, line 140, in test_ec2_<wbr />auth_success_<wbr />trust<br />
&nbsp;&nbsp;&nbsp;&nbsp;tenant_<wbr />id=self.<wbr />tenant_<wbr />bar[&#x27;id&#x27;<wbr />])<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />httpclient.<wbr />py&quot;, line 458, in authenticate<br />
&nbsp;&nbsp;&nbsp;&nbsp;resp, body = self.get_<wbr />raw_token_<wbr />from_identity_<wbr />service(<wbr />**kwargs)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />v2_0/client.<wbr />py&quot;, line 160, in get_raw_<wbr />token_from_<wbr />identity_<wbr />service<br />
&nbsp;&nbsp;&nbsp;&nbsp;token=token)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />v2_0/client.<wbr />py&quot;, line 189, in _base_authN<br />
&nbsp;&nbsp;&nbsp;&nbsp;resp, body = self.request(url, &#x27;POST&#x27;, body=params, headers=headers)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />httpclient.<wbr />py&quot;, line 609, in request<br />
&nbsp;&nbsp;&nbsp;&nbsp;**request_<wbr />kwargs)<br />
&nbsp;&nbsp;File &quot;/usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />httpclient.<wbr />py&quot;, line 114, in request<br />
&nbsp;&nbsp;&nbsp;&nbsp;raise exceptions.<wbr />from_response(<wbr />resp)<br />
Unauthorized: The request you have made requires authentication. (HTTP 401)</p>
<p>-------<wbr />-------<wbr />------ &gt;&gt; begin captured logging &lt;&lt; -------<wbr />-------<wbr />------<br />
...<br />
keystone.<wbr />token.controlle<wbr />rs: WARNING: User two is unauthorized for tenant bar<br />
keystone.<wbr />common.<wbr />wsgi: WARNING: Authorization failed. The request you have made requires authentication. from 127.0.0.1<br />
access: INFO: 127.0.0.1 - - [17/Dec/<wbr />2013:19:<wbr />30:18 +0000] &quot;POST <a rel="nofollow" href="http://localhost:49237/v2.0/tokens">http://<wbr />localhost:<wbr />49237/v2.<wbr />0/tokens</a> HTTP/1.0&quot; 401 114<br />
eventlet.<wbr />wsgi.server: INFO: 127.0.0.1 - - [17/Dec/2013 13:30:18] &quot;POST /v2.0/tokens HTTP/1.1&quot; 401 253 0.026661</p>
<p>urllib3.<wbr />connectionpool: DEBUG: &quot;POST /v2.0/tokens HTTP/1.1&quot; 401 114<br />
keystoneclient.<wbr />httpclient: DEBUG: Request returned failure status: 401<br />
keystoneclient.<wbr />v2_0.client: DEBUG: Authorization Failed.<br />
-------<wbr />-------<wbr />------- &gt;&gt; end captured logging &lt;&lt; -------<wbr />-------<wbr />-------</p>
<p>Our package is 1:2013.2 with only this fix and the one for CVE-2013-4477 (<a href="/bugs/1242855" class="bug-link">bug #1242855</a>). Am I missing other required patches?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm getting a testsuite failures on Ubuntu 13.10 with the patch from https://review.openstack.org/61425:

======================================================================
ERROR: keystone.tests.test_keystoneclient_sql.KcMasterSqlTestCase.test_ec2_auth_success_trust
----------------------------------------------------------------------
_StringException: Traceback (most recent call last):
  File "/«PKGBUILDDIR»/keystone/tests/test_keystoneclient_sql.py", line 140, in test_ec2_auth_success_trust
    tenant_id=self.tenant_bar['id'])
  File "/usr/lib/python2.7/dist-packages/keystoneclient/httpclient.py", line 458, in authenticate
    resp, body = self.get_raw_token_from_identity_service(**kwargs)
  File "/usr/lib/python2.7/dist-packages/keystoneclient/v2_0/client.py", line 160, in get_raw_token_from_identity_service
    token=token)
  File "/usr/lib/python2.7/dist-packages/keystoneclient/v2_0/client.py", line 189, in _base_authN
    resp, body = self.request(url, 'POST', body=params, headers=headers)
  File "/usr/lib/python2.7/dist-packages/keystoneclient/httpclient.py", line 609, in request
    **request_kwargs)
  File "/usr/lib/python2.7/dist-packages/keystoneclient/httpclient.py", line 114, in request
    raise exceptions.from_response(resp)
Unauthorized: The request you have made requires authentication. (HTTP 401)

-------------------- &gt;&gt; begin captured logging &lt;&lt; --------------------
...
keystone.token.controllers: WARNING: User two is unauthorized for tenant bar
keystone.common.wsgi: WARNING: Authorization failed. The request you have made requires authentication. from 127.0.0.1
access: INFO: 127.0.0.1 - - [17/Dec/2013:19:30:18 +0000] "POST http://localhost:49237/v2.0/tokens HTTP/1.0" 401 114
eventlet.wsgi.server: INFO: 127.0.0.1 - - [17/Dec/2013 13:30:18] "POST /v2.0/tokens HTTP/1.1" 401 253 0.026661

urllib3.connectionpool: DEBUG: "POST /v2.0/tokens HTTP/1.1" 401 114
keystoneclient.httpclient: DEBUG: Request returned failure status: 401
keystoneclient.v2_0.client: DEBUG: Authorization Failed.
--------------------- &gt;&gt; end captured logging &lt;&lt; ---------------------


Our package is 1:2013.2 with only this fix and the one for CVE-2013-4477 (bug #1242855). Am I missing other required patches?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/43" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~shardy" class="sprite person">Steven Hardy (shardy)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-17T21:24:37.101510+00:00" title="2013-12-17 21:24:37 UTC">on 2013-12-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/43"> #43</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p><span class="foldable-quoted">&gt; /usr/lib/<wbr />python2.<wbr />7/dist-<wbr />packages/<wbr />keystoneclient/<wbr />httpclient.<wbr />py
</span></p>
<p>Are you using the system installed keystoneclient rather than a venv?  If so what version?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">&gt; /usr/lib/python2.7/dist-packages/keystoneclient/httpclient.py

Are you using the system installed keystoneclient rather than a venv?  If so what version?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/44" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gandelman-a" class="sprite person">Adam Gandelman (gandelman-a)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-18T19:36:00.562475+00:00" title="2013-12-18 19:36:00 UTC">on 2013-12-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/44"> #44</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I&#x27;m hitting the same as Jamie trying to prepare Ubuntu package builds of the stable/havana 2013.2.1 release.  Neither of us are using venv, we&#x27;re attempting to build system packages using distro provided dependencies.  In this case, we&#x27;re using the  python-<wbr />keystoneclient package version 0.3.2-0ubuntu1, which should satisfy keystones requirement (python-<wbr />keystoneclient&gt;<wbr />=0.3.2)<wbr />.</p>
<p>I know that this fix was blocked from merging into stable/havana until a corresponding update to global requirements got merged.  The requirements update for keystone is @ <a rel="nofollow" href="https://review.openstack.org/#/c/61534/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />61534/</a>.  However, its difficult to know what changes to the requirements are relevant to this fix and what changes came in as part of the general sync.</p>
<p>Any hints appreciated.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I'm hitting the same as Jamie trying to prepare Ubuntu package builds of the stable/havana 2013.2.1 release.  Neither of us are using venv, we're attempting to build system packages using distro provided dependencies.  In this case, we're using the  python-keystoneclient package version 0.3.2-0ubuntu1, which should satisfy keystones requirement (python-keystoneclient&gt;=0.3.2).  

I know that this fix was blocked from merging into stable/havana until a corresponding update to global requirements got merged.  The requirements update for keystone is @ https://review.openstack.org/#/c/61534/.  However, its difficult to know what changes to the requirements are relevant to this fix and what changes came in as part of the general sync.   

Any hints appreciated.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/45" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gandelman-a" class="sprite person">Adam Gandelman (gandelman-a)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-19T03:12:08.302444+00:00" title="2013-12-19 03:12:08 UTC">on 2013-12-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/45"> #45</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Did a bit more digging... Steven&#x27;s right, looks like an issue using older version of keystoneclient. With <a rel="nofollow" href="https://review.openstack.org/#/c/48462/">https:/<wbr />/review.<wbr />openstack.<wbr />org/#/c/<wbr />48462/</a> applied against our 0.3.2 package, tests run again.   The patch didn&#x27;t release with keystoneclient until 0.4.1</p>
<p>@Steven<br />
Is the keystones requirements&#x27; &quot;python-<wbr />keystoneclient&gt;<wbr />=0.3.2&quot; entry correct, or does it need to be updated to &gt;=0.4.1?  In other words, is this just an issue for the test suite or is keystone still vulnerable if using an older client library?</p>
<p>Thanks,<br />
Adam</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Did a bit more digging... Steven's right, looks like an issue using older version of keystoneclient. With https://review.openstack.org/#/c/48462/ applied against our 0.3.2 package, tests run again.   The patch didn't release with keystoneclient until 0.4.1

@Steven
Is the keystones requirements' "python-keystoneclient&gt;=0.3.2" entry correct, or does it need to be updated to &gt;=0.4.1?  In other words, is this just an issue for the test suite or is keystone still vulnerable if using an older client library?

Thanks,
Adam
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/46" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~jdstrand" class="sprite person">Jamie Strandboge (jdstrand)</a>
            wrote
            <time itemprop="commentTime" datetime="2013-12-19T22:24:57.052549+00:00" title="2013-12-19 22:24:57 UTC">on 2013-12-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/46"> #46</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I confirm it was a limitation of python-<wbr />keystoneclient 0.3.2. If I upgrade to 0.4.1 the test passes.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I confirm it was a limitation of python-keystoneclient 0.3.2. If I upgrade to 0.4.1 the test passes.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2014-01-22 15:42:23 UTC" datetime="2014-01-22T15:42:23.242214+00:00">on 2014-01-22</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        none &#8594; icehouse-2
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Fix Committed &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/keystone/+bug/1242597/comments/47" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~hudson-openstack" class="sprite person">OpenStack Infra (hudson-openstack)</a>
            wrote
            <time itemprop="commentTime" datetime="2014-01-25T09:33:52.916209+00:00" title="2014-01-25 09:33:52 UTC">on 2014-01-25</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/keystone/+bug/1242597/comments/47">
                <strong>Related fix merged to keystone (stable/grizzly)</strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/keystone/+bug/1242597/comments/47"> #47</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Reviewed:  <a rel="nofollow" href="https://review.openstack.org/51973">https:/<wbr />/review.<wbr />openstack.<wbr />org/51973</a><br />
Committed: <a rel="nofollow" href="https://git.openstack.org/cgit/openstack/keystone/commit/?id=8fcc18c42bde2db34e4b29236dc2e971d40f146b">https:/<wbr />/git.openstack.<wbr />org/cgit/<wbr />openstack/<wbr />keystone/<wbr />commit/<wbr />?id=8fcc18c42bd<wbr />e2db34e4b29236d<wbr />c2e971d40f146b</a><br />
Submitter: Jenkins<br />
Branch:    stable/grizzly</p>
<p>commit 8fcc18c42bde2db<wbr />34e4b29236dc2e9<wbr />71d40f146b<br />
Author: Steven Hardy &lt;email address hidden&gt;<br />
Date:   Sun Oct 13 10:44:52 2013 +0100</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Fix v2 token user ref with trust impersonation=True</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;The v2 token controller incorrectly checks for a string instead<br />
&nbsp;&nbsp;&nbsp;&nbsp;of a boolean, which results in the wrong user ID (trustee, when<br />
&nbsp;&nbsp;&nbsp;&nbsp;it should be the trustor) when impersonation=True.  So fix the<br />
&nbsp;&nbsp;&nbsp;&nbsp;comparison and tests, adding a test which illustrates the issue.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;This patchset also closes the gap that allows EC2 credentials to<br />
&nbsp;&nbsp;&nbsp;&nbsp;be issued from trust-scoped tokens, allowing privilege escalation<br />
&nbsp;&nbsp;&nbsp;&nbsp;since EC2 tokens have no concept of trust-scoping/role<br />
&nbsp;&nbsp;&nbsp;&nbsp;restrictions in the Grizzly release.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;Change-Id: Ic94f30f2354c9f<wbr />da20531bb598387<wbr />368fde8a096<br />
&nbsp;&nbsp;&nbsp;&nbsp;Closes-Bug: #1239303<br />
&nbsp;&nbsp;&nbsp;&nbsp;Related-Bug: #1242597</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Reviewed:  https://review.openstack.org/51973
Committed: https://git.openstack.org/cgit/openstack/keystone/commit/?id=8fcc18c42bde2db34e4b29236dc2e971d40f146b
Submitter: Jenkins
Branch:    stable/grizzly

commit 8fcc18c42bde2db34e4b29236dc2e971d40f146b
Author: Steven Hardy &lt;shardy@redhat.com&gt;
Date:   Sun Oct 13 10:44:52 2013 +0100

    Fix v2 token user ref with trust impersonation=True
    
    The v2 token controller incorrectly checks for a string instead
    of a boolean, which results in the wrong user ID (trustee, when
    it should be the trustor) when impersonation=True.  So fix the
    comparison and tests, adding a test which illustrates the issue.
    
    This patchset also closes the gap that allows EC2 credentials to
    be issued from trust-scoped tokens, allowing privilege escalation
    since EC2 tokens have no concept of trust-scoping/role
    restrictions in the Grizzly release.
    
    Change-Id: Ic94f30f2354c9fda20531bb598387368fde8a096
    Closes-Bug: #1239303
    Related-Bug: #1242597
</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: in-stable-grizzly
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~apevec" class="sprite person">Alan Pevec (apevec)</a>
    
    <time title="2014-03-20 20:02:30 UTC" datetime="2014-03-20T20:02:30.691822+00:00">on 2014-03-20</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        removed: in-stable-grizzly
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~ttx" class="sprite person">Thierry Carrez (ttx)</a>
    
    <time title="2014-04-17 07:58:15 UTC" datetime="2014-04-17T07:58:15.261804+00:00">on 2014-04-17</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in keystone: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>milestone</b>:
      </td>
      <td>
        icehouse-2 &#8594; 2014.1
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/keystone/+bug/1242597/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/keystone/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/keystone/+bug/1242597/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/keystone/+bug/1242597/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/keystone/+bug/1242597/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/keystone/+bug/1242597/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/keystone/+bug/1242597/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/keystone/+bug/1242597/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3886582/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API.patch">Proposed fix</a>
        <small>
          (<a href="/keystone/+bug/1242597/+attachment/3886582">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3887645/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API.patch">Proposed fix, second draft</a>
        <small>
          (<a href="/keystone/+bug/1242597/+attachment/3887645">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3912878/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-MASTER.patch">0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-MASTER.patch</a>
        <small>
          (<a href="/keystone/+bug/1242597/+attachment/3912878">edit</a>)
        </small>
      </li>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3914454/+files/0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-grizzly.patch">0001-Fix-issues-handling-trust-tokens-via-ec2tokens-API-grizzly.patch</a>
        <small>
          (<a href="/keystone/+bug/1242597/+attachment/3914454">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/keystone/+bug/1242597/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  <div class="portlet" id="portlet-attachments">
    <h2>Bug attachments</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite download-icon" href="https://bugs.launchpad.net/keystone/+bug/1242597/+attachment/3885983/+files/trust_ec2_test.py">Reproducer script</a>
        <small>
          (<a href="/keystone/+bug/1242597/+attachment/3885983">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/keystone/+bug/1242597/+addcomment">Add attachment</a>
      </li>
    </ul>
  </div>


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"initial_comment_batch_offset": 41, "first visible_recent_comment": 7, "related_features": {}, "subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1242597", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1242597"}, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1242597", "web_link": "https://bugs.launchpad.net/bugs/1242597", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1242597, "private": false, "information_type": "Public Security", "name": null, "title": "[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)", "description": "So I finally got around to investigating the scenario I mentioned in https://review.openstack.org/#/c/40444/, and unfortunately it seems that the ec2tokens API does indeed provide a way to circumvent the role delegation provided by trusts, and obtain all the roles of the trustor user, not just those explicitly delegated.\n\nSteps to reproduce:\n- Trustor creates a trust delegating a subset of roles\n- Trustee gets a token scoped to that trust\n- Trustee creates an ec2-keypair\n- Trustee makes a request to the ec2tokens API, to validate a signature created with the keypair\n- ec2tokens API returns a new token, which is not scoped to the trust and enables access to all the trustor's roles.\n\nI can provide some test code which demonstrates the issue.", "owner_link": "https://bugs.launchpad.net/api/devel/~shardy", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/bug_tasks", "duplicate_of_link": null, "date_created": "2013-10-21T09:46:29.457927+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/subscriptions", "date_last_updated": "2014-04-17T07:58:18.063042+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 280, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/attachments", "security_related": true, "latest_patch_uploaded": "2013-11-21T21:18:36.617559+00:00", "tags": [], "date_last_message": "2014-01-25T09:33:52.916209+00:00", "number_of_duplicates": 0, "message_count": 48, "users_affected_count": 2, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/users_unaffected", "users_affected_count_with_dupes": 2, "other_users_affected_count_with_dupes": 2, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1242597/linked_merge_proposals", "http_etag": "\"66293ac724f3bcaa3cafe1c9cae219f1198f215b-fcfe67d0401c6b0884daf135b7339fc6d110c6c0\""}, "bugtask_data": {"1514051": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/keystone/havana/+bug/1242597/+delete", "user_can_edit_status": true, "bugtask_path": "/keystone/havana/+bug/1242597", "row_id": "tasksummary1514051", "importance_value": "Critical", "importance_widget_items": "[]", "id": 1514051, "user_can_delete": false, "targetname": "OpenStack Identity (keystone) havana", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)", "assignee_value": "shardy", "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task1514051", "target_is_product": false, "assignee_is_team": false, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": "https://bugs.launchpad.net/api/devel/keystone/+milestone/2013.2.1", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "keystone_havana"}, "1570596": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/keystone/grizzly/+bug/1242597/+delete", "user_can_edit_status": true, "bugtask_path": "/keystone/grizzly/+bug/1242597", "row_id": "tasksummary1570596", "importance_value": "Critical", "importance_widget_items": "[]", "id": 1570596, "user_can_delete": false, "targetname": "OpenStack Identity (keystone) grizzly", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)", "assignee_value": "dolph", "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task1570596", "target_is_product": false, "assignee_is_team": false, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": "https://bugs.launchpad.net/api/devel/keystone/+milestone/2013.1.5", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "keystone_grizzly"}, "1487206": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/ossa/+bug/1242597/+delete", "user_can_edit_status": true, "bugtask_path": "/ossa/+bug/1242597", "row_id": "tasksummary1487206", "importance_value": "High", "importance_widget_items": "[]", "id": 1487206, "user_can_delete": false, "targetname": "OpenStack Security Advisory", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)", "assignee_value": "fungi", "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task1487206", "target_is_product": true, "assignee_is_team": false, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": null, "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "ossa"}, "1487091": {"milestone_widget_items": "[]", "status_widget_items": "[]", "delete_link": "https://bugs.launchpad.net/keystone/+bug/1242597/+delete", "user_can_edit_status": true, "bugtask_path": "/keystone/+bug/1242597", "row_id": "tasksummary1487091", "importance_value": "Critical", "importance_widget_items": "[]", "id": 1487091, "user_can_delete": false, "targetname": "OpenStack Identity (keystone)", "user_can_edit_importance": false, "assignee_vocabulary_filters": [], "bug_title": "[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)", "assignee_value": "shardy", "hide_assignee_team_selection": true, "user_can_edit_assignee": false, "form_row_id": "task1487091", "target_is_product": true, "assignee_is_team": false, "status_value": "Fix Released", "user_can_unassign": false, "milestone_value": "https://bugs.launchpad.net/api/devel/keystone/+milestone/2014.1", "assignee_vocabulary": "AllUserTeamsParticipation", "user_can_edit_milestone": false, "prefix": "keystone"}}, "bug_is_private": false, "context": {"self_link": "https://bugs.launchpad.net/api/devel/keystone/+bug/1242597", "web_link": "https://bugs.launchpad.net/keystone/+bug/1242597", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1242597", "milestone_link": "https://bugs.launchpad.net/api/devel/keystone/+milestone/2014.1", "status": "Fix Released", "importance": "Critical", "assignee_link": "https://bugs.launchpad.net/api/devel/~shardy", "bug_target_display_name": "OpenStack Identity (keystone)", "bug_target_name": "keystone", "bug_watch_link": null, "date_assigned": "2013-10-21T16:10:12.128531+00:00", "date_created": "2013-10-21T09:46:29.457927+00:00", "date_confirmed": "2013-10-21T13:34:45.649366+00:00", "date_incomplete": null, "date_in_progress": "2013-12-11T13:38:23.601854+00:00", "date_closed": "2014-01-22T15:42:23.955084+00:00", "date_left_new": "2013-10-21T13:34:45.649366+00:00", "date_triaged": "2013-12-11T13:38:23.601854+00:00", "date_fix_committed": "2013-12-13T07:45:57.579249+00:00", "date_fix_released": "2014-01-22T15:42:23.955084+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~shardy", "target_link": "https://bugs.launchpad.net/api/devel/keystone", "title": "Bug #1242597 in OpenStack Identity (keystone): \"[OSSA 2013-032] Keystone trust circumvention through EC2-style tokens (CVE-2013-6391)\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/keystone/+bug/1242597/related_tasks", "is_complete": true, "http_etag": "\"180d710d18f2bad638533fb635aad78ee0d9f05d-cfe18e879a418deefc01db990e27e92b80cee07e\""}, "information_type_data": {"PUBLIC": {"value": "PUBLIC", "is_private": false, "order": 0, "name": "Public", "description": "Everyone can see this information.\n", "description_css_class": "choice-description"}, "PRIVATESECURITY": {"value": "PRIVATESECURITY", "is_private": true, "order": 2, "name": "Private Security", "description": "Only the security group can see this information.\n ", "description_css_class": "choice-description"}, "USERDATA": {"value": "USERDATA", "is_private": true, "order": 3, "name": "Private", "description": "Only shared with users permitted to see private user information.\n", "description_css_class": "choice-description"}, "PUBLICSECURITY": {"value": "PUBLICSECURITY", "is_private": false, "order": 1, "name": "Public Security", "description": "Everyone can see this security related information.\n", "description_css_class": "choice-description"}}, "total_comments_and_activity": 103};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 64 queries/external actions issued in 1.18 seconds

    Features: {'bugs.nominations.bug_supervisors_can_target': 'on', 'hard_timeout': '9000', 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'app.maintenance_message': None, 'js.yui_version': None, 'disclosure.dsp_picker.enabled': 'on', 'profiling.enabled': None, 'baselayout.careers_link.disabled': None}

    r0d8de2b

    -->

</html>

