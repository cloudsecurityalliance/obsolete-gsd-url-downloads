<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#992058 - opensysusers: uses `eval` on data that is not supposed to be safe to eval (CVE-2021-40084) - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=992058&quot;&gt;992058&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:992058@bugs.debian.org">#992058</a><br>
opensysusers: uses `eval` on data that is not supposed to be safe to eval (CVE-2021-40084)</h1>
<div class="versiongraph"><a href="version.cgi?found=opensysusers%2F0.6-2;info=1;collapse=1;fixed=opensysusers%2F0.6-3;absolute=0;package=opensysusers"><img alt="version graph" src="version.cgi?width=2;absolute=0;package=opensysusers;collapse=1;fixed=opensysusers%2F0.6-3;height=2;found=opensysusers%2F0.6-2"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=opensysusers">opensysusers</a>;
Maintainer for <a href="pkgreport.cgi?package=opensysusers">opensysusers</a> is <a href="pkgreport.cgi?maint=packages%40qa.debian.org">Debian QA Group &lt;packages@qa.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=opensysusers">opensysusers</a> is <a href="pkgreport.cgi?src=opensysusers">src:opensysusers</a> (<a href="https://tracker.debian.org/pkg/opensysusers">PTS</a>, <a href="https://buildd.debian.org/opensysusers">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=opensysusers">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=ansgar%40debian.org">Ansgar &lt;ansgar@debian.org&gt;</a></p>
  <p>Date: Tue, 10 Aug 2021 09:09:02 UTC</p>

<p>Severity: <em class="severity">serious</em></p>
<p>Tags: patch, security, upstream</p>

<p>Found in version opensysusers/0.6-2</p>
<p>Fixed in version opensysusers/0.6-3</p>

<p><strong>Done:</strong> Lorenzo Puliti &lt;plorenzo@disroot.org&gt;</p>

</div>

<p><a href="mailto:992058@bugs.debian.org">Reply</a> or <a href="mailto:992058-subscribe@bugs.debian.org">subscribe</a> to this bug.</p>
<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=992058;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, team@security.debian.org, Debian QA Group &lt;packages@qa.debian.org&gt; -->
<!-- time:1628586543 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, team@security.debian.org, Debian QA Group &lt;packages@qa.debian.org&gt;</code>:<br>
<code>Bug#992058</code>; Package <code>opensysusers</code>.
 (Tue, 10 Aug 2021 09:09:03 GMT) (<a href="bugreport.cgi?bug=992058;msg=2">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: Ansgar &lt;ansgar@debian.org&gt; -->
<!-- time:1628586543 -->
<strong>Acknowledgement sent</strong>
to <code>Ansgar &lt;ansgar@debian.org&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>team@security.debian.org, Debian QA Group &lt;packages@qa.debian.org&gt;</code>.
 (Tue, 10 Aug 2021 09:09:03 GMT) (<a href="bugreport.cgi?bug=992058;msg=4">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=992058;msg=5">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=5">mbox</a>, <a href="mailto:992058@bugs.debian.org?In-Reply-To=%3C162858644404.349609.10682699695724300510.reportbug%40benzaiten%3E&amp;body=On%20Tue%2C%2010%20Aug%202021%2011%3A07%3A24%20%2B0200%20Ansgar%20%3Cansgar%40debian.org%3E%20wrote%3A%0A%3E%20Package%3A%20opensysusers%0A%3E%20Version%3A%200.6-2%0A%3E%20Severity%3A%20serious%0A%3E%20Tags%3A%20security%20upstream%0A%3E%20X-Debbugs-Cc%3A%20Debian%20Security%20Team%20%3Cteam%40security.debian.org%3E%0A%3E%20%0A%3E%20opensysusers%20uses%20the%20shell%27s%20%60eval%60%20on%20everything%20in%20sysusers.d%20like%0A%3E%20there%20is%20no%20tomorrow.%20These%20files%20can%20contain%20shell%20meta-characters%0A%3E%20that%20should%20not%20result%20in%20code%20execution%2C%20e.g.%2C%20in%20the%20GECOS%20field.%0A%3E%20%0A%3E%20%2B---%0A%3E%20%7C%20%23%20mkdir%20%2Fetc%2Fsysusers.d%0A%3E%20%7C%20%23%20echo%20%27u%20test-user%20-%20%22Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%22%20%2Fvar%2Flib%2Ftest-users%20%2Fbin%2Fsh%27%20%3E%20%2Fetc%2Fsysusers.d%2Ftest.conf%0A%3E%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20%23%20systemd-sysusers%20%23%20this%20is%20opensysusers%0A%3E%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash%2A%0A%3E%20%7C%20ls%3A%20cannot%20access%20%27%2Fetc%2Fbash%2A%27%3A%20No%20such%20file%20or%20directory%0A%3E%20%2B---%5B%20opensysusers%200.6-2%20%5D%0A%3E%20%0A%3E%20systemd%27s%20systemd-sysuser%20behaves%20differently%3A%0A%3E%20%0A%3E%20%2B---%0A%3E%20%7C%20%23%20mkdir%20%2Fetc%2Fsysusers.d%0A%3E%20%7C%20%23%20echo%20%27u%20test-user%20-%20%22Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%22%20%2Fvar%2Flib%2Ftest-users%20%2Fbin%2Fsh%27%20%3E%20%2Fetc%2Fsysusers.d%2Ftest.conf%0A%3E%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20%23%20systemd-sysusers%0A%3E%20%7C%20Creating%20group%20systemd-coredump%20with%20gid%20999.%0A%3E%20%7C%20Creating%20user%20systemd-coredump%20%28systemd%20Core%20Dumper%29%20with%20uid%20999%20and%20gid%20999.%0A%3E%20%7C%20Creating%20group%20test-user%20with%20gid%20998.%0A%3E%20%7C%20Creating%20user%20test-user%20%28Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%29%20with%20uid%20998%20and%20gid%20998.%0A%3E%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%20%2Fetc%2Fbash.bashrc%0A%3E%20%7C%20%23%20getent%20passwd%20test-user%0A%3E%20%7C%20test-user%3Ax%3A998%3A998%3ADo%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%3A%2Fvar%2Flib%2Ftest-users%3A%2Fbin%2Fsh%0A%3E%20%2B---%5B%20systemd%20247.3-6%20%5D%0A%3E%20%0A%3E%20As%20opensysusers%20is%20supposed%20to%20be%20a%20drop-in%20requirement%20for%0A%3E%20systemd-sysusers%20it%20%2Amust%2A%20behave%20as%20systemd%20does%20and%20not%20execute%0A%3E%20data.%0A%3E%20%0A%3E%20Ansgar%0A%3E%20%0A%3E%20%0A&amp;References=%3C162858644404.349609.10682699695724300510.reportbug%40benzaiten%3E&amp;subject=Re%3A%20opensysusers%3A%20uses%20%60eval%60%20on%20data%20that%20is%20not%20supposed%20to%20be%20safe%20to%20eval">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ansgar%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Ansgar &lt;ansgar@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> opensysusers: uses `eval` on data that is not supposed to be safe to eval</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 10 Aug 2021 11:07:24 +0200</div>
</div>
<pre class="message">Package: opensysusers
Version: 0.6-2
Severity: serious
Tags: security upstream
X-Debbugs-Cc: Debian Security Team &lt;team@security.debian.org&gt;

opensysusers uses the shell&#39;s `eval` on everything in sysusers.d like
there is no tomorrow. These files can contain shell meta-characters
that should not result in code execution, e.g., in the GECOS field.

+---
| # mkdir /etc/sysusers.d
| # echo &#39;u test-user - &quot;Do not $(rm /etc/bash.bashrc)&quot; /var/lib/test-users /bin/sh&#39; &gt; /etc/sysusers.d/test.conf
| # ls -l /etc/bash.bashrc
| -rw-r--r-- 1 root root 1994 Jun 22 02:26 /etc/bash.bashrc
| # systemd-sysusers # this is opensysusers
| # ls -l /etc/bash*
| ls: cannot access &#39;/etc/bash*&#39;: No such file or directory
+---[ opensysusers 0.6-2 ]

systemd&#39;s systemd-sysuser behaves differently:

+---
| # mkdir /etc/sysusers.d
| # echo &#39;u test-user - &quot;Do not $(rm /etc/bash.bashrc)&quot; /var/lib/test-users /bin/sh&#39; &gt; /etc/sysusers.d/test.conf
| # ls -l /etc/bash.bashrc
| -rw-r--r-- 1 root root 1994 Jun 22 02:26 /etc/bash.bashrc
| # systemd-sysusers
| Creating group systemd-coredump with gid 999.
| Creating user systemd-coredump (systemd Core Dumper) with uid 999 and gid 999.
| Creating group test-user with gid 998.
| Creating user test-user (Do not $(rm /etc/bash.bashrc)) with uid 998 and gid 998.
| # ls -l /etc/bash.bashrc
| -rw-r--r-- 1 root root 1994 Jun 22 02:26 /etc/bash.bashrc
| # getent passwd test-user
| test-user:x:998:998:Do not $(rm /etc/bash.bashrc):/var/lib/test-users:/bin/sh
+---[ systemd 247.3-6 ]

As opensysusers is supposed to be a drop-in requirement for
systemd-sysusers it *must* behave as systemd does and not execute
data.

Ansgar


</pre>

<div class="msgreceived"><hr><p>
<a name="6"></a>
<!-- command:title -->
<!-- requester: Salvatore Bonaccorso &lt;carnil@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1629868144 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;opensysusers: uses `eval` on data that is not supposed to be safe to eval (CVE-2021-40084)&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;opensysusers: uses `eval` on data that is not supposed to be safe to eval&#39;
            };
-->
<strong>Changed Bug title to &#39;opensysusers: uses `eval` on data that is not supposed to be safe to eval (CVE-2021-40084)&#39; from &#39;opensysusers: uses `eval` on data that is not supposed to be safe to eval&#39;.</strong>
Request was from <code>Salvatore Bonaccorso &lt;carnil@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Wed, 25 Aug 2021 05:09:04 GMT) (<a href="bugreport.cgi?bug=992058;msg=7">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Debian QA Group &lt;packages@qa.debian.org&gt; -->
<!-- time:1631900882 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Debian QA Group &lt;packages@qa.debian.org&gt;</code>:<br>
<code>Bug#992058</code>; Package <code>opensysusers</code>.
 (Fri, 17 Sep 2021 17:48:02 GMT) (<a href="bugreport.cgi?bug=992058;msg=9">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="10"></a>
<!-- request_addr: Lorenzo &lt;plorenzo@disroot.org&gt; -->
<!-- time:1631900882 -->
<strong>Acknowledgement sent</strong>
to <code>Lorenzo &lt;plorenzo@disroot.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian QA Group &lt;packages@qa.debian.org&gt;</code>.
 (Fri, 17 Sep 2021 17:48:02 GMT) (<a href="bugreport.cgi?bug=992058;msg=11">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=11">mbox</a>, <a href="#10">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="12"></a><a name="msg12"></a><a href="#12">Message #12</a> received at 992058@bugs.debian.org (<a href="bugreport.cgi?bug=992058;msg=12">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=12">mbox</a>, <a href="mailto:992058@bugs.debian.org?body=On%20Fri%2C%2017%20Sep%202021%2019%3A45%3A51%20%2B0200%20Lorenzo%20%3Cplorenzo%40disroot.org%3E%20wrote%3A%0A%3E%20Control%3A%20tags%20-1%20patch%0A%3E%20%0A%3E%20Hi%2C%0A%3E%20%0A%3E%20On%20Tue%2C%2010%20Aug%202021%2011%3A07%3A24%20%2B0200%20Ansgar%20%3Cansgar%40debian.org%3E%20wrote%3A%0A%3E%20%3E%20Package%3A%20opensysusers%0A%3E%20%3E%20Version%3A%200.6-2%0A%3E%20%3E%20Severity%3A%20serious%0A%3E%20%3E%20Tags%3A%20security%20upstream%0A%3E%20%3E%20X-Debbugs-Cc%3A%20Debian%20Security%20Team%20%3Cteam%40security.debian.org%3E%0A%3E%20%3E%20%0A%3E%20%3E%20opensysusers%20uses%20the%20shell%27s%20%60eval%60%20on%20everything%20in%20sysusers.d%20like%0A%3E%20%3E%20there%20is%20no%20tomorrow.%20These%20files%20can%20contain%20shell%20meta-characters%0A%3E%20%3E%20that%20should%20not%20result%20in%20code%20execution%2C%20e.g.%2C%20in%20the%20GECOS%20field.%0A%3E%20%3E%20%0A%3E%20%3E%20%2B---%0A%3E%20%3E%20%7C%20%23%20mkdir%20%2Fetc%2Fsysusers.d%0A%3E%20%3E%20%7C%20%23%20echo%20%27u%20test-user%20-%20%22Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%22%0A%3E%20%3E%20%2Fvar%2Flib%2Ftest-users%20%2Fbin%2Fsh%27%20%3E%20%2Fetc%2Fsysusers.d%2Ftest.conf%20%7C%20%23%20ls%20-l%0A%3E%20%3E%20%2Fetc%2Fbash.bashrc%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%0A%3E%20%3E%20%2Fetc%2Fbash.bashrc%20%7C%20%23%20systemd-sysusers%20%23%20this%20is%20opensysusers%0A%3E%20%3E%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash%2A%0A%3E%20%3E%20%7C%20ls%3A%20cannot%20access%20%27%2Fetc%2Fbash%2A%27%3A%20No%20such%20file%20or%20directory%0A%3E%20%3E%20%2B---%5B%20opensysusers%200.6-2%20%5D%0A%3E%20%3E%20%0A%3E%20%3E%20systemd%27s%20systemd-sysuser%20behaves%20differently%3A%0A%3E%20%3E%20%0A%3E%20%3E%20%2B---%0A%3E%20%3E%20%7C%20%23%20mkdir%20%2Fetc%2Fsysusers.d%0A%3E%20%3E%20%7C%20%23%20echo%20%27u%20test-user%20-%20%22Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%22%0A%3E%20%3E%20%2Fvar%2Flib%2Ftest-users%20%2Fbin%2Fsh%27%20%3E%20%2Fetc%2Fsysusers.d%2Ftest.conf%20%7C%20%23%20ls%20-l%0A%3E%20%3E%20%2Fetc%2Fbash.bashrc%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%0A%3E%20%3E%20%2Fetc%2Fbash.bashrc%20%7C%20%23%20systemd-sysusers%0A%3E%20%3E%20%7C%20Creating%20group%20systemd-coredump%20with%20gid%20999.%0A%3E%20%3E%20%7C%20Creating%20user%20systemd-coredump%20%28systemd%20Core%20Dumper%29%20with%20uid%20999%0A%3E%20%3E%20and%20gid%20999.%20%7C%20Creating%20group%20test-user%20with%20gid%20998.%0A%3E%20%3E%20%7C%20Creating%20user%20test-user%20%28Do%20not%20%24%28rm%20%2Fetc%2Fbash.bashrc%29%29%20with%20uid%0A%3E%20%3E%20998%20and%20gid%20998.%20%7C%20%23%20ls%20-l%20%2Fetc%2Fbash.bashrc%0A%3E%20%3E%20%7C%20-rw-r--r--%201%20root%20root%201994%20Jun%2022%2002%3A26%20%2Fetc%2Fbash.bashrc%0A%3E%20%3E%20%7C%20%23%20getent%20passwd%20test-user%0A%3E%20%3E%20%7C%20test-user%3Ax%3A998%3A998%3ADo%20not%20%24%28rm%0A%3E%20%3E%20%2Fetc%2Fbash.bashrc%29%3A%2Fvar%2Flib%2Ftest-users%3A%2Fbin%2Fsh%20%2B---%5B%20systemd%20247.3-6%20%5D%0A%3E%20%3E%20%0A%3E%20%3E%20As%20opensysusers%20is%20supposed%20to%20be%20a%20drop-in%20requirement%20for%0A%3E%20%3E%20systemd-sysusers%20it%20%2Amust%2A%20behave%20as%20systemd%20does%20and%20not%20execute%0A%3E%20%3E%20data.%0A%3E%20%3E%20%0A%3E%20%3E%20Ansgar%0A%3E%20%3E%20%0A%3E%20%0A%3E%20Attached%20is%20a%20patch%20that%20sets%20the%20GECOS%20field%20without%20using%20eval%3A%20under%0A%3E%20the%20assumption%20that%20the%20double%20quote%20character%20is%20not%20valid%20for%0A%3E%20Type%2CName%2CID%20field%20it%20should%20work.%20Did%20not%20have%20the%20time%20to%20test%20it%20yet.%0A%3E%20If%20someone%20has%20a%20better%20idea%20I%20do%20welcome%20suggestion.%0A%3E%20%0A%3E%20Lorenzo%0A%3E%20%0A%3E%20%0A%3E%20%0A%3E%20---%20.%2Fsysusers%20%202020-12-22%2012%3A41%3A37.754884910%20%2B0100%0A&amp;References=%3C20210917194551.256a4b5e%40lorenz.fritz.box%3E&amp;In-Reply-To=%3C20210917194551.256a4b5e%40lorenz.fritz.box%3E&amp;subject=Re%3A%20opensysusers%3A%20uses%20%60eval%60%20on%20data%20that%20is%20not%20supposed%20to%20be%0A%20safe%20to%20eval">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=plorenzo%40disroot.org" alt="">
<div class="header"><span class="headerfield">From:</span> Lorenzo &lt;plorenzo@disroot.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 992058@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: opensysusers: uses `eval` on data that is not supposed to be
 safe to eval</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 17 Sep 2021 19:45:51 +0200</div>
</div>
<pre class="message">Control: tags -1 patch

Hi,

On Tue, 10 Aug 2021 11:07:24 +0200 Ansgar &lt;ansgar@debian.org&gt; wrote:
&gt; Package: opensysusers
&gt; Version: 0.6-2
&gt; Severity: serious
&gt; Tags: security upstream
&gt; X-Debbugs-Cc: Debian Security Team &lt;team@security.debian.org&gt;
&gt; 
&gt; opensysusers uses the shell&#39;s `eval` on everything in sysusers.d like
&gt; there is no tomorrow. These files can contain shell meta-characters
&gt; that should not result in code execution, e.g., in the GECOS field.
&gt; 
&gt; +---
&gt; | # mkdir /etc/sysusers.d
&gt; | # echo &#39;u test-user - &quot;Do not $(rm /etc/bash.bashrc)&quot;
&gt; /var/lib/test-users /bin/sh&#39; &gt; /etc/sysusers.d/test.conf | # ls -l
&gt; /etc/bash.bashrc | -rw-r--r-- 1 root root 1994 Jun 22 02:26
&gt; /etc/bash.bashrc | # systemd-sysusers # this is opensysusers
&gt; | # ls -l /etc/bash*
&gt; | ls: cannot access &#39;/etc/bash*&#39;: No such file or directory
&gt; +---[ opensysusers 0.6-2 ]
&gt; 
&gt; systemd&#39;s systemd-sysuser behaves differently:
&gt; 
&gt; +---
&gt; | # mkdir /etc/sysusers.d
&gt; | # echo &#39;u test-user - &quot;Do not $(rm /etc/bash.bashrc)&quot;
&gt; /var/lib/test-users /bin/sh&#39; &gt; /etc/sysusers.d/test.conf | # ls -l
&gt; /etc/bash.bashrc | -rw-r--r-- 1 root root 1994 Jun 22 02:26
&gt; /etc/bash.bashrc | # systemd-sysusers
&gt; | Creating group systemd-coredump with gid 999.
&gt; | Creating user systemd-coredump (systemd Core Dumper) with uid 999
&gt; and gid 999. | Creating group test-user with gid 998.
&gt; | Creating user test-user (Do not $(rm /etc/bash.bashrc)) with uid
&gt; 998 and gid 998. | # ls -l /etc/bash.bashrc
&gt; | -rw-r--r-- 1 root root 1994 Jun 22 02:26 /etc/bash.bashrc
&gt; | # getent passwd test-user
&gt; | test-user:x:998:998:Do not $(rm
&gt; /etc/bash.bashrc):/var/lib/test-users:/bin/sh +---[ systemd 247.3-6 ]
&gt; 
&gt; As opensysusers is supposed to be a drop-in requirement for
&gt; systemd-sysusers it *must* behave as systemd does and not execute
&gt; data.
&gt; 
&gt; Ansgar
&gt; 

Attached is a patch that sets the GECOS field without using eval: under
the assumption that the double quote character is not valid for
Type,Name,ID field it should work. Did not have the time to test it yet.
If someone has a better idea I do welcome suggestion.

Lorenzo



--- ./sysusers  2020-12-22 12:41:37.754884910 +0100
+++ ./sysusers.new      2021-09-17 19:38:32.927974348 +0200 @@ -66,10
+66,30 @@ 
 parse_string() {
        [ -n &quot;${1%%#*}&quot; ] || return
+       full_line=$1
 
-       eval &quot;set -- $1&quot;
+       #eval &quot;set -- $1&quot; # do not eval, see #992058 and <a href="https://security-tracker.debian.org/tracker/CVE-2021-40084">CVE-2021-40084</a>
+       set -- $1
        type=&quot;$1&quot; name=&quot;$2&quot; id=&quot;$3&quot; gecos=&quot;$4&quot; home=&quot;$5&quot;
 
+       # and now set the GECOS field without eval
+       if [ &quot;${type}&quot; = u ]; then
+               if  [ ! -z &quot;$4&quot; ] &amp;&amp; [  &quot;$4&quot; != &#39;-&#39; ]; then
+                       # strip everything before the first &quot;
+                       gecosplus=${full_line#*\&quot;}
+                       # now strip everything after the last &quot;
+                       gecos=${gecosplus%\&quot;*}
+                       # check if there are other valid fields after
GECOS
+                       gecostest=$(echo $gecosplus | grep -o &#39;&quot;.*&#39; -)
+                       if [ &quot;$gecostest&quot; = &#39;&quot;&#39; ]; then
+                               home=
+                       else
+                               set -- $gecostest
+                               home=$2
+                       fi
+               fi
+       fi
+
        case &quot;${type}&quot; in
                [gu])
                        case &quot;${id}&quot; in 65535|4294967295) warninvalid;
return; esac




</pre>

<div class="msgreceived"><hr><p>
<a name="13"></a>
<!-- command:tag -->
<!-- requester: Lorenzo &lt;plorenzo@disroot.org&gt; -->
<!-- request_addr: 992058-submit@bugs.debian.org -->
<!-- time:1631900882 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;upstream security patch&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;security upstream&#39;
            };
-->
<strong>Added tag(s) patch.</strong>
Request was from <code>Lorenzo &lt;plorenzo@disroot.org&gt;</code>
to <code>992058-submit@bugs.debian.org</code>.
 (Fri, 17 Sep 2021 17:48:02 GMT) (<a href="bugreport.cgi?bug=992058;msg=14">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="15"></a>
<!-- request_addr: Lorenzo Puliti &lt;plorenzo@disroot.org&gt; -->
<!-- time:1632068465 -->
<strong>Reply sent</strong>
to <code>Lorenzo Puliti &lt;plorenzo@disroot.org&gt;</code>:<br>
You have taken responsibility.
 (Sun, 19 Sep 2021 16:21:05 GMT) (<a href="bugreport.cgi?bug=992058;msg=16">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=16">mbox</a>, <a href="#15">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="17"></a>
<!-- request_addr: Ansgar &lt;ansgar@debian.org&gt; -->
<!-- time:1632068466 -->
<strong>Notification sent</strong>
to <code>Ansgar &lt;ansgar@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
 (Sun, 19 Sep 2021 16:21:06 GMT) (<a href="bugreport.cgi?bug=992058;msg=18">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=18">mbox</a>, <a href="#17">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="19"></a><a name="msg19"></a><a href="#19">Message #19</a> received at 992058-close@bugs.debian.org (<a href="bugreport.cgi?bug=992058;msg=19">full text</a>, <a href="bugreport.cgi?bug=992058;mbox=yes;msg=19">mbox</a>, <a href="mailto:992058@bugs.debian.org?subject=Re%3A%20Bug%23992058%3A%20fixed%20in%20opensysusers%200.6-3&amp;In-Reply-To=%3CE1mRzWn-00045z-9J%40fasolo.debian.org%3E&amp;body=On%20Sun%2C%2019%20Sep%202021%2016%3A18%3A53%20%2B0000%20Debian%20FTP%20Masters%20%3Cftpmaster%40ftp-master.debian.org%3E%20wrote%3A%0A%3E%20Source%3A%20opensysusers%0A%3E%20Source-Version%3A%200.6-3%0A%3E%20Done%3A%20Lorenzo%20Puliti%20%3Cplorenzo%40disroot.org%3E%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20opensysusers%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20992058%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Lorenzo%20Puliti%20%3Cplorenzo%40disroot.org%3E%20%28supplier%20of%20updated%20opensysusers%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA512%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Sun%2C%2019%20Sep%202021%2002%3A49%3A09%20%2B0200%0A%3E%20Source%3A%20opensysusers%0A%3E%20Architecture%3A%20source%0A%3E%20Version%3A%200.6-3%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20medium%0A%3E%20Maintainer%3A%20Debian%20QA%20Group%20%3Cpackages%40qa.debian.org%3E%0A%3E%20Changed-By%3A%20Lorenzo%20Puliti%20%3Cplorenzo%40disroot.org%3E%0A%3E%20Closes%3A%20986015%20992058%0A%3E%20Changes%3A%0A%3E%20%20opensysusers%20%280.6-3%29%20unstable%3B%20urgency%3Dmedium%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20QA%20upload.%0A%3E%20%20%20%20%2A%20Update%20copyright%20years%0A%3E%20%20%20%20%2A%20Bump%20Standards-Version%20to%204.6.0%2C%20no%20changes%0A%3E%20%20%20%20%20%20%20required%0A%3E%20%20%20%20%2A%20Change%20section%20to%20admin%0A%3E%20%20%20%20%2A%20Update%20gitignore%20files%0A%3E%20%20%20%20%2A%20quilt%20patches%3A%0A%3E%20%20%20%20%20%20-%20Stop%20using%20eval%20%28Closes%3A%20%23992058%2C%20CVE-2021-40084%29%0A%3E%20%20%20%20%20%20-%20Create%20group%20with%20m%20action%20%28Closes%3A%20%23986015%29%0A%3E%20%20%20%20%20%20-%20Fix%20wrong%20nologin%20path%0A%3E%20Checksums-Sha1%3A%0A%3E%20%201c31877659537df8d23f93c4526353e8f45a762b%201931%20opensysusers_0.6-3.dsc%0A%3E%20%203594a72a28c5f21688eaa2e43c3a9eab7ef530e8%205092%20opensysusers_0.6-3.debian.tar.xz%0A%3E%20%201f7fdbca343b6284b48d1b0d8e319cdeb169b262%206449%20opensysusers_0.6-3_source.buildinfo%0A%3E%20Checksums-Sha256%3A%0A%3E%20%2029502aa14d77fcf34766fd3ff582ebce3d1c280d6a0f602ba36d5113e4539ca0%201931%20opensysusers_0.6-3.dsc%0A%3E%20%201167f40ebeea3d72ac93faaeb63755706c63aaffc68d187f86a172e1bfc8fd74%205092%20opensysusers_0.6-3.debian.tar.xz%0A%3E%20%2086b035e65932988c79c2da63619ab921004a3bf9e5e760eda0f2880b327a0954%206449%20opensysusers_0.6-3_source.buildinfo%0A%3E%20Files%3A%0A%3E%20%20fcbdc59f22dbe6a970362224d8990b8d%201931%20admin%20optional%20opensysusers_0.6-3.dsc%0A%3E%20%20aefdcbd74b2b6113c0b0a066be8933b2%205092%20admin%20optional%20opensysusers_0.6-3.debian.tar.xz%0A&amp;References=%3CE1mRzWn-00045z-9J%40fasolo.debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=ftpmaster%40ftp-master.debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Debian FTP Masters &lt;ftpmaster@ftp-master.debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 992058-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#992058: fixed in opensysusers 0.6-3</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 19 Sep 2021 16:18:53 +0000</div>
</div>
<pre class="message">Source: opensysusers
Source-Version: 0.6-3
Done: Lorenzo Puliti &lt;plorenzo@disroot.org&gt;

We believe that the bug you reported is fixed in the latest version of
opensysusers, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 992058@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Lorenzo Puliti &lt;plorenzo@disroot.org&gt; (supplier of updated opensysusers package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Sun, 19 Sep 2021 02:49:09 +0200
Source: opensysusers
Architecture: source
Version: 0.6-3
Distribution: unstable
Urgency: medium
Maintainer: Debian QA Group &lt;packages@qa.debian.org&gt;
Changed-By: Lorenzo Puliti &lt;plorenzo@disroot.org&gt;
Closes: <a href="bugreport.cgi?bug=986015">986015</a> <a href="bugreport.cgi?bug=992058">992058</a>
Changes:
 opensysusers (0.6-3) unstable; urgency=medium
 .
   * QA upload.
   * Update copyright years
   * Bump Standards-Version to 4.6.0, no changes
      required
   * Change section to admin
   * Update gitignore files
   * quilt patches:
     - Stop using eval (Closes: #<a href="bugreport.cgi?bug=992058">992058</a>, <a href="https://security-tracker.debian.org/tracker/CVE-2021-40084">CVE-2021-40084</a>)
     - Create group with m action (Closes: #<a href="bugreport.cgi?bug=986015">986015</a>)
     - Fix wrong nologin path
Checksums-Sha1:
 1c31877659537df8d23f93c4526353e8f45a762b 1931 opensysusers_0.6-3.dsc
 3594a72a28c5f21688eaa2e43c3a9eab7ef530e8 5092 opensysusers_0.6-3.debian.tar.xz
 1f7fdbca343b6284b48d1b0d8e319cdeb169b262 6449 opensysusers_0.6-3_source.buildinfo
Checksums-Sha256:
 29502aa14d77fcf34766fd3ff582ebce3d1c280d6a0f602ba36d5113e4539ca0 1931 opensysusers_0.6-3.dsc
 1167f40ebeea3d72ac93faaeb63755706c63aaffc68d187f86a172e1bfc8fd74 5092 opensysusers_0.6-3.debian.tar.xz
 86b035e65932988c79c2da63619ab921004a3bf9e5e760eda0f2880b327a0954 6449 opensysusers_0.6-3_source.buildinfo
Files:
 fcbdc59f22dbe6a970362224d8990b8d 1931 admin optional opensysusers_0.6-3.dsc
 aefdcbd74b2b6113c0b0a066be8933b2 5092 admin optional opensysusers_0.6-3.debian.tar.xz
 398f01bcafddb722d0bad318697db911 6449 admin optional opensysusers_0.6-3_source.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEkjZVexcMh/iCHArDweDZLphvfH4FAmFHYCsACgkQweDZLphv
fH6Z+BAAh3pURpggtPhiNDjfYz80i+NYMzKLyXQ1DrUOVHDCwlDeHwRPJmFgoaaM
yQvd/c626P8ICmRBhTR04EXwNOXU26EpbOiiMahpw8d4nm5S3eF1SBE/ptQ/AU2I
l9MSsVqpPBadnWQkRxVjhbBQ78u/c4CNhnGvbF1+/NDTlZTcAOuaf0FnLJFAl36m
BTbvYwU64ganLO5VciVVm/TD8KaNCyUqJ/mbJMOZLc6U9JCbb35TZEXPktcVfKAQ
+/wbPAH0Ht0xt4t2AMcIz46ek3wMb03Xz0PWHnmfMQOOnIzHSvtGWEA9ijyBvtFm
570PsDdTXEpqVPRK4pMzg+XqHu9ZqRgbQs6ymMFCQ8ouGVAuR+fcrRRDqv5By96+
7gfih6Hb72+Ulq9CMLrY1X+DDeDETKxhIjzVMofQcaOc8eGfoSryih7RlvxjBOA5
dZguBuqGTlOP+91WtFRx63HNmZS1kMT+JKB6yJn0yYnoAOxL+0N7Bhu+8fUV/0L5
s7p6jhrEaaDWwG6eEE+QFrtc1AUO8YWUkOo6g5I3pv1ONJclyUt6N2Qz5Eu4r5nv
/J7+HdzFBWabhYLs9zgemr5wODONVI3weQVWYzPnRbG3fEugevGLKlVIvRiEvqz1
Mvps+gjelHzzQrR8qzgNzFlGOnuOnlW5OgYoaP20LGxCiq8whAg=
=MRO9
-----END PGP SIGNATURE-----



</pre>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=992058">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:22:24 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
