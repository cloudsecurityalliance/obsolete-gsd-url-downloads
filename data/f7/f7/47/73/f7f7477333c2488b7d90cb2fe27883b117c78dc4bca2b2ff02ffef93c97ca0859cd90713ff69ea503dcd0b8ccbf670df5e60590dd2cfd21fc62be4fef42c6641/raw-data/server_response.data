<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#854723 - diffoscope: CVE-2017-0359: writes to arbitrary locations on disk based on the contents of an untrusted archive - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=854723&quot;&gt;854723&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:854723@bugs.debian.org">#854723</a><br>
diffoscope: CVE-2017-0359: writes to arbitrary locations on disk based on the contents of an untrusted archive</h1>
<div class="versiongraph"><a href="version.cgi?found=diffoscope%2F67;package=diffoscope;fixed=diffoscope%2F77;collapse=1;absolute=0;info=1"><img alt="version graph" src="version.cgi?collapse=1;height=2;fixed=diffoscope%2F77;absolute=0;width=2;package=diffoscope;found=diffoscope%2F67"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=diffoscope">diffoscope</a>;
Maintainer for <a href="pkgreport.cgi?package=diffoscope">diffoscope</a> is <a href="pkgreport.cgi?maint=reproducible-builds%40lists.alioth.debian.org">Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=diffoscope">diffoscope</a> is <a href="pkgreport.cgi?src=diffoscope">src:diffoscope</a> (<a href="https://tracker.debian.org/pkg/diffoscope">PTS</a>, <a href="https://buildd.debian.org/diffoscope">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=diffoscope">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=infinity0%40debian.org">Ximin Luo &lt;infinity0@debian.org&gt;</a></p>
  <p>Date: Thu,  9 Feb 2017 21:18:02 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: patch, security</p>

<p>Found in version diffoscope/67</p>
<p>Fixed in version diffoscope/77</p>

<p><strong>Done:</strong> Mattia Rizzolo &lt;mattia@debian.org&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=854723;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, team@security.debian.org, secure-testing-team@lists.alioth.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486675084 -->
<strong>Report forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, team@security.debian.org, secure-testing-team@lists.alioth.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Thu, 09 Feb 2017 21:18:04 GMT) (<a href="bugreport.cgi?bug=854723;msg=2">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<!-- request_addr: Ximin Luo &lt;infinity0@debian.org&gt; -->
<!-- time:1486675084 -->
<strong>Acknowledgement sent</strong>
to <code>Ximin Luo &lt;infinity0@debian.org&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>team@security.debian.org, secure-testing-team@lists.alioth.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Feb 2017 21:18:04 GMT) (<a href="bugreport.cgi?bug=854723;msg=4">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=5">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=5">mbox</a>, <a href="mailto:854723@bugs.debian.org?References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E&amp;In-Reply-To=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E&amp;body=On%20Thu%2C%2009%20Feb%202017%2022%3A14%3A12%20%2B0100%20Ximin%20Luo%20%3Cinfinity0%40debian.org%3E%20wrote%3A%0A%3E%20Package%3A%20diffoscope%0A%3E%20Version%3A%2067%0A%3E%20Severity%3A%20grave%0A%3E%20Tags%3A%20patch%20security%0A%3E%20Justification%3A%20user%20security%20hole%0A%3E%20%0A%3E%20Dear%20Maintainer%2C%0A%3E%20%0A%3E%205fdfe91e71f1c520d902350b18f793b8c69d9118%20introduced%20a%20security%20hole%20where%0A%3E%20diffoscope%20may%20write%20to%20arbitrary%20locations%20on%20disk%20depending%20on%20the%20contents%0A%3E%20of%20an%20untrusted%20archive.%20For%20example%2C%20comparing%20the%20following%20two%20files%3A%0A%3E%20%0A%3E%20https%3A%2F%2Fbugs.debian.org%2Fcgi-bin%2Fbugreport.cgi%3Fatt%3D1%3Bbug%3D843811%3Bfilename%3DlibBrokenLocale.a.0%3Bmsg%3D5%0A%3E%20https%3A%2F%2Fbugs.debian.org%2Fcgi-bin%2Fbugreport.cgi%3Fatt%3D2%3Bbug%3D843811%3Bfilename%3DlibBrokenLocale.a.1%3Bmsg%3D5%0A%3E%20%0A%3E%20Traceback%20%28most%20recent%20call%20last%29%3A%0A%3E%20%20%20File%20%22%2Fhome%2Finfinity0%2Fxx%2Fdiffoscope%2Fdiffoscope%2Fmain.py%22%2C%20line%20281%2C%20in%20main%0A%3E%20%20%20%20%20sys.exit%28run_diffoscope%28parsed_args%29%29%0A%3E%20%5B..%5D%0A%3E%20%20%20File%20%22%2Fhome%2Finfinity0%2Fxx%2Fdiffoscope%2Fdiffoscope%2Fcomparators%2Futils%2Flibarchive.py%22%2C%20line%20174%2C%20in%20extract%0A%3E%20%20%20%20%20self.ensure_unpacked%28%29%0A%3E%20%20%20File%20%22%2Fhome%2Finfinity0%2Fxx%2Fdiffoscope%2Fdiffoscope%2Fcomparators%2Futils%2Flibarchive.py%22%2C%20line%20219%2C%20in%20ensure_unpacked%0A%3E%20%20%20%20%20os.makedirs%28os.path.dirname%28dst%29%2C%20exist_ok%3DTrue%29%0A%3E%20%20%20File%20%22%2Fusr%2Flib%2Fpython3.5%2Fos.py%22%2C%20line%20241%2C%20in%20makedirs%0A%3E%20%20%20%20%20mkdir%28name%2C%20mode%29%0A%3E%20PermissionError%3A%20%5BErrno%2013%5D%20Permission%20denied%3A%20%27%2FSYM64%27%0A%3E%20%0A%3E%20Note%20that%20this%20could%20easily%20have%20been%20something%20like%20%2Fhome%2Finfinity0%2F.profile.%0A%3E%20%0A%3E%20I%20have%20pushed%20a%20nearly-complete%20fix%20to%20git%20%28after%20version%2075%20was%20just%20released%29%0A%3E%20which%20prevents%20the%20writes.%20However%20reads%20are%20still%20done%20using%20the%20uncleaned%0A%3E%20names%2C%20but%20this%20is%20a%20much%20less%20severe%20issue.%20So%2C%20if%20I%20don%27t%20supply%20a%20fix%20for%0A%3E%20the%20second%20lesser%20issue%20soon%2C%20the%20existing%20fix%20should%20be%20released%20ASAP.%0A%3E%20%0A%3E%20X%0A%3E%20%0A%3E%20--%20System%20Information%3A%0A%3E%20Debian%20Release%3A%209.0%0A%3E%20%20%20APT%20prefers%20testing%0A%3E%20%20%20APT%20policy%3A%20%28990%2C%20%27testing%27%29%2C%20%28500%2C%20%27unstable-debug%27%29%2C%20%28500%2C%20%27testing-debug%27%29%2C%20%28300%2C%20%27unstable%27%29%2C%20%28200%2C%20%27experimental%27%29%2C%20%281%2C%20%27experimental-debug%27%29%0A%3E%20Architecture%3A%20amd64%20%28x86_64%29%0A%3E%20Foreign%20Architectures%3A%20i386%0A%3E%20%0A%3E%20Kernel%3A%20Linux%204.8.0-2-amd64%20%28SMP%20w%2F4%20CPU%20cores%29%0A%3E%20Locale%3A%20LANG%3Den_GB.utf8%2C%20LC_CTYPE%3Den_GB.utf8%20%28charmap%3DUTF-8%29%0A%3E%20Shell%3A%20%2Fbin%2Fsh%20linked%20to%20%2Fbin%2Fdash%0A%3E%20Init%3A%20systemd%20%28via%20%2Frun%2Fsystemd%2Fsystem%29%0A%3E%20%0A%3E%20Versions%20of%20packages%20diffoscope%20depends%20on%3A%0A%3E%20ii%20%20python3-libarchive-c%20%20%202.1-3.1%0A%3E%20ii%20%20python3-magic%20%20%20%20%20%20%20%20%20%201%3A5.29-3%0A%3E%20ii%20%20python3-pkg-resources%20%2033.1.1-1%0A%3E%20pn%20%20python3%3Aany%20%20%20%20%20%20%20%20%20%20%20%20%3Cnone%3E%0A%3E%20%0A%3E%20Versions%20of%20packages%20diffoscope%20recommends%3A%0A%3E%20ii%20%20acl%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.2.52-3%0A%3E%20ii%20%20apktool%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.2.1%2Bdfsg-2%0A%3E%20ii%20%20binutils-multiarch%20%20%20%20%20%20%20%20%202.27.90.20170124-2%0A%3E%20ii%20%20bzip2%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201.0.6-8.1%0A%3E%20ii%20%20caca-utils%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%200.99.beta19-2%2Bb1%0A&amp;subject=Re%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%20based%20on%20the%20contents%20of%20an%20untrusted%20archive">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=infinity0%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Ximin Luo &lt;infinity0@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> diffoscope writes to arbitrary locations on disk based on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 09 Feb 2017 22:14:12 +0100</div>
</div>
<pre class="message">Package: diffoscope
Version: 67
Severity: grave
Tags: patch security
Justification: user security hole

Dear Maintainer,

5fdfe91e71f1c520d902350b18f793b8c69d9118 introduced a security hole where
diffoscope may write to arbitrary locations on disk depending on the contents
of an untrusted archive. For example, comparing the following two files:

<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=843811;filename=libBrokenLocale.a.0;msg=5">https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=843811;filename=libBrokenLocale.a.0;msg=5</a>
<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?att=2;bug=843811;filename=libBrokenLocale.a.1;msg=5">https://bugs.debian.org/cgi-bin/bugreport.cgi?att=2;bug=843811;filename=libBrokenLocale.a.1;msg=5</a>

Traceback (most recent call last):
  File &quot;/home/infinity0/xx/diffoscope/diffoscope/main.py&quot;, line 281, in main
    sys.exit(run_diffoscope(parsed_args))
[..]
  File &quot;/home/infinity0/xx/diffoscope/diffoscope/comparators/utils/libarchive.py&quot;, line 174, in extract
    self.ensure_unpacked()
  File &quot;/home/infinity0/xx/diffoscope/diffoscope/comparators/utils/libarchive.py&quot;, line 219, in ensure_unpacked
    os.makedirs(os.path.dirname(dst), exist_ok=True)
  File &quot;/usr/lib/python3.5/os.py&quot;, line 241, in makedirs
    mkdir(name, mode)
PermissionError: [Errno 13] Permission denied: &#39;/SYM64&#39;

Note that this could easily have been something like /home/infinity0/.profile.

I have pushed a nearly-complete fix to git (after version 75 was just released)
which prevents the writes. However reads are still done using the uncleaned
names, but this is a much less severe issue. So, if I don&#39;t supply a fix for
the second lesser issue soon, the existing fix should be released ASAP.

X

-- System Information:
Debian Release: 9.0
  APT prefers testing
  APT policy: (990, &#39;testing&#39;), (500, &#39;unstable-debug&#39;), (500, &#39;testing-debug&#39;), (300, &#39;unstable&#39;), (200, &#39;experimental&#39;), (1, &#39;experimental-debug&#39;)
Architecture: amd64 (x86_64)
Foreign Architectures: i386

Kernel: Linux 4.8.0-2-amd64 (SMP w/4 CPU cores)
Locale: LANG=en_GB.utf8, LC_CTYPE=en_GB.utf8 (charmap=UTF-8)
Shell: /bin/sh linked to /bin/dash
Init: systemd (via /run/systemd/system)

Versions of packages diffoscope depends on:
ii  python3-libarchive-c   2.1-3.1
ii  python3-magic          1:5.29-3
ii  python3-pkg-resources  33.1.1-1
pn  python3:any            &lt;none&gt;

Versions of packages diffoscope recommends:
ii  acl                        2.2.52-3
ii  apktool                    2.2.1+dfsg-2
ii  binutils-multiarch         2.27.90.20170124-2
ii  bzip2                      1.0.6-8.1
ii  caca-utils                 0.99.beta19-2+b1
ii  colord                     1.3.3-2
ii  cpio                       2.11+dfsg-6
ii  default-jdk [java-sdk]     2:1.8-58
ii  default-jdk-headless       2:1.8-58
ii  enjarify                   1:1.0.3-3
ii  fontforge-extras           0.3-4
ii  fp-utils                   3.0.0+dfsg-10
ii  fp-utils-3.0.0 [fp-utils]  3.0.0+dfsg-10
ii  genisoimage                9:1.1.11-3
ii  gettext                    0.19.8.1-2
ii  ghc                        8.0.1-17
ii  ghostscript                9.20~dfsg-2
ii  gnupg                      2.1.18-3
ii  jsbeautifier               1.6.4-6
ii  llvm                       1:3.8-34+b1
ii  mono-utils                 4.6.2.7+dfsg-1
ii  openjdk-8-jdk [java-sdk]   8u121-b13-2
ii  openssh-client             1:7.4p1-6
ii  pdftk                      2.02-4+b1
ii  poppler-utils              0.48.0-2
ii  python3-argcomplete        1.8.1-1
ii  python3-debian             0.1.30
ii  python3-guestfs            1:1.34.3-7
ii  python3-progressbar        2.3-4
ii  python3-rpm                4.12.0.2+dfsg1-1
ii  python3-tlsh               3.4.4+20151206-1+b1
ii  rpm2cpio                   4.12.0.2+dfsg1-1
ii  sng                        1.1.0-1+b1
ii  sqlite3                    3.16.2-2
ii  squashfs-tools             1:4.3-3
ii  unzip                      6.0-21
ii  vim-common                 2:8.0.0197-1
ii  xxd                        2:8.0.0197-1
ii  xz-utils                   5.2.2-1.2

Versions of packages diffoscope suggests:
ii  libjs-jquery  3.1.1-2

-- no debconf information


</pre>

<div class="infmessage"><hr><p>
<a name="6"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486678144 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Thu, 09 Feb 2017 22:09:04 GMT) (<a href="bugreport.cgi?bug=854723;msg=7">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<!-- request_addr: Chris Lamb &lt;lamby@debian.org&gt; -->
<!-- time:1486678145 -->
<strong>Acknowledgement sent</strong>
to <code>Chris Lamb &lt;lamby@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Feb 2017 22:09:05 GMT) (<a href="bugreport.cgi?bug=854723;msg=9">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="10"></a><a name="msg10"></a><a href="#10">Message #10</a> received at 854723@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=10">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=10">mbox</a>, <a href="mailto:854723@bugs.debian.org?References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E%0A%20%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E&amp;In-Reply-To=%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E&amp;subject=Re%3A%20Bug%23854723%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%20based%0A%20on%20the%20contents%20of%20an%20untrusted%20archive&amp;body=On%20Fri%2C%2010%20Feb%202017%2011%3A07%3A22%20%2B1300%20Chris%20Lamb%20%3Clamby%40debian.org%3E%20wrote%3A%0A%3E%20tags%20854723%20%2B%20pending%0A%3E%20thanks%0A%3E%20%0A%3E%20%3E%20diffoscope%20may%20write%20to%20arbitrary%20locations%20on%20disk%20depending%20on%20the%20contents%0A%3E%20%3E%20of%20an%20untrusted%20archive%0A%3E%20%0A%3E%20We%20can%20actually%20avoid%20all%20edge-cases%20of%20sanitisation%20by%20simply%20not%20using%0A%3E%20the%20supplied%20filename%20and%20maintaining%20our%20own%20mapping.%0A%3E%20%0A%3E%20Given%20this%20is%20both%20safer%20%28and%20has%20far%20less%20code%29%20I%27ve%20gone%20ahead%20and%20committed%0A%3E%20that%20here%3A%0A%3E%20%0A%3E%20%20%20https%3A%2F%2Fanonscm.debian.org%2Fgit%2Freproducible%2Fdiffoscope.git%2Fcommit%2F%3Fid%3D632a40828a54b399787c25e7fa243f732aef7e05%0A%3E%20%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20%0A%3E%20--%20%0A%3E%20%20%20%20%20%20%20%2C%27%27%60.%0A%3E%20%20%20%20%20%20%3A%20%3A%27%20%20%3A%20%20%20%20%20Chris%20Lamb%0A%3E%20%20%20%20%20%20%60.%20%60%27%60%20%20%20%20%20%20lamby%40debian.org%20%2F%20chris-lamb.co.uk%0A%3E%20%20%20%20%20%20%20%20%60-%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=lamby%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Chris Lamb &lt;lamby@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 854723@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#854723: diffoscope writes to arbitrary locations on disk based
 on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 10 Feb 2017 11:07:22 +1300</div>
</div>
<pre class="message">tags 854723 + pending
thanks

&gt; diffoscope may write to arbitrary locations on disk depending on the contents
&gt; of an untrusted archive

We can actually avoid all edge-cases of sanitisation by simply not using
the supplied filename and maintaining our own mapping.

Given this is both safer (and has far less code) I&#39;ve gone ahead and committed
that here:

  <a href="https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05">https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05</a>


Regards,

-- 
      ,&#39;&#39;`.
     : :&#39;  :     Chris Lamb
     `. `&#39;`      lamby@debian.org / chris-lamb.co.uk
       `-


</pre>

<div class="msgreceived"><hr><p>
<a name="11"></a>
<!-- command:tag -->
<!-- requester: Chris Lamb &lt;lamby@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1486678146 -->
<!-- new_data:
$new_data = {
              &#39;keywords&#39; =&gt; &#39;security patch pending&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;keywords&#39; =&gt; &#39;patch security&#39;
            };
-->
<strong>Added tag(s) pending.</strong>
Request was from <code>Chris Lamb &lt;lamby@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Thu, 09 Feb 2017 22:09:06 GMT) (<a href="bugreport.cgi?bug=854723;msg=12">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="13"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486681931 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Thu, 09 Feb 2017 23:12:11 GMT) (<a href="bugreport.cgi?bug=854723;msg=14">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="15"></a>
<!-- request_addr: Ximin Luo &lt;infinity0@debian.org&gt; -->
<!-- time:1486681931 -->
<strong>Acknowledgement sent</strong>
to <code>Ximin Luo &lt;infinity0@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Feb 2017 23:12:11 GMT) (<a href="bugreport.cgi?bug=854723;msg=16">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=16">mbox</a>, <a href="#15">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="17"></a><a name="msg17"></a><a href="#17">Message #17</a> received at 854723@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=17">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=17">mbox</a>, <a href="mailto:854723@bugs.debian.org?body=On%20Thu%2C%2009%20Feb%202017%2023%3A10%3A00%20%2B0000%20Ximin%20Luo%20%3Cinfinity0%40debian.org%3E%20wrote%3A%0A%3E%20Chris%20Lamb%3A%0A%3E%20%3E%20tags%20854723%20%2B%20pending%0A%3E%20%3E%20thanks%0A%3E%20%3E%20%0A%3E%20%3E%3E%20diffoscope%20may%20write%20to%20arbitrary%20locations%20on%20disk%20depending%20on%20the%20contents%0A%3E%20%3E%3E%20of%20an%20untrusted%20archive%0A%3E%20%3E%20%0A%3E%20%3E%20We%20can%20actually%20avoid%20all%20edge-cases%20of%20sanitisation%20by%20simply%20not%20using%0A%3E%20%3E%20the%20supplied%20filename%20and%20maintaining%20our%20own%20mapping.%0A%3E%20%3E%20%0A%3E%20%3E%20Given%20this%20is%20both%20safer%20%28and%20has%20far%20less%20code%29%20I%27ve%20gone%20ahead%20and%20committed%0A%3E%20%3E%20that%20here%3A%0A%3E%20%3E%20%0A%3E%20%3E%20%20%20https%3A%2F%2Fanonscm.debian.org%2Fgit%2Freproducible%2Fdiffoscope.git%2Fcommit%2F%3Fid%3D632a40828a54b399787c25e7fa243f732aef7e05%0A%3E%20%3E%20%0A%3E%20%0A%3E%20Thanks%2C%20this%20is%20better.%0A%3E%20%0A%3E%20However%20this%20particular%20scheme%20might%20not%20work%20so%20well%20with%20large%20archives%20with%20lots%20and%20lots%20of%20members%20%28%3Emany%20thousands%29%2C%20depending%20on%20what%20filesystem%20the%20tempdir%20contained%20in.%20I%27d%20suggest%20to%20use%20names%20like%20%24x%2F%24y%20where%20%24x%20%3D%20idx%20%2F%2F%204096%2C%20%24y%20%3D%20idx%20%25%204096.%0A%3E%20%0A%3E%20X%0A%3E%20%0A%3E%20--%20%0A%3E%20GPG%3A%20ed25519%2F56034877E1F87C35%0A%3E%20GPG%3A%20rsa4096%2F1318EFAC5FBBDBCE%0A%3E%20https%3A%2F%2Fgithub.com%2Finfinity0%2Fpubkeys.git%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23854723%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%0A%20based%20on%20the%20contents%20of%20an%20untrusted%20archive&amp;In-Reply-To=%3Cbf3d4393-5a98-9188-e664-333011ef8fac%40debian.org%3E&amp;References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E%0A%20%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E%0A%20%3Cbf3d4393-5a98-9188-e664-333011ef8fac%40debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=infinity0%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Ximin Luo &lt;infinity0@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Chris Lamb &lt;lamby@debian.org&gt;, 854723@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#854723: diffoscope writes to arbitrary locations on disk
 based on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 09 Feb 2017 23:10:00 +0000</div>
</div>
<pre class="message">Chris Lamb:
&gt; tags 854723 + pending
&gt; thanks
&gt; 
&gt;&gt; diffoscope may write to arbitrary locations on disk depending on the contents
&gt;&gt; of an untrusted archive
&gt; 
&gt; We can actually avoid all edge-cases of sanitisation by simply not using
&gt; the supplied filename and maintaining our own mapping.
&gt; 
&gt; Given this is both safer (and has far less code) I&#39;ve gone ahead and committed
&gt; that here:
&gt; 
&gt;   <a href="https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05">https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05</a>
&gt; 

Thanks, this is better.

However this particular scheme might not work so well with large archives with lots and lots of members (&gt;many thousands), depending on what filesystem the tempdir contained in. I&#39;d suggest to use names like $x/$y where $x = idx // 4096, $y = idx % 4096.

X

-- 
GPG: ed25519/56034877E1F87C35
GPG: rsa4096/1318EFAC5FBBDBCE
<a href="https://github.com/infinity0/pubkeys.git">https://github.com/infinity0/pubkeys.git</a>


</pre>

<div class="infmessage"><hr><p>
<a name="18"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486682116 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Thu, 09 Feb 2017 23:15:16 GMT) (<a href="bugreport.cgi?bug=854723;msg=19">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="20"></a>
<!-- request_addr: Ximin Luo &lt;infinity0@debian.org&gt;, 854723@bugs.debian.org -->
<!-- time:1486682116 -->
<strong>Acknowledgement sent</strong>
to <code>Ximin Luo &lt;infinity0@debian.org&gt;, 854723@bugs.debian.org</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Feb 2017 23:15:16 GMT) (<a href="bugreport.cgi?bug=854723;msg=21">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="22"></a><a name="msg22"></a><a href="#22">Message #22</a> received at 854723@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=22">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=22">mbox</a>, <a href="mailto:854723@bugs.debian.org?In-Reply-To=%3C5ed6ecab-e115-dac2-d472-2789f84ca000%40debian.org%3E&amp;References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E%0A%20%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E%0A%20%3Cbf3d4393-5a98-9188-e664-333011ef8fac%40debian.org%3E%0A%20%3C5ed6ecab-e115-dac2-d472-2789f84ca000%40debian.org%3E&amp;subject=Re%3A%20Bug%23854723%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%0A%20based%20on%20the%20contents%20of%20an%20untrusted%20archive&amp;body=On%20Thu%2C%2009%20Feb%202017%2023%3A14%3A00%20%2B0000%20Ximin%20Luo%20%3Cinfinity0%40debian.org%3E%20wrote%3A%0A%3E%20Ximin%20Luo%3A%0A%3E%20%3E%20Chris%20Lamb%3A%0A%3E%20%3E%3E%20tags%20854723%20%2B%20pending%0A%3E%20%3E%3E%20thanks%0A%3E%20%3E%3E%0A%3E%20%3E%3E%3E%20diffoscope%20may%20write%20to%20arbitrary%20locations%20on%20disk%20depending%20on%20the%20contents%0A%3E%20%3E%3E%3E%20of%20an%20untrusted%20archive%0A%3E%20%3E%3E%0A%3E%20%3E%3E%20We%20can%20actually%20avoid%20all%20edge-cases%20of%20sanitisation%20by%20simply%20not%20using%0A%3E%20%3E%3E%20the%20supplied%20filename%20and%20maintaining%20our%20own%20mapping.%0A%3E%20%3E%3E%0A%3E%20%3E%3E%20Given%20this%20is%20both%20safer%20%28and%20has%20far%20less%20code%29%20I%27ve%20gone%20ahead%20and%20committed%0A%3E%20%3E%3E%20that%20here%3A%0A%3E%20%3E%3E%0A%3E%20%3E%3E%20%20%20https%3A%2F%2Fanonscm.debian.org%2Fgit%2Freproducible%2Fdiffoscope.git%2Fcommit%2F%3Fid%3D632a40828a54b399787c25e7fa243f732aef7e05%0A%3E%20%3E%3E%0A%3E%20%3E%20%0A%3E%20%3E%20Thanks%2C%20this%20is%20better.%0A%3E%20%3E%20%0A%3E%20%3E%20However%20this%20particular%20scheme%20might%20not%20work%20so%20well%20with%20large%20archives%20with%20lots%20and%20lots%20of%20members%20%28%3Emany%20thousands%29%2C%20depending%20on%20what%20filesystem%20the%20tempdir%20contained%20in.%20I%27d%20suggest%20to%20use%20names%20like%20%24x%2F%24y%20where%20%24x%20%3D%20idx%20%2F%2F%204096%2C%20%24y%20%3D%20idx%20%25%204096.%0A%3E%20%3E%20%0A%3E%20%0A%3E%20Also%2C%20are%20you%20sure%20this%20doesn%27t%20interfere%20with%20the%20detection%20of%20order-only%20differences%2C%20or%20the%20ability%20to%20match%20up%20similar-member-names%3F%0A%3E%20%0A%3E%20X%0A%3E%20%0A%3E%20--%20%0A%3E%20GPG%3A%20ed25519%2F56034877E1F87C35%0A%3E%20GPG%3A%20rsa4096%2F1318EFAC5FBBDBCE%0A%3E%20https%3A%2F%2Fgithub.com%2Finfinity0%2Fpubkeys.git%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=infinity0%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Ximin Luo &lt;infinity0@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Chris Lamb &lt;lamby@debian.org&gt;, 854723@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#854723: diffoscope writes to arbitrary locations on disk
 based on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 09 Feb 2017 23:14:00 +0000</div>
</div>
<pre class="message">Ximin Luo:
&gt; Chris Lamb:
&gt;&gt; tags 854723 + pending
&gt;&gt; thanks
&gt;&gt;
&gt;&gt;&gt; diffoscope may write to arbitrary locations on disk depending on the contents
&gt;&gt;&gt; of an untrusted archive
&gt;&gt;
&gt;&gt; We can actually avoid all edge-cases of sanitisation by simply not using
&gt;&gt; the supplied filename and maintaining our own mapping.
&gt;&gt;
&gt;&gt; Given this is both safer (and has far less code) I&#39;ve gone ahead and committed
&gt;&gt; that here:
&gt;&gt;
&gt;&gt;   <a href="https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05">https://anonscm.debian.org/git/reproducible/diffoscope.git/commit/?id=632a40828a54b399787c25e7fa243f732aef7e05</a>
&gt;&gt;
&gt; 
&gt; Thanks, this is better.
&gt; 
&gt; However this particular scheme might not work so well with large archives with lots and lots of members (&gt;many thousands), depending on what filesystem the tempdir contained in. I&#39;d suggest to use names like $x/$y where $x = idx // 4096, $y = idx % 4096.
&gt; 

Also, are you sure this doesn&#39;t interfere with the detection of order-only differences, or the ability to match up similar-member-names?

X

-- 
GPG: ed25519/56034877E1F87C35
GPG: rsa4096/1318EFAC5FBBDBCE
<a href="https://github.com/infinity0/pubkeys.git">https://github.com/infinity0/pubkeys.git</a>


</pre>

<div class="infmessage"><hr><p>
<a name="23"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486682463 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Thu, 09 Feb 2017 23:21:03 GMT) (<a href="bugreport.cgi?bug=854723;msg=24">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=24">mbox</a>, <a href="#23">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="25"></a>
<!-- request_addr: Chris Lamb &lt;lamby@debian.org&gt; -->
<!-- time:1486682463 -->
<strong>Acknowledgement sent</strong>
to <code>Chris Lamb &lt;lamby@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Thu, 09 Feb 2017 23:21:03 GMT) (<a href="bugreport.cgi?bug=854723;msg=26">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="27"></a><a name="msg27"></a><a href="#27">Message #27</a> received at 854723@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=27">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=27">mbox</a>, <a href="mailto:854723@bugs.debian.org?body=On%20Fri%2C%2010%20Feb%202017%2012%3A20%3A22%20%2B1300%20Chris%20Lamb%20%3Clamby%40debian.org%3E%20wrote%3A%0A%3E%20Ximin%20Luo%20wrote%3A%0A%3E%20%0A%3E%20%3E%20this%20particular%20scheme%20might%20not%20work%20so%20well%20with%20large%20archives%0A%3E%20%3E%20with%20lots%20and%20lots%20of%20members%0A%3E%20%0A%3E%20Mm%20although%20unlikely%20to%20be%20a%20serious%20problem%20as%20we%20aren%27t%20iterating%0A%3E%20over%20the%20directory.%20%0A%3E%20%0A%3E%20%3E%20Also%2C%20are%20you%20sure%20this%20doesn%27t%20interfere%20with%20the%20detection%20of%0A%3E%20%3E%20order-only%20differences%2C%20or%20the%20ability%20to%20match%20up%0A%3E%20%3E%20similar-member-names%3F%0A%3E%20%0A%3E%20We%20still%20use%20the%20archive%27s%20member%20name%20throughout%20diffoscope%3B%20the%0A%3E%20unpacked%20path%20shouldn%27t%20leak%20outside%20of%20that%20comparator.%20Also%2C%20the%0A%3E%20tests%20pass%E2%80%A6%20%2Ag%2A%0A%3E%20%0A%3E%20%0A%3E%20Regards%2C%0A%3E%20%0A%3E%20--%20%0A%3E%20%20%20%20%20%20%20%2C%27%27%60.%0A%3E%20%20%20%20%20%20%3A%20%3A%27%20%20%3A%20%20%20%20%20Chris%20Lamb%0A%3E%20%20%20%20%20%20%60.%20%60%27%60%20%20%20%20%20%20lamby%40debian.org%20%2F%20chris-lamb.co.uk%0A%3E%20%20%20%20%20%20%20%20%60-%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23854723%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%20based%0A%20on%20the%20contents%20of%20an%20untrusted%20archive&amp;References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E%0A%20%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E%0A%20%3Cbf3d4393-5a98-9188-e664-333011ef8fac%40debian.org%3E%0A%20%3C1486682422.1614997.876225776.2D3D3B03%40webmail.messagingengine.com%3E&amp;In-Reply-To=%3C1486682422.1614997.876225776.2D3D3B03%40webmail.messagingengine.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=lamby%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Chris Lamb &lt;lamby@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Ximin Luo &lt;infinity0@debian.org&gt;, 854723@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#854723: diffoscope writes to arbitrary locations on disk based
 on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 10 Feb 2017 12:20:22 +1300</div>
</div>
<pre class="message">Ximin Luo wrote:

&gt; this particular scheme might not work so well with large archives
&gt; with lots and lots of members

Mm although unlikely to be a serious problem as we aren&#39;t iterating
over the directory. 

&gt; Also, are you sure this doesn&#39;t interfere with the detection of
&gt; order-only differences, or the ability to match up
&gt; similar-member-names?

We still use the archive&#39;s member name throughout diffoscope; the
unpacked path shouldn&#39;t leak outside of that comparator. Also, the
tests pass… *g*


Regards,

-- 
      ,&#39;&#39;`.
     : :&#39;  :     Chris Lamb
     `. `&#39;`      lamby@debian.org / chris-lamb.co.uk
       `-


</pre>

<div class="infmessage"><hr><p>
<a name="28"></a>
<!-- request_addr: debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt; -->
<!-- time:1486813683 -->
<strong>Information forwarded</strong>
to <code>debian-bugs-dist@lists.debian.org, Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>:<br>
<code>Bug#854723</code>; Package <code>diffoscope</code>.
 (Sat, 11 Feb 2017 11:48:03 GMT) (<a href="bugreport.cgi?bug=854723;msg=29">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=29">mbox</a>, <a href="#28">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="30"></a>
<!-- request_addr: Moritz Mühlenhoff &lt;jmm@inutil.org&gt; -->
<!-- time:1486813683 -->
<strong>Acknowledgement sent</strong>
to <code>Moritz Mühlenhoff &lt;jmm@inutil.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;</code>.
 (Sat, 11 Feb 2017 11:48:03 GMT) (<a href="bugreport.cgi?bug=854723;msg=31">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="32"></a><a name="msg32"></a><a href="#32">Message #32</a> received at 854723@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=32">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=32">mbox</a>, <a href="mailto:854723@bugs.debian.org?References=%3C148667485295.20802.3908523993453470831.reportbug%40localhost.localdomain%3E%0A%20%3C1486678042.1599744.876162400.4182963C%40webmail.messagingengine.com%3E%0A%20%3C20170211114544.gv2anqd75ly6ij2h%40pisco.westfalen.local%3E&amp;In-Reply-To=%3C20170211114544.gv2anqd75ly6ij2h%40pisco.westfalen.local%3E&amp;body=On%20Sat%2C%2011%20Feb%202017%2012%3A45%3A44%20%2B0100%20%3D%3FUTF-8%3FQ%3FMoritz_M%3DC3%3DBChlenhoff%3F%3D%20%3Cjmm%40inutil.org%3E%20wrote%3A%0A%3E%20On%20Fri%2C%20Feb%2010%2C%202017%20at%2011%3A07%3A22AM%20%2B1300%2C%20Chris%20Lamb%20wrote%3A%0A%3E%20%3E%20tags%20854723%20%2B%20pending%0A%3E%20%3E%20thanks%0A%3E%20%3E%20%0A%3E%20%3E%20%3E%20diffoscope%20may%20write%20to%20arbitrary%20locations%20on%20disk%20depending%20on%20the%20contents%0A%3E%20%3E%20%3E%20of%20an%20untrusted%20archive%0A%3E%20%0A%3E%20Please%20use%20CVE-2017-0359%0A%3E%20%0A%3E%20Cheers%2C%0A%3E%20%20%20%20%20%20%20%20%20Moritz%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23854723%3A%20diffoscope%20writes%20to%20arbitrary%20locations%20on%20disk%0A%20based%20on%20the%20contents%20of%20an%20untrusted%20archive">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jmm%40inutil.org" alt="">
<div class="header"><span class="headerfield">From:</span> Moritz Mühlenhoff &lt;jmm@inutil.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Chris Lamb &lt;lamby@debian.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 854723@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#854723: diffoscope writes to arbitrary locations on disk
 based on the contents of an untrusted archive</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 11 Feb 2017 12:45:44 +0100</div>
</div>
<pre class="message">On Fri, Feb 10, 2017 at 11:07:22AM +1300, Chris Lamb wrote:
&gt; tags 854723 + pending
&gt; thanks
&gt; 
&gt; &gt; diffoscope may write to arbitrary locations on disk depending on the contents
&gt; &gt; of an untrusted archive

Please use <a href="https://security-tracker.debian.org/tracker/CVE-2017-0359">CVE-2017-0359</a>

Cheers,
        Moritz


</pre>

<div class="msgreceived"><hr><p>
<a name="33"></a>
<!-- command:title -->
<!-- requester: Mattia Rizzolo &lt;mattia@debian.org&gt; -->
<!-- request_addr: control@bugs.debian.org -->
<!-- time:1486990809 -->
<!-- new_data:
$new_data = {
              &#39;subject&#39; =&gt; &#39;diffoscope: CVE-2017-0359: writes to arbitrary locations on disk based on the contents of an untrusted archive&#39;
            };
-->
<!-- old_data:
$old_data = {
              &#39;subject&#39; =&gt; &#39;diffoscope writes to arbitrary locations on disk based on the contents of an untrusted archive&#39;
            };
-->
<strong>Changed Bug title to &#39;diffoscope: CVE-2017-0359: writes to arbitrary locations on disk based on the contents of an untrusted archive&#39; from &#39;diffoscope writes to arbitrary locations on disk based on the contents of an untrusted archive&#39;.</strong>
Request was from <code>Mattia Rizzolo &lt;mattia@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>.
 (Mon, 13 Feb 2017 13:00:09 GMT) (<a href="bugreport.cgi?bug=854723;msg=34">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="35"></a>
<!-- request_addr: Mattia Rizzolo &lt;mattia@debian.org&gt; -->
<!-- time:1487003767 -->
<strong>Reply sent</strong>
to <code>Mattia Rizzolo &lt;mattia@debian.org&gt;</code>:<br>
You have taken responsibility.
 (Mon, 13 Feb 2017 16:36:07 GMT) (<a href="bugreport.cgi?bug=854723;msg=36">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=36">mbox</a>, <a href="#35">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="37"></a>
<!-- request_addr: Ximin Luo &lt;infinity0@debian.org&gt; -->
<!-- time:1487003767 -->
<strong>Notification sent</strong>
to <code>Ximin Luo &lt;infinity0@debian.org&gt;</code>:<br>
Bug acknowledged by developer.
 (Mon, 13 Feb 2017 16:36:07 GMT) (<a href="bugreport.cgi?bug=854723;msg=38">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=38">mbox</a>, <a href="#37">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="39"></a><a name="msg39"></a><a href="#39">Message #39</a> received at 854723-close@bugs.debian.org (<a href="bugreport.cgi?bug=854723;msg=39">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=39">mbox</a>, <a href="mailto:854723@bugs.debian.org?subject=Re%3A%20Bug%23854723%3A%20fixed%20in%20diffoscope%2077&amp;body=On%20Mon%2C%2013%20Feb%202017%2016%3A33%3A35%20%2B0000%20Mattia%20Rizzolo%20%3Cmattia%40debian.org%3E%20wrote%3A%0A%3E%20Source%3A%20diffoscope%0A%3E%20Source-Version%3A%2077%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20diffoscope%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive.%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20854723%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Mattia%20Rizzolo%20%3Cmattia%40debian.org%3E%20%28supplier%20of%20updated%20diffoscope%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40ftp-master.debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA512%0A%3E%20%0A%3E%20Format%3A%201.8%0A%3E%20Date%3A%20Mon%2C%2013%20Feb%202017%2016%3A25%3A02%20%2B0100%0A%3E%20Source%3A%20diffoscope%0A%3E%20Binary%3A%20diffoscope%0A%3E%20Architecture%3A%20source%0A%3E%20Version%3A%2077%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20medium%0A%3E%20Maintainer%3A%20Reproducible%20builds%20folks%20%3Creproducible-builds%40lists.alioth.debian.org%3E%0A%3E%20Changed-By%3A%20Mattia%20Rizzolo%20%3Cmattia%40debian.org%3E%0A%3E%20Description%3A%0A%3E%20%20diffoscope%20-%20in-depth%20comparison%20of%20files%2C%20archives%2C%20and%20directories%0A%3E%20Closes%3A%20854723%20854745%20854783%0A%3E%20Changes%3A%0A%3E%20%20diffoscope%20%2877%29%20unstable%3B%20urgency%3Dmedium%0A%3E%20%20.%0A%3E%20%20%20%20%5B%20Chris%20Lamb%20%5D%0A%3E%20%20%20%20%2A%20tests%2Fcomparators%2Futils%3A%0A%3E%20%20%20%20%20%20%2B%20Correct%20logic%20of%20module_exists%2C%20ensuring%20we%20correctly%20skip%20in%20case%20of%0A%3E%20%20%20%20%20%20%20%20modules%20containing%20a%20dot%20in%20their%20name.%20%20Closes%3A%20%23854745%0A%3E%20%20%20%20%2A%20comparators%2Futils%2Flibarchive%3A%0A%3E%20%20%20%20%20%20%2B%20No%20need%20to%20track%20archive%20directory%20locations.%0A%3E%20%20%20%20%2A%20Add%20--exclude%20option.%20%20Closes%3A%20%23854783%0A%3E%20%20%20%20%2A%20Add%20PyPI%20badge%20to%20README.rst.%0A%3E%20%20%20%20%2A%20Update%20.travis.yml%20from%20http%3A%2F%2Ftravis.debian.net.%0A%3E%20%20.%0A%3E%20%20%20%20%5B%20Mattia%20Rizzolo%20%5D%0A%3E%20%20%20%20%2A%20Add%20CVE%20reference%20to%20the%20changelog%20of%20v76.%0A%3E%20%20%20%20%2A%20Add%20my%20key%20to%20debian%2Fupstream%2Fsigning-key.asc.%0A%3E%20%20.%0A%3E%20%20%20%20%5B%20Ximin%20Luo%20%5D%0A%3E%20%20%20%20%2A%20comparators%2Futils%2Flibarchive%3A%0A%3E%20%20%20%20%20%20%2B%20When%20extracting%20archives%2C%20try%20to%20keep%20directory%20sizes%20small.%0A%3E%20%20.%0A%3E%20%20diffoscope%20%2876%29%20unstable%3B%20urgency%3Dmedium%0A&amp;In-Reply-To=%3CE1cdJZH-000Adn-6n%40fasolo.debian.org%3E&amp;References=%3CE1cdJZH-000Adn-6n%40fasolo.debian.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=mattia%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Mattia Rizzolo &lt;mattia@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 854723-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#854723: fixed in diffoscope 77</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 13 Feb 2017 16:33:35 +0000</div>
</div>
<pre class="message">Source: diffoscope
Source-Version: 77

We believe that the bug you reported is fixed in the latest version of
diffoscope, which is due to be installed in the Debian FTP archive.

A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 854723@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Mattia Rizzolo &lt;mattia@debian.org&gt; (supplier of updated diffoscope package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@ftp-master.debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA512

Format: 1.8
Date: Mon, 13 Feb 2017 16:25:02 +0100
Source: diffoscope
Binary: diffoscope
Architecture: source
Version: 77
Distribution: unstable
Urgency: medium
Maintainer: Reproducible builds folks &lt;reproducible-builds@lists.alioth.debian.org&gt;
Changed-By: Mattia Rizzolo &lt;mattia@debian.org&gt;
Description:
 diffoscope - in-depth comparison of files, archives, and directories
Closes: <a href="bugreport.cgi?bug=854723">854723</a> <a href="bugreport.cgi?bug=854745">854745</a> <a href="bugreport.cgi?bug=854783">854783</a>
Changes:
 diffoscope (77) unstable; urgency=medium
 .
   [ Chris Lamb ]
   * tests/comparators/utils:
     + Correct logic of module_exists, ensuring we correctly skip in case of
       modules containing a dot in their name.  Closes: #<a href="bugreport.cgi?bug=854745">854745</a>
   * comparators/utils/libarchive:
     + No need to track archive directory locations.
   * Add --exclude option.  Closes: #<a href="bugreport.cgi?bug=854783">854783</a>
   * Add PyPI badge to README.rst.
   * Update .travis.yml from <a href="http://travis.debian.net">http://travis.debian.net</a>.
 .
   [ Mattia Rizzolo ]
   * Add CVE reference to the changelog of v76.
   * Add my key to debian/upstream/signing-key.asc.
 .
   [ Ximin Luo ]
   * comparators/utils/libarchive:
     + When extracting archives, try to keep directory sizes small.
 .
 diffoscope (76) unstable; urgency=medium
 .
   [ Chris Lamb ]
   * Extract archive members using an auto-incrementing integer, avoiding the
     need to sanitise filenames and avoiding writes to arbitrary locations.
     (Closes: #<a href="bugreport.cgi?bug=854723">854723</a> - <a href="https://security-tracker.debian.org/tracker/CVE-2017-0359">CVE-2017-0359</a>)
 .
   [ Ximin Luo ]
   * Simplify call to subprocess.Popen
Checksums-Sha1:
 88ab09a8ecf57244ee21bd5c2f19a39b0f1c5062 2972 diffoscope_77.dsc
 b0c72453546afd30364c36aa2a86355d712ad55f 349436 diffoscope_77.tar.xz
 619ab27596d84ee53ebe2e8924c3ad662e1deea8 16138 diffoscope_77_amd64.buildinfo
Checksums-Sha256:
 964f94d42f970ba32d73770e9d0c151fe149633cfb9054333bafe7df3f0271ee 2972 diffoscope_77.dsc
 c9adeb0bfb0c92a3501df04b6ea4300c3896f15a9008803e4e12c1f312528499 349436 diffoscope_77.tar.xz
 3e10be4a12c432443536830551d536e73dbb4de8f1374cf7ec6c5a033104a793 16138 diffoscope_77_amd64.buildinfo
Files:
 853b57d21d18fafb72701114b189a315 2972 devel optional diffoscope_77.dsc
 13f5d4623bfd49a3787a3d03c9f4f076 349436 devel optional diffoscope_77.tar.xz
 dc24dbcee5c0028bc590f98a97504d14 16138 devel optional diffoscope_77_amd64.buildinfo

-----BEGIN PGP SIGNATURE-----

iQIzBAEBCgAdFiEEi3hoeGwz5cZMTQpICBa54Yx2K60FAlih0y4ACgkQCBa54Yx2
K61wdBAAlmhCj1QjMML0C7SgOprVNYmKhIwo+MzW0DHD4Mn3FaTU6v2QdtCO3Sev
/kFVQDf2Tv+qAZhJ4h67a0hF710myt5faZVkMCqtCUsiVaNs/Q3py5wZAkJgpXMO
C6gEP1rCQctDGKricbLasYhv71iUU6MNQym4G1sohJxi74fQ+CM1+STvCV3MIfIm
SivzqSLja/lnyuRdHFjSIhPwR0tSoePmwQaNR7omd4EhC8seFS7vVcnRqO9bwSWz
khZpLPKvSEdLfzLDjNGo4trFi6EEyMkdOh+Oqy2RQNYmVr1YQYkmNTn284FUQduv
YxTG2/iFbdCWnYp+94RZI22TTJwBUsiAssAGFJD3e89ID6aPrjX/nq0ojHvz8mLF
NWt/KySh2tkFzMCRP3d61hVm0QASPp1oXWHhxSBkXt1DPOQ6ujtsbme62bLZAh0r
xco5c+JbRPMcjlNd4dZMy9qG0kjs+pRP6gF6qMbh8DXyPRAJrDQ8Y13U0dNKYzR+
ND9+dsVuFn/crrvjJqkowr4PqiQNbAa1zGQJtsxVXpw5Y8HtRPHNSWR976orR2Cp
QmqzEXCy9L+jN9oU9l/dKtRSBqvDckUZVfO6g177uasPAMdC3h3V/2WsFqXylDP6
AQxDrS/qia2YczKWytJ0LgluQsvmQn5j+93IhpyJNCJPaTwa5U0=
=QV/2
-----END PGP SIGNATURE-----



</pre>

<div class="msgreceived"><hr><p>
<a name="40"></a>
<!-- command:archive -->
<!-- requester: Debbugs Internal Request &lt;owner@bugs.debian.org&gt; -->
<!-- request_addr: internal_control@bugs.debian.org -->
<!-- time:1489994734 -->
<!-- new_data:
$new_data = {};
-->
<!-- old_data:
$old_data = {};
-->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Mon, 20 Mar 2017 07:25:34 GMT) (<a href="bugreport.cgi?bug=854723;msg=41">full text</a>, <a href="bugreport.cgi?bug=854723;mbox=yes;msg=41">mbox</a>, <a href="#40">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=854723">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:13:28 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
