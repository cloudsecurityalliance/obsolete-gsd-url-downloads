<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" dir="ltr">
  <head>
<base href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+index" />

    <meta charset="UTF-8" />
    <title>Bug #1867717 “PPC: KVM: Book3S HV: Fix conflicting use of HSTATE...” : Bugs : linux package : Ubuntu</title>
    <link rel="shortcut icon" href="/@@/launchpad.png" />
    <link rel="canonical" href="https://bugs.launchpad.net/bugs/1867717" />
    
      <link rel="alternate" type="application/atom+xml" href="http://feeds.launchpad.net/bugs/1867717/bug.atom" title="Bug 1867717 Feed" />
    

    
  
  <link type="text/css" rel="stylesheet" media="screen, print" href="/+icing/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/combo.css" />


    

    
      <meta name="description" content="---Problem Description---
Currently a malicious user can craft a code to be executed in the guest kernel space that puts CPU in TM suspended mode and call a hypercall (for instance H_PUT_TERM_CHAR, token 0x58) leading to a kernel panic on host. I was not able to reproduce it upstream, nonetheless it's reproducible on most updated stock kernel for Ubuntu Bionic Beaver, i.e 4.15.0-76.86. Guest kernel version is not meaningful unless TM facility is disabled (it must be enabled).


---Steps to Re..." />
      <meta property="og:description" content="---Problem Description---
Currently a malicious user can craft a code to be executed in the guest kernel space that puts CPU in TM suspended mode and call a hypercall (for instance H_PUT_TERM_CHAR, token 0x58) leading to a kernel panic on host. I was not able to reproduce it upstream, nonetheless it's reproducible on most updated stock kernel for Ubuntu Bionic Beaver, i.e 4.15.0-76.86. Guest kernel version is not meaningful unless TM facility is disabled (it must be enabled).


---Steps to Re..." />
    

    
    
      <meta property="og:title" content="Bug #1867717 “PPC: KVM: Book3S HV: Fix conflicting use of HSTATE...” : Bugs : linux package : Ubuntu" />
      <meta property="og:type" content="website" />
      <meta property="og:image" content="/@@/launchpad.png" />
      <meta property="og:url" content="https://bugs.launchpad.net/bugs/1867717" />
      <meta property="og:site_name" content="Launchpad" />
    

    

    
  

  
  
  <script type="text/javascript">
    var LP = {
        cache: {},
        links: {}
    };
  </script>

  

  <script type="text/javascript">var cookie_scope = '; Path=/; Secure; Domain=.launchpad.net';</script>

   <script type="text/javascript" src="/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?yui/yui/yui-min.js&amp;lp/meta.js&amp;yui/loader/loader-min.js"></script>
   <script type="text/javascript">
        var raw = null;
        if (LP.devmode) {
           raw = 'raw';
        }
        YUI.GlobalConfig = {
            combine: true,
            comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
            root: 'yui/',
            filter: raw,
            debug: false,
            fetchCSS: false,
            maxURLLength: 2000,
            groups: {
                lp: {
                    combine: true,
                    base: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?lp/',
                    comboBase: '/+combo/rev0d8de2bfee2024772b3040d4d19f42f47395ac0d/?',
                    root: 'lp/',
                    // comes from including lp/meta.js
                    modules: LP_MODULES,
                    fetchCSS: false
                }
            }
        }</script>

  <script type="text/javascript">
      // we need this to create a single YUI instance all events and code
      // talks across. All instances of YUI().use should be based off of
      // LPJS instead.
      var LPJS = new YUI();
  </script>



    <script id="base-layout-load-scripts" type="text/javascript">
        //<![CDATA[
        LPJS.use('base', 'node', 'console', 'event',
            'oop', 'lp', 'lp.app.foldables','lp.app.sorttable',
            'lp.app.inlinehelp', 'lp.app.links',
            'lp.bugs.bugtask_index', 'lp.bugs.subscribers',
            'lp.app.ellipsis', 'lp.code.branchmergeproposal.diff',
            'lp.views.global',
             function(Y) {

            Y.on("domready", function () {
                var global_view = new Y.lp.views.Global();
                global_view.render();

                Y.lp.app.sorttable.SortTable.init();
                Y.lp.app.inlinehelp.init_help();
                Y.lp.activate_collapsibles();
                Y.lp.app.foldables.activate();
                Y.lp.app.links.check_valid_lp_links();
            });

            Y.on('lp:context:web_link:changed', function(e) {
                  window.location = e.new_value;
            });
        });
        //]]>
    </script>
    <script id="base-helper-functions" type="text/javascript">
         //<![CDATA[
        // This code is pulled from lp.js that needs to be available on every
        // request. Pulling here to get it outside the scope of the YUI block.
        function setFocusByName(name) {
            // Focus the first element matching the given name which can be focused.
            var nodes = document.getElementsByName(name);
            var i, node;
            for (i = 0; i < nodes.length; i++) {
                node = nodes[i];
                if (node.focus) {
                    try {
                        // Trying to focus a hidden element throws an error in IE8.
                        if (node.offsetHeight !== 0) {
                            node.focus();
                        }
                    } catch (e) {
                        LPJS.use('console', function(Y) {
                            Y.log('In setFocusByName(<' +
                                node.tagName + ' type=' + node.type + '>): ' + e);
                        });
                    }
                    break;
                }
            }
        }

        function selectWidget(widget_name, event) {
          if (event && (event.keyCode === 9 || event.keyCode === 13)) {
              // Avoid firing if user is tabbing through or simply pressing
              // enter to submit the form.
              return;
          }
          document.getElementById(widget_name).checked = true;
        }
        //]]>
    </script>

    
      
      <script type="text/javascript" id="available-official-tags-js">var available_official_tags = ["a11y", "appstream", "bionic", "bisect-done", "bitesize", "ce-needs-card", "cherry-pick", "community-security", "cqa-verified", "desktop-file", "disco", "dist-upgrade", "focal", "ftbfs", "groovy", "hirsute", "hw-specific", "impish", "jammy", "kernel-bug", "loc-canonicalquestions", "loc-opensource", "manpage", "metabug", "multiarch", "needs-bisect", "needs-design", "needs-packaging", "needs-reassignment", "p9", "package-conflict", "packaging", "patch", "patch-accepted-debian", "patch-accepted-upstream", "patch-forwarded-debian", "patch-forwarded-upstream", "patch-needswork", "patch-rejected", "patch-rejected-debian", "patch-rejected-upstream", "performing-bisect", "py2-removal", "qt4-removal", "regression-proposed", "regression-release", "regression-update", "string-fix", "suspend-resume", "systemd-boot", "testcase", "touch", "triage-a", "triage-g", "triage-r", "ubuntu-14.04", "ubuntu-16.04", "ubuntu-16.10", "ubuntu-17.04", "ubuntu-17.10", "ubuntu-18.04", "ubuntu-18.04.1", "ubuntu-18.10", "unmetdeps", "upgrade-software-version", "verification-done-bionic", "verification-done-focal", "verification-done-groovy", "verification-done-hirsute", "verification-done-impish", "verification-done-xenial", "verification-failed-bionic", "verification-failed-groovy", "verification-failed-impish", "verification-failed-xenial", "verification-needed-bionic", "verification-needed-focal", "verification-needed-groovy", "verification-needed-hirsute", "verification-needed-impish", "verification-needed-trusty", "verification-needed-xenial", "wayland", "xenial"];</script>
      <script type="text/javascript">
        LPJS.use('base', 'node', 'oop', 'event', 'lp.bugs.bugtask_index',
                  'lp.bugs.subscribers', 'lp.code.branchmergeproposal.diff',
                  'lp.app.comment', 'lp.services.messages.edit', function(Y) {
            Y.on('domready', function() {
                Y.lp.code.branchmergeproposal.diff.connect_diff_links();
                Y.lp.bugs.bugtask_index.setup_bugtask_index();
                Y.lp.bugs.bugtask_index.setup_bugtask_table();
                LP.cache.comment_context = LP.cache.bug;
                var cl = new Y.lp.app.comment.CommentList();
                cl.render();
                var sl = new Y.lp.bugs.subscribers.createBugSubscribersLoader({
                    container_box: '#other-bug-subscribers',
                    subscribers_details_view:
                        '/+bug-portlet-subscribers-details',
                    subscribe_someone_else_link: '.menu-link-addsubscriber'
                }, window);

                Y.lp.services.messages.edit.setup();
            });
         });
      </script>
      <style type="text/css">
        /* Align the 'add comment' link to the right of the comment box. */
        #add-comment-form textarea { width: 100%; }
        #add-comment-form { max-width: 60em; padding-bottom: 4em; }
        #add-comment-form .actions {float: right;}
        .buglink-summary dd { font-size: 10px; }
        a#privacy-link:link:hover, a#privacy-link:visited:hover {text-decoration:none;}
      </style>
      <style type="text/css">
        .yui3-overlay .value label  {
          /* It normally makes sense for form labels to be bold, but since
          this form consists only of radio buttons, there's nothing but labels
          so we just get wall-to-wall bold. */
          font-weight: normal !important;
        }
      </style>
    
    
  </head>

  <body id="document" itemscope="" itemtype="http://schema.org/WebPage" class="tab-bugs
      main_side
      public
      yui3-skin-sam">
          
          
    <div class="yui-d0">
      <div id="locationbar" class="login-logout">
        

<div id="logincontrol"><a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+login">Log in / Register</a></div>



      </div><!--id="locationbar"-->

      <div id="watermark" class="watermark-apps-portlet">
        <div>
          <a href="https://launchpad.net/ubuntu"><img alt="" width="64" height="64" src="https://launchpadlibrarian.net/49558155/64_logo.png" /></a>
        </div>
        <div class="wide">
          <h2 id="watermark-heading"><a href="https://launchpad.net/ubuntu">Ubuntu</a><br /><a href="https://launchpad.net/ubuntu/+source/linux">linux package</a></h2>
        </div>
        
  <!-- Application Menu -->
  <ul class="facetmenu">
    
      
      <li class="overview"><a href="https://launchpad.net/ubuntu/+source/linux">Overview</a></li>
      
    
    
      
      <li class="branches"><a href="https://code.launchpad.net/ubuntu/+source/linux">Code</a></li>
      
    
    
      <li class="bugs active"><a href="https://bugs.launchpad.net/ubuntu/+source/linux">Bugs</a></li>
      
      
    
    
      
      
      <li class="specifications disabled-tab"><span>Blueprints</span></li>
    
    
      
      <li class="translations"><a href="https://translations.launchpad.net/ubuntu/+source/linux">Translations</a></li>
      
    
    
      
      <li class="answers"><a href="https://answers.launchpad.net/ubuntu/+source/linux">Answers</a></li>
      
    
  </ul>

      </div>

      <div class="yui-t4">
        <div id="maincontent" class="yui-main">
          <div class="yui-b" dir="ltr">
            <div class="context-publication">
              
      <h1 id="edit-title">
<span class="yui3-editable_text-text ellipsis" style="max-width: 95%;">
    PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1
</span>
  
</h1>



    
              

              <div id="registration" class="registering">
                
      Bug #1867717 reported by
      <a href="https://launchpad.net/~mranweil" class="sprite person">Mike Ranweiler</a>
      <time title="2020-03-17 04:54:14 UTC" datetime="2020-03-17T04:54:14.739467+00:00">on 2020-03-17</time>
    
              </div>
            </div>

            
            <div id="request-notifications">
              
            </div>

            
              <div>

      

      <div id="bug-is-duplicate">
          
      </div>
      

      <div style="float: right;">
        <span><a href="/+help-bugs/bug-heat.html" target="help" class="sprite flame">278</a></span>
      </div>

      


  
  
    <div class="actions">
      <span id="affectsmetoo" style="display: inline">This bug affects 1 person</span>
    </div>
  



    <table id="affected-software" class="listing">
      <thead>
        <tr>
          <th colspan="2">Affects</th>
          <th>Status</th>
          <th>Importance</th>
          <th>Assigned to</th>
          <th>Milestone</th>
        </tr>
      </thead>

      <tbody>
        
          
  <tr id="tasksummary2582553">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu-power-systems/+bug/1867717/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2582553">
        <span class="yui3-activator-data-box">
            <a class="sprite product" href="https://bugs.launchpad.net/ubuntu-power-systems">The Ubuntu-power-systems project</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu-power-systems/+bug/1867717/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ubuntu-power-systems/+bug/1867717/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceHIGH">High</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2582553">
          <span class="yui3-activator-data-box">
            <a class="sprite team" href="https://launchpad.net/~ubuntu-power-triage">Ubuntu on IBM Power Systems Bug Triage</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2582553">
     <td colspan="7"><form action="/ubuntu-power-systems/+bug/1867717/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu-power-systems">The Ubuntu-power-systems project</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~mranweil" class="sprite person">Mike Ranweiler</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2020-03-17 04:54:14 UTC" datetime="2020-03-17T04:54:14.739467+00:00">2020-03-17</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2020-03-30 17:36:51 UTC" datetime="2020-03-30T17:36:51.469026+00:00">2020-03-30</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2020-03-17 06:25:08 UTC" datetime="2020-03-17T06:25:08.467474+00:00">2020-03-17</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2020-04-09 05:17:03 UTC" datetime="2020-04-09T05:17:03.194319+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2020-04-09 05:17:03 UTC" datetime="2020-04-09T05:17:03.194319+00:00">2020-04-09</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu-power-systems.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu-power-systems.target.option.package" name="ubuntu-power-systems.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu-power-systems.target.distribution" name="ubuntu-power-systems.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu-power-systems.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu-power-systems.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu-power-systems.target.package"
                         name="ubuntu-power-systems.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu-power-systems.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu-power-systems.target.package');
              var select_menu = Y.DOM.byId('ubuntu-power-systems.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu-power-systems-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu-power-systems.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-ubuntu-power-systems-target-package"};
        var show_widget_id = 'show-widget-ubuntu-power-systems-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu-power-systems.target.option.product" name="ubuntu-power-systems.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="ubuntu-power-systems" id="ubuntu-power-systems.target.product"
                         name="ubuntu-power-systems.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu-power-systems.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu-power-systems.target.product');
              var select_menu = Y.DOM.byId('ubuntu-power-systems.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu-power-systems-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "ubuntu-power-systems", "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu-power-systems.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-ubuntu-power-systems-target-product"};
        var show_widget_id = 'show-widget-ubuntu-power-systems-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu-power-systems.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu-power-systems.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu-power-systems.status" name="ubuntu-power-systems.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ubuntu-power-systems.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceHIGH">High</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu-power-systems.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu-power-systems.assignee.assign_to_me" name="ubuntu-power-systems.assignee.option" value="ubuntu-power-systems.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu-power-systems.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="ubuntu-power-systems.assignee.assigned_to" name="ubuntu-power-systems.assignee.option" value="ubuntu-power-systems.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="ubuntu-power-systems.assignee.assigned_to">
              Ubuntu on IBM Power Systems Bug Triage (ubuntu-power-triage)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu-power-systems.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu-power-systems.comment_on_change" name="ubuntu-power-systems.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr class="highlight" id="tasksummary2582558">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+editstatus">
        &#8203;
      </a>
    </td>
    
    <td>
      <span id="bugtarget-picker-tasksummary2582558">
        <span class="yui3-activator-data-box">
            <a class="sprite package-source" href="https://bugs.launchpad.net/ubuntu/+source/linux" title="Latest release: 5.11.0-40.44, uploaded to main on 2021-10-20 14:31:33.255814+00:00 by Stefan Bader (smb), maintained by Ubuntu Kernel Team (kernel-team)">linux (Ubuntu)</a>
        </span>
        <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
          Edit
        </button>
        <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        
      </span>
    </td>

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2582558">
          <span class="yui3-activator-data-box">
            <a class="sprite team" href="https://launchpad.net/~ubuntu-security">Ubuntu Security Team</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2582558">
     <td colspan="7"><form action="/ubuntu/+source/linux/+bug/1867717/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/+source/linux">linux (Ubuntu)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~fheimes" class="sprite person">Frank Heimes</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2020-03-17 06:19:55 UTC" datetime="2020-03-17T06:19:55.451773+00:00">2020-03-17</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2020-04-09 00:48:13 UTC" datetime="2020-04-09T00:48:13.163332+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2020-03-17 06:25:16 UTC" datetime="2020-03-17T06:25:16.704103+00:00">2020-03-17</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2020-04-09 00:48:13 UTC" datetime="2020-04-09T00:48:13.163332+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2020-04-09 00:48:13 UTC" datetime="2020-04-09T00:48:13.163332+00:00">2020-04-09</time>
      </td>
    </tr>
  </table>
  <div class="field">
    <table>
      <tr>
        <td>
          <label for="ubuntu_linux.target">Target</label>
        </td>
      </tr>
      <tr>
        <td>
          <table>
  <tr>
    <td>
      <label>
        <input class="radioType" checked="checked" id="ubuntu_linux.target.option.package" name="ubuntu_linux.target" type="radio" value="package" />
        Distribution
      </label>
    </td>
    <td>
      <select id="ubuntu_linux.target.distribution" name="ubuntu_linux.target.distribution" size="1" >
<option value="baltix">Baltix</option>
<option value="boss">BOSS</option>
<option value="charms">Juju Charms Collection</option>
<option value="elbuntu">Elbuntu</option>
<option value="guadalinex">Guadalinex</option>
<option value="guadalinexedu">Guadalinex Edu</option>
<option value="kiwilinux">Kiwi Linux</option>
<option value="nubuntu">nUbuntu</option>
<option value="pld-linux">PLD Linux</option>
<option value="tilix">Tilix</option>
<option value="tuxlab">tuXlab</option>
<option selected="selected" value="ubuntu">Ubuntu</option>
<option value="ubuntu-leb">Ubuntu Linaro Evaluation Build</option>
<option value="ubuntu-rtm">Ubuntu RTM</option>
</select>
<input name="ubuntu_linux.target.distribution-empty-marker" type="hidden" value="1" />
    </td>
  </tr>
  <tr>
    <td align="right">
      <label for="ubuntu_linux.target.option.package">
        Package
      </label>
    </td>
    <td>
      


    <input type="text" value="linux" id="ubuntu_linux.target.package"
                         name="ubuntu_linux.target.package" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_linux.target.option.package&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_linux.target.package');
              var select_menu = Y.DOM.byId('ubuntu_linux.target.package-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_linux-target-package" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "linux", "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_linux.target.package", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionPackage", "show_widget_id": "show-widget-ubuntu_linux-target-package"};
        var show_widget_id = 'show-widget-ubuntu_linux-target-package';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>

  <tr>
    <td>
      <label>
        <input class="radioType" id="ubuntu_linux.target.option.product" name="ubuntu_linux.target" type="radio" value="product" />
       Project
      </label>
    </td>
    <td>
      


    <input type="text" value="" id="ubuntu_linux.target.product"
                         name="ubuntu_linux.target.product" size="20"
                         maxlength=""
                         onKeyPress="selectWidget(&#x27;ubuntu_linux.target.option.product&#x27;, event)" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_linux.target.product');
              var select_menu = Y.DOM.byId('ubuntu_linux.target.product-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_linux-target-product" href="#">Find&hellip;</a>)</span>
    <script>
    LPJS.use('node', 'lp.app.picker', function(Y) {
        var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": null, "step_title": "Search", "header": "Select a project", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_linux.target.product", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "Product", "show_widget_id": "show-widget-ubuntu_linux-target-product"};
        var show_widget_id = 'show-widget-ubuntu_linux-target-product';
        Y.lp.app.picker.addPicker(config, show_widget_id);
    });
    </script>
  



    </td>
  </tr>
</table>

          
        </td>
      </tr>
    </table>
    
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_linux.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_linux.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_linux.status" name="ubuntu_linux.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ubuntu_linux.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_linux.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_linux.assignee.assign_to_me" name="ubuntu_linux.assignee.option" value="ubuntu_linux.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_linux.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="ubuntu_linux.assignee.assigned_to" name="ubuntu_linux.assignee.option" value="ubuntu_linux.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="ubuntu_linux.assignee.assigned_to">
              Ubuntu Security Team (ubuntu-security)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_linux.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_linux.comment_on_change" name="ubuntu_linux.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
        
          
  <tr id="tasksummary2590446">
    <td>
      <a class="bugtask-expander" href="https://bugs.launchpad.net/ubuntu/bionic/+source/linux/+bug/1867717/+editstatus">
        &#8203;
      </a>
    </td>
    <td style="padding: 0.3em 0em 0.3em 1.5em">
      <span class="sprite milestone"></span>
      
        <a href="https://bugs.launchpad.net/ubuntu/bionic/+source/linux">Bionic</a>
      
        
    </td>
    

    

    
    <td style="width: 20%; vertical-align: middle">
      <div class="status-content" style="width: 100%; float: left">
        
        
          <a href="https://bugs.launchpad.net/ubuntu/bionic/+source/linux/+bug/1867717/+editstatus" style="float: left" class="value statusFIXRELEASED">Fix Released</a>
          <a href="https://bugs.launchpad.net/ubuntu/bionic/+source/linux/+bug/1867717/+editstatus" style="margin-left: 3px">
            <img class="editicon" src="/@@/edit" />
          </a>
        
      </div>
    </td>

    
    <td style="width: 15em; vertical-align: middle">
      <div class="importance-content" style="width: 100%; float: left">
        <span style="float: left" class="value importanceUNDECIDED">Undecided</span>
      </div>
    </td>

    <td style="width:20%; margin: 0; padding: 0;
               vertical-align: middle; padding-left: 0.5em">
      

      
        <span id="assignee-picker-tasksummary2590446">
          <span class="yui3-activator-data-box">
            <a class="sprite team" href="https://launchpad.net/~ubuntu-security">Ubuntu Security Team</a>
            
          </span>
          
          <button class="lazr-btn yui3-activator-act yui3-activator-hidden">
            Edit
          </button>
          <div class="yui3-activator-message-box yui3-activator-hidden"></div>
        </span>
      
    </td>

    <td style="width: 20%; vertical-align: middle">
      <div class="milestone-content" style="width: 100%; float: left">
        
        <a class="value" href=""></a>
        
      </div>
    </td>

    
  </tr>

  
    <tr class="bugtask-collapsible-content hidden" id="task2590446">
     <td colspan="7"><form action="/ubuntu/bionic/+source/linux/+bug/1867717/+editstatus" method="post" enctype="multipart/form-data">
  

  <p class="error message">
    You need to log in to change this bug's status.
  </p>
  
  <table class="summary" style="float: right; margin-left: 1em;">
    <tr>
      <th>Affecting:</th>
      <td><a href="/ubuntu/bionic/+source/linux">linux (Ubuntu Bionic)</a></td>
    </tr>
    <tr>
      <th>Filed here by:</th>
      <td><a href="https://launchpad.net/~sbeattie" class="sprite person">Steve Beattie</a></td>
    </tr>
    <tr>
      <th>When:</th>
      <td>
        <time title="2020-04-09 00:47:26 UTC" datetime="2020-04-09T00:47:26.279000+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Confirmed:</th>
      <td>
        <time title="2020-04-09 00:47:45 UTC" datetime="2020-04-09T00:47:45.610135+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Assigned:</th>
      <td>
        <time title="2020-04-09 00:48:01 UTC" datetime="2020-04-09T00:48:01.715013+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Started work:</th>
      <td>
        <time title="2020-04-09 00:47:45 UTC" datetime="2020-04-09T00:47:45.610135+00:00">2020-04-09</time>
      </td>
    </tr>
    <tr>
      <th>Completed:</th>
      <td>
        <time title="2020-04-09 00:47:45 UTC" datetime="2020-04-09T00:47:45.610135+00:00">2020-04-09</time>
      </td>
    </tr>
  </table>
  <div class="field">
    
    <table>
      <tr>
        <td>
          <label for="ubuntu_bionic_linux.sourcepackagename">Package</label>
        </td>
      </tr>
      <tr>
        <td>
          


    <input type="text" value="linux" id="ubuntu_bionic_linux.sourcepackagename"
                         name="ubuntu_bionic_linux.sourcepackagename" size="20"
                         maxlength=""
                         onKeyPress="" style=""
                         class="" />

    
      
      <script type="text/javascript">
          LPJS.use('node', 'lp.app.picker', function(Y) {
              var text_input = Y.DOM.byId('ubuntu_bionic_linux.sourcepackagename');
              var select_menu = Y.DOM.byId('ubuntu_bionic_linux.sourcepackagename-suggestions');
              Y.lp.app.picker.connect_select_menu(
                  select_menu, text_input);
          });</script>
    

    <span class="hidden">(<a id="show-widget-ubuntu_bionic_linux-sourcepackagename" href="#">Find&hellip;</a>)</span>
    <script>
  LPJS.use('node', 'lp.app.picker', function(Y) {
      var config = {"show_assign_me_button": false, "extra_no_results_message": null, "picker_type": "default", "selected_value_metadata": null, "remove_team_text": "Remove team", "selected_value": "linux", "step_title": "Search by name", "header": "Select a package", "vocabulary_filters": [], "show_create_team": false, "input_element": "ubuntu_bionic_linux.sourcepackagename", "assign_me_text": "Pick me", "remove_person_text": "Remove person", "show_remove_button": false, "vocabulary_name": "DistributionSourcePackage", "show_widget_id": "show-widget-ubuntu_bionic_linux-sourcepackagename"};
      var distribution_name = '';
      var distribution_id = '';
      var distroseries_id = '';
      if (distribution_name !== '') {
          config.getContextPath = function() {
              return '/' + distribution_name;
          }
      } else if (distribution_id !== '') {
          config.getContextPath = function() {
              return '/' + Y.DOM.byId(distribution_id).value;
          };
      } else if (distroseries_id !== '') {
          config.getContextPath = function() {
              return '/' + Y.DOM.byId(distroseries_id).value.split('/', 2)[0];
          };
      }
      var show_widget_id = 'show-widget-ubuntu_bionic_linux-sourcepackagename';
      Y.on('domready', function(e) {
          Y.lp.app.picker.addPicker(config, show_widget_id);
      });
  });
  </script>
  



          
        </td>
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_bionic_linux.status">Status</label>
        </td>
        <td>
          <label style="font-weight: bold" for="ubuntu_bionic_linux.importance">Importance</label>
        </td>
        
      </tr>
      <tr>
        <td><div>
<div class="value">
<select id="ubuntu_bionic_linux.status" name="ubuntu_bionic_linux.status" size="1" >
<option selected="selected" value="Fix Released">Fix Released</option>
</select>
</div>
<input name="ubuntu_bionic_linux.status-empty-marker" type="hidden" value="1" />
</div></td>
        <td title="Changeable only by a project maintainer or bug supervisor">
          <span class="sprite read-only"></span>
          <span class="importanceUNDECIDED">Undecided</span>
        </td>
        
      </tr>
    </table>
    <table>
      <tr>
        <td>
          <label style="font-weight: bold" for="ubuntu_bionic_linux.assignee">Assigned to</label>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="white-space: nowrap">

  <table>
    
    <tr>
      <td style="padding: 0 2px 2px 0">
        <input type="radio" id="ubuntu_bionic_linux.assignee.assign_to_me" name="ubuntu_bionic_linux.assignee.option" value="ubuntu_bionic_linux.assignee.assign_to_me" />
      </td>
      <td style="padding: 0">
        <label style="font-weight: normal" for="ubuntu_bionic_linux.assignee.assign_to_me">
          Me
        </label>
      </td>
    </tr>
    
      
        <tr>
          <td style="padding: 0 2px 2px 0">
              <input type="radio" checked="checked" id="ubuntu_bionic_linux.assignee.assigned_to" name="ubuntu_bionic_linux.assignee.option" value="ubuntu_bionic_linux.assignee.assigned_to" />
          </td>
          <td style="padding: 0">
            <label style="font-weight: normal" for="ubuntu_bionic_linux.assignee.assigned_to">
              Ubuntu Security Team (ubuntu-security)
            </label>
          </td>
        </tr>
      
    
    
  </table>


</td>
      </tr>
    </table>
    
  </div>
  <div class="field">
    <div>
      <label style="font-weight: bold" for="ubuntu_bionic_linux.comment_on_change">Comment on this change (optional)</label>
      <textarea cols="62" rows="4" id="ubuntu_bionic_linux.comment_on_change" name="ubuntu_bionic_linux.comment_on_change"></textarea>
    </div>
    <div>
      <label style="font-weight: normal">
        <input type="checkbox" name="subscribe" id="subscribe" value="Subscribe" />
        Email me about changes to this bug report
      </label>
    </div>
  </div>
  
</form>
</td>
    </tr>
  


        
      </tbody>

    </table>



<div class="actions">
  
    <span id="also-affects-product" class="">
    <a class="menu-link-addupstream sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+choose-affected-product">Also affects project</a>
        <a href="/+help-bugs/also-affects-project-help.html" target="help" class="sprite maybe action-icon">(?)</a>
    </span>
    <span id="also-affects-package" class="">
    <a class="menu-link-adddistro sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+distrotask">Also affects distribution/package</a>
    </span>
    <a class="menu-link-nominate sprite milestone" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+nominate">Nominate for series</a>
    
  

</div>




      <div id="maincontentsub">
        <div class="top-portlet">

      <div itemprop="mainContentOfPage" class="report">
        

        <div>
  <div class="lazr-multiline-edit" id="edit-description">
  <div class="clearfix">
    

    <h3>Bug Description</h3>
  </div>

  <div class="yui3-editable_text-text"><p>---Problem Description---<br />
Currently a malicious user can craft a code to be executed in the guest kernel space that puts CPU in TM suspended mode and call a hypercall (for instance H_PUT_TERM_CHAR, token 0x58) leading to a kernel panic on host. I was not able to reproduce it upstream, nonetheless it&#x27;s reproducible on most updated stock kernel for Ubuntu Bionic Beaver, i.e 4.15.0-76.86. Guest kernel version is not meaningful unless TM facility is disabled (it must be enabled).</p>
<p>---Steps to Reproduce---<br />
&nbsp;The following hypercall fuzzer I&#x27;ll trigger it: <a rel="nofollow" href="https://github.com/gromero/hinjector">https:/<wbr />/github.<wbr />com/gromero/<wbr />hinjector</a></p>
<p>$ git clone <a rel="nofollow" href="https://github.com/gromero/hinjector.git">https:/<wbr />/github.<wbr />com/gromero/<wbr />hinjector.<wbr />git</a> &amp;&amp; cd hinjector<br />
$ make<br />
$ make insmod<br />
$ sudo ./injector</p>
<p>Currently it&#x27;s possible to crash a host from a guest by calling a hypercall when<br />
CPU is in TM suspended mode. Whilst on guest a TM Bad Thing is caught, on host<br />
the following traces are observed:</p>
<p>[  618.563991] Oops: Exception in kernel mode, sig: 4 [#1]<br />
[  618.563994] LE SMP NR_CPUS=2048 NUMA PowerNV<br />
[  618.563999] Modules linked in: xt_CHECKSUM iptable_mangle ipt_MASQUERADE<br />
nf_nat_<wbr />masquerade_<wbr />ipv4 iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4<br />
nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4 xt_tcpudp bridge<br />
stp llc ebtable_filter ebtables devlink ip6table_filter ip6_tables iptable_filter<br />
kvm_hv kvm vmx_crypto ipmi_powernv ipmi_devintf ipmi_msghandler uio_pdrv_genirq<br />
uio leds_powernv crct10dif_vpmsum ibmpowernv powernv_rng sch_fq_codel nfsd auth_rpcgss<br />
nfs_acl lockd grace sunrpc ip_tables x_tables autofs4 xfs btrfs zstd_compress<br />
raid10 raid456 async_raid6_recov async_memcpy async_pq async_xor async_tx xor<br />
raid6_pq libcrc32c raid1 raid0 multipath linear lpfc crc32c_vpmsum nvmet_fc<br />
nvmet nvme_fc nvme_fabrics nvme_core tg3 ipr scsi_transport_fc<br />
[  618.564064] CPU: 51 PID: 0 Comm: swapper/51 Not tainted 4.15.0-76-generic #86-Ubuntu<br />
[  618.564066] NIP:  0000000000000000 LR: 0000000000000000 CTR: d0000000072f0580<br />
[  618.564068] REGS: c00000003fd9bca0 TRAP: 0e40   Not tainted  (4.15.0-76-generic)<br />
[  618.564068] MSR:  9000000102883003 &lt;SF,HV,<wbr />VEC,VSX,<wbr />FP,ME,RI,<wbr />LE,TM[E]<wbr />&gt;  CR: 28200222  XER: 20000000<br />
[  618.564077] CFAR: c0000000000f53f0 SOFTE: 0<br />
[  618.564077] GPR00: 0000000000000000 c00000003fd9bf20 c00000000171c800 0000000000000000<br />
[  618.564077] GPR04: c000000ff4d10000 c0000000ff067400 000000000ad0cc9e c0000000000fb4bc<br />
[  618.564077] GPR08: 804800000180f000 c000000dcabcbe80 0000000000000000 0000000020000000<br />
[  618.564077] GPR12: 0000000000000e80 c00000000faa3100 0000000000000000 0000000000000000<br />
[  618.564077] GPR16: 0000000000000000 0000000000000000 0000000000000000 0000000000000000<br />
[  618.564077] GPR20: 0000000000000000 0000000000000000 0000000000000000 0000000000000000<br />
[  618.564077] GPR24: 0000000000000000 d0000000072e0158 000000000000009b 000000000000009c<br />
[  618.564077] GPR28: 000000000000009c 0000000000000000 0000000000000000 0010000000000000<br />
[  618.564100] NIP [0000000000000000]           (null)<br />
[  618.564101] LR [0000000000000000]           (null)<br />
[  618.564101] Call Trace:<br />
[  618.564102] Instruction dump:<br />
[  618.564105] XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX<br />
[  618.564109] XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX 0100421c f2820104 0000001b 00000132<br />
[  618.564118] ---[ end trace f0be3cc10ea6fc44 ]---<br />
[  618.569897]<br />
[  618.593555] KVM: CPU 51 seems to be stuck<br />
[  258.967652] Kernel panic - not syncing: Attempted to kill the idle task!<br />
[  258.967677] Unable to handle kernel paging request for data at address 0xc000001ff6c9d700<br />
[  618.596478] Faulting instruction address: 0xc000000000077cf0<br />
[  618.596479] Oops: Kernel access of bad area, sig: 11 [#2]<br />
[  618.596480] LE SMP NR_CPUS=2048 NUMA PowerNV<br />
[  618.596482] Modules linked in: xt_CHECKSUM iptable_mangle ipt_MASQUERADE<br />
nf_nat_<wbr />masquerade_<wbr />ipv4 iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4<br />
nf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4<br />
xt_tcpudp bridge stp llc ebtable_filter ebtables devlink ip6table_filter<br />
ip6_tables iptable_filter kvm_hv kvm vmx_crypto ipmi_powernv ipmi_devintf<br />
ipmi_msghandler uio_pdrv_genirq uio leds_powernv crct10dif_vpmsum ibmpowernv<br />
powernv_rng sch_fq_codel nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables<br />
x_tables autofs4 xfs btrfs zstd_compress raid10 raid456 async_raid6_recov<br />
async_memcpy async_pq async_xor async_tx xor raid6_pq libcrc32c raid1 raid0<br />
multipath linear lpfc crc32c_vpmsum nvmet_fc nvmet nvme_fc nvme_fabrics<br />
nvme_core tg3 ipr scsi_transport_fc<br />
[  618.596521] CPU: 51 PID: 0 Comm: swapper/51 Tainted: G      D          4.15.0-76-generic #86-Ubuntu<br />
[  618.596522] NIP:  c000000000077cf0 LR: c000000000080c84 CTR: c000000000077c90<br />
[  618.596524] REGS: c00000003fd9b040 TRAP: 0300   Tainted: G      D           (4.15.0-76-generic)<br />
[  618.596524] MSR:  9000000000001033 &lt;SF,HV,<wbr />ME,IR,DR,<wbr />RI,LE&gt;  CR: 28244242  XER: 00000000<br />
[  618.596530] CFAR: c000000000080c80 DAR: c000001ff6c9d700 DSISR: 40000000 SOFTE: 0<br />
[  618.596530] GPR00: c000000000080c84 c00000003fd9b2c0 c00000000171c800 0000000006c9d700<br />
[  618.596530] GPR04: 00000000000001ac 0071d13aa0080040 0000000000000002 0000000000000002<br />
[  618.596530] GPR08: 0000000000000001 0000000000000002 00000e3a27540100 c000001ff6c9d700<br />
[  618.596530] GPR12: c000001ff0000000 c00000000faa3100 0000000000000000 0000000000000000<br />
[  618.596530] GPR16: 0000000000000004 0071d13aa0080040 00000000000001ac c0000000018be858<br />
[  618.596530] GPR20: 800000000000000e d00038008004000c 00000000071d13aa c0000000018be280<br />
[  618.596530] GPR24: 0000000000000001 0000000000000002 0000000000000300 0000000000000300<br />
[  618.596530] GPR28: 4000000000000000 0000000000000000 c0000000018be2d0 00000000000000b0<br />
[  618.596560] NIP [c000000000077cf0] native_<wbr />hpte_updatepp+<wbr />0x60/0x680<br />
[  618.596562] LR [c000000000080c84] __hash_<wbr />page_64K+<wbr />0x4c4/0x560<br />
[  618.596562] Call Trace:<br />
[  618.596563] Instruction dump:<br />
[  618.596565] 791cf046 3fc2001a 3bde1ad0 3d62001a 396b2188 91810008 f821ff71 7fbefa14<br />
[  618.596570] ebbd0048 e98b0000 7d4ae878 7d6c1a14 &lt;7c0c1c28&gt; 794a3e24 7f9c5378 48000018<br />
[  618.596576] ---[ end trace f0be3cc10ea6fc45 ]---<br />
[  618.602738]<br />
[  618.625946] KVM: CPU 51 seems to be stuck<br />
[  258.999498] Kernel panic - not syncing: Attempted to kill the idle task!<br />
[  618.653500] KVM: CPU 51 seems to be stuck</p>
<p>This is due to conflicting use of HSTATE_HOST_R1 to store r1 state in<br />
kvmppc_hv_entry plus in kvmppc_<wbr />{save,restore}<wbr />_tm leading to a stack corruption.</p>
<p>The commit that introduced such a conflict is<br />
f024ee098476 (&quot;KVM: PPC: Book3S HV: Pull out TM state save/restore into separate procedures&quot;)<br />
but issue really appears when change<br />
87a11bb6a7f7 (&quot;KVM: PPC: Book3S HV: Work around XER[SO] bug in fake suspend mode&quot;)<br />
is applied too because it creates a new stack to the two conflicting r1 stored<br />
to HSTATE_HOST_R1 are different.</p>
<p>The issue was fixed accidentally by<br />
6f597c6b63b6 (&quot;KVM: PPC: Book3S PR: Add guest MSR parameter for kvmppc_<wbr />save_tm(<wbr />)/kvmppc_<wbr />restore_<wbr />tm()&quot;)<br />
which is actually a change most related to Book3S PR.</p>
<p>This commit fixes the issue by backporting from 6f597c6b63b6 the part only<br />
responsible for storing r1 to a different memory location (HSTATE_SCRATCH2)<br />
avoiding the conflict and so the stack corruption.</p>
<p>On Ubuntu Bionic, tag &quot;Ubuntu-<wbr />4.15.0-<wbr />91.92&quot; is affected.</p></div>
  </div>

  
</div>


        <div style="margin:-10px 0 20px 5px" class="clearfix">
          
        </div>

        <div id="bug-tags">
          <span id="tags-heading">
            Tags:
          </span>
          <span id="tag-list">
            <a class="unofficial-tag" href="/ubuntu/+source/linux/+bugs?field.tag=ppc64el">ppc64el</a>
          </span>
          
          <a href="+edit" title="Edit tags" id="tags-trigger" class="sprite edit action-icon">Edit</a>
          <a href="/+help-bugs/tag-help.html" target="help" class="sprite maybe action-icon">Tag help</a>
        </div>

        <script type="text/javascript">
          LPJS.use('event', 'node', 'lp.bugs.tags_entry', function(Y) {
              Y.on('domready',
                   function(e) {
                       Y.lp.bugs.tags_entry.setup_tag_entry(
                           available_official_tags);
                   },
                   window);
          });
        </script>

        <div class="clearfix"></div>
      </div>

      <div id="branches-and-cves">
        <div id="bug-branches-container" style="float: left">
          
        </div><!-- bug-branch-container -->

        <div class="cves">
          <h2>CVE References</h2>
          <ul>
            <li class="sprite cve">
              <a href="/bugs/cve/2020-8834" title="KVM in the Linux kernel on Power8 pro...">2020-8834</a>
            </li>
          </ul>
        </div>

        <div class="clearfix"></div>
      </div> <!-- branches and CVEs -->

      </div>

      <div>
      
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/1" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mranweil" class="sprite person">Mike Ranweiler (mranweil)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-17T04:54:14.739467+00:00" title="2020-03-17 04:54:14 UTC">on 2020-03-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/1"> #1</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    <ul style="margin-bottom: 1em">
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+attachment/5337776/+files/0001-PPC-KVM-Book3S-HV-Fix-conflicting-use-of-HSTATE_HOST.patch">PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1</a>
        <a class="sprite edit action-icon" href="/ubuntu/+source/linux/+bug/1867717/+attachment/5337776">Edit</a>
        (8.4 KiB,
        text/plain)
      </li>
    </ul>

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10"></textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/2" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~mranweil" class="sprite person">Mike Ranweiler (mranweil)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-17T05:02:17.383898+00:00" title="2020-03-17 05:02:17 UTC">on 2020-03-17</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/2"> #2</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Xenial should not be affected - it doesn&#x27;t have 87a11bb6a7f7.  Since that&#x27;s a power9 specific patch it&#x27;s not something we would include.</p>
<p>There was no CVE for this right now - should we get one?</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Xenial should not be affected - it doesn't have 87a11bb6a7f7.  Since that's a power9 specific patch it's not something we would include.

There was no CVE for this right now - should we get one?</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fheimes" class="sprite person">Frank Heimes (fheimes)</a>
    
    <time title="2020-03-17 06:24:53 UTC" datetime="2020-03-17T06:24:53.054721+00:00">on 2020-03-17</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>tags</b>:
      </td>
      <td>
        added: ppc64el
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ubuntu-power-systems: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Ubuntu Security Team (ubuntu-security)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in linux (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Ubuntu Security Team (ubuntu-security)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in ubuntu-power-systems: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        Ubuntu Security Team (ubuntu-security) &#8594; Ubuntu on IBM Power Systems Bug Triage (ubuntu-power-triage)
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/3" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~seth-arnold" class="sprite person">Seth Arnold (seth-arnold)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-18T22:09:14.556426+00:00" title="2020-03-18 22:09:14 UTC">on 2020-03-18</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/3"> #3</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hello, I don&#x27;t understand when TM is available (power8 vs power9, hardware vs virtualized, powernv vs powervm guests, etc) -- is there a short summary of which systems are affected, in which ways?</p>
<p>Please use CVE-2020-8834 for this issue.</p>
<p>Thanks</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hello, I don't understand when TM is available (power8 vs power9, hardware vs virtualized, powernv vs powervm guests, etc) -- is there a short summary of which systems are affected, in which ways?

Please use CVE-2020-8834 for this issue.

Thanks</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/5" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gromero" class="sprite person">Gustavo Romero (gromero)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-19T20:12:18.799601+00:00" title="2020-03-19 20:12:18 UTC">on 2020-03-19</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/5"> #5</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>It seems the email reply didn&#x27;t work, so pasting here again (sorry if it yields a duplication later):</p>
<p>--</p>
<p>Hi Seth,</p>
<p>Well, it&#x27;s a mess and confusing...</p>
<p>PowerVM doesn&#x27;t share the same code base as KVM, so the bug doesn&#x27;t affect PowerVM, so it&#x27;s KVM-specific.</p>
<p>POWER8 has TM supported both on baremetal (PowerNV or powernv) and on KVM guests.<br />
The fix involves a hypercall implemented by the KVM, so it affects the POWER8 hosts running a KVM guest. In that case it&#x27;s like the guest is attacking the host and its (guest&#x27;s kernel) kernel version is no relevant to reproduce the issue.</p>
<p>POWER9 doesn&#x27;t support TM on baremetal, only on KVM guests, but TM is software assisted (due to a bug in the chip - that&#x27;s the reason on the other hand why it&#x27;s not supported on baremetal, only on guests), so the code path on the host when P9 guests use TM is a bit different.<br />
But I haven&#x27;t gone so far to able to explain why it doesn&#x27;t affect P9 hosts, but it&#x27;s probably be cause of the software assisted part. So, P9 hosts are not affected.</p>
<p>So, summing it up, it affects only POWER8 + KVM running Bionic 4.15 kernels.</p>
<p>BTW, I would be glad if credit could be attributed to me when filling up the CVE details, when applicable :)</p>
<p>Kind regards,<br />
Gustavo</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">It seems the email reply didn't work, so pasting here again (sorry if it yields a duplication later):

--

Hi Seth,
 
Well, it's a mess and confusing...
 
PowerVM doesn't share the same code base as KVM, so the bug doesn't affect PowerVM, so it's KVM-specific.
 
POWER8 has TM supported both on baremetal (PowerNV or powernv) and on KVM guests.
The fix involves a hypercall implemented by the KVM, so it affects the POWER8 hosts running a KVM guest. In that case it's like the guest is attacking the host and its (guest's kernel) kernel version is no relevant to reproduce the issue.
 
POWER9 doesn't support TM on baremetal, only on KVM guests, but TM is software assisted (due to a bug in the chip - that's the reason on the other hand why it's not supported on baremetal, only on guests), so the code path on the host when P9 guests use TM is a bit different.
But I haven't gone so far to able to explain why it doesn't affect P9 hosts, but it's probably be cause of the software assisted part. So, P9 hosts are not affected.
 
So, summing it up, it affects only POWER8 + KVM running Bionic 4.15 kernels.
 
BTW, I would be glad if credit could be attributed to me when filling up the CVE details, when applicable :)
 
 
Kind regards,
Gustavo</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/6" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~seth-arnold" class="sprite person">Seth Arnold (seth-arnold)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-23T23:23:31.855712+00:00" title="2020-03-23 23:23:31 UTC">on 2020-03-23</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/6"> #6</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hello Gustavo, yes I can credit you with the discovery.</p>
<p>Thanks for the explanation of which systems are affected, it helps me a lot.</p>
<p>Have you contacted other Linux distributions? IBM? Any other Power vendors?</p>
<p>Is this effect of this issue still private? If so, have you already coordinated a date with anyone else? If not, our kernel team may like to propose a date and time that would fit nicely with currently in-progress security issues.</p>
<p>Thanks</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hello Gustavo, yes I can credit you with the discovery.

Thanks for the explanation of which systems are affected, it helps me a lot.

Have you contacted other Linux distributions? IBM? Any other Power vendors?

Is this effect of this issue still private? If so, have you already coordinated a date with anyone else? If not, our kernel team may like to propose a date and time that would fit nicely with currently in-progress security issues.

Thanks</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/7" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gromero" class="sprite person">Gustavo Romero (gromero)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-24T20:32:42.645220+00:00" title="2020-03-24 20:32:42 UTC">on 2020-03-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/7"> #7</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hello Seth,</p>
<p>Thanks :)</p>
<p>No, I didn&#x27;t contacted any other distro or Power vendor. IBM, well, I think it&#x27;s basically only me working with that issue at IBM. I thought of talking to Michael Ellerman (PowerPC maintainer) but it&#x27;s fixed upstream on all stables and longterms afaics. Hence yes, effectively this issue is still private in my understanding.</p>
<p>Looking upstream, I only can see that release v4.17 was affected (not interesting anymore, right?):</p>
<p>f024ee098476 v4.8   -&gt; conflict was introduced<br />
87a11bb6a7f7 v4.17  -&gt; commit necessary to trigger stack corruption (needs f024ee098476)<br />
6f597c6b63b6 v4.18  -&gt; fixed accidentally</p>
<p>Thus, yeah, I think it&#x27;s better to coordinate an embargo with other distros on the closed security mailing just to let them at least try the simple test-case on the releases they deem appropriate. I believe it will also help Canonical to fit the fix nicely with currently in-progress security issues and next SRUs.</p>
<p>HTH.</p>
<p>Thanks,<br />
Gustavo</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hello Seth,

Thanks :)

No, I didn't contacted any other distro or Power vendor. IBM, well, I think it's basically only me working with that issue at IBM. I thought of talking to Michael Ellerman (PowerPC maintainer) but it's fixed upstream on all stables and longterms afaics. Hence yes, effectively this issue is still private in my understanding.

Looking upstream, I only can see that release v4.17 was affected (not interesting anymore, right?):

f024ee098476 v4.8   -&gt; conflict was introduced
87a11bb6a7f7 v4.17  -&gt; commit necessary to trigger stack corruption (needs f024ee098476)
6f597c6b63b6 v4.18  -&gt; fixed accidentally

Thus, yeah, I think it's better to coordinate an embargo with other distros on the closed security mailing just to let them at least try the simple test-case on the releases they deem appropriate. I believe it will also help Canonical to fit the fix nicely with currently in-progress security issues and next SRUs.

HTH.


Thanks,
Gustavo</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/8" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~cascardo" class="sprite person">Thadeu Lima de Souza Cascardo (cascardo)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-24T20:52:27.663924+00:00" title="2020-03-24 20:52:27 UTC">on 2020-03-24</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/8"> #8</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>I looked into linux-ibm-gt as this one has the fix, but a complete backport of the fixing commit. I backported the following 3 upstream commits and they apply cleanly. I am suggesting that after proper testing, we go with those 3 commits, as:</p>
<p>1) We end up with code more similar to upstream, making it easier to apply any followup fixes in the future;<br />
2) Both generic and ibm-gt end up with the same codebase, so we don&#x27;t maintain two very different codebases for 4.15.</p>
<p>The commits are:<br />
7b0e827c6970e8c<wbr />a77c60ae8759220<wbr />4c39e41245 KVM: PPC: Book3S HV: Factor fake-suspend handling out of kvmppc_<wbr />save/restore_<wbr />tm<br />
009c872a8bc4d38<wbr />f487a9bd62423d0<wbr />19e4322517 KVM: PPC: Book3S PR: Move kvmppc_<wbr />save_tm/<wbr />kvmppc_<wbr />restore_<wbr />tm to separate file<br />
6f597c6b63b6f36<wbr />75914b5ec8fcd00<wbr />8a58678650 KVM: PPC: Book3S PR: Add guest MSR parameter for kvmppc_<wbr />save_tm(<wbr />)/kvmppc_<wbr />restore_<wbr />tm()</p>
<p>Cascardo.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">I looked into linux-ibm-gt as this one has the fix, but a complete backport of the fixing commit. I backported the following 3 upstream commits and they apply cleanly. I am suggesting that after proper testing, we go with those 3 commits, as:

1) We end up with code more similar to upstream, making it easier to apply any followup fixes in the future;
2) Both generic and ibm-gt end up with the same codebase, so we don't maintain two very different codebases for 4.15.

The commits are:
7b0e827c6970e8ca77c60ae87592204c39e41245 KVM: PPC: Book3S HV: Factor fake-suspend handling out of kvmppc_save/restore_tm
009c872a8bc4d38f487a9bd62423d019e4322517 KVM: PPC: Book3S PR: Move kvmppc_save_tm/kvmppc_restore_tm to separate file
6f597c6b63b6f3675914b5ec8fcd008a58678650 KVM: PPC: Book3S PR: Add guest MSR parameter for kvmppc_save_tm()/kvmppc_restore_tm()

Cascardo.</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/9" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sbeattie" class="sprite person">Steve Beattie (sbeattie)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-30T16:25:47.523146+00:00" title="2020-03-30 16:25:47 UTC">on 2020-03-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/9"> #9</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>The Ubuntu Security Team is proposing a CRD of Monday, April 6th, 16:00 UTC.</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">The Ubuntu Security Team is proposing a CRD of Monday, April 6th, 16:00 UTC. </textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/10" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gromero" class="sprite person">Gustavo Romero (gromero)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-30T16:46:58.766847+00:00" title="2020-03-30 16:46:58 UTC">on 2020-03-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/10"> #10</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Hi,</p>
<p>I agreed on making the code base similar to the -gt kernel by applying the mentioned comments as Cascardo proposed.</p>
<p>Seth, btw, on the CVE credits, please add Paul Mackerras too.</p>
<p>Steve, thanks for update about the schedule for a fix.</p>
<p>Kind regards,<br />
Gustavo</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Hi,

I agreed on making the code base similar to the -gt kernel by applying the mentioned comments as Cascardo proposed.

Seth, btw, on the CVE credits, please add Paul Mackerras too.

Steve, thanks for update about the schedule for a fix.


Kind regards,
Gustavo</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/11" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~gromero" class="sprite person">Gustavo Romero (gromero)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-03-30T17:28:29.956137+00:00" title="2020-03-30 17:28:29 UTC">on 2020-03-30</time><span class="editable-message-last-edit-date">:
              </span>
              
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/11"> #11</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>s/I agreed/I agree/<br />
s/comments/commits/</p>
<p>sigh</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">s/I agreed/I agree/
s/comments/commits/

sigh</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fheimes" class="sprite person">Frank Heimes (fheimes)</a>
    
    <time title="2020-03-30 17:36:51 UTC" datetime="2020-03-30T17:36:51.112396+00:00">on 2020-03-30</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ubuntu-power-systems: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Triaged
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fheimes" class="sprite person">Frank Heimes (fheimes)</a>
    
    <time title="2020-04-06 10:28:34 UTC" datetime="2020-04-06T10:28:34.909785+00:00">on 2020-04-06</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ubuntu-power-systems: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>importance</b>:
      </td>
      <td>
        Undecided &#8594; High
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        
          
            <div xmlns="http://www.w3.org/1999/xhtml" itemscope="" itemtype="http://schema.org/UserComments" class="boardComment editable-message
                  " data-baseurl="/ubuntu/+source/linux/+bug/1867717/comments/12" data-i-can-edit="False">
  <div class="boardCommentDetails">
    <div class="message-revision-container">
      <div class="message-revision-container-header">
        <span>Revision history for this message</span>
        <img src="/+icing/build/overlay/assets/skins/sam/images/close.gif" class="message-revision-close" />
      </div>
      <script type="text/template">
        <div class='message-revision-item'>
          <div class='message-revision-title'>
              <a class="sprite remove action-icon message-revision-del-btn">
                  Remove
              </a>
              <a class="js-action">
                  Revision #{revision}, created at {date_created_display}
              </a>
          </div>
          <div class='message-revision-body'>{content}</div>
        </div>
      </script>
      <div class="message-revision-list"></div>
    </div>

    <table>
      <tbody>
        <tr>
          <td>
            <a href="https://launchpad.net/~sbeattie" class="sprite person">Steve Beattie (sbeattie)</a>
            wrote
            <time itemprop="commentTime" datetime="2020-04-09T00:45:46.269910+00:00" title="2020-04-09 00:45:46 UTC">on 2020-04-09</time><span class="editable-message-last-edit-date">:
              </span>
              <a href="/ubuntu/+source/linux/+bug/1867717/comments/12">
                <strong></strong>
              </a>
          </td>
          

          <td>
            
          </td>
          <td>
            
          </td>
          <td class="bug-comment-index">
          <a itemprop="url" href="/ubuntu/+source/linux/+bug/1867717/comments/12"> #12</a>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="boardCommentBody">
    

    

    

  
  <div class="editable-message-body">
    <div class="comment-text editable-message-text" itemprop="commentText"><p>Fixes for this issue were published in USN 4318-1 <a rel="nofollow" href="https://usn.ubuntu.com/4318-1/">https:/<wbr />/usn.ubuntu.<wbr />com/4318-<wbr />1/</a>. Closing this issue on the Ubuntu side of things and making the report public.</p>
<p>Thanks for all your help!</p></div>
    
    
    
  </div>

  <div class="editable-message-form" style="display: none">
     <textarea style="width: 100%" rows="10">Fixes for this issue were published in USN 4318-1 https://usn.ubuntu.com/4318-1/. Closing this issue on the Ubuntu side of things and making the report public.

Thanks for all your help!</textarea>
     <input type="button" value="Update" class="editable-message-update-btn" />
     <input type="button" value="Cancel" class="editable-message-cancel-btn" />
  </div>


  </div>

  <div class="boardCommentActivity">
    
      <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in linux (Ubuntu Bionic): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
    <tr>
      <td style="text-align: right;">
        <b>assignee</b>:
      </td>
      <td>
        nobody &#8594; Ubuntu Security Team (ubuntu-security)
      </td>
    </tr>
  
  
    
      <tr>
        <td colspan="2">Changed in linux (Ubuntu): </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        New &#8594; Fix Released
      </td>
    </tr>
  
  
    
      
    
    <tr>
      <td style="text-align: right;">
        <b>information type</b>:
      </td>
      <td>
        Private Security &#8594; Public Security
      </td>
    </tr>
  
</table>
    
    
  </div>
  
</div>

          

          

          

        
        
          

          
              <div class="boardComment">
  <div class="boardCommentDetails">
    
      <a href="https://launchpad.net/~fheimes" class="sprite person">Frank Heimes (fheimes)</a>
    
    <time title="2020-04-09 05:17:02 UTC" datetime="2020-04-09T05:17:02.725047+00:00">on 2020-04-09</time>
  </div>
  <div class="boardCommentActivity">
    <table class="bug-activity">
  
    
      <tr>
        <td colspan="2">Changed in ubuntu-power-systems: </td>
      </tr>
    
    <tr>
      <td style="text-align: right;">
        <b>status</b>:
      </td>
      <td>
        Triaged &#8594; Fix Released
      </td>
    </tr>
  
</table>
  </div>
</div>
          

          

        
        <div style="float: right;">
          <a class="menu-link-activitylog" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+activity">See full activity log</a>
        </div>
        <div class="clearfix"></div>

        
          

          
            <div align="center" id="add-comment-login-first">
              To post a comment you must <a href="+login?comments=all">log in</a>.
            </div>
          
        
        
      

      </div><!-- class="top-portlet" -->
      </div><!--- id="maincontentsub"-->
      <div>
        <div id="duplicate-form-container"></div>
        <div id="privacy-form-container"></div>
      </div>
    </div>
            
            
          </div><!-- yui-b -->
        </div><!-- yui-main -->

        
          <div id="side-portlets" class="yui-b side">
            
      <div id="involvement" class="portlet">
        <ul class="involvement">
          <li class="single">
            <a class="sprite bugs" href="/ubuntu/+source/linux/+filebug">
              Report a bug
            </a>
          </li>
        </ul>
      </div>
      <div id="privacy" class="first portlet public">
  <div id="privacy-text">
     <span id="information-type-summary" class="sprite public">This report contains
         <strong id="information-type">Public Security</strong>
         information
     </span>&nbsp;<a class="sprite edit action-icon" id="privacy-link" href="/ubuntu/+source/linux/+bug/1867717/+secrecy">Edit</a>

     <div id="information-type-description" style="padding-top: 5px">Everyone can see this security related information.
</div>
  </div>
</div>

      <div id="portlet-actions" class="portlet vertical">
  <ul id="duplicate-actions">
    <li class="sprite bug-dupe">
    <span id="mark-duplicate-text">
    <a class="menu-link-mark-dupe" href="/ubuntu/+source/linux/+bug/1867717/+duplicate">Mark as duplicate</a>
    </span>
    </li>
    
    <li><a class="menu-link-createquestion sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+create-question">Convert to a question</a></li>
    
    <li><a class="menu-link-addbranch sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+addbranch">Link a related branch</a></li>
    <li><a class="menu-link-linktocve sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+linkcve">Link to <abbr title="Common Vulnerabilities and Exposures Index">CVE</abbr></a></li>
    <li><a class="menu-link-unlinkcve sprite modify remove" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+unlinkcve">Remove CVE link</a></li>
  </ul>
</div>

      

      <div class="portlet vertical" id="portlet-subscription">
  <div class="section">
    <div id="current_user_subscription" class="False">
      
        <span>You are</span>
        
        <a class="menu-link-subscription sprite modify edit" href="/ubuntu/+source/linux/+bug/1867717/+subscribe">
           
           
           
           not directly subscribed to this bug's notifications.
        </a>
      
      
    </div>
    <div id="sub-unsub-spinner">Subscribing...</div>
    <ul>
      
      <li><a class="menu-link-editsubscriptions sprite modify edit" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+subscriptions" title="View and change your subscriptions to this bug">Edit bug mail</a></li>
    </ul>
  </div>
  <script type="text/javascript">
    LPJS.use('io-base', 'node',
            'lp.bugs.bugtask_index.portlets.subscription', function(Y) {
        Y.on('domready', function() {
            Y.lp.bugs.bugtask_index.portlets.subscription.initialize();
        });
    });
  </script>
</div>

      <div class="portlet vertical" id="portlet-subscribers">
  <h2>Other bug subscribers</h2>
  <div>
    <div><a class="menu-link-addsubscriber sprite add" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+addsubscriber" title="Launchpad will email that person whenever this bugs changes">Subscribe someone else</a></div>
  </div>
  <div id="other-bug-subscribers"></div>
</div>

      

      

      
  <div class="portlet" id="portlet-patches">
    <h2>Patches</h2>
    <ul>
      <li class="download-attachment">
        <a class="sprite haspatch-icon" href="https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+attachment/5337776/+files/0001-PPC-KVM-Book3S-HV-Fix-conflicting-use-of-HSTATE_HOST.patch">PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1</a>
        <small>
          (<a href="/ubuntu/+source/linux/+bug/1867717/+attachment/5337776">edit</a>)
        </small>
      </li>
    </ul>
    <ul>
      <li>
        <a class="sprite add" href="/ubuntu/+source/linux/+bug/1867717/+addcomment?field.patch=on">Add patch</a>
      </li>
    </ul>
  </div>
  


      

    
          </div><!-- yui-b side -->
        
      </div><!-- yui-t4 -->

      
  <div id="footer" class="footer">
    <div class="lp-arcana">
        <div class="lp-branding">
          <a href="https://launchpad.net/"><img src="/@@/launchpad-logo-and-name-hierarchy.png" alt="Launchpad" /></a>
          &nbsp;&bull;&nbsp;
          <a href="https://launchpad.net/+tour">Take the tour</a>
          &nbsp;&bull;&nbsp;
          <a href="https://help.launchpad.net/">Read the guide</a>
          &nbsp;
          <form id="globalsearch" method="get" accept-charset="UTF-8" action="https://launchpad.net/+search">
            <input type="search" id="search-text" name="field.text" />
            <input type="image" src="/@@/search" style="vertical-align:5%" alt="Search Launchpad" />
          </form>
        </div>
        
  

    </div>

    <div class="colophon">
      &copy; 2004-2021
      <a href="http://canonical.com/">Canonical&nbsp;Ltd.</a>
      &nbsp;&bull;&nbsp;
      <a href="https://launchpad.net/legal">Terms of use</a>
      &nbsp;&bull;&nbsp;
      <a href="https://www.ubuntu.com/legal/dataprivacy">Data privacy</a>
      &nbsp;&bull;&nbsp;
      <a href="/feedback">Contact Launchpad Support</a>
      
      &nbsp;&bull;&nbsp;
      <a href="http://blog.launchpad.net/">Blog</a>
      
	&nbsp;&bull;&nbsp;
	<a href="https://canonical.com/careers">Careers</a>
      
      &nbsp;&bull;&nbsp;
      <a href="https://twitter.com/launchpadstatus">System status</a>
      <span id="lp-version">
      &nbsp;&bull;&nbsp;
        r0d8de2b
        
        
        (<a href="https://dev.launchpad.net/">Get the code!</a>)
      </span>
    </div>
  </div>

    </div><!-- yui-d0-->

    
  
  
  <script id="json-cache-script">LP.cache = {"subscribers_portlet_url_data": {"web_link": "https://bugs.launchpad.net/bugs/1867717", "self_link": "https://bugs.launchpad.net/api/devel/bugs/1867717"}, "information_type_data": {"PUBLIC": {"description": "Everyone can see this information.\n", "name": "Public", "is_private": false, "order": 0, "description_css_class": "choice-description", "value": "PUBLIC"}, "PUBLICSECURITY": {"description": "Everyone can see this security related information.\n", "name": "Public Security", "is_private": false, "order": 1, "description_css_class": "choice-description", "value": "PUBLICSECURITY"}, "USERDATA": {"description": "Only shared with users permitted to see private user information.\n", "name": "Private", "is_private": true, "order": 3, "description_css_class": "choice-description", "value": "USERDATA"}, "PRIVATESECURITY": {"description": "Only the security group can see this information.\n ", "name": "Private Security", "is_private": true, "order": 2, "description_css_class": "choice-description", "value": "PRIVATESECURITY"}}, "total_comments_and_activity": 39, "bug_is_private": false, "related_features": {}, "first visible_recent_comment": -28, "bug": {"self_link": "https://bugs.launchpad.net/api/devel/bugs/1867717", "web_link": "https://bugs.launchpad.net/bugs/1867717", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug", "id": 1867717, "private": false, "information_type": "Public Security", "name": null, "title": "PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1", "description": "---Problem Description---\nCurrently a malicious user can craft a code to be executed in the guest kernel space that puts CPU in TM suspended mode and call a hypercall (for instance H_PUT_TERM_CHAR, token 0x58) leading to a kernel panic on host. I was not able to reproduce it upstream, nonetheless it's reproducible on most updated stock kernel for Ubuntu Bionic Beaver, i.e 4.15.0-76.86. Guest kernel version is not meaningful unless TM facility is disabled (it must be enabled).\n\n\n---Steps to Reproduce---\n The following hypercall fuzzer I'll trigger it: https://github.com/gromero/hinjector\n\n$ git clone https://github.com/gromero/hinjector.git \u0026\u0026 cd hinjector\n$ make\n$ make insmod\n$ sudo ./injector\n\n\n\n\nCurrently it's possible to crash a host from a guest by calling a hypercall when\nCPU is in TM suspended mode. Whilst on guest a TM Bad Thing is caught, on host\nthe following traces are observed:\n\n[  618.563991] Oops: Exception in kernel mode, sig: 4 [#1]\n[  618.563994] LE SMP NR_CPUS=2048 NUMA PowerNV\n[  618.563999] Modules linked in: xt_CHECKSUM iptable_mangle ipt_MASQUERADE\nnf_nat_masquerade_ipv4 iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4\nnf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4 xt_tcpudp bridge\nstp llc ebtable_filter ebtables devlink ip6table_filter ip6_tables iptable_filter\nkvm_hv kvm vmx_crypto ipmi_powernv ipmi_devintf ipmi_msghandler uio_pdrv_genirq\nuio leds_powernv crct10dif_vpmsum ibmpowernv powernv_rng sch_fq_codel nfsd auth_rpcgss\nnfs_acl lockd grace sunrpc ip_tables x_tables autofs4 xfs btrfs zstd_compress\nraid10 raid456 async_raid6_recov async_memcpy async_pq async_xor async_tx xor\nraid6_pq libcrc32c raid1 raid0 multipath linear lpfc crc32c_vpmsum nvmet_fc\nnvmet nvme_fc nvme_fabrics nvme_core tg3 ipr scsi_transport_fc\n[  618.564064] CPU: 51 PID: 0 Comm: swapper/51 Not tainted 4.15.0-76-generic #86-Ubuntu\n[  618.564066] NIP:  0000000000000000 LR: 0000000000000000 CTR: d0000000072f0580\n[  618.564068] REGS: c00000003fd9bca0 TRAP: 0e40   Not tainted  (4.15.0-76-generic)\n[  618.564068] MSR:  9000000102883003 \u003cSF,HV,VEC,VSX,FP,ME,RI,LE,TM[E]\u003e  CR: 28200222  XER: 20000000\n[  618.564077] CFAR: c0000000000f53f0 SOFTE: 0\n[  618.564077] GPR00: 0000000000000000 c00000003fd9bf20 c00000000171c800 0000000000000000\n[  618.564077] GPR04: c000000ff4d10000 c0000000ff067400 000000000ad0cc9e c0000000000fb4bc\n[  618.564077] GPR08: 804800000180f000 c000000dcabcbe80 0000000000000000 0000000020000000\n[  618.564077] GPR12: 0000000000000e80 c00000000faa3100 0000000000000000 0000000000000000\n[  618.564077] GPR16: 0000000000000000 0000000000000000 0000000000000000 0000000000000000\n[  618.564077] GPR20: 0000000000000000 0000000000000000 0000000000000000 0000000000000000\n[  618.564077] GPR24: 0000000000000000 d0000000072e0158 000000000000009b 000000000000009c\n[  618.564077] GPR28: 000000000000009c 0000000000000000 0000000000000000 0010000000000000\n[  618.564100] NIP [0000000000000000]           (null)\n[  618.564101] LR [0000000000000000]           (null)\n[  618.564101] Call Trace:\n[  618.564102] Instruction dump:\n[  618.564105] XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX\n[  618.564109] XXXXXXXX XXXXXXXX XXXXXXXX XXXXXXXX 0100421c f2820104 0000001b 00000132\n[  618.564118] ---[ end trace f0be3cc10ea6fc44 ]---\n[  618.569897]\n[  618.593555] KVM: CPU 51 seems to be stuck\n[  258.967652] Kernel panic - not syncing: Attempted to kill the idle task!\n[  258.967677] Unable to handle kernel paging request for data at address 0xc000001ff6c9d700\n[  618.596478] Faulting instruction address: 0xc000000000077cf0\n[  618.596479] Oops: Kernel access of bad area, sig: 11 [#2]\n[  618.596480] LE SMP NR_CPUS=2048 NUMA PowerNV\n[  618.596482] Modules linked in: xt_CHECKSUM iptable_mangle ipt_MASQUERADE\nnf_nat_masquerade_ipv4 iptable_nat nf_nat_ipv4 nf_nat nf_conntrack_ipv4\nnf_defrag_ipv4 xt_conntrack nf_conntrack ipt_REJECT nf_reject_ipv4\nxt_tcpudp bridge stp llc ebtable_filter ebtables devlink ip6table_filter\nip6_tables iptable_filter kvm_hv kvm vmx_crypto ipmi_powernv ipmi_devintf\nipmi_msghandler uio_pdrv_genirq uio leds_powernv crct10dif_vpmsum ibmpowernv\npowernv_rng sch_fq_codel nfsd auth_rpcgss nfs_acl lockd grace sunrpc ip_tables\nx_tables autofs4 xfs btrfs zstd_compress raid10 raid456 async_raid6_recov\nasync_memcpy async_pq async_xor async_tx xor raid6_pq libcrc32c raid1 raid0\nmultipath linear lpfc crc32c_vpmsum nvmet_fc nvmet nvme_fc nvme_fabrics\nnvme_core tg3 ipr scsi_transport_fc\n[  618.596521] CPU: 51 PID: 0 Comm: swapper/51 Tainted: G      D          4.15.0-76-generic #86-Ubuntu\n[  618.596522] NIP:  c000000000077cf0 LR: c000000000080c84 CTR: c000000000077c90\n[  618.596524] REGS: c00000003fd9b040 TRAP: 0300   Tainted: G      D           (4.15.0-76-generic)\n[  618.596524] MSR:  9000000000001033 \u003cSF,HV,ME,IR,DR,RI,LE\u003e  CR: 28244242  XER: 00000000\n[  618.596530] CFAR: c000000000080c80 DAR: c000001ff6c9d700 DSISR: 40000000 SOFTE: 0\n[  618.596530] GPR00: c000000000080c84 c00000003fd9b2c0 c00000000171c800 0000000006c9d700\n[  618.596530] GPR04: 00000000000001ac 0071d13aa0080040 0000000000000002 0000000000000002\n[  618.596530] GPR08: 0000000000000001 0000000000000002 00000e3a27540100 c000001ff6c9d700\n[  618.596530] GPR12: c000001ff0000000 c00000000faa3100 0000000000000000 0000000000000000\n[  618.596530] GPR16: 0000000000000004 0071d13aa0080040 00000000000001ac c0000000018be858\n[  618.596530] GPR20: 800000000000000e d00038008004000c 00000000071d13aa c0000000018be280\n[  618.596530] GPR24: 0000000000000001 0000000000000002 0000000000000300 0000000000000300\n[  618.596530] GPR28: 4000000000000000 0000000000000000 c0000000018be2d0 00000000000000b0\n[  618.596560] NIP [c000000000077cf0] native_hpte_updatepp+0x60/0x680\n[  618.596562] LR [c000000000080c84] __hash_page_64K+0x4c4/0x560\n[  618.596562] Call Trace:\n[  618.596563] Instruction dump:\n[  618.596565] 791cf046 3fc2001a 3bde1ad0 3d62001a 396b2188 91810008 f821ff71 7fbefa14\n[  618.596570] ebbd0048 e98b0000 7d4ae878 7d6c1a14 \u003c7c0c1c28\u003e 794a3e24 7f9c5378 48000018\n[  618.596576] ---[ end trace f0be3cc10ea6fc45 ]---\n[  618.602738]\n[  618.625946] KVM: CPU 51 seems to be stuck\n[  258.999498] Kernel panic - not syncing: Attempted to kill the idle task!\n[  618.653500] KVM: CPU 51 seems to be stuck\n\nThis is due to conflicting use of HSTATE_HOST_R1 to store r1 state in\nkvmppc_hv_entry plus in kvmppc_{save,restore}_tm leading to a stack corruption.\n\nThe commit that introduced such a conflict is\nf024ee098476 (\"KVM: PPC: Book3S HV: Pull out TM state save/restore into separate procedures\")\nbut issue really appears when change\n87a11bb6a7f7 (\"KVM: PPC: Book3S HV: Work around XER[SO] bug in fake suspend mode\")\nis applied too because it creates a new stack to the two conflicting r1 stored\nto HSTATE_HOST_R1 are different.\n\nThe issue was fixed accidentally by\n6f597c6b63b6 (\"KVM: PPC: Book3S PR: Add guest MSR parameter for kvmppc_save_tm()/kvmppc_restore_tm()\")\nwhich is actually a change most related to Book3S PR.\n\nThis commit fixes the issue by backporting from 6f597c6b63b6 the part only\nresponsible for storing r1 to a different memory location (HSTATE_SCRATCH2)\navoiding the conflict and so the stack corruption.\n\nOn Ubuntu Bionic, tag \"Ubuntu-4.15.0-91.92\" is affected.", "owner_link": "https://bugs.launchpad.net/api/devel/~mranweil", "bug_tasks_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/bug_tasks", "duplicate_of_link": null, "date_created": "2020-03-17T04:54:14.739467+00:00", "activity_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/activity", "subscriptions_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/subscriptions", "date_last_updated": "2020-04-09T05:17:04.384622+00:00", "who_made_private_link": null, "date_made_private": null, "heat": 278, "bug_watches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/bug_watches", "cves_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/cves", "duplicates_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/duplicates", "attachments_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/attachments", "security_related": true, "latest_patch_uploaded": "2020-03-17T04:54:14.739467+00:00", "tags": ["ppc64el"], "date_last_message": "2020-04-09T00:45:46.269910+00:00", "number_of_duplicates": 0, "message_count": 13, "users_affected_count": 1, "users_unaffected_count": 0, "users_affected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/users_affected", "users_unaffected_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/users_unaffected", "users_affected_count_with_dupes": 1, "other_users_affected_count_with_dupes": 1, "users_affected_with_dupes_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/users_affected_with_dupes", "messages_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/messages", "linked_branches_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/linked_branches", "linked_merge_proposals_collection_link": "https://bugs.launchpad.net/api/devel/bugs/1867717/linked_merge_proposals", "http_etag": "\"f6b70fb149817e744065a17b392e0e5ad8c9d084-41c89deb6e7390dd96cecc1553d14f8f34286b9c\""}, "bugtask_data": {"2582553": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/ubuntu-power-systems/+bug/1867717", "assignee_value": "ubuntu-power-triage", "user_can_edit_status": true, "bug_title": "PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1", "user_can_edit_milestone": false, "prefix": "ubuntu-power-systems", "form_row_id": "task2582553", "target_is_product": true, "user_can_edit_importance": false, "assignee_is_team": true, "delete_link": "https://bugs.launchpad.net/ubuntu-power-systems/+bug/1867717/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Fix Released", "importance_value": "High", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary2582553", "assignee_vocabulary_filters": [], "targetname": "The Ubuntu-power-systems project", "importance_widget_items": "[]", "milestone_value": null, "id": 2582553}, "2582558": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/ubuntu/+source/linux/+bug/1867717", "assignee_value": "ubuntu-security", "user_can_edit_status": true, "bug_title": "PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1", "user_can_edit_milestone": false, "prefix": "ubuntu_linux", "form_row_id": "task2582558", "target_is_product": false, "user_can_edit_importance": false, "assignee_is_team": true, "delete_link": "https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Fix Released", "importance_value": "Undecided", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary2582558", "assignee_vocabulary_filters": [], "targetname": "linux (Ubuntu)", "importance_widget_items": "[]", "milestone_value": null, "id": 2582558}, "2590446": {"assignee_vocabulary": "AllUserTeamsParticipation", "user_can_unassign": false, "bugtask_path": "/ubuntu/bionic/+source/linux/+bug/1867717", "assignee_value": "ubuntu-security", "user_can_edit_status": true, "bug_title": "PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1", "user_can_edit_milestone": false, "prefix": "ubuntu_bionic_linux", "form_row_id": "task2590446", "target_is_product": false, "user_can_edit_importance": false, "assignee_is_team": true, "delete_link": "https://bugs.launchpad.net/ubuntu/bionic/+source/linux/+bug/1867717/+delete", "user_can_edit_assignee": false, "milestone_widget_items": "[]", "status_widget_items": "[]", "status_value": "Fix Released", "importance_value": "Undecided", "hide_assignee_team_selection": true, "user_can_delete": false, "row_id": "tasksummary2590446", "assignee_vocabulary_filters": [], "targetname": "linux (Ubuntu Bionic)", "importance_widget_items": "[]", "milestone_value": null, "id": 2590446}}, "context": {"self_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/linux/+bug/1867717", "web_link": "https://bugs.launchpad.net/ubuntu/+source/linux/+bug/1867717", "resource_type_link": "https://bugs.launchpad.net/api/devel/#bug_task", "bug_link": "https://bugs.launchpad.net/api/devel/bugs/1867717", "milestone_link": null, "status": "Fix Released", "importance": "Undecided", "assignee_link": "https://bugs.launchpad.net/api/devel/~ubuntu-security", "bug_target_display_name": "linux (Ubuntu)", "bug_target_name": "linux (Ubuntu)", "bug_watch_link": null, "date_assigned": "2020-03-17T06:25:16.704103+00:00", "date_created": "2020-03-17T06:19:55.451773+00:00", "date_confirmed": "2020-04-09T00:48:13.163332+00:00", "date_incomplete": null, "date_in_progress": "2020-04-09T00:48:13.163332+00:00", "date_closed": "2020-04-09T00:48:13.163332+00:00", "date_left_new": "2020-04-09T00:48:13.163332+00:00", "date_triaged": "2020-04-09T00:48:13.163332+00:00", "date_fix_committed": "2020-04-09T00:48:13.163332+00:00", "date_fix_released": "2020-04-09T00:48:13.163332+00:00", "date_left_closed": null, "owner_link": "https://bugs.launchpad.net/api/devel/~fheimes", "target_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/linux", "title": "Bug #1867717 in linux (Ubuntu): \"PPC: KVM: Book3S HV: Fix conflicting use of HSTATE_HOST_R1\"", "related_tasks_collection_link": "https://bugs.launchpad.net/api/devel/ubuntu/+source/linux/+bug/1867717/related_tasks", "is_complete": true, "http_etag": "\"b2638fd2b4be7d470b2b443a3bc1df408f92d5cc-9305a58a306aa2027c0e139489a2fe1a0d748c90\""}, "initial_comment_batch_offset": 41};</script>

    
  

    
  </body>


  <!--
    Facet name: bugs
    Page type: main_side
    Has global search: True
    Has application tabs: True
    Has side portlets: True

    At least 72 queries/external actions issued in 0.99 seconds

    Features: {'app.maintenance_message': None, 'visible_render_time': None, 'bugs.affected_count_includes_dupes.disabled': None, 'app.mainsite_only.canonical_url': None, 'disclosure.dsp_picker.enabled': 'on', 'bugs.nominations.bug_supervisors_can_target': 'on', 'baselayout.careers_link.disabled': None, 'hard_timeout': '9000', 'js.yui_version': None, 'profiling.enabled': None}

    r0d8de2b

    -->

</html>

