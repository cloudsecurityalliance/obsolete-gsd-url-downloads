<!DOCTYPE html>
<html lang="en">
  <head>
    <title>167239 &ndash; ArityFixup should adjust SP first</title>

      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<link href="data/assets/52436921e68ed468d372628fc792a752.css?1591398800" rel="stylesheet" type="text/css">

<link href="data/assets/3173de5410adb6e3827752fbd2bfd7b4.css?1591398794" rel="stylesheet" type="text/css">

    
<script type="text/javascript" src="data/assets/a7c2f3a028f17a9aa60f56dc9d6e732d.js?1591398800"></script>

    <script type="text/javascript">
    <!--
        YAHOO.namespace('bugzilla');
        YAHOO.util.Event.addListener = function (el, sType, fn, obj, overrideContext) {
               if ( ("onpagehide" in window || YAHOO.env.ua.gecko) && sType === "unload") { sType = "pagehide"; };
               var capture = ((sType == "focusin" || sType == "focusout") && !YAHOO.env.ua.ie) ? true : false;
               return this._addListener(el, this._getType(sType), fn, obj, overrideContext, capture);
         };
        if ( "onpagehide" in window || YAHOO.env.ua.gecko) {
            YAHOO.util.Event._simpleRemove(window, "unload", 
                                           YAHOO.util.Event._unload);
        }
        
        function unhide_language_selector() { 
            YAHOO.util.Dom.removeClass(
                'lang_links_container', 'bz_default_hidden'
            ); 
        } 
        YAHOO.util.Event.onDOMReady(unhide_language_selector);

        
        var BUGZILLA = {
            param: {
                cookiepath: '\/',
                maxusermatches: 1000
            },
            constant: {
                COMMENT_COLS: 80
            },
            string: {
                

                attach_desc_required:
                    "You must enter a Description for this attachment.",
                component_required:
                    "You must select a Component for this bug.",
                description_required:
                    "You must enter a Description for this bug.",
                short_desc_required:
                    "You must enter a Summary for this bug.",
                version_required:
                    "You must select a Version for this bug."
            }
              , api_token: ''
        };

    if (history && history.replaceState) {
      if(!document.location.href.match(/show_bug\.cgi/)) {
        history.replaceState( null,
                             "167239 – ArityFixup should adjust SP first",
                             "show_bug.cgi?id=167239" );
        document.title = "167239 – ArityFixup should adjust SP first";
      }
      if (document.location.href.match(/show_bug\.cgi\?.*list_id=/)) {
        var href = document.location.href;
        href = href.replace(/[\?&]+list_id=(\d+|cookie)/, '');
        history.replaceState(null, "167239 – ArityFixup should adjust SP first", href);
      }
    }
    YAHOO.util.Event.onDOMReady(function() {
      initDirtyFieldTracking();

    });
    // -->
    </script>
<script type="text/javascript" src="data/assets/daf5e0fb6826e6a35280e622913f0c4a.js?1591398800"></script>


    


    
    <link rel="search" type="application/opensearchdescription+xml"
                       title="Bugzilla" href="./search_plugin.cgi">
    <link rel="shortcut icon" href="images/favicon.ico">
  </head>

  <body 
        class="bugs-webkit-org
                 bz_bug
                 bz_status_RESOLVED
                 bz_product_WebKit
                 bz_component_WebCore_JavaScript
                 bz_bug_167239 yui-skin-sam">


  <div id="header">

    


    <div id="titles">

      <span id="title"> WebKit Bugzilla</span>



    </div>



        <div id="bug_title">Bug&nbsp;167239: ArityFixup should adjust SP first</div>


    <div id="common_links"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_top" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_top");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_top" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_top"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_top">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_top">
  <span class="separator">| </span>
  <a id="login_link_top" href="show_bug.cgi?id=167239&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_top')">Log In</a>

  <form action="show_bug.cgi?id=167239" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_top">
    <input id="Bugzilla_login_top" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_top" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_top">
    <a href="#" onclick="return hide_mini_login_form('_top')">[x]</a>
  </form>
</li>


  <li id="forgot_container_top">
    <span class="separator">| </span>
    <a id="forgot_link_top" href="show_bug.cgi?id=167239&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_top')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_top"
          class="mini_forgot bz_default_hidden">
      <label for="login_top">Login:</label>
      <input name="loginname" size="20" id="login_top" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_top" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_top" name="token"
             value="1635620799-oepWN8FXqUWglSfsyGmpaI_EOkEA1JiUrSpwYXgA7co">
      <a href="#" onclick="return hide_forgot_form('_top')">[x]</a>
    </form>
  </li>
</ul>
    </div>
  </div>


  <div id="bugzilla-body">


<script type="text/javascript">
<!--

//-->
</script>

<form name="changeform" id="changeform" method="post" action="process_bug.cgi">

  <input type="hidden" name="delta_ts" value="2017-02-17 06:24:43">
  <input type="hidden" name="id" value="167239">
  <input type="hidden" name="token" value="1635620799-5Zjn-OdhJLNwrKJWPbdPBS7OXV9-_X1Dospb4-8lOEc">
<div class="bz_short_desc_container edit_form">
     <a href="show_bug.cgi?id=167239"><b>Bug&nbsp;167239</b></a> <span id="summary_container" class="bz_default_hidden">
      - <span id="short_desc_nonedit_display">ArityFixup should adjust SP first</span>
     </span>

    <div id="summary_input"><span class="field_label "
    id="field_label_short_desc">


  <a 
      title="The bug summary is a short sentence which succinctly describes what the bug is about."
      class="field_help_link"
      href="page.cgi?id=fields.html#short_desc"
  >Summary:</a>

</span>ArityFixup should adjust SP first
    </div>
  </div>
  <script type="text/javascript">
    hideEditableField('summary_container',
                      'summary_input',
                      'summary_edit_action',
                      'short_desc',
                      'ArityFixup should adjust SP first' );
  </script>

  <table id="bug_details" class="edit_form">

    <tr>
      
      <td id="bz_show_bug_column_1" class="bz_show_bug_column">     
        <table>
          <tr>
    <th class="field_label">
      <a href="page.cgi?id=fields.html#bug_status">Status</a>:
    </th>
    <td id="bz_field_status">
      <span id="static_bug_status">RESOLVED
          FIXED
      </span>
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_alias">


  <a 
      title="A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla."
      class="field_help_link"
      href="page.cgi?id=fields.html#alias"
  >Alias:</a>

</th>
    <td>
        None
    </td>
  </tr>
<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_product">


  <a 
      title="Bugs are categorised into Products and Components."
      class="field_help_link"
      href="describecomponents.cgi"
  >Product:</a>

</th>
  <td class="field_value "
      id="field_container_product" >WebKit

</td>
    </tr>

    
    <tr class="bz_default_hidden"><th class="field_label "
    id="field_label_classification">


  <a 
      title="Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation."
      class="field_help_link"
      href="page.cgi?id=fields.html#classification"
  >Classification:</a>

</th>
  <td class="field_value "
      id="field_container_classification" >Unclassified

</td>
    </tr>
        
    
    
    <tr><th class="field_label "
    id="field_label_component">


  <a 
      title="Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list."
      class="field_help_link"
      href="describecomponents.cgi?product=WebKit"
  >Component:</a>

</th>
  <td class="field_value "
      id="field_container_component" >WebCore JavaScript

  (<a href="buglist.cgi?component=WebCore%20JavaScript&amp;product=WebKit&amp;bug_status=__open__"
      target="_blank">show other bugs</a>)
</td>
    </tr>
    <tr>
<th class="field_label "
    id="field_label_version">


  <a 
      title="The version field defines the version of the software the bug was found in."
      class="field_help_link"
      href="page.cgi?id=fields.html#version"
  >Version:</a>

</th>
<td>WebKit Nightly Build
  </td>

    </tr>
        
    
        
    <tr><th class="field_label "
    id="field_label_rep_platform">


  <a 
      title="The hardware platform the bug was observed on. Note: When searching, selecting the option &quot;All&quot; only finds bugs whose value for this field is literally the word &quot;All&quot;."
      class="field_help_link"
      href="page.cgi?id=fields.html#rep_platform"
  >Hardware:</a>

</th>
      <td class="field_value">PC
        Linux
      </td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          
          <tr>
      <th class="field_label">
        <label  accesskey="i">
          <a href="page.cgi?id=fields.html#importance"><u>I</u>mportance</a></label>:
      </th>
      <td>P2

       Normal

      </td>
    </tr>
          
          <tr><th class="field_label "
    id="field_label_assigned_to">


  <a 
      title="The person in charge of resolving the bug."
      class="field_help_link"
      href="page.cgi?id=fields.html#assigned_to"
  >Assignee:</a>

</th>
      <td><span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
      </td>
    </tr>


    <script type="text/javascript">
      assignToDefaultOnChange(['product'],
        'webkit-unassigned\x40lists.webkit.org',
        '');
    </script>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
          <tr><th class="field_label "
    id="field_label_bug_file_loc">


  <a 
      title="Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen."
      class="field_help_link"
      href="page.cgi?id=fields.html#bug_file_loc"
  >URL:</a>

</th>
    <td>
      <span id="bz_url_input_area">
      </span>
    </td>
  </tr>


    <tr><th class="field_label "
    id="field_label_keywords">


  <a 
      title="You can add keywords from a defined list to bugs, in order to easily identify and group them."
      class="field_help_link"
      href="describekeywords.cgi"
  >Keywords:</a>

</th>
  <td class="field_value "
      id="field_container_keywords" >InRadar

</td>
    </tr>
          <tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>

          
<tr><th class="field_label "
    id="field_label_dependson">


  <a 
      title="The bugs listed here must be resolved before this bug can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#dependson"
  >Depends on:</a>

</th>

  <td>
    <span id="dependson_input_area">
    </span>

  </td>
  </tr>
  
  <tr><th class="field_label "
    id="field_label_blocked">


  <a 
      title="This bug must be resolved before the bugs listed in this field can be resolved."
      class="field_help_link"
      href="page.cgi?id=fields.html#blocked"
  >Blocks:</a>

</th>

  <td>
    <span id="blocked_input_area">
    </span>

  </td>
  </tr>
          
        </table>
      </td>
      <td>
        <div class="bz_column_spacer">&nbsp;</div>
      </td>
      
      <td id="bz_show_bug_column_2" class="bz_show_bug_column">
        <table>
        <tr>
    <th class="field_label">
      Reported:
    </th>
    <td>2017-01-20 05:59 PST by <span class="vcard"><span class="fn">Kamil Frankowicz</span>
</span>
    </td>
  </tr>
  
  <tr>
    <th class="field_label">
      Modified:
    </th>
    <td>2017-02-17 06:24 PST
      (<a href="show_activity.cgi?id=167239">History</a>)
    </td>
  
  </tr>
<tr>
      <th class="field_label">
        <label  accesskey="a">
          CC List:
        </label>
      </th>
      <td>12 
          users
          <span id="cc_edit_area_showhide_container" class="bz_default_hidden">
            (<a href="#" id="cc_edit_area_showhide">show</a>)
          </span>
        <div id="cc_edit_area">
          <br>
            <select id="cc" multiple="multiple" size="5" >
                <option value="ap">ap</option>
                <option value="bugs-noreply">bugs-noreply</option>
                <option value="commit-queue">commit-queue</option>
                <option value="fpizlo">fpizlo</option>
                <option value="keith_miller">keith_miller</option>
                <option value="mark.lam">mark.lam</option>
                <option value="mcatanzaro">mcatanzaro</option>
                <option value="msaboff">msaboff</option>
                <option value="sbarati">sbarati</option>
                <option value="tpopela">tpopela</option>
                <option value="webkit-bug-importer">webkit-bug-importer</option>
                <option value="ysuzuki">ysuzuki</option>
            </select>
        </div>
          <script type="text/javascript">
            hideEditableField( 'cc_edit_area_showhide_container', 
                               'cc_edit_area', 
                               'cc_edit_area_showhide', 
                               '', 
                               '');  
          </script>
      </td>
    </tr>

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>
<tr><th class="field_label "
    id="field_label_see_also">


  <a 
      title="This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields."
      class="field_help_link"
      href="page.cgi?id=fields.html#see_also"
  >See Also:</a>

</th>
  <td class="field_value "
      id="field_container_see_also" >

</td>
    </tr> 

<tr>
    <td colspan="2" class="bz_section_spacer"></td>
  </tr>



        </table>
      </td>
    </tr>
    <tr>
      <td colspan="3">
          <hr id="bz_top_half_spacer">
      </td>
    </tr>
  </table>

  <table id="bz_big_form_parts">
  <tr>
  <td>

    
<script src="js/status-bubble.js?1584556449"></script>
<script type="text/javascript">
<!--
window.addEventListener('message', handleStatusBubbleMessage, false);

function toggle_display(link) {
    var table = document.getElementById("attachment_table");
    var view_all = document.getElementById("view_all");
    var hide_obsolete_url_parameter = "&hide_obsolete=1";
    // Store current height for scrolling later
    var originalHeight = table.offsetHeight;
    var rows = YAHOO.util.Dom.getElementsByClassName(
        'bz_tr_obsolete', 'tr', table);

    for (var i = 0; i < rows.length; i++) {
        bz_toggleClass(rows[i], 'bz_default_hidden');
    }

    if (YAHOO.util.Dom.hasClass(rows[0], 'bz_default_hidden')) {
        link.innerHTML = "Show Obsolete";
        view_all.href = view_all.href + hide_obsolete_url_parameter 
    }
    else {
        link.innerHTML = "Hide Obsolete";
        view_all.href = view_all.href.replace(hide_obsolete_url_parameter,"");
    }

    var newHeight = table.offsetHeight;
    // This scrolling makes the window appear to not move at all.
    window.scrollBy(0, newHeight - originalHeight);

    return false;
}
//-->
</script>

<br>
<table id="attachment_table">
  <tr id="a0">
    <th colspan="3" class="left">
      Attachments
    </th>
  </tr>


      <tr id="a1" class="bz_contenttype_application_javascript"


      >
        <td>
            <a href="attachment.cgi?id=299345"
               title="View the content of the attachment">
          <b>POC to heap out of bounds write (jsc)</b></a>

          <span class="bz_attach_extra_info">
              (117 bytes,
                application/javascript)

            <br>
            <a href="#attach_299345"
               title="Go to the comment associated with the attachment">2017-01-20 05:59 PST</a>,

            <span class="vcard"><span class="fn">Kamil Frankowicz</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>


          <a href="attachment.cgi?id=299345&amp;action=edit">Details</a>




        </td>
      </tr>
      <tr id="a2" class="bz_contenttype_text_plain bz_patch"
 style="background-color: rgb(255,255,200);" 

      >
        <td>
            <a href="attachment.cgi?id=300252"
               title="View the content of the attachment">
          <b>Patch</b></a>

          <span class="bz_attach_extra_info">
              (5.77 KB,
                patch)

            <br>
            <a href="#attach_300252"
               title="Go to the comment associated with the attachment">2017-01-31 13:01 PST</a>,

            <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
                  <span title="Michael Saboff">msaboff</span>:
                review+
                <br>
                  <span title="Build Bot">buildbot</span>:
                commit-queue-
                <br>
          </td>

        <td>


          <a href="attachment.cgi?id=300252&amp;action=edit">Details</a>

            | <a href="attachment.cgi?id=300252&amp;action=prettypatch">Formatted Diff</a>

            | <a href="attachment.cgi?id=300252&amp;action=diff">Diff</a>

          <div class="statusBubble">
            <iframe src="https://ews.webkit.org/status-bubble/300252/"
                    style="width: 0px; height: 20px; border: none;" scrolling="no" onload="handleStatusBubbleLoad(this)">
            </iframe>
          </div>

        </td>
      </tr>
      <tr id="a3" class="bz_contenttype_application_zip"


      >
        <td>
            <a href="attachment.cgi?id=300300"
               title="View the content of the attachment">
          <b>Archive of layout-test-results from ews122 for ios-simulator-wk2</b></a>

          <span class="bz_attach_extra_info">
              (814.91 KB,
                application/zip)

            <br>
            <a href="#attach_300300"
               title="Go to the comment associated with the attachment">2017-01-31 21:53 PST</a>,

            <span class="vcard"><span class="fn">Build Bot</span>
</span>
          </span>
        </td>

          <td class="bz_attach_flags">
              <i>no flags</i>
          </td>

        <td>


          <a href="attachment.cgi?id=300300&amp;action=edit">Details</a>




        </td>
      </tr>

  <tr class="bz_attach_footer">
    <td colspan="3">
        <span class="bz_attach_view_hide">
            <a id="view_all" href="attachment.cgi?bugid=167239&amp;action=viewall">View All</a>
        </span>
        <a href="attachment.cgi?bugid=167239&amp;action=enter">Add an attachment</a>
        (proposed patch, testcase, etc.)
    </td>
  </tr>
</table>
<br>
<div id="add_comment" class="bz_section_additional_comments">
      <table>
        <tr>
          <td>
            <fieldset>
              <legend>Note</legend>
              You need to
              <a href="show_bug.cgi?id=167239&amp;GoAheadAndLogIn=1">log in</a>
              before you can comment on or make changes to this bug.
            </fieldset>
          </td>
        </tr> 
      </table>
  </div>
  </td>
  <td>
  </td>
  </tr></table>

  
  <div id="comments"><script src="js/comments.js?1490751600" type="text/javascript">
</script>

<script type="text/javascript">
<!--
  /* Adds the reply text to the 'comment' textarea */
  function replyToComment(id, real_id, name) {
      var prefix = "(In reply to " + name + " from comment #" + id + ")\n";
      var replytext = "";
        /* pre id="comment_name_N" */
        var text_elem = document.getElementById('comment_text_'+id);
        var text = getText(text_elem);
        replytext = prefix + wrapReplyText(text);


      /* <textarea id="comment"> */
      var textarea = document.getElementById('comment');
      if (textarea.value != replytext) {
          textarea.value += replytext;
      }

      textarea.focus();
  } 
//-->
</script>


<!-- This auto-sizes the comments and positions the collapse/expand links 
     to the right. -->
<table class="bz_comment_table">
<tr>
<td>
<div id="c0" class="bz_comment bz_first_comment">

      <div class="bz_first_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c0">Description</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kamil Frankowicz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-20 05:59:00 PST
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=299345" name="attach_299345" title="POC to heap out of bounds write (jsc)">attachment 299345</a> <a href="attachment.cgi?id=299345&amp;action=edit" title="POC to heap out of bounds write (jsc)">[details]</a></span>
POC to heap out of bounds write (jsc)

Affected SVN revision: 210958

To reproduce the problem:
./jsc jsc_oobw_llint_entry.js

GDB Backtrace:

#0  0x00007ffff767a830 in llint_entry ()
   from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#1  0x00007ffff767fe91 in llint_entry ()
   from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#2  0x00007ffff767945f in vmEntryToJavaScript ()
   from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#3  0x00007ffff7603aae in JSC::JITCode::execute(JSC::VM*, JSC::ProtoCallFrame*) ()
   from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#4  0x00007ffff75d512f in JSC::Interpreter::execute(JSC::ProgramExecutable*, JSC::ExecState*, JSC::JSObject*) ()
   from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#5  0x00007ffff77cfd5a in JSC::evaluate(JSC::ExecState*, JSC::SourceCode const&amp;, JSC::JSValue, WTF::NakedPtr&lt;JSC::Exception&gt;&amp;) () from XYZ/WebKitBuild/Release/lib/libJavaScriptCore.so.1
#6  0x000000000040de87 in runJSC(JSC::VM*, CommandLine) ()
#7  0x000000000040c997 in jscmain(int, char**) ()
#8  0x000000000040c867 in main ()
#9  0x00007ffff3bdd830 in __libc_start_main (main=0x40c850 &lt;main&gt;, argc=0x2, argv=0x7fffffffdcd8, 
    init=&lt;optimized out&gt;, fini=&lt;optimized out&gt;, rtld_fini=&lt;optimized out&gt;, stack_end=0x7fffffffdcc8)
    at ../csu/libc-start.c:291
#10 0x000000000040ad79 in _start ()

Regards,
Kamil Frankowicz</pre>
    </div>

    <div id="c1" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c1">Comment 1</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Alexey Proskuryakov</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-22 00:13:25 PST
        </span>

      </div>




<pre class="bz_comment_text">I cannot reproduce on Mac with ASan build of <a href="https://commits.webkit.org/r211025">r211025</a>.</pre>
    </div>

    <div id="c2" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c2">Comment 2</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kamil Frankowicz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-30 09:54:03 PST
        </span>

      </div>




<pre class="bz_comment_text">I tried on <a href="https://commits.webkit.org/r211363">r211363</a> + ASAN and problem still exist.

My configuration:
CC = afl-clang-fast (Clang 3.9.1)
CXX = afl-clang-fast++ (Clang 3.9.1)
OS = Xubuntu 16.04 x64</pre>
    </div>

    <div id="c3" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c3">Comment 3</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-30 23:06:21 PST
        </span>

      </div>




<pre class="bz_comment_text">Reproduced in JSCOnly port.
I'm now investigating this.
Basically the problem is too many arguments.
More simplified POC for this issue.

var args = &quot;y,&quot;.repeat(80000);
var g = Function(args, &quot;return 0&quot;);
g();</pre>
    </div>

    <div id="c4" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c4">Comment 4</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-30 23:29:35 PST
        </span>

      </div>




<pre class="bz_comment_text">crashed position is functionArityCheck's copyLoop.</pre>
    </div>

    <div id="c5" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c5">Comment 5</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-30 23:48:34 PST
        </span>

      </div>




<pre class="bz_comment_text">Current my guess is that soft stack height check is failed in Linux due to the different stack height in each platform.</pre>
    </div>

    <div id="c6" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c6">Comment 6</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 00:44:34 PST
        </span>

      </div>




<pre class="bz_comment_text">soft stack height check should pass.
The problem is the arity check slow path function does not return failure.</pre>
    </div>

    <div id="c7" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c7">Comment 7</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 01:21:06 PST
        </span>

      </div>




<pre class="bz_comment_text">OK, it seems that Linux softStackLimit is incorrect.</pre>
    </div>

    <div id="c8" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c8">Comment 8</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 02:09:49 PST
        </span>

      </div>




<pre class="bz_comment_text">ok, it seems that LLInt code bug. quad signed words are handled with long size ops.</pre>
    </div>

    <div id="c9" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c9">Comment 9</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 02:50:52 PST
        </span>

      </div>




<pre class="bz_comment_text">OK, finally found the issue.
The problem is, in Linux, we use pthread_attr_getstack to obtain stack base and size.
But it does not return the correct value if it is called on the main thread.</pre>
    </div>

    <div id="c10" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c10">Comment 10</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 12:05:05 PST
        </span>

      </div>




<pre class="bz_comment_text">Aha! I've got the reason of this bug.
It is not related to loop operation and stack limits.
It is related to x64 red zone!

Now, we perform copy loop. It extends the C stack.
But we accidentally perform this operation before extending sp.
Logically it is ok. But this means that you now touch beyond the red zone of the stack!</pre>
    </div>

    <div id="c11" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c11">Comment 11</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 12:31:19 PST
        </span>

      </div>




<pre class="bz_comment_text">(In reply to <a href="show_bug.cgi?id=167239#c10">comment #10</a>)
<span class="quote">&gt; Aha! I've got the reason of this bug.
&gt; It is not related to loop operation and stack limits.
&gt; It is related to x64 red zone!
&gt; 
&gt; Now, we perform copy loop. It extends the C stack.
&gt; But we accidentally perform this operation before extending sp.
&gt; Logically it is ok. But this means that you now touch beyond the red zone of
&gt; the stack!</span >

I guess that some crashes I saw when enabling sampling profilers are also related to the red zone.
At that time, signals frequently comes. This breaks the stack that is beyond the red zone.</pre>
    </div>

    <div id="c12" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c12">Comment 12</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 13:01:11 PST
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span>
Patch</pre>
    </div>

    <div id="c13" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c13">Comment 13</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Saboff</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 13:17:04 PST
        </span>

      </div>




<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span>
Patch

View in context: <a href="https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review">https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review</a>

r=me
How does adjusting the stack pointer adjust the red zone?

<span class="quote">&gt; Source/JavaScriptCore/ChangeLog:8
&gt; +        Arity fixup extends C stack and copy/fill the stack with</span >

There is only one stack.  How about &quot;... extends the stack and copy/fills the&quot;?

<span class="quote">&gt; Source/JavaScriptCore/ChangeLog:10
&gt; +        the values. At that time, we accidentally read/write stacks
&gt; +        before extending the stack pointer. As a result, we touch</span >

How about replacing &quot;stacks before extending the stack pointer&quot; with &quot;stack space behind the stack pointer&quot;

<span class="quote">&gt; Source/JavaScriptCore/ChangeLog:12
&gt; +        are unsafe, especially in Linux. This patch extends the stack</span >

How about changing &quot;extends&quot; to &quot;changes&quot;?</pre>
    </div>

    <div id="c14" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c14">Comment 14</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Mark Lam</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 13:33:13 PST
        </span>

      </div>




<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span>
Patch

View in context: <a href="https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review">https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review</a>

<span class="quote">&gt; Source/JavaScriptCore/jit/ThunkGenerators.cpp:445
&gt; +    // Adjust call frame register and stack pointer to account for missing args
&gt; +    // We need to extend sp first before starting the copy/fill loops since it
&gt; +    // may exceed the x64 red zone.</span >

I think this comment is not entirely accurate and does not explain the core issue.  I think the issue is that the OS expects any space below the sp to be unused, and will allocate that region to be used by the interrupt / signal stack.  If we do not adjust the sp before filling in that region with content, the content may get trashed by an interrupt.  As a result, we need to adjust the sp first.  Incidentally, the reason that the interrupt handler can just use that region below the sp is because we are supposed to reserve an amount of memory (the red zone size) at the bottom of the stack that user code is not supposed to use.

Can you update the comments to clarify the issue please before landing?  Thanks.</pre>
    </div>

    <div id="c15" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c15">Comment 15</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Michael Catanzaro</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 16:44:45 PST
        </span>

      </div>




<pre class="bz_comment_text">Thanks Yusuke!</pre>
    </div>

    <div id="c16" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c16">Comment 16</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Build Bot</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 21:53:03 PST
        </span>

      </div>




<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span>
Patch

<span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">Attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span> did not pass ios-sim-ews (ios-simulator-wk2):
Output: <a href="http://webkit-queues.webkit.org/results/2983099">http://webkit-queues.webkit.org/results/2983099</a>

New failing tests:
css3/filters/backdrop/dynamic-with-clip-path.html</pre>
    </div>

    <div id="c17" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c17">Comment 17</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Build Bot</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-01-31 21:53:07 PST
        </span>

      </div>




<pre class="bz_comment_text">Created <span class=""><a href="attachment.cgi?id=300300" name="attach_300300" title="Archive of layout-test-results from ews122 for ios-simulator-wk2">attachment 300300</a> <a href="attachment.cgi?id=300300&amp;action=edit" title="Archive of layout-test-results from ews122 for ios-simulator-wk2">[details]</a></span>
Archive of layout-test-results from ews122 for ios-simulator-wk2

The attached test failures were seen while running run-webkit-tests on the ios-sim-ews.
Bot: ews122  Port: ios-simulator-wk2  Platform: Mac OS X 10.11.6</pre>
    </div>

    <div id="c18" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c18">Comment 18</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-02-01 03:00:24 PST
        </span>

      </div>




<pre class="bz_comment_text">Comment on <span class=""><a href="attachment.cgi?id=300252&amp;action=diff" name="attach_300252" title="Patch">attachment 300252</a> <a href="attachment.cgi?id=300252&amp;action=edit" title="Patch">[details]</a></span>
Patch

View in context: <a href="https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review">https://bugs.webkit.org/attachment.cgi?id=300252&amp;action=review</a>

<span class="quote">&gt;&gt; Source/JavaScriptCore/ChangeLog:8
&gt;&gt; +        Arity fixup extends C stack and copy/fill the stack with
&gt; 
&gt; There is only one stack.  How about &quot;... extends the stack and copy/fills the&quot;?</span >

OK, we dropped the JS stack for JIT / LLInt! Changed.

<span class="quote">&gt;&gt; Source/JavaScriptCore/ChangeLog:10
&gt;&gt; +        before extending the stack pointer. As a result, we touch
&gt; 
&gt; How about replacing &quot;stacks before extending the stack pointer&quot; with &quot;stack space behind the stack pointer&quot;</span >

Sounds nice. I merged the suggestion from Mark. Then, I think rephasing it &quot;stack space below the stack pointer&quot; is nice.

<span class="quote">&gt;&gt; Source/JavaScriptCore/ChangeLog:12
&gt;&gt; +        are unsafe, especially in Linux. This patch extends the stack
&gt; 
&gt; How about changing &quot;extends&quot; to &quot;changes&quot;?</span >

Sounds nice. Fixed.

<span class="quote">&gt;&gt; Source/JavaScriptCore/jit/ThunkGenerators.cpp:445
&gt;&gt; +    // may exceed the x64 red zone.
&gt; 
&gt; I think this comment is not entirely accurate and does not explain the core issue.  I think the issue is that the OS expects any space below the sp to be unused, and will allocate that region to be used by the interrupt / signal stack.  If we do not adjust the sp before filling in that region with content, the content may get trashed by an interrupt.  As a result, we need to adjust the sp first.  Incidentally, the reason that the interrupt handler can just use that region below the sp is because we are supposed to reserve an amount of memory (the red zone size) at the bottom of the stack that user code is not supposed to use.
&gt; 
&gt; Can you update the comments to clarify the issue please before landing?  Thanks.</span >

Yup. The problem is SP is not updated before modifying the area that is lower than SP.
In that case, OS can break these areas since OS thinks it is unused.
In Linux port, we can encounter this bug more frequently since we use signals for suspend and resume the threads (SIGUSR2).
In addition, the Linux kernel could not populate the stack pages if the area is beyond the SP and the red zone.
This is the direct reason of this issue.
When touching such a page, the kernel does not populate the backing physical pages and report SEGV instead.

I'll update these comments.</pre>
    </div>

    <div id="c19" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c19">Comment 19</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Yusuke Suzuki</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-02-01 03:30:53 PST
        </span>

      </div>




<pre class="bz_comment_text">Committed <a href="https://commits.webkit.org/r211479">r211479</a>: &lt;<a href="http://trac.webkit.org/changeset/211479">http://trac.webkit.org/changeset/211479</a>&gt;</pre>
    </div>

    <div id="c20" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c20">Comment 20</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Radar WebKit Bug Importer</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-02-01 11:18:45 PST
        </span>

      </div>




<pre class="bz_comment_text">&lt;<a href="rdar://problem/30311611">rdar://problem/30311611</a>&gt;</pre>
    </div>

    <div id="c21" class="bz_comment">

      <div class="bz_comment_head">


        <span class="bz_comment_number">
          <a 
             href="show_bug.cgi?id=167239#c21">Comment 21</a>
        </span>

        <span class="bz_comment_user">
          <span class="vcard"><span class="fn">Kamil Frankowicz</span>
</span>
        </span>

        <span class="bz_comment_user_images">
        </span>

        <span class="bz_comment_time">
          2017-02-17 06:24:43 PST
        </span>

      </div>




<pre class="bz_comment_text">This is CVE-2017-5949.</pre>
    </div>


  

</td>
<td>
</td>
</tr></table>
  </div>
        

</form>

<hr>
<ul class="related_actions">
    <li><a href="show_bug.cgi?format=multiple&amp;id=167239">Format For Printing</a></li>
    <li>&nbsp;-&nbsp;<a href="show_bug.cgi?ctype=xml&amp;id=167239">XML</a></li>
    <li>&nbsp;-&nbsp;<a href="enter_bug.cgi?cloned_bug_id=167239">Clone This Bug</a></li>
    
    <li>&nbsp;-&nbsp;<a href="#">Top of page </a></li>
    </ul>

<br>
</div>

    <div id="footer">
      <div class="intro"></div>
<ul id="useful-links">
  <li id="links-actions"><ul class="links">
  <li><a href="./">Home</a></li>
  <li><span class="separator">| </span><a href="enter_bug.cgi">New</a></li>
  <li><span class="separator">| </span><a href="describecomponents.cgi">Browse</a></li>
  <li><span class="separator">| </span><a href="query.cgi">Search</a></li>

  <li class="form">
    <span class="separator">| </span>
    <form action="buglist.cgi" method="get"
        onsubmit="if (this.quicksearch.value == '')
                  { alert('Please enter one or more search terms first.');
                    return false; } return true;">
    <input type="hidden" id="no_redirect_bottom" name="no_redirect" value="0">
    <script type="text/javascript">
      if (history && history.replaceState) {
        var no_redirect = document.getElementById("no_redirect_bottom");
        no_redirect.value = 1;
      }
    </script>
    <input class="txt" type="text" id="quicksearch_bottom" name="quicksearch" 
           title="Quick Search" value="">
    <input class="btn" type="submit" value="Search" 
           id="find_bottom"></form>
  <a href="page.cgi?id=quicksearch.html" title="Quicksearch Help">[?]</a></li>

  <li><span class="separator">| </span><a href="report.cgi">Reports</a></li>

  <li>
      <span class="separator">| </span>
        <a href="request.cgi">Requests</a></li>


  <li>
        <span class="separator">| </span>
        <a href="https://bugzilla.readthedocs.org/en/5.0/using/understanding.html" target="_blank">Help</a>
      </li>
    
      <li id="new_account_container_bottom">
        <span class="separator">| </span>
        <a href="createaccount.cgi">New&nbsp;Account</a>
      </li>

    <li id="mini_login_container_bottom">
  <span class="separator">| </span>
  <a id="login_link_bottom" href="show_bug.cgi?id=167239&amp;GoAheadAndLogIn=1"
     onclick="return show_mini_login_form('_bottom')">Log In</a>

  <form action="show_bug.cgi?id=167239" method="POST"
        class="mini_login bz_default_hidden"
        id="mini_login_bottom">
    <input id="Bugzilla_login_bottom" required
           name="Bugzilla_login" class="bz_login"
        type="email" placeholder="Email Address">
    <input class="bz_password" name="Bugzilla_password" type="password"
           id="Bugzilla_password_bottom" required
           placeholder="Password">
    <input type="hidden" name="Bugzilla_login_token"
           value="">
    <input type="submit" name="GoAheadAndLogIn" value="Log in"
            id="log_in_bottom">
    <a href="#" onclick="return hide_mini_login_form('_bottom')">[x]</a>
  </form>
</li>


  <li id="forgot_container_bottom">
    <span class="separator">| </span>
    <a id="forgot_link_bottom" href="show_bug.cgi?id=167239&amp;GoAheadAndLogIn=1#forgot"
       onclick="return show_forgot_form('_bottom')">Forgot Password</a>
    <form action="token.cgi" method="post" id="forgot_form_bottom"
          class="mini_forgot bz_default_hidden">
      <label for="login_bottom">Login:</label>
      <input name="loginname" size="20" id="login_bottom" required
          type="email" placeholder="Your Email Address">
      <input id="forgot_button_bottom" value="Reset Password" type="submit">
      <input type="hidden" name="a" value="reqpw">
      <input type="hidden" id="token_bottom" name="token"
             value="1635620799-oepWN8FXqUWglSfsyGmpaI_EOkEA1JiUrSpwYXgA7co">
      <a href="#" onclick="return hide_forgot_form('_bottom')">[x]</a>
    </form>
  </li>
</ul>
  </li>

  




  
</ul>

      <div class="outro"></div>
    </div>

    <!-- WEBKIT_CHANGES -->
    <script defer src="/committers-autocomplete.js"></script>
  </body>
</html>