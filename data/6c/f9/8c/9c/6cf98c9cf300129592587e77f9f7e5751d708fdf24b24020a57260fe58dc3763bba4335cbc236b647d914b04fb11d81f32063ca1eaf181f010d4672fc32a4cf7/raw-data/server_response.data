<!-- MHonArc v2.6.16 -->
<!--X-Subject: RE: Possible Security Hole in SSHD w/ CYGWIN? -->
<!--X-From-R13: "Rnivq Ivyyvf" <qnivq_jvyyvfNpbzpnfg.arg> -->
<!--X-Date: 10 Feb 2016 04:39:18 &#45;0000 -->
<!--X-Message-Id: 019c01d163bc$fe2fc500$fa8f4f00$@comcast.net -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML//EN">
<HTML>
<HEAD>
<TITLE>David Willis - RE: Possible Security Hole in SSHD w/ CYGWIN?</TITLE>
</HEAD>
<BODY>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--htdig_noindex-->
<p>This is the mail archive of the 
<tt>cygwin</tt>
mailing list for the <a href="http://cygwin.com/">Cygwin project</a>.


<!--/htdig_noindex-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<!--htdig_noindex-->
<HR>
<table border="0">
  <tr><th align="left">Index Nav:</th>
      <td colspan="2">
        [<A HREF="index.html#00129">Date&nbsp;Index</A>] [<a href="subjects.html#00129">Subject&nbsp;Index</a>] [<a href="authors.html#00129">Author&nbsp;Index</a>] [<A HREF="threads.html#00129">Thread&nbsp;Index</A>]
      </td>
  </tr>
  <tr><th align="left">Message Nav:</th>
      <td>[<A HREF="msg00128.html">Date&nbsp;Prev</A>]&nbsp;[<A HREF="msg00130.html">Date&nbsp;Next</A>]</td>
      <td>[<A HREF="msg00128.html">Thread&nbsp;Prev</A>]&nbsp;[<A HREF="msg00130.html">Thread&nbsp;Next</A>]</td>
  </tr>
  <tr><th align="left">Other format:</th>
  <td>[<a href="/cgi-bin/get-raw-msg?listname=cygwin&date=2016-02&msgid=019c01d163bc%24fe2fc500%24fa8f4f00%24%40comcast.net">Raw text</a>]</td>
  </tr>
</table>
<!--/htdig_noindex-->

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h1>RE: Possible Security Hole in SSHD w/ CYGWIN?</h1>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->
<ul>
<li><em>From</em>: &quot;David Willis&quot; &lt;david_willis at comcast dot net&gt;</li>
<li><em>To</em>: &lt;cygwin at cygwin dot com&gt;</li>
<li><em>Date</em>: Tue, 9 Feb 2016 20:39:13 -0800</li>
<li><em>Subject</em>: RE: Possible Security Hole in SSHD w/ CYGWIN?</li>
<li><em>Authentication-results</em>: sourceware.org; auth=none</li>
<li><em>References</em>: </li>
<li><em>Reply-to</em>: &lt;cygwin at cygwin dot com&gt;</li>
</ul>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Just to add an update to this, it appears that processes run from the shell
while logged into the CYGWIN SSHD server are run as the correct user - i.e.
I run a ping or cat a file and pipe it to less, and check Task Manager on
the SSHD server, and those processes show as being run as the user I SSH'd
in as, the way it should be.

So it looks like this bug is specifically when accessing files or directory
contents. I literally run a &quot;ls -l&quot; command from the local CYGWIN shell on
the SSHD server, against a file share that I have no access to, and get a
permission denied. I run the exact same command, SSH'd into that same box as
the same user against the same file share, and this time I can list the
directory contents. Same results with &quot;cat&quot;ing files in those directories.
What gives?

Any help on this VERY much appreciated!!!

Thanks,

David


-----Original Message-----
Sent: Tuesday, February 09, 2016 7:56 AM
To: 'cygwin@cygwin.com'
Subject: RE: Possible Security Hole in SSHD w/ CYGWIN?

Sorry for starting a new thread w/ the reply, forgot to subscribe before
posting my question yesterday...

Thanks for getting back so quickly

Yes, I have read that page pretty much from top to bottom, and as far as I
know I have configured sshd and the user accounts correctly. I have a
non-privileged, disabled account named &quot;sshd&quot;, as well as a privileged
account called &quot;cyg_server&quot;. Privilege separation seems to be working fine -
i.e. when the request for a connection comes in the process is running as
&quot;sshd&quot;, then it spawns a privileged process running as &quot;cyg_server&quot; once the
user is authenticated.

However no I am not logging in with a password; I have setup public key
authentication.

And the user I'm being connected as (as seen from the file share server) is
not the &quot;sshd&quot; user account, it is the privileged &quot;cyg_server&quot; user account.
Although that account has no rights to logon interactively or thru Terminal
Services, it is a privileged account on the file server (because the file
server is also running CYGWIN and thus must allow privileged rights to that
account as well). I should clarify that in my case, cyg_server is a domain
account (not a local account).

And the way I can verify, is that I have a folder on that share that the
user I am authenicating as does not have rights do view, but cyg_server does
(because Administrators on that server do), and when I connect as my user
via SSHD to any one of my other machines on the domain running CYGWIN, I can
then navigate to and read the contents of that file share when I shouldn't
be able to. If I try to do the same thing, from the same account, but on my
machine locally without connecting to any other CYGWIN SSH server, I get a
&quot;Permission denied&quot;, which is what I would expect.

Thank you for your help on this.

David

----------------------------------------------------------------------------
--------------------------

Did you read <a  rel="nofollow" href="https://cygwin.com/cygwin-ug-net/ntsec.html">https://cygwin.com/cygwin-ug-net/ntsec.html</a>, configured sshd
and the user accounts correctly and are logging in with a password using
either of the methods described?

FWIW, I'm seeing the connected user as the one that I logged into via ssh. 
In fact the sshd user account doesn't have any network access rights anyway,
so I couldn't connect to any network share if that acount would be used.


Regards,
Achim.

-----Original Message-----
Sent: Monday, February 08, 2016 10:43 PM
To: 'cygwin@cygwin.com'
Subject: Possible Security Hole in SSHD w/ CYGWIN?

Hello,

I noticed that when connecting via SSH to a CYGWIN-based SSHD server, if the
user connects to a network share (i.e. they CD to the share UNC path in the
BASH/CYGWIN shell), they get connected as the privileged server user account
created for privilege separation when SSHD is configured w/ ssh-host-config.
In other words, they have the rights of that account, and if that account
happens to be a domain admin (or even a local admin on the box hosting the
share), that user has full admin rights on that share, when in fact they
should have the rights assigned to the user account they SSH'd in with.

To reproduce, connect via SSH (from either a Linux or CYGWIN/Windows client)
to a CYGWIN-based SSHD server using a normal privileged user account (an
account preferably that is not an admin either on the client or server
machine). Once connected to the Windows SSHD server, CD to a UNC path of a
network share. Once CD'd to that path, check Computer Management on that
server, and go to Shares-&gt;Open Sessions, and you will see that the user
connected is the privileged SSHD server account (and it will obviously show
as being connected from the machine you are SSH'd into).

Anyone else ever notice this before?

Running OpenSSH v7 BTW, SSH client is Win7, SSH server Win7, file share
server Win2008R2


Thanks,


David



--
Problem reports:       <a  rel="nofollow" href="http://cygwin.com/problems.html">http://cygwin.com/problems.html</a>
FAQ:                   <a  rel="nofollow" href="http://cygwin.com/faq/">http://cygwin.com/faq/</a>
Documentation:         <a  rel="nofollow" href="http://cygwin.com/docs.html">http://cygwin.com/docs.html</a>
Unsubscribe info:      <a  rel="nofollow" href="http://cygwin.com/ml/#unsubscribe-simple">http://cygwin.com/ml/#unsubscribe-simple</a>

</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<ul><li><strong>Follow-Ups</strong>:
<ul>
<li><strong><a name="00130" href="msg00130.html">Re: Possible Security Hole in SSHD w/ CYGWIN?</a></strong>
<ul><li><em>From:</em> Stephen John Smoogen</li></ul></li>
</ul></li></ul>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<!--htdig_noindex-->
<table border="0">
  <tr><th align="left">Index Nav:</th>
      <td colspan="2">
        [<A HREF="index.html#00129">Date&nbsp;Index</A>] [<a href="subjects.html#00129">Subject&nbsp;Index</a>] [<a href="authors.html#00129">Author&nbsp;Index</a>] [<A HREF="threads.html#00129">Thread&nbsp;Index</A>]
      </td>
  </tr>
  <tr><th align="left">Message Nav:</th>
      <td>[<A HREF="msg00128.html">Date&nbsp;Prev</A>]&nbsp;[<A HREF="msg00130.html">Date&nbsp;Next</A>]</td>
      <td>[<A HREF="msg00128.html">Thread&nbsp;Prev</A>]&nbsp;[<A HREF="msg00130.html">Thread&nbsp;Next</A>]</td>
  </tr>
</table>
<!--/htdig_noindex-->

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
