<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 2134113002: Use ChildFrameDisconnector when detaching child frames of a LocalFrame. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '28352de1a19da21bb7b46e86fe207a72';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/2134113002%252526ust%25253D1608721739515590%252526usg%25253DAFQjCNFC-d1OMLXvgCx7kxKL14HfQCbTjg%26service%3Dah">Sign out</a>

</div>
<div class="counter">(269)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-2134113002">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/2134113002/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            2134113002</a>:
    Use ChildFrameDisconnector when detaching child frames of a LocalFrame.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            4 years, 5 months ago by <a href="/user/dcheng" onMouseOver="M_showUserInfoPopup(this)">dcheng</a>
          </div>
          <div><b>Modified:</b><br/>
            4 years, 5 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/esprehn" onMouseOver="M_showUserInfoPopup(this)">esprehn</a></span>, <a href="/user/Nate%20Chapin" onMouseOver="M_showUserInfoPopup(this)">Nate Chapin</a>
          </div>
          
          <div><b>CC:</b><br/>
            esprehn, blink-reviews, chromium-reviews, dcheng, haraken, mlamouri+watch-blink_chromium.org, ojan, piman, sof, Yuki
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins can run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=524113">524113</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=528867">528867</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=561683">561683</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=621362">621362</a>
Committed: <a href="https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0">https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0</a>
Cr-Commit-Position: refs/heads/master@{#405040}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/2134113002/#ps1"
       onclick="M_toggleSectionForPS('2134113002', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/2134113002/#ps20001"
       onclick="M_toggleSectionForPS('2134113002', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Meh
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/2134113002/#ps40001"
       onclick="M_toggleSectionForPS('2134113002', '40001')"
       class="toggled-section ">
      Patch Set 3
      : DCHECK
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 5
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/2134113002/#ps60001"
       onclick="M_toggleSectionForPS('2134113002', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Use local
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/2134113002/#ps80001"
       onclick="M_toggleSectionForPS('2134113002', '80001')"
       class="toggled-section opentriangle">
      Patch Set 5
      : rebase
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-80001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 4 years, 5 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue2134113002_80001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/2134113002/80001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+24 lines, -12 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90002">
            third_party/WebKit/Source/core/frame/Frame.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/Frame.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+0 lines, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90002.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/Frame.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90001">
            third_party/WebKit/Source/core/frame/Frame.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/Frame.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+0 lines, -11 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90001.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/Frame.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90004">
            third_party/WebKit/Source/core/frame/LocalFrame.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/LocalFrame.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/2134113002/diff2/1:80001/third_party/WebKit/Source/core/frame/LocalFrame.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/2134113002/diff2/20001:80001/third_party/WebKit/Source/core/frame/LocalFrame.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/2134113002/diff2/40001:80001/third_party/WebKit/Source/core/frame/LocalFrame.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/2134113002/diff2/60001:80001/third_party/WebKit/Source/core/frame/LocalFrame.h"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90004.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/LocalFrame.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90003">
            third_party/WebKit/Source/core/frame/LocalFrame.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/LocalFrame.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/2134113002/diff2/1:80001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 1">1</a>
        
          <a href="/2134113002/diff2/20001:80001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 2">2</a>
        
          <a href="/2134113002/diff2/40001:80001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 3">3</a>
        
          <a href="/2134113002/diff2/60001:80001/third_party/WebKit/Source/core/frame/LocalFrame.cpp"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+9 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90003.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/LocalFrame.cpp">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90006">
            third_party/WebKit/Source/core/frame/RemoteFrame.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/RemoteFrame.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+2 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90006.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/RemoteFrame.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/2134113002/patch/80001/90005">
            third_party/WebKit/Source/core/frame/RemoteFrame.cpp
          </a>
        </td>
        <td>
          <a class="noul"
             href="/2134113002/diff/80001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+11 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue2134113002_80001_90005.diff"
             title="Download patch for third_party/WebKit/Source/core/frame/RemoteFrame.cpp">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 80001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 24 (12 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          Description was changed from ========== Use ChildFrameDisconnector when detaching child frames of a LocalFrame. BUG= ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 12:13:51 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >Description was changed from

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

BUG=
==========

to

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins cab run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=524113,528867,561683,621362
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          dcheng@chromium.org changed reviewers: + sigbjornf@opera.se
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 12:13:51 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:sigbjornf@opera.se">sigbjornf@opera.se</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          dcheng@chromium.org changed reviewers: + sigbjornf@opera.com - sigbjornf@opera.se
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 12:14:16 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:sigbjornf@opera.com">sigbjornf@opera.com</a>
- <a href="mailto:sigbjornf@opera.se">sigbjornf@opera.se</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          dcheng@chromium.org changed reviewers: + japhet@chromium.org - sigbjornf@opera.com
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 12:15:41 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            ><a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a> changed reviewers:
+ <a href="mailto:japhet@chromium.org">japhet@chromium.org</a>
- <a href="mailto:sigbjornf@opera.com">sigbjornf@opera.com</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          Note that this is somewhat speculative: I&#39;m still working on persisted widget handling in the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 12:15:42 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >Note that this is somewhat speculative: I&#39;m still working on persisted widget
handling in the followup. But the theory should be sound... I hope</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Description was changed from ========== Use ChildFrameDisconnector when detaching child frames of a LocalFrame. Currently, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 19:37:30 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Description was changed from

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins cab run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=524113,528867,561683,621362
==========

to

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins can run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=524113,528867,561683,621362
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          esprehn@chromium.org changed reviewers: + esprehn@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 19:39:29 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            ><a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a> changed reviewers:
+ <a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          Hmm, what about inside updateStyle when we unload plugins? https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp File third_party/WebKit/Source/core/frame/RemoteFrame.cpp (right): https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp#newcode204 third_party/WebKit/Source/core/frame/RemoteFrame.cpp:204: ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-11 19:39:30 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >Hmm, what about inside updateStyle when we unload plugins?

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/frame/RemoteFrame.cpp (right):

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp#newcode204" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/frame/RemoteFrame.cpp:204: for (Frame* child =
tree().firstChild(); child; child = child-&gt;tree().nextSibling())
why do we need to keep this code path for remote frames? I think in most pages
the frame tree is interleaved Remote and Local frames so you&#39;re likely to end up
down this code path really often.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          On 2016/07/11 19:39:30, esprehn wrote: &gt; Hmm, what about inside updateStyle when we unload plugins? ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-12 01:14:41 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >On 2016/07/11 19:39:30, esprehn wrote:
&gt; Hmm, what about inside updateStyle when we unload plugins?
&gt; 

Blah, plugins are why we can&#39;t have nice things. I guess we&#39;ll still need it for
updateStyle, though I think we can do something a bit simpler: we can just post
a task to the event loop to do the deferred updates. While this doesn&#39;t work for
detach–script expects to run while the element is still in an active
document–for style changes, the element (should?) still be in active document,
just hidden.

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/frame/RemoteFrame.cpp (right):

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp#newcode204" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/frame/RemoteFrame.cpp:204: for (Frame* child =
tree().firstChild(); child; child = child-&gt;tree().nextSibling())
On 2016/07/11 19:39:30, esprehn wrote:
&gt; why do we need to keep this code path for remote frames? I think in most pages
&gt; the frame tree is interleaved Remote and Local frames so you&#39;re likely to end
up
&gt; down this code path really often.

ChildFrameDisconnector is based on DOM nodes, which remote frames don&#39;t have, so
we need an alternate path for remote frames. It&#39;s a bit unfortunate, but it&#39;s
not much different from before: previously, both versions delegate to a
non-virtual Frame::detachChildren: now they just happen to delegate to different
implementations of detachChildren.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp File third_party/WebKit/Source/core/frame/LocalFrame.cpp (right): https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp#newcode455 third_party/WebKit/Source/core/frame/LocalFrame.cpp:455: if (document()) if (Document* document = this-&gt;document()) avoids the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:35:46 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            ><a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/frame/LocalFrame.cpp (right):

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp#newcode455" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/frame/LocalFrame.cpp:455: if (document())
if (Document* document = this-&gt;document())

avoids the nested virtual calls down there.

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/frame/RemoteFrame.cpp (right):

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/RemoteFrame.cpp#newcode207" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/frame/RemoteFrame.cpp:207:
child-&gt;detach(FrameDetachType::Remove);
this doesn&#39;t use a SubframeLoadingDisabler, so the script in here can load more
frames which then get missed by the above logic in the RemoteFrame case. That&#39;s
probably a security bug that already exists.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>esprehn</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          lgtm, though I think long term perhaps we should centralize this logic in one place. ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:38:43 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >lgtm, though I think long term perhaps we should centralize this logic in one
place. All the special code paths for RemoteFrame are sad.

I see now that you don&#39;t need a SubframeLoadingDisabler since RemoteFrame has no
Document.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp File third_party/WebKit/Source/core/frame/LocalFrame.cpp (right): https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp#newcode455 third_party/WebKit/Source/core/frame/LocalFrame.cpp:455: if (document()) On 2016/07/13 02:35:45, esprehn wrote: &gt; if ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:51:34 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            ><a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
File third_party/WebKit/Source/core/frame/LocalFrame.cpp (right):

<a href="https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Source/core/frame/LocalFrame.cpp#newcode455" rel="nofollow">https://codereview.chromium.org/2134113002/diff/40001/third_party/WebKit/Sour...</a>
third_party/WebKit/Source/core/frame/LocalFrame.cpp:455: if (document())
On 2016/07/13 02:35:45, esprehn wrote:
&gt; if (Document* document = this-&gt;document())
&gt; 
&gt; avoids the nested virtual calls down there.

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          The CQ bit was checked by dcheng@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:51:41 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          The patchset sent to the CQ was uploaded after l-g-t-m from esprehn@chromium.org Link to the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:51:42 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/2134113002/#ps60001" rel="nofollow">https://codereview.chromium.org/2134113002/#ps60001</a>
(title: &quot;Use local&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2134113002/60001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:54:03 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >CQ is trying da patch. Follow status at
 
<a href="https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2134113002/60001" rel="nofollow">https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.or...</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:58:40 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          Try jobs failed on following builders: ios-device on master.tryserver.chromium.mac (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-device/builds/34832) ios-device-gn on master.tryserver.chromium.mac (JOB_FAILED, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 02:58:42 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >Try jobs failed on following builders:
  ios-device on master.tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-device/builds/34832" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-device/builds...</a>)
  ios-device-gn on master.tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-device-gn/builds/35258" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-device-gn/bui...</a>)
  ios-simulator on master.tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-simulator/builds/34906" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-simulator/bui...</a>)
  ios-simulator-gn on master.tryserver.chromium.mac (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-simulator-gn/builds/35073" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.mac/builders/ios-simulator-gn/...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          The CQ bit was checked by dcheng@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 03:19:52 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            >The CQ bit was checked by <a href="mailto:dcheng@chromium.org">dcheng@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>dcheng</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          The patchset sent to the CQ was uploaded after l-g-t-m from esprehn@chromium.org Link to the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 03:19:52 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:esprehn@chromium.org">esprehn@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/2134113002/#ps80001" rel="nofollow">https://codereview.chromium.org/2134113002/#ps80001</a>
(title: &quot;rebase&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2134113002/80001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 03:22:46 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >CQ is trying da patch. Follow status at
 
<a href="https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.org/2134113002/80001" rel="nofollow">https://chromium-cq-status.appspot.com/v2/patch-status/codereview.chromium.or...</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          Committed patchset #5 (id:80001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 05:16:10 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-20"
            >Committed patchset #5 (id:80001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          CQ bit was unchecked.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 05:16:15 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-21"
            >CQ bit was unchecked.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          Description was changed from ========== Use ChildFrameDisconnector when detaching child frames of a LocalFrame. Currently, ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 05:17:14 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-22"
            >Description was changed from

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins can run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=524113,528867,561683,621362
==========

to

==========
Use ChildFrameDisconnector when detaching child frames of a LocalFrame.

Currently, UpdateSuspendScope is used to defer widget updates when the
DOM hierarchy is mutated. This is used to prevent script from running
in the middle of DOM mutations, since plugins can run script when
destroyed.

This is part 1 of 2 CLs to remove the need for UpdateSuspendScope. Part
1 changes LocalFrame detach to always use ChildFrameDisconnector to
detach child frames. Part 2 will rework ChildFrameDisconnector to also
detach plugin elements. This should eliminate the need to defer widget
updates, since script will never have to run during the actual mutation
of internal state.

BUG=524113,528867,561683,621362

Committed: <a href="https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0" rel="nofollow">https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0</a>
Cr-Commit-Position: refs/heads/master@{#405040}
==========</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-23">
                          Patchset 5 (id:??) landed as https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0 Cr-Commit-Position: refs/heads/master@{#405040}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                4 years, 5 months ago
		(2016-07-13 05:17:16 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-23"
            >Patchset 5 (id:??) landed as
<a href="https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0" rel="nofollow">https://crrev.com/7bf106f2192e922c18f18cac4ae18d79ea90c1b0</a>
Cr-Commit-Position: refs/heads/master@{#405040}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 24)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 24)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(24)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(24)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 24;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 2134113002;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 2134113002: Use ChildFrameDisconnector when detaching child frames of a LocalFrame.
     (Closed) </b><br/>
      Created 4 years, 5 months ago by dcheng<br/>
      Modified 4 years, 5 months ago<br/>
      Reviewers: esprehn, Nate Chapin<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 5
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
