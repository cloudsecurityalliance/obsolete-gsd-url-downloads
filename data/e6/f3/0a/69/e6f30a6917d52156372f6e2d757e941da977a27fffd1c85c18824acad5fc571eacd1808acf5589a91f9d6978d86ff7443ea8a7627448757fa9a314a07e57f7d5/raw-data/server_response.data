<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - FTP wildcard stack overflow - CVE-2020-8285</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>FTP wildcard stack overflow</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="ftp-wildcard-stack-overflow">FTP wildcard stack overflow</h1>
<p>Project curl Security Advisory, December 9th 2020 - <a href="https://curl.se/docs/CVE-2020-8285.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>libcurl offers a wildcard matching functionality, which allows a callback (set with <code><a href="https://curl.se/libcurl/c/CURLOPT_CHUNK_BGN_FUNCTION.html">CURLOPT_CHUNK_BGN_FUNCTION</a></code>) to return information back to libcurl on how to handle a specific entry in a directory when libcurl iterates over a list of all available entries.</p>
<p>When this callback returns <code>CURL_CHUNK_BGN_FUNC_SKIP</code>, to tell libcurl to not deal with that file, the internal function in libcurl then calls itself recursively to handle the next directory entry.</p>
<p>If there's a sufficient amount of file entries and if the callback returns &quot;skip&quot; enough number of times, libcurl runs out of stack space. The exact amount will of course vary with platforms, compilers and other environmental factors.</p>
<p>The content of the remote directory is not kept on the stack, so it seems hard for the attacker to control exactly what data that overwrites the stack - however it remains a Denial-Of-Service vector as a malicious user who controls a server that a libcurl-using application works with under these premises can trigger a crash.</p>
<p>(There is also a few other ways the function can be made to call itself and trigger this problem.)</p>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This issue was unfortunately reported publicly in the curl GitHub issue tracker as <a href="https://github.com/curl/curl/issues/6255">issue 6255</a>.</p>
<p>This flaw has existed in curl since commit <a href="https://github.com/curl/curl/commit/0825cd80a">0825cd80a</a> in curl <a href="vuln-7.21.0.html">7.21.0</a>.</p>
<p>This functionality is not used by the curl tool so it is not affected. Further: it is not a very widely used feature.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2020-8285 to this issue.</p>
<p>CWE-674: Uncontrolled Recursion</p>
<p>Severity: Medium</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: libcurl <a href="vuln-7.21.0.html">7.21.0</a> to and including <a href="vuln-7.73.0.html">7.73.0</a></li>
<li>Not affected versions: libcurl &lt; <a href="vuln-7.21.0.html">7.21.0</a> and libcurl &gt;= <a href="vuln-7.74.0.html">7.74.0</a></li>
</ul>
<p>Also note that libcurl is used by many applications, and not always advertised as such.</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>The internal function is rewritten to instead and more appropriately use an ordinary loop instead of the recursive approach. This way, the stack use will remain the same no matter how many files that are skipped.</p>
<p>A <a href="https://github.com/curl/curl/commit/69a358f2186e04">fix for CVE-2020-8285</a></p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in order of preference:</p>
<p>A - Upgrade libcurl to version <a href="vuln-7.74.0.html">7.74.0</a></p>
<p>B - Disable FTP wildcard use (<code><a href="https://curl.se/libcurl/c/CURLOPT_WILDCARDMATCH.html">CURLOPT_WILDCARDMATCH</a></code>)</p>
<p>C - Make sure your <code><a href="https://curl.se/libcurl/c/CURLOPT_CHUNK_BGN_FUNCTION.html">CURLOPT_CHUNK_BGN_FUNCTION</a></code> callback doesn't do multiple skips.</p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was first reported to the curl project on November 27, 2020.</p>
<p>This advisory was posted on December 9th 2020.</p>
<h2 id="credits">CREDITS</h2>
<p>This issue was initially reported by xnynx on GitHub. Daniel took it to the security team immediately. Patch by Daniel Stenberg.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
