<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>738c833d38d41f8f76eb7e77ab39add82b1ae1e2 - platform/libcore - Git at Google</title><link rel="stylesheet" type="text/css" href="/+static/base.css"><!-- default customHeadTagPart --></head><body class="Site"><header class="Site-header"><div class="Header"><a class="Header-image" href="/"><img src="//www.gstatic.com/images/branding/lockups/2x/lockup_git_color_108x24dp.png" width="108" height="24" alt="Google Git"></a><div class="Header-menu"> <a class="Header-menuItem" href="https://accounts.google.com/AccountChooser?service=gerritcodereview&amp;continue=https://android.googlesource.com/login/platform/libcore/%2B/738c833d38d41f8f76eb7e77ab39add82b1ae1e2">Sign in</a> </div></div></header><div class="Site-content"><div class="Container "><div class="Breadcrumbs"><a class="Breadcrumbs-crumb" href="/?format=HTML">android</a> / <a class="Breadcrumbs-crumb" href="/platform/">platform</a> / <a class="Breadcrumbs-crumb" href="/platform/libcore/">libcore</a> / <span class="Breadcrumbs-crumb">738c833d38d41f8f76eb7e77ab39add82b1ae1e2</span></div><div class="u-monospace Metadata"><table><tr><th class="Metadata-title">commit</th><td>738c833d38d41f8f76eb7e77ab39add82b1ae1e2</td><td><span>[<a href="/platform/libcore/+log/738c833d38d41f8f76eb7e77ab39add82b1ae1e2">log</a>]</span> <span>[<a href="/platform/libcore/+archive/738c833d38d41f8f76eb7e77ab39add82b1ae1e2.tar.gz">tgz</a>]</span></td></tr><tr><th class="Metadata-title">author</th><td>Neil Fuller &lt;nfuller@google.com&gt;</td><td>Wed Jun 25 17:54:12 2014 +0100</td></tr><tr><th class="Metadata-title">committer</th><td>Neil Fuller &lt;nfuller@google.com&gt;</td><td>Mon Jun 30 12:59:01 2014 +0100</td></tr><tr><th class="Metadata-title">tree</th><td><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/">9b68f1d0ab239501f209cc3af498b833f6e5e116</a></td></tr><tr><th class="Metadata-title">parent</th><td><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E">aff7ffc8614d439740e2b4d692925e6712015f43</a> <span>[<a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E%21/">diff</a>]</span></td></tr></table></div><pre class="u-pre u-monospace MetadataMessage">Add additional checks in ObjectInputStream

Thanks to Jann Horn for reporting a bug in ObjectInputStream
and sending the initial patch.

Add some checks that the class of an object
being deserialized still conforms to the requirements
for serialization.

Add some checks that the class being deserialized matches
the type information (enum, serializable, externalizable)
held in the stream.

Delayed static initialization of classes until the
type of the class has been validated against the stream
content in some cases.

Added more tests.

Bug: 15874291
Change-Id: <a href="https://android-review.googlesource.com/#/q/I0f0fe68e0d21e041c5160482113ae847c357b8f5">I0f0fe68e0d21e041c5160482113ae847c357b8f5</a>
</pre><ul class="DiffTree"><li><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/luni/src/main/java/java/io/ObjectInputStream.java">luni/src/main/java/java/io/ObjectInputStream.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E%21/#F0">diff</a>]</span></li><li><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/luni/src/main/java/java/io/ObjectStreamClass.java">luni/src/main/java/java/io/ObjectStreamClass.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E%21/#F1">diff</a>]</span></li><li><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/luni/src/main/java/java/io/ObjectStreamConstants.java">luni/src/main/java/java/io/ObjectStreamConstants.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E%21/#F2">diff</a>]</span></li><li><a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/luni/src/test/java/libcore/java/io/SerializationTest.java">luni/src/test/java/libcore/java/io/SerializationTest.java</a><span class="DiffTree-action DiffTree-action--modify">[<a href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2%5E%21/#F3">diff</a>]</span></li></ul><div class="DiffSummary">4 files changed</div><div class="TreeDetail"><div class="u-sha1 u-monospace TreeDetail-sha1">tree: 9b68f1d0ab239501f209cc3af498b833f6e5e116</div><ol class="FileList"><li class="FileList-item FileList-item--regularFile" title="Regular file - Android.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/Android.mk">Android.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CaCerts.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/CaCerts.mk">CaCerts.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - CleanSpec.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/CleanSpec.mk">CleanSpec.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - Docs.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/Docs.mk">Docs.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - JavaLibrary.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/JavaLibrary.mk">JavaLibrary.mk</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NOTICE"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/NOTICE">NOTICE</a></li><li class="FileList-item FileList-item--regularFile" title="Regular file - NativeCode.mk"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/NativeCode.mk">NativeCode.mk</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - benchmarks/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/benchmarks/">benchmarks/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - dalvik/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/dalvik/">dalvik/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - dex/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/dex/">dex/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - dom/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/dom/">dom/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - expectations/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/expectations/">expectations/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - harmony-tests/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/harmony-tests/">harmony-tests/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - include/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/include/">include/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - json/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/json/">json/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - jsr166-tests/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/jsr166-tests/">jsr166-tests/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - libart/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/libart/">libart/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - libdvm/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/libdvm/">libdvm/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - luni/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/luni/">luni/</a></li><li class="FileList-item FileList-item--executableFile" title="Executable file - run-libcore-tests"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/run-libcore-tests">run-libcore-tests</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - support/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/support/">support/</a></li><li class="FileList-item FileList-item--gitTree" title="Tree - xml/"><a class="FileList-itemLink" href="/platform/libcore/+/738c833d38d41f8f76eb7e77ab39add82b1ae1e2/xml/">xml/</a></li></ol></div></div> <!-- Container --></div> <!-- Site-content --><footer class="Site-footer"><div class="Footer"><span class="Footer-poweredBy">Powered by <a href="https://gerrit.googlesource.com/gitiles/">Gitiles</a>| <a href="https://policies.google.com/privacy">Privacy</a></span><span class="Footer-formats"><a class="u-monospace Footer-formatsItem" href="?format=TEXT">txt</a> <a class="u-monospace Footer-formatsItem" href="?format=JSON">json</a></span></div></footer></body></html>