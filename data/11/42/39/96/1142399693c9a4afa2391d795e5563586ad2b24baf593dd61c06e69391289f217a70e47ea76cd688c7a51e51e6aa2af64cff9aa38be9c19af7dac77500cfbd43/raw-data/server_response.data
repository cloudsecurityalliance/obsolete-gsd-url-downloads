<!doctype html>
<!--[if lt IE 7 ]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7 ]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8 ]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
    <meta charset="UTF-8">
    <title>less out of bounds read access - TFPA 002/2014 | The Fuzzing Project</title>
    <meta name="generator" content="Serendipity v.2.3.5">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="index,follow">
    <link rel="canonical" href="https://blog.fuzzing-project.org/3-less-out-of-bounds-read-access-TFPA-0022014.html">
    <link rel="stylesheet" href="https://blog.fuzzing-project.org/serendipity.css?v=">
    <script src="/templates/2k11/js/modernizr-2.7.1.min.js"></script>
    <link rel="alternate" type="application/rss+xml" title="The Fuzzing Project RSS feed" href="https://blog.fuzzing-project.org/feeds/index.rss2">
    <link rel="alternate" type="application/x.atom+xml"  title="The Fuzzing Project Atom feed"  href="https://blog.fuzzing-project.org/feeds/atom.xml">
    <link rel="trackback" type="application/x-www-form-urlencoded" href="https://blog.fuzzing-project.org/comment.php?type=trackback&amp;entry_id=3">
    <link rel="pingback" href="https://blog.fuzzing-project.org/comment.php?type=pingback&amp;entry_id=3">
    <script src="/templates/jquery.js"></script>
    <script>jQuery.noConflict();</script>

    <script src="https://blog.fuzzing-project.org/serendipity.js?v="></script>
</head>
<body>
<a class="visuallyhidden" href="#content"><span lang="en">Skip to content</span></a>
<div id="page" class="clearfix">
    <header id="banner" class="clearfix col2r">
        <div id="identity">
            <a href="https://blog.fuzzing-project.org/">
                <h1>The Fuzzing Project</h1>
                <p>Blog and Advisories</p>            </a>
        </div>

        <form id="searchform" action="/index.php" method="get">
        <div>
            <input type="hidden" name="serendipity[action]" value="search">
            <label for="serendipityQuickSearchTermField">Quicksearch</label>
            <input id="serendipityQuickSearchTermField" name="serendipity[searchTerm]" type="search" placeholder="Search term(s)" value="">
            <input id="searchsend" name="serendipity[searchButton]" type="submit" value="Go!">
        </div>
        </form>
        
            </header>
        <nav id="primary-nav">
        <h2 class="visuallyhidden">Navigation</h2>

        <ul class="clearfix"><li><a href="https://fuzzing-project.org/">Back to main page</a></li><li><a href="https://fuzzing-project.org/software.html">Software list</a></li></ul>
    </nav>
        <div class="clearfix col2r">
        <main id="content"  class="plain-images">
        
            <article id="post_3" class="clearfix serendipity_entry">
        <header class="clearfix">
            <h2><a href="/3-less-out-of-bounds-read-access-TFPA-0022014.html">less out of bounds read access - TFPA 002/2014</a></h2>

            <span class="serendipity_byline block_level"><span class="single_user">Posted by <a href="https://blog.fuzzing-project.org/authors/1-Hanno-Boeck">Hanno BÃ¶ck</a> on </span><time datetime="2014-11-30T13:10:00+01:00">Sunday, November 30. 2014</time></span>
        </header>

        <div class="clearfix content serendipity_entry_body">
                An out of bounds read access in the UTF-8 decoding can be triggered with a malformed file in the tool less. The access happens in the function is_utf8_well_formed (charset.c, line 534) due to a truncated multibyte character in the sample file. It affects the latest upstream less version 470. The bug does not crash less, it can only be made visible by running less with valgrind or compiling it with Address Sanitizer. The security impact is likely minor as it is only an invalid read access.<br />
<br />
This issue has been found with the help of Address Sanitizer.<br />
<br />
The upstream developers have been informed about this issue on 4th November 2014, no fix is available yet. The less webpage has no bug tracker, no open mailing list and no other way to publicly report and document bugs.<br />
<br />
<strong>Conclusion</strong><br />
<br />
Even tools that only do very minor file parsing can expose bugs due to charset encoding, especially in multibyte characters. Please note that the bigger security threat in less comes from the use of lesspipe.<br />
<br />
It is unsettling that the upstream project of an important tool like less is completely unresponsive to bugs and has no public way to discuss them.<br />
<br />
<a href="https://crashes.fuzzing-project.org/TFPA-2014-002-less-oob">less out of bounds read sample with gif header</a><br />
<a href="https://crashes.fuzzing-project.org/TFPA-2014-002-less-oob-no-lesspipe">simpler sample with no header, only works when LESSOPEN is not set</a><br />
<a href="http://osvdb.org/show/osvdb/115007">OSVDB 115007 : less GIF File Handling Out-of-bounds Read Issue</a><br />
<a href="http://seclists.org/oss-sec/2014/q4/769">Discussion of lesspipe security issues on oss-security</a><br />
<a href="https://web.nvd.nist.gov/view/vuln/detail?vulnId=CVE-2014-9488">CVE-2014-9488</a><br />
<br />
<b>Update 2014-12-15:</b> less released a new version 471 and this issue is <strong>not</strong> fixed.<br />
<br />
<b>Update 2015-03-10:</b> Version 475 of less contains a fix for this issue. I never received any reply from the developers.<br />
<br />
less doesn't have public release announcements or a repository, so it's hard to track their changes. The file version.c contains some entry mentioning this issue (without any credit):<br />
<i>v475  3/2/15    Fix possible buffer overrun with invalid UTF-8</i><br />
<br />
The fix is in the file charset.c. <a href="/uploads/less-CVE-2014-9488-utf8-overflow.diff" title="less-CVE-2014-9488-utf8-overflow.diff">Here is a patch.</a><br />
<br />
<b>Update 2015-06-03:</b> It has been pointed out in the comments that the patch I provided was wrong (it was an unrelated fix for another issue). I have replaced it with the correct patch now. Also for clarification it should be pointed out that the latest "stable" version (according to the less webpage) 458 is not affected.
                </div>
                
        <footer class="clearfix">
                    <span class="visuallyhidden">Categories: </span><a href="https://blog.fuzzing-project.org/categories/1-advisories">advisories</a>                 |                             <a href="/3-less-out-of-bounds-read-access-TFPA-0022014.html#comments" title="2 Comments, 2 Trackbacks">2 Comments</a>
                                                    
        </footer>

        <!--
        <rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
                 xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/"
                 xmlns:dc="http://purl.org/dc/elements/1.1/">
        <rdf:Description
                 rdf:about="https://blog.fuzzing-project.org/feeds/ei_3.rdf"
                 trackback:ping="https://blog.fuzzing-project.org/comment.php?type=trackback&amp;entry_id=3"
                 dc:title="less out of bounds read access - TFPA 002/2014"
                 dc:identifier="https://blog.fuzzing-project.org/3-less-out-of-bounds-read-access-TFPA-0022014.html" />
        </rdf:RDF>
        -->

                                            
        <section id="trackbacks" class="serendipity_comments serendipity_section_trackbacks">
            <h3>Trackbacks</h3>

            <div id="trackback_url" class="block_level"><a rel="nofollow" href="https://blog.fuzzing-project.org/comment.php?type=trackback&amp;entry_id=3" title="This link is not meant to be clicked. It contains the trackback URI for this entry. You can use this URI to send ping- &amp; trackbacks from your own blog to this entry. To copy the link, right click and select &quot;Copy Shortcut&quot; in Internet Explorer or &quot;Copy Link Location&quot; in Mozilla.">Trackback specific URI for this entry</a></div>

            <article id="c91" class="clearfix serendipity_comment odd">
    <h4><cite>The Fuzzing Project</cite> on <time datetime="2014-12-23T22:44:40+01:00">Tuesday, December 23. 2014</time>: <a href="http://blog.fuzzing-project.org/4-Several-status-updates.html">Several status updates</a></h4>
    <details>
        <summary>Show preview</summary>
        <div class="content serendipity_commentBody">I think it&#039;s time for some status updates from the Fuzzing Project. In a few days I&#039;ll be at the 31C3 congress in Hamburg. I&#039;ll have a short lightning talk about the Fuzzing Project there. I&#039;ll also be at Real World Crypto a few days later in London. O</div>
    </details>
</article>
<article id="c245" class="clearfix serendipity_comment even">
    <h4><cite>www.us-cert.gov</cite> on <time datetime="2015-04-20T16:53:22+02:00">Monday, April 20. 2015</time>: <a href="http://www.us-cert.gov/ncas/bulletins/SB15-110">PingBack</a></h4>
	<span class="visuallyhidden">Unfortunately, the contents of this trackback can not be displayed.</span>
</article>

        </section>

        <section id="comments" class="serendipity_comments serendipity_section_comments">
            <h3>Comments</h3>

            <p class="manage_comments">Display comments as
                           <a rel="nofollow" href="/index.php?url=3-less-out-of-bounds-read-access-TFPA-0022014.html&amp;serendipity[cview]=linear#comments">Linear</a> | Threaded
                        </p>

            <article id="c304" class="serendipity_comment odd commentlevel-0">
    <header class="clearfix">
        <h4>stsp on <time datetime="2015-06-03T17:52:12+02:00">Wednesday, June  3. 2015</time>:</h4>
        </header>

    <div class="serendipity_commentBody clearfix content">
                The bug was in the utf_bin_count() function in charset.c, not line.c.<br />
<br />
The patch you've linked shows another caller of is_utf8_well_formed that was updated to pass a new parameter but is otherwise unrelated to the problem.<br />
<br />
--- less-470/charset.c	Sun Oct  5 23:03:31 2014<br />
+++ less-475/charset.c	Sat May  2 22:08:38 2015<br />
@@ -506,8 +506,9 @@ utf_len(ch)<br />
  <strong> Does the parameter point to the lead byte of a well-formed UTF-8 character?<br />
  </strong>/<br />
 	public int<br />
-is_utf8_well_formed(s)<br />
+is_utf8_well_formed(s, slen)<br />
 	unsigned char *s;<br />
+	int slen;<br />
 {<br />
 	int i;<br />
 	int len;<br />
@@ -516,6 +517,8 @@ is_utf8_well_formed(s)<br />
 		return (0);<br />
 <br />
 	len = utf_len((char) s[0]);<br />
+	if (len &gt; slen)<br />
+		return (0);<br />
 	if (len == 1)<br />
 		return (1);<br />
 	if (len == 2)<br />
@@ -547,7 +550,7 @@ utf_bin_count(data, len)<br />
 	int bin_count = 0;<br />
 	while (len &gt; 0)<br />
 	{<br />
-		if (is_utf8_well_formed(data))<br />
+		if (is_utf8_well_formed(data, len))<br />
 		{<br />
 			int clen = utf_len(*data);<br />
 			data += clen;
        </div>

    <footer>
        <time>17:52</time>
        | <a class="comment_source_trace" href="#c304" title="Permanent link for this comment">Link</a>
            | <a class="comment_reply" href="#serendipity_CommentForm" id="serendipity_reply_304">Reply</a>
        <div id="serendipity_replyform_304"></div>
    </footer>
</article>
<article id="c305" class="serendipity_comment even commentlevel-1">
    <header class="clearfix">
        <h4><a href="https://hboeck.de/">Hanno</a> on <time datetime="2015-06-03T19:57:38+02:00">Wednesday, June  3. 2015</time>:</h4>
        </header>

    <div class="serendipity_commentBody clearfix content">
                Thanks for noting that, you are right. I've replaced the patch with the correct one now and added an update notice.
        </div>

    <footer>
        <time>19:57</time>
        | <a class="comment_source_trace" href="#c305" title="Permanent link for this comment">Link</a>
            | <a class="comment_reply" href="#serendipity_CommentForm" id="serendipity_reply_305">Reply</a>
        <div id="serendipity_replyform_305"></div>
    </footer>
</article>

                </section>
            <a id="feedback"></a>
                        <section id="respond" class="serendipity_section_commentform">
            <h3>Add Comment</h3>
            <div id="serendipityCommentFormC" class="serendipityCommentForm">
    <div id="serendipity_replyform_0"></div>
    <a id="serendipity_CommentForm"></a>
    <form id="serendipity_comment" action="/index.php?url=3-less-out-of-bounds-read-access-TFPA-0022014.html#feedback" method="post">
    <div><input type="hidden" name="serendipity[entry_id]" value="3"></div>
    <div class="form_field">
        <label for="serendipity_commentform_name">Name*</label>
        <input id="serendipity_commentform_name" name="serendipity[name]" type="text" value="" placeholder="e.g. John Doe" required>
    </div>
    <div class="form_field">
        <label for="serendipity_commentform_email">Email</label>
        <input id="serendipity_commentform_email" name="serendipity[email]" type="email" value="" placeholder="e.g. mail@example.org">
    </div>
    <div class="form_field">
        <label for="serendipity_commentform_url">Homepage</label>
        <input id="serendipity_commentform_url" name="serendipity[url]" type="url" value="" placeholder="e.g. http://example.org">
    </div>
    <div class="form_tarea">
        <label for="serendipity_commentform_comment">Comment*</label>
        <textarea id="serendipity_commentform_comment" name="serendipity[comment]" rows="10" placeholder="What do you want to say?" required></textarea>
    </div>
    <div class="form_field">
        <label id="reply-to-hint" for="serendipity_replyTo">In reply to</label>
        <select id="serendipity_replyTo" onchange="" name="serendipity[replyTo]"><option value="0">[ Top level ]</option><option value="304">#1: stsp on 2015-06-03 17:52</option>
<option value="305">&#160;&#160;#1.1: Hanno on 2015-06-03 19:57</option>
</select>
    </div>
    <div id="serendipity_comment_phone" class="serendipity_commentDirection comment_phone_input">
    <label for="serendipity_commentform_phone">Phone*</label>
    <input id="serendipity_commentform_phone" class="comment_phone_input" type="text" name="serendipity[phone]" value="" size="50" maxlength="60" placeholder="You don't want to give me your number, do you? ;)"/>
</div>
<div id="serendipity_comment_beecaptcha" class="form_field">
    <label for="bee_captcha">What is eight minus four?</label>
    <input class="" type="text" id="bee_captcha" name="serendipity[beecaptcha]" size="10" value="" placeholder=""/>
</div>
<div class="serendipity_commentDirection serendipity_comment_s9ymarkup">Enclosing asterisks marks text as bold (*word*), underscore are made via _word_.</div><div class="serendipity_commentDirection serendipity_comment_emoticate">Standard emoticons like :-) and ;-) are converted to images.</div><div class="serendipity_commentDirection serendipity_comment_spamblock">E-Mail addresses will not be displayed and will only be used for E-Mail notifications.</div><input type="hidden" name="serendipity[token]" value="7acf848b8c5d868d9f59b5faf5c85c6b" />
<div class="serendipity_commentDirection serendipity_comment_captcha"><br />To prevent automated Bots from commentspamming, please enter the string you see in the image below in the appropriate input box. Your comment will only be submitted if the strings match. Please ensure that your browser supports and accepts cookies, or your comment cannot be verified correctly.<br /><img src="https://blog.fuzzing-project.org/plugin/captcha_f384a9caa85a123dcf6453091a020532" onclick="this.src=this.src + '1'" title="Enter the string you see here in the input box!" alt="CAPTCHA" class="captcha" /><br /><label for="captcha">Enter the string from the spam-prevention image above: </label><br /><input class="input_textbox" type="text" size="5" name="serendipity[captcha]" value="" id="captcha" /></div>
    <fieldset class="form_toolbar">
        <legend class="visuallyhidden">Form options</legend>
        <div class="form_box">
            <input id="checkbox_remember" name="serendipity[remember]" type="checkbox" ><label for="checkbox_remember">Remember Information? </label>
        </div>
          <div class="form_box">
            <input id="checkbox_subscribe" name="serendipity[subscribe]" type="checkbox"  ><label for="checkbox_subscribe">Subscribe to this entry</label>
        </div>
      </fieldset>
    <div class="form_button">
        <input id="serendipity_preview" name="serendipity[preview]" type="submit" value="Preview">
        <input id="serendipity_submit" name="serendipity[submit]" type="submit" value="Submit Comment">
    </div>
</form>
</div>

        </section>

        
    </article>
        



        </main>
                <aside id="sidebar_right">
            <h2 class="visuallyhidden">Sidebar</h2>
                <section class="sidebar_plugin clearfix odd serendipity_plugin_html_nugget">
                <h3>The Fuzzing Project</h3>
                <div class="sidebar_content clearfix">You  may want to go <a href="https://fuzzing-project.org/">back to the Fuzzing Project's main page</a> or <a href="https://fuzzing-project.org/software/">software list</a>.</div>
    </section>
    <section class="sidebar_plugin clearfix even serendipity_plugin_archives">
                <h3>Archives</h3>
                <div class="sidebar_content clearfix"><ul class="plainList">
    <li><a href="/archives/2021/10.html" title="October 2021">October 2021</a></li>
    <li><a href="/archives/2021/09.html" title="September 2021">September 2021</a></li>
    <li><a href="/archives/2021/08.html" title="August 2021">August 2021</a></li>
    <li><a href="/index.php?frontpage">Recent...</a></li>
    <li><a href="https://blog.fuzzing-project.org/archive">Older...</a></li>
</ul>
</div>
    </section>
    <section class="sidebar_plugin clearfix odd serendipity_plugin_categories">
                <h3>Categories</h3>
                <div class="sidebar_content clearfix"><form action="https://blog.fuzzing-project.org/index.php?frontpage" method="post">
              <div id="serendipity_category_form_content">
<ul id="serendipity_categories_list" style="list-style: none; margin: 0px; padding: 0px">
<li class="category_depth0 category_1" style="display: block;"><input style="width: 15px" type="checkbox" name="serendipity[multiCat][]" value="1" /><a class="serendipity_xml_icon" href="/feeds/categories/1-advisories.rss"><img src="/templates/2k11/img/xml.gif" alt="XML" style="border: 0px" /></a> <a href="/categories/1-advisories" title="" style="padding-left: 0px">advisories</a></li>
</ul>
<div class="category_submit"><input type="submit" name="serendipity[isMultiCat]" value="Go!" /></div>
</div>
</form>
</div>
    </section>
    <section class="sidebar_plugin clearfix even serendipity_plugin_syndication">
                <h3>Syndicate This Blog</h3>
                <div class="sidebar_content clearfix">
<ul id="serendipity_syndication_list" class="plainList"><li><a class="subtome" href="https://blog.fuzzing-project.org/feeds/index.rss2" onclick="document.subtomeBtn=this;document.subtomeBtn.dataset['subtomeFeeds']='https%3A%2F%2Fblog.fuzzing-project.org%2Ffeeds%2Findex.rss2';var s=document.createElement('script');s.src='https://www.subtome.com/load.js';document.body.appendChild(s);return false;"><img src="/templates/2k11/img/subtome.png" alt="XML" style="border: 0px" /></a>
</li>
<li><a class="subtome" href="https://blog.fuzzing-project.org/feeds/comments.rss2" onclick="document.subtomeBtn=this;document.subtomeBtn.dataset['subtomeFeeds']='https%3A%2F%2Fblog.fuzzing-project.org%2Ffeeds%2Fcomments.rss2';var s=document.createElement('script');s.src='https://www.subtome.com/load.js';document.body.appendChild(s);return false;"><img src="/templates/2k11/img/xml.gif" alt="XML" style="border: 0px" /></a>
 <a href="https://blog.fuzzing-project.org/feeds/comments.rss2" onclick="document.subtomeBtn=this;document.subtomeBtn.dataset['subtomeFeeds']='https%3A%2F%2Fblog.fuzzing-project.org%2Ffeeds%2Fcomments.rss2';var s=document.createElement('script');s.src='https://www.subtome.com/load.js';document.body.appendChild(s);return false;">Comments</a>
</li>
</ul>
</div>
    </section>

        </aside>
        </div>

    <footer id="colophon">
        <p><span lang="en">Powered by <a href="http://s9y.org">Serendipity</a> &amp; the <i>2k11</i> theme.</span></p>
    </footer>
</div>

<script src="/templates/2k11/js/2k11.min.js"></script>

<script>var spamBeeData = function() { var RaxCb = {};var UckQN = unescape('%64%65%66%61%75%6c%74');var gwuqA = unescape('%32%31%30%38%39%32%35%35%35%37');var fdgQj = unescape('%25%45%41%25%39%39%25%38%31');RaxCb['method'] = UckQN;RaxCb['scrambleKey'] = gwuqA;RaxCb['answer'] = fdgQj;return RaxCb; }();</script>
<script src="/plugins/serendipity_event_spamblock_bee/serendipity_event_spamblock_bee.js"></script>

</body>
</html>
