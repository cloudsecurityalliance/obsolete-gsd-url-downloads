<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#225692 - dpkg: Allows users to stash away vulnerable versions of setuid binaries - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=225692&quot;&gt;225692&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:225692@bugs.debian.org">#225692</a><br>
dpkg: Allows users to stash away vulnerable versions of setuid binaries</h1>
<div class="versiongraph"><a href="version.cgi?info=1;package=dpkg;absolute=0;found=1.9.21;fixed=dpkg%2F1.10.19;collapse=1"><img alt="version graph" src="version.cgi?height=2;collapse=1;found=1.9.21;fixed=dpkg%2F1.10.19;width=2;absolute=0;package=dpkg"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=dpkg">dpkg</a>;
Maintainer for <a href="pkgreport.cgi?package=dpkg">dpkg</a> is <a href="pkgreport.cgi?maint=debian-dpkg%40lists.debian.org">Dpkg Developers &lt;debian-dpkg@lists.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=dpkg">dpkg</a> is <a href="pkgreport.cgi?src=dpkg">src:dpkg</a> (<a href="https://tracker.debian.org/pkg/dpkg">PTS</a>, <a href="https://buildd.debian.org/dpkg">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=dpkg">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=erno-debbugs%40erno.iki.fi">Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</a></p>
  <p>Date: Wed, 31 Dec 2003 17:48:10 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: fixed, patch</p>

<p>Found in version 1.9.21</p>
<p>Fixed in version dpkg/1.10.19</p>

<p><strong>Done:</strong> Scott James Remnant &lt;scott@netsplit.com&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><a href="javascript:toggle_infmessages();">Toggle useless messages</a></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=225692;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<strong>Report forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=2">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=4">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=5">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=5">mbox</a>, <a href="mailto:225692@bugs.debian.org?References=%3C20031231163020.111021886B2%40erno.iki.fi%3E&amp;In-Reply-To=%3C20031231163020.111021886B2%40erno.iki.fi%3E&amp;body=On%20Wed%2C%2031%20Dec%202003%2018%3A30%3A19%20%2B0200%20Erno%20Kuusela%20%3Cerno-debbugs%40erno.iki.fi%3E%20wrote%3A%0A%3E%20Package%3A%20dpkg%0A%3E%20Version%3A%201.9.21%0A%3E%20Severity%3A%20grave%0A%3E%20Tags%3A%20security%0A%3E%20%0A%3E%20%0A%3E%20%0A%3E%20see%20http%3A%2F%2Flists.jammed.com%2FISN%2F2003%2F12%2F0056.html%0A%3E%20%0A%3E%20users%20can%20make%20hardlinks%20to%20root%20owned%20setuid%20binaries%20in%20the%20usual%0A%3E%20partitioning%20configurations%2C%20so%20unlinking%20them%20is%20not%20a%20reliable%20way%0A%3E%20to%20get%20rid%20of%20them.%0A%3E%20%0A%3E%20with%20the%20current%20dpkg%20behaviour%20it%27s%20not%20enough%20to%20upgrade%20the%20package%0A%3E%20before%20malicious%20local%20users%20get%20their%20hands%20on%20the%20exploit%2C%20since%20they%0A%3E%20can%20stash%20the%20binary%20away%20and%20wait%20for%20an%20exploit%20to%20become%20available.%0A%3E%20%0A%3E%20i%20think%20a%20fix%20for%20this%20might%20be%20to%20open%28%29%20the%20binary%2C%20unlink%28%29%20it%2C%0A%3E%20and%20then%20use%20fchmod%28%29%20to%20remove%20the%20setuid%20and%20setgid%20bits.%20%0A%3E%20%28optionally%20check%20link%20count%20to%20see%20if%20someone%20is%20trying%20this%0A%3E%20and%20print%20a%20warning%29%0A%3E%20%0A%3E%20truncate%28%29%20is%20out%20since%20running%20copies%20of%20the%20binaries%0A%3E%20won%27t%20like%20it%2C%20and%20a%20normal%20chmod%28%29%20would%20be%20racy...%20%0A%3E%20%0A%3E%20--%20System%20Information%3A%0A%3E%20Debian%20Release%3A%203.0%0A%3E%20Architecture%3A%20i386%0A%3E%20Kernel%3A%20Linux%20fabulous%202.6.0%20%232%20Sun%20Dec%2021%2010%3A27%3A12%20EET%202003%20i686%0A%3E%20Locale%3A%20LANG%3DC%2C%20LC_CTYPE%3Dfi_FI%0A%3E%20%0A%3E%20Versions%20of%20packages%20dpkg%20depends%20on%3A%0A%3E%20ii%20%20libc6%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.3.2.ds1-10%20%20%20GNU%20C%20Library%3A%20Shared%20libraries%20an%0A%3E%20ii%20%20libncurses5%20%20%20%20%20%20%20%20%20%20%20%20%20%20%205.3.20030719-2%20Shared%20libraries%20for%20terminal%20hand%0A%3E%20ii%20%20libstdc%2B%2B2.10-glibc2.2%20%20%20%201%3A2.95.4-15%20%20%20%20The%20GNU%20stdc%2B%2B%20library%0A%3E%20%0A%3E%20--%20no%20debconf%20information%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20dpkg%3A%20Allows%20users%20to%20stash%20away%20vulnerable%20versions%20of%20setuid%20binaries">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno-debbugs%40erno.iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Debian Bug Tracking System &lt;submit@bugs.debian.org&gt;</div>
<div class="header"><span class="headerfield">Subject:</span> dpkg: Allows users to stash away vulnerable versions of setuid binaries</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 31 Dec 2003 18:30:19 +0200</div>
</div>
<pre class="message">Package: dpkg
Version: 1.9.21
Severity: grave
Tags: security



see <a href="http://lists.jammed.com/ISN/2003/12/0056.html">http://lists.jammed.com/ISN/2003/12/0056.html</a>

users can make hardlinks to root owned setuid binaries in the usual
partitioning configurations, so unlinking them is not a reliable way
to get rid of them.

with the current dpkg behaviour it&#39;s not enough to upgrade the package
before malicious local users get their hands on the exploit, since they
can stash the binary away and wait for an exploit to become available.

i think a fix for this might be to open() the binary, unlink() it,
and then use fchmod() to remove the setuid and setgid bits. 
(optionally check link count to see if someone is trying this
and print a warning)

truncate() is out since running copies of the binaries
won&#39;t like it, and a normal chmod() would be racy... 

-- System Information:
Debian Release: 3.0
Architecture: i386
Kernel: Linux fabulous 2.6.0 #2 Sun Dec 21 10:27:12 EET 2003 i686
Locale: LANG=C, LC_CTYPE=fi_FI

Versions of packages dpkg depends on:
ii  libc6                     2.3.2.ds1-10   GNU C Library: Shared libraries an
ii  libncurses5               5.3.20030719-2 Shared libraries for terminal hand
ii  libstdc++2.10-glibc2.2    1:2.95.4-15    The GNU stdc++ library

-- no debconf information



</pre>

<div class="msgreceived"><hr><p>
<a name="6"></a>
<strong>Message sent on</strong> to <code>Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</code>:<br>
Bug#225692.
(<a href="bugreport.cgi?bug=225692;msg=7">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="8"></a><a name="msg8"></a><a href="#8">Message #8</a> received at 225692-submitter@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=8">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=8">mbox</a>, <a href="mailto:225692@bugs.debian.org?References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E&amp;In-Reply-To=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E&amp;body=On%20Sat%2C%203%20Jan%202004%2021%3A41%3A06%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20This%20is%20really%20a%20common%20setuid%20problem%2C%20and%2C%20just%20for%20reference%20the%20%0A%3E%20article%20you%20mention%20was%20published%20after%20a%20contest%3A%0A%3E%20%0A%3E%20Contest%20-%20The%20mysteriously%20persistently%20exploitable%20program.%0A%3E%20http%3A%2F%2Fwww.hackinglinuxexposed.com%2Farticles%2F20031111.html%0A%3E%20%28Notice%20that%20the%20incident%20is%20Debian-related%29%0A%3E%20%0A%3E%20The%20mysteriously%20persistently%20exploitable%20program%20explained.%0A%3E%20http%3A%2F%2Fwww.hackinglinuxexposed.com%2Farticles%2F20031214.html%0A%3E%20%0A%3E%20I%27m%20not%20sure%20if%20this%20bug%20should%20qualify%20as%20%27grave%27%20since%20it%27s%20not%20dpkg%0A%3E%20task%20to%20control%20who%20symlinks%20to%20potentially%20dangerous%20binaries.%20As%0A%3E%20described%20in%20the%20Securing%20Debian%20Manual%20%28Mounting%20partitions%20the%20right%20way%0A%3E%20%5B1%5D%29%20it%20is%20the%20administrator%20task%20to%20avoid%20symlink%20attacks%20%28as%20well%20as%20DoS%0A%3E%20attacks%20due%20to%20system%20partitions%20filling%20up%29%20by%20separating%20user-writable%0A%3E%20directories%20%28these%20include%20%2Fhome%2C%20%2Ftmp%20and%20%2Fvar%2Ftmp%29.%20These%20directories%0A%3E%20should%20be%20nosuid%2C%20and%20nodev%20%28and%20maybe%20noexec%20too%20even%20though%20it%20provides%0A%3E%20little%20protection%29.%0A%3E%20%0A%3E%20Notably%2C%20though%2C%20I%20just%20reviewed%20dpkg%27s%20code%2C%20and%20found%20this%3A%0A%3E%20%0A%3E%20%28dpkg-1.10.18%2Fmain%2Fremove.c%29%0A%3E%20%20%20%20%20259%20%20%20%20%20%20%20%7B%0A%3E%20%20%20%20%20260%20%20%20%20%20%20%20%20%20%2F%2A%0A%3E%20%20%20%20%20261%20%20%20%20%20%20%20%20%20%20%2A%20If%20file%20to%20remove%20is%20a%20device%20or%20s%5Bgu%5Did%2C%20change%20its%20mode%0A%3E%20%20%20%20%20262%20%20%20%20%20%20%20%20%20%20%2A%20so%20that%20a%20malicious%20user%20cannot%20use%20it%20even%20if%20it%27s%20linked%0A%3E%20%20%20%20%20263%20%20%20%20%20%20%20%20%20%20%2A%20to%20another%20file%0A%3E%20%20%20%20%20264%20%20%20%20%20%20%20%20%20%20%2A%2F%0A%3E%20%20%20%20%20265%20%20%20%20%20%20%20%20%20struct%20stat%20stat_buf%3B%0A%3E%20%20%20%20%20266%20%20%20%20%20%20%20%20%20if%20%28stat%28fnvb.buf%2C%26stat_buf%29%3D%3D0%29%20%7B%0A%3E%20%20%20%20%20267%20%20%20%20%20%20%20%20%20%20%20if%20%28S_ISCHR%28stat_buf.st_mode%29%20%7C%7C%20S_ISBLK%28stat_buf.st_mode%29%29%20%7B%0A%3E%20%20%20%20%20268%20%20%20%20%20%20%20%20%20%20%20%20%20chmod%28fnvb.buf%2C0%29%3B%0A%3E%20%20%20%20%20269%20%20%20%20%20%20%20%20%20%20%20%7D%0A%3E%20%20%20%20%20270%20%20%20%20%20%20%20%20%20%20%20if%20%28stat_buf.st_mode%20%26%20%28S_ISUID%7CS_ISGID%29%29%20%7B%0A%3E%20%20%20%20%20271%20%20%20%20%20%20%20%20%20%20%20%20%20chmod%28fnvb.buf%2Cstat_buf.st_mode%20%26%20~%28S_ISUID%7CS_ISGID%29%29%3B%0A%3E%20%20%20%20%20272%20%20%20%20%20%20%20%20%20%20%20%7D%0A%3E%20%20%20%20%20273%20%20%20%20%20%20%20%20%20%7D%0A%3E%20%20%20%20%20274%20%20%20%20%20%20%20%7D%0A%3E%20%20%20%20%20275%20%20%20%20%20%20%20if%20%28unlink%28fnvb.buf%29%29%20ohshite%28_%28%22cannot%20remove%20file%20%60%25.250s%27%22%29%2Cfnv%20%20%20%20275%20b.buf%29%3B%0A%3E%20%0A%3E%20%0A%3E%20Now%2C%20I%20believe%20this%20is%20done%20when%20removing%20a%20package%20%28it%27s%20under%20%20%0A%3E%20removal_bulk%28%29%29%2C%20but%20_not_%20when%20upgrading%20%28is%20it%20done%20with%20%0A%3E%20process_archive%28%29%29%3A%0A%3E%20%0A%3E%20dpkg-1.10.18%2Fmain%2Fprocessarc.c%0A%3E%20%20%20%2F%2A%0A%3E%20%20%20%20%2A%20Now%20we%20unpack%20the%20archive%2C%20backing%20things%20up%20as%20we%20go.%0A%3E%20%20%20%20%2A%20For%20each%20file%2C%20we%20check%20to%20see%20if%20it%20already%20exists.%0A%3E%20%20%20%20%2A%20There%20are%20several%20possibilities%3A%0A%3E%20%20%20%20%2A%20%2B%20We%20are%20trying%20to%20install%20a%20non-directory%20...%0A%3E%20%20%20%20%2A%20%20-%20It%20doesn%27t%20exist.%20%20In%20this%20case%20we%20simply%20extract%20it.%0A%3E%20%20%20%20%2A%20%20-%20It%20is%20a%20plain%20file%2C%20device%2C%20symlink%2C%20%26c.%20%20We%20do%20an%20%60atomic%0A%3E%20%20%20%20%2A%20%20%20%20overwrite%27%20using%20link%28%29%20and%20rename%28%29%2C%20but%20leave%20a%20backup%20copy.%0A%3E%20%20%20%20%2A%20%20%20%20Later%2C%20when%20we%20delete%20the%20backup%2C%20we%20remove%20it%20from%20any%20other%0A%3E%20%20%20%20%2A%20%20%20%20packages%27%20lists.%0A%3E%20%0A%3E%20As%20far%20as%20I%20understand%20the%20code%20%28which%20I%20might%20get%20it%20wrong%29%2C%20it%20will%20just%20%0A%3E%20get%20unlinked%3A%0A%3E%20%0A&amp;subject=Re%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 225692-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 3 Jan 2004 21:41:06 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=8">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">This is really a common setuid problem, and, just for reference the 
article you mention was published after a contest:

Contest - The mysteriously persistently exploitable program.
<a href="http://www.hackinglinuxexposed.com/articles/20031111.html">http://www.hackinglinuxexposed.com/articles/20031111.html</a>
(Notice that the incident is Debian-related)

The mysteriously persistently exploitable program explained.
<a href="http://www.hackinglinuxexposed.com/articles/20031214.html">http://www.hackinglinuxexposed.com/articles/20031214.html</a>

I&#39;m not sure if this bug should qualify as &#39;grave&#39; since it&#39;s not dpkg
task to control who symlinks to potentially dangerous binaries. As
described in the Securing Debian Manual (Mounting partitions the right way
[1]) it is the administrator task to avoid symlink attacks (as well as DoS
attacks due to system partitions filling up) by separating user-writable
directories (these include /home, /tmp and /var/tmp). These directories
should be nosuid, and nodev (and maybe noexec too even though it provides
little protection).

Notably, though, I just reviewed dpkg&#39;s code, and found this:

(dpkg-1.10.18/main/remove.c)
    259       {
    260         /*
    261          * If file to remove is a device or s[gu]id, change its mode
    262          * so that a malicious user cannot use it even if it&#39;s linked
    263          * to another file
    264          */
    265         struct stat stat_buf;
    266         if (stat(fnvb.buf,&amp;stat_buf)==0) {
    267           if (S_ISCHR(stat_buf.st_mode) || S_ISBLK(stat_buf.st_mode)) {
    268             chmod(fnvb.buf,0);
    269           }
    270           if (stat_buf.st_mode &amp; (S_ISUID|S_ISGID)) {
    271             chmod(fnvb.buf,stat_buf.st_mode &amp; ~(S_ISUID|S_ISGID));
    272           }
    273         }
    274       }
    275       if (unlink(fnvb.buf)) ohshite(_(&quot;cannot remove file `%.250s&#39;&quot;),fnv    275 b.buf);


Now, I believe this is done when removing a package (it&#39;s under  
removal_bulk()), but _not_ when upgrading (is it done with 
process_archive()):

dpkg-1.10.18/main/processarc.c
  /*
   * Now we unpack the archive, backing things up as we go.
   * For each file, we check to see if it already exists.
   * There are several possibilities:
   * + We are trying to install a non-directory ...
   *  - It doesn&#39;t exist.  In this case we simply extract it.
   *  - It is a plain file, device, symlink, &amp;c.  We do an `atomic
   *    overwrite&#39; using link() and rename(), but leave a backup copy.
   *    Later, when we delete the backup, we remove it from any other
   *    packages&#39; lists.

As far as I understand the code (which I might get it wrong), it will just 
get unlinked:

641:      if (donotrm) continue;
642:      if (!unlink(fnamevb.buf)) continue;

and is not modified as per removal. 

Shouldn&#39;t it be better if the code used in removal.c was re-used in 
processarc.c. As I understand it, dpkg is vulnerable to symlink attacks to 
suid binaries _only_ when a package is upgraded but not when it&#39;s removed.

If my assessment is accurate maybe this bug could be tagged &#39;patch&#39; by the
dpkg team (the code from lines 259-274 of remove.c should be copied
verbatim between lines 641 and 642 of processarc and probably then 
&#39;s/fnvb/fnamevb&#39;). In any case IMHO this bug should be re-prioried as 
&#39;wishlist&#39; (but keeping the security tag).

Regards

Javier Fernandez-Sanguino


[1] 
<a href="http://www.debian.org/doc/manuals/securing-debian-howto/ch4.en.html#s4.9">http://www.debian.org/doc/manuals/securing-debian-howto/ch4.en.html#s4.9</a>
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=8">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="9"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=10">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=10">mbox</a>, <a href="#9">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="11"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=12">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=12">mbox</a>, <a href="#11">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="13"></a><a name="msg13"></a><a href="#13">Message #13</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=13">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=13">mbox</a>, <a href="mailto:225692@bugs.debian.org?subject=Re%3A%20Bug%23225692%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug&amp;body=On%20Sun%2C%204%20Jan%202004%2003%3A24%3A09%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20hello%2C%0A%3E%20%0A%3E%20the%20issue%20is%20specifically%20hard%20links%2C%20there%20is%20no%20problem%20with%20symlinks.%0A%3E%20%0A%3E%20%7C%20I%27m%20not%20sure%20if%20this%20bug%20should%20qualify%20as%20%27grave%27%20since%20it%27s%20not%20dpkg%0A%3E%20%7C%20task%20to%20control%20who%20symlinks%20to%20potentially%20dangerous%20binaries.%20As%0A%3E%20%0A%3E%20no%2C%20but%20dpkg%20could%20handle%20the%20upgrade%20%2F%20safe%20neutralization%20of%20old%20setuid%0A%3E%20binaries%20in%20the%20manner%20i%20described%2C%20and%20it%20doesn%27t.%0A%3E%20%0A%3E%20%7C%20described%20in%20the%20Securing%20Debian%20Manual%20%28Mounting%20partitions%20the%20right%20way%0A%3E%20%7C%20%5B1%5D%29%20it%20is%20the%20administrator%20task%20to%20avoid%20symlink%20attacks%20%28as%20well%20as%20DoS%0A%3E%20%7C%20attacks%20due%20to%20system%20partitions%20filling%20up%29%20by%20separating%20user-writable%0A%3E%20%7C%20directories%20%28these%20include%20%2Fhome%2C%20%2Ftmp%20and%20%2Fvar%2Ftmp%29.%20These%20directories%0A%3E%20%7C%20should%20be%20nosuid%2C%20and%20nodev%20%28and%20maybe%20noexec%20too%20even%20though%20it%20provides%0A%3E%20%7C%20little%20protection%29.%0A%3E%20%0A%3E%20then%20the%20installer%20should%20make%20sure%20the%20system%20gets%20partitioned%20and%0A%3E%20configured%20this%20way%2C%20or%20warn%20the%20user%20in%20big%20friendly%20letters.%20but%0A%3E%20solving%20the%20problem%20with%20partitions%20is%20not%20as%20good%20solution%20in%20my%0A%3E%20opinion%2C%20since%20fragmenting%20disks%20to%20multiple%20partitions%20can%20lead%20to%0A%3E%20inflexibility%20and%20other%20problems.%0A%3E%20%0A%3E%20the%20rest%20of%20your%20mail%20regarding%20dpkg%20code%20looks%20good%20to%20me%20although%0A%3E%20i%27m%20no%20expert%20on%20dpkg.%0A%3E%20%0A%3E%20%20%20--%20erno%0A%3E%20%0A%3E%20%0A&amp;In-Reply-To=%3C20040104012409.GO2410%40erno.iki.fi%3E&amp;References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E%0A%20%3C20040104012409.GO2410%40erno.iki.fi%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 4 Jan 2004 03:24:09 +0200</div>
</div>
<pre class="message">hello,

the issue is specifically hard links, there is no problem with symlinks.

| I&#39;m not sure if this bug should qualify as &#39;grave&#39; since it&#39;s not dpkg
| task to control who symlinks to potentially dangerous binaries. As

no, but dpkg could handle the upgrade / safe neutralization of old setuid
binaries in the manner i described, and it doesn&#39;t.

| described in the Securing Debian Manual (Mounting partitions the right way
| [1]) it is the administrator task to avoid symlink attacks (as well as DoS
| attacks due to system partitions filling up) by separating user-writable
| directories (these include /home, /tmp and /var/tmp). These directories
| should be nosuid, and nodev (and maybe noexec too even though it provides
| little protection).

then the installer should make sure the system gets partitioned and
configured this way, or warn the user in big friendly letters. but
solving the problem with partitions is not as good solution in my
opinion, since fragmenting disks to multiple partitions can lead to
inflexibility and other problems.

the rest of your mail regarding dpkg code looks good to me although
i&#39;m no expert on dpkg.

  -- erno


</pre>

<div class="infmessage"><hr><p>
<a name="14"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=15">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=15">mbox</a>, <a href="#14">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="16"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=17">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="18"></a><a name="msg18"></a><a href="#18">Message #18</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=18">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=18">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040104035808.GQ2410%40erno.iki.fi%3E&amp;References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E%0A%20%3C20040104035808.GQ2410%40erno.iki.fi%3E&amp;body=On%20Sun%2C%204%20Jan%202004%2005%3A58%3A08%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20%7C%20Shouldn%27t%20it%20be%20better%20if%20the%20code%20used%20in%20removal.c%20was%20re-used%20in%20%0A%3E%20%0A%3E%20after%20turning%20my%20brain%20on%20i%20remember%20what%20my%20original%20point%20about%0A%3E%20needing%20to%20use%20fchmod%20was...%20the%20usual%20way%20to%20upgrade%20binaries%20in%20unix%0A%3E%20is%20to%20use%20link%28%29%20or%20rename%28%29%20to%20replace%20them%20atomically.%20there%20also%20you%0A%3E%20can%20use%20fchmod%20to%20change%20the%20permissions%20of%20the%20old%20inode%20%28which%20might%0A%3E%20still%20other%20links%29.%20if%20you%20just%20chmod%20the%20setuid%20bit%20away%20before%20doing%0A%3E%20the%20replacement%2C%20there%27s%20window%20of%20time%20where%20you%20have%20a%20nonfunctional%0A%3E%20binary%20in%20place.%0A%3E%20%0A%3E%20%20%20--%20erno%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23225692%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 4 Jan 2004 05:58:08 +0200</div>
</div>
<pre class="message">| Shouldn&#39;t it be better if the code used in removal.c was re-used in 

after turning my brain on i remember what my original point about
needing to use fchmod was... the usual way to upgrade binaries in unix
is to use link() or rename() to replace them atomically. there also you
can use fchmod to change the permissions of the old inode (which might
still other links). if you just chmod the setuid bit away before doing
the replacement, there&#39;s window of time where you have a nonfunctional
binary in place.

  -- erno



</pre>

<div class="infmessage"><hr><p>
<a name="19"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=20">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=20">mbox</a>, <a href="#19">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="21"></a>
<strong>Acknowledgement sent</strong> to <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=22">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=22">mbox</a>, <a href="#21">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="23"></a><a name="msg23"></a><a href="#23">Message #23</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=23">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=23">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040104154043.GA17960%40dat.etsit.upm.es%3E&amp;References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E%20%3C20040104012409.GO2410%40erno.iki.fi%3E%0A%20%3C20040104154043.GA17960%40dat.etsit.upm.es%3E&amp;body=On%20Sun%2C%204%20Jan%202004%2016%3A40%3A43%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20On%20Sun%2C%20Jan%2004%2C%202004%20at%2003%3A24%3A09AM%20%2B0200%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%3E%20hello%2C%0A%3E%20%3E%20%0A%3E%20%3E%20the%20issue%20is%20specifically%20hard%20links%2C%20there%20is%20no%20problem%20with%20symlinks.%0A%3E%20%0A%3E%20Sorry%2C%20I%20meant%20hard%20links%20%5B1%5D%0A%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20%7C%20I%27m%20not%20sure%20if%20this%20bug%20should%20qualify%20as%20%27grave%27%20since%20it%27s%20not%20dpkg%0A%3E%20%3E%20%7C%20task%20to%20control%20who%20symlinks%20to%20potentially%20dangerous%20binaries.%20As%0A%3E%20%3E%20%0A%3E%20%3E%20no%2C%20but%20dpkg%20could%20handle%20the%20upgrade%20%2F%20safe%20neutralization%20of%20old%20setuid%0A%3E%20%3E%20binaries%20in%20the%20manner%20i%20described%2C%20and%20it%20doesn%27t.%0A%3E%20%0A%3E%20Still%2C%20it%27s%20a%20wishlist%20bug%2C%20you%20are%20asking%20for%20an%20improvement%20to%20solve%20a%20%0A%3E%20security%20situation.%0A%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20%7C%20described%20in%20the%20Securing%20Debian%20Manual%20%28Mounting%20partitions%20the%20right%20way%0A%3E%20%3E%20%7C%20%5B1%5D%29%20it%20is%20the%20administrator%20task%20to%20avoid%20symlink%20attacks%20%28as%20well%20as%20DoS%0A%3E%20%3E%20%7C%20attacks%20due%20to%20system%20partitions%20filling%20up%29%20by%20separating%20user-writable%0A%3E%20%3E%20%7C%20directories%20%28these%20include%20%2Fhome%2C%20%2Ftmp%20and%20%2Fvar%2Ftmp%29.%20These%20directories%0A%3E%20%3E%20%7C%20should%20be%20nosuid%2C%20and%20nodev%20%28and%20maybe%20noexec%20too%20even%20though%20it%20provides%0A%3E%20%3E%20%7C%20little%20protection%29.%0A%3E%20%3E%20%0A%3E%20%3E%20then%20the%20installer%20should%20make%20sure%20the%20system%20gets%20partitioned%20and%0A%3E%20%3E%20configured%20this%20way%2C%20or%20warn%20the%20user%20in%20big%20friendly%20letters.%20but%0A%3E%20%3E%20solving%20the%20problem%20with%20partitions%20is%20not%20as%20good%20solution%20in%20my%0A%3E%20%3E%20opinion%2C%20since%20fragmenting%20disks%20to%20multiple%20partitions%20can%20lead%20to%0A%3E%20%3E%20inflexibility%20and%20other%20problems.%0A%3E%20%0A%3E%20Notice%20that%20proper%20partitions%20_are_%20one%20way%20to%20fix%20this%20issue%20%5B2%5D.%20Even%20if%0A%3E%20you%20fix%20dpkg%20you%20are%20still%20prone%20to%20DoS%20attacks%20and%20hardlink%20attacks%20to%0A%3E%20local%20binaries%20%28%2Fusr%2Flocal%29%20not%20handled%20by%20dpkg%20%28or%20even%20by%20installation%20of%0A%3E%20local%20binaries%20if%20you%20do%20it%20in%20%2Fusr%2F%20but%20do%20not%20use%20debian%20packages%29%0A%3E%20%0A%3E%20%0A%3E%20%3E%20%0A%3E%20%3E%20the%20rest%20of%20your%20mail%20regarding%20dpkg%20code%20looks%20good%20to%20me%20although%0A%3E%20%3E%20i%27m%20no%20expert%20on%20dpkg.%0A%3E%20%0A%3E%20I%27m%20not%20either%20%3A-%29%0A%3E%20%0A%3E%20Javi%0A%3E%20%0A%3E%20%5B1%5D%20This%20is%20a%20%22UNIX%20feature%22%20BTW.%0A%3E%20Sample%20references%20include%3A%0A%3E%20http%3A%2F%2Flists.insecure.org%2Flists%2Fvuln-dev%2F1999%2FDec%2F0027.html%0A%3E%20and%0A%3E%20http%3A%2F%2Fcr.yp.to%2Fmaildisasters%2Fpostfix.19981221%20%28see%20Technical%20Notes%29%0A%3E%20and%0A%3E%20http%3A%2F%2Fwww.cs.uml.edu%2F~acahalan%2Flinux%2Fobstacles.html%0A%3E%20and%0A%3E%20http%3A%2F%2Fwww.ussg.iu.edu%2Fhypermail%2Flinux%2Fkernel%2F9612.1%2F0378.html%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%3E%20%5B2%5D%20Another%20way%20to%20fix%20this%20issue%20is%20doing%20it%20on%20the%20kernel%2C%20like%20Openwall%0A%3E%20does%3A%20http%3A%2F%2Fwww.openwall.com%2Flinux%2FREADME.shtml%20%28see%20%22Restricted%20links%20in%0A%3E%20%2Ftmp.%22%29%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23225692%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 4 Jan 2004 16:40:43 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=23">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Sun, Jan 04, 2004 at 03:24:09AM +0200, Erno Kuusela wrote:
&gt; hello,
&gt; 
&gt; the issue is specifically hard links, there is no problem with symlinks.

Sorry, I meant hard links [1]

&gt; 
&gt; | I&#39;m not sure if this bug should qualify as &#39;grave&#39; since it&#39;s not dpkg
&gt; | task to control who symlinks to potentially dangerous binaries. As
&gt; 
&gt; no, but dpkg could handle the upgrade / safe neutralization of old setuid
&gt; binaries in the manner i described, and it doesn&#39;t.

Still, it&#39;s a wishlist bug, you are asking for an improvement to solve a 
security situation.

&gt; 
&gt; | described in the Securing Debian Manual (Mounting partitions the right way
&gt; | [1]) it is the administrator task to avoid symlink attacks (as well as DoS
&gt; | attacks due to system partitions filling up) by separating user-writable
&gt; | directories (these include /home, /tmp and /var/tmp). These directories
&gt; | should be nosuid, and nodev (and maybe noexec too even though it provides
&gt; | little protection).
&gt; 
&gt; then the installer should make sure the system gets partitioned and
&gt; configured this way, or warn the user in big friendly letters. but
&gt; solving the problem with partitions is not as good solution in my
&gt; opinion, since fragmenting disks to multiple partitions can lead to
&gt; inflexibility and other problems.

Notice that proper partitions _are_ one way to fix this issue [2]. Even if
you fix dpkg you are still prone to DoS attacks and hardlink attacks to
local binaries (/usr/local) not handled by dpkg (or even by installation of
local binaries if you do it in /usr/ but do not use debian packages)


&gt; 
&gt; the rest of your mail regarding dpkg code looks good to me although
&gt; i&#39;m no expert on dpkg.

I&#39;m not either :-)

Javi

[1] This is a &quot;UNIX feature&quot; BTW.
Sample references include:
<a href="http://lists.insecure.org/lists/vuln-dev/1999/Dec/0027.html">http://lists.insecure.org/lists/vuln-dev/1999/Dec/0027.html</a>
and
<a href="http://cr.yp.to/maildisasters/postfix.19981221">http://cr.yp.to/maildisasters/postfix.19981221</a> (see Technical Notes)
and
<a href="http://www.cs.uml.edu/~acahalan/linux/obstacles.html">http://www.cs.uml.edu/~acahalan/linux/obstacles.html</a>
and
<a href="http://www.ussg.iu.edu/hypermail/linux/kernel/9612.1/0378.html">http://www.ussg.iu.edu/hypermail/linux/kernel/9612.1/0378.html</a>
                                                                                
[2] Another way to fix this issue is doing it on the kernel, like Openwall
does: <a href="http://www.openwall.com/linux/README.shtml">http://www.openwall.com/linux/README.shtml</a> (see &quot;Restricted links in
/tmp.&quot;)
                                                                                

</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=23">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="24"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=25">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=25">mbox</a>, <a href="#24">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="26"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=27">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=27">mbox</a>, <a href="#26">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="28"></a><a name="msg28"></a><a href="#28">Message #28</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=28">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=28">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040104180843.GR2410%40erno.iki.fi%3E&amp;References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E%20%3C20040104012409.GO2410%40erno.iki.fi%3E%20%3C20040104154043.GA17960%40dat.etsit.upm.es%3E%0A%20%3C20040104180843.GR2410%40erno.iki.fi%3E&amp;body=On%20Sun%2C%204%20Jan%202004%2020%3A08%3A43%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20hello%2C%0A%3E%20%0A%3E%20On%20Sun%2C%2004%20Jan%202004%2C%20Javier%20Fern%C3%A1ndez-Sanguino%20Pe%C3%B1a%20wrote%3A%0A%3E%20%0A%3E%20%7C%20%3E%20%7C%20I%27m%20not%20sure%20if%20this%20bug%20should%20qualify%20as%20%27grave%27%20since%20it%27s%20not%20dpkg%0A%3E%20%7C%20%3E%20%7C%20task%20to%20control%20who%20symlinks%20to%20potentially%20dangerous%20binaries.%20As%0A%3E%20%7C%20%3E%20%0A%3E%20%7C%20%3E%20no%2C%20but%20dpkg%20could%20handle%20the%20upgrade%20%2F%20safe%20neutralization%20of%20old%20setuid%0A%3E%20%7C%20%3E%20binaries%20in%20the%20manner%20i%20described%2C%20and%20it%20doesn%27t.%0A%3E%20%7C%20%0A%3E%20%7C%20Still%2C%20it%27s%20a%20wishlist%20bug%2C%20you%20are%20asking%20for%20an%20improvement%20to%20solve%20a%20%0A%3E%20%7C%20security%20situation.%0A%3E%20%0A%3E%20well%2C%20the%20current%20situation%20yields%20local%20root%20vulnerabilities%2C%20thus%20it%0A%3E%20is%20clearly%20a%20bug%20in%20the%20system.%20from%20my%20laymans%20point%20of%20view%20this%20is%0A%3E%20dpkg%27s%20responsibility%20since%20it%27s%20replacing%20the%20binaries%20on%20upgrade.%0A%3E%20i%20don%27t%20see%20why%20it%20would%20be%20a%20%22wishlist%22%20bug.%0A%3E%20%0A%3E%20%7C%20Notice%20that%20proper%20partitions%20_are_%20one%20way%20to%20fix%20this%20issue%20%5B2%5D.%20Even%20if%0A%3E%20%7C%20you%20fix%20dpkg%20you%20are%20still%20prone%20to%20DoS%20attacks%20and%20hardlink%20attacks%20to%0A%3E%20%7C%20local%20binaries%20%28%2Fusr%2Flocal%29%20not%20handled%20by%20dpkg%20%28or%20even%20by%20installation%20of%0A%3E%20%7C%20local%20binaries%20if%20you%20do%20it%20in%20%2Fusr%2F%20but%20do%20not%20use%20debian%20packages%29%0A%3E%20%0A%3E%20i%20guess%20install%281%29%20should%20be%20fixed%20as%20well.%20%2Fusr%2Flocal%20stuff%20and%20other%0A%3E%20third%20party%20stuff%20is%20beyond%20debian%27s%20control%20anyhow%2C%20responsibility%0A%3E%20is%20on%20the%20third%20party%20packages.%0A%3E%20%0A%3E%20%5Bfrom%20the%20next%20mail%5D%0A%3E%20%7C%20Notice%20that%20my%20proposal%20is%20to%20chmod%20the%20setuid%20bit%20just%20before%20it%27s%0A%3E%20%7C%20unlinked%20in%20the%20dpkg%20code.%20When%20a%20binary%20is%20substituted%20it%27s%20first%20renamed%0A%3E%20%7C%20%28link%2Frename%29%20and%20then%20removed%2C%20the%20chmod%20bit%20should%20be%20removed%20before%20the%0A%3E%20%7C%20file%20itself%20is%20removed%0A%3E%20%0A%3E%20ah%20ok%2C%20if%20you%20do%0A%3E%20%22ln%20foo%20foo.old%20%26%26%20mv%20foo.new%20foo%20%26%26%20chmod%20-s%20foo.old%20%26%26%20rm%20foo.old%22%2C%0A%3E%20that%20works%20too.%0A%3E%20%0A%3E%20%20--%20erno%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23225692%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 4 Jan 2004 20:08:43 +0200</div>
</div>
<pre class="message">hello,

On Sun, 04 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| &gt; | I&#39;m not sure if this bug should qualify as &#39;grave&#39; since it&#39;s not dpkg
| &gt; | task to control who symlinks to potentially dangerous binaries. As
| &gt; 
| &gt; no, but dpkg could handle the upgrade / safe neutralization of old setuid
| &gt; binaries in the manner i described, and it doesn&#39;t.
| 
| Still, it&#39;s a wishlist bug, you are asking for an improvement to solve a 
| security situation.

well, the current situation yields local root vulnerabilities, thus it
is clearly a bug in the system. from my laymans point of view this is
dpkg&#39;s responsibility since it&#39;s replacing the binaries on upgrade.
i don&#39;t see why it would be a &quot;wishlist&quot; bug.

| Notice that proper partitions _are_ one way to fix this issue [2]. Even if
| you fix dpkg you are still prone to DoS attacks and hardlink attacks to
| local binaries (/usr/local) not handled by dpkg (or even by installation of
| local binaries if you do it in /usr/ but do not use debian packages)

i guess install(1) should be fixed as well. /usr/local stuff and other
third party stuff is beyond debian&#39;s control anyhow, responsibility
is on the third party packages.

[from the next mail]
| Notice that my proposal is to chmod the setuid bit just before it&#39;s
| unlinked in the dpkg code. When a binary is substituted it&#39;s first renamed
| (link/rename) and then removed, the chmod bit should be removed before the
| file itself is removed

ah ok, if you do
&quot;ln foo foo.old &amp;&amp; mv foo.new foo &amp;&amp; chmod -s foo.old &amp;&amp; rm foo.old&quot;,
that works too.

 -- erno


</pre>

<div class="msgreceived"><hr><p>
<a name="29"></a>
<strong>Tags removed: security</strong>
Request was from <code>Matt Zimmerman &lt;mdz@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>. 
(<a href="bugreport.cgi?bug=225692;msg=30">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=30">mbox</a>, <a href="#29">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="31"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=32">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=32">mbox</a>, <a href="#31">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="33"></a>
<strong>Acknowledgement sent</strong> to <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=34">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=34">mbox</a>, <a href="#33">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="35"></a><a name="msg35"></a><a href="#35">Message #35</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=35">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=35">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040104154622.GA30977%40dat.etsit.upm.es%3E&amp;References=%3C20040103204106.GA20881%40dat.etsit.upm.es%3E%20%3C20040104035808.GQ2410%40erno.iki.fi%3E%0A%20%3C20040104154622.GA30977%40dat.etsit.upm.es%3E&amp;body=On%20Sun%2C%204%20Jan%202004%2016%3A46%3A22%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20On%20Sun%2C%20Jan%2004%2C%202004%20at%2005%3A58%3A08AM%20%2B0200%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%3E%20%7C%20Shouldn%27t%20it%20be%20better%20if%20the%20code%20used%20in%20removal.c%20was%20re-used%20in%20%0A%3E%20%3E%20%0A%3E%20%3E%20after%20turning%20my%20brain%20on%20i%20remember%20what%20my%20original%20point%20about%0A%3E%20%3E%20needing%20to%20use%20fchmod%20was...%20the%20usual%20way%20to%20upgrade%20binaries%20in%20unix%0A%3E%20%3E%20is%20to%20use%20link%28%29%20or%20rename%28%29%20to%20replace%20them%20atomically.%20there%20also%20you%0A%3E%20%3E%20can%20use%20fchmod%20to%20change%20the%20permissions%20of%20the%20old%20inode%20%28which%20might%0A%3E%20%3E%20still%20other%20links%29.%20if%20you%20just%20chmod%20the%20setuid%20bit%20away%20before%20doing%0A%3E%20%3E%20the%20replacement%2C%20there%27s%20window%20of%20time%20where%20you%20have%20a%20nonfunctional%0A%3E%20%3E%20binary%20in%20place.%0A%3E%20%0A%3E%20Notice%20that%20my%20proposal%20is%20to%20chmod%20the%20setuid%20bit%20just%20before%20it%27s%20%0A%3E%20unlinked%20in%20the%20dpkg%20code.%20When%20a%20binary%20is%20substituted%20it%27s%20first%20renamed%20%0A%3E%20%28link%2Frename%29%20and%20then%20removed%2C%20the%20chmod%20bit%20should%20be%20removed%20before%20the%20%0A%3E%20file%20itself%20is%20removed%20IMHO%2C%20that%20shouldn%27t%20result%20on%20having%20a%20%0A%3E%20nonfunctional%20binary.%0A%3E%20%0A%3E%20Regards%0A%3E%20%0A%3E%20Javi%0A&amp;subject=Re%3A%20Bug%23225692%3A%20A%20common%20setuid%20symlink%20issue%2C%20and%20possible%20patch%20to%20the%20bug">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: A common setuid symlink issue, and possible patch to the bug</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 4 Jan 2004 16:46:22 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=35">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Sun, Jan 04, 2004 at 05:58:08AM +0200, Erno Kuusela wrote:
&gt; | Shouldn&#39;t it be better if the code used in removal.c was re-used in 
&gt; 
&gt; after turning my brain on i remember what my original point about
&gt; needing to use fchmod was... the usual way to upgrade binaries in unix
&gt; is to use link() or rename() to replace them atomically. there also you
&gt; can use fchmod to change the permissions of the old inode (which might
&gt; still other links). if you just chmod the setuid bit away before doing
&gt; the replacement, there&#39;s window of time where you have a nonfunctional
&gt; binary in place.

Notice that my proposal is to chmod the setuid bit just before it&#39;s 
unlinked in the dpkg code. When a binary is substituted it&#39;s first renamed 
(link/rename) and then removed, the chmod bit should be removed before the 
file itself is removed IMHO, that shouldn&#39;t result on having a 
nonfunctional binary.

Regards

Javi
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=35">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="36"></a>
<strong>Tags added: patch</strong>
Request was from <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>
to <code>control@bugs.debian.org</code>. 
(<a href="bugreport.cgi?bug=225692;msg=37">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=37">mbox</a>, <a href="#36">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="38"></a>
<strong>Message sent on</strong> to <code>Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</code>:<br>
Bug#225692.
(<a href="bugreport.cgi?bug=225692;msg=39">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="40"></a><a name="msg40"></a><a href="#40">Message #40</a> received at 225692-submitter@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=40">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=40">mbox</a>, <a href="mailto:225692@bugs.debian.org?References=%3C20040107203532.GB16447%40dat.etsit.upm.es%3E&amp;In-Reply-To=%3C20040107203532.GB16447%40dat.etsit.upm.es%3E&amp;body=On%20Wed%2C%207%20Jan%202004%2021%3A35%3A32%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20tags%20225692%20patch%0A%3E%20thanks%0A%3E%20%0A%3E%20The%20following%20%28yet%20untested%29%20patch%20should%20provide%20the%20same%20mechanism%20for%0A%3E%20upgrades%20as%20for%20removes%20in%20order%20to%20avoid%20the%20hard%20link%20attacks%20described%0A%3E%20in%20the%20bug%20report.%0A%3E%20%0A%3E%20I%20will%20try%20to%20test%20this%20in%20a%20limited%20environment%20to%20see%20if%20it%20fulfills%20the%20%0A%3E%20needs%20%28avoids%20these%20attacks%29%20but%20wider%20testing%20would%20be%20good.%0A%3E%20%0A%3E%20Regards%0A%3E%20%0A%3E%20Javi%0A&amp;subject=Re%3A%20Patch%20for%20dpkg%20RC%20bug%20%28avoids%20stashing%20symlinks%29">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 225692-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> control@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Patch for dpkg RC bug (avoids stashing symlinks)</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 7 Jan 2004 21:35:32 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=40">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">tags 225692 patch
thanks

The following (yet untested) patch should provide the same mechanism for
upgrades as for removes in order to avoid the hard link attacks described
in the bug report.

I will try to test this in a limited environment to see if it fulfills the 
needs (avoids these attacks) but wider testing would be good.

Regards

Javi
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=stash-suid-fix.diff;msg=40">stash-suid-fix.diff</a> (text/plain, attachment)]</pre>
<pre class="mime">[<a href="bugreport.cgi?att=2;bug=225692;filename=signature.asc;msg=40">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="41"></a>
<strong>Message sent on</strong> to <code>Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</code>:<br>
Bug#225692.
(<a href="bugreport.cgi?bug=225692;msg=42">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=42">mbox</a>, <a href="#41">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="43"></a><a name="msg43"></a><a href="#43">Message #43</a> received at 225692-submitter@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=43">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=43">mbox</a>, <a href="mailto:225692@bugs.debian.org?References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E&amp;In-Reply-To=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E&amp;subject=Re%3A%20Just%20a%20note%3A%20works%20as%20expected&amp;body=On%20Wed%2C%207%20Jan%202004%2023%3A12%3A41%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20Just%20a%20note%20to%20let%20bug%20readers%20now%20that%20the%20bug%20works%20as%20expected%20OK%20when%20%0A%3E%20upgrading%20packages.%20I%27ve%20just%20tried%20in%20a%20minimal%20%28debootsrap%29%20sid%20%0A%3E%20environment%20to%20upgrade%20from%20woody%27s%20to%20sid%27s%20pppd%20version%20%28script%20below%29.%20%0A%3E%20Notice%20this%20is%20minimal%20testing%2C%20I%20would%20prefer%20if%20other%20people%20test%20the%20%0A%3E%20change%20and%20reviewed%20the%20code%20to%20ensure%20that%20it%20won%27t%20introduce%20any%20bugs.%0A%3E%20%0A%3E%20Regards%0A%3E%20%0A%3E%20Javi%0A%3E%20%0A%3E%20PS%3A%20If%20anyone%20wants%20pre-compiled%20binaries%2Fpackages%2C%20please%20ask.%0A%3E%20%0A%3E%20%5B%20As%20root%20%5D%0A%3E%20%23%20dpkg%20-i%20dpkg_1.10.18.1_i386.deb%0A%3E%20%28Reading%20database%20...%207293%20files%20and%20directories%20currently%20installed.%29%0A%3E%20Preparing%20to%20replace%20dpkg%201.10.18%20%28using%20dpkg_1.10.18.1_i386.deb%29%20...%0A%3E%20Unpacking%20replacement%20dpkg%20...%0A%3E%20Setting%20up%20dpkg%20%281.10.18.1%29%20...%0A%3E%20%23%20dpkg%20-i%20ppp_2.4.2%2B20031002-4_i386.deb%0A%3E%20Preparing%20to%20replace%20ppp%202.4.2%2B20031002-4%20%28using%20ppp_2.4.2%2B20031002-4_i386.deb%29%20...%0A%3E%20Unpacking%20replacement%20ppp%20...%0A%3E%20Setting%20up%20ppp%20%282.4.2%2B20031002-4%29%20...%0A%3E%20%0A%3E%20%5B%20As%20a%20rogue%20user%20%5D%0A%3E%20test%40localhost%3A%2Ftmp%24%20ln%20%20%2Fusr%2Fsbin%2Fpppd%20..pppd_vulnerable%0A%3E%20test%40localhost%3A%2Ftmp%24%20ls%20-la%20..pp%2A%0A%3E%20-rwsr-xr--%20%20%20%202%20root%20%20%20%20%20dip%20%20%20%20%20%20%20%20277624%20Oct%2030%2021%3A44%20..pppd_vulnerable%0A%3E%20%0A%3E%20%5B%20Root%20upgrades%20the%20package%20%5D%0A%3E%20%23%20dpkg%20-i%20ppp_2.4.2%2B20031127-2_i386.deb%0A%3E%20%28Reading%20database%20...%207293%20files%20and%20directories%20currently%20installed.%29%0A%3E%20Preparing%20to%20replace%20ppp%202.4.2%2B20031002-4%20%28using%20%0A%3E%20ppp_2.4.2%2B20031127-2_i386.deb%29%20...%0A%3E%20Unpacking%20replacement%20ppp%20...%0A%3E%20Setting%20up%20ppp%20%282.4.2%2B20031127-2%29%20...%0A%3E%20Installing%20new%20version%20of%20config%20file%20%2Fetc%2Fppp%2Fip-up.d%2F0000usepeerdns%20...%0A%3E%20Installing%20new%20version%20of%20config%20file%20%2Fetc%2Fapm%2Fevent.d%2Fppp%20...%0A%3E%20%20%0A%3E%20%23%20md5sum%20%2Fusr%2Fsbin%2Fpppd%0A%3E%20b70e5c63b5080b2701921a5e42669f73%20%20%2Fusr%2Fsbin%2Fpppd%0A%3E%20%23%20md5sum%20%2Ftmp%2F..pppd_vulnerable%0A%3E%20c32f54f2021e7fcbf9c033d1866a4766%20%20%2Ftmp%2F..pppd_vulnerable%0A%3E%20%23%20ls%20-la%20%2Ftmp%2F..pppd_vulnerable%0A%3E%20-rw-------%20%20%20%201%20root%20%20%20%20%20dip%20%20%20%20%20%20%20%20277624%20Oct%2030%2021%3A44%20%2Ftmp%2F..pppd_vulnerable%0A%3E%20%0A%3E%20Which%20renders%20the%20vulnerable%20hardlink%20copy%20of%20the%20binary%20useless%20to%20the%20%0A%3E%20attacker.%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 225692-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Wed, 7 Jan 2004 23:12:41 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=43">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Just a note to let bug readers now that the bug works as expected OK when 
upgrading packages. I&#39;ve just tried in a minimal (debootsrap) sid 
environment to upgrade from woody&#39;s to sid&#39;s pppd version (script below). 
Notice this is minimal testing, I would prefer if other people test the 
change and reviewed the code to ensure that it won&#39;t introduce any bugs.

Regards

Javi

PS: If anyone wants pre-compiled binaries/packages, please ask.

[ As root ]
# dpkg -i dpkg_1.10.18.1_i386.deb
(Reading database ... 7293 files and directories currently installed.)
Preparing to replace dpkg 1.10.18 (using dpkg_1.10.18.1_i386.deb) ...
Unpacking replacement dpkg ...
Setting up dpkg (1.10.18.1) ...
# dpkg -i ppp_2.4.2+20031002-4_i386.deb
Preparing to replace ppp 2.4.2+20031002-4 (using ppp_2.4.2+20031002-4_i386.deb) ...
Unpacking replacement ppp ...
Setting up ppp (2.4.2+20031002-4) ...

[ As a rogue user ]
test@localhost:/tmp$ ln  /usr/sbin/pppd ..pppd_vulnerable
test@localhost:/tmp$ ls -la ..pp*
-rwsr-xr--    2 root     dip        277624 Oct 30 21:44 ..pppd_vulnerable

[ Root upgrades the package ]
# dpkg -i ppp_2.4.2+20031127-2_i386.deb
(Reading database ... 7293 files and directories currently installed.)
Preparing to replace ppp 2.4.2+20031002-4 (using 
ppp_2.4.2+20031127-2_i386.deb) ...
Unpacking replacement ppp ...
Setting up ppp (2.4.2+20031127-2) ...
Installing new version of config file /etc/ppp/ip-up.d/0000usepeerdns ...
Installing new version of config file /etc/apm/event.d/ppp ...
 
# md5sum /usr/sbin/pppd
b70e5c63b5080b2701921a5e42669f73  /usr/sbin/pppd
# md5sum /tmp/..pppd_vulnerable
c32f54f2021e7fcbf9c033d1866a4766  /tmp/..pppd_vulnerable
# ls -la /tmp/..pppd_vulnerable
-rw-------    1 root     dip        277624 Oct 30 21:44 /tmp/..pppd_vulnerable

Which renders the vulnerable hardlink copy of the binary useless to the 
attacker.
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=43">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="44"></a>
<strong>Information stored</strong>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=45">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=45">mbox</a>, <a href="#44">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="46"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and filed, but not forwarded.
(<a href="bugreport.cgi?bug=225692;msg=47">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=47">mbox</a>, <a href="#46">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="48"></a><a name="msg48"></a><a href="#48">Message #48</a> received at 225692-quiet@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=48">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=48">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040110155747.GB5824%40erno.iki.fi%3E&amp;References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E%0A%20%3C20040110155747.GB5824%40erno.iki.fi%3E&amp;subject=Re%3A%20Bug%23225692%3A%20Just%20a%20note%3A%20works%20as%20expected&amp;body=On%20Sat%2C%2010%20Jan%202004%2017%3A57%3A47%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20%0A%3E%20hello%2C%0A%3E%20%0A%3E%20On%20Wed%2C%2007%20Jan%202004%2C%20Javier%20Fern%C3%A1ndez-Sanguino%20Pe%C3%B1a%20wrote%3A%0A%3E%20%0A%3E%20%7C%20Just%20a%20note%20to%20let%20bug%20readers%20now%20that%20the%20bug%20works%20as%20expected%20OK%20when%20%0A%3E%20%7C%20upgrading%20packages.%20I%27ve%20just%20tried%20in%20a%20minimal%20%28debootsrap%29%20sid%20%0A%3E%20%7C%20environment%20to%20upgrade%20from%20woody%27s%20to%20sid%27s%20pppd%20version%20%28script%20below%29.%20%0A%3E%20%0A%3E%20cool.%20i%20hope%20there%20will%20be%20a%20security%20update%20for%20woody%3F%0A%3E%20%0A%3E%20%7C%20Notice%20this%20is%20minimal%20testing%2C%20I%20would%20prefer%20if%20other%20people%20test%20the%20%0A%3E%20%7C%20change%20and%20reviewed%20the%20code%20to%20ensure%20that%20it%20won%27t%20introduce%20any%20bugs.%0A%3E%20%0A%3E%20%7C%20PS%3A%20If%20anyone%20wants%20pre-compiled%20binaries%2Fpackages%2C%20please%20ask.%0A%3E%20%0A%3E%20i%20am%20willing%20to%20test%20if%20you%20have%20ready%20to%20go%20packages.%20%0A%3E%20%0A%3E%20%20%20--%20erno%0A%3E%20%0A%3E%20%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;,
	225692-quiet@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 10 Jan 2004 17:57:47 +0200</div>
</div>
<pre class="message">
hello,

On Wed, 07 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| Just a note to let bug readers now that the bug works as expected OK when 
| upgrading packages. I&#39;ve just tried in a minimal (debootsrap) sid 
| environment to upgrade from woody&#39;s to sid&#39;s pppd version (script below). 

cool. i hope there will be a security update for woody?

| Notice this is minimal testing, I would prefer if other people test the 
| change and reviewed the code to ensure that it won&#39;t introduce any bugs.

| PS: If anyone wants pre-compiled binaries/packages, please ask.

i am willing to test if you have ready to go packages. 

  -- erno


</pre>

<div class="infmessage"><hr><p>
<a name="49"></a>
<strong>Information stored</strong>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=50">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=50">mbox</a>, <a href="#49">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="51"></a>
<strong>Acknowledgement sent</strong> to <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>:<br>
Extra info received and filed, but not forwarded.
(<a href="bugreport.cgi?bug=225692;msg=52">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=52">mbox</a>, <a href="#51">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="53"></a><a name="msg53"></a><a href="#53">Message #53</a> received at 225692-quiet@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=53">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=53">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C20040112224951.GD28462%40dat.etsit.upm.es%3E&amp;References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E%20%3C20040110155747.GB5824%40erno.iki.fi%3E%0A%20%3C20040112224951.GD28462%40dat.etsit.upm.es%3E&amp;body=On%20Mon%2C%2012%20Jan%202004%2023%3A49%3A51%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20On%20Sat%2C%20Jan%2010%2C%202004%20at%2005%3A57%3A47PM%20%2B0200%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%3E%20%0A%3E%20%3E%20i%20am%20willing%20to%20test%20if%20you%20have%20ready%20to%20go%20packages.%20%0A%3E%20%0A%3E%20Available%20now%20at%20people.debian.org%2F~jfs%2Fdpkg%0A%3E%20%0A%3E%20Javi%0A&amp;subject=Re%3A%20Bug%23225692%3A%20Just%20a%20note%3A%20works%20as%20expected">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692-quiet@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 12 Jan 2004 23:49:51 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=53">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Sat, Jan 10, 2004 at 05:57:47PM +0200, Erno Kuusela wrote:
&gt; 
&gt; i am willing to test if you have ready to go packages. 

Available now at people.debian.org/~jfs/dpkg

Javi
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=53">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="54"></a>
<strong>Information stored</strong>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=55">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=55">mbox</a>, <a href="#54">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="56"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and filed, but not forwarded.
(<a href="bugreport.cgi?bug=225692;msg=57">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=57">mbox</a>, <a href="#56">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="58"></a><a name="msg58"></a><a href="#58">Message #58</a> received at 225692-quiet@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=58">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=58">mbox</a>, <a href="mailto:225692@bugs.debian.org?body=On%20Sun%2C%2018%20Jan%202004%2002%3A53%3A31%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20hello%2C%0A%3E%20%0A%3E%20On%20Mon%2C%2012%20Jan%202004%2C%20Javier%20Fern%C3%A1ndez-Sanguino%20Pe%C3%B1a%20wrote%3A%0A%3E%20%0A%3E%20%7C%20On%20Sat%2C%20Jan%2010%2C%202004%20at%2005%3A57%3A47PM%20%2B0200%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%7C%20%3E%20%0A%3E%20%7C%20%3E%20i%20am%20willing%20to%20test%20if%20you%20have%20ready%20to%20go%20packages.%20%0A%3E%20%7C%20%0A%3E%20%7C%20Available%20now%20at%20people.debian.org%2F~jfs%2Fdpkg%0A%3E%20%0A%3E%20seems%20to%20work%20as%20advertised.%0A%3E%20%0A%3E%20%20%20--%20erno%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23225692%3A%20Just%20a%20note%3A%20works%20as%20expected&amp;In-Reply-To=%3C20040118005331.GD9510%40erno.iki.fi%3E&amp;References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E%20%3C20040110155747.GB5824%40erno.iki.fi%3E%20%3C20040112224951.GD28462%40dat.etsit.upm.es%3E%0A%20%3C20040118005331.GD9510%40erno.iki.fi%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692-quiet@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Sun, 18 Jan 2004 02:53:31 +0200</div>
</div>
<pre class="message">hello,

On Mon, 12 Jan 2004, Javier Fernández-Sanguino Peña wrote:

| On Sat, Jan 10, 2004 at 05:57:47PM +0200, Erno Kuusela wrote:
| &gt; 
| &gt; i am willing to test if you have ready to go packages. 
| 
| Available now at people.debian.org/~jfs/dpkg

seems to work as advertised.

  -- erno



</pre>

<div class="infmessage"><hr><p>
<a name="59"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=60">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=60">mbox</a>, <a href="#59">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="61"></a>
<strong>Acknowledgement sent</strong> to <code>Erno Kuusela &lt;erno@iki.fi&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=62">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=62">mbox</a>, <a href="#61">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="63"></a><a name="msg63"></a><a href="#63">Message #63</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=63">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=63">mbox</a>, <a href="mailto:225692@bugs.debian.org?subject=Re%3A%20Bug%23225692%3A%20Just%20a%20note%3A%20works%20as%20expected&amp;body=On%20Tue%2C%2020%20Jan%202004%2015%3A41%3A12%20%2B0200%20Erno%20Kuusela%20%3Cerno%40iki.fi%3E%20wrote%3A%0A%3E%20On%20Sun%2C%2018%20Jan%202004%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%7C%20%7C%20Available%20now%20at%20people.debian.org%2F~jfs%2Fdpkg%0A%3E%20%7C%20%0A%3E%20%7C%20seems%20to%20work%20as%20advertised.%0A%3E%20%0A%3E%20correction...%20the%20link%20i%20made%20no%20longer%20has%20the%20setuid%20bit%2C%0A%3E%20but%20neither%20has%20the%20newly%20installde%20binary.%0A%3E%20%0A%3E%20%23%20apt-get%20--reinstall%20install%20traceroute-nanog%0A%3E%20Reading%20Package%20Lists...%20Done%0A%3E%20Building%20Dependency%20Tree...%20Done%0A%3E%200%20upgraded%2C%200%20newly%20installed%2C%201%20reinstalled%2C%200%20to%20remove%20and%2032%20not%20upgraded.%0A%3E%20Need%20to%20get%200B%2F33.2kB%20of%20archives.%0A%3E%20After%20unpacking%200B%20of%20additional%20disk%20space%20will%20be%20used.%0A%3E%20Do%20you%20want%20to%20continue%3F%20%5BY%2Fn%5D%20%0A%3E%20%28Reading%20database%20...%2035179%20files%20and%20directories%20currently%20installed.%29%0A%3E%20Preparing%20to%20replace%20traceroute-nanog%206.3.9-3%20%28using%20...%2Ftraceroute-nanog_6.3.9-3_i386.deb%29%20...%0A%3E%20Unpacking%20replacement%20traceroute-nanog%20...%0A%3E%20Setting%20up%20traceroute-nanog%20%286.3.9-3%29%20...%0A%3E%20%0A%3E%20%23%20ls%20-l%20%2Fusr%2Fsbin%2Ftraceroute-nanog%0A%3E%20-rwxr-xr-x%20%20%20%201%20root%20%20%20%20%20root%20%20%20%20%20%20%20%2024408%20Dec%20%205%2019%3A51%20%2Fusr%2Fsbin%2Ftraceroute-nanog%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E%20%3C20040110155747.GB5824%40erno.iki.fi%3E%20%3C20040112224951.GD28462%40dat.etsit.upm.es%3E%20%3C20040118005331.GD9510%40erno.iki.fi%3E%0A%20%3C20040120134112.GA26421%40erno.iki.fi%3E&amp;In-Reply-To=%3C20040120134112.GA26421%40erno.iki.fi%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=erno%40iki.fi" alt="">
<div class="header"><span class="headerfield">From:</span> Erno Kuusela &lt;erno@iki.fi&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 20 Jan 2004 15:41:12 +0200</div>
</div>
<pre class="message">On Sun, 18 Jan 2004, Erno Kuusela wrote:
| | Available now at people.debian.org/~jfs/dpkg
| 
| seems to work as advertised.

correction... the link i made no longer has the setuid bit,
but neither has the newly installde binary.

# apt-get --reinstall install traceroute-nanog
Reading Package Lists... Done
Building Dependency Tree... Done
0 upgraded, 0 newly installed, 1 reinstalled, 0 to remove and 32 not upgraded.
Need to get 0B/33.2kB of archives.
After unpacking 0B of additional disk space will be used.
Do you want to continue? [Y/n] 
(Reading database ... 35179 files and directories currently installed.)
Preparing to replace traceroute-nanog 6.3.9-3 (using .../traceroute-nanog_6.3.9-3_i386.deb) ...
Unpacking replacement traceroute-nanog ...
Setting up traceroute-nanog (6.3.9-3) ...

# ls -l /usr/sbin/traceroute-nanog
-rwxr-xr-x    1 root     root        24408 Dec  5 19:51 /usr/sbin/traceroute-nanog



</pre>

<div class="infmessage"><hr><p>
<a name="64"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=65">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=65">mbox</a>, <a href="#64">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="66"></a>
<strong>Acknowledgement sent</strong> to <code>Scott James Remnant &lt;scott@netsplit.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=67">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=67">mbox</a>, <a href="#66">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="68"></a><a name="msg68"></a><a href="#68">Message #68</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=68">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=68">mbox</a>, <a href="mailto:225692@bugs.debian.org?References=%3C20040107221241.GB21342%40dat.etsit.upm.es%3E%20%3C20040110155747.GB5824%40erno.iki.fi%3E%20%3C20040112224951.GD28462%40dat.etsit.upm.es%3E%20%3C20040118005331.GD9510%40erno.iki.fi%3E%20%3C20040120134112.GA26421%40erno.iki.fi%3E%0A%20%3C20040226015904.GA1497%40descent.netsplit.com%3E&amp;In-Reply-To=%3C20040226015904.GA1497%40descent.netsplit.com%3E&amp;subject=Re%3A%20Bug%23225692%3A%20Just%20a%20note%3A%20works%20as%20expected&amp;body=On%20Thu%2C%2026%20Feb%202004%2001%3A59%3A04%20%2B0000%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%20wrote%3A%0A%3E%20On%20Tue%2C%20Jan%2020%2C%202004%20at%2003%3A41%3A12PM%20%2B0200%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%0A%3E%20%3E%20On%20Sun%2C%2018%20Jan%202004%2C%20Erno%20Kuusela%20wrote%3A%0A%3E%20%3E%20%7C%20%7C%20Available%20now%20at%20people.debian.org%2F~jfs%2Fdpkg%0A%3E%20%3E%20%7C%20%0A%3E%20%3E%20%7C%20seems%20to%20work%20as%20advertised.%0A%3E%20%3E%20%0A%3E%20%3E%20correction...%20the%20link%20i%20made%20no%20longer%20has%20the%20setuid%20bit%2C%0A%3E%20%3E%20but%20neither%20has%20the%20newly%20installde%20binary.%0A%3E%20%3E%20%0A%3E%20%3E%20%23%20apt-get%20--reinstall%20install%20traceroute-nanog%0A%3E%20%3E%20%0A%3E%20traceroute-nanog%20doesn%27t%20contain%20a%20setuid%20binary...%0A%3E%20%0A%3E%20-rwxr-xr-x%20root%2Froot%20%20%20%20%2024408%202003-12-05%2017%3A51%3A19%20.%2Fusr%2Fsbin%2Ftraceroute-nanog%0A%3E%20%0A%3E%20%0A%3E%20Tested%20with%20at%20instead%3A%0A%3E%20%0A%3E%20descent%3A~%23%20ls%20-l%20%2Fusr%2Fbin%2Fat%0A%3E%20-rwsr-xr-x%20%20%20%201%20root%20%20%20%20%20root%20%20%20%20%20%20%20%2034488%20Jan%2018%20%202002%20%2Fusr%2Fbin%2Fat%0A%3E%20descent%3A~%23%20ln%20%2Fusr%2Fbin%2Fat%20foo%0A%3E%20descent%3A~%23%20ls%20-l%20foo%0A%3E%20-rwsr-xr-x%20%20%20%202%20root%20%20%20%20%20root%20%20%20%20%20%20%20%2034488%20Jan%2018%20%202002%20foo%0A%3E%20%0A%3E%20descent%3A~%23%20dpkg%20-i%20at_3.1.8-11_i386.deb%0A%3E%20%28Reading%20database%20...%2011564%20files%20and%20directories%20currently%20installed.%29%0A%3E%20Preparing%20to%20replace%20at%203.1.8-11%20%28using%20at_3.1.8-11_i386.deb%29%20...%0A%3E%20Stopping%20deferred%20execution%20scheduler%3A%20atd.%0A%3E%20Stopping%20deferred%20execution%20scheduler%3A%20atd.%0A%3E%20Unpacking%20replacement%20at%20...%0A%3E%20Setting%20up%20at%20%283.1.8-11%29%20...%0A%3E%20Starting%20deferred%20execution%20scheduler%3A%20atd.%0A%3E%20%0A%3E%20descent%3A~%23%20ls%20-l%20%2Fusr%2Fbin%2Fat%0A%3E%20-rwsr-xr-x%20%20%20%201%20root%20%20%20%20%20root%20%20%20%20%20%20%20%2034488%20Jan%2018%20%202002%20%2Fusr%2Fbin%2Fat%0A%3E%20descent%3A~%23%20ls%20-l%20foo%0A%3E%20-rw-------%20%20%20%201%20root%20%20%20%20%20root%20%20%20%20%20%20%20%2034488%20Jan%2018%20%202002%20foo%0A%3E%20%0A%3E%20Scott%0A%3E%20--%20%0A%3E%20Have%20you%20ever%2C%20ever%20felt%20like%20this%3F%0A%3E%20Had%20strange%20things%20happen%3F%20%20Are%20you%20going%20round%20the%20twist%3F%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=scott%40netsplit.com" alt="">
<div class="header"><span class="headerfield">From:</span> Scott James Remnant &lt;scott@netsplit.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Erno Kuusela &lt;erno@iki.fi&gt;, 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#225692: Just a note: works as expected</div>
<div class="header"><span class="headerfield">Date:</span> Thu, 26 Feb 2004 01:59:04 +0000</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=68">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Tue, Jan 20, 2004 at 03:41:12PM +0200, Erno Kuusela wrote:

&gt; On Sun, 18 Jan 2004, Erno Kuusela wrote:
&gt; | | Available now at people.debian.org/~jfs/dpkg
&gt; | 
&gt; | seems to work as advertised.
&gt; 
&gt; correction... the link i made no longer has the setuid bit,
&gt; but neither has the newly installde binary.
&gt; 
&gt; # apt-get --reinstall install traceroute-nanog
&gt; 
traceroute-nanog doesn&#39;t contain a setuid binary...

-rwxr-xr-x root/root     24408 2003-12-05 17:51:19 ./usr/sbin/traceroute-nanog


Tested with at instead:

descent:~# ls -l /usr/bin/at
-rwsr-xr-x    1 root     root        34488 Jan 18  2002 /usr/bin/at
descent:~# ln /usr/bin/at foo
descent:~# ls -l foo
-rwsr-xr-x    2 root     root        34488 Jan 18  2002 foo

descent:~# dpkg -i at_3.1.8-11_i386.deb
(Reading database ... 11564 files and directories currently installed.)
Preparing to replace at 3.1.8-11 (using at_3.1.8-11_i386.deb) ...
Stopping deferred execution scheduler: atd.
Stopping deferred execution scheduler: atd.
Unpacking replacement at ...
Setting up at (3.1.8-11) ...
Starting deferred execution scheduler: atd.

descent:~# ls -l /usr/bin/at
-rwsr-xr-x    1 root     root        34488 Jan 18  2002 /usr/bin/at
descent:~# ls -l foo
-rw-------    1 root     root        34488 Jan 18  2002 foo

Scott
-- 
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=68">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="69"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=70">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=70">mbox</a>, <a href="#69">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="71"></a>
<strong>Acknowledgement sent</strong> to <code>Scott James Remnant &lt;scott@netsplit.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=72">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=72">mbox</a>, <a href="#71">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="73"></a><a name="msg73"></a><a href="#73">Message #73</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=73">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=73">mbox</a>, <a href="mailto:225692@bugs.debian.org?subject=Re%3A%20Bug%23225692%3A%20dpkg%3A%20Allows%20users%20to%20stash%20away%20vulnerable%20versions%20of%20setuid%20binaries&amp;body=On%20Fri%2C%2027%20Feb%202004%2018%3A53%3A43%20%2B0000%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%20wrote%3A%0A%3E%20Here%27s%20a%20patch%20that%20just%20copies%20the%20code%20from%20main%2Fremove.c%20which%20is%0A%3E%20known%20to%20work.%0A%3E%20%0A%3E%20Scott%0A%3E%20--%20%0A%3E%20Have%20you%20ever%2C%20ever%20felt%20like%20this%3F%0A%3E%20Had%20strange%20things%20happen%3F%20%20Are%20you%20going%20round%20the%20twist%3F%0A&amp;In-Reply-To=%3C20040227185343.GA25255%40elite.netsplit.com%3E&amp;References=%3C20040227185343.GA25255%40elite.netsplit.com%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=scott%40netsplit.com" alt="">
<div class="header"><span class="headerfield">From:</span> Scott James Remnant &lt;scott@netsplit.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#225692: dpkg: Allows users to stash away vulnerable versions of setuid binaries</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 27 Feb 2004 18:53:43 +0000</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=73">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">Here&#39;s a patch that just copies the code from main/remove.c which is
known to work.

Scott
-- 
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=dpkg-3-stashed-hardlink.patch;msg=73">dpkg-3-stashed-hardlink.patch</a> (text/plain, attachment)]</pre>

<div class="msgreceived"><hr><p>
<a name="74"></a>
<strong>Tags added: fixed</strong>
Request was from <code>Scott James Remnant &lt;scott@netsplit.com&gt;</code>
to <code>control@bugs.debian.org</code>. 
(<a href="bugreport.cgi?bug=225692;msg=75">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=75">mbox</a>, <a href="#74">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="76"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=77">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=77">mbox</a>, <a href="#76">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="78"></a>
<strong>Acknowledgement sent</strong> to <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=79">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=79">mbox</a>, <a href="#78">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="80"></a><a name="msg80"></a><a href="#80">Message #80</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=80">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=80">mbox</a>, <a href="mailto:225692@bugs.debian.org?body=On%20Fri%2C%2027%20Feb%202004%2023%3A19%3A26%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20%0A%3E%20Hi%2C%20I%27m%20just%20curious%20because%20reviewing%20this%20bug%20it%20looks%20like%20the%20patch%0A%3E%20provided%20by%20Scoot%20is%20_precisely_%20the%20same%20patch%20I%20provided%20%28albeit%20with%20the%0A%3E%20comments%20describing%20the%20behaviour%20removed%29.%20As%20I%20mentioned%20in%20the%20bug%0A%3E%20report%2C%20the%20code%20I%20provided%20was%20taken%20verbatim%20from%20remove.c%20%28well%2C%20it%20has%0A%3E%20been%20reindented%20but%20it%27s%20exaclty%20the%20same%20code%29.%0A%3E%20%0A%3E%20Reviewing%20the%20NMU%20I%20can%20see%20that%20the%20applied%20patch%20does%20not%20include%20any%20of%20%0A%3E%20the%20comments%20I%20provided%20%28nor%20references%29%20which%2C%20I%20believe%2C%20gave%20appropiate%20%0A%3E%20credit.%20After%20all%2C%20Brian%20Hatch%20found%20this%20issue%20first%20%28even%20if%20he%20did%20not%20%0A%3E%20report%20it%20himself%29.%0A%3E%20%0A%3E%20Is%20there%20any%20reason%20why%20my%20comments%20%28and%20the%20debug%20line%20I%20added%29%20have%20been%20%0A%3E%20removed%20from%20the%20patch%3F%20%0A%3E%20%0A%3E%20Regards%0A%3E%20%0A%3E%20Javier%0A%3E%20%0A%3E%20PS%3A%20Giving%20credit%20would%20have%20been%20also%20a%20nice%20thing%2C%20BTW.%0A%3E%20PPS%3A%20I%20would%20have%20liked%20to%20hear%20dpkg-dev%27s%20team%20input%20in%20this%20issue%2C%20%0A%3E%20changes%20in%20this%20package%20are%20of%20significant%20importance%20that%20I%20did%20not%20want%20%0A%3E%20to%20risk%20doing%20an%20NMU.%0A%3E%20PPS%3A%20CCing%20me%20in%20the%20replies%20to%20Erno%20would%20have%20been%20nice%20too.%0A&amp;subject=Re%3A%20%28Bug%20225692%29%20The%20patch%20provided%20is%20just%20like%20the%20one%20I%20provided%20%28%21%3F%29&amp;References=%3C20040227221926.GA15695%40dat.etsit.upm.es%3E&amp;In-Reply-To=%3C20040227221926.GA15695%40dat.etsit.upm.es%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Scott James Remnant &lt;scott@netsplit.com&gt;, 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> (Bug 225692) The patch provided is just like the one I provided (!?)</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 27 Feb 2004 23:19:26 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=80">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">
Hi, I&#39;m just curious because reviewing this bug it looks like the patch
provided by Scoot is _precisely_ the same patch I provided (albeit with the
comments describing the behaviour removed). As I mentioned in the bug
report, the code I provided was taken verbatim from remove.c (well, it has
been reindented but it&#39;s exaclty the same code).

Reviewing the NMU I can see that the applied patch does not include any of 
the comments I provided (nor references) which, I believe, gave appropiate 
credit. After all, Brian Hatch found this issue first (even if he did not 
report it himself).

Is there any reason why my comments (and the debug line I added) have been 
removed from the patch? 

Regards

Javier

PS: Giving credit would have been also a nice thing, BTW.
PPS: I would have liked to hear dpkg-dev&#39;s team input in this issue, 
changes in this package are of significant importance that I did not want 
to risk doing an NMU.
PPS: CCing me in the replies to Erno would have been nice too.
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=80">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="81"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=82">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=82">mbox</a>, <a href="#81">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="83"></a>
<strong>Acknowledgement sent</strong> to <code>Scott James Remnant &lt;scott@netsplit.com&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=84">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=84">mbox</a>, <a href="#83">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="85"></a><a name="msg85"></a><a href="#85">Message #85</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=85">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=85">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3C1077922928.11308.41.camel%40descent.netsplit.com%3E&amp;References=%3C20040227221926.GA15695%40dat.etsit.upm.es%3E%0A%20%3C1077922928.11308.41.camel%40descent.netsplit.com%3E&amp;body=On%20Fri%2C%2027%20Feb%202004%2023%3A02%3A08%20%2B0000%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%20wrote%3A%0A%3E%20On%20Fri%2C%202004-02-27%20at%2022%3A19%2C%20Javier%20Fern%C3%A1ndez-Sanguino%20Pe%C3%B1a%20wrote%3A%0A%3E%20%0A%3E%20%3E%20Reviewing%20the%20NMU%20I%20can%20see%20that%20the%20applied%20patch%20does%20not%20include%20any%20of%20%0A%3E%20%3E%20the%20comments%20I%20provided%20%28nor%20references%29%20which%2C%20I%20believe%2C%20gave%20appropiate%20%0A%3E%20%3E%20credit.%20After%20all%2C%20Brian%20Hatch%20found%20this%20issue%20first%20%28even%20if%20he%20did%20not%20%0A%3E%20%3E%20report%20it%20himself%29.%0A%3E%20%3E%20%0A%3E%20%3E%20Is%20there%20any%20reason%20why%20my%20comments%20%28and%20the%20debug%20line%20I%20added%29%20have%20been%20%0A%3E%20%3E%20removed%20from%20the%20patch%3F%20%0A%3E%20%3E%20%0A%3E%20A%20~60%20line%20comment%20in%20the%20middle%20of%20a%20~1%2C000%20line%20function%20isn%27t%20really%0A%3E%20a%20great%20place%20to%20put%20that%20kind%20of%20thing.%20%20What%20the%20code%20does%20is%20fairly%0A%3E%20obvious%2C%20and%20why%20it%20does%20it%20is%20documented%20in%20the%20ChangeLog%20entry%20for%20the%0A%3E%20patch.%0A%3E%20%0A%3E%20I%20dislike%2C%20in%20general%2C%20long-winded%20discussions%20of%20code%20in%20the%20middle%20of%0A%3E%20functions.%20%20Various%20articles%20and%20papers%20are%20interesting%20to%20the%20security%0A%3E%20expert%2C%20but%20not%20to%20the%20maintainer%20of%20the%20code.%0A%3E%20%0A%3E%20The%20%2Aright%2A%20place%20for%20such%20discussions%2C%20and%20provision%20of%20relevant%20papers%0A%3E%20and%20articles%20is%20the%20bug%20tracking%20system.%20%20The%20change%20to%20the%20code%20is%20then%0A%3E%20accompanied%20by%20a%20reference%20to%20the%20bug%20number%20%28in%20debian%2Fchangelog%29%20for%0A%3E%20the%20interested%20reader.%0A%3E%20%0A%3E%20So%20whilst%20the%20full%20history%20of%20a%20bug%2Fchange%2C%20who%20first%20noticed%20it%2C%0A%3E%20suggested%20it%20and%2For%20found%20it%2C%20etc.%20etc.%20are%20all%20interesting%20--%20the%20BTS%0A%3E%20is%20what%20keeps%20that%20information%2C%20not%20comments%20above%20every%20single%20block%20of%0A%3E%20code%20in%20the%20source.%0A%3E%20%0A%3E%20Scott%0A%3E%20--%20%0A%3E%20Have%20you%20ever%2C%20ever%20felt%20like%20this%3F%0A%3E%20Had%20strange%20things%20happen%3F%20%20Are%20you%20going%20round%20the%20twist%3F%0A%3E%20%0A&amp;subject=Re%3A%20%28Bug%20225692%29%20The%20patch%20provided%20is%20just%20like%20the%20one%20I%0A%09provided%20%28%21%3F%29">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=scott%40netsplit.com" alt="">
<div class="header"><span class="headerfield">From:</span> Scott James Remnant &lt;scott@netsplit.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: (Bug 225692) The patch provided is just like the one I
	provided (!?)</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 27 Feb 2004 23:02:08 +0000</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=85">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Fri, 2004-02-27 at 22:19, Javier Fernández-Sanguino Peña wrote:

&gt; Reviewing the NMU I can see that the applied patch does not include any of 
&gt; the comments I provided (nor references) which, I believe, gave appropiate 
&gt; credit. After all, Brian Hatch found this issue first (even if he did not 
&gt; report it himself).
&gt; 
&gt; Is there any reason why my comments (and the debug line I added) have been 
&gt; removed from the patch? 
&gt; 
A ~60 line comment in the middle of a ~1,000 line function isn&#39;t really
a great place to put that kind of thing.  What the code does is fairly
obvious, and why it does it is documented in the ChangeLog entry for the
patch.

I dislike, in general, long-winded discussions of code in the middle of
functions.  Various articles and papers are interesting to the security
expert, but not to the maintainer of the code.

The *right* place for such discussions, and provision of relevant papers
and articles is the bug tracking system.  The change to the code is then
accompanied by a reference to the bug number (in debian/changelog) for
the interested reader.

So whilst the full history of a bug/change, who first noticed it,
suggested it and/or found it, etc. etc. are all interesting -- the BTS
is what keeps that information, not comments above every single block of
code in the source.

Scott
-- 
Have you ever, ever felt like this?
Had strange things happen?  Are you going round the twist?

</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=85">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="infmessage"><hr><p>
<a name="86"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>:<br>
<code>Bug#225692</code>; Package <code>dpkg</code>.
(<a href="bugreport.cgi?bug=225692;msg=87">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=87">mbox</a>, <a href="#86">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="88"></a>
<strong>Acknowledgement sent</strong> to <code>Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=225692;msg=89">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=89">mbox</a>, <a href="#88">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="90"></a><a name="msg90"></a><a href="#90">Message #90</a> received at 225692@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=90">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=90">mbox</a>, <a href="mailto:225692@bugs.debian.org?subject=Re%3A%20%28Bug%20225692%29%20The%20patch%20provided%20is%20just%20like%20the%20one%20I%20provided%20%28%21%3F%29&amp;body=On%20Sat%2C%2028%20Feb%202004%2016%3A08%3A37%20%2B0100%20Javier%20%3D%3Fiso-8859-15%3FQ%3FFern%3DE1ndez-Sanguino_Pe%3DF1a%3F%3D%20%3Cjfs%40computer.org%3E%20wrote%3A%0A%3E%20On%20Fri%2C%20Feb%2027%2C%202004%20at%2011%3A02%3A08PM%20%2B0000%2C%20Scott%20James%20Remnant%20wrote%3A%0A%3E%20%3E%20%3E%20Is%20there%20any%20reason%20why%20my%20comments%20%28and%20the%20debug%20line%20I%20added%29%20have%20been%20%0A%3E%20%3E%20%3E%20removed%20from%20the%20patch%3F%20%0A%3E%20%3E%20%3E%20%0A%3E%20%3E%20A%20~60%20line%20comment%20in%20the%20middle%20of%20a%20~1%2C000%20line%20function%20isn%27t%20really%0A%3E%20%3E%20a%20great%20place%20to%20put%20that%20kind%20of%20thing.%20%20What%20the%20code%20does%20is%20fairly%0A%3E%20%3E%20obvious%2C%20and%20why%20it%20does%20it%20is%20documented%20in%20the%20ChangeLog%20entry%20for%20the%0A%3E%20%3E%20patch.%0A%3E%20%0A%3E%20Ok.%20But%20you%20didn%27t%20move%20my%20comments%20to%20the%20Changelog%20entry%20either.%0A%3E%20%0A%3E%20%3E%20I%20dislike%2C%20in%20general%2C%20long-winded%20discussions%20of%20code%20in%20the%20middle%20of%0A%3E%20%3E%20functions.%20%20Various%20articles%20and%20papers%20are%20interesting%20to%20the%20security%0A%3E%20%3E%20expert%2C%20but%20not%20to%20the%20maintainer%20of%20the%20code.%0A%3E%20%0A%3E%20Of%20course%2C%20you%20are%20entitled%20to%20your%20own%20opinion.%20In%20any%20case%2C%20you%20dropped%20%0A%3E%20what%20I%20believe%20is%20a%20good%20source%20of%20information%20on%20_why_%20was%20the%20change%20%0A%3E%20introduced.%0A%3E%20%0A%3E%20%3E%20The%20%2Aright%2A%20place%20for%20such%20discussions%2C%20and%20provision%20of%20relevant%20papers%0A%3E%20%3E%20and%20articles%20is%20the%20bug%20tracking%20system.%20%20The%20change%20to%20the%20code%20is%20then%0A%3E%20%3E%20accompanied%20by%20a%20reference%20to%20the%20bug%20number%20%28in%20debian%2Fchangelog%29%20for%0A%3E%20%3E%20the%20interested%20reader.%0A%3E%20%0A%3E%20I%20disagree.%20Software%20developers%20do%20not%20necessarily%20need%20to%20go%20to%20the%20BTS%2C%20%0A%3E%20they%20use%20the%20documentation%20provided%20in%20the%20package%20or%20the%20source%20code%20%0A%3E%20itself.%20%0A%3E%20%0A%3E%20%3E%20So%20whilst%20the%20full%20history%20of%20a%20bug%2Fchange%2C%20who%20first%20noticed%20it%2C%0A%3E%20%3E%20suggested%20it%20and%2For%20found%20it%2C%20etc.%20etc.%20are%20all%20interesting%20--%20the%20BTS%0A%3E%20%3E%20is%20what%20keeps%20that%20information%2C%20not%20comments%20above%20every%20single%20block%20of%0A%3E%20%3E%20code%20in%20the%20source.%0A%3E%20%0A%3E%20It%27s%20important%20enough%20to%20give%20credit%20where%20credit%20is%20due%2C%20and%20you%20have%20%0A%3E%20neglected%20that.%20Giving%20credit%20%28to%20Brian%20Hatch%20for%20example%29%20encourages%20%0A%3E%20positive%20feedback.%20If%20you%20disliked%20the%20comment%20in%20the%20source%20code%2C%20you%20%0A%3E%20could%20have%20moved%20it%20to%20the%20Changelog%20entry%2C%20if%20you%20did%20not%20find%20that%20was%20%0A%3E%20the%20place%20either%20you%20could%20have%20updated%20dpkg%27s%20documentation%20that%20describes%20%0A%3E%20_how_%20it%20is%20supposed%20to%20behave.%0A%3E%20%0A%3E%20Even%20if%20it%20was%20a%20fix%20for%20a%20security%20issue%2C%20It%27s%20worth%20documenting%20it%20%0A%3E%20further%2C%20%22stashing%20away%22%20is%20not%20a%20good%20enough%20description.%20As%20far%20as%20I%20see%20%0A%3E%20from%20your%20NMU%20this%20was%20the%20only%20bug%20which%20was%20a%20significant%20change%20in%20%0A%3E%20dpkg%27s%20behaviour%2C%20I%20don%27t%20believe%20any%20other%20programs%20rely%20on%20this%2C%20but%20%0A%3E%20documenting%20more%20why%20it%27s%20being%20introduced%20would%20be%20of%20benefit%20both%20to%20%0A%3E%20casual%20observers%20of%20the%20Changelog%20and%20to%20other%20package%20manager%27s%20software%20%0A%3E%20developers.%0A%3E%20%0A%3E%20Just%20my%202c.%0A%3E%20%0A%3E%20Regards%0A%3E%20%0A%3E%20Javier%0A&amp;References=%3C20040227221926.GA15695%40dat.etsit.upm.es%3E%20%3C1077922928.11308.41.camel%40descent.netsplit.com%3E%0A%20%3C20040228150837.GA13769%40dat.etsit.upm.es%3E&amp;In-Reply-To=%3C20040228150837.GA13769%40dat.etsit.upm.es%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=jfs%40computer.org" alt="">
<div class="header"><span class="headerfield">From:</span> Javier Fernández-Sanguino Peña &lt;jfs@computer.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Scott James Remnant &lt;scott@netsplit.com&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 225692@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: (Bug 225692) The patch provided is just like the one I provided (!?)</div>
<div class="header"><span class="headerfield">Date:</span> Sat, 28 Feb 2004 16:08:37 +0100</div>
</div>
<pre class="mime">[<a href="bugreport.cgi?att=0;bug=225692;msg=90">Message part 1</a> (text/plain, inline)]</pre>
<pre class="message">On Fri, Feb 27, 2004 at 11:02:08PM +0000, Scott James Remnant wrote:
&gt; &gt; Is there any reason why my comments (and the debug line I added) have been 
&gt; &gt; removed from the patch? 
&gt; &gt; 
&gt; A ~60 line comment in the middle of a ~1,000 line function isn&#39;t really
&gt; a great place to put that kind of thing.  What the code does is fairly
&gt; obvious, and why it does it is documented in the ChangeLog entry for the
&gt; patch.

Ok. But you didn&#39;t move my comments to the Changelog entry either.

&gt; I dislike, in general, long-winded discussions of code in the middle of
&gt; functions.  Various articles and papers are interesting to the security
&gt; expert, but not to the maintainer of the code.

Of course, you are entitled to your own opinion. In any case, you dropped 
what I believe is a good source of information on _why_ was the change 
introduced.

&gt; The *right* place for such discussions, and provision of relevant papers
&gt; and articles is the bug tracking system.  The change to the code is then
&gt; accompanied by a reference to the bug number (in debian/changelog) for
&gt; the interested reader.

I disagree. Software developers do not necessarily need to go to the BTS, 
they use the documentation provided in the package or the source code 
itself. 

&gt; So whilst the full history of a bug/change, who first noticed it,
&gt; suggested it and/or found it, etc. etc. are all interesting -- the BTS
&gt; is what keeps that information, not comments above every single block of
&gt; code in the source.

It&#39;s important enough to give credit where credit is due, and you have 
neglected that. Giving credit (to Brian Hatch for example) encourages 
positive feedback. If you disliked the comment in the source code, you 
could have moved it to the Changelog entry, if you did not find that was 
the place either you could have updated dpkg&#39;s documentation that describes 
_how_ it is supposed to behave.

Even if it was a fix for a security issue, It&#39;s worth documenting it 
further, &quot;stashing away&quot; is not a good enough description. As far as I see 
from your NMU this was the only bug which was a significant change in 
dpkg&#39;s behaviour, I don&#39;t believe any other programs rely on this, but 
documenting more why it&#39;s being introduced would be of benefit both to 
casual observers of the Changelog and to other package manager&#39;s software 
developers.

Just my 2c.

Regards

Javier
</pre>
<pre class="mime">[<a href="bugreport.cgi?att=1;bug=225692;filename=signature.asc;msg=90">signature.asc</a> (application/pgp-signature, inline)]</pre>

<div class="msgreceived"><hr><p>
<a name="91"></a>
<strong>Reply sent</strong> to <code>Scott James Remnant &lt;scott@netsplit.com&gt;</code>:<br>
You have taken responsibility.
(<a href="bugreport.cgi?bug=225692;msg=92">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=92">mbox</a>, <a href="#91">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="93"></a>
<strong>Notification sent</strong> to <code>Erno Kuusela &lt;erno-debbugs@erno.iki.fi&gt;</code>:<br>
Bug acknowledged by developer.
(<a href="bugreport.cgi?bug=225692;msg=94">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=94">mbox</a>, <a href="#93">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="95"></a><a name="msg95"></a><a href="#95">Message #95</a> received at 225692-close@bugs.debian.org (<a href="bugreport.cgi?bug=225692;msg=95">full text</a>, <a href="bugreport.cgi?bug=225692;mbox=yes;msg=95">mbox</a>, <a href="mailto:225692@bugs.debian.org?In-Reply-To=%3CE1B0QiO-0002ko-00%40newraff.debian.org%3E&amp;References=%3CE1B0QiO-0002ko-00%40newraff.debian.org%3E&amp;subject=Re%3A%20Bug%23225692%3A%20fixed%20in%20dpkg%201.10.19&amp;body=On%20Mon%2C%2008%20Mar%202004%2014%3A47%3A04%20-0500%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%20wrote%3A%0A%3E%20Source%3A%20dpkg%0A%3E%20Source-Version%3A%201.10.19%0A%3E%20%0A%3E%20We%20believe%20that%20the%20bug%20you%20reported%20is%20fixed%20in%20the%20latest%20version%20of%0A%3E%20dpkg%2C%20which%20is%20due%20to%20be%20installed%20in%20the%20Debian%20FTP%20archive%3A%0A%3E%20%0A%3E%20dpkg-dev_1.10.19_all.deb%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdpkg-dev_1.10.19_all.deb%0A%3E%20dpkg-doc_1.10.19_all.deb%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdpkg-doc_1.10.19_all.deb%0A%3E%20dpkg_1.10.19.dsc%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdpkg_1.10.19.dsc%0A%3E%20dpkg_1.10.19.tar.gz%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdpkg_1.10.19.tar.gz%0A%3E%20dpkg_1.10.19_i386.deb%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdpkg_1.10.19_i386.deb%0A%3E%20dselect_1.10.19_i386.deb%0A%3E%20%20%20to%20pool%2Fmain%2Fd%2Fdpkg%2Fdselect_1.10.19_i386.deb%0A%3E%20%0A%3E%20%0A%3E%20%0A%3E%20A%20summary%20of%20the%20changes%20between%20this%20version%20and%20the%20previous%20one%20is%0A%3E%20attached.%0A%3E%20%0A%3E%20Thank%20you%20for%20reporting%20the%20bug%2C%20which%20will%20now%20be%20closed.%20%20If%20you%0A%3E%20have%20further%20comments%20please%20address%20them%20to%20225692%40bugs.debian.org%2C%0A%3E%20and%20the%20maintainer%20will%20reopen%20the%20bug%20report%20if%20appropriate.%0A%3E%20%0A%3E%20Debian%20distribution%20maintenance%20software%0A%3E%20pp.%0A%3E%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%20%28supplier%20of%20updated%20dpkg%20package%29%0A%3E%20%0A%3E%20%28This%20message%20was%20generated%20automatically%20at%20their%20request%3B%20if%20you%0A%3E%20believe%20that%20there%20is%20a%20problem%20with%20it%20please%20contact%20the%20archive%0A%3E%20administrators%20by%20mailing%20ftpmaster%40debian.org%29%0A%3E%20%0A%3E%20%0A%3E%20-----BEGIN%20PGP%20SIGNED%20MESSAGE-----%0A%3E%20Hash%3A%20SHA1%0A%3E%20%0A%3E%20Format%3A%201.7%0A%3E%20Date%3A%20Mon%2C%20%208%20Mar%202004%2019%3A05%3A32%20%2B0000%0A%3E%20Source%3A%20dpkg%0A%3E%20Binary%3A%20dpkg-doc%20dpkg%20dselect%20dpkg-dev%20dpkg-static%0A%3E%20Architecture%3A%20source%20all%20i386%0A%3E%20Version%3A%201.10.19%0A%3E%20Distribution%3A%20unstable%0A%3E%20Urgency%3A%20high%0A%3E%20Maintainer%3A%20Dpkg%20Development%20%3Cdebian-dpkg%40lists.debian.org%3E%0A%3E%20Changed-By%3A%20Scott%20James%20Remnant%20%3Cscott%40netsplit.com%3E%0A%3E%20Description%3A%20%0A%3E%20%20dpkg%20%20%20%20%20%20%20-%20Package%20maintenance%20system%20for%20Debian%0A%3E%20%20dpkg-dev%20%20%20-%20Package%20building%20tools%20for%20Debian%0A%3E%20%20dpkg-doc%20%20%20-%20Dpkg%20Internals%20Documentation%0A%3E%20%20dselect%20%20%20%20-%20a%20user%20tool%20to%20manage%20Debian%20packages%0A%3E%20Closes%3A%20139781%20157437%20168443%20170953%20190611%20199489%20199693%20211566%20213038%20213543%20213846%20217286%20217943%20221989%20222760%20225692%20228253%20228379%20232025%20232916%20235266%0A%3E%20Changes%3A%20%0A%3E%20%20dpkg%20%281.10.19%29%20unstable%3B%20urgency%3Dhigh%0A%3E%20%20.%0A%3E%20%20%20%20%2A%20Distinguish%20unmet%20build%20dependencies%20from%20build%20conflicts.%0A">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=scott%40netsplit.com" alt="">
<div class="header"><span class="headerfield">From:</span> Scott James Remnant &lt;scott@netsplit.com&gt;</div>
<div class="header"><span class="headerfield">To:</span> 225692-close@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Bug#225692: fixed in dpkg 1.10.19</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 08 Mar 2004 14:47:04 -0500</div>
</div>
<pre class="message">Source: dpkg
Source-Version: 1.10.19

We believe that the bug you reported is fixed in the latest version of
dpkg, which is due to be installed in the Debian FTP archive:

dpkg-dev_1.10.19_all.deb
  to pool/main/d/dpkg/dpkg-dev_1.10.19_all.deb
dpkg-doc_1.10.19_all.deb
  to pool/main/d/dpkg/dpkg-doc_1.10.19_all.deb
dpkg_1.10.19.dsc
  to pool/main/d/dpkg/dpkg_1.10.19.dsc
dpkg_1.10.19.tar.gz
  to pool/main/d/dpkg/dpkg_1.10.19.tar.gz
dpkg_1.10.19_i386.deb
  to pool/main/d/dpkg/dpkg_1.10.19_i386.deb
dselect_1.10.19_i386.deb
  to pool/main/d/dpkg/dselect_1.10.19_i386.deb



A summary of the changes between this version and the previous one is
attached.

Thank you for reporting the bug, which will now be closed.  If you
have further comments please address them to 225692@bugs.debian.org,
and the maintainer will reopen the bug report if appropriate.

Debian distribution maintenance software
pp.
Scott James Remnant &lt;scott@netsplit.com&gt; (supplier of updated dpkg package)

(This message was generated automatically at their request; if you
believe that there is a problem with it please contact the archive
administrators by mailing ftpmaster@debian.org)


-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Format: 1.7
Date: Mon,  8 Mar 2004 19:05:32 +0000
Source: dpkg
Binary: dpkg-doc dpkg dselect dpkg-dev dpkg-static
Architecture: source all i386
Version: 1.10.19
Distribution: unstable
Urgency: high
Maintainer: Dpkg Development &lt;debian-dpkg@lists.debian.org&gt;
Changed-By: Scott James Remnant &lt;scott@netsplit.com&gt;
Description: 
 dpkg       - Package maintenance system for Debian
 dpkg-dev   - Package building tools for Debian
 dpkg-doc   - Dpkg Internals Documentation
 dselect    - a user tool to manage Debian packages
Closes: <a href="bugreport.cgi?bug=139781">139781</a> <a href="bugreport.cgi?bug=157437">157437</a> <a href="bugreport.cgi?bug=168443">168443</a> <a href="bugreport.cgi?bug=170953">170953</a> <a href="bugreport.cgi?bug=190611">190611</a> <a href="bugreport.cgi?bug=199489">199489</a> <a href="bugreport.cgi?bug=199693">199693</a> <a href="bugreport.cgi?bug=211566">211566</a> <a href="bugreport.cgi?bug=213038">213038</a> <a href="bugreport.cgi?bug=213543">213543</a> <a href="bugreport.cgi?bug=213846">213846</a> <a href="bugreport.cgi?bug=217286">217286</a> <a href="bugreport.cgi?bug=217943">217943</a> <a href="bugreport.cgi?bug=221989">221989</a> <a href="bugreport.cgi?bug=222760">222760</a> <a href="bugreport.cgi?bug=225692">225692</a> <a href="bugreport.cgi?bug=228253">228253</a> <a href="bugreport.cgi?bug=228379">228379</a> <a href="bugreport.cgi?bug=232025">232025</a> <a href="bugreport.cgi?bug=232916">232916</a> <a href="bugreport.cgi?bug=235266">235266</a>
Changes: 
 dpkg (1.10.19) unstable; urgency=high
 .
   * Distinguish unmet build dependencies from build conflicts.
     Closes: #<a href="bugreport.cgi?bug=217943">217943</a>, #<a href="bugreport.cgi?bug=235266">235266</a>.
   * Force NULL-termination of all tar file entry names.  Closes: #<a href="bugreport.cgi?bug=232025">232025</a>.
   * Allow dselect to use the full window width.  Closes: #<a href="bugreport.cgi?bug=139781">139781</a>.
   * Pass correct number of arguments for format string when out of disk
     space.  Closes: #<a href="bugreport.cgi?bug=213038">213038</a>, #<a href="bugreport.cgi?bug=217286">217286</a>, #<a href="bugreport.cgi?bug=213543">213543</a>, #<a href="bugreport.cgi?bug=213846">213846</a>.
   * Remove duplicated entries from ChangeLog.  Closes: #<a href="bugreport.cgi?bug=157437">157437</a>.
   * Fix dpkg-buildpackage when used with PGP.  Closes: #<a href="bugreport.cgi?bug=232916">232916</a>.
   * Update support for Debian FreeBSD.  Closes: #<a href="bugreport.cgi?bug=211566">211566</a>.
   * Store Architecture in the status file.  Closes: #<a href="bugreport.cgi?bug=228253">228253</a>.
   * Don&#39;t print offending lines in md5sum.  Closes: #<a href="bugreport.cgi?bug=170953">170953</a>.
   * Check bounds of md5sum lines.  Closes: #<a href="bugreport.cgi?bug=168443">168443</a>, #<a href="bugreport.cgi?bug=199489">199489</a>, #<a href="bugreport.cgi?bug=199693">199693</a>.
 .
 dpkg (1.10.18.1) unstable; urgency=medium
 .
   * Non-maintainer upload to fix release-critical bugs.
   * Terminate string buffer in main/remove.c.  Closes: #<a href="bugreport.cgi?bug=228379">228379</a>.
   * Prevent stashing of hardlinked devices and setuid or setgid binaries
     by removing permissions on upgrade as well as on remove.
     Closes: #<a href="bugreport.cgi?bug=225692">225692</a>.
   * Update dpkg conflicts to &lt;&lt; 1.10, instead of 1.9.
     Closes: #<a href="bugreport.cgi?bug=190611">190611</a>, #<a href="bugreport.cgi?bug=221989">221989</a>, #<a href="bugreport.cgi?bug=222760">222760</a>.
Files: 
 5a4c39cb6903694ec7ff0ebcd5afc33d 798 base required dpkg_1.10.19.dsc
 a735a1f14cc985ad083b46bce425001b 1547265 base required dpkg_1.10.19.tar.gz
 86386707c685a60c4132def2494b3657 1086080 base required dpkg_1.10.19_i386.deb
 5bf8ab50684b58b8619f2c7d982ac47f 95024 base required dselect_1.10.19_i386.deb
 088fe395e33835351e2ccdc3f8122a31 114618 utils standard dpkg-dev_1.10.19_all.deb
 294b7c2bf86172671a91b050c6db8a1a 10636 doc optional dpkg-doc_1.10.19_all.deb

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (GNU/Linux)

iD8DBQFATMchIexP3IStZ2wRAoQRAJ0Q5CxELST85r5oNEY3nnZE6TB/mgCggxyX
0sfA6HaAPzloTBPKab+L3nw=
=R85a
-----END PGP SIGNATURE-----



</pre>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=225692">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Sat Oct 30 18:22:33 2021<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
