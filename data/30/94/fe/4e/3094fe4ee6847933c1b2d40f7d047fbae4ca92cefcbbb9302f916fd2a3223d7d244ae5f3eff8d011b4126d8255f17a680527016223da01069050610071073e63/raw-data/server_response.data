<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - TELNET stack contents disclosure - CVE-2021-22898</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="STYLESHEET" type="text/css" href="https://curl.se/manpage.css">
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">Web Site Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/hsts.html">HSTS</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http2.html">HTTP/2</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/changes.html">Changelog</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/security.html">Security Problems</a>
    <a href="/docs/versions.html">Version Nums</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/manual.html">Tutorial</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">Security Problems</a> / <b>TELNET stack contents disclosure</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/changes.html">Changelog</a>
<br><a href="/donation.html">Donate</a>
<br><a href="faq.html">FAQ</a>
<br><a href="security.html">Security Problems</a>
<br><a href="/dev/secprocess.html">Security Process</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<h1 id="telnet-stack-contents-disclosure">TELNET stack contents disclosure</h1>
<p>Project curl Security Advisory, May 26th 2021 - <a href="https://curl.se/docs/CVE-2021-22898.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>curl supports the <code>-t</code> command line option, known as <code><a href="https://curl.se/libcurl/c/CURLOPT_TELNETOPTIONS.html">CURLOPT_TELNETOPTIONS</a></code> in libcurl. This rarely used option is used to send variable=content pairs to TELNET servers.</p>
<p>Due to flaw in the option parser for sending <code>NEW_ENV</code> variables, libcurl could be made to pass on uninitialized data from a stack based buffer to the server. Therefore potentially revealing sensitive internal information to the server using a clear-text network protocol.</p>
<p>This could happen because curl did not check the return code from a <code>sscanf(command, &quot;%127[^,],%127s&quot;)</code> function invoke correctly, and would leave the piece of the send buffer uninitialized for the value part if it was provided longer than 127 bytes. The buffer used for this is 2048 bytes big and the <em>variable</em> part of the <em>variable=content</em> pairs would be stored correctly in the send buffer, making curl sending &quot;interleaved&quot; bytes sequences of stack contents. A single curl TELNET handshake could then be made to send off a total of around 1800 bytes of (non-contiguous) stack contents in this style:</p>
<pre><code>[control byte]name[control byte]
stack contents
[control byte]name[control byte]
stack contents
...
</code></pre>
<p>An easy proof of concept command line looks like this:</p>
<pre><code>curl telnet://example.com -tNEW_ENV=a,bbbbbb (256 &#39;b&#39;s)
</code></pre>
<p>We are not aware of any exploit of this flaw.</p>
<h2 id="info">INFO</h2>
<p>This flaw has existed in curl since commit <a href="https://github.com/curl/curl/commit/a1d6ad2610">a1d6ad2610</a> in libcurl <a href="vuln-7.7.html">7.7</a> released on March 22, 2001.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name CVE-2021-22898 to this issue.</p>
<p>CWE-457: Use of Uninitialized Variable</p>
<p>Severity: Medium</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: curl 7.7 to and including <a href="vuln-7.76.1.html">7.76.1</a></li>
<li>Not affected versions: curl &lt; 7.7 and curl &gt;= <a href="vuln-7.77.0.html">7.77.0</a></li>
</ul>
<p>Also note that libcurl is used by many applications, and not always advertised as such.</p>
<h2 id="the-solution">THE SOLUTION</h2>
<p>Use sscanf() properly and only use properly filled-in buffers.</p>
<p>A <a href="https://github.com/curl/curl/commit/39ce47f219b09c380b81f89fe54ac586c8db6bde">fix for CVE-2021-22898</a></p>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>A - Upgrade curl to version <a href="vuln-7.77.0.html">7.77.0</a></p>
<p>B - Apply the patch to your local version</p>
<p>C - Avoid using <code><a href="https://curl.se/libcurl/c/CURLOPT_TELNETOPTIONS.html">CURLOPT_TELNETOPTIONS</a></code></p>
<h2 id="timeline">TIMELINE</h2>
<p>This issue was reported to the curl project on April 27, 2021.</p>
<p>This advisory was posted on May 26, 2021.</p>
<h2 id="credits">CREDITS</h2>
<p>This issue was reported and patched by Harry Sintonen.</p>
<p>Thanks a lot!</p>
</div>
</div>
<script defer src="https://www.fastly-insights.com/insights.js?k=8cb1247c-87c2-4af9-9229-768b1990f90b" type="text/javascript"></script>
</body> </html>
