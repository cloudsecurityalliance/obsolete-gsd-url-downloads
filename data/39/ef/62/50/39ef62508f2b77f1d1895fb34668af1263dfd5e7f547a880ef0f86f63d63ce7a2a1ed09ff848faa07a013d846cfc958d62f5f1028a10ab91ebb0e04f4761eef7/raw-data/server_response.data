<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1165893004: [Downloads] Prevent dangerous files from being opened automatically. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '1605d08f757a7cca67f98a07b72e82db';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1165893004%252526ust%25253D1608718032233111%252526usg%25253DAFQjCNGqSB2D9n-DV5MCobe4U7n6FDdDqg%26service%3Dah">Sign out</a>

</div>
<div class="counter">(1439)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1165893004">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1165893004/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1165893004</a>:
    [Downloads] Prevent dangerous files from being opened automatically.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            5 years, 6 months ago by <a href="/user/asanka" onMouseOver="M_showUserInfoPopup(this)">asanka</a>
          </div>
          <div><b>Modified:</b><br/>
            5 years, 6 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/palmer" onMouseOver="M_showUserInfoPopup(this)">palmer</a></span>, <span class='approval'><a href="/user/Randy%20Smith%20(Not%20in%20Mondays)" onMouseOver="M_showUserInfoPopup(this)">Randy Smith (Not in Mondays)</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            benjhayden+dwatch_chromium.org, chromium-apps-reviews_chromium.org, chromium-reviews, extensions-reviews_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">[Downloads] Prevent executable files from being opened automatically.

Users can accidentally mark executable or other dangerous file types for
opening automatically upon download. This change prevents such file
types from being considered for auto open.

If the user already has any dangerous file types in the auto-open list,
those entries will be ignored on new browser sessions. Any action that
causes the persisted auto-open list to be updated will, as a
side-effect, premanently remove any dangerous file types that were
there.

Currently the list of file types that are excluded from auto open is
maintained by chrome/browser/download/download_extension.cc.

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=461858">461858</a>
TEST=(1) Download an .exe (on Windows) or .swf file.
     (2) Verify that the "Always open files of this type" option is
         disabled.

Committed: <a href="https://crrev.com/39841e54180e2583dffa16fbbb9b99fd293821d0">https://crrev.com/39841e54180e2583dffa16fbbb9b99fd293821d0</a>
Cr-Commit-Position: refs/heads/master@{#334677}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1165893004/#ps1"
       onclick="M_toggleSectionForPS('1165893004', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 5
      
    </div>
  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1165893004/#ps20001"
       onclick="M_toggleSectionForPS('1165893004', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Fix comment
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1165893004/#ps40001"
       onclick="M_toggleSectionForPS('1165893004', '40001')"
       class="toggled-section ">
      Patch Set 3
      : std::string::front() is a C++11 feature. Don&#39;t use it yet.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-60001-pointer"
       href="/1165893004/#ps60001"
       onclick="M_toggleSectionForPS('1165893004', '60001')"
       class="toggled-section ">
      Patch Set 4
      : Use a blacklist instead of including all dangerous file types.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 24
      
    </div>
  

  <div id="ps-60001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1165893004/#ps80001"
       onclick="M_toggleSectionForPS('1165893004', '80001')"
       class="toggled-section ">
      Patch Set 5
      : Fix comment
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 5
      
    </div>
  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-120001-pointer"
       href="/1165893004/#ps120001"
       onclick="M_toggleSectionForPS('1165893004', '120001')"
       class="toggled-section ">
      Patch Set 6
      :  Add more details about file types and fiddle with no auto open flag.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-120001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-140001-pointer"
       href="/1165893004/#ps140001"
       onclick="M_toggleSectionForPS('1165893004', '140001')"
       class="toggled-section ">
      Patch Set 7
      : Update comment.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 8
      
    </div>
  

  <div id="ps-140001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-160001-pointer"
       href="/1165893004/#ps160001"
       onclick="M_toggleSectionForPS('1165893004', '160001')"
       class="toggled-section ">
      Patch Set 8
      : Clarify comments.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-160001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-180001-pointer"
       href="/1165893004/#ps180001"
       onclick="M_toggleSectionForPS('1165893004', '180001')"
       class="toggled-section ">
      Patch Set 9
      :  
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-180001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-200001-pointer"
       href="/1165893004/#ps200001"
       onclick="M_toggleSectionForPS('1165893004', '200001')"
       class="toggled-section opentriangle">
      Patch Set 10
      :  
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-200001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 5 years, 6 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1165893004_200001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1165893004/200001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+456 lines, -138 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210001">
            chrome/browser/download/download_commands.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_commands.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+3 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210001.diff"
             title="Download patch for chrome/browser/download/download_commands.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210003">
            chrome/browser/download/download_extensions.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_extensions.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1165893004/diff2/80001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1165893004/diff2/120001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1165893004/diff2/140001:200001/chrome/browser/download/download_extensions.h"
             title="Delta from patch set 7">7</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+28 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210003.diff"
             title="Download patch for chrome/browser/download/download_extensions.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210002">
            chrome/browser/download/download_extensions.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_extensions.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1165893004/diff2/80001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 5">5</a>
        
          <a href="/1165893004/diff2/120001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 6">6</a>
        
          <a href="/1165893004/diff2/140001:200001/chrome/browser/download/download_extensions.cc"
             title="Delta from patch set 7">7</a>
        
        </td>
        
          <td style="white-space: nowrap">3 chunks</td>
          <td style="white-space: nowrap">+277 lines, -129 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210002.diff"
             title="Download patch for chrome/browser/download/download_extensions.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210005">
            chrome/browser/download/download_prefs.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_prefs.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1165893004/diff2/80001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 5">5</a>
        
          <a href="/1165893004/diff2/120001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 6">6</a>
        
          <a href="/1165893004/diff2/140001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 7">7</a>
        
          <a href="/1165893004/diff2/160001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 8">8</a>
        
          <a href="/1165893004/diff2/180001:200001/chrome/browser/download/download_prefs.h"
             title="Delta from patch set 9">9</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+6 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210005.diff"
             title="Download patch for chrome/browser/download/download_prefs.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210004">
            chrome/browser/download/download_prefs.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_prefs.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/browser/download/download_prefs.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/browser/download/download_prefs.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/browser/download/download_prefs.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/browser/download/download_prefs.cc"
             title="Delta from patch set 4">4</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+24 lines, -7 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210004.diff"
             title="Download patch for chrome/browser/download/download_prefs.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">A</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210006">
            chrome/browser/download/download_prefs_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/browser/download/download_prefs_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/browser/download/download_prefs_unittest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/browser/download/download_prefs_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/browser/download/download_prefs_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/browser/download/download_prefs_unittest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1165893004/diff2/80001:200001/chrome/browser/download/download_prefs_unittest.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+117 lines, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210006.diff"
             title="Download patch for chrome/browser/download/download_prefs_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1165893004/patch/200001/210007">
            chrome/chrome_tests_unit.gypi
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1165893004/diff/200001/chrome/chrome_tests_unit.gypi">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1165893004/diff2/1:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 1">1</a>
        
          <a href="/1165893004/diff2/20001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 2">2</a>
        
          <a href="/1165893004/diff2/40001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 3">3</a>
        
          <a href="/1165893004/diff2/60001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 4">4</a>
        
          <a href="/1165893004/diff2/80001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 5">5</a>
        
          <a href="/1165893004/diff2/120001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 6">6</a>
        
          <a href="/1165893004/diff2/140001:200001/chrome/chrome_tests_unit.gypi"
             title="Delta from patch set 7">7</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -0 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1165893004_200001_210007.diff"
             title="Download patch for chrome/chrome_tests_unit.gypi">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 200001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 23 (5 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 23)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 23)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(23)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(23)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          asanka@chromium.org changed reviewers: + rdsmith@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-03 22:21:56 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            ><a href="mailto:asanka@chromium.org">asanka@chromium.org</a> changed reviewers:
+ <a href="mailto:rdsmith@chromium.org">rdsmith@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-03 22:23:53 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            ></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          On 2015/06/03 22:23:53, asanka wrote: *chuckle* CC me on the bug so I can look ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-03 22:29:42 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            >On 2015/06/03 22:23:53, asanka wrote:

*chuckle*  CC me on the bug so I can look at it?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          First round; high level behavior and nits. https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc File chrome/browser/download/download_extensions.cc (right): https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc#newcode235 chrome/browser/download/download_extensions.cc:235: return !extension.empty() ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-03 23:44:08 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >First round; high level behavior and nits.

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc#newcode235" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
chrome/browser/download/download_extensions.cc:235: return !extension.empty() &amp;&amp;
GetFileDangerLevel(path) == NOT_DANGEROUS;
The !extension.empty() test is redundant with the same check in
GetFileDangerLevel(), I think.

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc#newcode235" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
chrome/browser/download/download_extensions.cc:235: return !extension.empty() &amp;&amp;
GetFileDangerLevel(path) == NOT_DANGEROUS;
So we no longer allow ALLOW_ON_USER_GESTURE files to be opened automatically? 
My gut is that that&#39;s going to annoy people, though the example I was going to
give was .pdf, which doesn&#39;t appear to be a dangerous file type anymore.  Would
it make sense to allow ALLOW_ON_USER_GESTURE types to open automatically iff
they were downloaded associated with a user gesture?  (I know we can&#39;t rely on
that, but we&#39;ve already made the judgement that we&#39;re ok with downloading them
with the imperfect signal of a user gesture ...)

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_prefs.h" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
File chrome/browser/download/download_prefs.h (right):

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_prefs.h#newcode70" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
chrome/browser/download/download_prefs.h:70: // fail if the |file_name| is
allowed to open automatically.
&quot;is allowed&quot; -&gt; &quot;isn&#39;t allowed&quot;?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc File chrome/browser/download/download_extensions.cc (right): https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc#newcode235 chrome/browser/download/download_extensions.cc:235: return !extension.empty() &amp;&amp; GetFileDangerLevel(path) == NOT_DANGEROUS; On 2015/06/03 at ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-04 15:30:48 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            ><a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_extensions.cc#newcode235" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
chrome/browser/download/download_extensions.cc:235: return !extension.empty() &amp;&amp;
GetFileDangerLevel(path) == NOT_DANGEROUS;
On 2015/06/03 at 23:44:07, rdsmith wrote:
&gt; The !extension.empty() test is redundant with the same check in
GetFileDangerLevel(), I think.

The check is different. GetFileDangerLevel() returns NOT_DANGEROUS if the file
has no extension. We want files without extensions to return false from this
function since they can&#39;t be opened automatically.

Also, regarding the ALLOW_ON_USER_GESTURE behavior: Downloads that had a user
gesture and those that didn&#39;t are both equivalent by the time the download
completes. Remember that if there wasn&#39;t a user gesture, we would&#39;ve prompted
the user. In either case, by the end there would be a user gesture.

The only exception to this rule are those files that are now being handled by
SafeBrowsing. Those may not have a user gesture by the end of the download.

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_prefs.h" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
File chrome/browser/download/download_prefs.h (right):

<a href="https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/download_prefs.h#newcode70" rel="nofollow">https://codereview.chromium.org/1165893004/diff/1/chrome/browser/download/dow...</a>
chrome/browser/download/download_prefs.h:70: // fail if the |file_name| is
allowed to open automatically.
On 2015/06/03 at 23:44:08, rdsmith wrote:
&gt; &quot;is allowed&quot; -&gt; &quot;isn&#39;t allowed&quot;?

Done.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          Quick note: Asanka and I spoke offline, and he&#39;s agreed to explore an explicit blacklist ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-04 19:06:23 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >Quick note: Asanka and I spoke offline, and he&#39;s agreed to explore an explicit
blacklist of types to inhibit auto-opening for, as opposed to doing it for all
user_gesture dangerous level types.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          asanka@chromium.org changed reviewers: + palmer@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-05 16:15:39 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            ><a href="mailto:asanka@chromium.org">asanka@chromium.org</a> changed reviewers:
+ <a href="mailto:palmer@chromium.org">palmer@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-05 16:17:34 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            ></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          On 2015/06/05 at 16:17:34, asanka wrote: &gt; Right. Forgot to add a comment. The latest ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-05 19:01:48 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >On 2015/06/05 at 16:17:34, asanka wrote:
&gt; 

Right. Forgot to add a comment.

The latest patchset implements a sort-of blacklist by annotating the list of
dangerous file types in download_extension.cc with whether the file type is
disallowed from automatically opening.

rdsmith: PTAL again?

palmer: Could you do a quick pass through the annotated file types and see if
they make sense?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          LGTM modulo nits and a potentially off-base question about alternative data streams. https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc File chrome/browser/download/download_extensions.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-08 19:05:08 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >LGTM modulo nits and a potentially off-base question about alternative data
streams.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode230" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:230: {&quot;dex&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
I&#39;m actually not sure if Android even would directly run a dex, or what would
happen. Obviously it&#39;s maximally safe to specify EXCLUDE_FROM_AUTO_OPEN here.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs.cc#newcode178" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_prefs.cc:178: // IsAllowedToOpenAutomatically()
needs a filename.
Nit: &quot;...since |IsAllowedToOpenAutomatically| needs...&quot; or &quot;...since the
|IsAllowedToOpenAutomatically| function needs...&quot;

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs_unittest.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs_unittest.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs_unittest.cc#newcode23" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:23: TEST(DownloadPrefsTest,
NoAutoOpenForExecutables) {
Do we need to do anything special about alternative data streams on systems
using NTFS? (Perhaps not, because a web download can&#39;t cause any ADS to be
created? But could Chrome somehow get invoked to run a file that does have an
ADS?)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc File chrome/browser/download/download_extensions.cc (right): https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode230 chrome/browser/download/download_extensions.cc:230: {&quot;dex&quot;, ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN}, On 2015/06/08 at 19:05:07, palmer ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-09 00:38:10 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            ><a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode230" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:230: {&quot;dex&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
On 2015/06/08 at 19:05:07, palmer wrote:
&gt; I&#39;m actually not sure if Android even would directly run a dex, or what would
happen. Obviously it&#39;s maximally safe to specify EXCLUDE_FROM_AUTO_OPEN here.

Yeah. I added the flag for a couple of file types that don&#39;t make sense to open
directly. This should make no difference if the files can&#39;t be opened directly.
If they can (by, say, some custom editor), then users won&#39;t be able to auto open
them.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs.cc#newcode178" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_prefs.cc:178: // IsAllowedToOpenAutomatically()
needs a filename.
On 2015/06/08 at 19:05:07, palmer wrote:
&gt; Nit: &quot;...since |IsAllowedToOpenAutomatically| needs...&quot; or &quot;...since the
|IsAllowedToOpenAutomatically| function needs...&quot;

Done

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs_unittest.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs_unittest.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_prefs_unittest.cc#newcode23" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:23: TEST(DownloadPrefsTest,
NoAutoOpenForExecutables) {
On 2015/06/08 at 19:05:07, palmer wrote:
&gt; Do we need to do anything special about alternative data streams on systems
using NTFS? (Perhaps not, because a web download can&#39;t cause any ADS to be
created? But could Chrome somehow get invoked to run a file that does have an
ADS?)

Hm. We are making the following assumptions:

 1. Chrome can only auto-open file it downloaded itself.

 2. The files Chrome downloaded are have names corresponding to what
DownloadItem::GetTargetFilePath() returns.

 3. Said files consist of a primary data stream corresponding to the resource
transferred from DownloadItem::GetURL().

 4. Opening behavior of a downloaded file is predicted by the filename as
mentioned in #2, and not on the contents of the primary data stream nor
alternate streams.

If these assumptions are not correct, then we have a security issue. Of course,
they can be violated by some nefarious program running on the users&#39; machine
with user level privileges, but that&#39;s outside our threat model.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>palmer</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          &gt; Hm. We are making the following assumptions: &gt; &gt; 1. Chrome can only auto-open ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-09 01:06:20 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            >&gt; Hm. We are making the following assumptions:
&gt; 
&gt;  1. Chrome can only auto-open file it downloaded itself.
&gt; 
&gt;  2. The files Chrome downloaded are have names corresponding to what
&gt; DownloadItem::GetTargetFilePath() returns.
&gt; 
&gt;  3. Said files consist of a primary data stream corresponding to the resource
&gt; transferred from DownloadItem::GetURL().
&gt; 
&gt;  4. Opening behavior of a downloaded file is predicted by the filename as
&gt; mentioned in #2, and not on the contents of the primary data stream nor
&gt; alternate streams.
&gt; 
&gt; If these assumptions are not correct, then we have a security issue. Of
course,
&gt; they can be violated by some nefarious program running on the users&#39; machine
&gt; with user level privileges, but that&#39;s outside our threat model.

That is how I hope it is (thank you for clarifying!), and I have no reason to
think these assumptions do not hold.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          I apologize for my slowness of response on this review. This is a partial review ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-09 19:40:04 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            >I apologize for my slowness of response on this review.  This is a partial
review that I&#39;m posting since it&#39;s pushing back a bit on some of the choices
made around allowing auto-open, and I could imagine that discussion will take
longer than any technical nits I may find in the rest of the review.  I&#39;ll keep
reviewing in the background in parallel with this conversation.

Chris, it might be useful for you to skim my comments, as I&#39;m taking the
anti-security perspective and direct evaluation of that by the pro-security
perspective might be useful.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode62" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:62: enum DownloadDangerFlags {
Jamming these together with DownloadDangerLevel feels very weird to me.  Is
there any reason, given that g_executables is a static, that we couldn&#39;t just
add another entry to the Executable structure?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode105" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:105: {&quot;application&quot;,
ALLOW_ON_USER_GESTURE},
Naively, I would have thought that something named .application would be an
executable that shouldn&#39;t be auto-opened; do you know something I don&#39;t?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode122" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:122: {&quot;hlp&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
This is something I could easily imagine users wanting to auto-open, and I don&#39;t
see the danger; why block it?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode152" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:152: {&quot;mhtml&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
Does opening a web page on the disk give it some special privileges?  This is
another case in which I could imagine users wanting auto-open.  (Applies to
other archive formats too.)

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode176" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:176: {&quot;url&quot;, DANGEROUS |
EXCLUDE_FROM_AUTO_OPEN},
Why?  I&#39;m not sure why people would want to download a URL, but I&#39;d think that
if a web page had nefarious intent, it could just do a &quot;document.location =&quot;. 
What cases am I missing?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode177" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:177: {&quot;vb&quot;,
ALLOW_ON_USER_GESTURE},
Why isn&#39;t open a .vb file dangerous?  Does it always open in the IDE?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:181: {&quot;vsmacros&quot;,
ALLOW_ON_USER_GESTURE},
You know Windows (much) better than I, but I&#39;d think there&#39;s executable
nefariousness to be had in almost any macro language.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode223" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:223: {&quot;pkg&quot;,
ALLOW_ON_USER_GESTURE},
Hmmm.  This is right at the boundary for me--I can definitely see the user
wanting to auto-execute, but it can do almost arbitrary bad things, right?

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode227" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:227: {&quot;rpm&quot;,
ALLOW_ON_USER_GESTURE},
I think that &quot;opening&quot; a package on Linux installs it, which I believe includes
running a script, so I think these are executable equivalents.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          Remaining comments. https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc File chrome/browser/download/download_prefs_unittest.cc (right): https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode25 chrome/browser/download/download_prefs_unittest.cc:25: const base::FilePath kFileWithNoExtension(FILE_PATH_LITERAL(&quot;abcd&quot;)); This doesn&#39;t look like ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-09 21:29:25 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            >Remaining comments.

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs_unittest.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode25" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:25: const base::FilePath
kFileWithNoExtension(FILE_PATH_LITERAL(&quot;abcd&quot;));
This doesn&#39;t look like it&#39;s used in this test (I&#39;m a bit confused the compiler
didn&#39;t warn you about that).

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode32" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:32:
EXPECT_FALSE(prefs.IsAutoOpenEnabledBasedOnExtension(kDangerousFilePath));
This looks like it&#39;s just testing .swf files, but that doesn&#39;t seem to match the
comment before the test; am I confused?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          Patchset #6 (id:100001) has been deleted
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-12 19:27:58 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >Patchset #6 (id:100001) has been deleted</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          Have another look? Rather than explain in the CR, I&#39;ve attempted to summarize the criteria ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-12 20:12:53 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            >Have another look?

Rather than explain in the CR, I&#39;ve attempted to summarize the criteria we are
using in the comment at download_extensions.cc. I figured that&#39;s where folks
would be looking when they want to change the dangerous file types list.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode62" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:62: enum DownloadDangerFlags {
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Jamming these together with DownloadDangerLevel feels very weird to me.  Is
there any reason, given that g_executables is a static, that we couldn&#39;t just
add another entry to the Executable structure?

Yeah. I see what you mean. I split it out into a separate field.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode105" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:105: {&quot;application&quot;,
ALLOW_ON_USER_GESTURE},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Naively, I would have thought that something named .application would be an
executable that shouldn&#39;t be auto-opened; do you know something I don&#39;t?

I added some details in the form of comments. Let me know if it helps.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode122" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:122: {&quot;hlp&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; This is something I could easily imagine users wanting to auto-open, and I
don&#39;t see the danger; why block it?

This was due to the known default file handler having multiple vulnerabilities
in the past. However, I did remove the flag for this round.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode152" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:152: {&quot;mhtml&quot;,
ALLOW_ON_USER_GESTURE | EXCLUDE_FROM_AUTO_OPEN},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Does opening a web page on the disk give it some special privileges?  This is
another case in which I could imagine users wanting auto-open.  (Applies to
other archive formats too.)

Removed the flag.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode176" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:176: {&quot;url&quot;, DANGEROUS |
EXCLUDE_FROM_AUTO_OPEN},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Why?  I&#39;m not sure why people would want to download a URL, but I&#39;d think that
if a web page had nefarious intent, it could just do a &quot;document.location =&quot;. 
What cases am I missing?

A .url file is an OLE persisted container that can point at a lot more things
than what &#39;document.location&#39;.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode177" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:177: {&quot;vb&quot;,
ALLOW_ON_USER_GESTURE},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Why isn&#39;t open a .vb file dangerous?  Does it always open in the IDE?

.vb (not to be confused with .vbs) isn&#39;t associated with the Windows Script
Host. It&#39;s usually associated with an Visual Studio.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:181: {&quot;vsmacros&quot;,
ALLOW_ON_USER_GESTURE},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; You know Windows (much) better than I, but I&#39;d think there&#39;s executable
nefariousness to be had in almost any macro language.

As far as I could discover, opening this type of file doesn&#39;t automatically
execute code until the macro is invoked.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode223" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:223: {&quot;pkg&quot;,
ALLOW_ON_USER_GESTURE},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; Hmmm.  This is right at the boundary for me--I can definitely see the user
wanting to auto-execute, but it can do almost arbitrary bad things, right?

Added.

<a href="https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download/download_extensions.cc#newcode227" rel="nofollow">https://codereview.chromium.org/1165893004/diff/60001/chrome/browser/download...</a>
chrome/browser/download/download_extensions.cc:227: {&quot;rpm&quot;,
ALLOW_ON_USER_GESTURE},
On 2015/06/09 at 19:40:04, rdsmith wrote:
&gt; I think that &quot;opening&quot; a package on Linux installs it, which I believe
includes running a script, so I think these are executable equivalents.

Added.

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs_unittest.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode25" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:25: const base::FilePath
kFileWithNoExtension(FILE_PATH_LITERAL(&quot;abcd&quot;));
On 2015/06/09 at 21:29:25, rdsmith wrote:
&gt; This doesn&#39;t look like it&#39;s used in this test (I&#39;m a bit confused the compiler
didn&#39;t warn you about that).

Removed.

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode32" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:32:
EXPECT_FALSE(prefs.IsAutoOpenEnabledBasedOnExtension(kDangerousFilePath));
On 2015/06/09 at 21:29:25, rdsmith wrote:
&gt; This looks like it&#39;s just testing .swf files, but that doesn&#39;t seem to match
the comment before the test; am I confused?

I don&#39;t quite follow. Which comment?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Randy Smith (Not in Mondays)</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          LGTM; all comments below are suggestions that you can do with as you wish. https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-15 19:19:17 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            >LGTM; all comments below are suggestions that you can do with as you wish.

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
File chrome/browser/download/download_prefs_unittest.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download/download_prefs_unittest.cc#newcode32" rel="nofollow">https://codereview.chromium.org/1165893004/diff/80001/chrome/browser/download...</a>
chrome/browser/download/download_prefs_unittest.cc:32:
EXPECT_FALSE(prefs.IsAutoOpenEnabledBasedOnExtension(kDangerousFilePath));
On 2015/06/12 20:12:52, asanka wrote:
&gt; On 2015/06/09 at 21:29:25, rdsmith wrote:
&gt; &gt; This looks like it&#39;s just testing .swf files, but that doesn&#39;t seem to match
&gt; the comment before the test; am I confused?
&gt; 
&gt; I don&#39;t quite follow. Which comment?

Whoops, sorry, I meant the test name, not the comment. 
&quot;NoAutoOpenForExecutables&quot; implies to me that the test is either for all
executable files or in some way for the class of files that is executables. 
This is testing either just .swf files or the set of dangerous files.  I think
you&#39;ve changed the name in the latest PS, so feel free to ignore this comment.

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode78" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:78: // ALLOW_ON_USER_GESTURE.
Even if the user explicitly consents to the
I&#39;d rewrite this a bit to explicitly acknowledge that ALLOW_ON_USER_GESTURE
isn&#39;t a reliable security guarantee, more of a speed bump.

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode79" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:79: // download, they should be
able to choose when or if the file should be
The issue is whether they should be forced to rather than whether they be able
to choose to, right?

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode105" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:105: // Some files are dangerous
on all platforms.
I really like the addition of detailed comments to this list.  Of course, the
addition of those comments makes sharper the lack of comments for some file
types.  Not as part of this CL, but maybe long-term we should have a goal of
commenting all lines in this list?  WDYT?

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_prefs.h" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
File chrome/browser/download/download_prefs.h (right):

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_prefs.h#newcode70" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_prefs.h:70: // fail if the |file_name| isn&#39;t
allowed to open automatically.
I find this on second reading a little confusing.  I read these two sentences as
&quot;Returns true on success.  One way to fail is if the file_name isn&#39;t allowed to
open automatically.&quot; which from an API contract point of view seems like either
too much or too little documentation.  If we trust the code, the only reason the
function will return false is if the file name isn&#39;t allowed to open
automatically; is that worth making clearer?  Or do we want to fuzz the API
contract a bit?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc File chrome/browser/download/download_extensions.cc (right): https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode78 chrome/browser/download/download_extensions.cc:78: // ALLOW_ON_USER_GESTURE. Even if the user explicitly consents to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 19:23:42 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            ><a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
File chrome/browser/download/download_extensions.cc (right):

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode78" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:78: // ALLOW_ON_USER_GESTURE.
Even if the user explicitly consents to the
On 2015/06/15 at 19:19:17, rdsmith wrote:
&gt; I&#39;d rewrite this a bit to explicitly acknowledge that ALLOW_ON_USER_GESTURE
isn&#39;t a reliable security guarantee, more of a speed bump.

Yup. I moved the general overview over to download_extensions.h since that, IMO,
should be part of the public interface. I left the comment about specific
criteria here.

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode79" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:79: // download, they should be
able to choose when or if the file should be
On 2015/06/15 at 19:19:17, rdsmith wrote:
&gt; The issue is whether they should be forced to rather than whether they be able
to choose to, right?

Yeah. Clarified.

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_extensions.cc#newcode105" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_extensions.cc:105: // Some files are dangerous
on all platforms.
On 2015/06/15 at 19:19:17, rdsmith wrote:
&gt; I really like the addition of detailed comments to this list.  Of course, the
addition of those comments makes sharper the lack of comments for some file
types.  Not as part of this CL, but maybe long-term we should have a goal of
commenting all lines in this list?  WDYT?

Agree completely. I&#39;ll fill in the blanks that I&#39;m comfortable with and add a
comment that all future additions should include a justification.

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_prefs.h" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
File chrome/browser/download/download_prefs.h (right):

<a href="https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/download/download_prefs.h#newcode70" rel="nofollow">https://codereview.chromium.org/1165893004/diff/140001/chrome/browser/downloa...</a>
chrome/browser/download/download_prefs.h:70: // fail if the |file_name| isn&#39;t
allowed to open automatically.
On 2015/06/15 at 19:19:17, rdsmith wrote:
&gt; I find this on second reading a little confusing.  I read these two sentences
as &quot;Returns true on success.  One way to fail is if the file_name isn&#39;t allowed
to open automatically.&quot; which from an API contract point of view seems like
either too much or too little documentation.  If we trust the code, the only
reason the function will return false is if the file name isn&#39;t allowed to open
automatically; is that worth making clearer?  Or do we want to fuzz the API
contract a bit?

Reworded.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          The CQ bit was checked by asanka@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 19:25:04 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            >The CQ bit was checked by <a href="mailto:asanka@chromium.org">asanka@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>asanka</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          The patchset sent to the CQ was uploaded after l-g-t-m from palmer@chromium.org, rdsmith@chromium.org Link to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 19:25:04 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >The patchset sent to the CQ was uploaded after l-g-t-m from <a href="mailto:palmer@chromium.org">palmer@chromium.org</a>,
<a href="mailto:rdsmith@chromium.org">rdsmith@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1165893004/#ps200001" rel="nofollow">https://codereview.chromium.org/1165893004/#ps200001</a>
(title: &quot; &quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1165893004/200001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 19:25:30 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1165893004/200001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1165893004/200001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          Committed patchset #10 (id:200001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 20:23:27 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-21"
            >Committed patchset #10 (id:200001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-22">
                          Patchset 10 (id:??) landed as https://crrev.com/39841e54180e2583dffa16fbbb9b99fd293821d0 Cr-Commit-Position: refs/heads/master@{#334677}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 20:24:25 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-22"
            >Patchset 10 (id:??) landed as
<a href="https://crrev.com/39841e54180e2583dffa16fbbb9b99fd293821d0" rel="nofollow">https://crrev.com/39841e54180e2583dffa16fbbb9b99fd293821d0</a>
Cr-Commit-Position: refs/heads/master@{#334677}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 23)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 23)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(23)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(23)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 23;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1165893004;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1165893004: [Downloads] Prevent dangerous files from being opened automatically.
     (Closed) </b><br/>
      Created 5 years, 6 months ago by asanka<br/>
      Modified 5 years, 6 months ago<br/>
      Reviewers: palmer, Randy Smith (Not in Mondays)<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 42
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
