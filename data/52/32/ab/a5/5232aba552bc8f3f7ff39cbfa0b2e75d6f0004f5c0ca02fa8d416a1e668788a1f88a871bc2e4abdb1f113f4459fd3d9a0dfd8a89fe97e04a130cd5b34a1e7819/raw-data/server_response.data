<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>
    
    
      
    
    
      Issue 1180393003: Added characters that look like padlocks to URL unescaping blacklist. -
    
    Code Review
  </title>
  <link rel="icon" href="/static/favicon.ico" />
  <link type="text/css" rel="stylesheet"
  href="/static/styles.css?v=408576698
" />
  <script type="text/javascript" src="/static/autocomplete/lib/jquery.js"></script>
  <script type="text/javascript"
    src="/static/script.js?v=408576698
"></script>
   <!-- head block to insert js/css for forms processing -->
   
   <!-- /head -->
</head>
<body onunload="M_unloadPage();">

<!-- Begin help window -->
<script type="text/javascript"><!--
var xsrfToken = '35439bf0c70de387ebf258d6757e53fb';
var helpDisplayed = false;
document.onclick = M_clickCommon;
var media_url = "/static/";
var base_url = "/";
// -->
</script>
<div id="help" style="display: none;">

<div style="font-size: medium; text-align: center;">Keyboard Shortcuts</div>
<hr />
<table class="shortcuts">
  <tr valign="top">
    <td>
      <table>
        <tr>
          <td></td><th>File</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to issue</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to file after / before current file</td>
        </tr>
        <tr>
          <td><span>J</span> / <span>K</span> <b>:</b></td><td>jump to next file with a comment after / before current file</td>
        </tr>
        <tr>
          <td></td><th>Side-by-side diff</th>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>toggle intra-line diffs</td>
        </tr>
        <tr>
          <td><span>e</span> <b>:</b></td><td>expand all comments</td>
        </tr>
        <tr>
          <td><span>c</span> <b>:</b></td><td>collapse all comments</td>
        </tr>
        <tr>
          <td><span>s</span> <b>:</b></td><td>toggle showing all comments</td>
        </tr>
        <tr>
          <td><span>n</span> / <span>p</span> <b>:</b></td><td>next / previous diff chunk or comment</td>
        </tr>
        <tr>
          <td><span>N</span> / <span>P</span> <b>:</b></td><td>next / previous comment</td>
        </tr>
        <tr>
          <td><span>&lt;Up&gt;</span> / <span>&lt;Down&gt;</span> <b>:</b></td><td>next / previous line</td>
        </tr>
      </table>
    </td>
    <td>
      <table>
        <tr>
          <td></td><th>Issue</th>
        </tr>
        <tr>
          <td><span>u</span> <b>:</b></td><td>up to list of issues</td>
        </tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to patch after / before current patch</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current patch in side-by-side view</td>
        </tr>
        <tr>
          <td><span>i</span> <b>:</b></td><td>open current patch in unified diff view</td>
        </tr>
        <tr><td>&nbsp;</td></tr>
          <tr><td></td><th>Issue List</th></tr>
        <tr>
          <td><span>j</span> / <span>k</span> <b>:</b></td><td>jump to issue after / before current issue</td>
        </tr>
        <tr>
          <td><span>o</span> / <span>&lt;Enter&gt;</span> <b>:</b></td><td>open current issue</td>
        </tr>
      </table>
    </td>
  </tr>

</table>
</div>
<!-- End help window -->

<div align="right">

<div style="float:left; font-size:x-large"><img style="vertical-align:middle" src="/static/chromium-24.png" /> Chromium Code Reviews</div>




<b>chromiumcodereview-hr@appspot.gserviceaccount.com (chromiumcodereview-hr)</b>
|

<span style="color:red">Please choose your nickname with</span>
<a class="novisit" href="/settings">Settings</a>
|


<a class="novisit" target="_blank"
   href="http://code.google.com/p/rietveld/wiki/CodeReviewHelp">Help</a>

|
<a class="novisit" href="http://www.chromium.org/">Chromium Project</a>
|
<a class="novisit" href="https://chromium-review.googlesource.com/dashboard/self?polygerrit=1">Gerrit Changes</a>
|

<a class="novisit" href="https://codereview.chromium.org/_ah/logout?continue=https://accounts.google.com/Logout%3Fcontinue%3Dhttps://uc.appengine.google.com/_ah/logout%253Fcontinue%253Dhttps://google.com/url%25253Fsa%25253DD%252526q%25253Dhttps://codereview.chromium.org/1180393003%252526ust%25253D1608717200326371%252526usg%25253DAFQjCNGtffatx1ExPw-KDbnW3gwS2vrSGQ%26service%3Dah">Sign out</a>

</div>
<div class="counter">(5)</div>
<br />
<div class="mainmenu">
  
  <a href="/" class="active">Issues</a>
  <a href="/search">Search</a>

</div>
<div class="mainmenu2">
  
  
    &nbsp;&nbsp;&nbsp;
    <a href="/mine">My Issues</a>
    |
    <a href="/starred">Starred</a>
    &nbsp;&nbsp;&nbsp;
    <a href="/all?closed=0">Open</a>
    |
    <a href="/all?closed=1">Closed</a>
    |
    <a href="/all">All</a>
  

</div>

<div>

  <h2>
    <span id="issue-star-1180393003">
  
    
      <img src="/static/star-dark.gif" width="15" height="15" border="0">
    
  
</span>

    Issue <a href="/1180393003/"
               onmouseover="M_showPopUp(this, 'popup-issue');">
            1180393003</a>:
    Added characters that look like padlocks to URL unescaping blacklist.  (Closed) 
  </h2>

  <table class="issue-details" border="0" width="100%">
    <tr valign="top">

      <td class="meta" width="20%">
        <div class="issue_details_sidebar">
          <div><b>Created:</b><br/>
            5 years, 6 months ago by <a href="/user/Matt%20Giuca" onMouseOver="M_showUserInfoPopup(this)">Matt Giuca</a>
          </div>
          <div><b>Modified:</b><br/>
            5 years, 6 months ago
          </div>
          <div><b>Reviewers:</b><br/>
            <span class='approval'><a href="/user/Peter%20Kasting" onMouseOver="M_showUserInfoPopup(this)">Peter Kasting</a></span>, <a href="/user/jam" onMouseOver="M_showUserInfoPopup(this)">jam</a>, <span class='approval'><a href="/user/mmenke" onMouseOver="M_showUserInfoPopup(this)">mmenke</a></span>
          </div>
          
          <div><b>CC:</b><br/>
            chromium-reviews, cbentzel+watch_chromium.org, chrome-apps-syd-reviews_chromium.org
          </div>
          
          
          <div><b>Base URL:</b><br/>
            
            https://chromium.googlesource.com/chromium/src.git@master
            
          </div>
          
          
          <div><b>Target Ref:</b><br/>
            refs/pending/heads/master
          </div>
          
          
          <div><b>Project:</b><br/>
            <a href="/search?project=chromium">
              chromium
            </a>
          </div>
          
          <div><b>Visibility:</b><br/>
            
                Public.
            
          </div>
          
          <div><a title="Find reviews for the same repository ID - c14d891d44f0afff64e56ed7c9702df1d807b1ee"
               href="/search?repo_guid=c14d891d44f0afff64e56ed7c9702df1d807b1ee">
            <b>More Reviews</b></a>
          </div>
          
        </div>
      </td>

      <td style="padding-left: .8em; padding-right: .8em;" width="80%">
        




  <h3><a id="issue-description-pointer"
     href="javascript:M_toggleSection('issue-description')"
     class="toggled-section opentriangle">
    Description</a></h3>
  <div id="issue-description">Added characters that look like padlocks to URL unescaping blacklist.

This blacklists the following Unicode characters:
- U+1F50F LOCK WITH INK PEN
- U+1F510 CLOSED LOCK WITH KEY
- U+1F512 LOCK
- U+1F513 OPEN LOCK

This prevents LOCK characters from appearing in a URL in the Chrome UI,
potentially looking like an SSL padlock icon (e.g., "google.com/ðŸ”’" is
now displayed as "google.com/%F0%9F%94%92"). This presented a spoofing
risk due to a few complications:
1. In RTL mode, the end of the URL (path/query) is aligned right up
   against the right edge of the Omnibox, where the SSL padlock is
   usually displayed.
2. On Mac, ChromeOS, and Android, LOCK characters are displayed in
   colour, making them more convincing.

Note: These characters will still be unescaped when using the
SPOOFING_AND_CONTROL_CHARS unescape rule (used for decoding data URLs,
previously known as CONTROL_CHARS).

BUG=<a href="https://bugs.chromium.org/p/chromium/issues/detail?id=495934">495934</a>, <a href="https://bugs.chromium.org/p/chromium/issues/detail?id=421332">421332</a>
<a href="mailto:TBR=jam@chromium.org">TBR=jam@chromium.org</a>

Committed: <a href="https://crrev.com/7c2cbc445a81424c7df48ebe61ec4d0dcadd5dff">https://crrev.com/7c2cbc445a81424c7df48ebe61ec4d0dcadd5dff</a>
Cr-Commit-Position: refs/heads/master@{#335870}
  </div>




  <h3>
    <a id="ps-1-pointer"
       href="/1180393003/#ps1"
       onclick="M_toggleSectionForPS('1180393003', '1')"
       class="toggled-section ">
      Patch Set 1
      
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 13
      
    </div>
  

  <div id="ps-1"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-20001-pointer"
       href="/1180393003/#ps20001"
       onclick="M_toggleSectionForPS('1180393003', '20001')"
       class="toggled-section ">
      Patch Set 2
      : Comment change.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-20001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-40001-pointer"
       href="/1180393003/#ps40001"
       onclick="M_toggleSectionForPS('1180393003', '40001')"
       class="toggled-section ">
      Patch Set 3
      : Combine if statements.
      <span class="anchor">#</span>
    </a>
  </h3>

  
    <div>
      <i>Total comments:</i> 9
      
    </div>
  

  <div id="ps-40001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-80001-pointer"
       href="/1180393003/#ps80001"
       onclick="M_toggleSectionForPS('1180393003', '80001')"
       class="toggled-section ">
      Patch Set 4
      : Code and comment updates.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-80001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-100001-pointer"
       href="/1180393003/#ps100001"
       onclick="M_toggleSectionForPS('1180393003', '100001')"
       class="toggled-section ">
      Patch Set 5
      : Rename to NON_DISPLAY_CHARS.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-100001"
  
       style="display:none">
  
  </div>
  

  <h3>
    <a id="ps-120001-pointer"
       href="/1180393003/#ps120001"
       onclick="M_toggleSectionForPS('1180393003', '120001')"
       class="toggled-section opentriangle">
      Patch Set 6
      : Rename NON_DISPLAY_CHARS to SPOOFING_AND_CONTROL_CHARS.
      <span class="anchor">#</span>
    </a>
  </h3>

  

  <div id="ps-120001"
  
       style="">
    
<div class="issue-list">

  <div class="pagination">
    <div style="float: left;">
      <i>Created:</i> 5 years, 6 months ago
    </div>
    <div style="float: right;">
      
        Download
          <a href="/download/issue1180393003_120001.diff"
            title="Patchset in text format">[raw]</a>
          <a href="/tarball/1180393003/120001"
            title="Tarball containing the original and patched files">[tar.bz2]</a>
      
    </div>
    <div style="clear:both;"></div>
  </div>

  <table id="queues" style="clear:both;">
    <tr align="left">
      <th colspan="2"></th>
      <th>Unified diffs</th>
      <th>Side-by-side diffs</th>
      <th>Delta from patch set</th>
      <th colspan="3">Stats <font style='font-weight: normal'>(<i>+131 lines, -46 lines</i>)</font></th>
      <th>Patch</th>
    </tr>

    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130001">
            chrome/browser/safe_browsing/safe_browsing_util.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/chrome/browser/safe_browsing/safe_browsing_util.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/chrome/browser/safe_browsing/safe_browsing_util.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/chrome/browser/safe_browsing/safe_browsing_util.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/chrome/browser/safe_browsing/safe_browsing_util.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/chrome/browser/safe_browsing/safe_browsing_util.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/chrome/browser/safe_browsing/safe_browsing_util.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+4 lines, -3 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130001.diff"
             title="Download patch for chrome/browser/safe_browsing/safe_browsing_util.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130002">
            chrome/common/instant_types.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/chrome/common/instant_types.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/chrome/common/instant_types.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/chrome/common/instant_types.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/chrome/common/instant_types.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/chrome/common/instant_types.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/chrome/common/instant_types.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+3 lines, -3 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130002.diff"
             title="Download patch for chrome/common/instant_types.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130003">
            components/policy/core/common/cloud/device_management_service_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/components/policy/core/common/cloud/device_management_service_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/components/policy/core/common/cloud/device_management_service_unittest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/components/policy/core/common/cloud/device_management_service_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/components/policy/core/common/cloud/device_management_service_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/components/policy/core/common/cloud/device_management_service_unittest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/components/policy/core/common/cloud/device_management_service_unittest.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+2 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130003.diff"
             title="Download patch for components/policy/core/common/cloud/device_management_service_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130004">
            content/browser/web_contents/web_drag_source_mac.mm
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/content/browser/web_contents/web_drag_source_mac.mm">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/content/browser/web_contents/web_drag_source_mac.mm"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/content/browser/web_contents/web_drag_source_mac.mm"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/content/browser/web_contents/web_drag_source_mac.mm"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/content/browser/web_contents/web_drag_source_mac.mm"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/content/browser/web_contents/web_drag_source_mac.mm"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130004.diff"
             title="Download patch for content/browser/web_contents/web_drag_source_mac.mm">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130005">
            extensions/browser/api/web_request/form_data_parser.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/extensions/browser/api/web_request/form_data_parser.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/extensions/browser/api/web_request/form_data_parser.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/extensions/browser/api/web_request/form_data_parser.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/extensions/browser/api/web_request/form_data_parser.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/extensions/browser/api/web_request/form_data_parser.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/extensions/browser/api/web_request/form_data_parser.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+5 lines, -4 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130005.diff"
             title="Download patch for extensions/browser/api/web_request/form_data_parser.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130006">
            net/base/data_url.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/net/base/data_url.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/net/base/data_url.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/net/base/data_url.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/net/base/data_url.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/net/base/data_url.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/net/base/data_url.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">2 chunks</td>
          <td style="white-space: nowrap">+2 lines, -2 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130006.diff"
             title="Download patch for net/base/data_url.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130008">
            net/base/escape.h
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/net/base/escape.h">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/net/base/escape.h"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/net/base/escape.h"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/net/base/escape.h"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/net/base/escape.h"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/net/base/escape.h"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+7 lines, -6 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130008.diff"
             title="Download patch for net/base/escape.h">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130007">
            net/base/escape.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/net/base/escape.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/net/base/escape.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/net/base/escape.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/net/base/escape.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/net/base/escape.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/net/base/escape.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">4 chunks</td>
          <td style="white-space: nowrap">+54 lines, -7 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130007.diff"
             title="Download patch for net/base/escape.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130009">
            net/base/escape_unittest.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/net/base/escape_unittest.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/net/base/escape_unittest.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/net/base/escape_unittest.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/net/base/escape_unittest.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/net/base/escape_unittest.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/net/base/escape_unittest.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">6 chunks</td>
          <td style="white-space: nowrap">+52 lines, -17 lines</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130009.diff"
             title="Download patch for net/base/escape_unittest.cc">
            Download
          </a>
        </td>
      </tr>
    
      <tr name="patch">
        <td class="first" width="14"><img src="/static/closedtriangle.gif"
    style="visibility: hidden;" width="12" height="9" /></td>
        <td style="white-space: nowrap">M</td>
        <td>
          <a class="noul"
             href="/1180393003/patch/120001/130010">
            storage/common/fileapi/file_system_util.cc
          </a>
        </td>
        <td>
          <a class="noul"
             href="/1180393003/diff/120001/storage/common/fileapi/file_system_util.cc">
            View
          </a>
        </td>
        <td style="white-space: nowrap">
        
          <a href="/1180393003/diff2/1:120001/storage/common/fileapi/file_system_util.cc"
             title="Delta from patch set 1">1</a>
        
          <a href="/1180393003/diff2/20001:120001/storage/common/fileapi/file_system_util.cc"
             title="Delta from patch set 2">2</a>
        
          <a href="/1180393003/diff2/40001:120001/storage/common/fileapi/file_system_util.cc"
             title="Delta from patch set 3">3</a>
        
          <a href="/1180393003/diff2/80001:120001/storage/common/fileapi/file_system_util.cc"
             title="Delta from patch set 4">4</a>
        
          <a href="/1180393003/diff2/100001:120001/storage/common/fileapi/file_system_util.cc"
             title="Delta from patch set 5">5</a>
        
        </td>
        
          <td style="white-space: nowrap">1 chunk</td>
          <td style="white-space: nowrap">+1 line, -1 line</td>
        
        <td style="white-space: nowrap">
          
            0 comments
            
            
          
        </td>
        <td>
          <a href="/download/issue1180393003_120001_130010.diff"
             title="Download patch for storage/common/fileapi/file_system_util.cc">
            Download
          </a>
        </td>
      </tr>
    
  </table>

  
  
</div>

  
  </div>
  
    <script language="JavaScript" type="text/javascript">
         <!--
         var lastPSId = 120001;
         // -->
       </script>
  




  <h3>
    <a id="messages-pointer"
       href="javascript:M_toggleSection('messages')"
       class="toggled-section opentriangle">
      Messages
    </a>
  </h3>

  
    <div><i>
    Total messages: 31 (9 generated)
    </i></div>
  

  <div id="messages">
    <div style="margin-bottom: .5em;">
      <a href="javascript:M_expandAllVisibleComments('cl', 31)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 31)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(31)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(31)">
        Hide Generated Messages</a>
      
    </div>

    
      <div class="message    generated"
           style="display: none"
           id="generated-msg1"
           name="0">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(0)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-0">
                          The CQ bit was checked by mgiuca@chromium.org to run a CQ dry run
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 02:07:09 UTC)
                <a href="#msg1">#1</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-0"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-0"
            >The CQ bit was checked by <a href="mailto:mgiuca@chromium.org">mgiuca@chromium.org</a> to run a CQ dry run</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg2"
           name="1">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(1)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-1">
                          Dry run: CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1180393003/1
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 02:07:44 UTC)
                <a href="#msg2">#2</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-1"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-1"
            >Dry run: CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1180393003/1" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1180393003/1</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg3"
           name="2">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(2)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-2">
                          mgiuca@chromium.org changed reviewers: + mmenke@chromium.org, pkasting@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 02:52:23 UTC)
                <a href="#msg3">#3</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-2"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-2"
            ><a href="mailto:mgiuca@chromium.org">mgiuca@chromium.org</a> changed reviewers:
+ <a href="mailto:mmenke@chromium.org">mmenke@chromium.org</a>, <a href="mailto:pkasting@chromium.org">pkasting@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg4"
           name="3">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(3)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-3">
                          mmenke: OWNERS. pkasting: Because this change affects the Omnibox. Note: This is a follow-up to ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 02:52:24 UTC)
                <a href="#msg4">#4</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-3"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-3"
            >mmenke: OWNERS.
pkasting: Because this change affects the Omnibox.

Note: This is a follow-up to <a href="https://codereview.chromium.org/1158023004/" rel="nofollow">https://codereview.chromium.org/1158023004/</a> (where
I added the same characters to the IDN blacklist for domain names).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg5"
           name="4">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(4)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-4">
                          PS: You can see before/after screenshots at http://crbug.com/495934#c18
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 02:53:24 UTC)
                <a href="#msg5">#5</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-4"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-4"
            >PS: You can see before/after screenshots at <a href="http://crbug.com/495934#c18" rel="nofollow">http://crbug.com/495934#c18</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg6"
           name="5">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(5)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-5">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 03:10:54 UTC)
                <a href="#msg6">#6</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-5"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-5"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg7"
           name="6">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(6)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-6">
                          Dry run: This issue passed the CQ dry run.
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 03:10:55 UTC)
                <a href="#msg7">#7</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-6"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-6"
            >Dry run: This issue passed the CQ dry run.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg8"
           name="7">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(7)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-7">
                          UNESCAPE_CONTROL_CHARS seems like a bit of a misnomer for unescaping these, but I see why ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 06:36:15 UTC)
                <a href="#msg8">#8</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-7"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-7"
            >UNESCAPE_CONTROL_CHARS seems like a bit of a misnomer for unescaping these, but
I see why you keyed it off this instead of adding another enum value.

I wonder if we should name this UNESCAPE_DANGEROUS_CHARS or something.

LGTM

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181</a>
net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
3, &amp;second_byte))
Nit: Combine these next two conditionals.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode186" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode186</a>
net/base/escape.cc:186: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
6, &amp;third_byte))
Nit: And these.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode191" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode191</a>
net/base/escape.cc:191: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
9, &amp;fourth_byte))
Nit: And maybe these (more optional).

Also optional: Combine all the conditionals.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg9"
           name="8">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(8)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-8">
                          &gt; I wonder if we should name this UNESCAPE_DANGEROUS_CHARS or something. I&#39;m happy to do ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 07:55:34 UTC)
                <a href="#msg9">#9</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-8"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-8"
            >&gt; I wonder if we should name this UNESCAPE_DANGEROUS_CHARS or something.

I&#39;m happy to do that now if you&#39;d like.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181</a>
net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
3, &amp;second_byte))
Do you mean

if (!...(..., &amp;second_byte) || second_byte != 0x9f)
  return false;

?

Or do you actually mean combining these calls to UnescapeUnsignedCharAtIndex
into a single giant if statement?

I&#39;m hesitant to do any of these changes as I feel they make the code less
readable (than simply checking each failing condition separately and returning
false at that time). Also there is the precedent of the other two functions
which I copied this one from.

I&#39;ll let Matt give an opinion here.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg10"
           name="9">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(9)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-9">
                          Renaming the enum is up to you. DANGEROUS_CHARS is a bit vague and threatening about ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-16 08:05:08 UTC)
                <a href="#msg10">#10</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-9"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-9"
            >Renaming the enum is up to you.  DANGEROUS_CHARS is a bit vague and threatening
about what, precisely, the danger is; OTOH I don&#39;t have a better idea.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181</a>
net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
3, &amp;second_byte))
On 2015/06/16 07:55:34, Matt Giuca wrote:
&gt; Do you mean
&gt; 
&gt; if (!...(..., &amp;second_byte) || second_byte != 0x9f)
&gt;   return false;

Yes, I meant this.  This reads more clearly to me than two conditionals.

&gt; Or do you actually mean combining these calls to UnescapeUnsignedCharAtIndex
&gt; into a single giant if statement?

That&#39;s the very last &quot;optional&quot; comment below; I&#39;m not convinced this would be a
good change.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg11"
           name="10">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(10)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-10">
                          Sorry, forgot about this one. Split a lot of ways this week. https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc File net/base/escape.cc ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-17 19:50:17 UTC)
                <a href="#msg11">#11</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-10"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-10"
            >Sorry, forgot about this one.  Split a lot of ways this week.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181</a>
net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
3, &amp;second_byte))
On 2015/06/16 08:05:08, Peter Kasting wrote:
&gt; On 2015/06/16 07:55:34, Matt Giuca wrote:
&gt; &gt; Do you mean
&gt; &gt; 
&gt; &gt; if (!...(..., &amp;second_byte) || second_byte != 0x9f)
&gt; &gt;   return false;
&gt; 
&gt; Yes, I meant this.  This reads more clearly to me than two conditionals.
&gt; 
&gt; &gt; Or do you actually mean combining these calls to UnescapeUnsignedCharAtIndex
&gt; &gt; into a single giant if statement?
&gt; 
&gt; That&#39;s the very last &quot;optional&quot; comment below; I&#39;m not convinced this would be
a
&gt; good change.

I think 4 ifs  (1 per character is) a little easier to read than one massive if.
 Could keep the last two separate.

I don&#39;t feel strongly about any of the options here, though.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode250" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode250</a>
net/base/escape.cc:250: // We also ban certain spoofable characters that could
be used to imitate
nit:  Should avoid &quot;we&quot; in comments.  Just use passive voice.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode251" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode251</a>
net/base/escape.cc:251: // parts of the browser UI.
nit:  Mentioning the browser seems like a bit of a layering violation, though
not exactly a serious one.  Security UI?  Agent UI?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg12"
           name="11">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(11)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-11">
                          https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc File net/base/escape.cc (right): https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181 net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index + 3, &amp;second_byte)) Done. (Not a ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-22 07:27:03 UTC)
                <a href="#msg12">#12</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-11"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-11"
            ><a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode181</a>
net/base/escape.cc:181: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
3, &amp;second_byte))
Done. (Not a fan of this change, but don&#39;t want to bikeshed.)

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode186" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode186</a>
net/base/escape.cc:186: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
6, &amp;third_byte))
On 2015/06/16 06:36:15, Peter Kasting wrote:
&gt; Nit: And these.

Done.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode191" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode191</a>
net/base/escape.cc:191: if (!UnescapeUnsignedCharAtIndex(escaped_text, index +
9, &amp;fourth_byte))
On 2015/06/16 06:36:15, Peter Kasting wrote:
&gt; Nit: And maybe these (more optional).
&gt; 
&gt; Also optional: Combine all the conditionals.

Done.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode250" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode250</a>
net/base/escape.cc:250: // We also ban certain spoofable characters that could
be used to imitate
On 2015/06/17 19:50:16, mmenke wrote:
&gt; nit:  Should avoid &quot;we&quot; in comments.  Just use passive voice.

Done.

<a href="https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode251" rel="nofollow">https://codereview.chromium.org/1180393003/diff/1/net/base/escape.cc#newcode251</a>
net/base/escape.cc:251: // parts of the browser UI.
I think we want to be fairly specific here. Yes, it is a bit of a layering
violation, but these characters are banned for a fairly specific reason, which
is that web browsers commonly use similar iconography to indicate security.

(Note: I didn&#39;t say which web browser, so it&#39;s not Chrome-specific.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg13"
           name="12">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(12)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-12">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc File net/base/escape.cc (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode196 net/base/escape.cc:196: fourth_byte != 0x93)) { Nit: Simpler: return UnescapeUnsignedCharAtIndex(escaped_text, index ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-22 07:35:22 UTC)
                <a href="#msg13">#13</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-12"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-12"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode196" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newc...</a>
net/base/escape.cc:196: fourth_byte != 0x93)) {
Nit: Simpler:

  return UnescapeUnsignedCharAtIndex(escaped_text, index + 9, &amp;fourth_byte) &amp;&amp;
      (fourth_byte == 0x8F || fourth_byte == 0x90 || fourth_byte == 0x92 ||
       fourth_byte == 0x93);

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:98: // characters (such as LOCK).
Nit: This might call out the spoofable part more:

Unescapes characters that can be used in spoofing attempts (such as LOCK) and
control characters (such as BiDi control characters and %01).  This INCLUDES
NULLs.  This is used for rare cases such as data: URL decoding where the result
is binary data.

(This suggests maybe SPOOFING_AND_CONTROL_CHARS would work as a new enum name...
although now that I read the bit about &quot;includes nulls&quot;, I&#39;m not as disinclined
toward my original DANGEROUS_CHARS name as I was.)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg14"
           name="13">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(13)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-13">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc File net/base/escape.cc (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode257 net/base/escape.cc:257: // be used to imitate parts of the browser ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-22 17:05:08 UTC)
                <a href="#msg14">#14</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-13"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-13"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode257" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newc...</a>
net/base/escape.cc:257: // be used to imitate parts of the browser UI.
On 2015/06/22 07:27:03, Matt Giuca wrote:
&gt; I think we want to be fairly specific here. Yes, it is a bit of a layering
&gt; violation, but these characters are banned for a fairly specific reason, which
&gt; is that web browsers commonly use similar iconography to indicate security.
&gt; 
&gt; (Note: I didn&#39;t say which web browser, so it&#39;s not Chrome-specific.)

It&#39;s a layering violation for net/ to know about anything in content/ (Which
includes things like the UI thread and IO thread...as well as the fact its
primary use case is being used in a browser).

Also worth noting the network stack is used in apps other than browsers.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg15"
           name="14">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(14)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-14">
                          Patchset #4 (id:60001) has been deleted
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 04:03:19 UTC)
                <a href="#msg15">#15</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-14"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-14"
            >Patchset #4 (id:60001) has been deleted</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg16"
           name="15">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(15)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-15">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc File net/base/escape.cc (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode196 net/base/escape.cc:196: fourth_byte != 0x93)) { On 2015/06/22 07:35:22, Peter Kasting ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 04:14:11 UTC)
                <a href="#msg16">#16</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-15"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-15"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc</a>
File net/base/escape.cc (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode196" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newc...</a>
net/base/escape.cc:196: fourth_byte != 0x93)) {
On 2015/06/22 07:35:22, Peter Kasting wrote:
&gt; Nit: Simpler:
&gt; 
&gt;   return UnescapeUnsignedCharAtIndex(escaped_text, index + 9, &amp;fourth_byte) &amp;&amp;
&gt;       (fourth_byte == 0x8F || fourth_byte == 0x90 || fourth_byte == 0x92 ||
&gt;        fourth_byte == 0x93);

Done.

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newcode257" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.cc#newc...</a>
net/base/escape.cc:257: // be used to imitate parts of the browser UI.
OK well the entire reason for these chars being banned is that they clash with
web browser UI, so it doesn&#39;t make sense for this comment *not* to mention web
browsers. (ie. if you use this module in a non-web-browser app, then the locks
probably don&#39;t need to be banned.)

But I take your point, so I changed &quot;parts of the browser UI&quot; to &quot;parts of a web
browser&#39;s UI.&quot;

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:98: // characters (such as LOCK).
OK, I&#39;m getting that you want me to rename this ;)

I chose to call it NON_DISPLAY_CHARS. I don&#39;t like names like &quot;DANGEROUS_CHARS&quot;
because characters are only dangerous in certain contexts (in this case, if you
display them). Also control chars aren&#39;t dangerous per se, some of them probably
would just show as boxes. What these all have in common is that they are
characters that should not be displayed in UI (all the documentation surrounding
CONTROL_CHARS says &quot;don&#39;t use this if you are going to display them in the UI&quot;),
so I think NON_DISPLAY_CHARS is an appropriate name and could later be expanded
to include other things that shouldn&#39;t be displayed, like non-breaking spaces.

WDYT?</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg17"
           name="16">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(16)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-16">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98 net/base/escape.h:98: // characters (such as LOCK). On 2015/06/23 04:14:10, Matt ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 04:35:53 UTC)
                <a href="#msg17">#17</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-16"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-16"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:98: // characters (such as LOCK).
On 2015/06/23 04:14:10, Matt Giuca wrote:
&gt; OK, I&#39;m getting that you want me to rename this ;)
&gt; 
&gt; I chose to call it NON_DISPLAY_CHARS. I don&#39;t like names like
&quot;DANGEROUS_CHARS&quot;
&gt; because characters are only dangerous in certain contexts (in this case, if
you
&gt; display them).

The whole point of this function is to prepare a URL for display, so this
objection seems a bit odd.

&gt; Also control chars aren&#39;t dangerous per se, some of them probably
&gt; would just show as boxes.

Embedded control characters could change the appearance and function of the URL
either in Chrome or in other applications you copied and pasted the URL to.  I
don&#39;t think &quot;characters might show as boxes&quot; is the limit of the danger here,
even in the omnibox.

&gt; What these all have in common is that they are
&gt; characters that should not be displayed in UI (all the documentation
surrounding
&gt; CONTROL_CHARS says &quot;don&#39;t use this if you are going to display them in the
UI&quot;),
&gt; so I think NON_DISPLAY_CHARS is an appropriate name and could later be
expanded
&gt; to include other things that shouldn&#39;t be displayed, like non-breaking spaces.
&gt; 
&gt; WDYT?

I don&#39;t like NON_DISPLAY_CHARS (sorry...).  I think it reads as &quot;non-displaying
characters&quot;, e.g. control characters, zero-width characters, soft hyphens, etc. 
But these banned characters are displaying characters.

I think either of my original suggestions is clearer.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg18"
           name="17">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(17)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-17">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98 net/base/escape.h:98: // characters (such as LOCK). On 2015/06/23 04:35:53, Peter ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 06:21:25 UTC)
                <a href="#msg18">#18</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-17"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-17"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:98: // characters (such as LOCK).
On 2015/06/23 04:35:53, Peter Kasting wrote:
&gt; The whole point of this function is to prepare a URL for display, so this
&gt; objection seems a bit odd.

No it isn&#39;t, it&#39;s used about equally for the two purposes of a) preparing a URL
for display, and b) decoding binary data that was encoded in a URL (like data:
URLs). The distinction at the call site is that in case (a) you do not use
CONTROL_CHARS, and in case (b), you do use CONTROL_CHARS.

So it seemed appropriate to rename CONTROL_CHARS to NON_DISPLAY_CHARS, for times
where you are not preparing a URL for display.

&gt; I don&#39;t like NON_DISPLAY_CHARS (sorry...).  I think it reads as
&quot;non-displaying
&gt; characters&quot;, e.g. control characters, zero-width characters, soft hyphens,
etc. 
&gt; But these banned characters are displaying characters.

Fair enough.

&gt; I think either of my original suggestions is clearer.

I still don&#39;t like DANGEROUS_CHARS because it implies that a client using this
function for use case (b) (decoding a data URL) is doing something dangerous.
Whereas in fact it is perfectly safe as long as you don&#39;t display the decoded
string in a context of a URL.

Let&#39;s go with SPOOFING_AND_CONTROL_CHARS then.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg19"
           name="18">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(18)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Peter Kasting</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-18">
                          https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h File net/base/escape.h (right): https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98 net/base/escape.h:98: // characters (such as LOCK). On 2015/06/23 06:21:24, Matt ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 06:55:15 UTC)
                <a href="#msg19">#19</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-18"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-18"
            ><a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h</a>
File net/base/escape.h (right):

<a href="https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newcode98" rel="nofollow">https://codereview.chromium.org/1180393003/diff/40001/net/base/escape.h#newco...</a>
net/base/escape.h:98: // characters (such as LOCK).
On 2015/06/23 06:21:24, Matt Giuca wrote:
&gt; On 2015/06/23 04:35:53, Peter Kasting wrote:
&gt; &gt; The whole point of this function is to prepare a URL for display, so this
&gt; &gt; objection seems a bit odd.
&gt; 
&gt; No it isn&#39;t, it&#39;s used about equally for the two purposes of a) preparing a
URL
&gt; for display, and b) decoding binary data that was encoded in a URL (like data:
&gt; URLs). The distinction at the call site is that in case (a) you do not use
&gt; CONTROL_CHARS, and in case (b), you do use CONTROL_CHARS.

How I think of it: That second case _is_ preparing the URL for display.  You&#39;re
prepping a data: URL for display as data, to be displayed to the user in the
content area.

Semantics :P

&gt; Let&#39;s go with SPOOFING_AND_CONTROL_CHARS then.

SGTM.</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message  approval  "
           
           id="msg20"
           name="19">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(19)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>mmenke</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-19">
                          LGTM
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-23 15:22:55 UTC)
                <a href="#msg20">#20</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-19"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-19"
            >LGTM</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg21"
           name="20">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(20)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-20">
                          mgiuca@chromium.org changed reviewers: + jam@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 00:57:22 UTC)
                <a href="#msg21">#21</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-20"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-20"
            ><a href="mailto:mgiuca@chromium.org">mgiuca@chromium.org</a> changed reviewers:
+ <a href="mailto:jam@chromium.org">jam@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg22"
           name="21">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(21)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-21">
                          jam@chromium.org: TBR for mechanical changes (renaming constant).
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 00:57:23 UTC)
                <a href="#msg22">#22</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-21"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-21"
            ><a href="mailto:jam@chromium.org">jam@chromium.org</a>: TBR for mechanical changes (renaming constant).</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg23"
           name="22">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(22)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-22">
                          The CQ bit was checked by mgiuca@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 00:57:32 UTC)
                <a href="#msg23">#23</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-22"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-22"
            >The CQ bit was checked by <a href="mailto:mgiuca@chromium.org">mgiuca@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg24"
           name="23">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(23)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-23">
                          The patchset sent to the CQ was uploaded after l-g-t-m from pkasting@chromium.org Link to the ...
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 00:57:32 UTC)
                <a href="#msg24">#24</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-23"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-23"
            >The patchset sent to the CQ was uploaded after l-g-t-m from
<a href="mailto:pkasting@chromium.org">pkasting@chromium.org</a>
Link to the patchset: <a href="https://codereview.chromium.org/1180393003/#ps120001" rel="nofollow">https://codereview.chromium.org/1180393003/#ps120001</a>
(title: &quot;Rename NON_DISPLAY_CHARS to SPOOFING_AND_CONTROL_CHARS.&quot;)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg25"
           name="24">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(24)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-24">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1180393003/120001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 00:59:57 UTC)
                <a href="#msg25">#25</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-24"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-24"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1180393003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1180393003/120001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg26"
           name="25">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(25)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-25">
                          The CQ bit was unchecked by commit-bot@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 02:36:14 UTC)
                <a href="#msg26">#26</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-25"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-25"
            >The CQ bit was unchecked by <a href="mailto:commit-bot@chromium.org">commit-bot@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg27"
           name="26">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(26)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-26">
                          Try jobs failed on following builders: win_chromium_x64_rel_ng on tryserver.chromium.win (JOB_FAILED, http://build.chromium.org/p/tryserver.chromium.win/builders/win_chromium_x64_rel_ng/builds/71328)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 02:36:15 UTC)
                <a href="#msg27">#27</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-26"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-26"
            >Try jobs failed on following builders:
  win_chromium_x64_rel_ng on tryserver.chromium.win (JOB_FAILED,
<a href="http://build.chromium.org/p/tryserver.chromium.win/builders/win_chromium_x64_rel_ng/builds/71328" rel="nofollow">http://build.chromium.org/p/tryserver.chromium.win/builders/win_chromium_x64_...</a>)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    generated"
           style="display: none"
           id="generated-msg28"
           name="27">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(27)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>Matt Giuca</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-27">
                          The CQ bit was checked by mgiuca@chromium.org
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 03:18:48 UTC)
                <a href="#msg28">#28</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-27"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-27"
            >The CQ bit was checked by <a href="mailto:mgiuca@chromium.org">mgiuca@chromium.org</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message    "
           
           id="msg29"
           name="28">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(28)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-28">
                          CQ is trying da patch. Follow status at https://chromium-cq-status.appspot.com/patch-status/1180393003/120001
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 03:19:10 UTC)
                <a href="#msg29">#29</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-28"
             style="display: none;">
          <div class="message-body">
            
            <pre name="cl-message-28"
            >CQ is trying da patch. Follow status at
 <a href="https://chromium-cq-status.appspot.com/patch-status/1180393003/120001" rel="nofollow">https://chromium-cq-status.appspot.com/patch-status/1180393003/120001</a></pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg30"
           name="29">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(29)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden;"
                           class="extra"
                           id="cl-preview-29">
                          Committed patchset #6 (id:120001)
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 03:59:57 UTC)
                <a href="#msg30">#30</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-29"
             style="display: none;">
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-29"
            >Committed patchset #6 (id:120001)</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    
      <div class="message issue_was_closed   "
           
           id="msg31"
           name="30">
        <div class="header">
          <table border="0" width="100%" cellspacing="0" cellpadding="0">
            <tr class="comment_title"
                onclick="M_switchChangelistComment(30)">
              <td style="padding-left: 5px; white-space: nowrap;">
                <b>commit-bot: I haz the power</b>
              </td>
              <td width="100%" style="overflow:hidden;">
                <table style="table-layout:fixed; white-space: nowrap;"
                       width="100%">
                  <tr>
                    <td>
                      <span style="white-space: nowrap; overflow: hidden; display: none;"
                           class="extra"
                           id="cl-preview-30">
                          Patchset 6 (id:??) landed as https://crrev.com/7c2cbc445a81424c7df48ebe61ec4d0dcadd5dff Cr-Commit-Position: refs/heads/master@{#335870}
                      </span>
                    </td>
                  </tr>
                </table>
              </td>
              <td align="right"
                  style="white-space: nowrap; padding-right: 5px; padding-left: 3px;">
                5 years, 6 months ago
		(2015-06-24 04:00:43 UTC)
                <a href="#msg31">#31</a>
              </td>
            </tr>
          </table>
        </div>

        <div id="cl-comment-30"
             >
          <div class="message-body">
            
              <span class="extra-note">
                Message was sent while issue was closed.
              </span>
            
            <pre name="cl-message-30"
            >Patchset 6 (id:??) landed as
<a href="https://crrev.com/7c2cbc445a81424c7df48ebe61ec4d0dcadd5dff" rel="nofollow">https://crrev.com/7c2cbc445a81424c7df48ebe61ec4d0dcadd5dff</a>
Cr-Commit-Position: refs/heads/master@{#335870}</pre>
          </div>
          <div class="message-footer"></div>
        </div>

      </div>
    

    <div>
      <a href="javascript:M_expandAllVisibleComments('cl', 31)">
        Expand Messages</a>
      |
      <a href="javascript:M_collapseAllVisibleComments('cl', 31)">
        Collapse Messages</a>
      
      |
      <a href="javascript:M_showGeneratedComments(31)">
        Show Generated Messages</a>
      |
      <a href="javascript:M_hideGeneratedComments(31)">
        Hide Generated Messages</a>
      
    </div>

  </div>

<script language="JavaScript" type="text/javascript">
<!--
var lastMsgID = 31;
// -->
</script>




<script language="JavaScript" type="text/javascript">
  <!--
    document.onkeydown = M_changelistKeyDown;
    var dashboardState = new M_DashboardState(window, 'patch', 'M_CLPatchMarker');
    var issueId = 1180393003;
    M_toggleIssueOverviewByAnchor();
  // -->
</script>



      </td>
    </tr>
  </table>

</div>

  
    <div class="popup" id="popup-issue">
      <b>Issue 1180393003: Added characters that look like padlocks to URL unescaping blacklist.
     (Closed) </b><br/>
      Created 5 years, 6 months ago by Matt Giuca<br/>
      Modified 5 years, 6 months ago<br/>
      Reviewers: mmenke, Peter Kasting, jam<br/>
      Base URL: https://chromium.googlesource.com/chromium/src.git@master<br/>
      Comments: 22
      
    </div>
  


<p></p>
<div style="float: left;">
  <a target="_blank" href="http://code.google.com/appengine/"><img border="0"
   src="/static/appengine-noborder-120x30.gif"
   alt="Powered by Google App Engine" /></a>
</div>

<div class="extra" style="font-size: 9pt; float: right; text-align: right;">
  <div style="margin-top: .3em;">This is Rietveld <a href='http://code.google.com/p/rietveld/source/list'>408576698
</a></div>
</div>


<script>
  // Google Analytics.
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55762617-11', {
    'allowLinker': true,
    'siteSpeedSampleRate': 100
  });
  ga('require', 'linker');
  ga('linker:autoLink',
     ['chromiumcodereview.appspot.com', 'codereview.chromium.org'] );
  ga('send', 'pageview');

  // CRDX Feedback button.
  (function(i,s,o,g,r,a,m){i['CrDXObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://storage.googleapis.com/crdx-feedback.appspot.com/feedback.js','crdx');

  crdx('setFeedbackButtonLink',
      'https://bugs.chromium.org/p/chromium/issues/entry?cc=andybons@chromium.org&components=Infra%3ECodereview%3ERietveld&labels=Infra-DX');
</script>


</body>
</html>
