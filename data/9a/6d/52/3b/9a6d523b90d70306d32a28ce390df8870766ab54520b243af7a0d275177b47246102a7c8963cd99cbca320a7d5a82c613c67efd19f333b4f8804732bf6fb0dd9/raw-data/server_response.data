<html>
	<head>
	
	<link href="//gmpg.org/xfn/11" rel="profile">
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>CVE-2019-12825: Unauthorized Access to Container Registry of other groups &middot; Patrick Münch Blog</title>
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="HandheldFriendly" content="True" />
	<meta name="MobileOptimized" content="320" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<link rel="stylesheet" type="text/css" media="only screen and (min-width: 900px)" href="/assets/css/desktop.css" />
	<link rel="stylesheet" type="text/css" media="only screen and (max-width: 899px)" href="/assets/css/mobile.css" />
	<link href="/assets/css/genericons.css" type="text/css" rel="stylesheet" />
	<link href="/assets/css/syntax.css" type="text/css" rel="stylesheet" />
	<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fenix:400,400italic">
	<link rel="apple-touch-icon" href="http://atomic111.github.io/assets/images/logo.jpeg">
	<link rel="shortcut icon" href="http://atomic111.github.io/assets/images/favicon.ico">
	<link rel="alternate" type="application/rss+xml" title="RSS" href="http://atomic111.github.io/atom.xml">
	<script type="text/javascript" src="/assets/js/jquery-2.1.0.min.js"></script>
	
	<script type="text/javascript" src="/assets/js/jquery.stellar.min.js"></script>
	
	<!-- Theme Color for Chrome on Android Lollipop -->
	<meta name="theme-color" content="#302F2D">
</head>

	<body>
		<header class="clean" style="background-image: url(/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg); height: 100%; " data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50">
	
	<label class="menu" for="_1">
	<span class="genericon genericon-menu"></span>
</label>
<input id="_1" type="checkbox">
<div class="menu-content">
	<p class="menu-title">Patrick Münch Blog<p>
	<div class="menu" style="background-color: #1a1a1a; z-index: -1;"></div>
	
		<a href="/">Home</a>
	
	<hr>
	<a href="https://twitter.com/atomiczero111" class="social-links-menu" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a><a href="https://github.com/atomic111" class="social-links-menu" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
</div>
<div class="social-links" data-stellar-ratio="0.1">
	
		<a href="https://twitter.com/atomiczero111" target="_blank" title="Follow me on twitter"><span class="genericon genericon-twitter"></span></a>
	
		<a href="https://github.com/atomic111" target="_blank" title="Fork me on github"><span class="genericon genericon-github"></span></a>
	
</div>

	<div id="post-info" data-stellar-ratio="0.7">
		<h1>CVE-2019-12825: Unauthorized Access to Container Registry of other groups</h1>
		
		<a class="site-title" href="https://twitter.com/atomiczero111"><div class="site-icon-small" style="background-image: url(https://avatars0.githubusercontent.com/u/7220740?s=400);"></div>Patrick Münch</a>, in 10 February 2020
	</div>
	
	<div id="nav-icon" style="bottom: 30px;" data-stellar-ratio="4">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-expand"></span></a>
	</div>
</header>
<div id="middle">
	<div id="article">
		<h1 id="overview">Overview</h1>

<ul>
  <li>Vendor: GitLab Inc.</li>
  <li>Product: Gitlab Enterprise (gitlab.com)</li>
  <li>Version: 12.0.0-pre</li>
  <li>Vulnerability: Relected Cross-Site Scripting</li>
  <li>Fixed Version: 12.5</li>
</ul>

<h1 id="background">Background</h1>

<p>GitLab provides a Git-repository manager with on top services and tools like a web-based DevOps lifecycle tool, wiki, issue-tracking and CI/CD pipeline features. GitLab is using an open-source license and developed by GitLab Inc.</p>

<p>From the vendor’s website:
“GitLab is the first single application for the entire DevOps lifecycle. From planning to monitoring GitLab covers every stage and additionally lets you manage and secure across stages. Only GitLab enables Concurrent DevOps, unlocking organizations from the constraints of the toolchain. GitLab provides unmatched visibility, higher levels of efficiency, and comprehensive governance. This makes the software lifecycle 200% faster, radically improving the speed of business.”</p>

<h1 id="issue-description">Issue Description</h1>

<p>When a user changes the path of a group in Gitlab, Docker registries are not adapted, leaving them in the old namespace. They are not protected and are available to all other users with no previous access to the repo.</p>

<p>The following steps illustrate the inadequate access control to docker registry:</p>

<ul>
  <li>create two Gitlab user (pentest1, pentest2) with ssh keys</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username = pentest1
mail = pentest1@groupofdestruction.de
pw = ...[SNIP]...

username = pentest2
mail = pentest2@groupofdestruction.de
pw = ...[SNIP]...
</code></pre></div></div>

<ul>
  <li>Login as user pentest1</li>
  <li>Go to <a href="https://gitlab.com/dashboard/groups?nav_source=navbar">https://gitlab.com/dashboard/groups?nav_source=navbar</a></li>
  <li>Create a new group with user pentest1 <a href="https://gitlab.com/groups/new">https://gitlab.com/groups/new</a> called grouppentest1 with private as default selection</li>
  <li>Create a new private project with name trial1 in group grouppentest1</li>
  <li>Go to <a href="https://gitlab.com/grouppentest1/trial1">https://gitlab.com/grouppentest1/trial1</a></li>
  <li>Create a new file .gitlab-ci.yml <a href="https://gitlab.com/grouppentest1/trial1/new/master">https://gitlab.com/grouppentest1/trial1/new/master</a> with the content located in this repo</li>
</ul>

<div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>build:docker:
stage: build
image: docker:18
services:
  - docker:dind
before_script:
  - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD \
    $CI_REGISTRY
script:
  - docker pull centos:7
  - docker pull centos:6
  - docker pull oraclelinux:7
  - docker tag docker.io/centos:7 $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker tag docker.io/centos:7 $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_NAME
  - docker tag docker.io/centos:6 $CI_REGISTRY_IMAGE:2.12.1
  - docker tag docker.io/oraclelinux:7 $CI_REGISTRY_IMAGE:2.13.1

  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_SHORT_SHA
  - docker push $CI_REGISTRY_IMAGE:$CI_COMMIT_REF_NAME
  - docker push $CI_REGISTRY_IMAGE:2.12.1
  - docker push $CI_REGISTRY_IMAGE:2.13.1
</code></pre></div></div>

<ul>
  <li>Wait until CI is done and go to <a href="https://gitlab.com/grouppentest1/trial1/container_registry">https://gitlab.com/grouppentest1/trial1/container_registry</a> and you should see the published repos</li>
  <li>Go to group management <a href="https://gitlab.com/groups/grouppentest1/-/edit">https://gitlab.com/groups/grouppentest1/-/edit</a> and change groupname to grouppentest2 and path to grouppentest2</li>
  <li>Project registry does not show any container <a href="https://gitlab.com/grouppentest1/trial1/container_registry">https://gitlab.com/grouppentest1/trial1/container_registry</a></li>
  <li>Logout as user pentest1</li>
  <li>Login with user pentest2</li>
  <li>Create a new group called grouppentest1</li>
  <li>Create a new project called trial1</li>
  <li>See docker images from previous user pentest1</li>
</ul>

<h1 id="cve">CVE</h1>

<p><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-12825">CVE-2019-12825</a></p>

<h1 id="cvssv3-base-score">CVSSv3 Base Score</h1>

<p>CVSS Base Score: <strong>5.6</strong></p>

<p>CVSS:3.0/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N</p>

<h1 id="credit">Credit</h1>

<p>Patrick Muench of <a href="https://www.sva.de">SVA System Vertrieb Alexander GmbH</a></p>

<p>Christoph Hartmann of <a href="https://mondoo.io/">Mondoo, Inc.</a></p>

<h1 id="disclaimer">Disclaimer</h1>

<p>The information provided is released “as is” without warranty of any kind. The publisher disclaims all warranties, either express or implied, including all warranties of merchantability. No responsibility is taken for the correctness of this information. In no event shall the publisher be liable for any damages whatsoever including direct, indirect, incidental, consequential, loss of business profits or special damages, even if the publisher has been advised of the possibility of such damages.</p>

<p>The contents of this advisory are copyright (c) 2019 Mondoo, Inc. &amp; SVA System Vertrieb Alexander GmbH and may be distributed freely provided that no fee is charged for this distribution and proper credit is given.</p>

	</div>
	
	<div id="comments">
		
	
	<script src="https://apis.google.com/js/plusone.js"></script>
	<div id="g-comments" class="g-comments" data-href="http://atomic111.github.io/article/gitlab-Unauthorized-Access-to-Container-Registry" data-width="700" data-first_party_property="BLOGGER" data-view_type="FILTERED_POSTMOD"></div>
	<script>
		var width = $('#comments').width() * 0.9;
		width = Math.round(width);
		$("#g-comments").attr({ "data-width": width });
	</script>


	</div>
	
	<div class="social center">
		<div class="network">
		<a class="hn-link" href="javascript:window.location=%22http://news.ycombinator.com/submitlink?u=%22+encodeURIComponent(document.location)+%22&amp;t=%22+encodeURIComponent(document.title)">Discuss on Hacker News</a>
		</div>
		<div class="network twitter">
		<a href="https://twitter.com/share" class="twitter-share-button" data-via="atomiczero111" data-count="none">Tweet</a>
		<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
		</div>
	</div>
</div>


<footer class="clean" style="background-image: url(/assets/article_images/2016-05-30-inspec-cis-docker/cover.jpeg); height: 75%; min-height: 500px; " data-stellar-background-ratio="0.5" data-stellar-horizontal-offset="50" data-stellar-vertical-offset="50">
	<div id="nav-icon" style="top: 60px;" data-stellar-ratio="0.8">
		<a class="scroll" data-speed="500" href="#article"><span class="genericon genericon-collapse"></span></a>
	</div>
	<div id="post-info" data-stellar-ratio="0.5" data-stellar-vertical-offset="120">
		<h3>Read next</h3>
		<a href="/article/plc-next-authenticated-xss">
			<h1>CVE-2020-12517: PLCnext AXC F 2152 Stored Cross-Site-Scripting (Authenticated)</h1>
			
				<h2></h2>
			
		</a>
	</div>
	<p class="copyright">&copy;2020, <a href="http://atomic111.github.io" target="_blank">Patrick Münch</a>. <a href="" target="_blank">All rights reserved</a>.</p>
</footer>
<script src="/assets/js/smooth-scroll.js"></script>

		<script>
		var width = $(window).width()
		if ( width > 899 )
		$( function(){
			$.stellar({
				responsive: true,
			verticalScrolling: true,
			horizontalOffset: 0,
			verticalOffset: 0,
			positionProperty: 'transform',
			});
		});
		</script>
		<style>
    #cookie-notice {padding: 0.5rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8);}
    #cookie-notice a {display: inline-block; cursor: pointer; margin-left: 0.5rem;}
    @media (max-width: 767px) {
        #cookie-notice span {display: block; padding-top: 3px; margin-bottom: 1rem;}
        #cookie-notice a {position: relative; bottom: 4px;}
    }
</style>
<div id="cookie-notice"><span>We would like to use third party cookies and scripts to improve the functionality of this website.</span><a id="cookie-notice-accept" class="btn btn-primary btn-sm">Approve</a><a href="/privacy" class="btn btn-primary btn-sm">More info</a></div>
<script>
    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }

    if(readCookie('cookie-notice-dismissed')=='true') {
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga')
ga('create', 'UA-114726397-1', 'auto');
ga('send', 'pageview');
        (function() {
	var li = document.createElement('li');
	li.id = 'library-chat';
	var libChatDiv = document.createElement('a');
	libChatDiv.appendChild(document.createTextNode('Ask a Question'));
	libChatDiv.className = 'btn btn-default';
	li.appendChild(libChatDiv);
	document.getElementById('cms-navigation').getElementsByTagName('ul')[0].appendChild(li);
	var chatWindow = function() {
		window.open('https://prod.library.gvsu.edu/labs/chat', 'Ask a Question', 'menubar=yes,location=yes,resizable=yes,scrollbars=yes,left=20,top=20,width=460,height=460');
	}
	if (libChatDiv.addEventListener) {
		libChatDiv.addEventListener('click', chatWindow, false);
	} else {
		libChatDiv.attachEvent('onclick', chatWindow);
	}
})();
    } else {
        document.getElementById('cookie-notice').style.display = 'block';
    }
    document.getElementById('cookie-notice-accept').addEventListener("click",function() {
        createCookie('cookie-notice-dismissed','true',31);
        document.getElementById('cookie-notice').style.display = 'none';
        location.reload();
    });

</script>

	</body>
</html>
